"use strict";var EY=Object.create;var fb=Object.defineProperty;var OY=Object.getOwnPropertyDescriptor;var jY=Object.getOwnPropertyNames;var NY=Object.getPrototypeOf,RY=Object.prototype.hasOwnProperty;var x=(t,e)=>()=>(t&&(e=t(t=0)),e);var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ve=(t,e)=>{for(var r in e)fb(t,r,{get:e[r],enumerable:!0})},LD=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of jY(e))!RY.call(t,o)&&o!==r&&fb(t,o,{get:()=>e[o],enumerable:!(n=OY(e,o))||n.enumerable});return t};var ct=(t,e,r)=>(r=t!=null?EY(NY(t)):{},LD(e||!t||!t.__esModule?fb(r,"default",{value:t,enumerable:!0}):r,t)),I=t=>LD(fb({},"__esModule",{value:!0}),t);var Ze,VD,J,Wi,gf=x(()=>{(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let i={};for(let s of o)i[s]=s;return i},t.getValidEnumValues=o=>{let i=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),s={};for(let a of i)s[a]=o[a];return t.objectValues(s)},t.objectValues=o=>t.objectKeys(o).map(function(i){return o[i]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let i=[];for(let s in o)Object.prototype.hasOwnProperty.call(o,s)&&i.push(s);return i},t.find=(o,i)=>{for(let s of o)if(i(s))return s},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,i=" | "){return o.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}t.joinValues=n,t.jsonStringifyReplacer=(o,i)=>typeof i=="bigint"?i.toString():i})(Ze||(Ze={}));(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(VD||(VD={}));J=Ze.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Wi=t=>{switch(typeof t){case"undefined":return J.undefined;case"string":return J.string;case"number":return Number.isNaN(t)?J.nan:J.number;case"boolean":return J.boolean;case"function":return J.function;case"bigint":return J.bigint;case"symbol":return J.symbol;case"object":return Array.isArray(t)?J.array:t===null?J.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?J.promise:typeof Map<"u"&&t instanceof Map?J.map:typeof Set<"u"&&t instanceof Set?J.set:typeof Date<"u"&&t instanceof Date?J.date:J.object;default:return J.unknown}}});var D,Ln,hb=x(()=>{gf();D=Ze.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Ln=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(i){return i.message},n={_errors:[]},o=i=>{for(let s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(o);else if(s.code==="invalid_return_type")o(s.returnTypeError);else if(s.code==="invalid_arguments")o(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let a=n,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(r(s))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ze.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r=Object.create(null),n=[];for(let o of this.issues)if(o.path.length>0){let i=o.path[0];r[i]=r[i]||[],r[i].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Ln.create=t=>new Ln(t)});var zY,Bs,yA=x(()=>{hb();gf();zY=(t,e)=>{let r;switch(t.code){case D.invalid_type:t.received===J.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case D.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Ze.jsonStringifyReplacer)}`;break;case D.unrecognized_keys:r=`Unrecognized key(s) in object: ${Ze.joinValues(t.keys,", ")}`;break;case D.invalid_union:r="Invalid input";break;case D.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Ze.joinValues(t.options)}`;break;case D.invalid_enum_value:r=`Invalid enum value. Expected ${Ze.joinValues(t.options)}, received '${t.received}'`;break;case D.invalid_arguments:r="Invalid function arguments";break;case D.invalid_return_type:r="Invalid function return type";break;case D.invalid_date:r="Invalid date";break;case D.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Ze.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case D.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case D.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case D.custom:r="Invalid input";break;case D.invalid_intersection_types:r="Intersection results could not be merged";break;case D.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case D.not_finite:r="Number must be finite";break;default:r=e.defaultError,Ze.assertNever(t)}return{message:r}},Bs=zY});function yf(){return MY}var MY,gb=x(()=>{yA();MY=Bs});function W(t,e){let r=yf(),n=yb({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Bs?void 0:Bs].filter(o=>!!o)});t.common.issues.push(n)}var yb,Vr,ye,su,on,vA,bA,Ha,vf,_A=x(()=>{gb();yA();yb=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,i=[...r,...o.path||[]],s={...o,path:i};if(o.message!==void 0)return{...o,path:i,message:o.message};let a="",c=n.filter(l=>!!l).slice().reverse();for(let l of c)a=l(s,{data:e,defaultError:a}).message;return{...o,path:i,message:a}};Vr=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return ye;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let i=await o.key,s=await o.value;n.push({key:i,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:i,value:s}=o;if(i.status==="aborted"||s.status==="aborted")return ye;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||o.alwaysSet)&&(n[i.value]=s.value)}return{status:e.value,value:n}}},ye=Object.freeze({status:"aborted"}),su=t=>({status:"dirty",value:t}),on=t=>({status:"valid",value:t}),vA=t=>t.status==="aborted",bA=t=>t.status==="dirty",Ha=t=>t.status==="valid",vf=t=>typeof Promise<"u"&&t instanceof Promise});var HD=x(()=>{});var ne,GD=x(()=>{(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(ne||(ne={}))});function Te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(s,a)=>{let{message:c}=t;return s.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:s.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}function KD(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function e7(t){return new RegExp(`^${KD(t)}$`)}function t7(t){let e=`${ZD}T${KD(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function r7(t,e){return!!((e==="v4"||!e)&&WY.test(t)||(e==="v6"||!e)&&KY.test(t))}function n7(t,e){if(!FY.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function o7(t,e){return!!((e==="v4"||!e)&&ZY.test(t)||(e==="v6"||!e)&&JY.test(t))}function i7(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,i=Number.parseInt(t.toFixed(o).replace(".","")),s=Number.parseInt(e.toFixed(o).replace(".",""));return i%s/10**o}function au(t){if(t instanceof Fn){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=jo.create(au(n))}return new Fn({...t._def,shape:()=>e})}else return t instanceof Ls?new Ls({...t._def,type:au(t.element)}):t instanceof jo?jo.create(au(t.unwrap())):t instanceof Ji?Ji.create(au(t.unwrap())):t instanceof Ki?Ki.create(t.items.map(e=>au(e))):t}function SA(t,e){let r=Wi(t),n=Wi(e);if(t===e)return{valid:!0,data:t};if(r===J.object&&n===J.object){let o=Ze.objectKeys(e),i=Ze.objectKeys(t).filter(a=>o.indexOf(a)!==-1),s={...t,...e};for(let a of i){let c=SA(t[a],e[a]);if(!c.valid)return{valid:!1};s[a]=c.data}return{valid:!0,data:s}}else if(r===J.array&&n===J.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let i=0;i<t.length;i++){let s=t[i],a=e[i],c=SA(s,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===J.date&&n===J.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}function JD(t,e){return new hu({values:t,typeName:ge.ZodEnum,...Te(e)})}var ro,WD,Re,DY,qY,BY,UY,LY,FY,VY,HY,GY,wA,WY,ZY,KY,JY,YY,QY,ZD,XY,cu,bf,_f,wf,xf,Sf,lu,uu,kf,Us,fi,Af,Ls,Fn,du,Zi,xA,pu,Ki,kA,$f,Pf,AA,fu,mu,hu,gu,Ga,No,jo,Ji,yu,vu,Cf,vb,bb,bu,J_e,ge,Y_e,Q_e,X_e,ewe,twe,rwe,nwe,owe,iwe,swe,awe,cwe,lwe,uwe,s7,dwe,pwe,fwe,mwe,hwe,gwe,ywe,vwe,bwe,_we,wwe,xwe,Swe,kwe,Awe,$we,Pwe,Cwe,Iwe,YD=x(()=>{hb();gb();GD();_A();gf();ro=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WD=(t,e)=>{if(Ha(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Ln(t.common.issues);return this._error=r,this._error}}};Re=class{get description(){return this._def.description}_getType(e){return Wi(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Wi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Vr,ctx:{common:e.parent.common,data:e.data,parsedType:Wi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(vf(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Wi(e)},o=this._parseSync({data:e,path:n.path,parent:n});return WD(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Wi(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Ha(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Ha(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Wi(e)},o=this._parse({data:e,path:n.path,parent:n}),i=await(vf(o)?o:Promise.resolve(o));return WD(n,i)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,i)=>{let s=e(o),a=()=>i.addIssue({code:D.custom,...n(o)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(a(),!1)):s?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new No({schema:this,typeName:ge.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return jo.create(this,this._def)}nullable(){return Ji.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ls.create(this)}promise(){return Ga.create(this,this._def)}or(e){return du.create([this,e],this._def)}and(e){return pu.create(this,e,this._def)}transform(e){return new No({...Te(this._def),schema:this,typeName:ge.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new yu({...Te(this._def),innerType:this,defaultValue:r,typeName:ge.ZodDefault})}brand(){return new vb({typeName:ge.ZodBranded,type:this,...Te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new vu({...Te(this._def),innerType:this,catchValue:r,typeName:ge.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return bb.create(this,e)}readonly(){return bu.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},DY=/^c[^\s-]{8,}$/i,qY=/^[0-9a-z]+$/,BY=/^[0-9A-HJKMNP-TV-Z]{26}$/i,UY=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,LY=/^[a-z0-9_-]{21}$/i,FY=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,VY=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,HY=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,GY="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",WY=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ZY=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,KY=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,JY=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,YY=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,QY=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ZD="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",XY=new RegExp(`^${ZD}$`);cu=class t extends Re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==J.string){let i=this._getOrReturnCtx(e);return W(i,{code:D.invalid_type,expected:J.string,received:i.parsedType}),ye}let n=new Vr,o;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(o=this._getOrReturnCtx(e,o),W(o,{code:D.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(o=this._getOrReturnCtx(e,o),W(o,{code:D.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let s=e.data.length>i.value,a=e.data.length<i.value;(s||a)&&(o=this._getOrReturnCtx(e,o),s?W(o,{code:D.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&W(o,{code:D.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")HY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"email",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")wA||(wA=new RegExp(GY,"u")),wA.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"emoji",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")UY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"uuid",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")LY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"nanoid",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")DY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"cuid",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")qY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"cuid2",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")BY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"ulid",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),W(o,{validation:"url",code:D.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"regex",code:D.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?t7(i).test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?XY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?e7(i).test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?VY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"duration",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?r7(e.data,i.version)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"ip",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?n7(e.data,i.alg)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"jwt",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?o7(e.data,i.version)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"cidr",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?YY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"base64",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?QY.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"base64url",code:D.invalid_string,message:i.message}),n.dirty()):Ze.assertNever(i);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:D.invalid_string,...ne.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ne.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ne.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ne.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ne.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ne.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ne.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ne.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ne.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ne.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ne.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ne.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ne.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ne.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...ne.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...ne.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...ne.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...ne.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...ne.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...ne.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...ne.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...ne.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...ne.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...ne.errToObj(r)})}nonempty(e){return this.min(1,ne.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};cu.create=t=>new cu({checks:[],typeName:ge.ZodString,coerce:t?.coerce??!1,...Te(t)});bf=class t extends Re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==J.number){let i=this._getOrReturnCtx(e);return W(i,{code:D.invalid_type,expected:J.number,received:i.parsedType}),ye}let n,o=new Vr;for(let i of this._def.checks)i.kind==="int"?Ze.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:D.invalid_type,expected:"integer",received:"float",message:i.message}),o.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="multipleOf"?i7(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:D.not_finite,message:i.message}),o.dirty()):Ze.assertNever(i);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,ne.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ne.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ne.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ne.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ne.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ne.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ne.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ne.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ne.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ne.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ne.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:ne.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ne.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ne.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ze.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};bf.create=t=>new bf({checks:[],typeName:ge.ZodNumber,coerce:t?.coerce||!1,...Te(t)});_f=class t extends Re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==J.bigint)return this._getInvalidInput(e);let n,o=new Vr;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):Ze.assertNever(i);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return W(r,{code:D.invalid_type,expected:J.bigint,received:r.parsedType}),ye}gte(e,r){return this.setLimit("min",e,!0,ne.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ne.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ne.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ne.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ne.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ne.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ne.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ne.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ne.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ne.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};_f.create=t=>new _f({checks:[],typeName:ge.ZodBigInt,coerce:t?.coerce??!1,...Te(t)});wf=class extends Re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==J.boolean){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:J.boolean,received:n.parsedType}),ye}return on(e.data)}};wf.create=t=>new wf({typeName:ge.ZodBoolean,coerce:t?.coerce||!1,...Te(t)});xf=class t extends Re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==J.date){let i=this._getOrReturnCtx(e);return W(i,{code:D.invalid_type,expected:J.date,received:i.parsedType}),ye}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return W(i,{code:D.invalid_date}),ye}let n=new Vr,o;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(o=this._getOrReturnCtx(e,o),W(o,{code:D.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(o=this._getOrReturnCtx(e,o),W(o,{code:D.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):Ze.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:ne.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:ne.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};xf.create=t=>new xf({checks:[],coerce:t?.coerce||!1,typeName:ge.ZodDate,...Te(t)});Sf=class extends Re{_parse(e){if(this._getType(e)!==J.symbol){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:J.symbol,received:n.parsedType}),ye}return on(e.data)}};Sf.create=t=>new Sf({typeName:ge.ZodSymbol,...Te(t)});lu=class extends Re{_parse(e){if(this._getType(e)!==J.undefined){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:J.undefined,received:n.parsedType}),ye}return on(e.data)}};lu.create=t=>new lu({typeName:ge.ZodUndefined,...Te(t)});uu=class extends Re{_parse(e){if(this._getType(e)!==J.null){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:J.null,received:n.parsedType}),ye}return on(e.data)}};uu.create=t=>new uu({typeName:ge.ZodNull,...Te(t)});kf=class extends Re{constructor(){super(...arguments),this._any=!0}_parse(e){return on(e.data)}};kf.create=t=>new kf({typeName:ge.ZodAny,...Te(t)});Us=class extends Re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return on(e.data)}};Us.create=t=>new Us({typeName:ge.ZodUnknown,...Te(t)});fi=class extends Re{_parse(e){let r=this._getOrReturnCtx(e);return W(r,{code:D.invalid_type,expected:J.never,received:r.parsedType}),ye}};fi.create=t=>new fi({typeName:ge.ZodNever,...Te(t)});Af=class extends Re{_parse(e){if(this._getType(e)!==J.undefined){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:J.void,received:n.parsedType}),ye}return on(e.data)}};Af.create=t=>new Af({typeName:ge.ZodVoid,...Te(t)});Ls=class t extends Re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==J.array)return W(r,{code:D.invalid_type,expected:J.array,received:r.parsedType}),ye;if(o.exactLength!==null){let s=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(s||a)&&(W(r,{code:s?D.too_big:D.too_small,minimum:a?o.exactLength.value:void 0,maximum:s?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(W(r,{code:D.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(W(r,{code:D.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,a)=>o.type._parseAsync(new ro(r,s,r.path,a)))).then(s=>Vr.mergeArray(n,s));let i=[...r.data].map((s,a)=>o.type._parseSync(new ro(r,s,r.path,a)));return Vr.mergeArray(n,i)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:ne.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:ne.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:ne.toString(r)}})}nonempty(e){return this.min(1,e)}};Ls.create=(t,e)=>new Ls({type:t,minLength:null,maxLength:null,exactLength:null,typeName:ge.ZodArray,...Te(e)});Fn=class t extends Re{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=Ze.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==J.object){let l=this._getOrReturnCtx(e);return W(l,{code:D.invalid_type,expected:J.object,received:l.parsedType}),ye}let{status:n,ctx:o}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof fi&&this._def.unknownKeys==="strip"))for(let l in o.data)s.includes(l)||a.push(l);let c=[];for(let l of s){let u=i[l],d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new ro(o,d,o.path,l)),alwaysSet:l in o.data})}if(this._def.catchall instanceof fi){let l=this._def.unknownKeys;if(l==="passthrough")for(let u of a)c.push({key:{status:"valid",value:u},value:{status:"valid",value:o.data[u]}});else if(l==="strict")a.length>0&&(W(o,{code:D.unrecognized_keys,keys:a}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let u of a){let d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new ro(o,d,o.path,u)),alwaysSet:u in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let l=[];for(let u of c){let d=await u.key,p=await u.value;l.push({key:d,value:p,alwaysSet:u.alwaysSet})}return l}).then(l=>Vr.mergeObjectSync(n,l)):Vr.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return ne.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:ne.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ge.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of Ze.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of Ze.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return au(this)}partial(e){let r={};for(let n of Ze.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of Ze.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof jo;)i=i._def.innerType;r[n]=i}return new t({...this._def,shape:()=>r})}keyof(){return JD(Ze.objectKeys(this.shape))}};Fn.create=(t,e)=>new Fn({shape:()=>t,unknownKeys:"strip",catchall:fi.create(),typeName:ge.ZodObject,...Te(e)});Fn.strictCreate=(t,e)=>new Fn({shape:()=>t,unknownKeys:"strict",catchall:fi.create(),typeName:ge.ZodObject,...Te(e)});Fn.lazycreate=(t,e)=>new Fn({shape:t,unknownKeys:"strip",catchall:fi.create(),typeName:ge.ZodObject,...Te(e)});du=class extends Re{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let s=i.map(a=>new Ln(a.ctx.common.issues));return W(r,{code:D.invalid_union,unionErrors:s}),ye}if(r.common.async)return Promise.all(n.map(async i=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(o);{let i,s=[];for(let c of n){let l={...r,common:{...r.common,issues:[]},parent:null},u=c._parseSync({data:r.data,path:r.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:l}),l.common.issues.length&&s.push(l.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;let a=s.map(c=>new Ln(c));return W(r,{code:D.invalid_union,unionErrors:a}),ye}}get options(){return this._def.options}};du.create=(t,e)=>new du({options:t,typeName:ge.ZodUnion,...Te(e)});Zi=t=>t instanceof fu?Zi(t.schema):t instanceof No?Zi(t.innerType()):t instanceof mu?[t.value]:t instanceof hu?t.options:t instanceof gu?Ze.objectValues(t.enum):t instanceof yu?Zi(t._def.innerType):t instanceof lu?[void 0]:t instanceof uu?[null]:t instanceof jo?[void 0,...Zi(t.unwrap())]:t instanceof Ji?[null,...Zi(t.unwrap())]:t instanceof vb||t instanceof bu?Zi(t.unwrap()):t instanceof vu?Zi(t._def.innerType):[],xA=class t extends Re{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==J.object)return W(r,{code:D.invalid_type,expected:J.object,received:r.parsedType}),ye;let n=this.discriminator,o=r.data[n],i=this.optionsMap.get(o);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(W(r,{code:D.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ye)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let i of r){let s=Zi(i.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of s){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,i)}}return new t({typeName:ge.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...Te(n)})}};pu=class extends Re{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(i,s)=>{if(vA(i)||vA(s))return ye;let a=SA(i.value,s.value);return a.valid?((bA(i)||bA(s))&&r.dirty(),{status:r.value,value:a.data}):(W(n,{code:D.invalid_intersection_types}),ye)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,s])=>o(i,s)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};pu.create=(t,e,r)=>new pu({left:t,right:e,typeName:ge.ZodIntersection,...Te(r)});Ki=class t extends Re{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==J.array)return W(n,{code:D.invalid_type,expected:J.array,received:n.parsedType}),ye;if(n.data.length<this._def.items.length)return W(n,{code:D.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ye;!this._def.rest&&n.data.length>this._def.items.length&&(W(n,{code:D.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let i=[...n.data].map((s,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new ro(n,s,n.path,a)):null}).filter(s=>!!s);return n.common.async?Promise.all(i).then(s=>Vr.mergeArray(r,s)):Vr.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Ki.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ki({items:t,typeName:ge.ZodTuple,rest:null,...Te(e)})};kA=class t extends Re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==J.object)return W(n,{code:D.invalid_type,expected:J.object,received:n.parsedType}),ye;let o=[],i=this._def.keyType,s=this._def.valueType;for(let a in n.data)o.push({key:i._parse(new ro(n,a,n.path,a)),value:s._parse(new ro(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?Vr.mergeObjectAsync(r,o):Vr.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof Re?new t({keyType:e,valueType:r,typeName:ge.ZodRecord,...Te(n)}):new t({keyType:cu.create(),valueType:e,typeName:ge.ZodRecord,...Te(r)})}},$f=class extends Re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==J.map)return W(n,{code:D.invalid_type,expected:J.map,received:n.parsedType}),ye;let o=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map(([a,c],l)=>({key:o._parse(new ro(n,a,n.path,[l,"key"])),value:i._parse(new ro(n,c,n.path,[l,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of s){let l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return ye;(l.status==="dirty"||u.status==="dirty")&&r.dirty(),a.set(l.value,u.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of s){let l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return ye;(l.status==="dirty"||u.status==="dirty")&&r.dirty(),a.set(l.value,u.value)}return{status:r.value,value:a}}}};$f.create=(t,e,r)=>new $f({valueType:e,keyType:t,typeName:ge.ZodMap,...Te(r)});Pf=class t extends Re{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==J.set)return W(n,{code:D.invalid_type,expected:J.set,received:n.parsedType}),ye;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(W(n,{code:D.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(W(n,{code:D.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let i=this._def.valueType;function s(c){let l=new Set;for(let u of c){if(u.status==="aborted")return ye;u.status==="dirty"&&r.dirty(),l.add(u.value)}return{status:r.value,value:l}}let a=[...n.data.values()].map((c,l)=>i._parse(new ro(n,c,n.path,l)));return n.common.async?Promise.all(a).then(c=>s(c)):s(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:ne.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:ne.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Pf.create=(t,e)=>new Pf({valueType:t,minSize:null,maxSize:null,typeName:ge.ZodSet,...Te(e)});AA=class t extends Re{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==J.function)return W(r,{code:D.invalid_type,expected:J.function,received:r.parsedType}),ye;function n(a,c){return yb({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,yf(),Bs].filter(l=>!!l),issueData:{code:D.invalid_arguments,argumentsError:c}})}function o(a,c){return yb({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,yf(),Bs].filter(l=>!!l),issueData:{code:D.invalid_return_type,returnTypeError:c}})}let i={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof Ga){let a=this;return on(async function(...c){let l=new Ln([]),u=await a._def.args.parseAsync(c,i).catch(f=>{throw l.addIssue(n(c,f)),l}),d=await Reflect.apply(s,this,u);return await a._def.returns._def.type.parseAsync(d,i).catch(f=>{throw l.addIssue(o(d,f)),l})})}else{let a=this;return on(function(...c){let l=a._def.args.safeParse(c,i);if(!l.success)throw new Ln([n(c,l.error)]);let u=Reflect.apply(s,this,l.data),d=a._def.returns.safeParse(u,i);if(!d.success)throw new Ln([o(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Ki.create(e).rest(Us.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Ki.create([]).rest(Us.create()),returns:r||Us.create(),typeName:ge.ZodFunction,...Te(n)})}},fu=class extends Re{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};fu.create=(t,e)=>new fu({getter:t,typeName:ge.ZodLazy,...Te(e)});mu=class extends Re{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return W(r,{received:r.data,code:D.invalid_literal,expected:this._def.value}),ye}return{status:"valid",value:e.data}}get value(){return this._def.value}};mu.create=(t,e)=>new mu({value:t,typeName:ge.ZodLiteral,...Te(e)});hu=class t extends Re{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return W(r,{expected:Ze.joinValues(n),received:r.parsedType,code:D.invalid_type}),ye}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return W(r,{received:r.data,code:D.invalid_enum_value,options:n}),ye}return on(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};hu.create=JD;gu=class extends Re{_parse(e){let r=Ze.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==J.string&&n.parsedType!==J.number){let o=Ze.objectValues(r);return W(n,{expected:Ze.joinValues(o),received:n.parsedType,code:D.invalid_type}),ye}if(this._cache||(this._cache=new Set(Ze.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=Ze.objectValues(r);return W(n,{received:n.data,code:D.invalid_enum_value,options:o}),ye}return on(e.data)}get enum(){return this._def.values}};gu.create=(t,e)=>new gu({values:t,typeName:ge.ZodNativeEnum,...Te(e)});Ga=class extends Re{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==J.promise&&r.common.async===!1)return W(r,{code:D.invalid_type,expected:J.promise,received:r.parsedType}),ye;let n=r.parsedType===J.promise?r.data:Promise.resolve(r.data);return on(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Ga.create=(t,e)=>new Ga({type:t,typeName:ge.ZodPromise,...Te(e)});No=class extends Re{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ge.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,i={addIssue:s=>{W(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),o.type==="preprocess"){let s=o.transform(n.data,i);if(n.common.async)return Promise.resolve(s).then(async a=>{if(r.value==="aborted")return ye;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?ye:c.status==="dirty"?su(c.value):r.value==="dirty"?su(c.value):c});{if(r.value==="aborted")return ye;let a=this._def.schema._parseSync({data:s,path:n.path,parent:n});return a.status==="aborted"?ye:a.status==="dirty"?su(a.value):r.value==="dirty"?su(a.value):a}}if(o.type==="refinement"){let s=a=>{let c=o.refinement(a,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ye:(a.status==="dirty"&&r.dirty(),s(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?ye:(a.status==="dirty"&&r.dirty(),s(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Ha(s))return ye;let a=o.transform(s.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>Ha(s)?Promise.resolve(o.transform(s.value,i)).then(a=>({status:r.value,value:a})):ye);Ze.assertNever(o)}};No.create=(t,e,r)=>new No({schema:t,typeName:ge.ZodEffects,effect:e,...Te(r)});No.createWithPreprocess=(t,e,r)=>new No({schema:e,effect:{type:"preprocess",transform:t},typeName:ge.ZodEffects,...Te(r)});jo=class extends Re{_parse(e){return this._getType(e)===J.undefined?on(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};jo.create=(t,e)=>new jo({innerType:t,typeName:ge.ZodOptional,...Te(e)});Ji=class extends Re{_parse(e){return this._getType(e)===J.null?on(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ji.create=(t,e)=>new Ji({innerType:t,typeName:ge.ZodNullable,...Te(e)});yu=class extends Re{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===J.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};yu.create=(t,e)=>new yu({innerType:t,typeName:ge.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Te(e)});vu=class extends Re{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return vf(o)?o.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ln(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Ln(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};vu.create=(t,e)=>new vu({innerType:t,typeName:ge.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Te(e)});Cf=class extends Re{_parse(e){if(this._getType(e)!==J.nan){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:J.nan,received:n.parsedType}),ye}return{status:"valid",value:e.data}}};Cf.create=t=>new Cf({typeName:ge.ZodNaN,...Te(t)});vb=class extends Re{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},bb=class t extends Re{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?ye:i.status==="dirty"?(r.dirty(),su(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?ye:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:ge.ZodPipeline})}},bu=class extends Re{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Ha(o)&&(o.value=Object.freeze(o.value)),o);return vf(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};bu.create=(t,e)=>new bu({innerType:t,typeName:ge.ZodReadonly,...Te(e)});J_e={object:Fn.lazycreate};(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(ge||(ge={}));Y_e=cu.create,Q_e=bf.create,X_e=Cf.create,ewe=_f.create,twe=wf.create,rwe=xf.create,nwe=Sf.create,owe=lu.create,iwe=uu.create,swe=kf.create,awe=Us.create,cwe=fi.create,lwe=Af.create,uwe=Ls.create,s7=Fn.create,dwe=Fn.strictCreate,pwe=du.create,fwe=xA.create,mwe=pu.create,hwe=Ki.create,gwe=kA.create,ywe=$f.create,vwe=Pf.create,bwe=AA.create,_we=fu.create,wwe=mu.create,xwe=hu.create,Swe=gu.create,kwe=Ga.create,Awe=No.create,$we=jo.create,Pwe=Ji.create,Cwe=No.createWithPreprocess,Iwe=bb.create});var $A=x(()=>{gb();_A();HD();gf();YD();hb()});var If=x(()=>{$A();$A()});function k(t,e,r){function n(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(t))return;a._zod.traits.add(t),e(a,c);let l=s.prototype,u=Object.keys(l);for(let d=0;d<u.length;d++){let p=u[d];p in a||(a[p]=l[p].bind(a))}}let o=r?.Parent??Object;class i extends o{}Object.defineProperty(i,"name",{value:t});function s(a){var c;let l=r?.Parent?new i:this;n(l,a),(c=l._zod).deferred??(c.deferred=[]);for(let u of l._zod.deferred)u();return l}return Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(s,"name",{value:t}),s}function vr(t){return t&&Object.assign(_b,t),_b}var wb,mi,Wa,_b,_u=x(()=>{wb=Object.freeze({status:"aborted"});mi=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Wa=class extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}},_b={}});var B={};ve(B,{BIGINT_FORMAT_RANGES:()=>RA,Class:()=>CA,NUMBER_FORMAT_RANGES:()=>NA,aborted:()=>Ws,allowsEval:()=>EA,assert:()=>f7,assertEqual:()=>l7,assertIs:()=>d7,assertNever:()=>p7,assertNotEqual:()=>u7,assignProp:()=>Vs,base64ToUint8Array:()=>eq,base64urlToUint8Array:()=>T7,cached:()=>xu,captureStackTrace:()=>Sb,cleanEnum:()=>I7,cleanRegex:()=>Of,clone:()=>sn,cloneDef:()=>h7,createTransparentProxy:()=>w7,defineLazy:()=>Fe,esc:()=>xb,escapeRegex:()=>no,extend:()=>k7,finalizeIssue:()=>yn,floatSafeRemainder:()=>IA,getElementAtPath:()=>g7,getEnumValues:()=>Ef,getLengthableOrigin:()=>Rf,getParsedType:()=>_7,getSizableOrigin:()=>Nf,hexToUint8Array:()=>O7,isObject:()=>Za,isPlainObject:()=>Gs,issue:()=>Su,joinValues:()=>be,jsonStringifyReplacer:()=>wu,merge:()=>$7,mergeDefs:()=>Hs,normalizeParams:()=>H,nullish:()=>Fs,numKeys:()=>b7,objectClone:()=>m7,omit:()=>S7,optionalKeys:()=>jA,partial:()=>P7,pick:()=>x7,prefixIssues:()=>Vn,primitiveTypes:()=>OA,promiseAllObject:()=>y7,propertyKeyTypes:()=>jf,randomString:()=>v7,required:()=>C7,safeExtend:()=>A7,shallowClone:()=>XD,slugify:()=>TA,stringifyPrimitive:()=>_e,uint8ArrayToBase64:()=>tq,uint8ArrayToBase64url:()=>E7,uint8ArrayToHex:()=>j7,unwrapMessage:()=>Tf});function l7(t){return t}function u7(t){return t}function d7(t){}function p7(t){throw new Error("Unexpected value in exhaustive check")}function f7(t){}function Ef(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function be(t,e="|"){return t.map(r=>_e(r)).join(e)}function wu(t,e){return typeof e=="bigint"?e.toString():e}function xu(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function Fs(t){return t==null}function Of(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function IA(t,e){let r=(t.toString().split(".")[1]||"").length,n=e.toString(),o=(n.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(n)){let c=n.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}let i=r>o?r:o,s=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}function Fe(t,e,r){let n;Object.defineProperty(t,e,{get(){if(n!==QD)return n===void 0&&(n=QD,n=r()),n},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function m7(t){return Object.create(Object.getPrototypeOf(t),Object.getOwnPropertyDescriptors(t))}function Vs(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function Hs(...t){let e={};for(let r of t){let n=Object.getOwnPropertyDescriptors(r);Object.assign(e,n)}return Object.defineProperties({},e)}function h7(t){return Hs(t._zod.def)}function g7(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function y7(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let i=0;i<e.length;i++)o[e[i]]=n[i];return o})}function v7(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function xb(t){return JSON.stringify(t)}function TA(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}function Za(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Gs(t){if(Za(t)===!1)return!1;let e=t.constructor;if(e===void 0||typeof e!="function")return!0;let r=e.prototype;return!(Za(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function XD(t){return Gs(t)?{...t}:Array.isArray(t)?[...t]:t}function b7(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function no(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function sn(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function H(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function w7(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,i){return e??(e=t()),Reflect.set(e,n,o,i)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function _e(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function jA(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}function x7(t,e){let r=t._zod.def,n=Hs(t._zod.def,{get shape(){let o={};for(let i in e){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&(o[i]=r.shape[i])}return Vs(this,"shape",o),o},checks:[]});return sn(t,n)}function S7(t,e){let r=t._zod.def,n=Hs(t._zod.def,{get shape(){let o={...t._zod.def.shape};for(let i in e){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&delete o[i]}return Vs(this,"shape",o),o},checks:[]});return sn(t,n)}function k7(t,e){if(!Gs(e))throw new Error("Invalid input to extend: expected a plain object");let r=t._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let o=Hs(t._zod.def,{get shape(){let i={...t._zod.def.shape,...e};return Vs(this,"shape",i),i},checks:[]});return sn(t,o)}function A7(t,e){if(!Gs(e))throw new Error("Invalid input to safeExtend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return Vs(this,"shape",n),n},checks:t._zod.def.checks};return sn(t,r)}function $7(t,e){let r=Hs(t._zod.def,{get shape(){let n={...t._zod.def.shape,...e._zod.def.shape};return Vs(this,"shape",n),n},get catchall(){return e._zod.def.catchall},checks:[]});return sn(t,r)}function P7(t,e,r){let n=Hs(e._zod.def,{get shape(){let o=e._zod.def.shape,i={...o};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(i[s]=t?new t({type:"optional",innerType:o[s]}):o[s])}else for(let s in o)i[s]=t?new t({type:"optional",innerType:o[s]}):o[s];return Vs(this,"shape",i),i},checks:[]});return sn(e,n)}function C7(t,e,r){let n=Hs(e._zod.def,{get shape(){let o=e._zod.def.shape,i={...o};if(r)for(let s in r){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(i[s]=new t({type:"nonoptional",innerType:o[s]}))}else for(let s in o)i[s]=new t({type:"nonoptional",innerType:o[s]});return Vs(this,"shape",i),i},checks:[]});return sn(e,n)}function Ws(t,e=0){if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function Vn(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function Tf(t){return typeof t=="string"?t:t?.message}function yn(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=Tf(t.inst?._zod.def?.error?.(t))??Tf(e?.error?.(t))??Tf(r.customError?.(t))??Tf(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Nf(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function Rf(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Su(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function I7(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function eq(t){let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function tq(t){let e="";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function T7(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-e.length%4)%4);return eq(e+r)}function E7(t){return tq(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function O7(t){let e=t.replace(/^0x/,"");if(e.length%2!==0)throw new Error("Invalid hex string length");let r=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)r[n/2]=Number.parseInt(e.slice(n,n+2),16);return r}function j7(t){return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}var QD,Sb,EA,_7,jf,OA,NA,RA,CA,le=x(()=>{QD=Symbol("evaluating");Sb="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};EA=xu(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});_7=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},jf=new Set(["string","number","symbol"]),OA=new Set(["string","number","bigint","boolean","symbol","undefined"]);NA={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},RA={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};CA=class{constructor(...e){}}});function Ab(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function $b(t,e=r=>r.message){let r={_errors:[]},n=o=>{for(let i of o.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(s=>n({issues:s}));else if(i.code==="invalid_key")n({issues:i.issues});else if(i.code==="invalid_element")n({issues:i.issues});else if(i.path.length===0)r._errors.push(e(i));else{let s=r,a=0;for(;a<i.path.length;){let c=i.path[a];a===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(e(i))):s[c]=s[c]||{_errors:[]},s=s[c],a++}}};return n(t),r}var rq,kb,zf,zA=x(()=>{_u();le();rq=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,wu,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},kb=k("$ZodError",rq),zf=k("$ZodError",rq,{Parent:Error})});var Mf,Df,qf,Bf,Uf,ku,Lf,Ff,nq,oq,iq,sq,aq,cq,lq,uq,MA=x(()=>{_u();zA();le();Mf=t=>(e,r,n,o)=>{let i=n?Object.assign(n,{async:!1}):{async:!1},s=e._zod.run({value:r,issues:[]},i);if(s instanceof Promise)throw new mi;if(s.issues.length){let a=new(o?.Err??t)(s.issues.map(c=>yn(c,i,vr())));throw Sb(a,o?.callee),a}return s.value},Df=Mf(zf),qf=t=>async(e,r,n,o)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){let a=new(o?.Err??t)(s.issues.map(c=>yn(c,i,vr())));throw Sb(a,o?.callee),a}return s.value},Bf=qf(zf),Uf=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new mi;return i.issues.length?{success:!1,error:new(t??kb)(i.issues.map(s=>yn(s,o,vr())))}:{success:!0,data:i.value}},ku=Uf(zf),Lf=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new t(i.issues.map(s=>yn(s,o,vr())))}:{success:!0,data:i.value}},Ff=Lf(zf),nq=t=>(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Mf(t)(e,r,o)},oq=t=>(e,r,n)=>Mf(t)(e,r,n),iq=t=>async(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return qf(t)(e,r,o)},sq=t=>async(e,r,n)=>qf(t)(e,r,n),aq=t=>(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Uf(t)(e,r,o)},cq=t=>(e,r,n)=>Uf(t)(e,r,n),lq=t=>async(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Lf(t)(e,r,o)},uq=t=>async(e,r,n)=>Lf(t)(e,r,n)});var oo={};ve(oo,{base64:()=>XA,base64url:()=>Pb,bigint:()=>i$,boolean:()=>c$,browserEmail:()=>L7,cidrv4:()=>YA,cidrv6:()=>QA,cuid:()=>DA,cuid2:()=>qA,date:()=>t$,datetime:()=>n$,domain:()=>H7,duration:()=>VA,e164:()=>e$,email:()=>GA,emoji:()=>WA,extendedDuration:()=>R7,guid:()=>HA,hex:()=>G7,hostname:()=>V7,html5Email:()=>q7,idnEmail:()=>U7,integer:()=>s$,ipv4:()=>ZA,ipv6:()=>KA,ksuid:()=>LA,lowercase:()=>d$,mac:()=>JA,md5_base64:()=>Z7,md5_base64url:()=>K7,md5_hex:()=>W7,nanoid:()=>FA,null:()=>l$,number:()=>a$,rfc5322Email:()=>B7,sha1_base64:()=>Y7,sha1_base64url:()=>Q7,sha1_hex:()=>J7,sha256_base64:()=>eQ,sha256_base64url:()=>tQ,sha256_hex:()=>X7,sha384_base64:()=>nQ,sha384_base64url:()=>oQ,sha384_hex:()=>rQ,sha512_base64:()=>sQ,sha512_base64url:()=>aQ,sha512_hex:()=>iQ,string:()=>o$,time:()=>r$,ulid:()=>BA,undefined:()=>u$,unicodeEmail:()=>dq,uppercase:()=>p$,uuid:()=>Ka,uuid4:()=>z7,uuid6:()=>M7,uuid7:()=>D7,xid:()=>UA});function WA(){return new RegExp(F7,"u")}function fq(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function r$(t){return new RegExp(`^${fq(t)}$`)}function n$(t){let e=fq({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${pq}T(?:${n})$`)}function Vf(t,e){return new RegExp(`^[A-Za-z0-9+/]{${t}}${e}$`)}function Hf(t){return new RegExp(`^[A-Za-z0-9_-]{${t}}$`)}var DA,qA,BA,UA,LA,FA,VA,R7,HA,Ka,z7,M7,D7,GA,q7,B7,dq,U7,L7,F7,ZA,KA,JA,YA,QA,XA,Pb,V7,H7,e$,pq,t$,o$,i$,s$,a$,c$,l$,u$,d$,p$,G7,W7,Z7,K7,J7,Y7,Q7,X7,eQ,tQ,rQ,nQ,oQ,iQ,sQ,aQ,Cb=x(()=>{le();DA=/^[cC][^\s-]{8,}$/,qA=/^[0-9a-z]+$/,BA=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,UA=/^[0-9a-vA-V]{20}$/,LA=/^[A-Za-z0-9]{27}$/,FA=/^[a-zA-Z0-9_-]{21}$/,VA=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,R7=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,HA=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Ka=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,z7=Ka(4),M7=Ka(6),D7=Ka(7),GA=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,q7=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,B7=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,dq=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,U7=dq,L7=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,F7="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";ZA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,KA=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,JA=t=>{let e=no(t??":");return new RegExp(`^(?:[0-9A-F]{2}${e}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${e}){5}[0-9a-f]{2}$`)},YA=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,QA=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,XA=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Pb=/^[A-Za-z0-9_-]*$/,V7=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,H7=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,e$=/^\+(?:[0-9]){6,14}[0-9]$/,pq="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",t$=new RegExp(`^${pq}$`);o$=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},i$=/^-?\d+n?$/,s$=/^-?\d+$/,a$=/^-?\d+(?:\.\d+)?/,c$=/^(?:true|false)$/i,l$=/^null$/i,u$=/^undefined$/i,d$=/^[^A-Z]*$/,p$=/^[^a-z]*$/,G7=/^[0-9a-fA-F]*$/;W7=/^[0-9a-fA-F]{32}$/,Z7=Vf(22,"=="),K7=Hf(22),J7=/^[0-9a-fA-F]{40}$/,Y7=Vf(27,"="),Q7=Hf(27),X7=/^[0-9a-fA-F]{64}$/,eQ=Vf(43,"="),tQ=Hf(43),rQ=/^[0-9a-fA-F]{96}$/,nQ=Vf(64,""),oQ=Hf(64),iQ=/^[0-9a-fA-F]{128}$/,sQ=Vf(86,"=="),aQ=Hf(86)});function mq(t,e,r){t.issues.length&&e.issues.push(...Vn(r,t.issues))}var _t,hq,f$,m$,gq,yq,vq,bq,_q,wq,xq,Sq,kq,Gf,Aq,$q,Pq,Cq,Iq,Tq,Eq,Oq,jq,Ib=x(()=>{_u();Cb();le();_t=k("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),hq={number:"number",bigint:"bigint",object:"date"},f$=k("$ZodCheckLessThan",(t,e)=>{_t.init(t,e);let r=hq[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,i=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<i&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),m$=k("$ZodCheckGreaterThan",(t,e)=>{_t.init(t,e);let r=hq[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,i=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>i&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),gq=k("$ZodCheckMultipleOf",(t,e)=>{_t.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):IA(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),yq=k("$ZodCheckNumberFormat",(t,e)=>{_t.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,i]=NA[e.format];t._zod.onattach.push(s=>{let a=s._zod.bag;a.format=e.format,a.minimum=o,a.maximum=i,r&&(a.pattern=s$)}),t._zod.check=s=>{let a=s.value;if(r){if(!Number.isInteger(a)){s.issues.push({expected:n,format:e.format,code:"invalid_type",continue:!1,input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?s.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):s.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&s.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>i&&s.issues.push({origin:"number",input:a,code:"too_big",maximum:i,inst:t})}}),vq=k("$ZodCheckBigIntFormat",(t,e)=>{_t.init(t,e);let[r,n]=RA[e.format];t._zod.onattach.push(o=>{let i=o._zod.bag;i.format=e.format,i.minimum=r,i.maximum=n}),t._zod.check=o=>{let i=o.value;i<r&&o.issues.push({origin:"bigint",input:i,code:"too_small",minimum:r,inclusive:!0,inst:t,continue:!e.abort}),i>n&&o.issues.push({origin:"bigint",input:i,code:"too_big",maximum:n,inst:t})}}),bq=k("$ZodCheckMaxSize",(t,e)=>{var r;_t.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Fs(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;o.size<=e.maximum||n.issues.push({origin:Nf(o),code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),_q=k("$ZodCheckMinSize",(t,e)=>{var r;_t.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Fs(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;o.size>=e.minimum||n.issues.push({origin:Nf(o),code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),wq=k("$ZodCheckSizeEquals",(t,e)=>{var r;_t.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Fs(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.size,o.maximum=e.size,o.size=e.size}),t._zod.check=n=>{let o=n.value,i=o.size;if(i===e.size)return;let s=i>e.size;n.issues.push({origin:Nf(o),...s?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),xq=k("$ZodCheckMaxLength",(t,e)=>{var r;_t.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Fs(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let s=Rf(o);n.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Sq=k("$ZodCheckMinLength",(t,e)=>{var r;_t.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Fs(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let s=Rf(o);n.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),kq=k("$ZodCheckLengthEquals",(t,e)=>{var r;_t.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Fs(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,i=o.length;if(i===e.length)return;let s=Rf(o),a=i>e.length;n.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Gf=k("$ZodCheckStringFormat",(t,e)=>{var r,n;_t.init(t,e),t._zod.onattach.push(o=>{let i=o._zod.bag;i.format=e.format,e.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),Aq=k("$ZodCheckRegex",(t,e)=>{Gf.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),$q=k("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=d$),Gf.init(t,e)}),Pq=k("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=p$),Gf.init(t,e)}),Cq=k("$ZodCheckIncludes",(t,e)=>{_t.init(t,e);let r=no(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),Iq=k("$ZodCheckStartsWith",(t,e)=>{_t.init(t,e);let r=new RegExp(`^${no(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),Tq=k("$ZodCheckEndsWith",(t,e)=>{_t.init(t,e);let r=new RegExp(`.*${no(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});Eq=k("$ZodCheckProperty",(t,e)=>{_t.init(t,e),t._zod.check=r=>{let n=e.schema._zod.run({value:r.value[e.property],issues:[]},{});if(n instanceof Promise)return n.then(o=>mq(o,r,e.property));mq(n,r,e.property)}}),Oq=k("$ZodCheckMimeType",(t,e)=>{_t.init(t,e);let r=new Set(e.mime);t._zod.onattach.push(n=>{n._zod.bag.mime=e.mime}),t._zod.check=n=>{r.has(n.value.type)||n.issues.push({code:"invalid_value",values:e.mime,input:n.value.type,inst:t,continue:!e.abort})}}),jq=k("$ZodCheckOverwrite",(t,e)=>{_t.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}})});var Tb,h$=x(()=>{Tb=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(s=>s),o=Math.min(...n.map(s=>s.length-s.trimStart().length)),i=n.map(s=>s.slice(o)).map(s=>" ".repeat(this.indent*2)+s);for(let s of i)this.content.push(s)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(i=>`  ${i}`)];return new e(...r,o.join(`
`))}}});var Rq,g$=x(()=>{Rq={major:4,minor:2,patch:1}});function Wq(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}function cQ(t){if(!Pb.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Wq(r)}function lQ(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}function zq(t,e,r){t.issues.length&&e.issues.push(...Vn(r,t.issues)),e.value[r]=t.value}function Rb(t,e,r,n){t.issues.length&&e.issues.push(...Vn(r,t.issues)),t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}function Zq(t){let e=Object.keys(t.shape);for(let n of e)if(!t.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);let r=jA(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}}function Kq(t,e,r,n,o,i){let s=[],a=o.keySet,c=o.catchall._zod,l=c.def.type;for(let u in e){if(a.has(u))continue;if(l==="never"){s.push(u);continue}let d=c.run({value:e[u],issues:[]},n);d instanceof Promise?t.push(d.then(p=>Rb(p,r,u,e))):Rb(d,r,u,e)}return s.length&&r.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:i}),t.length?Promise.all(t).then(()=>r):r}function Mq(t,e,r,n){for(let i of t)if(i.issues.length===0)return e.value=i.value,e;let o=t.filter(i=>!Ws(i));return o.length===1?(e.value=o[0].value,o[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(i=>i.issues.map(s=>yn(s,n,vr())))}),e)}function Dq(t,e,r,n){let o=t.filter(i=>i.issues.length===0);return o.length===1?(e.value=o[0].value,e):(o.length===0?e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(i=>i.issues.map(s=>yn(s,n,vr())))}):e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:[],inclusive:!1}),e)}function y$(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Gs(t)&&Gs(e)){let r=Object.keys(e),n=Object.keys(t).filter(i=>r.indexOf(i)!==-1),o={...t,...e};for(let i of n){let s=y$(t[i],e[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};o[i]=s.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],i=e[n],s=y$(o,i);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function qq(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),Ws(t))return t;let n=y$(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}function Eb(t,e,r){t.issues.length&&e.issues.push(...Vn(r,t.issues)),e.value[r]=t.value}function Bq(t,e,r,n,o,i,s){t.issues.length&&(jf.has(typeof n)?r.issues.push(...Vn(n,t.issues)):r.issues.push({code:"invalid_key",origin:"map",input:o,inst:i,issues:t.issues.map(a=>yn(a,s,vr()))})),e.issues.length&&(jf.has(typeof n)?r.issues.push(...Vn(n,e.issues)):r.issues.push({origin:"map",code:"invalid_element",input:o,inst:i,key:n,issues:e.issues.map(a=>yn(a,s,vr()))})),r.value.set(t.value,e.value)}function Uq(t,e){t.issues.length&&e.issues.push(...t.issues),e.value.add(t.value)}function Lq(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}function Fq(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}function Vq(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}function Ob(t,e,r){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},r)}function jb(t,e,r){if(t.issues.length)return t.aborted=!0,t;if((r.direction||"forward")==="forward"){let o=e.transform(t.value,t);return o instanceof Promise?o.then(i=>Nb(t,i,e.out,r)):Nb(t,o,e.out,r)}else{let o=e.reverseTransform(t.value,t);return o instanceof Promise?o.then(i=>Nb(t,i,e.in,r)):Nb(t,o,e.in,r)}}function Nb(t,e,r,n){return t.issues.length?(t.aborted=!0,t):r._zod.run({value:e,issues:t.issues},n)}function Hq(t){return t.value=Object.freeze(t.value),t}function Gq(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(Su(o))}}var Ae,Ja,ht,v$,b$,_$,w$,x$,S$,k$,A$,$$,P$,C$,I$,T$,E$,O$,j$,N$,R$,z$,M$,D$,q$,B$,U$,L$,zb,F$,Wf,Mb,V$,H$,G$,W$,Z$,K$,J$,Y$,Q$,X$,Jq,Yq,Zf,e1,t1,r1,Db,n1,o1,i1,s1,a1,c1,l1,u1,d1,p1,f1,m1,h1,g1,y1,v1,Kf,b1,_1,w1,x1,S1,k1,A1=x(()=>{Ib();_u();h$();MA();Cb();le();g$();le();Ae=k("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=Rq;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let i of o._zod.onattach)i(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,a,c)=>{let l=Ws(s),u;for(let d of a){if(d._zod.def.when){if(!d._zod.def.when(s))continue}else if(l)continue;let p=s.issues.length,f=d._zod.check(s);if(f instanceof Promise&&c?.async===!1)throw new mi;if(u||f instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await f,s.issues.length!==p&&(l||(l=Ws(s,p)))});else{if(s.issues.length===p)continue;l||(l=Ws(s,p))}}return u?u.then(()=>s):s},i=(s,a,c)=>{if(Ws(s))return s.aborted=!0,s;let l=o(a,n,c);if(l instanceof Promise){if(c.async===!1)throw new mi;return l.then(u=>t._zod.parse(u,c))}return t._zod.parse(l,c)};t._zod.run=(s,a)=>{if(a.skipChecks)return t._zod.parse(s,a);if(a.direction==="backward"){let l=t._zod.parse({value:s.value,issues:[]},{...a,skipChecks:!0});return l instanceof Promise?l.then(u=>i(u,s,a)):i(l,s,a)}let c=t._zod.parse(s,a);if(c instanceof Promise){if(a.async===!1)throw new mi;return c.then(l=>o(l,n,a))}return o(c,n,a)}}t["~standard"]={validate:o=>{try{let i=ku(t,o);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return Ff(t,o).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}}),Ja=k("$ZodString",(t,e)=>{Ae.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??o$(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),ht=k("$ZodStringFormat",(t,e)=>{Gf.init(t,e),Ja.init(t,e)}),v$=k("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=HA),ht.init(t,e)}),b$=k("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Ka(n))}else e.pattern??(e.pattern=Ka());ht.init(t,e)}),_$=k("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=GA),ht.init(t,e)}),w$=k("$ZodURL",(t,e)=>{ht.init(t,e),t._zod.check=r=>{try{let n=r.value.trim(),o=new URL(n);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),e.normalize?r.value=o.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),x$=k("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=WA()),ht.init(t,e)}),S$=k("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=FA),ht.init(t,e)}),k$=k("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=DA),ht.init(t,e)}),A$=k("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=qA),ht.init(t,e)}),$$=k("$ZodULID",(t,e)=>{e.pattern??(e.pattern=BA),ht.init(t,e)}),P$=k("$ZodXID",(t,e)=>{e.pattern??(e.pattern=UA),ht.init(t,e)}),C$=k("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=LA),ht.init(t,e)}),I$=k("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=n$(e)),ht.init(t,e)}),T$=k("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=t$),ht.init(t,e)}),E$=k("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=r$(e)),ht.init(t,e)}),O$=k("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=VA),ht.init(t,e)}),j$=k("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=ZA),ht.init(t,e),t._zod.bag.format="ipv4"}),N$=k("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=KA),ht.init(t,e),t._zod.bag.format="ipv6",t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),R$=k("$ZodMAC",(t,e)=>{e.pattern??(e.pattern=JA(e.delimiter)),ht.init(t,e),t._zod.bag.format="mac"}),z$=k("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=YA),ht.init(t,e)}),M$=k("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=QA),ht.init(t,e),t._zod.check=r=>{let n=r.value.split("/");try{if(n.length!==2)throw new Error;let[o,i]=n;if(!i)throw new Error;let s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${o}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});D$=k("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=XA),ht.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=r=>{Wq(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});q$=k("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=Pb),ht.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=r=>{cQ(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),B$=k("$ZodE164",(t,e)=>{e.pattern??(e.pattern=e$),ht.init(t,e)});U$=k("$ZodJWT",(t,e)=>{ht.init(t,e),t._zod.check=r=>{lQ(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}}),L$=k("$ZodCustomStringFormat",(t,e)=>{ht.init(t,e),t._zod.check=r=>{e.fn(r.value)||r.issues.push({code:"invalid_format",format:e.format,input:r.value,inst:t,continue:!e.abort})}}),zb=k("$ZodNumber",(t,e)=>{Ae.init(t,e),t._zod.pattern=t._zod.bag.pattern??a$,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...i?{received:i}:{}}),r}}),F$=k("$ZodNumberFormat",(t,e)=>{yq.init(t,e),zb.init(t,e)}),Wf=k("$ZodBoolean",(t,e)=>{Ae.init(t,e),t._zod.pattern=c$,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}}),Mb=k("$ZodBigInt",(t,e)=>{Ae.init(t,e),t._zod.pattern=i$,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=BigInt(r.value)}catch{}return typeof r.value=="bigint"||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:t}),r}}),V$=k("$ZodBigIntFormat",(t,e)=>{vq.init(t,e),Mb.init(t,e)}),H$=k("$ZodSymbol",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return typeof o=="symbol"||r.issues.push({expected:"symbol",code:"invalid_type",input:o,inst:t}),r}}),G$=k("$ZodUndefined",(t,e)=>{Ae.init(t,e),t._zod.pattern=u$,t._zod.values=new Set([void 0]),t._zod.optin="optional",t._zod.optout="optional",t._zod.parse=(r,n)=>{let o=r.value;return typeof o>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:o,inst:t}),r}}),W$=k("$ZodNull",(t,e)=>{Ae.init(t,e),t._zod.pattern=l$,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}}),Z$=k("$ZodAny",(t,e)=>{Ae.init(t,e),t._zod.parse=r=>r}),K$=k("$ZodUnknown",(t,e)=>{Ae.init(t,e),t._zod.parse=r=>r}),J$=k("$ZodNever",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)}),Y$=k("$ZodVoid",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return typeof o>"u"||r.issues.push({expected:"void",code:"invalid_type",input:o,inst:t}),r}}),Q$=k("$ZodDate",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=new Date(r.value)}catch{}let o=r.value,i=o instanceof Date;return i&&!Number.isNaN(o.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:o,...i?{received:"Invalid Date"}:{},inst:t}),r}});X$=k("$ZodArray",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let i=[];for(let s=0;s<o.length;s++){let a=o[s],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?i.push(c.then(l=>zq(l,r,s))):zq(c,r,s)}return i.length?Promise.all(i).then(()=>r):r}});Jq=k("$ZodObject",(t,e)=>{if(Ae.init(t,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){let a=e.shape;Object.defineProperty(e,"shape",{get:()=>{let c={...a};return Object.defineProperty(e,"shape",{value:c}),c}})}let n=xu(()=>Zq(e));Fe(t._zod,"propValues",()=>{let a=e.shape,c={};for(let l in a){let u=a[l]._zod;if(u.values){c[l]??(c[l]=new Set);for(let d of u.values)c[l].add(d)}}return c});let o=Za,i=e.catchall,s;t._zod.parse=(a,c)=>{s??(s=n.value);let l=a.value;if(!o(l))return a.issues.push({expected:"object",code:"invalid_type",input:l,inst:t}),a;a.value={};let u=[],d=s.shape;for(let p of s.keys){let m=d[p]._zod.run({value:l[p],issues:[]},c);m instanceof Promise?u.push(m.then(h=>Rb(h,a,p,l))):Rb(m,a,p,l)}return i?Kq(u,l,a,c,n.value,t):u.length?Promise.all(u).then(()=>a):a}}),Yq=k("$ZodObjectJIT",(t,e)=>{Jq.init(t,e);let r=t._zod.parse,n=xu(()=>Zq(e)),o=p=>{let f=new Tb(["shape","payload","ctx"]),m=n.value,h=S=>{let j=xb(S);return`shape[${j}]._zod.run({ value: input[${j}], issues: [] }, ctx)`};f.write("const input = payload.value;");let g=Object.create(null),v=0;for(let S of m.keys)g[S]=`key_${v++}`;f.write("const newResult = {};");for(let S of m.keys){let j=g[S],C=xb(S);f.write(`const ${j} = ${h(S)};`),f.write(`
        if (${j}.issues.length) {
          payload.issues = payload.issues.concat(${j}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${C}, ...iss.path] : [${C}]
          })));
        }
        
        
        if (${j}.value === undefined) {
          if (${C} in input) {
            newResult[${C}] = undefined;
          }
        } else {
          newResult[${C}] = ${j}.value;
        }
        
      `)}f.write("payload.value = newResult;"),f.write("return payload;");let b=f.compile();return(S,j)=>b(p,S,j)},i,s=Za,a=!_b.jitless,l=a&&EA.value,u=e.catchall,d;t._zod.parse=(p,f)=>{d??(d=n.value);let m=p.value;return s(m)?a&&l&&f?.async===!1&&f.jitless!==!0?(i||(i=o(e.shape)),p=i(p,f),u?Kq([],m,p,f,d,t):p):r(p,f):(p.issues.push({expected:"object",code:"invalid_type",input:m,inst:t}),p)}});Zf=k("$ZodUnion",(t,e)=>{Ae.init(t,e),Fe(t._zod,"optin",()=>e.options.some(o=>o._zod.optin==="optional")?"optional":void 0),Fe(t._zod,"optout",()=>e.options.some(o=>o._zod.optout==="optional")?"optional":void 0),Fe(t._zod,"values",()=>{if(e.options.every(o=>o._zod.values))return new Set(e.options.flatMap(o=>Array.from(o._zod.values)))}),Fe(t._zod,"pattern",()=>{if(e.options.every(o=>o._zod.pattern)){let o=e.options.map(i=>i._zod.pattern);return new RegExp(`^(${o.map(i=>Of(i.source)).join("|")})$`)}});let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let c of e.options){let l=c._zod.run({value:o.value,issues:[]},i);if(l instanceof Promise)a.push(l),s=!0;else{if(l.issues.length===0)return l;a.push(l)}}return s?Promise.all(a).then(c=>Mq(c,o,t,i)):Mq(a,o,t,i)}});e1=k("$ZodXor",(t,e)=>{Zf.init(t,e),e.inclusive=!1;let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let c of e.options){let l=c._zod.run({value:o.value,issues:[]},i);l instanceof Promise?(a.push(l),s=!0):a.push(l)}return s?Promise.all(a).then(c=>Dq(c,o,t,i)):Dq(a,o,t,i)}}),t1=k("$ZodDiscriminatedUnion",(t,e)=>{e.inclusive=!1,Zf.init(t,e);let r=t._zod.parse;Fe(t._zod,"propValues",()=>{let o={};for(let i of e.options){let s=i._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let[a,c]of Object.entries(s)){o[a]||(o[a]=new Set);for(let l of c)o[a].add(l)}}return o});let n=xu(()=>{let o=e.options,i=new Map;for(let s of o){let a=s._zod.propValues?.[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let c of a){if(i.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);i.set(c,s)}}return i});t._zod.parse=(o,i)=>{let s=o.value;if(!Za(s))return o.issues.push({code:"invalid_type",expected:"object",input:s,inst:t}),o;let a=n.value.get(s?.[e.discriminator]);return a?a._zod.run(o,i):e.unionFallback?r(o,i):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:s,path:[e.discriminator],inst:t}),o)}}),r1=k("$ZodIntersection",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,i=e.left._zod.run({value:o,issues:[]},n),s=e.right._zod.run({value:o,issues:[]},n);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([c,l])=>qq(r,c,l)):qq(r,i,s)}});Db=k("$ZodTuple",(t,e)=>{Ae.init(t,e);let r=e.items;t._zod.parse=(n,o)=>{let i=n.value;if(!Array.isArray(i))return n.issues.push({input:i,inst:t,expected:"tuple",code:"invalid_type"}),n;n.value=[];let s=[],a=[...r].reverse().findIndex(u=>u._zod.optin!=="optional"),c=a===-1?0:r.length-a;if(!e.rest){let u=i.length>r.length,d=i.length<c-1;if(u||d)return n.issues.push({...u?{code:"too_big",maximum:r.length}:{code:"too_small",minimum:r.length},input:i,inst:t,origin:"array"}),n}let l=-1;for(let u of r){if(l++,l>=i.length&&l>=c)continue;let d=u._zod.run({value:i[l],issues:[]},o);d instanceof Promise?s.push(d.then(p=>Eb(p,n,l))):Eb(d,n,l)}if(e.rest){let u=i.slice(r.length);for(let d of u){l++;let p=e.rest._zod.run({value:d,issues:[]},o);p instanceof Promise?s.push(p.then(f=>Eb(f,n,l))):Eb(p,n,l)}}return s.length?Promise.all(s).then(()=>n):n}});n1=k("$ZodRecord",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Gs(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let i=[],s=e.keyType._zod.values;if(s){r.value={};let a=new Set;for(let l of s)if(typeof l=="string"||typeof l=="number"||typeof l=="symbol"){a.add(typeof l=="number"?l.toString():l);let u=e.valueType._zod.run({value:o[l],issues:[]},n);u instanceof Promise?i.push(u.then(d=>{d.issues.length&&r.issues.push(...Vn(l,d.issues)),r.value[l]=d.value})):(u.issues.length&&r.issues.push(...Vn(l,u.issues)),r.value[l]=u.value)}let c;for(let l in o)a.has(l)||(c=c??[],c.push(l));c&&c.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:c})}else{r.value={};for(let a of Reflect.ownKeys(o)){if(a==="__proto__")continue;let c=e.keyType._zod.run({value:a,issues:[]},n);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(c.issues.length){e.mode==="loose"?r.value[a]=o[a]:r.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(u=>yn(u,n,vr())),input:a,path:[a],inst:t});continue}let l=e.valueType._zod.run({value:o[a],issues:[]},n);l instanceof Promise?i.push(l.then(u=>{u.issues.length&&r.issues.push(...Vn(a,u.issues)),r.value[c.value]=u.value})):(l.issues.length&&r.issues.push(...Vn(a,l.issues)),r.value[c.value]=l.value)}}return i.length?Promise.all(i).then(()=>r):r}}),o1=k("$ZodMap",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!(o instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:o,inst:t}),r;let i=[];r.value=new Map;for(let[s,a]of o){let c=e.keyType._zod.run({value:s,issues:[]},n),l=e.valueType._zod.run({value:a,issues:[]},n);c instanceof Promise||l instanceof Promise?i.push(Promise.all([c,l]).then(([u,d])=>{Bq(u,d,r,s,o,t,n)})):Bq(c,l,r,s,o,t,n)}return i.length?Promise.all(i).then(()=>r):r}});i1=k("$ZodSet",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!(o instanceof Set))return r.issues.push({input:o,inst:t,expected:"set",code:"invalid_type"}),r;let i=[];r.value=new Set;for(let s of o){let a=e.valueType._zod.run({value:s,issues:[]},n);a instanceof Promise?i.push(a.then(c=>Uq(c,r))):Uq(a,r)}return i.length?Promise.all(i).then(()=>r):r}});s1=k("$ZodEnum",(t,e)=>{Ae.init(t,e);let r=Ef(e.entries),n=new Set(r);t._zod.values=n,t._zod.pattern=new RegExp(`^(${r.filter(o=>jf.has(typeof o)).map(o=>typeof o=="string"?no(o):o.toString()).join("|")})$`),t._zod.parse=(o,i)=>{let s=o.value;return n.has(s)||o.issues.push({code:"invalid_value",values:r,input:s,inst:t}),o}}),a1=k("$ZodLiteral",(t,e)=>{if(Ae.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");let r=new Set(e.values);t._zod.values=r,t._zod.pattern=new RegExp(`^(${e.values.map(n=>typeof n=="string"?no(n):n?no(n.toString()):String(n)).join("|")})$`),t._zod.parse=(n,o)=>{let i=n.value;return r.has(i)||n.issues.push({code:"invalid_value",values:e.values,input:i,inst:t}),n}}),c1=k("$ZodFile",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return o instanceof File||r.issues.push({expected:"file",code:"invalid_type",input:o,inst:t}),r}}),l1=k("$ZodTransform",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Wa(t.constructor.name);let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(s=>(r.value=s,r));if(o instanceof Promise)throw new mi;return r.value=o,r}});u1=k("$ZodOptional",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",t._zod.optout="optional",Fe(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Fe(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Of(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>{if(e.innerType._zod.optin==="optional"){let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>Lq(i,r.value)):Lq(o,r.value)}return r.value===void 0?r:e.innerType._zod.run(r,n)}}),d1=k("$ZodNullable",(t,e)=>{Ae.init(t,e),Fe(t._zod,"optin",()=>e.innerType._zod.optin),Fe(t._zod,"optout",()=>e.innerType._zod.optout),Fe(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Of(r.source)}|null)$`):void 0}),Fe(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),p1=k("$ZodDefault",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",Fe(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>Fq(i,e)):Fq(o,e)}});f1=k("$ZodPrefault",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",Fe(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),m1=k("$ZodNonOptional",(t,e)=>{Ae.init(t,e),Fe(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>Vq(i,t)):Vq(o,t)}});h1=k("$ZodSuccess",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Wa("ZodSuccess");let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>(r.value=i.issues.length===0,r)):(r.value=o.issues.length===0,r)}}),g1=k("$ZodCatch",(t,e)=>{Ae.init(t,e),Fe(t._zod,"optin",()=>e.innerType._zod.optin),Fe(t._zod,"optout",()=>e.innerType._zod.optout),Fe(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>(r.value=i.value,i.issues.length&&(r.value=e.catchValue({...r,error:{issues:i.issues.map(s=>yn(s,n,vr()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(i=>yn(i,n,vr()))},input:r.value}),r.issues=[]),r)}}),y1=k("$ZodNaN",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>((typeof r.value!="number"||!Number.isNaN(r.value))&&r.issues.push({input:r.value,inst:t,expected:"nan",code:"invalid_type"}),r)}),v1=k("$ZodPipe",(t,e)=>{Ae.init(t,e),Fe(t._zod,"values",()=>e.in._zod.values),Fe(t._zod,"optin",()=>e.in._zod.optin),Fe(t._zod,"optout",()=>e.out._zod.optout),Fe(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if(n.direction==="backward"){let i=e.out._zod.run(r,n);return i instanceof Promise?i.then(s=>Ob(s,e.in,n)):Ob(i,e.in,n)}let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(i=>Ob(i,e.out,n)):Ob(o,e.out,n)}});Kf=k("$ZodCodec",(t,e)=>{Ae.init(t,e),Fe(t._zod,"values",()=>e.in._zod.values),Fe(t._zod,"optin",()=>e.in._zod.optin),Fe(t._zod,"optout",()=>e.out._zod.optout),Fe(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if((n.direction||"forward")==="forward"){let i=e.in._zod.run(r,n);return i instanceof Promise?i.then(s=>jb(s,e,n)):jb(i,e,n)}else{let i=e.out._zod.run(r,n);return i instanceof Promise?i.then(s=>jb(s,e,n)):jb(i,e,n)}}});b1=k("$ZodReadonly",(t,e)=>{Ae.init(t,e),Fe(t._zod,"propValues",()=>e.innerType._zod.propValues),Fe(t._zod,"values",()=>e.innerType._zod.values),Fe(t._zod,"optin",()=>e.innerType?._zod?.optin),Fe(t._zod,"optout",()=>e.innerType?._zod?.optout),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(Hq):Hq(o)}});_1=k("$ZodTemplateLiteral",(t,e)=>{Ae.init(t,e);let r=[];for(let n of e.parts)if(typeof n=="object"&&n!==null){if(!n._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...n._zod.traits].shift()}`);let o=n._zod.pattern instanceof RegExp?n._zod.pattern.source:n._zod.pattern;if(!o)throw new Error(`Invalid template literal part: ${n._zod.traits}`);let i=o.startsWith("^")?1:0,s=o.endsWith("$")?o.length-1:o.length;r.push(o.slice(i,s))}else if(n===null||OA.has(typeof n))r.push(no(`${n}`));else throw new Error(`Invalid template literal part: ${n}`);t._zod.pattern=new RegExp(`^${r.join("")}$`),t._zod.parse=(n,o)=>typeof n.value!="string"?(n.issues.push({input:n.value,inst:t,expected:"template_literal",code:"invalid_type"}),n):(t._zod.pattern.lastIndex=0,t._zod.pattern.test(n.value)||n.issues.push({input:n.value,inst:t,code:"invalid_format",format:e.format??"template_literal",pattern:t._zod.pattern.source}),n)}),w1=k("$ZodFunction",(t,e)=>(Ae.init(t,e),t._def=e,t._zod.def=e,t.implement=r=>{if(typeof r!="function")throw new Error("implement() must be called with a function");return function(...n){let o=t._def.input?Df(t._def.input,n):n,i=Reflect.apply(r,this,o);return t._def.output?Df(t._def.output,i):i}},t.implementAsync=r=>{if(typeof r!="function")throw new Error("implementAsync() must be called with a function");return async function(...n){let o=t._def.input?await Bf(t._def.input,n):n,i=await Reflect.apply(r,this,o);return t._def.output?await Bf(t._def.output,i):i}},t._zod.parse=(r,n)=>typeof r.value!="function"?(r.issues.push({code:"invalid_type",expected:"function",input:r.value,inst:t}),r):(t._def.output&&t._def.output._zod.def.type==="promise"?r.value=t.implementAsync(r.value):r.value=t.implement(r.value),r),t.input=(...r)=>{let n=t.constructor;return Array.isArray(r[0])?new n({type:"function",input:new Db({type:"tuple",items:r[0],rest:r[1]}),output:t._def.output}):new n({type:"function",input:r[0],output:t._def.output})},t.output=r=>{let n=t.constructor;return new n({type:"function",input:t._def.input,output:r})},t)),x1=k("$ZodPromise",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>Promise.resolve(r.value).then(o=>e.innerType._zod.run({value:o,issues:[]},n))}),S1=k("$ZodLazy",(t,e)=>{Ae.init(t,e),Fe(t._zod,"innerType",()=>e.getter()),Fe(t._zod,"pattern",()=>t._zod.innerType?._zod?.pattern),Fe(t._zod,"propValues",()=>t._zod.innerType?._zod?.propValues),Fe(t._zod,"optin",()=>t._zod.innerType?._zod?.optin??void 0),Fe(t._zod,"optout",()=>t._zod.innerType?._zod?.optout??void 0),t._zod.parse=(r,n)=>t._zod.innerType._zod.run(r,n)}),k1=k("$ZodCustom",(t,e)=>{_t.init(t,e),Ae.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(i=>Gq(i,r,n,t));Gq(o,r,n,t)}})});var Qq=x(()=>{le()});var Xq=x(()=>{le()});var e2=x(()=>{le()});var t2=x(()=>{le()});var r2=x(()=>{le()});var n2=x(()=>{le()});var o2=x(()=>{le()});var i2=x(()=>{le()});function $1(){return{localeError:pQ()}}var dQ,pQ,P1=x(()=>{le();dQ=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},pQ=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${dQ(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${_e(n.values[0])}`:`Invalid option: expected one of ${be(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",i=e(n.origin);return i?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${i.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",i=e(n.origin);return i?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${i.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${be(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}}});var s2=x(()=>{le()});var a2=x(()=>{le()});var c2=x(()=>{le()});var l2=x(()=>{le()});var u2=x(()=>{le()});var d2=x(()=>{le()});var p2=x(()=>{le()});var f2=x(()=>{le()});var m2=x(()=>{le()});var h2=x(()=>{le()});var g2=x(()=>{le()});var y2=x(()=>{le()});var v2=x(()=>{le()});var C1=x(()=>{le()});var b2=x(()=>{C1()});var _2=x(()=>{le()});var w2=x(()=>{le()});var x2=x(()=>{le()});var S2=x(()=>{le()});var k2=x(()=>{le()});var A2=x(()=>{le()});var $2=x(()=>{le()});var P2=x(()=>{le()});var C2=x(()=>{le()});var I2=x(()=>{le()});var T2=x(()=>{le()});var E2=x(()=>{le()});var O2=x(()=>{le()});var j2=x(()=>{le()});var N2=x(()=>{le()});var R2=x(()=>{le()});var I1=x(()=>{le()});var z2=x(()=>{I1()});var M2=x(()=>{le()});var D2=x(()=>{le()});var q2=x(()=>{le()});var B2=x(()=>{le()});var U2=x(()=>{le()});var qb=x(()=>{Qq();Xq();e2();t2();r2();n2();o2();i2();P1();s2();a2();c2();l2();u2();d2();p2();f2();m2();h2();g2();y2();v2();b2();C1();_2();w2();x2();S2();k2();A2();$2();P2();C2();I2();T2();E2();O2();j2();N2();R2();z2();I1();M2();D2();q2();B2();U2()});function O1(){return new E1}var L2,E1,vn,Bb=x(()=>{E1=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};delete n.id;let o={...n,...this._map.get(e)};return Object.keys(o).length?o:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};(L2=globalThis).__zod_globalRegistry??(L2.__zod_globalRegistry=O1());vn=globalThis.__zod_globalRegistry});function j1(t,e){return new t({type:"string",...H(e)})}function N1(t,e){return new t({type:"string",coerce:!0,...H(e)})}function Ub(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...H(e)})}function Jf(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...H(e)})}function Lb(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...H(e)})}function Fb(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...H(e)})}function Vb(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...H(e)})}function Hb(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...H(e)})}function Yf(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...H(e)})}function Gb(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...H(e)})}function Wb(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...H(e)})}function Zb(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...H(e)})}function Kb(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...H(e)})}function Jb(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...H(e)})}function Yb(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...H(e)})}function Qb(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...H(e)})}function Xb(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...H(e)})}function e_(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...H(e)})}function R1(t,e){return new t({type:"string",format:"mac",check:"string_format",abort:!1,...H(e)})}function t_(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...H(e)})}function r_(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...H(e)})}function n_(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...H(e)})}function o_(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...H(e)})}function i_(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...H(e)})}function s_(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...H(e)})}function z1(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...H(e)})}function M1(t,e){return new t({type:"string",format:"date",check:"string_format",...H(e)})}function D1(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...H(e)})}function q1(t,e){return new t({type:"string",format:"duration",check:"string_format",...H(e)})}function B1(t,e){return new t({type:"number",checks:[],...H(e)})}function U1(t,e){return new t({type:"number",coerce:!0,checks:[],...H(e)})}function L1(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...H(e)})}function F1(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float32",...H(e)})}function V1(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float64",...H(e)})}function H1(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"int32",...H(e)})}function G1(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"uint32",...H(e)})}function W1(t,e){return new t({type:"boolean",...H(e)})}function Z1(t,e){return new t({type:"boolean",coerce:!0,...H(e)})}function K1(t,e){return new t({type:"bigint",...H(e)})}function J1(t,e){return new t({type:"bigint",coerce:!0,...H(e)})}function Y1(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...H(e)})}function Q1(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...H(e)})}function X1(t,e){return new t({type:"symbol",...H(e)})}function eP(t,e){return new t({type:"undefined",...H(e)})}function tP(t,e){return new t({type:"null",...H(e)})}function rP(t){return new t({type:"any"})}function nP(t){return new t({type:"unknown"})}function oP(t,e){return new t({type:"never",...H(e)})}function iP(t,e){return new t({type:"void",...H(e)})}function sP(t,e){return new t({type:"date",...H(e)})}function aP(t,e){return new t({type:"date",coerce:!0,...H(e)})}function cP(t,e){return new t({type:"nan",...H(e)})}function Yi(t,e){return new f$({check:"less_than",...H(e),value:t,inclusive:!1})}function Hn(t,e){return new f$({check:"less_than",...H(e),value:t,inclusive:!0})}function Qi(t,e){return new m$({check:"greater_than",...H(e),value:t,inclusive:!1})}function an(t,e){return new m$({check:"greater_than",...H(e),value:t,inclusive:!0})}function lP(t){return Qi(0,t)}function uP(t){return Yi(0,t)}function dP(t){return Hn(0,t)}function pP(t){return an(0,t)}function Ya(t,e){return new gq({check:"multiple_of",...H(e),value:t})}function Au(t,e){return new bq({check:"max_size",...H(e),maximum:t})}function Qa(t,e){return new _q({check:"min_size",...H(e),minimum:t})}function Qf(t,e){return new wq({check:"size_equals",...H(e),size:t})}function $u(t,e){return new xq({check:"max_length",...H(e),maximum:t})}function Zs(t,e){return new Sq({check:"min_length",...H(e),minimum:t})}function Pu(t,e){return new kq({check:"length_equals",...H(e),length:t})}function Xf(t,e){return new Aq({check:"string_format",format:"regex",...H(e),pattern:t})}function em(t){return new $q({check:"string_format",format:"lowercase",...H(t)})}function tm(t){return new Pq({check:"string_format",format:"uppercase",...H(t)})}function rm(t,e){return new Cq({check:"string_format",format:"includes",...H(e),includes:t})}function nm(t,e){return new Iq({check:"string_format",format:"starts_with",...H(e),prefix:t})}function om(t,e){return new Tq({check:"string_format",format:"ends_with",...H(e),suffix:t})}function fP(t,e,r){return new Eq({check:"property",property:t,schema:e,...H(r)})}function im(t,e){return new Oq({check:"mime_type",mime:t,...H(e)})}function hi(t){return new jq({check:"overwrite",tx:t})}function sm(t){return hi(e=>e.normalize(t))}function am(){return hi(t=>t.trim())}function cm(){return hi(t=>t.toLowerCase())}function lm(){return hi(t=>t.toUpperCase())}function a_(){return hi(t=>TA(t))}function F2(t,e,r){return new t({type:"array",element:e,...H(r)})}function mP(t,e){return new t({type:"file",...H(e)})}function hP(t,e,r){let n=H(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function gP(t,e,r){return new t({type:"custom",check:"custom",fn:e,...H(r)})}function yP(t){let e=gQ(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(Su(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(Su(o))}},t(r.value,r)));return e}function gQ(t,e){let r=new _t({check:"custom",...H(e)});return r._zod.check=t,r}function vP(t){let e=new _t({check:"describe"});return e._zod.onattach=[r=>{let n=vn.get(r)??{};vn.add(r,{...n,description:t})}],e._zod.check=()=>{},e}function bP(t){let e=new _t({check:"meta"});return e._zod.onattach=[r=>{let n=vn.get(r)??{};vn.add(r,{...n,...t})}],e._zod.check=()=>{},e}function _P(t,e){let r=H(e),n=r.truthy??["true","1","yes","on","y","enabled"],o=r.falsy??["false","0","no","off","n","disabled"];r.case!=="sensitive"&&(n=n.map(f=>typeof f=="string"?f.toLowerCase():f),o=o.map(f=>typeof f=="string"?f.toLowerCase():f));let i=new Set(n),s=new Set(o),a=t.Codec??Kf,c=t.Boolean??Wf,l=t.String??Ja,u=new l({type:"string",error:r.error}),d=new c({type:"boolean",error:r.error}),p=new a({type:"pipe",in:u,out:d,transform:((f,m)=>{let h=f;return r.case!=="sensitive"&&(h=h.toLowerCase()),i.has(h)?!0:s.has(h)?!1:(m.issues.push({code:"invalid_value",expected:"stringbool",values:[...i,...s],input:m.value,inst:p,continue:!1}),{})}),reverseTransform:((f,m)=>f===!0?n[0]||"true":o[0]||"false"),error:r.error});return p}function Cu(t,e,r,n={}){let o=H(n),i={...H(n),check:"string_format",type:"string",format:e,fn:typeof r=="function"?r:a=>r.test(a),...o};return r instanceof RegExp&&(i.pattern=r),new t(i)}var V2=x(()=>{Ib();Bb();A1();le()});function c_(t){let e=t?.target??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:t?.metadata??vn,target:e,unrepresentable:t?.unrepresentable??"throw",override:t?.override??(()=>{}),io:t?.io??"output",counter:0,seen:new Map,cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0}}function Nt(t,e,r={path:[],schemaPath:[]}){var n;let o=t._zod.def,i=e.seen.get(t);if(i)return i.count++,r.schemaPath.includes(t)&&(i.cycle=r.path),i.schema;let s={schema:{},count:1,cycle:void 0,path:r.path};e.seen.set(t,s);let a=t._zod.toJSONSchema?.();if(a)s.schema=a;else{let u={...r,schemaPath:[...r.schemaPath,t],path:r.path},d=t._zod.parent;if(d)s.ref=d,Nt(d,e,u),e.seen.get(d).isParent=!0;else if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,s.schema,u);else{let p=s.schema,f=e.processors[o.type];if(!f)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${o.type}`);f(t,e,p,u)}}let c=e.metadataRegistry.get(t);return c&&Object.assign(s.schema,c),e.io==="input"&&cn(t)&&(delete s.schema.examples,delete s.schema.default),e.io==="input"&&s.schema._prefault&&((n=s.schema).default??(n.default=s.schema._prefault)),delete s.schema._prefault,e.seen.get(t).schema}function l_(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=i=>{let s=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){let u=t.external.registry.get(i[0])?.id,d=t.external.uri??(f=>f);if(u)return{ref:d(u)};let p=i[1].defId??i[1].schema.id??`schema${t.counter++}`;return i[1].defId=p,{defId:p,ref:`${d("__shared")}#/${s}/${p}`}}if(i[1]===r)return{ref:"#"};let c=`#/${s}/`,l=i[1].schema.id??`__schema${t.counter++}`;return{defId:l,ref:c+l}},o=i=>{if(i[1].schema.$ref)return;let s=i[1],{ref:a,defId:c}=n(i);s.def={...s.schema},c&&(s.defId=c);let l=s.schema;for(let u in l)delete l[u];l.$ref=a};if(t.cycles==="throw")for(let i of t.seen.entries()){let s=i[1];if(s.cycle)throw new Error(`Cycle detected: #/${s.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let i of t.seen.entries()){let s=i[1];if(e===i[0]){o(i);continue}if(t.external){let c=t.external.registry.get(i[0])?.id;if(e!==i[0]&&c){o(i);continue}}if(t.metadataRegistry.get(i[0])?.id){o(i);continue}if(s.cycle){o(i);continue}if(s.count>1&&t.reused==="ref"){o(i);continue}}}function u_(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=s=>{let a=t.seen.get(s),c=a.def??a.schema,l={...c};if(a.ref===null)return;let u=a.ref;if(a.ref=null,u){n(u);let d=t.seen.get(u).schema;d.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(d)):(Object.assign(c,d),Object.assign(c,l))}a.isParent||t.override({zodSchema:s,jsonSchema:c,path:a.path??[]})};for(let s of[...t.seen.entries()].reverse())n(s[0]);let o={};if(t.target==="draft-2020-12"?o.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?o.$schema="http://json-schema.org/draft-04/schema#":t.target,t.external?.uri){let s=t.external.registry.get(e)?.id;if(!s)throw new Error("Schema is missing an `id` property");o.$id=t.external.uri(s)}Object.assign(o,r.def??r.schema);let i=t.external?.defs??{};for(let s of t.seen.entries()){let a=s[1];a.def&&a.defId&&(i[a.defId]=a.def)}t.external||Object.keys(i).length>0&&(t.target==="draft-2020-12"?o.$defs=i:o.definitions=i);try{let s=JSON.parse(JSON.stringify(o));return Object.defineProperty(s,"~standard",{value:{...e["~standard"],jsonSchema:{input:um(e,"input"),output:um(e,"output")}},enumerable:!1,writable:!1}),s}catch{throw new Error("Error converting schema to JSON.")}}function cn(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let n=t._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return cn(n.element,r);if(n.type==="set")return cn(n.valueType,r);if(n.type==="lazy")return cn(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return cn(n.innerType,r);if(n.type==="intersection")return cn(n.left,r)||cn(n.right,r);if(n.type==="record"||n.type==="map")return cn(n.keyType,r)||cn(n.valueType,r);if(n.type==="pipe")return cn(n.in,r)||cn(n.out,r);if(n.type==="object"){for(let o in n.shape)if(cn(n.shape[o],r))return!0;return!1}if(n.type==="union"){for(let o of n.options)if(cn(o,r))return!0;return!1}if(n.type==="tuple"){for(let o of n.items)if(cn(o,r))return!0;return!!(n.rest&&cn(n.rest,r))}return!1}var H2,um,dm=x(()=>{Bb();H2=(t,e={})=>r=>{let n=c_({...r,processors:e});return Nt(t,n),l_(n,t),u_(n,t)},um=(t,e)=>r=>{let{libraryOptions:n,target:o}=r??{},i=c_({...n??{},target:o,io:e,processors:{}});return Nt(t,i),l_(i,t),u_(i,t)}});var yQ,G2,W2,Z2,K2,J2,Y2,Q2,X2,e4,t4,r4,n4,o4,i4,s4,a4,c4,l4,u4,d4,p4,f4,m4,h4,g4,wP,y4,v4,b4,_4,w4,x4,S4,k4,A4,$4,P4,C4,I4,Iu=x(()=>{dm();le();yQ={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},G2=(t,e,r,n)=>{let o=r;o.type="string";let{minimum:i,maximum:s,format:a,patterns:c,contentEncoding:l}=t._zod.bag;if(typeof i=="number"&&(o.minLength=i),typeof s=="number"&&(o.maxLength=s),a&&(o.format=yQ[a]??a,o.format===""&&delete o.format),l&&(o.contentEncoding=l),c&&c.size>0){let u=[...c];u.length===1?o.pattern=u[0].source:u.length>1&&(o.allOf=[...u.map(d=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:d.source}))])}},W2=(t,e,r,n)=>{let o=r,{minimum:i,maximum:s,format:a,multipleOf:c,exclusiveMaximum:l,exclusiveMinimum:u}=t._zod.bag;typeof a=="string"&&a.includes("int")?o.type="integer":o.type="number",typeof u=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.minimum=u,o.exclusiveMinimum=!0):o.exclusiveMinimum=u),typeof i=="number"&&(o.minimum=i,typeof u=="number"&&e.target!=="draft-04"&&(u>=i?delete o.minimum:delete o.exclusiveMinimum)),typeof l=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.maximum=l,o.exclusiveMaximum=!0):o.exclusiveMaximum=l),typeof s=="number"&&(o.maximum=s,typeof l=="number"&&e.target!=="draft-04"&&(l<=s?delete o.maximum:delete o.exclusiveMaximum)),typeof c=="number"&&(o.multipleOf=c)},Z2=(t,e,r,n)=>{r.type="boolean"},K2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},J2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},Y2=(t,e,r,n)=>{e.target==="openapi-3.0"?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"},Q2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},X2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},e4=(t,e,r,n)=>{r.not={}},t4=(t,e,r,n)=>{},r4=(t,e,r,n)=>{},n4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},o4=(t,e,r,n)=>{let o=t._zod.def,i=Ef(o.entries);i.every(s=>typeof s=="number")&&(r.type="number"),i.every(s=>typeof s=="string")&&(r.type="string"),r.enum=i},i4=(t,e,r,n)=>{let o=t._zod.def,i=[];for(let s of o.values)if(s===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof s=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");i.push(Number(s))}else i.push(s);if(i.length!==0)if(i.length===1){let s=i[0];r.type=s===null?"null":typeof s,e.target==="draft-04"||e.target==="openapi-3.0"?r.enum=[s]:r.const=s}else i.every(s=>typeof s=="number")&&(r.type="number"),i.every(s=>typeof s=="string")&&(r.type="string"),i.every(s=>typeof s=="boolean")&&(r.type="boolean"),i.every(s=>s===null)&&(r.type="null"),r.enum=i},s4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},a4=(t,e,r,n)=>{let o=r,i=t._zod.pattern;if(!i)throw new Error("Pattern not found in template literal");o.type="string",o.pattern=i.source},c4=(t,e,r,n)=>{let o=r,i={type:"string",format:"binary",contentEncoding:"binary"},{minimum:s,maximum:a,mime:c}=t._zod.bag;s!==void 0&&(i.minLength=s),a!==void 0&&(i.maxLength=a),c?c.length===1?(i.contentMediaType=c[0],Object.assign(o,i)):o.anyOf=c.map(l=>({...i,contentMediaType:l})):Object.assign(o,i)},l4=(t,e,r,n)=>{r.type="boolean"},u4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},d4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},p4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},f4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},m4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},h4=(t,e,r,n)=>{let o=r,i=t._zod.def,{minimum:s,maximum:a}=t._zod.bag;typeof s=="number"&&(o.minItems=s),typeof a=="number"&&(o.maxItems=a),o.type="array",o.items=Nt(i.element,e,{...n,path:[...n.path,"items"]})},g4=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="object",o.properties={};let s=i.shape;for(let l in s)o.properties[l]=Nt(s[l],e,{...n,path:[...n.path,"properties",l]});let a=new Set(Object.keys(s)),c=new Set([...a].filter(l=>{let u=i.shape[l]._zod;return e.io==="input"?u.optin===void 0:u.optout===void 0}));c.size>0&&(o.required=Array.from(c)),i.catchall?._zod.def.type==="never"?o.additionalProperties=!1:i.catchall?i.catchall&&(o.additionalProperties=Nt(i.catchall,e,{...n,path:[...n.path,"additionalProperties"]})):e.io==="output"&&(o.additionalProperties=!1)},wP=(t,e,r,n)=>{let o=t._zod.def,i=o.inclusive===!1,s=o.options.map((a,c)=>Nt(a,e,{...n,path:[...n.path,i?"oneOf":"anyOf",c]}));i?r.oneOf=s:r.anyOf=s},y4=(t,e,r,n)=>{let o=t._zod.def,i=Nt(o.left,e,{...n,path:[...n.path,"allOf",0]}),s=Nt(o.right,e,{...n,path:[...n.path,"allOf",1]}),a=l=>"allOf"in l&&Object.keys(l).length===1,c=[...a(i)?i.allOf:[i],...a(s)?s.allOf:[s]];r.allOf=c},v4=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="array";let s=e.target==="draft-2020-12"?"prefixItems":"items",a=e.target==="draft-2020-12"||e.target==="openapi-3.0"?"items":"additionalItems",c=i.items.map((p,f)=>Nt(p,e,{...n,path:[...n.path,s,f]})),l=i.rest?Nt(i.rest,e,{...n,path:[...n.path,a,...e.target==="openapi-3.0"?[i.items.length]:[]]}):null;e.target==="draft-2020-12"?(o.prefixItems=c,l&&(o.items=l)):e.target==="openapi-3.0"?(o.items={anyOf:c},l&&o.items.anyOf.push(l),o.minItems=c.length,l||(o.maxItems=c.length)):(o.items=c,l&&(o.additionalItems=l));let{minimum:u,maximum:d}=t._zod.bag;typeof u=="number"&&(o.minItems=u),typeof d=="number"&&(o.maxItems=d)},b4=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="object",(e.target==="draft-07"||e.target==="draft-2020-12")&&(o.propertyNames=Nt(i.keyType,e,{...n,path:[...n.path,"propertyNames"]})),o.additionalProperties=Nt(i.valueType,e,{...n,path:[...n.path,"additionalProperties"]})},_4=(t,e,r,n)=>{let o=t._zod.def,i=Nt(o.innerType,e,n),s=e.seen.get(t);e.target==="openapi-3.0"?(s.ref=o.innerType,r.nullable=!0):r.anyOf=[i,{type:"null"}]},w4=(t,e,r,n)=>{let o=t._zod.def;Nt(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},x4=(t,e,r,n)=>{let o=t._zod.def;Nt(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,r.default=JSON.parse(JSON.stringify(o.defaultValue))},S4=(t,e,r,n)=>{let o=t._zod.def;Nt(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,e.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(o.defaultValue)))},k4=(t,e,r,n)=>{let o=t._zod.def;Nt(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType;let s;try{s=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=s},A4=(t,e,r,n)=>{let o=t._zod.def,i=e.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;Nt(i,e,n);let s=e.seen.get(t);s.ref=i},$4=(t,e,r,n)=>{let o=t._zod.def;Nt(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,r.readOnly=!0},P4=(t,e,r,n)=>{let o=t._zod.def;Nt(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},C4=(t,e,r,n)=>{let o=t._zod.def;Nt(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},I4=(t,e,r,n)=>{let o=t._zod.innerType;Nt(o,e,n);let i=e.seen.get(t);i.ref=o}});var T4=x(()=>{Iu();dm()});var E4=x(()=>{});var Qt=x(()=>{_u();MA();zA();A1();Ib();g$();le();Cb();qb();Bb();h$();V2();dm();Iu();T4();E4()});var SP=x(()=>{Qt()});var d_=x(()=>{Qt();Qt();SP()});var j4=x(()=>{Qt()});var kP=x(()=>{Qt();d_()});var N4=x(()=>{Qt();d_()});var AP=x(()=>{Qt();SP();d_();j4();Qt();Iu();qb();kP();kP();N4()});var z4=x(()=>{AP();AP()});var $P=x(()=>{z4()});function Tu(t){return!!t._zod}function zo(t,e){return Tu(t)?ku(t,e):t.safeParse(e)}function p_(t){if(!t)return;let e;if(Tu(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function D4(t){if(Tu(t)){let i=t._zod?.def;if(i){if(i.value!==void 0)return i.value;if(Array.isArray(i.values)&&i.values.length>0)return i.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var f_=x(()=>{If();$P()});var m_={};ve(m_,{endsWith:()=>om,gt:()=>Qi,gte:()=>an,includes:()=>rm,length:()=>Pu,lowercase:()=>em,lt:()=>Yi,lte:()=>Hn,maxLength:()=>$u,maxSize:()=>Au,mime:()=>im,minLength:()=>Zs,minSize:()=>Qa,multipleOf:()=>Ya,negative:()=>uP,nonnegative:()=>pP,nonpositive:()=>dP,normalize:()=>sm,overwrite:()=>hi,positive:()=>lP,property:()=>fP,regex:()=>Xf,size:()=>Qf,slugify:()=>a_,startsWith:()=>nm,toLowerCase:()=>cm,toUpperCase:()=>lm,trim:()=>am,uppercase:()=>tm});var h_=x(()=>{Qt()});var Xa={};ve(Xa,{ZodISODate:()=>IP,ZodISODateTime:()=>PP,ZodISODuration:()=>jP,ZodISOTime:()=>EP,date:()=>TP,datetime:()=>CP,duration:()=>NP,time:()=>OP});function CP(t){return z1(PP,t)}function TP(t){return M1(IP,t)}function OP(t){return D1(EP,t)}function NP(t){return q1(jP,t)}var PP,IP,EP,jP,pm=x(()=>{Qt();mm();PP=k("ZodISODateTime",(t,e)=>{I$.init(t,e),wt.init(t,e)});IP=k("ZodISODate",(t,e)=>{T$.init(t,e),wt.init(t,e)});EP=k("ZodISOTime",(t,e)=>{E$.init(t,e),wt.init(t,e)});jP=k("ZodISODuration",(t,e)=>{O$.init(t,e),wt.init(t,e)})});var q4,Cke,Gn,RP=x(()=>{Qt();Qt();le();q4=(t,e)=>{kb.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>$b(t,r)},flatten:{value:r=>Ab(t,r)},addIssue:{value:r=>{t.issues.push(r),t.message=JSON.stringify(t.issues,wu,2)}},addIssues:{value:r=>{t.issues.push(...r),t.message=JSON.stringify(t.issues,wu,2)}},isEmpty:{get(){return t.issues.length===0}}})},Cke=k("ZodError",q4),Gn=k("ZodError",q4,{Parent:Error})});var B4,U4,L4,F4,V4,H4,G4,W4,Z4,K4,J4,Y4,zP=x(()=>{Qt();RP();B4=Mf(Gn),U4=qf(Gn),L4=Uf(Gn),F4=Lf(Gn),V4=nq(Gn),H4=oq(Gn),G4=iq(Gn),W4=sq(Gn),Z4=aq(Gn),K4=cq(Gn),J4=lq(Gn),Y4=uq(Gn)});var fm={};ve(fm,{ZodAny:()=>rB,ZodArray:()=>sB,ZodBase64:()=>QP,ZodBase64URL:()=>XP,ZodBigInt:()=>_m,ZodBigIntFormat:()=>rC,ZodBoolean:()=>bm,ZodCIDRv4:()=>JP,ZodCIDRv6:()=>YP,ZodCUID:()=>FP,ZodCUID2:()=>VP,ZodCatch:()=>kB,ZodCodec:()=>lC,ZodCustom:()=>A_,ZodCustomStringFormat:()=>ym,ZodDate:()=>__,ZodDefault:()=>vB,ZodDiscriminatedUnion:()=>cB,ZodE164:()=>eC,ZodEmail:()=>qP,ZodEmoji:()=>UP,ZodEnum:()=>hm,ZodFile:()=>hB,ZodFunction:()=>jB,ZodGUID:()=>g_,ZodIPv4:()=>ZP,ZodIPv6:()=>KP,ZodIntersection:()=>lB,ZodJWT:()=>tC,ZodKSUID:()=>WP,ZodLazy:()=>TB,ZodLiteral:()=>mB,ZodMAC:()=>Q4,ZodMap:()=>pB,ZodNaN:()=>$B,ZodNanoID:()=>LP,ZodNever:()=>oB,ZodNonOptional:()=>aC,ZodNull:()=>tB,ZodNullable:()=>yB,ZodNumber:()=>vm,ZodNumberFormat:()=>Eu,ZodObject:()=>w_,ZodOptional:()=>sC,ZodPipe:()=>cC,ZodPrefault:()=>_B,ZodPromise:()=>OB,ZodReadonly:()=>PB,ZodRecord:()=>k_,ZodSet:()=>fB,ZodString:()=>gm,ZodStringFormat:()=>wt,ZodSuccess:()=>SB,ZodSymbol:()=>X4,ZodTemplateLiteral:()=>IB,ZodTransform:()=>gB,ZodTuple:()=>uB,ZodType:()=>je,ZodULID:()=>HP,ZodURL:()=>b_,ZodUUID:()=>Xi,ZodUndefined:()=>eB,ZodUnion:()=>x_,ZodUnknown:()=>nB,ZodVoid:()=>iB,ZodXID:()=>GP,ZodXor:()=>aB,_ZodString:()=>DP,_default:()=>bB,_function:()=>CX,any:()=>nC,array:()=>V,base64:()=>ZQ,base64url:()=>KQ,bigint:()=>sX,boolean:()=>pt,catch:()=>AB,check:()=>IX,cidrv4:()=>GQ,cidrv6:()=>WQ,codec:()=>AX,cuid:()=>DQ,cuid2:()=>qQ,custom:()=>uC,date:()=>pX,describe:()=>TX,discriminatedUnion:()=>S_,e164:()=>JQ,email:()=>IQ,emoji:()=>zQ,enum:()=>Hr,file:()=>wX,float32:()=>rX,float64:()=>nX,function:()=>CX,guid:()=>TQ,hash:()=>tX,hex:()=>eX,hostname:()=>XQ,httpUrl:()=>RQ,instanceof:()=>OX,int:()=>MP,int32:()=>oX,int64:()=>aX,intersection:()=>xm,ipv4:()=>FQ,ipv6:()=>HQ,json:()=>NX,jwt:()=>YQ,keyof:()=>fX,ksuid:()=>LQ,lazy:()=>EB,literal:()=>oe,looseObject:()=>pr,looseRecord:()=>yX,mac:()=>VQ,map:()=>vX,meta:()=>EX,nan:()=>kX,nanoid:()=>MQ,nativeEnum:()=>_X,never:()=>oC,nonoptional:()=>xB,null:()=>wm,nullable:()=>y_,nullish:()=>xX,number:()=>Qe,object:()=>G,optional:()=>Rt,partialRecord:()=>gX,pipe:()=>v_,prefault:()=>wB,preprocess:()=>$_,promise:()=>PX,readonly:()=>CB,record:()=>Tt,refine:()=>NB,set:()=>bX,strictObject:()=>mX,string:()=>_,stringFormat:()=>QQ,stringbool:()=>jX,success:()=>SX,superRefine:()=>RB,symbol:()=>lX,templateLiteral:()=>$X,transform:()=>iC,tuple:()=>dB,uint32:()=>iX,uint64:()=>cX,ulid:()=>BQ,undefined:()=>uX,union:()=>gt,unknown:()=>xt,url:()=>BP,uuid:()=>EQ,uuidv4:()=>OQ,uuidv6:()=>jQ,uuidv7:()=>NQ,void:()=>dX,xid:()=>UQ,xor:()=>hX});function _(t){return j1(gm,t)}function IQ(t){return Ub(qP,t)}function TQ(t){return Jf(g_,t)}function EQ(t){return Lb(Xi,t)}function OQ(t){return Fb(Xi,t)}function jQ(t){return Vb(Xi,t)}function NQ(t){return Hb(Xi,t)}function BP(t){return Yf(b_,t)}function RQ(t){return Yf(b_,{protocol:/^https?$/,hostname:oo.domain,...B.normalizeParams(t)})}function zQ(t){return Gb(UP,t)}function MQ(t){return Wb(LP,t)}function DQ(t){return Zb(FP,t)}function qQ(t){return Kb(VP,t)}function BQ(t){return Jb(HP,t)}function UQ(t){return Yb(GP,t)}function LQ(t){return Qb(WP,t)}function FQ(t){return Xb(ZP,t)}function VQ(t){return R1(Q4,t)}function HQ(t){return e_(KP,t)}function GQ(t){return t_(JP,t)}function WQ(t){return r_(YP,t)}function ZQ(t){return n_(QP,t)}function KQ(t){return o_(XP,t)}function JQ(t){return i_(eC,t)}function YQ(t){return s_(tC,t)}function QQ(t,e,r={}){return Cu(ym,t,e,r)}function XQ(t){return Cu(ym,"hostname",oo.hostname,t)}function eX(t){return Cu(ym,"hex",oo.hex,t)}function tX(t,e){let r=e?.enc??"hex",n=`${t}_${r}`,o=oo[n];if(!o)throw new Error(`Unrecognized hash format: ${n}`);return Cu(ym,n,o,e)}function Qe(t){return B1(vm,t)}function MP(t){return L1(Eu,t)}function rX(t){return F1(Eu,t)}function nX(t){return V1(Eu,t)}function oX(t){return H1(Eu,t)}function iX(t){return G1(Eu,t)}function pt(t){return W1(bm,t)}function sX(t){return K1(_m,t)}function aX(t){return Y1(rC,t)}function cX(t){return Q1(rC,t)}function lX(t){return X1(X4,t)}function uX(t){return eP(eB,t)}function wm(t){return tP(tB,t)}function nC(){return rP(rB)}function xt(){return nP(nB)}function oC(t){return oP(oB,t)}function dX(t){return iP(iB,t)}function pX(t){return sP(__,t)}function V(t,e){return F2(sB,t,e)}function fX(t){let e=t._zod.def.shape;return Hr(Object.keys(e))}function G(t,e){let r={type:"object",shape:t??{},...B.normalizeParams(e)};return new w_(r)}function mX(t,e){return new w_({type:"object",shape:t,catchall:oC(),...B.normalizeParams(e)})}function pr(t,e){return new w_({type:"object",shape:t,catchall:xt(),...B.normalizeParams(e)})}function gt(t,e){return new x_({type:"union",options:t,...B.normalizeParams(e)})}function hX(t,e){return new aB({type:"union",options:t,inclusive:!1,...B.normalizeParams(e)})}function S_(t,e,r){return new cB({type:"union",options:e,discriminator:t,...B.normalizeParams(r)})}function xm(t,e){return new lB({type:"intersection",left:t,right:e})}function dB(t,e,r){let n=e instanceof Ae,o=n?r:e,i=n?e:null;return new uB({type:"tuple",items:t,rest:i,...B.normalizeParams(o)})}function Tt(t,e,r){return new k_({type:"record",keyType:t,valueType:e,...B.normalizeParams(r)})}function gX(t,e,r){let n=sn(t);return n._zod.values=void 0,new k_({type:"record",keyType:n,valueType:e,...B.normalizeParams(r)})}function yX(t,e,r){return new k_({type:"record",keyType:t,valueType:e,mode:"loose",...B.normalizeParams(r)})}function vX(t,e,r){return new pB({type:"map",keyType:t,valueType:e,...B.normalizeParams(r)})}function bX(t,e){return new fB({type:"set",valueType:t,...B.normalizeParams(e)})}function Hr(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new hm({type:"enum",entries:r,...B.normalizeParams(e)})}function _X(t,e){return new hm({type:"enum",entries:t,...B.normalizeParams(e)})}function oe(t,e){return new mB({type:"literal",values:Array.isArray(t)?t:[t],...B.normalizeParams(e)})}function wX(t){return mP(hB,t)}function iC(t){return new gB({type:"transform",transform:t})}function Rt(t){return new sC({type:"optional",innerType:t})}function y_(t){return new yB({type:"nullable",innerType:t})}function xX(t){return Rt(y_(t))}function bB(t,e){return new vB({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():B.shallowClone(e)}})}function wB(t,e){return new _B({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():B.shallowClone(e)}})}function xB(t,e){return new aC({type:"nonoptional",innerType:t,...B.normalizeParams(e)})}function SX(t){return new SB({type:"success",innerType:t})}function AB(t,e){return new kB({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}function kX(t){return cP($B,t)}function v_(t,e){return new cC({type:"pipe",in:t,out:e})}function AX(t,e,r){return new lC({type:"pipe",in:t,out:e,transform:r.decode,reverseTransform:r.encode})}function CB(t){return new PB({type:"readonly",innerType:t})}function $X(t,e){return new IB({type:"template_literal",parts:t,...B.normalizeParams(e)})}function EB(t){return new TB({type:"lazy",getter:t})}function PX(t){return new OB({type:"promise",innerType:t})}function CX(t){return new jB({type:"function",input:Array.isArray(t?.input)?dB(t?.input):t?.input??V(xt()),output:t?.output??xt()})}function IX(t){let e=new _t({check:"custom"});return e._zod.check=t,e}function uC(t,e){return hP(A_,t??(()=>!0),e)}function NB(t,e={}){return gP(A_,t,e)}function RB(t){return yP(t)}function OX(t,e={error:`Input not instance of ${t.name}`}){let r=new A_({type:"custom",check:"custom",fn:n=>n instanceof t,abort:!0,...B.normalizeParams(e)});return r._zod.bag.Class=t,r}function NX(t){let e=EB(()=>gt([_(t),Qe(),pt(),wm(),V(e),Tt(_(),e)]));return e}function $_(t,e){return v_(iC(t),e)}var je,DP,gm,wt,qP,g_,Xi,b_,UP,LP,FP,VP,HP,GP,WP,ZP,Q4,KP,JP,YP,QP,XP,eC,tC,ym,vm,Eu,bm,_m,rC,X4,eB,tB,rB,nB,oB,iB,__,sB,w_,x_,aB,cB,lB,uB,k_,pB,fB,hm,mB,hB,gB,sC,yB,vB,_B,aC,SB,kB,$B,cC,lC,PB,IB,TB,OB,jB,A_,TX,EX,jX,mm=x(()=>{Qt();Qt();Iu();dm();h_();pm();zP();je=k("ZodType",(t,e)=>(Ae.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:um(t,"input"),output:um(t,"output")}}),t.toJSONSchema=H2(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone(B.mergeDefs(e,{checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),t.clone=(r,n)=>sn(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t)),t.parse=(r,n)=>B4(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>L4(t,r,n),t.parseAsync=async(r,n)=>U4(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>F4(t,r,n),t.spa=t.safeParseAsync,t.encode=(r,n)=>V4(t,r,n),t.decode=(r,n)=>H4(t,r,n),t.encodeAsync=async(r,n)=>G4(t,r,n),t.decodeAsync=async(r,n)=>W4(t,r,n),t.safeEncode=(r,n)=>Z4(t,r,n),t.safeDecode=(r,n)=>K4(t,r,n),t.safeEncodeAsync=async(r,n)=>J4(t,r,n),t.safeDecodeAsync=async(r,n)=>Y4(t,r,n),t.refine=(r,n)=>t.check(NB(r,n)),t.superRefine=r=>t.check(RB(r)),t.overwrite=r=>t.check(hi(r)),t.optional=()=>Rt(t),t.nullable=()=>y_(t),t.nullish=()=>Rt(y_(t)),t.nonoptional=r=>xB(t,r),t.array=()=>V(t),t.or=r=>gt([t,r]),t.and=r=>xm(t,r),t.transform=r=>v_(t,iC(r)),t.default=r=>bB(t,r),t.prefault=r=>wB(t,r),t.catch=r=>AB(t,r),t.pipe=r=>v_(t,r),t.readonly=()=>CB(t),t.describe=r=>{let n=t.clone();return vn.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return vn.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return vn.get(t);let n=t.clone();return vn.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),DP=k("_ZodString",(t,e)=>{Ja.init(t,e),je.init(t,e),t._zod.processJSONSchema=(n,o,i)=>G2(t,n,o,i);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(Xf(...n)),t.includes=(...n)=>t.check(rm(...n)),t.startsWith=(...n)=>t.check(nm(...n)),t.endsWith=(...n)=>t.check(om(...n)),t.min=(...n)=>t.check(Zs(...n)),t.max=(...n)=>t.check($u(...n)),t.length=(...n)=>t.check(Pu(...n)),t.nonempty=(...n)=>t.check(Zs(1,...n)),t.lowercase=n=>t.check(em(n)),t.uppercase=n=>t.check(tm(n)),t.trim=()=>t.check(am()),t.normalize=(...n)=>t.check(sm(...n)),t.toLowerCase=()=>t.check(cm()),t.toUpperCase=()=>t.check(lm()),t.slugify=()=>t.check(a_())}),gm=k("ZodString",(t,e)=>{Ja.init(t,e),DP.init(t,e),t.email=r=>t.check(Ub(qP,r)),t.url=r=>t.check(Yf(b_,r)),t.jwt=r=>t.check(s_(tC,r)),t.emoji=r=>t.check(Gb(UP,r)),t.guid=r=>t.check(Jf(g_,r)),t.uuid=r=>t.check(Lb(Xi,r)),t.uuidv4=r=>t.check(Fb(Xi,r)),t.uuidv6=r=>t.check(Vb(Xi,r)),t.uuidv7=r=>t.check(Hb(Xi,r)),t.nanoid=r=>t.check(Wb(LP,r)),t.guid=r=>t.check(Jf(g_,r)),t.cuid=r=>t.check(Zb(FP,r)),t.cuid2=r=>t.check(Kb(VP,r)),t.ulid=r=>t.check(Jb(HP,r)),t.base64=r=>t.check(n_(QP,r)),t.base64url=r=>t.check(o_(XP,r)),t.xid=r=>t.check(Yb(GP,r)),t.ksuid=r=>t.check(Qb(WP,r)),t.ipv4=r=>t.check(Xb(ZP,r)),t.ipv6=r=>t.check(e_(KP,r)),t.cidrv4=r=>t.check(t_(JP,r)),t.cidrv6=r=>t.check(r_(YP,r)),t.e164=r=>t.check(i_(eC,r)),t.datetime=r=>t.check(CP(r)),t.date=r=>t.check(TP(r)),t.time=r=>t.check(OP(r)),t.duration=r=>t.check(NP(r))});wt=k("ZodStringFormat",(t,e)=>{ht.init(t,e),DP.init(t,e)}),qP=k("ZodEmail",(t,e)=>{_$.init(t,e),wt.init(t,e)});g_=k("ZodGUID",(t,e)=>{v$.init(t,e),wt.init(t,e)});Xi=k("ZodUUID",(t,e)=>{b$.init(t,e),wt.init(t,e)});b_=k("ZodURL",(t,e)=>{w$.init(t,e),wt.init(t,e)});UP=k("ZodEmoji",(t,e)=>{x$.init(t,e),wt.init(t,e)});LP=k("ZodNanoID",(t,e)=>{S$.init(t,e),wt.init(t,e)});FP=k("ZodCUID",(t,e)=>{k$.init(t,e),wt.init(t,e)});VP=k("ZodCUID2",(t,e)=>{A$.init(t,e),wt.init(t,e)});HP=k("ZodULID",(t,e)=>{$$.init(t,e),wt.init(t,e)});GP=k("ZodXID",(t,e)=>{P$.init(t,e),wt.init(t,e)});WP=k("ZodKSUID",(t,e)=>{C$.init(t,e),wt.init(t,e)});ZP=k("ZodIPv4",(t,e)=>{j$.init(t,e),wt.init(t,e)});Q4=k("ZodMAC",(t,e)=>{R$.init(t,e),wt.init(t,e)});KP=k("ZodIPv6",(t,e)=>{N$.init(t,e),wt.init(t,e)});JP=k("ZodCIDRv4",(t,e)=>{z$.init(t,e),wt.init(t,e)});YP=k("ZodCIDRv6",(t,e)=>{M$.init(t,e),wt.init(t,e)});QP=k("ZodBase64",(t,e)=>{D$.init(t,e),wt.init(t,e)});XP=k("ZodBase64URL",(t,e)=>{q$.init(t,e),wt.init(t,e)});eC=k("ZodE164",(t,e)=>{B$.init(t,e),wt.init(t,e)});tC=k("ZodJWT",(t,e)=>{U$.init(t,e),wt.init(t,e)});ym=k("ZodCustomStringFormat",(t,e)=>{L$.init(t,e),wt.init(t,e)});vm=k("ZodNumber",(t,e)=>{zb.init(t,e),je.init(t,e),t._zod.processJSONSchema=(n,o,i)=>W2(t,n,o,i),t.gt=(n,o)=>t.check(Qi(n,o)),t.gte=(n,o)=>t.check(an(n,o)),t.min=(n,o)=>t.check(an(n,o)),t.lt=(n,o)=>t.check(Yi(n,o)),t.lte=(n,o)=>t.check(Hn(n,o)),t.max=(n,o)=>t.check(Hn(n,o)),t.int=n=>t.check(MP(n)),t.safe=n=>t.check(MP(n)),t.positive=n=>t.check(Qi(0,n)),t.nonnegative=n=>t.check(an(0,n)),t.negative=n=>t.check(Yi(0,n)),t.nonpositive=n=>t.check(Hn(0,n)),t.multipleOf=(n,o)=>t.check(Ya(n,o)),t.step=(n,o)=>t.check(Ya(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});Eu=k("ZodNumberFormat",(t,e)=>{F$.init(t,e),vm.init(t,e)});bm=k("ZodBoolean",(t,e)=>{Wf.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Z2(t,r,n,o)});_m=k("ZodBigInt",(t,e)=>{Mb.init(t,e),je.init(t,e),t._zod.processJSONSchema=(n,o,i)=>K2(t,n,o,i),t.gte=(n,o)=>t.check(an(n,o)),t.min=(n,o)=>t.check(an(n,o)),t.gt=(n,o)=>t.check(Qi(n,o)),t.gte=(n,o)=>t.check(an(n,o)),t.min=(n,o)=>t.check(an(n,o)),t.lt=(n,o)=>t.check(Yi(n,o)),t.lte=(n,o)=>t.check(Hn(n,o)),t.max=(n,o)=>t.check(Hn(n,o)),t.positive=n=>t.check(Qi(BigInt(0),n)),t.negative=n=>t.check(Yi(BigInt(0),n)),t.nonpositive=n=>t.check(Hn(BigInt(0),n)),t.nonnegative=n=>t.check(an(BigInt(0),n)),t.multipleOf=(n,o)=>t.check(Ya(n,o));let r=t._zod.bag;t.minValue=r.minimum??null,t.maxValue=r.maximum??null,t.format=r.format??null});rC=k("ZodBigIntFormat",(t,e)=>{V$.init(t,e),_m.init(t,e)});X4=k("ZodSymbol",(t,e)=>{H$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>J2(t,r,n,o)});eB=k("ZodUndefined",(t,e)=>{G$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Q2(t,r,n,o)});tB=k("ZodNull",(t,e)=>{W$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Y2(t,r,n,o)});rB=k("ZodAny",(t,e)=>{Z$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>t4(t,r,n,o)});nB=k("ZodUnknown",(t,e)=>{K$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>r4(t,r,n,o)});oB=k("ZodNever",(t,e)=>{J$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>e4(t,r,n,o)});iB=k("ZodVoid",(t,e)=>{Y$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>X2(t,r,n,o)});__=k("ZodDate",(t,e)=>{Q$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(n,o,i)=>n4(t,n,o,i),t.min=(n,o)=>t.check(an(n,o)),t.max=(n,o)=>t.check(Hn(n,o));let r=t._zod.bag;t.minDate=r.minimum?new Date(r.minimum):null,t.maxDate=r.maximum?new Date(r.maximum):null});sB=k("ZodArray",(t,e)=>{X$.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>h4(t,r,n,o),t.element=e.element,t.min=(r,n)=>t.check(Zs(r,n)),t.nonempty=r=>t.check(Zs(1,r)),t.max=(r,n)=>t.check($u(r,n)),t.length=(r,n)=>t.check(Pu(r,n)),t.unwrap=()=>t.element});w_=k("ZodObject",(t,e)=>{Yq.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>g4(t,r,n,o),B.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>Hr(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:xt()}),t.loose=()=>t.clone({...t._zod.def,catchall:xt()}),t.strict=()=>t.clone({...t._zod.def,catchall:oC()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>B.extend(t,r),t.safeExtend=r=>B.safeExtend(t,r),t.merge=r=>B.merge(t,r),t.pick=r=>B.pick(t,r),t.omit=r=>B.omit(t,r),t.partial=(...r)=>B.partial(sC,t,r[0]),t.required=(...r)=>B.required(aC,t,r[0])});x_=k("ZodUnion",(t,e)=>{Zf.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>wP(t,r,n,o),t.options=e.options});aB=k("ZodXor",(t,e)=>{x_.init(t,e),e1.init(t,e),t._zod.processJSONSchema=(r,n,o)=>wP(t,r,n,o),t.options=e.options});cB=k("ZodDiscriminatedUnion",(t,e)=>{x_.init(t,e),t1.init(t,e)});lB=k("ZodIntersection",(t,e)=>{r1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>y4(t,r,n,o)});uB=k("ZodTuple",(t,e)=>{Db.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>v4(t,r,n,o),t.rest=r=>t.clone({...t._zod.def,rest:r})});k_=k("ZodRecord",(t,e)=>{n1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>b4(t,r,n,o),t.keyType=e.keyType,t.valueType=e.valueType});pB=k("ZodMap",(t,e)=>{o1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>f4(t,r,n,o),t.keyType=e.keyType,t.valueType=e.valueType});fB=k("ZodSet",(t,e)=>{i1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>m4(t,r,n,o),t.min=(...r)=>t.check(Qa(...r)),t.nonempty=r=>t.check(Qa(1,r)),t.max=(...r)=>t.check(Au(...r)),t.size=(...r)=>t.check(Qf(...r))});hm=k("ZodEnum",(t,e)=>{s1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(n,o,i)=>o4(t,n,o,i),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let i={};for(let s of n)if(r.has(s))i[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new hm({...e,checks:[],...B.normalizeParams(o),entries:i})},t.exclude=(n,o)=>{let i={...e.entries};for(let s of n)if(r.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new hm({...e,checks:[],...B.normalizeParams(o),entries:i})}});mB=k("ZodLiteral",(t,e)=>{a1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>i4(t,r,n,o),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});hB=k("ZodFile",(t,e)=>{c1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>c4(t,r,n,o),t.min=(r,n)=>t.check(Qa(r,n)),t.max=(r,n)=>t.check(Au(r,n)),t.mime=(r,n)=>t.check(im(Array.isArray(r)?r:[r],n))});gB=k("ZodTransform",(t,e)=>{l1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>p4(t,r,n,o),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Wa(t.constructor.name);r.addIssue=i=>{if(typeof i=="string")r.issues.push(B.issue(i,r.value,e));else{let s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),r.issues.push(B.issue(s))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(i=>(r.value=i,r)):(r.value=o,r)}});sC=k("ZodOptional",(t,e)=>{u1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>C4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});yB=k("ZodNullable",(t,e)=>{d1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>_4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});vB=k("ZodDefault",(t,e)=>{p1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>x4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});_B=k("ZodPrefault",(t,e)=>{f1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>S4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});aC=k("ZodNonOptional",(t,e)=>{m1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>w4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});SB=k("ZodSuccess",(t,e)=>{h1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>l4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});kB=k("ZodCatch",(t,e)=>{g1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>k4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});$B=k("ZodNaN",(t,e)=>{y1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>s4(t,r,n,o)});cC=k("ZodPipe",(t,e)=>{v1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>A4(t,r,n,o),t.in=e.in,t.out=e.out});lC=k("ZodCodec",(t,e)=>{cC.init(t,e),Kf.init(t,e)});PB=k("ZodReadonly",(t,e)=>{b1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>$4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});IB=k("ZodTemplateLiteral",(t,e)=>{_1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>a4(t,r,n,o)});TB=k("ZodLazy",(t,e)=>{S1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>I4(t,r,n,o),t.unwrap=()=>t._zod.def.getter()});OB=k("ZodPromise",(t,e)=>{x1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>P4(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});jB=k("ZodFunction",(t,e)=>{w1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>d4(t,r,n,o)});A_=k("ZodCustom",(t,e)=>{k1.init(t,e),je.init(t,e),t._zod.processJSONSchema=(r,n,o)=>u4(t,r,n,o)});TX=vP,EX=bP;jX=(...t)=>_P({Codec:lC,Boolean:bm,String:gm},...t)});var MB,zB,DB=x(()=>{Qt();Qt();MB={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};zB||(zB={})});var Rke,qB=x(()=>{h_();pm();mm();Rke={...fm,...m_,iso:Xa}});var P_={};ve(P_,{bigint:()=>DX,boolean:()=>MX,date:()=>qX,number:()=>zX,string:()=>RX});function RX(t){return N1(gm,t)}function zX(t){return U1(vm,t)}function MX(t){return Z1(bm,t)}function DX(t){return J1(_m,t)}function qX(t){return aP(__,t)}var BB=x(()=>{Qt();mm()});var dC=x(()=>{Qt();mm();h_();RP();zP();DB();Qt();P1();Qt();Iu();qB();qb();pm();pm();BB();vr($1())});var pC=x(()=>{dC();dC()});var fC=x(()=>{pC();pC()});var ju,LB,Ks,I_,Er,FB,VB,eAe,UX,LX,hC,Wn,Sm,HB,Or,io,so,jr,T_,GB,gC,WB,ZB,yC,km,xe,vC,KB,E_,tAe,ec,FX,O_,VX,Am,Ou,JB,HX,GX,WX,ZX,KX,JX,YX,QX,bC,XX,j_,eee,tee,N_,ree,$m,Pm,nee,Cm,tc,oee,Im,R_,z_,M_,rAe,D_,q_,B_,YB,QB,XB,_C,eU,Tm,Nu,tU,iee,see,wC,aee,xC,SC,cee,lee,kC,AC,uee,dee,pee,fee,mee,hee,gee,yee,vee,$C,bee,_ee,PC,CC,IC,wee,xee,See,TC,kee,EC,OC,Aee,$ee,rU,Pee,Em,Js,nAe,Cee,Iee,jC,nU,oU,Tee,Eee,Oee,jee,Nee,Ree,zee,Mee,Dee,C_,qee,Bee,NC,RC,Uee,Lee,Fee,Vee,Hee,Gee,Wee,Zee,Kee,Jee,Yee,Qee,Xee,ete,tte,rte,zC,nte,ote,MC,ite,ste,ate,cte,DC,lte,ute,dte,pte,oAe,iAe,sAe,aAe,cAe,lAe,fe,mC,Ys=x(()=>{fC();ju="2025-11-25",LB=[ju,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],Ks="io.modelcontextprotocol/related-task",I_="2.0",Er=uC(t=>t!==null&&(typeof t=="object"||typeof t=="function")),FB=gt([_(),Qe().int()]),VB=_(),eAe=pr({ttl:gt([Qe(),wm()]).optional(),pollInterval:Qe().optional()}),UX=G({ttl:Qe().optional()}),LX=G({taskId:_()}),hC=pr({progressToken:FB.optional(),[Ks]:LX.optional()}),Wn=G({_meta:hC.optional()}),Sm=Wn.extend({task:UX.optional()}),HB=t=>Sm.safeParse(t).success,Or=G({method:_(),params:Wn.loose().optional()}),io=G({_meta:hC.optional()}),so=G({method:_(),params:io.loose().optional()}),jr=pr({_meta:hC.optional()}),T_=gt([_(),Qe().int()]),GB=G({jsonrpc:oe(I_),id:T_,...Or.shape}).strict(),gC=t=>GB.safeParse(t).success,WB=G({jsonrpc:oe(I_),...so.shape}).strict(),ZB=t=>WB.safeParse(t).success,yC=G({jsonrpc:oe(I_),id:T_,result:jr}).strict(),km=t=>yC.safeParse(t).success;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(xe||(xe={}));vC=G({jsonrpc:oe(I_),id:T_.optional(),error:G({code:Qe().int(),message:_(),data:xt().optional()})}).strict(),KB=t=>vC.safeParse(t).success,E_=gt([GB,WB,yC,vC]),tAe=gt([yC,vC]),ec=jr.strict(),FX=io.extend({requestId:T_.optional(),reason:_().optional()}),O_=so.extend({method:oe("notifications/cancelled"),params:FX}),VX=G({src:_(),mimeType:_().optional(),sizes:V(_()).optional(),theme:Hr(["light","dark"]).optional()}),Am=G({icons:V(VX).optional()}),Ou=G({name:_(),title:_().optional()}),JB=Ou.extend({...Ou.shape,...Am.shape,version:_(),websiteUrl:_().optional(),description:_().optional()}),HX=xm(G({applyDefaults:pt().optional()}),Tt(_(),xt())),GX=$_(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,xm(G({form:HX.optional(),url:Er.optional()}),Tt(_(),xt()).optional())),WX=pr({list:Er.optional(),cancel:Er.optional(),requests:pr({sampling:pr({createMessage:Er.optional()}).optional(),elicitation:pr({create:Er.optional()}).optional()}).optional()}),ZX=pr({list:Er.optional(),cancel:Er.optional(),requests:pr({tools:pr({call:Er.optional()}).optional()}).optional()}),KX=G({experimental:Tt(_(),Er).optional(),sampling:G({context:Er.optional(),tools:Er.optional()}).optional(),elicitation:GX.optional(),roots:G({listChanged:pt().optional()}).optional(),tasks:WX.optional()}),JX=Wn.extend({protocolVersion:_(),capabilities:KX,clientInfo:JB}),YX=Or.extend({method:oe("initialize"),params:JX}),QX=G({experimental:Tt(_(),Er).optional(),logging:Er.optional(),completions:Er.optional(),prompts:G({listChanged:pt().optional()}).optional(),resources:G({subscribe:pt().optional(),listChanged:pt().optional()}).optional(),tools:G({listChanged:pt().optional()}).optional(),tasks:ZX.optional()}),bC=jr.extend({protocolVersion:_(),capabilities:QX,serverInfo:JB,instructions:_().optional()}),XX=so.extend({method:oe("notifications/initialized"),params:io.optional()}),j_=Or.extend({method:oe("ping"),params:Wn.optional()}),eee=G({progress:Qe(),total:Rt(Qe()),message:Rt(_())}),tee=G({...io.shape,...eee.shape,progressToken:FB}),N_=so.extend({method:oe("notifications/progress"),params:tee}),ree=Wn.extend({cursor:VB.optional()}),$m=Or.extend({params:ree.optional()}),Pm=jr.extend({nextCursor:VB.optional()}),nee=Hr(["working","input_required","completed","failed","cancelled"]),Cm=G({taskId:_(),status:nee,ttl:gt([Qe(),wm()]),createdAt:_(),lastUpdatedAt:_(),pollInterval:Rt(Qe()),statusMessage:Rt(_())}),tc=jr.extend({task:Cm}),oee=io.merge(Cm),Im=so.extend({method:oe("notifications/tasks/status"),params:oee}),R_=Or.extend({method:oe("tasks/get"),params:Wn.extend({taskId:_()})}),z_=jr.merge(Cm),M_=Or.extend({method:oe("tasks/result"),params:Wn.extend({taskId:_()})}),rAe=jr.loose(),D_=$m.extend({method:oe("tasks/list")}),q_=Pm.extend({tasks:V(Cm)}),B_=Or.extend({method:oe("tasks/cancel"),params:Wn.extend({taskId:_()})}),YB=jr.merge(Cm),QB=G({uri:_(),mimeType:Rt(_()),_meta:Tt(_(),xt()).optional()}),XB=QB.extend({text:_()}),_C=_().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),eU=QB.extend({blob:_C}),Tm=Hr(["user","assistant"]),Nu=G({audience:V(Tm).optional(),priority:Qe().min(0).max(1).optional(),lastModified:Xa.datetime({offset:!0}).optional()}),tU=G({...Ou.shape,...Am.shape,uri:_(),description:Rt(_()),mimeType:Rt(_()),annotations:Nu.optional(),_meta:Rt(pr({}))}),iee=G({...Ou.shape,...Am.shape,uriTemplate:_(),description:Rt(_()),mimeType:Rt(_()),annotations:Nu.optional(),_meta:Rt(pr({}))}),see=$m.extend({method:oe("resources/list")}),wC=Pm.extend({resources:V(tU)}),aee=$m.extend({method:oe("resources/templates/list")}),xC=Pm.extend({resourceTemplates:V(iee)}),SC=Wn.extend({uri:_()}),cee=SC,lee=Or.extend({method:oe("resources/read"),params:cee}),kC=jr.extend({contents:V(gt([XB,eU]))}),AC=so.extend({method:oe("notifications/resources/list_changed"),params:io.optional()}),uee=SC,dee=Or.extend({method:oe("resources/subscribe"),params:uee}),pee=SC,fee=Or.extend({method:oe("resources/unsubscribe"),params:pee}),mee=io.extend({uri:_()}),hee=so.extend({method:oe("notifications/resources/updated"),params:mee}),gee=G({name:_(),description:Rt(_()),required:Rt(pt())}),yee=G({...Ou.shape,...Am.shape,description:Rt(_()),arguments:Rt(V(gee)),_meta:Rt(pr({}))}),vee=$m.extend({method:oe("prompts/list")}),$C=Pm.extend({prompts:V(yee)}),bee=Wn.extend({name:_(),arguments:Tt(_(),_()).optional()}),_ee=Or.extend({method:oe("prompts/get"),params:bee}),PC=G({type:oe("text"),text:_(),annotations:Nu.optional(),_meta:Tt(_(),xt()).optional()}),CC=G({type:oe("image"),data:_C,mimeType:_(),annotations:Nu.optional(),_meta:Tt(_(),xt()).optional()}),IC=G({type:oe("audio"),data:_C,mimeType:_(),annotations:Nu.optional(),_meta:Tt(_(),xt()).optional()}),wee=G({type:oe("tool_use"),name:_(),id:_(),input:Tt(_(),xt()),_meta:Tt(_(),xt()).optional()}),xee=G({type:oe("resource"),resource:gt([XB,eU]),annotations:Nu.optional(),_meta:Tt(_(),xt()).optional()}),See=tU.extend({type:oe("resource_link")}),TC=gt([PC,CC,IC,See,xee]),kee=G({role:Tm,content:TC}),EC=jr.extend({description:_().optional(),messages:V(kee)}),OC=so.extend({method:oe("notifications/prompts/list_changed"),params:io.optional()}),Aee=G({title:_().optional(),readOnlyHint:pt().optional(),destructiveHint:pt().optional(),idempotentHint:pt().optional(),openWorldHint:pt().optional()}),$ee=G({taskSupport:Hr(["required","optional","forbidden"]).optional()}),rU=G({...Ou.shape,...Am.shape,description:_().optional(),inputSchema:G({type:oe("object"),properties:Tt(_(),Er).optional(),required:V(_()).optional()}).catchall(xt()),outputSchema:G({type:oe("object"),properties:Tt(_(),Er).optional(),required:V(_()).optional()}).catchall(xt()).optional(),annotations:Aee.optional(),execution:$ee.optional(),_meta:Tt(_(),xt()).optional()}),Pee=$m.extend({method:oe("tools/list")}),Em=Pm.extend({tools:V(rU)}),Js=jr.extend({content:V(TC).default([]),structuredContent:Tt(_(),xt()).optional(),isError:pt().optional()}),nAe=Js.or(jr.extend({toolResult:xt()})),Cee=Sm.extend({name:_(),arguments:Tt(_(),xt()).optional()}),Iee=Or.extend({method:oe("tools/call"),params:Cee}),jC=so.extend({method:oe("notifications/tools/list_changed"),params:io.optional()}),nU=G({autoRefresh:pt().default(!0),debounceMs:Qe().int().nonnegative().default(300)}),oU=Hr(["debug","info","notice","warning","error","critical","alert","emergency"]),Tee=Wn.extend({level:oU}),Eee=Or.extend({method:oe("logging/setLevel"),params:Tee}),Oee=io.extend({level:oU,logger:_().optional(),data:xt()}),jee=so.extend({method:oe("notifications/message"),params:Oee}),Nee=G({name:_().optional()}),Ree=G({hints:V(Nee).optional(),costPriority:Qe().min(0).max(1).optional(),speedPriority:Qe().min(0).max(1).optional(),intelligencePriority:Qe().min(0).max(1).optional()}),zee=G({mode:Hr(["auto","required","none"]).optional()}),Mee=G({type:oe("tool_result"),toolUseId:_().describe("The unique identifier for the corresponding tool call."),content:V(TC).default([]),structuredContent:G({}).loose().optional(),isError:pt().optional(),_meta:Tt(_(),xt()).optional()}),Dee=S_("type",[PC,CC,IC]),C_=S_("type",[PC,CC,IC,wee,Mee]),qee=G({role:Tm,content:gt([C_,V(C_)]),_meta:Tt(_(),xt()).optional()}),Bee=Sm.extend({messages:V(qee),modelPreferences:Ree.optional(),systemPrompt:_().optional(),includeContext:Hr(["none","thisServer","allServers"]).optional(),temperature:Qe().optional(),maxTokens:Qe().int(),stopSequences:V(_()).optional(),metadata:Er.optional(),tools:V(rU).optional(),toolChoice:zee.optional()}),NC=Or.extend({method:oe("sampling/createMessage"),params:Bee}),RC=jr.extend({model:_(),stopReason:Rt(Hr(["endTurn","stopSequence","maxTokens"]).or(_())),role:Tm,content:Dee}),Uee=jr.extend({model:_(),stopReason:Rt(Hr(["endTurn","stopSequence","maxTokens","toolUse"]).or(_())),role:Tm,content:gt([C_,V(C_)])}),Lee=G({type:oe("boolean"),title:_().optional(),description:_().optional(),default:pt().optional()}),Fee=G({type:oe("string"),title:_().optional(),description:_().optional(),minLength:Qe().optional(),maxLength:Qe().optional(),format:Hr(["email","uri","date","date-time"]).optional(),default:_().optional()}),Vee=G({type:Hr(["number","integer"]),title:_().optional(),description:_().optional(),minimum:Qe().optional(),maximum:Qe().optional(),default:Qe().optional()}),Hee=G({type:oe("string"),title:_().optional(),description:_().optional(),enum:V(_()),default:_().optional()}),Gee=G({type:oe("string"),title:_().optional(),description:_().optional(),oneOf:V(G({const:_(),title:_()})),default:_().optional()}),Wee=G({type:oe("string"),title:_().optional(),description:_().optional(),enum:V(_()),enumNames:V(_()).optional(),default:_().optional()}),Zee=gt([Hee,Gee]),Kee=G({type:oe("array"),title:_().optional(),description:_().optional(),minItems:Qe().optional(),maxItems:Qe().optional(),items:G({type:oe("string"),enum:V(_())}),default:V(_()).optional()}),Jee=G({type:oe("array"),title:_().optional(),description:_().optional(),minItems:Qe().optional(),maxItems:Qe().optional(),items:G({anyOf:V(G({const:_(),title:_()}))}),default:V(_()).optional()}),Yee=gt([Kee,Jee]),Qee=gt([Wee,Zee,Yee]),Xee=gt([Qee,Lee,Fee,Vee]),ete=Sm.extend({mode:oe("form").optional(),message:_(),requestedSchema:G({type:oe("object"),properties:Tt(_(),Xee),required:V(_()).optional()})}),tte=Sm.extend({mode:oe("url"),message:_(),elicitationId:_(),url:_().url()}),rte=gt([ete,tte]),zC=Or.extend({method:oe("elicitation/create"),params:rte}),nte=io.extend({elicitationId:_()}),ote=so.extend({method:oe("notifications/elicitation/complete"),params:nte}),MC=jr.extend({action:Hr(["accept","decline","cancel"]),content:$_(t=>t===null?void 0:t,Tt(_(),gt([_(),Qe(),pt(),V(_())])).optional())}),ite=G({type:oe("ref/resource"),uri:_()}),ste=G({type:oe("ref/prompt"),name:_()}),ate=Wn.extend({ref:gt([ste,ite]),argument:G({name:_(),value:_()}),context:G({arguments:Tt(_(),_()).optional()}).optional()}),cte=Or.extend({method:oe("completion/complete"),params:ate}),DC=jr.extend({completion:pr({values:V(_()).max(100),total:Rt(Qe().int()),hasMore:Rt(pt())})}),lte=G({uri:_().startsWith("file://"),name:_().optional(),_meta:Tt(_(),xt()).optional()}),ute=Or.extend({method:oe("roots/list"),params:Wn.optional()}),dte=jr.extend({roots:V(lte)}),pte=so.extend({method:oe("notifications/roots/list_changed"),params:io.optional()}),oAe=gt([j_,YX,cte,Eee,_ee,vee,see,aee,lee,dee,fee,Iee,Pee,R_,M_,D_,B_]),iAe=gt([O_,N_,XX,pte,Im]),sAe=gt([ec,RC,Uee,MC,dte,z_,q_,tc]),aAe=gt([j_,NC,zC,ute,R_,M_,D_,B_]),cAe=gt([O_,N_,jee,hee,AC,jC,OC,Im,ote]),lAe=gt([ec,bC,DC,EC,$C,wC,xC,kC,Js,Em,z_,q_,tc]),fe=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===xe.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new mC(o.elicitations,r)}return new t(e,r,n)}},mC=class extends fe{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(xe.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}}});function Qs(t){return t==="completed"||t==="failed"||t==="cancelled"}var iU=x(()=>{});var U_=x(()=>{});var qC=x(()=>{U_()});var Xs=x(()=>{});var L_=x(()=>{});var ao=x(()=>{L_()});var BC=x(()=>{If();Xs();fr()});var UC=x(()=>{Xs()});var LC=x(()=>{});var F_=x(()=>{fr()});var FC=x(()=>{fr()});var VC=x(()=>{Xs()});var HC=x(()=>{fr()});var GC=x(()=>{fr();ao()});var WC=x(()=>{});var ZC=x(()=>{fr()});var KC=x(()=>{});var FAe,V_=x(()=>{Xs();FAe=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789")});var H_=x(()=>{If();fr();V_();F_();ao()});var JC=x(()=>{fr();H_();ao()});var YC=x(()=>{});var QC=x(()=>{ao()});var XC=x(()=>{});var G_=x(()=>{fr()});var eI=x(()=>{fr();G_()});var tI=x(()=>{Xs()});var rI=x(()=>{fr()});var nI=x(()=>{fr();ao()});var oI=x(()=>{fr()});var iI=x(()=>{fr()});var sI=x(()=>{Xs();fr()});var aI=x(()=>{fr()});var cI=x(()=>{ao()});var lI=x(()=>{ao()});var uI=x(()=>{fr()});var dI=x(()=>{If();ao();BC();UC();LC();F_();FC();VC();HC();GC();WC();ZC();KC();JC();YC();QC();XC();eI();tI();rI();nI();oI();iI();H_();sI();V_();aI();cI();G_();lI();uI()});var fr=x(()=>{U_();dI();L_();ao()});var sU=x(()=>{});var pI=x(()=>{fr();qC();ao()});var aU=x(()=>{U_();qC();Xs();L_();fr();sU();ao();BC();UC();LC();F_();FC();VC();HC();GC();WC();ZC();KC();JC();YC();QC();XC();eI();tI();rI();nI();oI();iI();uI();H_();sI();V_();aI();cI();G_();lI();dI();pI();pI()});function fI(t){let r=p_(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=D4(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function mI(t,e){let r=zo(t,e);if(!r.success)throw r.error;return r.data}var cU=x(()=>{$P();f_();aU()});function lU(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function uU(t,e){let r={...t};for(let n in e){let o=n,i=e[o];if(i===void 0)continue;let s=r[o];lU(s)&&lU(i)?r[o]={...s,...i}:r[o]=i}return r}var vte,W_,dU=x(()=>{f_();Ys();iU();cU();vte=6e4,W_=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(O_,r=>{this._oncancel(r)}),this.setNotificationHandler(N_,r=>{this._onprogress(r)}),this.setRequestHandler(j_,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(R_,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new fe(xe.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(M_,async(r,n)=>{let o=async()=>{let i=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(i,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,l=c.id,u=this._requestResolvers.get(l);if(u)if(this._requestResolvers.delete(l),a.type==="response")u(c);else{let d=c,p=new fe(d.error.code,d.error.message,d.error.data);u(p)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${l}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let s=await this._taskStore.getTask(i,n.sessionId);if(!s)throw new fe(xe.InvalidParams,`Task not found: ${i}`);if(!Qs(s.status))return await this._waitForTaskUpdate(i,n.signal),await o();if(Qs(s.status)){let a=await this._taskStore.getTaskResult(i,n.sessionId);return this._clearTaskQueue(i),{...a,_meta:{...a._meta,[Ks]:{taskId:i}}}}return await o()};return await o()}),this.setRequestHandler(D_,async(r,n)=>{try{let{tasks:o,nextCursor:i}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:i,_meta:{}}}catch(o){throw new fe(xe.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(B_,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new fe(xe.InvalidParams,`Task not found: ${r.params.taskId}`);if(Qs(o.status))throw new fe(xe.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let i=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!i)throw new fe(xe.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...i}}catch(o){throw o instanceof fe?o:new fe(xe.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,i=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:i,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),fe.fromError(xe.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=i=>{n?.(i),this._onerror(i)};let o=this._transport?.onmessage;this._transport.onmessage=(i,s)=>{o?.(i,s),km(i)||KB(i)?this._onresponse(i):gC(i)?this._onrequest(i,s):ZB(i)?this._onnotification(i):this._onerror(new Error(`Unknown message type: ${JSON.stringify(i)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let r=fe.fromError(xe.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,i=e.params?._meta?.[Ks]?.taskId;if(n===void 0){let u={jsonrpc:"2.0",id:e.id,error:{code:xe.MethodNotFound,message:"Method not found"}};i&&this._taskMessageQueue?this._enqueueTaskMessage(i,{type:"error",message:u,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(u).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let s=new AbortController;this._requestHandlerAbortControllers.set(e.id,s);let a=HB(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,l={signal:s.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async u=>{let d={relatedRequestId:e.id};i&&(d.relatedTask={taskId:i}),await this.notification(u,d)},sendRequest:async(u,d,p)=>{let f={...p,relatedRequestId:e.id};i&&!f.relatedTask&&(f.relatedTask={taskId:i});let m=f.relatedTask?.taskId??i;return m&&c&&await c.updateTaskStatus(m,"input_required"),await this.request(u,d,f)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:i,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,l)).then(async u=>{if(s.signal.aborted)return;let d={result:u,jsonrpc:"2.0",id:e.id};i&&this._taskMessageQueue?await this._enqueueTaskMessage(i,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async u=>{if(s.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(u.code)?u.code:xe.InternalError,message:u.message??"Internal error",...u.data!==void 0&&{data:u.data}}};i&&this._taskMessageQueue?await this._enqueueTaskMessage(i,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(u=>this._onerror(new Error(`Failed to send response: ${u}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),i=this._progressHandlers.get(o);if(!i){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let s=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&s&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),s(c);return}i(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),km(e))n(e);else{let s=new fe(e.error.code,e.error.message,e.error.data);n(s)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let i=!1;if(km(e)&&e.result&&typeof e.result=="object"){let s=e.result;if(s.task&&typeof s.task=="object"){let a=s.task;typeof a.taskId=="string"&&(i=!0,this._taskProgressTokens.set(a.taskId,r))}}if(i||this._progressHandlers.delete(r),km(e))o(e);else{let s=fe.fromError(e.error.code,e.error.message,e.error.data);o(s)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(s){yield{type:"error",error:s instanceof fe?s:new fe(xe.InternalError,String(s))}}return}let i;try{let s=await this.request(e,tc,n);if(s.task)i=s.task.taskId,yield{type:"taskCreated",task:s.task};else throw new fe(xe.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:i},n);if(yield{type:"taskStatus",task:a},Qs(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:i},r,n)}:a.status==="failed"?yield{type:"error",error:new fe(xe.InternalError,`Task ${i} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new fe(xe.InternalError,`Task ${i} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:i},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(l=>setTimeout(l,c)),n?.signal?.throwIfAborted()}}catch(s){yield{type:"error",error:s instanceof fe?s:new fe(xe.InternalError,String(s))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s,task:a,relatedTask:c}=n??{};return new Promise((l,u)=>{let d=b=>{u(b)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(b){d(b);return}n?.signal?.throwIfAborted();let p=this._requestMessageId++,f={...e,jsonrpc:"2.0",id:p};n?.onprogress&&(this._progressHandlers.set(p,n.onprogress),f.params={...e.params,_meta:{...e.params?._meta||{},progressToken:p}}),a&&(f.params={...f.params,task:a}),c&&(f.params={...f.params,_meta:{...f.params?._meta||{},[Ks]:c}});let m=b=>{this._responseHandlers.delete(p),this._progressHandlers.delete(p),this._cleanupTimeout(p),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:p,reason:String(b)}},{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s}).catch(j=>this._onerror(new Error(`Failed to send cancellation: ${j}`)));let S=b instanceof fe?b:new fe(xe.RequestTimeout,String(b));u(S)};this._responseHandlers.set(p,b=>{if(!n?.signal?.aborted){if(b instanceof Error)return u(b);try{let S=zo(r,b.result);S.success?l(S.data):u(S.error)}catch(S){u(S)}}}),n?.signal?.addEventListener("abort",()=>{m(n?.signal?.reason)});let h=n?.timeout??vte,g=()=>m(fe.fromError(xe.RequestTimeout,"Request timed out",{timeout:h}));this._setupTimeout(p,h,n?.maxTotalTimeout,g,n?.resetTimeoutOnProgress??!1);let v=c?.taskId;if(v){let b=S=>{let j=this._responseHandlers.get(p);j?j(S):this._onerror(new Error(`Response handler missing for side-channeled request ${p}`))};this._requestResolvers.set(p,b),this._enqueueTaskMessage(v,{type:"request",message:f,timestamp:Date.now()}).catch(S=>{this._cleanupTimeout(p),u(S)})}else this._transport.send(f,{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s}).catch(b=>{this._cleanupTimeout(p),u(b)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},z_,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},q_,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},YB,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[Ks]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[Ks]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let s={...e,jsonrpc:"2.0"};r?.relatedTask&&(s={...s,params:{...s.params,_meta:{...s.params?._meta||{},[Ks]:r.relatedTask}}}),await this._transport.send(s,r)}setRequestHandler(e,r){let n=fI(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,i)=>{let s=mI(e,o);return Promise.resolve(r(s,i))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=fI(e);this._notificationHandlers.set(n,o=>{let i=mI(e,o);return Promise.resolve(r(i))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&gC(o.message)){let i=o.message.id,s=this._requestResolvers.get(i);s?(s(new fe(xe.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(i)):this._onerror(new Error(`Resolver missing for request ${i} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,i)=>{if(r.aborted){i(new fe(xe.InvalidRequest,"Request cancelled"));return}let s=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(s),i(new fe(xe.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let i=await n.getTask(o,r);if(!i)throw new fe(xe.InvalidParams,"Failed to retrieve task: Task not found");return i},storeTaskResult:async(o,i,s)=>{await n.storeTaskResult(o,i,s,r);let a=await n.getTask(o,r);if(a){let c=Im.parse({method:"notifications/tasks/status",params:a});await this.notification(c),Qs(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,i,s)=>{let a=await n.getTask(o,r);if(!a)throw new fe(xe.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(Qs(a.status))throw new fe(xe.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${i}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,i,s,r);let c=await n.getTask(o,r);if(c){let l=Im.parse({method:"notifications/tasks/status",params:c});await this.notification(l),Qs(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}}});var Rm=y(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.regexpCode=ot.getEsmExportName=ot.getProperty=ot.safeStringify=ot.stringify=ot.strConcat=ot.addCodeArg=ot.str=ot._=ot.nil=ot._Code=ot.Name=ot.IDENTIFIER=ot._CodeOrName=void 0;var jm=class{};ot._CodeOrName=jm;ot.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var rc=class extends jm{constructor(e){if(super(),!ot.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};ot.Name=rc;var co=class extends jm{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof rc&&(r[n.str]=(r[n.str]||0)+1),r),{})}};ot._Code=co;ot.nil=new co("");function pU(t,...e){let r=[t[0]],n=0;for(;n<e.length;)gI(r,e[n]),r.push(t[++n]);return new co(r)}ot._=pU;var hI=new co("+");function fU(t,...e){let r=[Nm(t[0])],n=0;for(;n<e.length;)r.push(hI),gI(r,e[n]),r.push(hI,Nm(t[++n]));return bte(r),new co(r)}ot.str=fU;function gI(t,e){e instanceof co?t.push(...e._items):e instanceof rc?t.push(e):t.push(xte(e))}ot.addCodeArg=gI;function bte(t){let e=1;for(;e<t.length-1;){if(t[e]===hI){let r=_te(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function _te(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof rc||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof rc))return`"${t}${e.slice(1)}`}function wte(t,e){return e.emptyStr()?t:t.emptyStr()?e:fU`${t}${e}`}ot.strConcat=wte;function xte(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:Nm(Array.isArray(t)?t.join(","):t)}function Ste(t){return new co(Nm(t))}ot.stringify=Ste;function Nm(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}ot.safeStringify=Nm;function kte(t){return typeof t=="string"&&ot.IDENTIFIER.test(t)?new co(`.${t}`):pU`[${t}]`}ot.getProperty=kte;function Ate(t){if(typeof t=="string"&&ot.IDENTIFIER.test(t))return new co(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}ot.getEsmExportName=Ate;function $te(t){return new co(t.toString())}ot.regexpCode=$te});var bI=y(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.ValueScope=_n.ValueScopeName=_n.Scope=_n.varKinds=_n.UsedValueState=void 0;var bn=Rm(),yI=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Z_;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Z_||(_n.UsedValueState=Z_={}));_n.varKinds={const:new bn.Name("const"),let:new bn.Name("let"),var:new bn.Name("var")};var K_=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof bn.Name?e:this.name(e)}name(e){return new bn.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};_n.Scope=K_;var J_=class extends bn.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,bn._)`.${new bn.Name(r)}[${n}]`}};_n.ValueScopeName=J_;var Pte=(0,bn._)`\n`,vI=class extends K_{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?Pte:bn.nil}}get(){return this._scope}name(e){return new J_(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:i}=o,s=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let u=a.get(s);if(u)return u}else a=this._values[i]=new Map;a.set(s,o);let c=this._scope[i]||(this._scope[i]=[]),l=c.length;return c[l]=r.ref,o.setValue(r,{property:i,itemIndex:l}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,bn._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let i=bn.nil;for(let s in e){let a=e[s];if(!a)continue;let c=n[s]=n[s]||new Map;a.forEach(l=>{if(c.has(l))return;c.set(l,Z_.Started);let u=r(l);if(u){let d=this.opts.es5?_n.varKinds.var:_n.varKinds.const;i=(0,bn._)`${i}${d} ${l} = ${u};${this.opts._n}`}else if(u=o?.(l))i=(0,bn._)`${i}${u}${this.opts._n}`;else throw new yI(l);c.set(l,Z_.Completed)})}return i}};_n.ValueScope=vI});var De=y(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.or=ze.and=ze.not=ze.CodeGen=ze.operators=ze.varKinds=ze.ValueScopeName=ze.ValueScope=ze.Scope=ze.Name=ze.regexpCode=ze.stringify=ze.getProperty=ze.nil=ze.strConcat=ze.str=ze._=void 0;var Je=Rm(),Mo=bI(),ea=Rm();Object.defineProperty(ze,"_",{enumerable:!0,get:function(){return ea._}});Object.defineProperty(ze,"str",{enumerable:!0,get:function(){return ea.str}});Object.defineProperty(ze,"strConcat",{enumerable:!0,get:function(){return ea.strConcat}});Object.defineProperty(ze,"nil",{enumerable:!0,get:function(){return ea.nil}});Object.defineProperty(ze,"getProperty",{enumerable:!0,get:function(){return ea.getProperty}});Object.defineProperty(ze,"stringify",{enumerable:!0,get:function(){return ea.stringify}});Object.defineProperty(ze,"regexpCode",{enumerable:!0,get:function(){return ea.regexpCode}});Object.defineProperty(ze,"Name",{enumerable:!0,get:function(){return ea.Name}});var ew=bI();Object.defineProperty(ze,"Scope",{enumerable:!0,get:function(){return ew.Scope}});Object.defineProperty(ze,"ValueScope",{enumerable:!0,get:function(){return ew.ValueScope}});Object.defineProperty(ze,"ValueScopeName",{enumerable:!0,get:function(){return ew.ValueScopeName}});Object.defineProperty(ze,"varKinds",{enumerable:!0,get:function(){return ew.varKinds}});ze.operators={GT:new Je._Code(">"),GTE:new Je._Code(">="),LT:new Je._Code("<"),LTE:new Je._Code("<="),EQ:new Je._Code("==="),NEQ:new Je._Code("!=="),NOT:new Je._Code("!"),OR:new Je._Code("||"),AND:new Je._Code("&&"),ADD:new Je._Code("+")};var ts=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},_I=class extends ts{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?Mo.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=zu(this.rhs,e,r)),this}get names(){return this.rhs instanceof Je._CodeOrName?this.rhs.names:{}}},Y_=class extends ts{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof Je.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=zu(this.rhs,e,r),this}get names(){let e=this.lhs instanceof Je.Name?{}:{...this.lhs.names};return X_(e,this.rhs)}},wI=class extends Y_{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},xI=class extends ts{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},SI=class extends ts{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},kI=class extends ts{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},AI=class extends ts{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=zu(this.code,e,r),this}get names(){return this.code instanceof Je._CodeOrName?this.code.names:{}}},zm=class extends ts{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let i=n[o];i.optimizeNames(e,r)||(Cte(e,i.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>ic(e,r.names),{})}},rs=class extends zm{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},$I=class extends zm{},Ru=class extends rs{};Ru.kind="else";var nc=class t extends rs{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new Ru(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(mU(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=zu(this.condition,e,r),this}get names(){let e=super.names;return X_(e,this.condition),this.else&&ic(e,this.else.names),e}};nc.kind="if";var oc=class extends rs{};oc.kind="for";var PI=class extends oc{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=zu(this.iteration,e,r),this}get names(){return ic(super.names,this.iteration.names)}},CI=class extends oc{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?Mo.varKinds.var:this.varKind,{name:n,from:o,to:i}=this;return`for(${r} ${n}=${o}; ${n}<${i}; ${n}++)`+super.render(e)}get names(){let e=X_(super.names,this.from);return X_(e,this.to)}},Q_=class extends oc{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=zu(this.iterable,e,r),this}get names(){return ic(super.names,this.iterable.names)}},Mm=class extends rs{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};Mm.kind="func";var Dm=class extends zm{render(e){return"return "+super.render(e)}};Dm.kind="return";var II=class extends rs{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&ic(e,this.catch.names),this.finally&&ic(e,this.finally.names),e}},qm=class extends rs{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};qm.kind="catch";var Bm=class extends rs{render(e){return"finally"+super.render(e)}};Bm.kind="finally";var TI=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new Mo.Scope({parent:e}),this._nodes=[new $I]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let i=this._scope.toName(r);return n!==void 0&&o&&(this._constants[i.str]=n),this._leafNode(new _I(e,i,n)),i}const(e,r,n){return this._def(Mo.varKinds.const,e,r,n)}let(e,r,n){return this._def(Mo.varKinds.let,e,r,n)}var(e,r,n){return this._def(Mo.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Y_(e,r,n))}add(e,r){return this._leafNode(new wI(e,ze.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==Je.nil&&this._leafNode(new AI(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,Je.addCodeArg)(r,o));return r.push("}"),new Je._Code(r)}if(e,r,n){if(this._blockNode(new nc(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new nc(e))}else(){return this._elseNode(new Ru)}endIf(){return this._endBlockNode(nc,Ru)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new PI(e),r)}forRange(e,r,n,o,i=this.opts.es5?Mo.varKinds.var:Mo.varKinds.let){let s=this._scope.toName(e);return this._for(new CI(i,s,r,n),()=>o(s))}forOf(e,r,n,o=Mo.varKinds.const){let i=this._scope.toName(e);if(this.opts.es5){let s=r instanceof Je.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,Je._)`${s}.length`,a=>{this.var(i,(0,Je._)`${s}[${a}]`),n(i)})}return this._for(new Q_("of",o,i,r),()=>n(i))}forIn(e,r,n,o=this.opts.es5?Mo.varKinds.var:Mo.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,Je._)`Object.keys(${r})`,n);let i=this._scope.toName(e);return this._for(new Q_("in",o,i,r),()=>n(i))}endFor(){return this._endBlockNode(oc)}label(e){return this._leafNode(new xI(e))}break(e){return this._leafNode(new SI(e))}return(e){let r=new Dm;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(Dm)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new II;if(this._blockNode(o),this.code(e),r){let i=this.name("e");this._currNode=o.catch=new qm(i),r(i)}return n&&(this._currNode=o.finally=new Bm,this.code(n)),this._endBlockNode(qm,Bm)}throw(e){return this._leafNode(new kI(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=Je.nil,n,o){return this._blockNode(new Mm(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(Mm)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof nc))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};ze.CodeGen=TI;function ic(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function X_(t,e){return e instanceof Je._CodeOrName?ic(t,e.names):t}function zu(t,e,r){if(t instanceof Je.Name)return n(t);if(!o(t))return t;return new Je._Code(t._items.reduce((i,s)=>(s instanceof Je.Name&&(s=n(s)),s instanceof Je._Code?i.push(...s._items):i.push(s),i),[]));function n(i){let s=r[i.str];return s===void 0||e[i.str]!==1?i:(delete e[i.str],s)}function o(i){return i instanceof Je._Code&&i._items.some(s=>s instanceof Je.Name&&e[s.str]===1&&r[s.str]!==void 0)}}function Cte(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function mU(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,Je._)`!${EI(t)}`}ze.not=mU;var Ite=hU(ze.operators.AND);function Tte(...t){return t.reduce(Ite)}ze.and=Tte;var Ete=hU(ze.operators.OR);function Ote(...t){return t.reduce(Ete)}ze.or=Ote;function hU(t){return(e,r)=>e===Je.nil?r:r===Je.nil?e:(0,Je._)`${EI(e)} ${t} ${EI(r)}`}function EI(t){return t instanceof Je.Name?t:(0,Je._)`(${t})`}});var it=y(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.checkStrictMode=qe.getErrorPath=qe.Type=qe.useFunc=qe.setEvaluated=qe.evaluatedPropsToName=qe.mergeEvaluated=qe.eachItem=qe.unescapeJsonPointer=qe.escapeJsonPointer=qe.escapeFragment=qe.unescapeFragment=qe.schemaRefOrVal=qe.schemaHasRulesButRef=qe.schemaHasRules=qe.checkUnknownRules=qe.alwaysValidSchema=qe.toHash=void 0;var St=De(),jte=Rm();function Nte(t){let e={};for(let r of t)e[r]=!0;return e}qe.toHash=Nte;function Rte(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(vU(t,e),!bU(e,t.self.RULES.all))}qe.alwaysValidSchema=Rte;function vU(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let i in e)o[i]||xU(t,`unknown keyword: "${i}"`)}qe.checkUnknownRules=vU;function bU(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}qe.schemaHasRules=bU;function zte(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}qe.schemaHasRulesButRef=zte;function Mte({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,St._)`${r}`}return(0,St._)`${t}${e}${(0,St.getProperty)(n)}`}qe.schemaRefOrVal=Mte;function Dte(t){return _U(decodeURIComponent(t))}qe.unescapeFragment=Dte;function qte(t){return encodeURIComponent(jI(t))}qe.escapeFragment=qte;function jI(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}qe.escapeJsonPointer=jI;function _U(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}qe.unescapeJsonPointer=_U;function Bte(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}qe.eachItem=Bte;function gU({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,i,s,a)=>{let c=s===void 0?i:s instanceof St.Name?(i instanceof St.Name?t(o,i,s):e(o,i,s),s):i instanceof St.Name?(e(o,s,i),i):r(i,s);return a===St.Name&&!(c instanceof St.Name)?n(o,c):c}}qe.mergeEvaluated={props:gU({mergeNames:(t,e,r)=>t.if((0,St._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,St._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,St._)`${r} || {}`).code((0,St._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,St._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,St._)`${r} || {}`),NI(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:wU}),items:gU({mergeNames:(t,e,r)=>t.if((0,St._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,St._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,St._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,St._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function wU(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,St._)`{}`);return e!==void 0&&NI(t,r,e),r}qe.evaluatedPropsToName=wU;function NI(t,e,r){Object.keys(r).forEach(n=>t.assign((0,St._)`${e}${(0,St.getProperty)(n)}`,!0))}qe.setEvaluated=NI;var yU={};function Ute(t,e){return t.scopeValue("func",{ref:e,code:yU[e.code]||(yU[e.code]=new jte._Code(e.code))})}qe.useFunc=Ute;var OI;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(OI||(qe.Type=OI={}));function Lte(t,e,r){if(t instanceof St.Name){let n=e===OI.Num;return r?n?(0,St._)`"[" + ${t} + "]"`:(0,St._)`"['" + ${t} + "']"`:n?(0,St._)`"/" + ${t}`:(0,St._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,St.getProperty)(t).toString():"/"+jI(t)}qe.getErrorPath=Lte;function xU(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}qe.checkStrictMode=xU});var ns=y(RI=>{"use strict";Object.defineProperty(RI,"__esModule",{value:!0});var Gr=De(),Fte={data:new Gr.Name("data"),valCxt:new Gr.Name("valCxt"),instancePath:new Gr.Name("instancePath"),parentData:new Gr.Name("parentData"),parentDataProperty:new Gr.Name("parentDataProperty"),rootData:new Gr.Name("rootData"),dynamicAnchors:new Gr.Name("dynamicAnchors"),vErrors:new Gr.Name("vErrors"),errors:new Gr.Name("errors"),this:new Gr.Name("this"),self:new Gr.Name("self"),scope:new Gr.Name("scope"),json:new Gr.Name("json"),jsonPos:new Gr.Name("jsonPos"),jsonLen:new Gr.Name("jsonLen"),jsonPart:new Gr.Name("jsonPart")};RI.default=Fte});var Um=y(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.extendErrors=Wr.resetErrorsCount=Wr.reportExtraError=Wr.reportError=Wr.keyword$DataError=Wr.keywordError=void 0;var Xe=De(),tw=it(),ln=ns();Wr.keywordError={message:({keyword:t})=>(0,Xe.str)`must pass "${t}" keyword validation`};Wr.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Xe.str)`"${t}" keyword must be ${e} ($data)`:(0,Xe.str)`"${t}" keyword is invalid ($data)`};function Vte(t,e=Wr.keywordError,r,n){let{it:o}=t,{gen:i,compositeRule:s,allErrors:a}=o,c=AU(t,e,r);n??(s||a)?SU(i,c):kU(o,(0,Xe._)`[${c}]`)}Wr.reportError=Vte;function Hte(t,e=Wr.keywordError,r){let{it:n}=t,{gen:o,compositeRule:i,allErrors:s}=n,a=AU(t,e,r);SU(o,a),i||s||kU(n,ln.default.vErrors)}Wr.reportExtraError=Hte;function Gte(t,e){t.assign(ln.default.errors,e),t.if((0,Xe._)`${ln.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Xe._)`${ln.default.vErrors}.length`,e),()=>t.assign(ln.default.vErrors,null)))}Wr.resetErrorsCount=Gte;function Wte({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:i}){if(o===void 0)throw new Error("ajv implementation error");let s=t.name("err");t.forRange("i",o,ln.default.errors,a=>{t.const(s,(0,Xe._)`${ln.default.vErrors}[${a}]`),t.if((0,Xe._)`${s}.instancePath === undefined`,()=>t.assign((0,Xe._)`${s}.instancePath`,(0,Xe.strConcat)(ln.default.instancePath,i.errorPath))),t.assign((0,Xe._)`${s}.schemaPath`,(0,Xe.str)`${i.errSchemaPath}/${e}`),i.opts.verbose&&(t.assign((0,Xe._)`${s}.schema`,r),t.assign((0,Xe._)`${s}.data`,n))})}Wr.extendErrors=Wte;function SU(t,e){let r=t.const("err",e);t.if((0,Xe._)`${ln.default.vErrors} === null`,()=>t.assign(ln.default.vErrors,(0,Xe._)`[${r}]`),(0,Xe._)`${ln.default.vErrors}.push(${r})`),t.code((0,Xe._)`${ln.default.errors}++`)}function kU(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Xe._)`new ${t.ValidationError}(${e})`):(r.assign((0,Xe._)`${n}.errors`,e),r.return(!1))}var sc={keyword:new Xe.Name("keyword"),schemaPath:new Xe.Name("schemaPath"),params:new Xe.Name("params"),propertyName:new Xe.Name("propertyName"),message:new Xe.Name("message"),schema:new Xe.Name("schema"),parentSchema:new Xe.Name("parentSchema")};function AU(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Xe._)`{}`:Zte(t,e,r)}function Zte(t,e,r={}){let{gen:n,it:o}=t,i=[Kte(o,r),Jte(t,r)];return Yte(t,e,i),n.object(...i)}function Kte({errorPath:t},{instancePath:e}){let r=e?(0,Xe.str)`${t}${(0,tw.getErrorPath)(e,tw.Type.Str)}`:t;return[ln.default.instancePath,(0,Xe.strConcat)(ln.default.instancePath,r)]}function Jte({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Xe.str)`${e}/${t}`;return r&&(o=(0,Xe.str)`${o}${(0,tw.getErrorPath)(r,tw.Type.Str)}`),[sc.schemaPath,o]}function Yte(t,{params:e,message:r},n){let{keyword:o,data:i,schemaValue:s,it:a}=t,{opts:c,propertyName:l,topSchemaRef:u,schemaPath:d}=a;n.push([sc.keyword,o],[sc.params,typeof e=="function"?e(t):e||(0,Xe._)`{}`]),c.messages&&n.push([sc.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([sc.schema,s],[sc.parentSchema,(0,Xe._)`${u}${d}`],[ln.default.data,i]),l&&n.push([sc.propertyName,l])}});var PU=y(Mu=>{"use strict";Object.defineProperty(Mu,"__esModule",{value:!0});Mu.boolOrEmptySchema=Mu.topBoolOrEmptySchema=void 0;var Qte=Um(),Xte=De(),ere=ns(),tre={message:"boolean schema is false"};function rre(t){let{gen:e,schema:r,validateName:n}=t;r===!1?$U(t,!1):typeof r=="object"&&r.$async===!0?e.return(ere.default.data):(e.assign((0,Xte._)`${n}.errors`,null),e.return(!0))}Mu.topBoolOrEmptySchema=rre;function nre(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),$U(t)):r.var(e,!0)}Mu.boolOrEmptySchema=nre;function $U(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,Qte.reportError)(o,tre,void 0,e)}});var zI=y(Du=>{"use strict";Object.defineProperty(Du,"__esModule",{value:!0});Du.getRules=Du.isJSONType=void 0;var ore=["string","number","integer","boolean","null","object","array"],ire=new Set(ore);function sre(t){return typeof t=="string"&&ire.has(t)}Du.isJSONType=sre;function are(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}Du.getRules=are});var MI=y(ta=>{"use strict";Object.defineProperty(ta,"__esModule",{value:!0});ta.shouldUseRule=ta.shouldUseGroup=ta.schemaHasRulesForType=void 0;function cre({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&CU(t,n)}ta.schemaHasRulesForType=cre;function CU(t,e){return e.rules.some(r=>IU(t,r))}ta.shouldUseGroup=CU;function IU(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}ta.shouldUseRule=IU});var Lm=y(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.reportTypeError=Zr.checkDataTypes=Zr.checkDataType=Zr.coerceAndCheckDataType=Zr.getJSONTypes=Zr.getSchemaTypes=Zr.DataType=void 0;var lre=zI(),ure=MI(),dre=Um(),Ee=De(),TU=it(),qu;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(qu||(Zr.DataType=qu={}));function pre(t){let e=EU(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Zr.getSchemaTypes=pre;function EU(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(lre.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Zr.getJSONTypes=EU;function fre(t,e){let{gen:r,data:n,opts:o}=t,i=mre(e,o.coerceTypes),s=e.length>0&&!(i.length===0&&e.length===1&&(0,ure.schemaHasRulesForType)(t,e[0]));if(s){let a=qI(e,n,o.strictNumbers,qu.Wrong);r.if(a,()=>{i.length?hre(t,e,i):BI(t)})}return s}Zr.coerceAndCheckDataType=fre;var OU=new Set(["string","number","integer","boolean","null"]);function mre(t,e){return e?t.filter(r=>OU.has(r)||e==="array"&&r==="array"):[]}function hre(t,e,r){let{gen:n,data:o,opts:i}=t,s=n.let("dataType",(0,Ee._)`typeof ${o}`),a=n.let("coerced",(0,Ee._)`undefined`);i.coerceTypes==="array"&&n.if((0,Ee._)`${s} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,Ee._)`${o}[0]`).assign(s,(0,Ee._)`typeof ${o}`).if(qI(e,o,i.strictNumbers),()=>n.assign(a,o))),n.if((0,Ee._)`${a} !== undefined`);for(let l of r)(OU.has(l)||l==="array"&&i.coerceTypes==="array")&&c(l);n.else(),BI(t),n.endIf(),n.if((0,Ee._)`${a} !== undefined`,()=>{n.assign(o,a),gre(t,a)});function c(l){switch(l){case"string":n.elseIf((0,Ee._)`${s} == "number" || ${s} == "boolean"`).assign(a,(0,Ee._)`"" + ${o}`).elseIf((0,Ee._)`${o} === null`).assign(a,(0,Ee._)`""`);return;case"number":n.elseIf((0,Ee._)`${s} == "boolean" || ${o} === null
              || (${s} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,Ee._)`+${o}`);return;case"integer":n.elseIf((0,Ee._)`${s} === "boolean" || ${o} === null
              || (${s} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,Ee._)`+${o}`);return;case"boolean":n.elseIf((0,Ee._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,Ee._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,Ee._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,Ee._)`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${o} === null`).assign(a,(0,Ee._)`[${o}]`)}}}function gre({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,Ee._)`${e} !== undefined`,()=>t.assign((0,Ee._)`${e}[${r}]`,n))}function DI(t,e,r,n=qu.Correct){let o=n===qu.Correct?Ee.operators.EQ:Ee.operators.NEQ,i;switch(t){case"null":return(0,Ee._)`${e} ${o} null`;case"array":i=(0,Ee._)`Array.isArray(${e})`;break;case"object":i=(0,Ee._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":i=s((0,Ee._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":i=s();break;default:return(0,Ee._)`typeof ${e} ${o} ${t}`}return n===qu.Correct?i:(0,Ee.not)(i);function s(a=Ee.nil){return(0,Ee.and)((0,Ee._)`typeof ${e} == "number"`,a,r?(0,Ee._)`isFinite(${e})`:Ee.nil)}}Zr.checkDataType=DI;function qI(t,e,r,n){if(t.length===1)return DI(t[0],e,r,n);let o,i=(0,TU.toHash)(t);if(i.array&&i.object){let s=(0,Ee._)`typeof ${e} != "object"`;o=i.null?s:(0,Ee._)`!${e} || ${s}`,delete i.null,delete i.array,delete i.object}else o=Ee.nil;i.number&&delete i.integer;for(let s in i)o=(0,Ee.and)(o,DI(s,e,r,n));return o}Zr.checkDataTypes=qI;var yre={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,Ee._)`{type: ${t}}`:(0,Ee._)`{type: ${e}}`};function BI(t){let e=vre(t);(0,dre.reportError)(e,yre)}Zr.reportTypeError=BI;function vre(t){let{gen:e,data:r,schema:n}=t,o=(0,TU.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var NU=y(rw=>{"use strict";Object.defineProperty(rw,"__esModule",{value:!0});rw.assignDefaults=void 0;var Bu=De(),bre=it();function _re(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)jU(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,i)=>jU(t,i,o.default))}rw.assignDefaults=_re;function jU(t,e,r){let{gen:n,compositeRule:o,data:i,opts:s}=t;if(r===void 0)return;let a=(0,Bu._)`${i}${(0,Bu.getProperty)(e)}`;if(o){(0,bre.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,Bu._)`${a} === undefined`;s.useDefaults==="empty"&&(c=(0,Bu._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,Bu._)`${a} = ${(0,Bu.stringify)(r)}`)}});var lo=y(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.validateUnion=yt.validateArray=yt.usePattern=yt.callValidateCode=yt.schemaProperties=yt.allSchemaProperties=yt.noPropertyInData=yt.propertyInData=yt.isOwnProperty=yt.hasPropFunc=yt.reportMissingProp=yt.checkMissingProp=yt.checkReportMissingProp=void 0;var zt=De(),UI=it(),ra=ns(),wre=it();function xre(t,e){let{gen:r,data:n,it:o}=t;r.if(FI(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,zt._)`${e}`},!0),t.error()})}yt.checkReportMissingProp=xre;function Sre({gen:t,data:e,it:{opts:r}},n,o){return(0,zt.or)(...n.map(i=>(0,zt.and)(FI(t,e,i,r.ownProperties),(0,zt._)`${o} = ${i}`)))}yt.checkMissingProp=Sre;function kre(t,e){t.setParams({missingProperty:e},!0),t.error()}yt.reportMissingProp=kre;function RU(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,zt._)`Object.prototype.hasOwnProperty`})}yt.hasPropFunc=RU;function LI(t,e,r){return(0,zt._)`${RU(t)}.call(${e}, ${r})`}yt.isOwnProperty=LI;function Are(t,e,r,n){let o=(0,zt._)`${e}${(0,zt.getProperty)(r)} !== undefined`;return n?(0,zt._)`${o} && ${LI(t,e,r)}`:o}yt.propertyInData=Are;function FI(t,e,r,n){let o=(0,zt._)`${e}${(0,zt.getProperty)(r)} === undefined`;return n?(0,zt.or)(o,(0,zt.not)(LI(t,e,r))):o}yt.noPropertyInData=FI;function zU(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}yt.allSchemaProperties=zU;function $re(t,e){return zU(e).filter(r=>!(0,UI.alwaysValidSchema)(t,e[r]))}yt.schemaProperties=$re;function Pre({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:i},it:s},a,c,l){let u=l?(0,zt._)`${t}, ${e}, ${n}${o}`:e,d=[[ra.default.instancePath,(0,zt.strConcat)(ra.default.instancePath,i)],[ra.default.parentData,s.parentData],[ra.default.parentDataProperty,s.parentDataProperty],[ra.default.rootData,ra.default.rootData]];s.opts.dynamicRef&&d.push([ra.default.dynamicAnchors,ra.default.dynamicAnchors]);let p=(0,zt._)`${u}, ${r.object(...d)}`;return c!==zt.nil?(0,zt._)`${a}.call(${c}, ${p})`:(0,zt._)`${a}(${p})`}yt.callValidateCode=Pre;var Cre=(0,zt._)`new RegExp`;function Ire({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,i=o(r,n);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,zt._)`${o.code==="new RegExp"?Cre:(0,wre.useFunc)(t,o)}(${r}, ${n})`})}yt.usePattern=Ire;function Tre(t){let{gen:e,data:r,keyword:n,it:o}=t,i=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(i,!0),s(()=>e.break()),i;function s(a){let c=e.const("len",(0,zt._)`${r}.length`);e.forRange("i",0,c,l=>{t.subschema({keyword:n,dataProp:l,dataPropType:UI.Type.Num},i),e.if((0,zt.not)(i),a)})}}yt.validateArray=Tre;function Ere(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,UI.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let s=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,l)=>{let u=t.subschema({keyword:n,schemaProp:l,compositeRule:!0},a);e.assign(s,(0,zt._)`${s} || ${a}`),t.mergeValidEvaluated(u,a)||e.if((0,zt.not)(s))})),t.result(s,()=>t.reset(),()=>t.error(!0))}yt.validateUnion=Ere});var qU=y(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.validateKeywordUsage=gi.validSchemaType=gi.funcKeywordCode=gi.macroKeywordCode=void 0;var un=De(),ac=ns(),Ore=lo(),jre=Um();function Nre(t,e){let{gen:r,keyword:n,schema:o,parentSchema:i,it:s}=t,a=e.macro.call(s.self,o,i,s),c=DU(r,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);let l=r.name("valid");t.subschema({schema:a,schemaPath:un.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},l),t.pass(l,()=>t.error(!0))}gi.macroKeywordCode=Nre;function Rre(t,e){var r;let{gen:n,keyword:o,schema:i,parentSchema:s,$data:a,it:c}=t;Mre(c,e);let l=!a&&e.compile?e.compile.call(c.self,i,s,c):e.validate,u=DU(n,o,l),d=n.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)h(),e.modifying&&MU(t),g(()=>t.error());else{let v=e.async?f():m();e.modifying&&MU(t),g(()=>zre(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>h((0,un._)`await `),b=>n.assign(d,!1).if((0,un._)`${b} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,un._)`${b}.errors`),()=>n.throw(b))),v}function m(){let v=(0,un._)`${u}.errors`;return n.assign(v,null),h(un.nil),v}function h(v=e.async?(0,un._)`await `:un.nil){let b=c.opts.passContext?ac.default.this:ac.default.self,S=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,un._)`${v}${(0,Ore.callValidateCode)(t,u,b,S)}`,e.modifying)}function g(v){var b;n.if((0,un.not)((b=e.valid)!==null&&b!==void 0?b:d),v)}}gi.funcKeywordCode=Rre;function MU(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,un._)`${n.parentData}[${n.parentDataProperty}]`))}function zre(t,e){let{gen:r}=t;r.if((0,un._)`Array.isArray(${e})`,()=>{r.assign(ac.default.vErrors,(0,un._)`${ac.default.vErrors} === null ? ${e} : ${ac.default.vErrors}.concat(${e})`).assign(ac.default.errors,(0,un._)`${ac.default.vErrors}.length`),(0,jre.extendErrors)(t)},()=>t.error())}function Mre({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function DU(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,un.stringify)(r)})}function Dre(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}gi.validSchemaType=Dre;function qre({schema:t,opts:e,self:r,errSchemaPath:n},o,i){if(Array.isArray(o.keyword)?!o.keyword.includes(i):o.keyword!==i)throw new Error("ajv implementation error");let s=o.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${i}: ${s.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[i])){let c=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}gi.validateKeywordUsage=qre});var UU=y(na=>{"use strict";Object.defineProperty(na,"__esModule",{value:!0});na.extendSubschemaMode=na.extendSubschemaData=na.getSubschema=void 0;var yi=De(),BU=it();function Bre(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:i,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,yi._)`${t.schemaPath}${(0,yi.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,yi._)`${t.schemaPath}${(0,yi.getProperty)(e)}${(0,yi.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,BU.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||i===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:s,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}na.getSubschema=Bre;function Ure(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:i,propertyName:s}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:l,dataPathArr:u,opts:d}=e,p=a.let("data",(0,yi._)`${e.data}${(0,yi.getProperty)(r)}`,!0);c(p),t.errorPath=(0,yi.str)`${l}${(0,BU.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,yi._)`${r}`,t.dataPathArr=[...u,t.parentDataProperty]}if(o!==void 0){let l=o instanceof yi.Name?o:a.let("data",o,!0);c(l),s!==void 0&&(t.propertyName=s)}i&&(t.dataTypes=i);function c(l){t.data=l,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,l]}}na.extendSubschemaData=Ure;function Lre(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:i}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),i!==void 0&&(t.allErrors=i),t.jtdDiscriminator=e,t.jtdMetadata=r}na.extendSubschemaMode=Lre});var Fm=y((oCe,LU)=>{"use strict";LU.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,i;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,i[o]))return!1;for(o=n;o--!==0;){var s=i[o];if(!t(e[s],r[s]))return!1}return!0}return e!==e&&r!==r}});var VU=y((iCe,FU)=>{"use strict";var oa=FU.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};nw(e,n,o,t,"",t)};oa.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};oa.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};oa.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};oa.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function nw(t,e,r,n,o,i,s,a,c,l){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,i,s,a,c,l);for(var u in n){var d=n[u];if(Array.isArray(d)){if(u in oa.arrayKeywords)for(var p=0;p<d.length;p++)nw(t,e,r,d[p],o+"/"+u+"/"+p,i,o,u,n,p)}else if(u in oa.propsKeywords){if(d&&typeof d=="object")for(var f in d)nw(t,e,r,d[f],o+"/"+u+"/"+Fre(f),i,o,u,n,f)}else(u in oa.keywords||t.allKeys&&!(u in oa.skipKeywords))&&nw(t,e,r,d,o+"/"+u,i,o,u,n)}r(n,o,i,s,a,c,l)}}function Fre(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var Vm=y(wn=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.getSchemaRefs=wn.resolveUrl=wn.normalizeId=wn._getFullPath=wn.getFullPath=wn.inlineRef=void 0;var Vre=it(),Hre=Fm(),Gre=VU(),Wre=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Zre(t,e=!0){return typeof t=="boolean"?!0:e===!0?!VI(t):e?HU(t)<=e:!1}wn.inlineRef=Zre;var Kre=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function VI(t){for(let e in t){if(Kre.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(VI)||typeof r=="object"&&VI(r))return!0}return!1}function HU(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!Wre.has(r)&&(typeof t[r]=="object"&&(0,Vre.eachItem)(t[r],n=>e+=HU(n)),e===1/0))return 1/0}return e}function GU(t,e="",r){r!==!1&&(e=Uu(e));let n=t.parse(e);return WU(t,n)}wn.getFullPath=GU;function WU(t,e){return t.serialize(e).split("#")[0]+"#"}wn._getFullPath=WU;var Jre=/#\/?$/;function Uu(t){return t?t.replace(Jre,""):""}wn.normalizeId=Uu;function Yre(t,e,r){return r=Uu(r),t.resolve(e,r)}wn.resolveUrl=Yre;var Qre=/^[a-z_][-a-z0-9._]*$/i;function Xre(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=Uu(t[r]||e),i={"":o},s=GU(n,o,!1),a={},c=new Set;return Gre(t,{allKeys:!0},(d,p,f,m)=>{if(m===void 0)return;let h=s+p,g=i[m];typeof d[r]=="string"&&(g=v.call(this,d[r])),b.call(this,d.$anchor),b.call(this,d.$dynamicAnchor),i[p]=g;function v(S){let j=this.opts.uriResolver.resolve;if(S=Uu(g?j(g,S):S),c.has(S))throw u(S);c.add(S);let C=this.refs[S];return typeof C=="string"&&(C=this.refs[C]),typeof C=="object"?l(d,C.schema,S):S!==Uu(h)&&(S[0]==="#"?(l(d,a[S],S),a[S]=d):this.refs[S]=h),S}function b(S){if(typeof S=="string"){if(!Qre.test(S))throw new Error(`invalid anchor "${S}"`);v.call(this,`#${S}`)}}}),a;function l(d,p,f){if(p!==void 0&&!Hre(d,p))throw u(f)}function u(d){return new Error(`reference "${d}" resolves to more than one schema`)}}wn.getSchemaRefs=Xre});var Wm=y(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.getData=ia.KeywordCxt=ia.validateFunctionCode=void 0;var QU=PU(),ZU=Lm(),GI=MI(),ow=Lm(),ene=NU(),Gm=qU(),HI=UU(),ae=De(),Se=ns(),tne=Vm(),os=it(),Hm=Um();function rne(t){if(tL(t)&&(rL(t),eL(t))){ine(t);return}XU(t,()=>(0,QU.topBoolOrEmptySchema)(t))}ia.validateFunctionCode=rne;function XU({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},i){o.code.es5?t.func(e,(0,ae._)`${Se.default.data}, ${Se.default.valCxt}`,n.$async,()=>{t.code((0,ae._)`"use strict"; ${KU(r,o)}`),one(t,o),t.code(i)}):t.func(e,(0,ae._)`${Se.default.data}, ${nne(o)}`,n.$async,()=>t.code(KU(r,o)).code(i))}function nne(t){return(0,ae._)`{${Se.default.instancePath}="", ${Se.default.parentData}, ${Se.default.parentDataProperty}, ${Se.default.rootData}=${Se.default.data}${t.dynamicRef?(0,ae._)`, ${Se.default.dynamicAnchors}={}`:ae.nil}}={}`}function one(t,e){t.if(Se.default.valCxt,()=>{t.var(Se.default.instancePath,(0,ae._)`${Se.default.valCxt}.${Se.default.instancePath}`),t.var(Se.default.parentData,(0,ae._)`${Se.default.valCxt}.${Se.default.parentData}`),t.var(Se.default.parentDataProperty,(0,ae._)`${Se.default.valCxt}.${Se.default.parentDataProperty}`),t.var(Se.default.rootData,(0,ae._)`${Se.default.valCxt}.${Se.default.rootData}`),e.dynamicRef&&t.var(Se.default.dynamicAnchors,(0,ae._)`${Se.default.valCxt}.${Se.default.dynamicAnchors}`)},()=>{t.var(Se.default.instancePath,(0,ae._)`""`),t.var(Se.default.parentData,(0,ae._)`undefined`),t.var(Se.default.parentDataProperty,(0,ae._)`undefined`),t.var(Se.default.rootData,Se.default.data),e.dynamicRef&&t.var(Se.default.dynamicAnchors,(0,ae._)`{}`)})}function ine(t){let{schema:e,opts:r,gen:n}=t;XU(t,()=>{r.$comment&&e.$comment&&oL(t),une(t),n.let(Se.default.vErrors,null),n.let(Se.default.errors,0),r.unevaluated&&sne(t),nL(t),fne(t)})}function sne(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,ae._)`${r}.evaluated`),e.if((0,ae._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,ae._)`${t.evaluated}.props`,(0,ae._)`undefined`)),e.if((0,ae._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,ae._)`${t.evaluated}.items`,(0,ae._)`undefined`))}function KU(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,ae._)`/*# sourceURL=${r} */`:ae.nil}function ane(t,e){if(tL(t)&&(rL(t),eL(t))){cne(t,e);return}(0,QU.boolOrEmptySchema)(t,e)}function eL({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function tL(t){return typeof t.schema!="boolean"}function cne(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&oL(t),dne(t),pne(t);let i=n.const("_errs",Se.default.errors);nL(t,i),n.var(e,(0,ae._)`${i} === ${Se.default.errors}`)}function rL(t){(0,os.checkUnknownRules)(t),lne(t)}function nL(t,e){if(t.opts.jtd)return JU(t,[],!1,e);let r=(0,ZU.getSchemaTypes)(t.schema),n=(0,ZU.coerceAndCheckDataType)(t,r);JU(t,r,!n,e)}function lne(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,os.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function une(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,os.checkStrictMode)(t,"default is ignored in the schema root")}function dne(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,tne.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function pne(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function oL({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let i=r.$comment;if(o.$comment===!0)t.code((0,ae._)`${Se.default.self}.logger.log(${i})`);else if(typeof o.$comment=="function"){let s=(0,ae.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,ae._)`${Se.default.self}.opts.$comment(${i}, ${s}, ${a}.schema)`)}}function fne(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:i}=t;r.$async?e.if((0,ae._)`${Se.default.errors} === 0`,()=>e.return(Se.default.data),()=>e.throw((0,ae._)`new ${o}(${Se.default.vErrors})`)):(e.assign((0,ae._)`${n}.errors`,Se.default.vErrors),i.unevaluated&&mne(t),e.return((0,ae._)`${Se.default.errors} === 0`))}function mne({gen:t,evaluated:e,props:r,items:n}){r instanceof ae.Name&&t.assign((0,ae._)`${e}.props`,r),n instanceof ae.Name&&t.assign((0,ae._)`${e}.items`,n)}function JU(t,e,r,n){let{gen:o,schema:i,data:s,allErrors:a,opts:c,self:l}=t,{RULES:u}=l;if(i.$ref&&(c.ignoreKeywordsWithRef||!(0,os.schemaHasRulesButRef)(i,u))){o.block(()=>sL(t,"$ref",u.all.$ref.definition));return}c.jtd||hne(t,e),o.block(()=>{for(let p of u.rules)d(p);d(u.post)});function d(p){(0,GI.shouldUseGroup)(i,p)&&(p.type?(o.if((0,ow.checkDataType)(p.type,s,c.strictNumbers)),YU(t,p),e.length===1&&e[0]===p.type&&r&&(o.else(),(0,ow.reportTypeError)(t)),o.endIf()):YU(t,p),a||o.if((0,ae._)`${Se.default.errors} === ${n||0}`))}}function YU(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,ene.assignDefaults)(t,e.type),r.block(()=>{for(let i of e.rules)(0,GI.shouldUseRule)(n,i)&&sL(t,i.keyword,i.definition,e.type)})}function hne(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(gne(t,e),t.opts.allowUnionTypes||yne(t,e),vne(t,t.dataTypes))}function gne(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{iL(t.dataTypes,r)||WI(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),_ne(t,e)}}function yne(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&WI(t,"use allowUnionTypes to allow union type keyword")}function vne(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,GI.shouldUseRule)(t.schema,o)){let{type:i}=o.definition;i.length&&!i.some(s=>bne(e,s))&&WI(t,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function bne(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function iL(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function _ne(t,e){let r=[];for(let n of t.dataTypes)iL(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function WI(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,os.checkStrictMode)(t,e,t.opts.strictTypes)}var iw=class{constructor(e,r,n){if((0,Gm.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,os.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",aL(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,Gm.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",Se.default.errors))}result(e,r,n){this.failResult((0,ae.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,ae.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,ae._)`${r} !== undefined && (${(0,ae.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?Hm.reportExtraError:Hm.reportError)(this,this.def.error,r)}$dataError(){(0,Hm.reportError)(this,this.def.$dataError||Hm.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Hm.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=ae.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=ae.nil,r=ae.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:i,def:s}=this;n.if((0,ae.or)((0,ae._)`${o} === undefined`,r)),e!==ae.nil&&n.assign(e,!0),(i.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==ae.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:i}=this;return(0,ae.or)(s(),a());function s(){if(n.length){if(!(r instanceof ae.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,ae._)`${(0,ow.checkDataTypes)(c,r,i.opts.strictNumbers,ow.DataType.Wrong)}`}return ae.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,ae._)`!${c}(${r})`}return ae.nil}}subschema(e,r){let n=(0,HI.getSubschema)(this.it,e);(0,HI.extendSubschemaData)(n,this.it,e),(0,HI.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return ane(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=os.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=os.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,ae.Name)),!0}};ia.KeywordCxt=iw;function sL(t,e,r,n){let o=new iw(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,Gm.funcKeywordCode)(o,r):"macro"in r?(0,Gm.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,Gm.funcKeywordCode)(o,r)}var wne=/^\/(?:[^~]|~0|~1)*$/,xne=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function aL(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,i;if(t==="")return Se.default.rootData;if(t[0]==="/"){if(!wne.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,i=Se.default.rootData}else{let l=xne.exec(t);if(!l)throw new Error(`Invalid JSON-pointer: ${t}`);let u=+l[1];if(o=l[2],o==="#"){if(u>=e)throw new Error(c("property/index",u));return n[e-u]}if(u>e)throw new Error(c("data",u));if(i=r[e-u],!o)return i}let s=i,a=o.split("/");for(let l of a)l&&(i=(0,ae._)`${i}${(0,ae.getProperty)((0,os.unescapeJsonPointer)(l))}`,s=(0,ae._)`${s} && ${i}`);return s;function c(l,u){return`Cannot access ${l} ${u} levels up, current level is ${e}`}}ia.getData=aL});var sw=y(KI=>{"use strict";Object.defineProperty(KI,"__esModule",{value:!0});var ZI=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};KI.default=ZI});var Zm=y(QI=>{"use strict";Object.defineProperty(QI,"__esModule",{value:!0});var JI=Vm(),YI=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,JI.resolveUrl)(e,r,n),this.missingSchema=(0,JI.normalizeId)((0,JI.getFullPath)(e,this.missingRef))}};QI.default=YI});var cw=y(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.resolveSchema=uo.getCompilingSchema=uo.resolveRef=uo.compileSchema=uo.SchemaEnv=void 0;var Do=De(),Sne=sw(),cc=ns(),qo=Vm(),cL=it(),kne=Wm(),Lu=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,qo.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};uo.SchemaEnv=Lu;function eT(t){let e=lL.call(this,t);if(e)return e;let r=(0,qo.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:i}=this.opts,s=new Do.CodeGen(this.scope,{es5:n,lines:o,ownProperties:i}),a;t.$async&&(a=s.scopeValue("Error",{ref:Sne.default,code:(0,Do._)`require("ajv/dist/runtime/validation_error").default`}));let c=s.scopeName("validate");t.validateName=c;let l={gen:s,allErrors:this.opts.allErrors,data:cc.default.data,parentData:cc.default.parentData,parentDataProperty:cc.default.parentDataProperty,dataNames:[cc.default.data],dataPathArr:[Do.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,Do.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:Do.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,Do._)`""`,opts:this.opts,self:this},u;try{this._compilations.add(t),(0,kne.validateFunctionCode)(l),s.optimize(this.opts.code.optimize);let d=s.toString();u=`${s.scopeRefs(cc.default.scope)}return ${d}`,this.opts.code.process&&(u=this.opts.code.process(u,t));let f=new Function(`${cc.default.self}`,`${cc.default.scope}`,u)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:s._values}),this.opts.unevaluated){let{props:m,items:h}=l;f.evaluated={props:m instanceof Do.Name?void 0:m,items:h instanceof Do.Name?void 0:h,dynamicProps:m instanceof Do.Name,dynamicItems:h instanceof Do.Name},f.source&&(f.source.evaluated=(0,Do.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,u&&this.logger.error("Error compiling schema, function code:",u),d}finally{this._compilations.delete(t)}}uo.compileSchema=eT;function Ane(t,e,r){var n;r=(0,qo.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let i=Cne.call(this,t,r);if(i===void 0){let s=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;s&&(i=new Lu({schema:s,schemaId:a,root:t,baseId:e}))}if(i!==void 0)return t.refs[r]=$ne.call(this,i)}uo.resolveRef=Ane;function $ne(t){return(0,qo.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:eT.call(this,t)}function lL(t){for(let e of this._compilations)if(Pne(e,t))return e}uo.getCompilingSchema=lL;function Pne(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function Cne(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||aw.call(this,t,e)}function aw(t,e){let r=this.opts.uriResolver.parse(e),n=(0,qo._getFullPath)(this.opts.uriResolver,r),o=(0,qo.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return XI.call(this,r,t);let i=(0,qo.normalizeId)(n),s=this.refs[i]||this.schemas[i];if(typeof s=="string"){let a=aw.call(this,t,s);return typeof a?.schema!="object"?void 0:XI.call(this,r,a)}if(typeof s?.schema=="object"){if(s.validate||eT.call(this,s),i===(0,qo.normalizeId)(e)){let{schema:a}=s,{schemaId:c}=this.opts,l=a[c];return l&&(o=(0,qo.resolveUrl)(this.opts.uriResolver,o,l)),new Lu({schema:a,schemaId:c,root:t,baseId:o})}return XI.call(this,r,s)}}uo.resolveSchema=aw;var Ine=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function XI(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,cL.unescapeFragment)(a)];if(c===void 0)return;r=c;let l=typeof r=="object"&&r[this.opts.schemaId];!Ine.has(a)&&l&&(e=(0,qo.resolveUrl)(this.opts.uriResolver,e,l))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,cL.schemaHasRulesButRef)(r,this.RULES)){let a=(0,qo.resolveUrl)(this.opts.uriResolver,e,r.$ref);i=aw.call(this,n,a)}let{schemaId:s}=this.opts;if(i=i||new Lu({schema:r,schemaId:s,root:n,baseId:e}),i.schema!==i.root.schema)return i}});var uL=y((dCe,Tne)=>{Tne.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var rT=y((pCe,mL)=>{"use strict";var Ene=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),pL=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function tT(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var One=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function dL(t){return t.length=0,!0}function jne(t,e,r){if(t.length){let n=tT(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function Nne(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],i=!1,s=!1,a=jne;for(let c=0;c<t.length;c++){let l=t[c];if(!(l==="["||l==="]"))if(l===":"){if(i===!0&&(s=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(i=!0),n.push(":");continue}else if(l==="%"){if(!a(o,n,r))break;a=dL}else{o.push(l);continue}}return o.length&&(a===dL?r.zone=o.join(""):s?n.push(o.join("")):n.push(tT(o))),r.address=n.join(""),r}function fL(t){if(Rne(t,":")<2)return{host:t,isIPV6:!1};let e=Nne(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function Rne(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function zne(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function Mne(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function Dne(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!pL(r)){let n=fL(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}mL.exports={nonSimpleDomain:One,recomposeAuthority:Dne,normalizeComponentEncoding:Mne,removeDotSegments:zne,isIPv4:pL,isUUID:Ene,normalizeIPv6:fL,stringArrayToHexStripped:tT}});var bL=y((fCe,vL)=>{"use strict";var{isUUID:qne}=rT(),Bne=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,Une=["http","https","ws","wss","urn","urn:uuid"];function Lne(t){return Une.indexOf(t)!==-1}function nT(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function hL(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function gL(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function Fne(t){return t.secure=nT(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function Vne(t){if((t.port===(nT(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function Hne(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(Bne);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,i=oT(o);t.path=void 0,i&&(t=i.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function Gne(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,i=oT(o);i&&(t=i.serialize(t,e));let s=t,a=t.nss;return s.path=`${n||e.nid}:${a}`,e.skipEscape=!0,s}function Wne(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!qne(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function Zne(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var yL={scheme:"http",domainHost:!0,parse:hL,serialize:gL},Kne={scheme:"https",domainHost:yL.domainHost,parse:hL,serialize:gL},lw={scheme:"ws",domainHost:!0,parse:Fne,serialize:Vne},Jne={scheme:"wss",domainHost:lw.domainHost,parse:lw.parse,serialize:lw.serialize},Yne={scheme:"urn",parse:Hne,serialize:Gne,skipNormalize:!0},Qne={scheme:"urn:uuid",parse:Wne,serialize:Zne,skipNormalize:!0},uw={http:yL,https:Kne,ws:lw,wss:Jne,urn:Yne,"urn:uuid":Qne};Object.setPrototypeOf(uw,null);function oT(t){return t&&(uw[t]||uw[t.toLowerCase()])||void 0}vL.exports={wsIsSecure:nT,SCHEMES:uw,isValidSchemeName:Lne,getSchemeHandler:oT}});var sT=y((mCe,pw)=>{"use strict";var{normalizeIPv6:Xne,removeDotSegments:Km,recomposeAuthority:eoe,normalizeComponentEncoding:dw,isIPv4:toe,nonSimpleDomain:roe}=rT(),{SCHEMES:noe,getSchemeHandler:_L}=bL();function ooe(t,e){return typeof t=="string"?t=vi(is(t,e),e):typeof t=="object"&&(t=is(vi(t,e),e)),t}function ioe(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=wL(is(t,n),is(e,n),n,!0);return n.skipEscape=!0,vi(o,n)}function wL(t,e,r,n){let o={};return n||(t=is(vi(t,r),r),e=is(vi(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=Km(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=Km(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=Km(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=Km(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function soe(t,e,r){return typeof t=="string"?(t=unescape(t),t=vi(dw(is(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=vi(dw(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=vi(dw(is(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=vi(dw(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function vi(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],i=_L(n.scheme||r.scheme);i&&i.serialize&&i.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let s=eoe(r);if(s!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(s),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!i||!i.absolutePath)&&(a=Km(a)),s===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var aoe=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function is(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let i=t.match(aoe);if(i){if(n.scheme=i[1],n.userinfo=i[3],n.host=i[4],n.port=parseInt(i[5],10),n.path=i[6]||"",n.query=i[7],n.fragment=i[8],isNaN(n.port)&&(n.port=i[5]),n.host)if(toe(n.host)===!1){let c=Xne(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let s=_L(r.scheme||n.scheme);if(!r.unicodeSupport&&(!s||!s.unicodeSupport)&&n.host&&(r.domainHost||s&&s.domainHost)&&o===!1&&roe(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!s||s&&!s.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),s&&s.parse&&s.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var iT={SCHEMES:noe,normalize:ooe,resolve:ioe,resolveComponent:wL,equal:soe,serialize:vi,parse:is};pw.exports=iT;pw.exports.default=iT;pw.exports.fastUri=iT});var SL=y(aT=>{"use strict";Object.defineProperty(aT,"__esModule",{value:!0});var xL=sT();xL.code='require("ajv/dist/runtime/uri").default';aT.default=xL});var EL=y(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.CodeGen=Rr.Name=Rr.nil=Rr.stringify=Rr.str=Rr._=Rr.KeywordCxt=void 0;var coe=Wm();Object.defineProperty(Rr,"KeywordCxt",{enumerable:!0,get:function(){return coe.KeywordCxt}});var Fu=De();Object.defineProperty(Rr,"_",{enumerable:!0,get:function(){return Fu._}});Object.defineProperty(Rr,"str",{enumerable:!0,get:function(){return Fu.str}});Object.defineProperty(Rr,"stringify",{enumerable:!0,get:function(){return Fu.stringify}});Object.defineProperty(Rr,"nil",{enumerable:!0,get:function(){return Fu.nil}});Object.defineProperty(Rr,"Name",{enumerable:!0,get:function(){return Fu.Name}});Object.defineProperty(Rr,"CodeGen",{enumerable:!0,get:function(){return Fu.CodeGen}});var loe=sw(),CL=Zm(),uoe=zI(),Jm=cw(),doe=De(),Ym=Vm(),fw=Lm(),lT=it(),kL=uL(),poe=SL(),IL=(t,e)=>new RegExp(t,e);IL.code="new RegExp";var foe=["removeAdditional","useDefaults","coerceTypes"],moe=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),hoe={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},goe={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},AL=200;function yoe(t){var e,r,n,o,i,s,a,c,l,u,d,p,f,m,h,g,v,b,S,j,C,ie,pe,me,Ce;let Ge=t.strict,dr=(e=t.code)===null||e===void 0?void 0:e.optimize,nn=dr===!0||dr===void 0?1:dr||0,Yt=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:IL,di=(o=t.uriResolver)!==null&&o!==void 0?o:poe.default;return{strictSchema:(s=(i=t.strictSchema)!==null&&i!==void 0?i:Ge)!==null&&s!==void 0?s:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:Ge)!==null&&c!==void 0?c:!0,strictTypes:(u=(l=t.strictTypes)!==null&&l!==void 0?l:Ge)!==null&&u!==void 0?u:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:Ge)!==null&&p!==void 0?p:"log",strictRequired:(m=(f=t.strictRequired)!==null&&f!==void 0?f:Ge)!==null&&m!==void 0?m:!1,code:t.code?{...t.code,optimize:nn,regExp:Yt}:{optimize:nn,regExp:Yt},loopRequired:(h=t.loopRequired)!==null&&h!==void 0?h:AL,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:AL,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:(b=t.messages)!==null&&b!==void 0?b:!0,inlineRefs:(S=t.inlineRefs)!==null&&S!==void 0?S:!0,schemaId:(j=t.schemaId)!==null&&j!==void 0?j:"$id",addUsedSchema:(C=t.addUsedSchema)!==null&&C!==void 0?C:!0,validateSchema:(ie=t.validateSchema)!==null&&ie!==void 0?ie:!0,validateFormats:(pe=t.validateFormats)!==null&&pe!==void 0?pe:!0,unicodeRegExp:(me=t.unicodeRegExp)!==null&&me!==void 0?me:!0,int32range:(Ce=t.int32range)!==null&&Ce!==void 0?Ce:!0,uriResolver:di}}var Qm=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...yoe(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new doe.ValueScope({scope:{},prefixes:moe,es5:r,lines:n}),this.logger=Soe(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,uoe.getRules)(),$L.call(this,hoe,e,"NOT SUPPORTED"),$L.call(this,goe,e,"DEPRECATED","warn"),this._metaOpts=woe.call(this),e.formats&&boe.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&_oe.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),voe.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=kL;n==="id"&&(o={...kL},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(u,d){await i.call(this,u.$schema);let p=this._addSchema(u,d);return p.validate||s.call(this,p)}async function i(u){u&&!this.getSchema(u)&&await o.call(this,{$ref:u},!0)}async function s(u){try{return this._compileSchemaEnv(u)}catch(d){if(!(d instanceof CL.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),s.call(this,u)}}function a({missingSchema:u,missingRef:d}){if(this.refs[u])throw new Error(`AnySchema ${u} is loaded but ${d} cannot be resolved`)}async function c(u){let d=await l.call(this,u);this.refs[u]||await i.call(this,d.$schema),this.refs[u]||this.addSchema(d,u,r)}async function l(u){let d=this._loading[u];if(d)return d;try{return await(this._loading[u]=n(u))}finally{delete this._loading[u]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let s of e)this.addSchema(s,void 0,n,o);return this}let i;if(typeof e=="object"){let{schemaId:s}=this.opts;if(i=e[s],i!==void 0&&typeof i!="string")throw new Error(`schema ${s} must be string`)}return r=(0,Ym.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return o}getSchema(e){let r;for(;typeof(r=PL.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new Jm.SchemaEnv({schema:{},schemaId:n});if(r=Jm.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=PL.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,Ym.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Aoe.call(this,n,r),!r)return(0,lT.eachItem)(n,i=>cT.call(this,i)),this;Poe.call(this,r);let o={...r,type:(0,fw.getJSONTypes)(r.type),schemaType:(0,fw.getJSONTypes)(r.schemaType)};return(0,lT.eachItem)(n,o.type.length===0?i=>cT.call(this,i,o):i=>o.type.forEach(s=>cT.call(this,i,o,s))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(i=>i.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,i)=>o+r+i)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let i=o.split("/").slice(1),s=e;for(let a of i)s=s[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:l}=c.definition,u=s[a];l&&u&&(s[a]=TL(u))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,i=this.opts.addUsedSchema){let s,{schemaId:a}=this.opts;if(typeof e=="object")s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,Ym.normalizeId)(s||n);let l=Ym.getSchemaRefs.call(this,e,n);return c=new Jm.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:l}),this._cache.set(c.schema,c),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):Jm.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{Jm.compileSchema.call(this,e)}finally{this.opts=r}}};Qm.ValidationError=loe.default;Qm.MissingRefError=CL.default;Rr.default=Qm;function $L(t,e,r,n="error"){for(let o in t){let i=o;i in e&&this.logger[n](`${r}: option ${o}. ${t[i]}`)}}function PL(t){return t=(0,Ym.normalizeId)(t),this.schemas[t]||this.refs[t]}function voe(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function boe(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function _oe(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function woe(){let t={...this.opts};for(let e of foe)delete t[e];return t}var xoe={log(){},warn(){},error(){}};function Soe(t){if(t===!1)return xoe;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var koe=/^[a-z_$][a-z0-9_$:-]*$/i;function Aoe(t,e){let{RULES:r}=this;if((0,lT.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!koe.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function cT(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,s=o?i.post:i.rules.find(({type:c})=>c===r);if(s||(s={type:r,rules:[]},i.rules.push(s)),i.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,fw.getJSONTypes)(e.type),schemaType:(0,fw.getJSONTypes)(e.schemaType)}};e.before?$oe.call(this,s,a,e.before):s.rules.push(a),i.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function $oe(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function Poe(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=TL(e)),t.validateSchema=this.compile(e,!0))}var Coe={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function TL(t){return{anyOf:[t,Coe]}}});var OL=y(uT=>{"use strict";Object.defineProperty(uT,"__esModule",{value:!0});var Ioe={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};uT.default=Ioe});var zL=y(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0});lc.callRef=lc.getValidate=void 0;var Toe=Zm(),jL=lo(),xn=De(),Vu=ns(),NL=cw(),mw=it(),Eoe={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:i,validateName:s,opts:a,self:c}=n,{root:l}=i;if((r==="#"||r==="#/")&&o===l.baseId)return d();let u=NL.resolveRef.call(c,l,o,r);if(u===void 0)throw new Toe.default(n.opts.uriResolver,o,r);if(u instanceof NL.SchemaEnv)return p(u);return f(u);function d(){if(i===l)return hw(t,s,i,i.$async);let m=e.scopeValue("root",{ref:l});return hw(t,(0,xn._)`${m}.validate`,l,l.$async)}function p(m){let h=RL(t,m);hw(t,h,m,m.$async)}function f(m){let h=e.scopeValue("schema",a.code.source===!0?{ref:m,code:(0,xn.stringify)(m)}:{ref:m}),g=e.name("valid"),v=t.subschema({schema:m,dataTypes:[],schemaPath:xn.nil,topSchemaRef:h,errSchemaPath:r},g);t.mergeEvaluated(v),t.ok(g)}}};function RL(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,xn._)`${r.scopeValue("wrapper",{ref:e})}.validate`}lc.getValidate=RL;function hw(t,e,r,n){let{gen:o,it:i}=t,{allErrors:s,schemaEnv:a,opts:c}=i,l=c.passContext?Vu.default.this:xn.nil;n?u():d();function u(){if(!a.$async)throw new Error("async schema referenced by sync schema");let m=o.let("valid");o.try(()=>{o.code((0,xn._)`await ${(0,jL.callValidateCode)(t,e,l)}`),f(e),s||o.assign(m,!0)},h=>{o.if((0,xn._)`!(${h} instanceof ${i.ValidationError})`,()=>o.throw(h)),p(h),s||o.assign(m,!1)}),t.ok(m)}function d(){t.result((0,jL.callValidateCode)(t,e,l),()=>f(e),()=>p(e))}function p(m){let h=(0,xn._)`${m}.errors`;o.assign(Vu.default.vErrors,(0,xn._)`${Vu.default.vErrors} === null ? ${h} : ${Vu.default.vErrors}.concat(${h})`),o.assign(Vu.default.errors,(0,xn._)`${Vu.default.vErrors}.length`)}function f(m){var h;if(!i.opts.unevaluated)return;let g=(h=r?.validate)===null||h===void 0?void 0:h.evaluated;if(i.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(i.props=mw.mergeEvaluated.props(o,g.props,i.props));else{let v=o.var("props",(0,xn._)`${m}.evaluated.props`);i.props=mw.mergeEvaluated.props(o,v,i.props,xn.Name)}if(i.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(i.items=mw.mergeEvaluated.items(o,g.items,i.items));else{let v=o.var("items",(0,xn._)`${m}.evaluated.items`);i.items=mw.mergeEvaluated.items(o,v,i.items,xn.Name)}}}lc.callRef=hw;lc.default=Eoe});var ML=y(dT=>{"use strict";Object.defineProperty(dT,"__esModule",{value:!0});var Ooe=OL(),joe=zL(),Noe=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",Ooe.default,joe.default];dT.default=Noe});var DL=y(pT=>{"use strict";Object.defineProperty(pT,"__esModule",{value:!0});var gw=De(),sa=gw.operators,yw={maximum:{okStr:"<=",ok:sa.LTE,fail:sa.GT},minimum:{okStr:">=",ok:sa.GTE,fail:sa.LT},exclusiveMaximum:{okStr:"<",ok:sa.LT,fail:sa.GTE},exclusiveMinimum:{okStr:">",ok:sa.GT,fail:sa.LTE}},Roe={message:({keyword:t,schemaCode:e})=>(0,gw.str)`must be ${yw[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,gw._)`{comparison: ${yw[t].okStr}, limit: ${e}}`},zoe={keyword:Object.keys(yw),type:"number",schemaType:"number",$data:!0,error:Roe,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,gw._)`${r} ${yw[e].fail} ${n} || isNaN(${r})`)}};pT.default=zoe});var qL=y(fT=>{"use strict";Object.defineProperty(fT,"__esModule",{value:!0});var Xm=De(),Moe={message:({schemaCode:t})=>(0,Xm.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,Xm._)`{multipleOf: ${t}}`},Doe={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:Moe,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,i=o.opts.multipleOfPrecision,s=e.let("res"),a=i?(0,Xm._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${i}`:(0,Xm._)`${s} !== parseInt(${s})`;t.fail$data((0,Xm._)`(${n} === 0 || (${s} = ${r}/${n}, ${a}))`)}};fT.default=Doe});var UL=y(mT=>{"use strict";Object.defineProperty(mT,"__esModule",{value:!0});function BL(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}mT.default=BL;BL.code='require("ajv/dist/runtime/ucs2length").default'});var LL=y(hT=>{"use strict";Object.defineProperty(hT,"__esModule",{value:!0});var uc=De(),qoe=it(),Boe=UL(),Uoe={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,uc.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,uc._)`{limit: ${t}}`},Loe={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:Uoe,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,i=e==="maxLength"?uc.operators.GT:uc.operators.LT,s=o.opts.unicode===!1?(0,uc._)`${r}.length`:(0,uc._)`${(0,qoe.useFunc)(t.gen,Boe.default)}(${r})`;t.fail$data((0,uc._)`${s} ${i} ${n}`)}};hT.default=Loe});var FL=y(gT=>{"use strict";Object.defineProperty(gT,"__esModule",{value:!0});var Foe=lo(),vw=De(),Voe={message:({schemaCode:t})=>(0,vw.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,vw._)`{pattern: ${t}}`},Hoe={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:Voe,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:i}=t,s=i.opts.unicodeRegExp?"u":"",a=r?(0,vw._)`(new RegExp(${o}, ${s}))`:(0,Foe.usePattern)(t,n);t.fail$data((0,vw._)`!${a}.test(${e})`)}};gT.default=Hoe});var VL=y(yT=>{"use strict";Object.defineProperty(yT,"__esModule",{value:!0});var eh=De(),Goe={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,eh.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,eh._)`{limit: ${t}}`},Woe={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:Goe,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?eh.operators.GT:eh.operators.LT;t.fail$data((0,eh._)`Object.keys(${r}).length ${o} ${n}`)}};yT.default=Woe});var HL=y(vT=>{"use strict";Object.defineProperty(vT,"__esModule",{value:!0});var th=lo(),rh=De(),Zoe=it(),Koe={message:({params:{missingProperty:t}})=>(0,rh.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,rh._)`{missingProperty: ${t}}`},Joe={keyword:"required",type:"object",schemaType:"array",$data:!0,error:Koe,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:i,it:s}=t,{opts:a}=s;if(!i&&r.length===0)return;let c=r.length>=a.loopRequired;if(s.allErrors?l():u(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:m}=t.it;for(let h of r)if(f?.[h]===void 0&&!m.has(h)){let g=s.schemaEnv.baseId+s.errSchemaPath,v=`required property "${h}" is not defined at "${g}" (strictRequired)`;(0,Zoe.checkStrictMode)(s,v,s.opts.strictRequired)}}function l(){if(c||i)t.block$data(rh.nil,d);else for(let f of r)(0,th.checkReportMissingProp)(t,f)}function u(){let f=e.let("missing");if(c||i){let m=e.let("valid",!0);t.block$data(m,()=>p(f,m)),t.ok(m)}else e.if((0,th.checkMissingProp)(t,r,f)),(0,th.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,th.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function p(f,m){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(m,(0,th.propertyInData)(e,o,f,a.ownProperties)),e.if((0,rh.not)(m),()=>{t.error(),e.break()})},rh.nil)}}};vT.default=Joe});var GL=y(bT=>{"use strict";Object.defineProperty(bT,"__esModule",{value:!0});var nh=De(),Yoe={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,nh.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,nh._)`{limit: ${t}}`},Qoe={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:Yoe,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?nh.operators.GT:nh.operators.LT;t.fail$data((0,nh._)`${r}.length ${o} ${n}`)}};bT.default=Qoe});var bw=y(_T=>{"use strict";Object.defineProperty(_T,"__esModule",{value:!0});var WL=Fm();WL.code='require("ajv/dist/runtime/equal").default';_T.default=WL});var ZL=y(xT=>{"use strict";Object.defineProperty(xT,"__esModule",{value:!0});var wT=Lm(),zr=De(),Xoe=it(),eie=bw(),tie={message:({params:{i:t,j:e}})=>(0,zr.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,zr._)`{i: ${t}, j: ${e}}`},rie={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:tie,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:i,schemaCode:s,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),l=i.items?(0,wT.getSchemaTypes)(i.items):[];t.block$data(c,u,(0,zr._)`${s} === false`),t.ok(c);function u(){let m=e.let("i",(0,zr._)`${r}.length`),h=e.let("j");t.setParams({i:m,j:h}),e.assign(c,!0),e.if((0,zr._)`${m} > 1`,()=>(d()?p:f)(m,h))}function d(){return l.length>0&&!l.some(m=>m==="object"||m==="array")}function p(m,h){let g=e.name("item"),v=(0,wT.checkDataTypes)(l,g,a.opts.strictNumbers,wT.DataType.Wrong),b=e.const("indices",(0,zr._)`{}`);e.for((0,zr._)`;${m}--;`,()=>{e.let(g,(0,zr._)`${r}[${m}]`),e.if(v,(0,zr._)`continue`),l.length>1&&e.if((0,zr._)`typeof ${g} == "string"`,(0,zr._)`${g} += "_"`),e.if((0,zr._)`typeof ${b}[${g}] == "number"`,()=>{e.assign(h,(0,zr._)`${b}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,zr._)`${b}[${g}] = ${m}`)})}function f(m,h){let g=(0,Xoe.useFunc)(e,eie.default),v=e.name("outer");e.label(v).for((0,zr._)`;${m}--;`,()=>e.for((0,zr._)`${h} = ${m}; ${h}--;`,()=>e.if((0,zr._)`${g}(${r}[${m}], ${r}[${h}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};xT.default=rie});var KL=y(kT=>{"use strict";Object.defineProperty(kT,"__esModule",{value:!0});var ST=De(),nie=it(),oie=bw(),iie={message:"must be equal to constant",params:({schemaCode:t})=>(0,ST._)`{allowedValue: ${t}}`},sie={keyword:"const",$data:!0,error:iie,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:i}=t;n||i&&typeof i=="object"?t.fail$data((0,ST._)`!${(0,nie.useFunc)(e,oie.default)}(${r}, ${o})`):t.fail((0,ST._)`${i} !== ${r}`)}};kT.default=sie});var JL=y(AT=>{"use strict";Object.defineProperty(AT,"__esModule",{value:!0});var oh=De(),aie=it(),cie=bw(),lie={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,oh._)`{allowedValues: ${t}}`},uie={keyword:"enum",schemaType:"array",$data:!0,error:lie,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:i,it:s}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=s.opts.loopEnum,c,l=()=>c??(c=(0,aie.useFunc)(e,cie.default)),u;if(a||n)u=e.let("valid"),t.block$data(u,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",i);u=(0,oh.or)(...o.map((m,h)=>p(f,h)))}t.pass(u);function d(){e.assign(u,!1),e.forOf("v",i,f=>e.if((0,oh._)`${l()}(${r}, ${f})`,()=>e.assign(u,!0).break()))}function p(f,m){let h=o[m];return typeof h=="object"&&h!==null?(0,oh._)`${l()}(${r}, ${f}[${m}])`:(0,oh._)`${r} === ${h}`}}};AT.default=uie});var YL=y($T=>{"use strict";Object.defineProperty($T,"__esModule",{value:!0});var die=DL(),pie=qL(),fie=LL(),mie=FL(),hie=VL(),gie=HL(),yie=GL(),vie=ZL(),bie=KL(),_ie=JL(),wie=[die.default,pie.default,fie.default,mie.default,hie.default,gie.default,yie.default,vie.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},bie.default,_ie.default];$T.default=wie});var CT=y(ih=>{"use strict";Object.defineProperty(ih,"__esModule",{value:!0});ih.validateAdditionalItems=void 0;var dc=De(),PT=it(),xie={message:({params:{len:t}})=>(0,dc.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,dc._)`{limit: ${t}}`},Sie={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:xie,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,PT.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}QL(t,n)}};function QL(t,e){let{gen:r,schema:n,data:o,keyword:i,it:s}=t;s.items=!0;let a=r.const("len",(0,dc._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,dc._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,PT.alwaysValidSchema)(s,n)){let l=r.var("valid",(0,dc._)`${a} <= ${e.length}`);r.if((0,dc.not)(l),()=>c(l)),t.ok(l)}function c(l){r.forRange("i",e.length,a,u=>{t.subschema({keyword:i,dataProp:u,dataPropType:PT.Type.Num},l),s.allErrors||r.if((0,dc.not)(l),()=>r.break())})}}ih.validateAdditionalItems=QL;ih.default=Sie});var IT=y(sh=>{"use strict";Object.defineProperty(sh,"__esModule",{value:!0});sh.validateTuple=void 0;var XL=De(),_w=it(),kie=lo(),Aie={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return e6(t,"additionalItems",e);r.items=!0,!(0,_w.alwaysValidSchema)(r,e)&&t.ok((0,kie.validateArray)(t))}};function e6(t,e,r=t.schema){let{gen:n,parentSchema:o,data:i,keyword:s,it:a}=t;u(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=_w.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),l=n.const("len",(0,XL._)`${i}.length`);r.forEach((d,p)=>{(0,_w.alwaysValidSchema)(a,d)||(n.if((0,XL._)`${l} > ${p}`,()=>t.subschema({keyword:s,schemaProp:p,dataProp:p},c)),t.ok(c))});function u(d){let{opts:p,errSchemaPath:f}=a,m=r.length,h=m===d.minItems&&(m===d.maxItems||d[e]===!1);if(p.strictTuples&&!h){let g=`"${s}" is ${m}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,_w.checkStrictMode)(a,g,p.strictTuples)}}}sh.validateTuple=e6;sh.default=Aie});var t6=y(TT=>{"use strict";Object.defineProperty(TT,"__esModule",{value:!0});var $ie=IT(),Pie={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,$ie.validateTuple)(t,"items")};TT.default=Pie});var n6=y(ET=>{"use strict";Object.defineProperty(ET,"__esModule",{value:!0});var r6=De(),Cie=it(),Iie=lo(),Tie=CT(),Eie={message:({params:{len:t}})=>(0,r6.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,r6._)`{limit: ${t}}`},Oie={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:Eie,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,Cie.alwaysValidSchema)(n,e)&&(o?(0,Tie.validateAdditionalItems)(t,o):t.ok((0,Iie.validateArray)(t)))}};ET.default=Oie});var o6=y(OT=>{"use strict";Object.defineProperty(OT,"__esModule",{value:!0});var po=De(),ww=it(),jie={message:({params:{min:t,max:e}})=>e===void 0?(0,po.str)`must contain at least ${t} valid item(s)`:(0,po.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,po._)`{minContains: ${t}}`:(0,po._)`{minContains: ${t}, maxContains: ${e}}`},Nie={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:jie,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t,s,a,{minContains:c,maxContains:l}=n;i.opts.next?(s=c===void 0?1:c,a=l):s=1;let u=e.const("len",(0,po._)`${o}.length`);if(t.setParams({min:s,max:a}),a===void 0&&s===0){(0,ww.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,ww.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,ww.alwaysValidSchema)(i,r)){let h=(0,po._)`${u} >= ${s}`;a!==void 0&&(h=(0,po._)`${h} && ${u} <= ${a}`),t.pass(h);return}i.items=!0;let d=e.name("valid");a===void 0&&s===1?f(d,()=>e.if(d,()=>e.break())):s===0?(e.let(d,!0),a!==void 0&&e.if((0,po._)`${o}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let h=e.name("_valid"),g=e.let("count",0);f(h,()=>e.if(h,()=>m(g)))}function f(h,g){e.forRange("i",0,u,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:ww.Type.Num,compositeRule:!0},h),g()})}function m(h){e.code((0,po._)`${h}++`),a===void 0?e.if((0,po._)`${h} >= ${s}`,()=>e.assign(d,!0).break()):(e.if((0,po._)`${h} > ${a}`,()=>e.assign(d,!1).break()),s===1?e.assign(d,!0):e.if((0,po._)`${h} >= ${s}`,()=>e.assign(d,!0)))}}};OT.default=Nie});var a6=y(bi=>{"use strict";Object.defineProperty(bi,"__esModule",{value:!0});bi.validateSchemaDeps=bi.validatePropertyDeps=bi.error=void 0;var jT=De(),Rie=it(),ah=lo();bi.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,jT.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,jT._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var zie={keyword:"dependencies",type:"object",schemaType:"object",error:bi.error,code(t){let[e,r]=Mie(t);i6(t,e),s6(t,r)}};function Mie({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function i6(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let i=r.let("missing");for(let s in e){let a=e[s];if(a.length===0)continue;let c=(0,ah.propertyInData)(r,n,s,o.opts.ownProperties);t.setParams({property:s,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let l of a)(0,ah.checkReportMissingProp)(t,l)}):(r.if((0,jT._)`${c} && (${(0,ah.checkMissingProp)(t,a,i)})`),(0,ah.reportMissingProp)(t,i),r.else())}}bi.validatePropertyDeps=i6;function s6(t,e=t.schema){let{gen:r,data:n,keyword:o,it:i}=t,s=r.name("valid");for(let a in e)(0,Rie.alwaysValidSchema)(i,e[a])||(r.if((0,ah.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},s);t.mergeValidEvaluated(c,s)},()=>r.var(s,!0)),t.ok(s))}bi.validateSchemaDeps=s6;bi.default=zie});var l6=y(NT=>{"use strict";Object.defineProperty(NT,"__esModule",{value:!0});var c6=De(),Die=it(),qie={message:"property name must be valid",params:({params:t})=>(0,c6._)`{propertyName: ${t.propertyName}}`},Bie={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:qie,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,Die.alwaysValidSchema)(o,r))return;let i=e.name("valid");e.forIn("key",n,s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},i),e.if((0,c6.not)(i),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(i)}};NT.default=Bie});var zT=y(RT=>{"use strict";Object.defineProperty(RT,"__esModule",{value:!0});var xw=lo(),Bo=De(),Uie=ns(),Sw=it(),Lie={message:"must NOT have additional properties",params:({params:t})=>(0,Bo._)`{additionalProperty: ${t.additionalProperty}}`},Fie={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:Lie,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:i,it:s}=t;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=s;if(s.props=!0,c.removeAdditional!=="all"&&(0,Sw.alwaysValidSchema)(s,r))return;let l=(0,xw.allSchemaProperties)(n.properties),u=(0,xw.allSchemaProperties)(n.patternProperties);d(),t.ok((0,Bo._)`${i} === ${Uie.default.errors}`);function d(){e.forIn("key",o,g=>{!l.length&&!u.length?m(g):e.if(p(g),()=>m(g))})}function p(g){let v;if(l.length>8){let b=(0,Sw.schemaRefOrVal)(s,n.properties,"properties");v=(0,xw.isOwnProperty)(e,b,g)}else l.length?v=(0,Bo.or)(...l.map(b=>(0,Bo._)`${g} === ${b}`)):v=Bo.nil;return u.length&&(v=(0,Bo.or)(v,...u.map(b=>(0,Bo._)`${(0,xw.usePattern)(t,b)}.test(${g})`))),(0,Bo.not)(v)}function f(g){e.code((0,Bo._)`delete ${o}[${g}]`)}function m(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,Sw.alwaysValidSchema)(s,r)){let v=e.name("valid");c.removeAdditional==="failing"?(h(g,v,!1),e.if((0,Bo.not)(v),()=>{t.reset(),f(g)})):(h(g,v),a||e.if((0,Bo.not)(v),()=>e.break()))}}function h(g,v,b){let S={keyword:"additionalProperties",dataProp:g,dataPropType:Sw.Type.Str};b===!1&&Object.assign(S,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(S,v)}}};RT.default=Fie});var p6=y(DT=>{"use strict";Object.defineProperty(DT,"__esModule",{value:!0});var Vie=Wm(),u6=lo(),MT=it(),d6=zT(),Hie={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&d6.default.code(new Vie.KeywordCxt(i,d6.default,"additionalProperties"));let s=(0,u6.allSchemaProperties)(r);for(let d of s)i.definedProperties.add(d);i.opts.unevaluated&&s.length&&i.props!==!0&&(i.props=MT.mergeEvaluated.props(e,(0,MT.toHash)(s),i.props));let a=s.filter(d=>!(0,MT.alwaysValidSchema)(i,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)l(d)?u(d):(e.if((0,u6.propertyInData)(e,o,d,i.opts.ownProperties)),u(d),i.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function l(d){return i.opts.useDefaults&&!i.compositeRule&&r[d].default!==void 0}function u(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};DT.default=Hie});var g6=y(qT=>{"use strict";Object.defineProperty(qT,"__esModule",{value:!0});var f6=lo(),kw=De(),m6=it(),h6=it(),Gie={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:i}=t,{opts:s}=i,a=(0,f6.allSchemaProperties)(r),c=a.filter(h=>(0,m6.alwaysValidSchema)(i,r[h]));if(a.length===0||c.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let l=s.strictSchema&&!s.allowMatchingProperties&&o.properties,u=e.name("valid");i.props!==!0&&!(i.props instanceof kw.Name)&&(i.props=(0,h6.evaluatedPropsToName)(e,i.props));let{props:d}=i;p();function p(){for(let h of a)l&&f(h),i.allErrors?m(h):(e.var(u,!0),m(h),e.if(u))}function f(h){for(let g in l)new RegExp(h).test(g)&&(0,m6.checkStrictMode)(i,`property ${g} matches pattern ${h} (use allowMatchingProperties)`)}function m(h){e.forIn("key",n,g=>{e.if((0,kw._)`${(0,f6.usePattern)(t,h)}.test(${g})`,()=>{let v=c.includes(h);v||t.subschema({keyword:"patternProperties",schemaProp:h,dataProp:g,dataPropType:h6.Type.Str},u),i.opts.unevaluated&&d!==!0?e.assign((0,kw._)`${d}[${g}]`,!0):!v&&!i.allErrors&&e.if((0,kw.not)(u),()=>e.break())})})}}};qT.default=Gie});var y6=y(BT=>{"use strict";Object.defineProperty(BT,"__esModule",{value:!0});var Wie=it(),Zie={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,Wie.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};BT.default=Zie});var v6=y(UT=>{"use strict";Object.defineProperty(UT,"__esModule",{value:!0});var Kie=lo(),Jie={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:Kie.validateUnion,error:{message:"must match a schema in anyOf"}};UT.default=Jie});var b6=y(LT=>{"use strict";Object.defineProperty(LT,"__esModule",{value:!0});var Aw=De(),Yie=it(),Qie={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,Aw._)`{passingSchemas: ${t.passing}}`},Xie={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:Qie,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let i=r,s=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(l),t.result(s,()=>t.reset(),()=>t.error(!0));function l(){i.forEach((u,d)=>{let p;(0,Yie.alwaysValidSchema)(o,u)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,Aw._)`${c} && ${s}`).assign(s,!1).assign(a,(0,Aw._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(s,!0),e.assign(a,d),p&&t.mergeEvaluated(p,Aw.Name)})})}}};LT.default=Xie});var _6=y(FT=>{"use strict";Object.defineProperty(FT,"__esModule",{value:!0});var ese=it(),tse={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((i,s)=>{if((0,ese.alwaysValidSchema)(n,i))return;let a=t.subschema({keyword:"allOf",schemaProp:s},o);t.ok(o),t.mergeEvaluated(a)})}};FT.default=tse});var S6=y(VT=>{"use strict";Object.defineProperty(VT,"__esModule",{value:!0});var $w=De(),x6=it(),rse={message:({params:t})=>(0,$w.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,$w._)`{failingKeyword: ${t.ifClause}}`},nse={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:rse,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,x6.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=w6(n,"then"),i=w6(n,"else");if(!o&&!i)return;let s=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&i){let u=e.let("ifClause");t.setParams({ifClause:u}),e.if(a,l("then",u),l("else",u))}else o?e.if(a,l("then")):e.if((0,$w.not)(a),l("else"));t.pass(s,()=>t.error(!0));function c(){let u=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(u)}function l(u,d){return()=>{let p=t.subschema({keyword:u},a);e.assign(s,a),t.mergeValidEvaluated(p,s),d?e.assign(d,(0,$w._)`${u}`):t.setParams({ifClause:u})}}}};function w6(t,e){let r=t.schema[e];return r!==void 0&&!(0,x6.alwaysValidSchema)(t,r)}VT.default=nse});var k6=y(HT=>{"use strict";Object.defineProperty(HT,"__esModule",{value:!0});var ose=it(),ise={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,ose.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};HT.default=ise});var A6=y(GT=>{"use strict";Object.defineProperty(GT,"__esModule",{value:!0});var sse=CT(),ase=t6(),cse=IT(),lse=n6(),use=o6(),dse=a6(),pse=l6(),fse=zT(),mse=p6(),hse=g6(),gse=y6(),yse=v6(),vse=b6(),bse=_6(),_se=S6(),wse=k6();function xse(t=!1){let e=[gse.default,yse.default,vse.default,bse.default,_se.default,wse.default,pse.default,fse.default,dse.default,mse.default,hse.default];return t?e.push(ase.default,lse.default):e.push(sse.default,cse.default),e.push(use.default),e}GT.default=xse});var $6=y(WT=>{"use strict";Object.defineProperty(WT,"__esModule",{value:!0});var ir=De(),Sse={message:({schemaCode:t})=>(0,ir.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,ir._)`{format: ${t}}`},kse={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:Sse,code(t,e){let{gen:r,data:n,$data:o,schema:i,schemaCode:s,it:a}=t,{opts:c,errSchemaPath:l,schemaEnv:u,self:d}=a;if(!c.validateFormats)return;o?p():f();function p(){let m=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),h=r.const("fDef",(0,ir._)`${m}[${s}]`),g=r.let("fType"),v=r.let("format");r.if((0,ir._)`typeof ${h} == "object" && !(${h} instanceof RegExp)`,()=>r.assign(g,(0,ir._)`${h}.type || "string"`).assign(v,(0,ir._)`${h}.validate`),()=>r.assign(g,(0,ir._)`"string"`).assign(v,h)),t.fail$data((0,ir.or)(b(),S()));function b(){return c.strictSchema===!1?ir.nil:(0,ir._)`${s} && !${v}`}function S(){let j=u.$async?(0,ir._)`(${h}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,ir._)`${v}(${n})`,C=(0,ir._)`(typeof ${v} == "function" ? ${j} : ${v}.test(${n}))`;return(0,ir._)`${v} && ${v} !== true && ${g} === ${e} && !${C}`}}function f(){let m=d.formats[i];if(!m){b();return}if(m===!0)return;let[h,g,v]=S(m);h===e&&t.pass(j());function b(){if(c.strictSchema===!1){d.logger.warn(C());return}throw new Error(C());function C(){return`unknown format "${i}" ignored in schema at path "${l}"`}}function S(C){let ie=C instanceof RegExp?(0,ir.regexpCode)(C):c.code.formats?(0,ir._)`${c.code.formats}${(0,ir.getProperty)(i)}`:void 0,pe=r.scopeValue("formats",{key:i,ref:C,code:ie});return typeof C=="object"&&!(C instanceof RegExp)?[C.type||"string",C.validate,(0,ir._)`${pe}.validate`]:["string",C,pe]}function j(){if(typeof m=="object"&&!(m instanceof RegExp)&&m.async){if(!u.$async)throw new Error("async format in sync schema");return(0,ir._)`await ${v}(${n})`}return typeof g=="function"?(0,ir._)`${v}(${n})`:(0,ir._)`${v}.test(${n})`}}}};WT.default=kse});var P6=y(ZT=>{"use strict";Object.defineProperty(ZT,"__esModule",{value:!0});var Ase=$6(),$se=[Ase.default];ZT.default=$se});var C6=y(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0});Hu.contentVocabulary=Hu.metadataVocabulary=void 0;Hu.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];Hu.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var T6=y(KT=>{"use strict";Object.defineProperty(KT,"__esModule",{value:!0});var Pse=ML(),Cse=YL(),Ise=A6(),Tse=P6(),I6=C6(),Ese=[Pse.default,Cse.default,(0,Ise.default)(),Tse.default,I6.metadataVocabulary,I6.contentVocabulary];KT.default=Ese});var O6=y(Pw=>{"use strict";Object.defineProperty(Pw,"__esModule",{value:!0});Pw.DiscrError=void 0;var E6;(function(t){t.Tag="tag",t.Mapping="mapping"})(E6||(Pw.DiscrError=E6={}))});var N6=y(YT=>{"use strict";Object.defineProperty(YT,"__esModule",{value:!0});var Gu=De(),JT=O6(),j6=cw(),Ose=Zm(),jse=it(),Nse={message:({params:{discrError:t,tagName:e}})=>t===JT.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,Gu._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},Rse={keyword:"discriminator",type:"object",schemaType:"object",error:Nse,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:i}=t,{oneOf:s}=o;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),l=e.const("tag",(0,Gu._)`${r}${(0,Gu.getProperty)(a)}`);e.if((0,Gu._)`typeof ${l} == "string"`,()=>u(),()=>t.error(!1,{discrError:JT.DiscrError.Tag,tag:l,tagName:a})),t.ok(c);function u(){let f=p();e.if(!1);for(let m in f)e.elseIf((0,Gu._)`${l} === ${m}`),e.assign(c,d(f[m]));e.else(),t.error(!1,{discrError:JT.DiscrError.Mapping,tag:l,tagName:a}),e.endIf()}function d(f){let m=e.name("valid"),h=t.subschema({keyword:"oneOf",schemaProp:f},m);return t.mergeEvaluated(h,Gu.Name),m}function p(){var f;let m={},h=v(o),g=!0;for(let j=0;j<s.length;j++){let C=s[j];if(C?.$ref&&!(0,jse.schemaHasRulesButRef)(C,i.self.RULES)){let pe=C.$ref;if(C=j6.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,pe),C instanceof j6.SchemaEnv&&(C=C.schema),C===void 0)throw new Ose.default(i.opts.uriResolver,i.baseId,pe)}let ie=(f=C?.properties)===null||f===void 0?void 0:f[a];if(typeof ie!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(h||v(C)),b(ie,j)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return m;function v({required:j}){return Array.isArray(j)&&j.includes(a)}function b(j,C){if(j.const)S(j.const,C);else if(j.enum)for(let ie of j.enum)S(ie,C);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function S(j,C){if(typeof j!="string"||j in m)throw new Error(`discriminator: "${a}" values must be unique strings`);m[j]=C}}}};YT.default=Rse});var R6=y((rIe,zse)=>{zse.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var M6=y((Mt,QT)=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.MissingRefError=Mt.ValidationError=Mt.CodeGen=Mt.Name=Mt.nil=Mt.stringify=Mt.str=Mt._=Mt.KeywordCxt=Mt.Ajv=void 0;var Mse=EL(),Dse=T6(),qse=N6(),z6=R6(),Bse=["/properties"],Cw="http://json-schema.org/draft-07/schema",Wu=class extends Mse.default{_addVocabularies(){super._addVocabularies(),Dse.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(qse.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(z6,Bse):z6;this.addMetaSchema(e,Cw,!1),this.refs["http://json-schema.org/schema"]=Cw}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(Cw)?Cw:void 0)}};Mt.Ajv=Wu;QT.exports=Mt=Wu;QT.exports.Ajv=Wu;Object.defineProperty(Mt,"__esModule",{value:!0});Mt.default=Wu;var Use=Wm();Object.defineProperty(Mt,"KeywordCxt",{enumerable:!0,get:function(){return Use.KeywordCxt}});var Zu=De();Object.defineProperty(Mt,"_",{enumerable:!0,get:function(){return Zu._}});Object.defineProperty(Mt,"str",{enumerable:!0,get:function(){return Zu.str}});Object.defineProperty(Mt,"stringify",{enumerable:!0,get:function(){return Zu.stringify}});Object.defineProperty(Mt,"nil",{enumerable:!0,get:function(){return Zu.nil}});Object.defineProperty(Mt,"Name",{enumerable:!0,get:function(){return Zu.Name}});Object.defineProperty(Mt,"CodeGen",{enumerable:!0,get:function(){return Zu.CodeGen}});var Lse=sw();Object.defineProperty(Mt,"ValidationError",{enumerable:!0,get:function(){return Lse.default}});var Fse=Zm();Object.defineProperty(Mt,"MissingRefError",{enumerable:!0,get:function(){return Fse.default}})});var H6=y(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.formatNames=wi.fastFormats=wi.fullFormats=void 0;function _i(t,e){return{validate:t,compare:e}}wi.fullFormats={date:_i(U6,rE),time:_i(eE(!0),nE),"date-time":_i(D6(!0),F6),"iso-time":_i(eE(),L6),"iso-date-time":_i(D6(),V6),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:Kse,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:rae,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:Jse,int32:{type:"number",validate:Xse},int64:{type:"number",validate:eae},float:{type:"number",validate:B6},double:{type:"number",validate:B6},password:!0,binary:!0};wi.fastFormats={...wi.fullFormats,date:_i(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,rE),time:_i(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,nE),"date-time":_i(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,F6),"iso-time":_i(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,L6),"iso-date-time":_i(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,V6),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};wi.formatNames=Object.keys(wi.fullFormats);function Vse(t){return t%4===0&&(t%100!==0||t%400===0)}var Hse=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Gse=[0,31,28,31,30,31,30,31,31,30,31,30,31];function U6(t){let e=Hse.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&Vse(r)?29:Gse[n])}function rE(t,e){if(t&&e)return t>e?1:t<e?-1:0}var XT=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function eE(t){return function(r){let n=XT.exec(r);if(!n)return!1;let o=+n[1],i=+n[2],s=+n[3],a=n[4],c=n[5]==="-"?-1:1,l=+(n[6]||0),u=+(n[7]||0);if(l>23||u>59||t&&!a)return!1;if(o<=23&&i<=59&&s<60)return!0;let d=i-u*c,p=o-l*c-(d<0?1:0);return(p===23||p===-1)&&(d===59||d===-1)&&s<61}}function nE(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function L6(t,e){if(!(t&&e))return;let r=XT.exec(t),n=XT.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var tE=/t|\s/i;function D6(t){let e=eE(t);return function(n){let o=n.split(tE);return o.length===2&&U6(o[0])&&e(o[1])}}function F6(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function V6(t,e){if(!(t&&e))return;let[r,n]=t.split(tE),[o,i]=e.split(tE),s=rE(r,o);if(s!==void 0)return s||nE(n,i)}var Wse=/\/|:/,Zse=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Kse(t){return Wse.test(t)&&Zse.test(t)}var q6=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function Jse(t){return q6.lastIndex=0,q6.test(t)}var Yse=-(2**31),Qse=2**31-1;function Xse(t){return Number.isInteger(t)&&t<=Qse&&t>=Yse}function eae(t){return Number.isInteger(t)}function B6(){return!0}var tae=/[^\\]\\Z/;function rae(t){if(tae.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var uh=y(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.regexpCode=st.getEsmExportName=st.getProperty=st.safeStringify=st.stringify=st.strConcat=st.addCodeArg=st.str=st._=st.nil=st._Code=st.Name=st.IDENTIFIER=st._CodeOrName=void 0;var ch=class{};st._CodeOrName=ch;st.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var pc=class extends ch{constructor(e){if(super(),!st.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};st.Name=pc;var fo=class extends ch{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof pc&&(r[n.str]=(r[n.str]||0)+1),r),{})}};st._Code=fo;st.nil=new fo("");function G6(t,...e){let r=[t[0]],n=0;for(;n<e.length;)iE(r,e[n]),r.push(t[++n]);return new fo(r)}st._=G6;var oE=new fo("+");function W6(t,...e){let r=[lh(t[0])],n=0;for(;n<e.length;)r.push(oE),iE(r,e[n]),r.push(oE,lh(t[++n]));return nae(r),new fo(r)}st.str=W6;function iE(t,e){e instanceof fo?t.push(...e._items):e instanceof pc?t.push(e):t.push(sae(e))}st.addCodeArg=iE;function nae(t){let e=1;for(;e<t.length-1;){if(t[e]===oE){let r=oae(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function oae(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof pc||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof pc))return`"${t}${e.slice(1)}`}function iae(t,e){return e.emptyStr()?t:t.emptyStr()?e:W6`${t}${e}`}st.strConcat=iae;function sae(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:lh(Array.isArray(t)?t.join(","):t)}function aae(t){return new fo(lh(t))}st.stringify=aae;function lh(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}st.safeStringify=lh;function cae(t){return typeof t=="string"&&st.IDENTIFIER.test(t)?new fo(`.${t}`):G6`[${t}]`}st.getProperty=cae;function lae(t){if(typeof t=="string"&&st.IDENTIFIER.test(t))return new fo(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}st.getEsmExportName=lae;function uae(t){return new fo(t.toString())}st.regexpCode=uae});var cE=y(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.ValueScope=kn.ValueScopeName=kn.Scope=kn.varKinds=kn.UsedValueState=void 0;var Sn=uh(),sE=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Iw;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Iw||(kn.UsedValueState=Iw={}));kn.varKinds={const:new Sn.Name("const"),let:new Sn.Name("let"),var:new Sn.Name("var")};var Tw=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Sn.Name?e:this.name(e)}name(e){return new Sn.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};kn.Scope=Tw;var Ew=class extends Sn.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Sn._)`.${new Sn.Name(r)}[${n}]`}};kn.ValueScopeName=Ew;var dae=(0,Sn._)`\n`,aE=class extends Tw{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?dae:Sn.nil}}get(){return this._scope}name(e){return new Ew(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:i}=o,s=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let u=a.get(s);if(u)return u}else a=this._values[i]=new Map;a.set(s,o);let c=this._scope[i]||(this._scope[i]=[]),l=c.length;return c[l]=r.ref,o.setValue(r,{property:i,itemIndex:l}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Sn._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let i=Sn.nil;for(let s in e){let a=e[s];if(!a)continue;let c=n[s]=n[s]||new Map;a.forEach(l=>{if(c.has(l))return;c.set(l,Iw.Started);let u=r(l);if(u){let d=this.opts.es5?kn.varKinds.var:kn.varKinds.const;i=(0,Sn._)`${i}${d} ${l} = ${u};${this.opts._n}`}else if(u=o?.(l))i=(0,Sn._)`${i}${u}${this.opts._n}`;else throw new sE(l);c.set(l,Iw.Completed)})}return i}};kn.ValueScope=aE});var Ne=y(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.or=Me.and=Me.not=Me.CodeGen=Me.operators=Me.varKinds=Me.ValueScopeName=Me.ValueScope=Me.Scope=Me.Name=Me.regexpCode=Me.stringify=Me.getProperty=Me.nil=Me.strConcat=Me.str=Me._=void 0;var Ye=uh(),Uo=cE(),aa=uh();Object.defineProperty(Me,"_",{enumerable:!0,get:function(){return aa._}});Object.defineProperty(Me,"str",{enumerable:!0,get:function(){return aa.str}});Object.defineProperty(Me,"strConcat",{enumerable:!0,get:function(){return aa.strConcat}});Object.defineProperty(Me,"nil",{enumerable:!0,get:function(){return aa.nil}});Object.defineProperty(Me,"getProperty",{enumerable:!0,get:function(){return aa.getProperty}});Object.defineProperty(Me,"stringify",{enumerable:!0,get:function(){return aa.stringify}});Object.defineProperty(Me,"regexpCode",{enumerable:!0,get:function(){return aa.regexpCode}});Object.defineProperty(Me,"Name",{enumerable:!0,get:function(){return aa.Name}});var Rw=cE();Object.defineProperty(Me,"Scope",{enumerable:!0,get:function(){return Rw.Scope}});Object.defineProperty(Me,"ValueScope",{enumerable:!0,get:function(){return Rw.ValueScope}});Object.defineProperty(Me,"ValueScopeName",{enumerable:!0,get:function(){return Rw.ValueScopeName}});Object.defineProperty(Me,"varKinds",{enumerable:!0,get:function(){return Rw.varKinds}});Me.operators={GT:new Ye._Code(">"),GTE:new Ye._Code(">="),LT:new Ye._Code("<"),LTE:new Ye._Code("<="),EQ:new Ye._Code("==="),NEQ:new Ye._Code("!=="),NOT:new Ye._Code("!"),OR:new Ye._Code("||"),AND:new Ye._Code("&&"),ADD:new Ye._Code("+")};var ss=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},lE=class extends ss{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?Uo.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=Ju(this.rhs,e,r)),this}get names(){return this.rhs instanceof Ye._CodeOrName?this.rhs.names:{}}},Ow=class extends ss{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof Ye.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=Ju(this.rhs,e,r),this}get names(){let e=this.lhs instanceof Ye.Name?{}:{...this.lhs.names};return Nw(e,this.rhs)}},uE=class extends Ow{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},dE=class extends ss{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},pE=class extends ss{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},fE=class extends ss{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},mE=class extends ss{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=Ju(this.code,e,r),this}get names(){return this.code instanceof Ye._CodeOrName?this.code.names:{}}},dh=class extends ss{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let i=n[o];i.optimizeNames(e,r)||(pae(e,i.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>hc(e,r.names),{})}},as=class extends dh{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},hE=class extends dh{},Ku=class extends as{};Ku.kind="else";var fc=class t extends as{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new Ku(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(Z6(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=Ju(this.condition,e,r),this}get names(){let e=super.names;return Nw(e,this.condition),this.else&&hc(e,this.else.names),e}};fc.kind="if";var mc=class extends as{};mc.kind="for";var gE=class extends mc{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=Ju(this.iteration,e,r),this}get names(){return hc(super.names,this.iteration.names)}},yE=class extends mc{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?Uo.varKinds.var:this.varKind,{name:n,from:o,to:i}=this;return`for(${r} ${n}=${o}; ${n}<${i}; ${n}++)`+super.render(e)}get names(){let e=Nw(super.names,this.from);return Nw(e,this.to)}},jw=class extends mc{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=Ju(this.iterable,e,r),this}get names(){return hc(super.names,this.iterable.names)}},ph=class extends as{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};ph.kind="func";var fh=class extends dh{render(e){return"return "+super.render(e)}};fh.kind="return";var vE=class extends as{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&hc(e,this.catch.names),this.finally&&hc(e,this.finally.names),e}},mh=class extends as{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};mh.kind="catch";var hh=class extends as{render(e){return"finally"+super.render(e)}};hh.kind="finally";var bE=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new Uo.Scope({parent:e}),this._nodes=[new hE]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let i=this._scope.toName(r);return n!==void 0&&o&&(this._constants[i.str]=n),this._leafNode(new lE(e,i,n)),i}const(e,r,n){return this._def(Uo.varKinds.const,e,r,n)}let(e,r,n){return this._def(Uo.varKinds.let,e,r,n)}var(e,r,n){return this._def(Uo.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Ow(e,r,n))}add(e,r){return this._leafNode(new uE(e,Me.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==Ye.nil&&this._leafNode(new mE(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,Ye.addCodeArg)(r,o));return r.push("}"),new Ye._Code(r)}if(e,r,n){if(this._blockNode(new fc(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new fc(e))}else(){return this._elseNode(new Ku)}endIf(){return this._endBlockNode(fc,Ku)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new gE(e),r)}forRange(e,r,n,o,i=this.opts.es5?Uo.varKinds.var:Uo.varKinds.let){let s=this._scope.toName(e);return this._for(new yE(i,s,r,n),()=>o(s))}forOf(e,r,n,o=Uo.varKinds.const){let i=this._scope.toName(e);if(this.opts.es5){let s=r instanceof Ye.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,Ye._)`${s}.length`,a=>{this.var(i,(0,Ye._)`${s}[${a}]`),n(i)})}return this._for(new jw("of",o,i,r),()=>n(i))}forIn(e,r,n,o=this.opts.es5?Uo.varKinds.var:Uo.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,Ye._)`Object.keys(${r})`,n);let i=this._scope.toName(e);return this._for(new jw("in",o,i,r),()=>n(i))}endFor(){return this._endBlockNode(mc)}label(e){return this._leafNode(new dE(e))}break(e){return this._leafNode(new pE(e))}return(e){let r=new fh;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(fh)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new vE;if(this._blockNode(o),this.code(e),r){let i=this.name("e");this._currNode=o.catch=new mh(i),r(i)}return n&&(this._currNode=o.finally=new hh,this.code(n)),this._endBlockNode(mh,hh)}throw(e){return this._leafNode(new fE(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=Ye.nil,n,o){return this._blockNode(new ph(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(ph)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof fc))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};Me.CodeGen=bE;function hc(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function Nw(t,e){return e instanceof Ye._CodeOrName?hc(t,e.names):t}function Ju(t,e,r){if(t instanceof Ye.Name)return n(t);if(!o(t))return t;return new Ye._Code(t._items.reduce((i,s)=>(s instanceof Ye.Name&&(s=n(s)),s instanceof Ye._Code?i.push(...s._items):i.push(s),i),[]));function n(i){let s=r[i.str];return s===void 0||e[i.str]!==1?i:(delete e[i.str],s)}function o(i){return i instanceof Ye._Code&&i._items.some(s=>s instanceof Ye.Name&&e[s.str]===1&&r[s.str]!==void 0)}}function pae(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function Z6(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,Ye._)`!${_E(t)}`}Me.not=Z6;var fae=K6(Me.operators.AND);function mae(...t){return t.reduce(fae)}Me.and=mae;var hae=K6(Me.operators.OR);function gae(...t){return t.reduce(hae)}Me.or=gae;function K6(t){return(e,r)=>e===Ye.nil?r:r===Ye.nil?e:(0,Ye._)`${_E(e)} ${t} ${_E(r)}`}function _E(t){return t instanceof Ye.Name?t:(0,Ye._)`(${t})`}});var at=y(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.checkStrictMode=Be.getErrorPath=Be.Type=Be.useFunc=Be.setEvaluated=Be.evaluatedPropsToName=Be.mergeEvaluated=Be.eachItem=Be.unescapeJsonPointer=Be.escapeJsonPointer=Be.escapeFragment=Be.unescapeFragment=Be.schemaRefOrVal=Be.schemaHasRulesButRef=Be.schemaHasRules=Be.checkUnknownRules=Be.alwaysValidSchema=Be.toHash=void 0;var kt=Ne(),yae=uh();function vae(t){let e={};for(let r of t)e[r]=!0;return e}Be.toHash=vae;function bae(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(Q6(t,e),!X6(e,t.self.RULES.all))}Be.alwaysValidSchema=bae;function Q6(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let i in e)o[i]||rF(t,`unknown keyword: "${i}"`)}Be.checkUnknownRules=Q6;function X6(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}Be.schemaHasRules=X6;function _ae(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}Be.schemaHasRulesButRef=_ae;function wae({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,kt._)`${r}`}return(0,kt._)`${t}${e}${(0,kt.getProperty)(n)}`}Be.schemaRefOrVal=wae;function xae(t){return eF(decodeURIComponent(t))}Be.unescapeFragment=xae;function Sae(t){return encodeURIComponent(xE(t))}Be.escapeFragment=Sae;function xE(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}Be.escapeJsonPointer=xE;function eF(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}Be.unescapeJsonPointer=eF;function kae(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}Be.eachItem=kae;function J6({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,i,s,a)=>{let c=s===void 0?i:s instanceof kt.Name?(i instanceof kt.Name?t(o,i,s):e(o,i,s),s):i instanceof kt.Name?(e(o,s,i),i):r(i,s);return a===kt.Name&&!(c instanceof kt.Name)?n(o,c):c}}Be.mergeEvaluated={props:J6({mergeNames:(t,e,r)=>t.if((0,kt._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,kt._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,kt._)`${r} || {}`).code((0,kt._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,kt._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,kt._)`${r} || {}`),SE(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:tF}),items:J6({mergeNames:(t,e,r)=>t.if((0,kt._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,kt._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,kt._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,kt._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function tF(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,kt._)`{}`);return e!==void 0&&SE(t,r,e),r}Be.evaluatedPropsToName=tF;function SE(t,e,r){Object.keys(r).forEach(n=>t.assign((0,kt._)`${e}${(0,kt.getProperty)(n)}`,!0))}Be.setEvaluated=SE;var Y6={};function Aae(t,e){return t.scopeValue("func",{ref:e,code:Y6[e.code]||(Y6[e.code]=new yae._Code(e.code))})}Be.useFunc=Aae;var wE;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(wE||(Be.Type=wE={}));function $ae(t,e,r){if(t instanceof kt.Name){let n=e===wE.Num;return r?n?(0,kt._)`"[" + ${t} + "]"`:(0,kt._)`"['" + ${t} + "']"`:n?(0,kt._)`"/" + ${t}`:(0,kt._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,kt.getProperty)(t).toString():"/"+xE(t)}Be.getErrorPath=$ae;function rF(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}Be.checkStrictMode=rF});var cs=y(kE=>{"use strict";Object.defineProperty(kE,"__esModule",{value:!0});var Kr=Ne(),Pae={data:new Kr.Name("data"),valCxt:new Kr.Name("valCxt"),instancePath:new Kr.Name("instancePath"),parentData:new Kr.Name("parentData"),parentDataProperty:new Kr.Name("parentDataProperty"),rootData:new Kr.Name("rootData"),dynamicAnchors:new Kr.Name("dynamicAnchors"),vErrors:new Kr.Name("vErrors"),errors:new Kr.Name("errors"),this:new Kr.Name("this"),self:new Kr.Name("self"),scope:new Kr.Name("scope"),json:new Kr.Name("json"),jsonPos:new Kr.Name("jsonPos"),jsonLen:new Kr.Name("jsonLen"),jsonPart:new Kr.Name("jsonPart")};kE.default=Pae});var gh=y(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.extendErrors=Jr.resetErrorsCount=Jr.reportExtraError=Jr.reportError=Jr.keyword$DataError=Jr.keywordError=void 0;var et=Ne(),zw=at(),dn=cs();Jr.keywordError={message:({keyword:t})=>(0,et.str)`must pass "${t}" keyword validation`};Jr.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,et.str)`"${t}" keyword must be ${e} ($data)`:(0,et.str)`"${t}" keyword is invalid ($data)`};function Cae(t,e=Jr.keywordError,r,n){let{it:o}=t,{gen:i,compositeRule:s,allErrors:a}=o,c=iF(t,e,r);n??(s||a)?nF(i,c):oF(o,(0,et._)`[${c}]`)}Jr.reportError=Cae;function Iae(t,e=Jr.keywordError,r){let{it:n}=t,{gen:o,compositeRule:i,allErrors:s}=n,a=iF(t,e,r);nF(o,a),i||s||oF(n,dn.default.vErrors)}Jr.reportExtraError=Iae;function Tae(t,e){t.assign(dn.default.errors,e),t.if((0,et._)`${dn.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,et._)`${dn.default.vErrors}.length`,e),()=>t.assign(dn.default.vErrors,null)))}Jr.resetErrorsCount=Tae;function Eae({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:i}){if(o===void 0)throw new Error("ajv implementation error");let s=t.name("err");t.forRange("i",o,dn.default.errors,a=>{t.const(s,(0,et._)`${dn.default.vErrors}[${a}]`),t.if((0,et._)`${s}.instancePath === undefined`,()=>t.assign((0,et._)`${s}.instancePath`,(0,et.strConcat)(dn.default.instancePath,i.errorPath))),t.assign((0,et._)`${s}.schemaPath`,(0,et.str)`${i.errSchemaPath}/${e}`),i.opts.verbose&&(t.assign((0,et._)`${s}.schema`,r),t.assign((0,et._)`${s}.data`,n))})}Jr.extendErrors=Eae;function nF(t,e){let r=t.const("err",e);t.if((0,et._)`${dn.default.vErrors} === null`,()=>t.assign(dn.default.vErrors,(0,et._)`[${r}]`),(0,et._)`${dn.default.vErrors}.push(${r})`),t.code((0,et._)`${dn.default.errors}++`)}function oF(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,et._)`new ${t.ValidationError}(${e})`):(r.assign((0,et._)`${n}.errors`,e),r.return(!1))}var gc={keyword:new et.Name("keyword"),schemaPath:new et.Name("schemaPath"),params:new et.Name("params"),propertyName:new et.Name("propertyName"),message:new et.Name("message"),schema:new et.Name("schema"),parentSchema:new et.Name("parentSchema")};function iF(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,et._)`{}`:Oae(t,e,r)}function Oae(t,e,r={}){let{gen:n,it:o}=t,i=[jae(o,r),Nae(t,r)];return Rae(t,e,i),n.object(...i)}function jae({errorPath:t},{instancePath:e}){let r=e?(0,et.str)`${t}${(0,zw.getErrorPath)(e,zw.Type.Str)}`:t;return[dn.default.instancePath,(0,et.strConcat)(dn.default.instancePath,r)]}function Nae({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,et.str)`${e}/${t}`;return r&&(o=(0,et.str)`${o}${(0,zw.getErrorPath)(r,zw.Type.Str)}`),[gc.schemaPath,o]}function Rae(t,{params:e,message:r},n){let{keyword:o,data:i,schemaValue:s,it:a}=t,{opts:c,propertyName:l,topSchemaRef:u,schemaPath:d}=a;n.push([gc.keyword,o],[gc.params,typeof e=="function"?e(t):e||(0,et._)`{}`]),c.messages&&n.push([gc.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([gc.schema,s],[gc.parentSchema,(0,et._)`${u}${d}`],[dn.default.data,i]),l&&n.push([gc.propertyName,l])}});var aF=y(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.boolOrEmptySchema=Yu.topBoolOrEmptySchema=void 0;var zae=gh(),Mae=Ne(),Dae=cs(),qae={message:"boolean schema is false"};function Bae(t){let{gen:e,schema:r,validateName:n}=t;r===!1?sF(t,!1):typeof r=="object"&&r.$async===!0?e.return(Dae.default.data):(e.assign((0,Mae._)`${n}.errors`,null),e.return(!0))}Yu.topBoolOrEmptySchema=Bae;function Uae(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),sF(t)):r.var(e,!0)}Yu.boolOrEmptySchema=Uae;function sF(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,zae.reportError)(o,qae,void 0,e)}});var AE=y(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});Qu.getRules=Qu.isJSONType=void 0;var Lae=["string","number","integer","boolean","null","object","array"],Fae=new Set(Lae);function Vae(t){return typeof t=="string"&&Fae.has(t)}Qu.isJSONType=Vae;function Hae(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}Qu.getRules=Hae});var $E=y(ca=>{"use strict";Object.defineProperty(ca,"__esModule",{value:!0});ca.shouldUseRule=ca.shouldUseGroup=ca.schemaHasRulesForType=void 0;function Gae({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&cF(t,n)}ca.schemaHasRulesForType=Gae;function cF(t,e){return e.rules.some(r=>lF(t,r))}ca.shouldUseGroup=cF;function lF(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}ca.shouldUseRule=lF});var yh=y(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.reportTypeError=Yr.checkDataTypes=Yr.checkDataType=Yr.coerceAndCheckDataType=Yr.getJSONTypes=Yr.getSchemaTypes=Yr.DataType=void 0;var Wae=AE(),Zae=$E(),Kae=gh(),Oe=Ne(),uF=at(),Xu;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(Xu||(Yr.DataType=Xu={}));function Jae(t){let e=dF(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Yr.getSchemaTypes=Jae;function dF(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(Wae.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Yr.getJSONTypes=dF;function Yae(t,e){let{gen:r,data:n,opts:o}=t,i=Qae(e,o.coerceTypes),s=e.length>0&&!(i.length===0&&e.length===1&&(0,Zae.schemaHasRulesForType)(t,e[0]));if(s){let a=CE(e,n,o.strictNumbers,Xu.Wrong);r.if(a,()=>{i.length?Xae(t,e,i):IE(t)})}return s}Yr.coerceAndCheckDataType=Yae;var pF=new Set(["string","number","integer","boolean","null"]);function Qae(t,e){return e?t.filter(r=>pF.has(r)||e==="array"&&r==="array"):[]}function Xae(t,e,r){let{gen:n,data:o,opts:i}=t,s=n.let("dataType",(0,Oe._)`typeof ${o}`),a=n.let("coerced",(0,Oe._)`undefined`);i.coerceTypes==="array"&&n.if((0,Oe._)`${s} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,Oe._)`${o}[0]`).assign(s,(0,Oe._)`typeof ${o}`).if(CE(e,o,i.strictNumbers),()=>n.assign(a,o))),n.if((0,Oe._)`${a} !== undefined`);for(let l of r)(pF.has(l)||l==="array"&&i.coerceTypes==="array")&&c(l);n.else(),IE(t),n.endIf(),n.if((0,Oe._)`${a} !== undefined`,()=>{n.assign(o,a),ece(t,a)});function c(l){switch(l){case"string":n.elseIf((0,Oe._)`${s} == "number" || ${s} == "boolean"`).assign(a,(0,Oe._)`"" + ${o}`).elseIf((0,Oe._)`${o} === null`).assign(a,(0,Oe._)`""`);return;case"number":n.elseIf((0,Oe._)`${s} == "boolean" || ${o} === null
              || (${s} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,Oe._)`+${o}`);return;case"integer":n.elseIf((0,Oe._)`${s} === "boolean" || ${o} === null
              || (${s} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,Oe._)`+${o}`);return;case"boolean":n.elseIf((0,Oe._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,Oe._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,Oe._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,Oe._)`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${o} === null`).assign(a,(0,Oe._)`[${o}]`)}}}function ece({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,Oe._)`${e} !== undefined`,()=>t.assign((0,Oe._)`${e}[${r}]`,n))}function PE(t,e,r,n=Xu.Correct){let o=n===Xu.Correct?Oe.operators.EQ:Oe.operators.NEQ,i;switch(t){case"null":return(0,Oe._)`${e} ${o} null`;case"array":i=(0,Oe._)`Array.isArray(${e})`;break;case"object":i=(0,Oe._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":i=s((0,Oe._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":i=s();break;default:return(0,Oe._)`typeof ${e} ${o} ${t}`}return n===Xu.Correct?i:(0,Oe.not)(i);function s(a=Oe.nil){return(0,Oe.and)((0,Oe._)`typeof ${e} == "number"`,a,r?(0,Oe._)`isFinite(${e})`:Oe.nil)}}Yr.checkDataType=PE;function CE(t,e,r,n){if(t.length===1)return PE(t[0],e,r,n);let o,i=(0,uF.toHash)(t);if(i.array&&i.object){let s=(0,Oe._)`typeof ${e} != "object"`;o=i.null?s:(0,Oe._)`!${e} || ${s}`,delete i.null,delete i.array,delete i.object}else o=Oe.nil;i.number&&delete i.integer;for(let s in i)o=(0,Oe.and)(o,PE(s,e,r,n));return o}Yr.checkDataTypes=CE;var tce={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,Oe._)`{type: ${t}}`:(0,Oe._)`{type: ${e}}`};function IE(t){let e=rce(t);(0,Kae.reportError)(e,tce)}Yr.reportTypeError=IE;function rce(t){let{gen:e,data:r,schema:n}=t,o=(0,uF.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var mF=y(Mw=>{"use strict";Object.defineProperty(Mw,"__esModule",{value:!0});Mw.assignDefaults=void 0;var ed=Ne(),nce=at();function oce(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)fF(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,i)=>fF(t,i,o.default))}Mw.assignDefaults=oce;function fF(t,e,r){let{gen:n,compositeRule:o,data:i,opts:s}=t;if(r===void 0)return;let a=(0,ed._)`${i}${(0,ed.getProperty)(e)}`;if(o){(0,nce.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,ed._)`${a} === undefined`;s.useDefaults==="empty"&&(c=(0,ed._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,ed._)`${a} = ${(0,ed.stringify)(r)}`)}});var mo=y(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.validateUnion=vt.validateArray=vt.usePattern=vt.callValidateCode=vt.schemaProperties=vt.allSchemaProperties=vt.noPropertyInData=vt.propertyInData=vt.isOwnProperty=vt.hasPropFunc=vt.reportMissingProp=vt.checkMissingProp=vt.checkReportMissingProp=void 0;var Dt=Ne(),TE=at(),la=cs(),ice=at();function sce(t,e){let{gen:r,data:n,it:o}=t;r.if(OE(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,Dt._)`${e}`},!0),t.error()})}vt.checkReportMissingProp=sce;function ace({gen:t,data:e,it:{opts:r}},n,o){return(0,Dt.or)(...n.map(i=>(0,Dt.and)(OE(t,e,i,r.ownProperties),(0,Dt._)`${o} = ${i}`)))}vt.checkMissingProp=ace;function cce(t,e){t.setParams({missingProperty:e},!0),t.error()}vt.reportMissingProp=cce;function hF(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,Dt._)`Object.prototype.hasOwnProperty`})}vt.hasPropFunc=hF;function EE(t,e,r){return(0,Dt._)`${hF(t)}.call(${e}, ${r})`}vt.isOwnProperty=EE;function lce(t,e,r,n){let o=(0,Dt._)`${e}${(0,Dt.getProperty)(r)} !== undefined`;return n?(0,Dt._)`${o} && ${EE(t,e,r)}`:o}vt.propertyInData=lce;function OE(t,e,r,n){let o=(0,Dt._)`${e}${(0,Dt.getProperty)(r)} === undefined`;return n?(0,Dt.or)(o,(0,Dt.not)(EE(t,e,r))):o}vt.noPropertyInData=OE;function gF(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}vt.allSchemaProperties=gF;function uce(t,e){return gF(e).filter(r=>!(0,TE.alwaysValidSchema)(t,e[r]))}vt.schemaProperties=uce;function dce({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:i},it:s},a,c,l){let u=l?(0,Dt._)`${t}, ${e}, ${n}${o}`:e,d=[[la.default.instancePath,(0,Dt.strConcat)(la.default.instancePath,i)],[la.default.parentData,s.parentData],[la.default.parentDataProperty,s.parentDataProperty],[la.default.rootData,la.default.rootData]];s.opts.dynamicRef&&d.push([la.default.dynamicAnchors,la.default.dynamicAnchors]);let p=(0,Dt._)`${u}, ${r.object(...d)}`;return c!==Dt.nil?(0,Dt._)`${a}.call(${c}, ${p})`:(0,Dt._)`${a}(${p})`}vt.callValidateCode=dce;var pce=(0,Dt._)`new RegExp`;function fce({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,i=o(r,n);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,Dt._)`${o.code==="new RegExp"?pce:(0,ice.useFunc)(t,o)}(${r}, ${n})`})}vt.usePattern=fce;function mce(t){let{gen:e,data:r,keyword:n,it:o}=t,i=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(i,!0),s(()=>e.break()),i;function s(a){let c=e.const("len",(0,Dt._)`${r}.length`);e.forRange("i",0,c,l=>{t.subschema({keyword:n,dataProp:l,dataPropType:TE.Type.Num},i),e.if((0,Dt.not)(i),a)})}}vt.validateArray=mce;function hce(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,TE.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let s=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,l)=>{let u=t.subschema({keyword:n,schemaProp:l,compositeRule:!0},a);e.assign(s,(0,Dt._)`${s} || ${a}`),t.mergeValidEvaluated(u,a)||e.if((0,Dt.not)(s))})),t.result(s,()=>t.reset(),()=>t.error(!0))}vt.validateUnion=hce});var bF=y(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});xi.validateKeywordUsage=xi.validSchemaType=xi.funcKeywordCode=xi.macroKeywordCode=void 0;var pn=Ne(),yc=cs(),gce=mo(),yce=gh();function vce(t,e){let{gen:r,keyword:n,schema:o,parentSchema:i,it:s}=t,a=e.macro.call(s.self,o,i,s),c=vF(r,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);let l=r.name("valid");t.subschema({schema:a,schemaPath:pn.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},l),t.pass(l,()=>t.error(!0))}xi.macroKeywordCode=vce;function bce(t,e){var r;let{gen:n,keyword:o,schema:i,parentSchema:s,$data:a,it:c}=t;wce(c,e);let l=!a&&e.compile?e.compile.call(c.self,i,s,c):e.validate,u=vF(n,o,l),d=n.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)h(),e.modifying&&yF(t),g(()=>t.error());else{let v=e.async?f():m();e.modifying&&yF(t),g(()=>_ce(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>h((0,pn._)`await `),b=>n.assign(d,!1).if((0,pn._)`${b} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,pn._)`${b}.errors`),()=>n.throw(b))),v}function m(){let v=(0,pn._)`${u}.errors`;return n.assign(v,null),h(pn.nil),v}function h(v=e.async?(0,pn._)`await `:pn.nil){let b=c.opts.passContext?yc.default.this:yc.default.self,S=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,pn._)`${v}${(0,gce.callValidateCode)(t,u,b,S)}`,e.modifying)}function g(v){var b;n.if((0,pn.not)((b=e.valid)!==null&&b!==void 0?b:d),v)}}xi.funcKeywordCode=bce;function yF(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,pn._)`${n.parentData}[${n.parentDataProperty}]`))}function _ce(t,e){let{gen:r}=t;r.if((0,pn._)`Array.isArray(${e})`,()=>{r.assign(yc.default.vErrors,(0,pn._)`${yc.default.vErrors} === null ? ${e} : ${yc.default.vErrors}.concat(${e})`).assign(yc.default.errors,(0,pn._)`${yc.default.vErrors}.length`),(0,yce.extendErrors)(t)},()=>t.error())}function wce({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function vF(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,pn.stringify)(r)})}function xce(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}xi.validSchemaType=xce;function Sce({schema:t,opts:e,self:r,errSchemaPath:n},o,i){if(Array.isArray(o.keyword)?!o.keyword.includes(i):o.keyword!==i)throw new Error("ajv implementation error");let s=o.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${i}: ${s.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[i])){let c=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}xi.validateKeywordUsage=Sce});var wF=y(ua=>{"use strict";Object.defineProperty(ua,"__esModule",{value:!0});ua.extendSubschemaMode=ua.extendSubschemaData=ua.getSubschema=void 0;var Si=Ne(),_F=at();function kce(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:i,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,Si._)`${t.schemaPath}${(0,Si.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,Si._)`${t.schemaPath}${(0,Si.getProperty)(e)}${(0,Si.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,_F.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||i===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:s,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}ua.getSubschema=kce;function Ace(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:i,propertyName:s}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:l,dataPathArr:u,opts:d}=e,p=a.let("data",(0,Si._)`${e.data}${(0,Si.getProperty)(r)}`,!0);c(p),t.errorPath=(0,Si.str)`${l}${(0,_F.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,Si._)`${r}`,t.dataPathArr=[...u,t.parentDataProperty]}if(o!==void 0){let l=o instanceof Si.Name?o:a.let("data",o,!0);c(l),s!==void 0&&(t.propertyName=s)}i&&(t.dataTypes=i);function c(l){t.data=l,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,l]}}ua.extendSubschemaData=Ace;function $ce(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:i}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),i!==void 0&&(t.allErrors=i),t.jtdDiscriminator=e,t.jtdMetadata=r}ua.extendSubschemaMode=$ce});var SF=y((vIe,xF)=>{"use strict";var da=xF.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};Dw(e,n,o,t,"",t)};da.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};da.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};da.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};da.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Dw(t,e,r,n,o,i,s,a,c,l){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,i,s,a,c,l);for(var u in n){var d=n[u];if(Array.isArray(d)){if(u in da.arrayKeywords)for(var p=0;p<d.length;p++)Dw(t,e,r,d[p],o+"/"+u+"/"+p,i,o,u,n,p)}else if(u in da.propsKeywords){if(d&&typeof d=="object")for(var f in d)Dw(t,e,r,d[f],o+"/"+u+"/"+Pce(f),i,o,u,n,f)}else(u in da.keywords||t.allKeys&&!(u in da.skipKeywords))&&Dw(t,e,r,d,o+"/"+u,i,o,u,n)}r(n,o,i,s,a,c,l)}}function Pce(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var vh=y(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.getSchemaRefs=An.resolveUrl=An.normalizeId=An._getFullPath=An.getFullPath=An.inlineRef=void 0;var Cce=at(),Ice=Fm(),Tce=SF(),Ece=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Oce(t,e=!0){return typeof t=="boolean"?!0:e===!0?!jE(t):e?kF(t)<=e:!1}An.inlineRef=Oce;var jce=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function jE(t){for(let e in t){if(jce.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(jE)||typeof r=="object"&&jE(r))return!0}return!1}function kF(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!Ece.has(r)&&(typeof t[r]=="object"&&(0,Cce.eachItem)(t[r],n=>e+=kF(n)),e===1/0))return 1/0}return e}function AF(t,e="",r){r!==!1&&(e=td(e));let n=t.parse(e);return $F(t,n)}An.getFullPath=AF;function $F(t,e){return t.serialize(e).split("#")[0]+"#"}An._getFullPath=$F;var Nce=/#\/?$/;function td(t){return t?t.replace(Nce,""):""}An.normalizeId=td;function Rce(t,e,r){return r=td(r),t.resolve(e,r)}An.resolveUrl=Rce;var zce=/^[a-z_][-a-z0-9._]*$/i;function Mce(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=td(t[r]||e),i={"":o},s=AF(n,o,!1),a={},c=new Set;return Tce(t,{allKeys:!0},(d,p,f,m)=>{if(m===void 0)return;let h=s+p,g=i[m];typeof d[r]=="string"&&(g=v.call(this,d[r])),b.call(this,d.$anchor),b.call(this,d.$dynamicAnchor),i[p]=g;function v(S){let j=this.opts.uriResolver.resolve;if(S=td(g?j(g,S):S),c.has(S))throw u(S);c.add(S);let C=this.refs[S];return typeof C=="string"&&(C=this.refs[C]),typeof C=="object"?l(d,C.schema,S):S!==td(h)&&(S[0]==="#"?(l(d,a[S],S),a[S]=d):this.refs[S]=h),S}function b(S){if(typeof S=="string"){if(!zce.test(S))throw new Error(`invalid anchor "${S}"`);v.call(this,`#${S}`)}}}),a;function l(d,p,f){if(p!==void 0&&!Ice(d,p))throw u(f)}function u(d){return new Error(`reference "${d}" resolves to more than one schema`)}}An.getSchemaRefs=Mce});var wh=y(pa=>{"use strict";Object.defineProperty(pa,"__esModule",{value:!0});pa.getData=pa.KeywordCxt=pa.validateFunctionCode=void 0;var EF=aF(),PF=yh(),RE=$E(),qw=yh(),Dce=mF(),_h=bF(),NE=wF(),ce=Ne(),ke=cs(),qce=vh(),ls=at(),bh=gh();function Bce(t){if(NF(t)&&(RF(t),jF(t))){Fce(t);return}OF(t,()=>(0,EF.topBoolOrEmptySchema)(t))}pa.validateFunctionCode=Bce;function OF({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},i){o.code.es5?t.func(e,(0,ce._)`${ke.default.data}, ${ke.default.valCxt}`,n.$async,()=>{t.code((0,ce._)`"use strict"; ${CF(r,o)}`),Lce(t,o),t.code(i)}):t.func(e,(0,ce._)`${ke.default.data}, ${Uce(o)}`,n.$async,()=>t.code(CF(r,o)).code(i))}function Uce(t){return(0,ce._)`{${ke.default.instancePath}="", ${ke.default.parentData}, ${ke.default.parentDataProperty}, ${ke.default.rootData}=${ke.default.data}${t.dynamicRef?(0,ce._)`, ${ke.default.dynamicAnchors}={}`:ce.nil}}={}`}function Lce(t,e){t.if(ke.default.valCxt,()=>{t.var(ke.default.instancePath,(0,ce._)`${ke.default.valCxt}.${ke.default.instancePath}`),t.var(ke.default.parentData,(0,ce._)`${ke.default.valCxt}.${ke.default.parentData}`),t.var(ke.default.parentDataProperty,(0,ce._)`${ke.default.valCxt}.${ke.default.parentDataProperty}`),t.var(ke.default.rootData,(0,ce._)`${ke.default.valCxt}.${ke.default.rootData}`),e.dynamicRef&&t.var(ke.default.dynamicAnchors,(0,ce._)`${ke.default.valCxt}.${ke.default.dynamicAnchors}`)},()=>{t.var(ke.default.instancePath,(0,ce._)`""`),t.var(ke.default.parentData,(0,ce._)`undefined`),t.var(ke.default.parentDataProperty,(0,ce._)`undefined`),t.var(ke.default.rootData,ke.default.data),e.dynamicRef&&t.var(ke.default.dynamicAnchors,(0,ce._)`{}`)})}function Fce(t){let{schema:e,opts:r,gen:n}=t;OF(t,()=>{r.$comment&&e.$comment&&MF(t),Zce(t),n.let(ke.default.vErrors,null),n.let(ke.default.errors,0),r.unevaluated&&Vce(t),zF(t),Yce(t)})}function Vce(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,ce._)`${r}.evaluated`),e.if((0,ce._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,ce._)`${t.evaluated}.props`,(0,ce._)`undefined`)),e.if((0,ce._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,ce._)`${t.evaluated}.items`,(0,ce._)`undefined`))}function CF(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,ce._)`/*# sourceURL=${r} */`:ce.nil}function Hce(t,e){if(NF(t)&&(RF(t),jF(t))){Gce(t,e);return}(0,EF.boolOrEmptySchema)(t,e)}function jF({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function NF(t){return typeof t.schema!="boolean"}function Gce(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&MF(t),Kce(t),Jce(t);let i=n.const("_errs",ke.default.errors);zF(t,i),n.var(e,(0,ce._)`${i} === ${ke.default.errors}`)}function RF(t){(0,ls.checkUnknownRules)(t),Wce(t)}function zF(t,e){if(t.opts.jtd)return IF(t,[],!1,e);let r=(0,PF.getSchemaTypes)(t.schema),n=(0,PF.coerceAndCheckDataType)(t,r);IF(t,r,!n,e)}function Wce(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,ls.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function Zce(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,ls.checkStrictMode)(t,"default is ignored in the schema root")}function Kce(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,qce.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function Jce(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function MF({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let i=r.$comment;if(o.$comment===!0)t.code((0,ce._)`${ke.default.self}.logger.log(${i})`);else if(typeof o.$comment=="function"){let s=(0,ce.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,ce._)`${ke.default.self}.opts.$comment(${i}, ${s}, ${a}.schema)`)}}function Yce(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:i}=t;r.$async?e.if((0,ce._)`${ke.default.errors} === 0`,()=>e.return(ke.default.data),()=>e.throw((0,ce._)`new ${o}(${ke.default.vErrors})`)):(e.assign((0,ce._)`${n}.errors`,ke.default.vErrors),i.unevaluated&&Qce(t),e.return((0,ce._)`${ke.default.errors} === 0`))}function Qce({gen:t,evaluated:e,props:r,items:n}){r instanceof ce.Name&&t.assign((0,ce._)`${e}.props`,r),n instanceof ce.Name&&t.assign((0,ce._)`${e}.items`,n)}function IF(t,e,r,n){let{gen:o,schema:i,data:s,allErrors:a,opts:c,self:l}=t,{RULES:u}=l;if(i.$ref&&(c.ignoreKeywordsWithRef||!(0,ls.schemaHasRulesButRef)(i,u))){o.block(()=>qF(t,"$ref",u.all.$ref.definition));return}c.jtd||Xce(t,e),o.block(()=>{for(let p of u.rules)d(p);d(u.post)});function d(p){(0,RE.shouldUseGroup)(i,p)&&(p.type?(o.if((0,qw.checkDataType)(p.type,s,c.strictNumbers)),TF(t,p),e.length===1&&e[0]===p.type&&r&&(o.else(),(0,qw.reportTypeError)(t)),o.endIf()):TF(t,p),a||o.if((0,ce._)`${ke.default.errors} === ${n||0}`))}}function TF(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,Dce.assignDefaults)(t,e.type),r.block(()=>{for(let i of e.rules)(0,RE.shouldUseRule)(n,i)&&qF(t,i.keyword,i.definition,e.type)})}function Xce(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(ele(t,e),t.opts.allowUnionTypes||tle(t,e),rle(t,t.dataTypes))}function ele(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{DF(t.dataTypes,r)||zE(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),ole(t,e)}}function tle(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&zE(t,"use allowUnionTypes to allow union type keyword")}function rle(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,RE.shouldUseRule)(t.schema,o)){let{type:i}=o.definition;i.length&&!i.some(s=>nle(e,s))&&zE(t,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function nle(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function DF(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function ole(t,e){let r=[];for(let n of t.dataTypes)DF(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function zE(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,ls.checkStrictMode)(t,e,t.opts.strictTypes)}var Bw=class{constructor(e,r,n){if((0,_h.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,ls.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",BF(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,_h.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",ke.default.errors))}result(e,r,n){this.failResult((0,ce.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,ce.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,ce._)`${r} !== undefined && (${(0,ce.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?bh.reportExtraError:bh.reportError)(this,this.def.error,r)}$dataError(){(0,bh.reportError)(this,this.def.$dataError||bh.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,bh.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=ce.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=ce.nil,r=ce.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:i,def:s}=this;n.if((0,ce.or)((0,ce._)`${o} === undefined`,r)),e!==ce.nil&&n.assign(e,!0),(i.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==ce.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:i}=this;return(0,ce.or)(s(),a());function s(){if(n.length){if(!(r instanceof ce.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,ce._)`${(0,qw.checkDataTypes)(c,r,i.opts.strictNumbers,qw.DataType.Wrong)}`}return ce.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,ce._)`!${c}(${r})`}return ce.nil}}subschema(e,r){let n=(0,NE.getSubschema)(this.it,e);(0,NE.extendSubschemaData)(n,this.it,e),(0,NE.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return Hce(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=ls.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=ls.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,ce.Name)),!0}};pa.KeywordCxt=Bw;function qF(t,e,r,n){let o=new Bw(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,_h.funcKeywordCode)(o,r):"macro"in r?(0,_h.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,_h.funcKeywordCode)(o,r)}var ile=/^\/(?:[^~]|~0|~1)*$/,sle=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function BF(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,i;if(t==="")return ke.default.rootData;if(t[0]==="/"){if(!ile.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,i=ke.default.rootData}else{let l=sle.exec(t);if(!l)throw new Error(`Invalid JSON-pointer: ${t}`);let u=+l[1];if(o=l[2],o==="#"){if(u>=e)throw new Error(c("property/index",u));return n[e-u]}if(u>e)throw new Error(c("data",u));if(i=r[e-u],!o)return i}let s=i,a=o.split("/");for(let l of a)l&&(i=(0,ce._)`${i}${(0,ce.getProperty)((0,ls.unescapeJsonPointer)(l))}`,s=(0,ce._)`${s} && ${i}`);return s;function c(l,u){return`Cannot access ${l} ${u} levels up, current level is ${e}`}}pa.getData=BF});var Uw=y(DE=>{"use strict";Object.defineProperty(DE,"__esModule",{value:!0});var ME=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};DE.default=ME});var xh=y(UE=>{"use strict";Object.defineProperty(UE,"__esModule",{value:!0});var qE=vh(),BE=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,qE.resolveUrl)(e,r,n),this.missingSchema=(0,qE.normalizeId)((0,qE.getFullPath)(e,this.missingRef))}};UE.default=BE});var Fw=y(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.resolveSchema=ho.getCompilingSchema=ho.resolveRef=ho.compileSchema=ho.SchemaEnv=void 0;var Lo=Ne(),ale=Uw(),vc=cs(),Fo=vh(),UF=at(),cle=wh(),rd=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,Fo.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};ho.SchemaEnv=rd;function FE(t){let e=LF.call(this,t);if(e)return e;let r=(0,Fo.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:i}=this.opts,s=new Lo.CodeGen(this.scope,{es5:n,lines:o,ownProperties:i}),a;t.$async&&(a=s.scopeValue("Error",{ref:ale.default,code:(0,Lo._)`require("ajv/dist/runtime/validation_error").default`}));let c=s.scopeName("validate");t.validateName=c;let l={gen:s,allErrors:this.opts.allErrors,data:vc.default.data,parentData:vc.default.parentData,parentDataProperty:vc.default.parentDataProperty,dataNames:[vc.default.data],dataPathArr:[Lo.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,Lo.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:Lo.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,Lo._)`""`,opts:this.opts,self:this},u;try{this._compilations.add(t),(0,cle.validateFunctionCode)(l),s.optimize(this.opts.code.optimize);let d=s.toString();u=`${s.scopeRefs(vc.default.scope)}return ${d}`,this.opts.code.process&&(u=this.opts.code.process(u,t));let f=new Function(`${vc.default.self}`,`${vc.default.scope}`,u)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:s._values}),this.opts.unevaluated){let{props:m,items:h}=l;f.evaluated={props:m instanceof Lo.Name?void 0:m,items:h instanceof Lo.Name?void 0:h,dynamicProps:m instanceof Lo.Name,dynamicItems:h instanceof Lo.Name},f.source&&(f.source.evaluated=(0,Lo.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,u&&this.logger.error("Error compiling schema, function code:",u),d}finally{this._compilations.delete(t)}}ho.compileSchema=FE;function lle(t,e,r){var n;r=(0,Fo.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let i=ple.call(this,t,r);if(i===void 0){let s=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;s&&(i=new rd({schema:s,schemaId:a,root:t,baseId:e}))}if(i!==void 0)return t.refs[r]=ule.call(this,i)}ho.resolveRef=lle;function ule(t){return(0,Fo.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:FE.call(this,t)}function LF(t){for(let e of this._compilations)if(dle(e,t))return e}ho.getCompilingSchema=LF;function dle(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function ple(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||Lw.call(this,t,e)}function Lw(t,e){let r=this.opts.uriResolver.parse(e),n=(0,Fo._getFullPath)(this.opts.uriResolver,r),o=(0,Fo.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return LE.call(this,r,t);let i=(0,Fo.normalizeId)(n),s=this.refs[i]||this.schemas[i];if(typeof s=="string"){let a=Lw.call(this,t,s);return typeof a?.schema!="object"?void 0:LE.call(this,r,a)}if(typeof s?.schema=="object"){if(s.validate||FE.call(this,s),i===(0,Fo.normalizeId)(e)){let{schema:a}=s,{schemaId:c}=this.opts,l=a[c];return l&&(o=(0,Fo.resolveUrl)(this.opts.uriResolver,o,l)),new rd({schema:a,schemaId:c,root:t,baseId:o})}return LE.call(this,r,s)}}ho.resolveSchema=Lw;var fle=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function LE(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,UF.unescapeFragment)(a)];if(c===void 0)return;r=c;let l=typeof r=="object"&&r[this.opts.schemaId];!fle.has(a)&&l&&(e=(0,Fo.resolveUrl)(this.opts.uriResolver,e,l))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,UF.schemaHasRulesButRef)(r,this.RULES)){let a=(0,Fo.resolveUrl)(this.opts.uriResolver,e,r.$ref);i=Lw.call(this,n,a)}let{schemaId:s}=this.opts;if(i=i||new rd({schema:r,schemaId:s,root:n,baseId:e}),i.schema!==i.root.schema)return i}});var FF=y((kIe,mle)=>{mle.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var HF=y(VE=>{"use strict";Object.defineProperty(VE,"__esModule",{value:!0});var VF=sT();VF.code='require("ajv/dist/runtime/uri").default';VE.default=VF});var XF=y(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.CodeGen=Mr.Name=Mr.nil=Mr.stringify=Mr.str=Mr._=Mr.KeywordCxt=void 0;var hle=wh();Object.defineProperty(Mr,"KeywordCxt",{enumerable:!0,get:function(){return hle.KeywordCxt}});var nd=Ne();Object.defineProperty(Mr,"_",{enumerable:!0,get:function(){return nd._}});Object.defineProperty(Mr,"str",{enumerable:!0,get:function(){return nd.str}});Object.defineProperty(Mr,"stringify",{enumerable:!0,get:function(){return nd.stringify}});Object.defineProperty(Mr,"nil",{enumerable:!0,get:function(){return nd.nil}});Object.defineProperty(Mr,"Name",{enumerable:!0,get:function(){return nd.Name}});Object.defineProperty(Mr,"CodeGen",{enumerable:!0,get:function(){return nd.CodeGen}});var gle=Uw(),JF=xh(),yle=AE(),Sh=Fw(),vle=Ne(),kh=vh(),Vw=yh(),GE=at(),GF=FF(),ble=HF(),YF=(t,e)=>new RegExp(t,e);YF.code="new RegExp";var _le=["removeAdditional","useDefaults","coerceTypes"],wle=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),xle={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Sle={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},WF=200;function kle(t){var e,r,n,o,i,s,a,c,l,u,d,p,f,m,h,g,v,b,S,j,C,ie,pe,me,Ce;let Ge=t.strict,dr=(e=t.code)===null||e===void 0?void 0:e.optimize,nn=dr===!0||dr===void 0?1:dr||0,Yt=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:YF,di=(o=t.uriResolver)!==null&&o!==void 0?o:ble.default;return{strictSchema:(s=(i=t.strictSchema)!==null&&i!==void 0?i:Ge)!==null&&s!==void 0?s:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:Ge)!==null&&c!==void 0?c:!0,strictTypes:(u=(l=t.strictTypes)!==null&&l!==void 0?l:Ge)!==null&&u!==void 0?u:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:Ge)!==null&&p!==void 0?p:"log",strictRequired:(m=(f=t.strictRequired)!==null&&f!==void 0?f:Ge)!==null&&m!==void 0?m:!1,code:t.code?{...t.code,optimize:nn,regExp:Yt}:{optimize:nn,regExp:Yt},loopRequired:(h=t.loopRequired)!==null&&h!==void 0?h:WF,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:WF,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:(b=t.messages)!==null&&b!==void 0?b:!0,inlineRefs:(S=t.inlineRefs)!==null&&S!==void 0?S:!0,schemaId:(j=t.schemaId)!==null&&j!==void 0?j:"$id",addUsedSchema:(C=t.addUsedSchema)!==null&&C!==void 0?C:!0,validateSchema:(ie=t.validateSchema)!==null&&ie!==void 0?ie:!0,validateFormats:(pe=t.validateFormats)!==null&&pe!==void 0?pe:!0,unicodeRegExp:(me=t.unicodeRegExp)!==null&&me!==void 0?me:!0,int32range:(Ce=t.int32range)!==null&&Ce!==void 0?Ce:!0,uriResolver:di}}var Ah=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...kle(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new vle.ValueScope({scope:{},prefixes:wle,es5:r,lines:n}),this.logger=Tle(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,yle.getRules)(),ZF.call(this,xle,e,"NOT SUPPORTED"),ZF.call(this,Sle,e,"DEPRECATED","warn"),this._metaOpts=Cle.call(this),e.formats&&$le.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&Ple.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),Ale.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=GF;n==="id"&&(o={...GF},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(u,d){await i.call(this,u.$schema);let p=this._addSchema(u,d);return p.validate||s.call(this,p)}async function i(u){u&&!this.getSchema(u)&&await o.call(this,{$ref:u},!0)}async function s(u){try{return this._compileSchemaEnv(u)}catch(d){if(!(d instanceof JF.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),s.call(this,u)}}function a({missingSchema:u,missingRef:d}){if(this.refs[u])throw new Error(`AnySchema ${u} is loaded but ${d} cannot be resolved`)}async function c(u){let d=await l.call(this,u);this.refs[u]||await i.call(this,d.$schema),this.refs[u]||this.addSchema(d,u,r)}async function l(u){let d=this._loading[u];if(d)return d;try{return await(this._loading[u]=n(u))}finally{delete this._loading[u]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let s of e)this.addSchema(s,void 0,n,o);return this}let i;if(typeof e=="object"){let{schemaId:s}=this.opts;if(i=e[s],i!==void 0&&typeof i!="string")throw new Error(`schema ${s} must be string`)}return r=(0,kh.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return o}getSchema(e){let r;for(;typeof(r=KF.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new Sh.SchemaEnv({schema:{},schemaId:n});if(r=Sh.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=KF.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,kh.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Ole.call(this,n,r),!r)return(0,GE.eachItem)(n,i=>HE.call(this,i)),this;Nle.call(this,r);let o={...r,type:(0,Vw.getJSONTypes)(r.type),schemaType:(0,Vw.getJSONTypes)(r.schemaType)};return(0,GE.eachItem)(n,o.type.length===0?i=>HE.call(this,i,o):i=>o.type.forEach(s=>HE.call(this,i,o,s))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(i=>i.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,i)=>o+r+i)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let i=o.split("/").slice(1),s=e;for(let a of i)s=s[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:l}=c.definition,u=s[a];l&&u&&(s[a]=QF(u))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,i=this.opts.addUsedSchema){let s,{schemaId:a}=this.opts;if(typeof e=="object")s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,kh.normalizeId)(s||n);let l=kh.getSchemaRefs.call(this,e,n);return c=new Sh.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:l}),this._cache.set(c.schema,c),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):Sh.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{Sh.compileSchema.call(this,e)}finally{this.opts=r}}};Ah.ValidationError=gle.default;Ah.MissingRefError=JF.default;Mr.default=Ah;function ZF(t,e,r,n="error"){for(let o in t){let i=o;i in e&&this.logger[n](`${r}: option ${o}. ${t[i]}`)}}function KF(t){return t=(0,kh.normalizeId)(t),this.schemas[t]||this.refs[t]}function Ale(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function $le(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function Ple(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function Cle(){let t={...this.opts};for(let e of _le)delete t[e];return t}var Ile={log(){},warn(){},error(){}};function Tle(t){if(t===!1)return Ile;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var Ele=/^[a-z_$][a-z0-9_$:-]*$/i;function Ole(t,e){let{RULES:r}=this;if((0,GE.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!Ele.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function HE(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,s=o?i.post:i.rules.find(({type:c})=>c===r);if(s||(s={type:r,rules:[]},i.rules.push(s)),i.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,Vw.getJSONTypes)(e.type),schemaType:(0,Vw.getJSONTypes)(e.schemaType)}};e.before?jle.call(this,s,a,e.before):s.rules.push(a),i.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function jle(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function Nle(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=QF(e)),t.validateSchema=this.compile(e,!0))}var Rle={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function QF(t){return{anyOf:[t,Rle]}}});var eV=y(WE=>{"use strict";Object.defineProperty(WE,"__esModule",{value:!0});var zle={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};WE.default=zle});var oV=y(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});bc.callRef=bc.getValidate=void 0;var Mle=xh(),tV=mo(),$n=Ne(),od=cs(),rV=Fw(),Hw=at(),Dle={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:i,validateName:s,opts:a,self:c}=n,{root:l}=i;if((r==="#"||r==="#/")&&o===l.baseId)return d();let u=rV.resolveRef.call(c,l,o,r);if(u===void 0)throw new Mle.default(n.opts.uriResolver,o,r);if(u instanceof rV.SchemaEnv)return p(u);return f(u);function d(){if(i===l)return Gw(t,s,i,i.$async);let m=e.scopeValue("root",{ref:l});return Gw(t,(0,$n._)`${m}.validate`,l,l.$async)}function p(m){let h=nV(t,m);Gw(t,h,m,m.$async)}function f(m){let h=e.scopeValue("schema",a.code.source===!0?{ref:m,code:(0,$n.stringify)(m)}:{ref:m}),g=e.name("valid"),v=t.subschema({schema:m,dataTypes:[],schemaPath:$n.nil,topSchemaRef:h,errSchemaPath:r},g);t.mergeEvaluated(v),t.ok(g)}}};function nV(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,$n._)`${r.scopeValue("wrapper",{ref:e})}.validate`}bc.getValidate=nV;function Gw(t,e,r,n){let{gen:o,it:i}=t,{allErrors:s,schemaEnv:a,opts:c}=i,l=c.passContext?od.default.this:$n.nil;n?u():d();function u(){if(!a.$async)throw new Error("async schema referenced by sync schema");let m=o.let("valid");o.try(()=>{o.code((0,$n._)`await ${(0,tV.callValidateCode)(t,e,l)}`),f(e),s||o.assign(m,!0)},h=>{o.if((0,$n._)`!(${h} instanceof ${i.ValidationError})`,()=>o.throw(h)),p(h),s||o.assign(m,!1)}),t.ok(m)}function d(){t.result((0,tV.callValidateCode)(t,e,l),()=>f(e),()=>p(e))}function p(m){let h=(0,$n._)`${m}.errors`;o.assign(od.default.vErrors,(0,$n._)`${od.default.vErrors} === null ? ${h} : ${od.default.vErrors}.concat(${h})`),o.assign(od.default.errors,(0,$n._)`${od.default.vErrors}.length`)}function f(m){var h;if(!i.opts.unevaluated)return;let g=(h=r?.validate)===null||h===void 0?void 0:h.evaluated;if(i.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(i.props=Hw.mergeEvaluated.props(o,g.props,i.props));else{let v=o.var("props",(0,$n._)`${m}.evaluated.props`);i.props=Hw.mergeEvaluated.props(o,v,i.props,$n.Name)}if(i.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(i.items=Hw.mergeEvaluated.items(o,g.items,i.items));else{let v=o.var("items",(0,$n._)`${m}.evaluated.items`);i.items=Hw.mergeEvaluated.items(o,v,i.items,$n.Name)}}}bc.callRef=Gw;bc.default=Dle});var iV=y(ZE=>{"use strict";Object.defineProperty(ZE,"__esModule",{value:!0});var qle=eV(),Ble=oV(),Ule=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",qle.default,Ble.default];ZE.default=Ule});var sV=y(KE=>{"use strict";Object.defineProperty(KE,"__esModule",{value:!0});var Ww=Ne(),fa=Ww.operators,Zw={maximum:{okStr:"<=",ok:fa.LTE,fail:fa.GT},minimum:{okStr:">=",ok:fa.GTE,fail:fa.LT},exclusiveMaximum:{okStr:"<",ok:fa.LT,fail:fa.GTE},exclusiveMinimum:{okStr:">",ok:fa.GT,fail:fa.LTE}},Lle={message:({keyword:t,schemaCode:e})=>(0,Ww.str)`must be ${Zw[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Ww._)`{comparison: ${Zw[t].okStr}, limit: ${e}}`},Fle={keyword:Object.keys(Zw),type:"number",schemaType:"number",$data:!0,error:Lle,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,Ww._)`${r} ${Zw[e].fail} ${n} || isNaN(${r})`)}};KE.default=Fle});var aV=y(JE=>{"use strict";Object.defineProperty(JE,"__esModule",{value:!0});var $h=Ne(),Vle={message:({schemaCode:t})=>(0,$h.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,$h._)`{multipleOf: ${t}}`},Hle={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:Vle,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,i=o.opts.multipleOfPrecision,s=e.let("res"),a=i?(0,$h._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${i}`:(0,$h._)`${s} !== parseInt(${s})`;t.fail$data((0,$h._)`(${n} === 0 || (${s} = ${r}/${n}, ${a}))`)}};JE.default=Hle});var lV=y(YE=>{"use strict";Object.defineProperty(YE,"__esModule",{value:!0});function cV(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}YE.default=cV;cV.code='require("ajv/dist/runtime/ucs2length").default'});var uV=y(QE=>{"use strict";Object.defineProperty(QE,"__esModule",{value:!0});var _c=Ne(),Gle=at(),Wle=lV(),Zle={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,_c.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,_c._)`{limit: ${t}}`},Kle={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:Zle,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,i=e==="maxLength"?_c.operators.GT:_c.operators.LT,s=o.opts.unicode===!1?(0,_c._)`${r}.length`:(0,_c._)`${(0,Gle.useFunc)(t.gen,Wle.default)}(${r})`;t.fail$data((0,_c._)`${s} ${i} ${n}`)}};QE.default=Kle});var dV=y(XE=>{"use strict";Object.defineProperty(XE,"__esModule",{value:!0});var Jle=mo(),Kw=Ne(),Yle={message:({schemaCode:t})=>(0,Kw.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,Kw._)`{pattern: ${t}}`},Qle={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:Yle,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:i}=t,s=i.opts.unicodeRegExp?"u":"",a=r?(0,Kw._)`(new RegExp(${o}, ${s}))`:(0,Jle.usePattern)(t,n);t.fail$data((0,Kw._)`!${a}.test(${e})`)}};XE.default=Qle});var pV=y(eO=>{"use strict";Object.defineProperty(eO,"__esModule",{value:!0});var Ph=Ne(),Xle={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,Ph.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Ph._)`{limit: ${t}}`},eue={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:Xle,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?Ph.operators.GT:Ph.operators.LT;t.fail$data((0,Ph._)`Object.keys(${r}).length ${o} ${n}`)}};eO.default=eue});var fV=y(tO=>{"use strict";Object.defineProperty(tO,"__esModule",{value:!0});var Ch=mo(),Ih=Ne(),tue=at(),rue={message:({params:{missingProperty:t}})=>(0,Ih.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,Ih._)`{missingProperty: ${t}}`},nue={keyword:"required",type:"object",schemaType:"array",$data:!0,error:rue,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:i,it:s}=t,{opts:a}=s;if(!i&&r.length===0)return;let c=r.length>=a.loopRequired;if(s.allErrors?l():u(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:m}=t.it;for(let h of r)if(f?.[h]===void 0&&!m.has(h)){let g=s.schemaEnv.baseId+s.errSchemaPath,v=`required property "${h}" is not defined at "${g}" (strictRequired)`;(0,tue.checkStrictMode)(s,v,s.opts.strictRequired)}}function l(){if(c||i)t.block$data(Ih.nil,d);else for(let f of r)(0,Ch.checkReportMissingProp)(t,f)}function u(){let f=e.let("missing");if(c||i){let m=e.let("valid",!0);t.block$data(m,()=>p(f,m)),t.ok(m)}else e.if((0,Ch.checkMissingProp)(t,r,f)),(0,Ch.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,Ch.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function p(f,m){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(m,(0,Ch.propertyInData)(e,o,f,a.ownProperties)),e.if((0,Ih.not)(m),()=>{t.error(),e.break()})},Ih.nil)}}};tO.default=nue});var mV=y(rO=>{"use strict";Object.defineProperty(rO,"__esModule",{value:!0});var Th=Ne(),oue={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,Th.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,Th._)`{limit: ${t}}`},iue={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:oue,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?Th.operators.GT:Th.operators.LT;t.fail$data((0,Th._)`${r}.length ${o} ${n}`)}};rO.default=iue});var Jw=y(nO=>{"use strict";Object.defineProperty(nO,"__esModule",{value:!0});var hV=Fm();hV.code='require("ajv/dist/runtime/equal").default';nO.default=hV});var gV=y(iO=>{"use strict";Object.defineProperty(iO,"__esModule",{value:!0});var oO=yh(),Dr=Ne(),sue=at(),aue=Jw(),cue={message:({params:{i:t,j:e}})=>(0,Dr.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,Dr._)`{i: ${t}, j: ${e}}`},lue={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:cue,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:i,schemaCode:s,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),l=i.items?(0,oO.getSchemaTypes)(i.items):[];t.block$data(c,u,(0,Dr._)`${s} === false`),t.ok(c);function u(){let m=e.let("i",(0,Dr._)`${r}.length`),h=e.let("j");t.setParams({i:m,j:h}),e.assign(c,!0),e.if((0,Dr._)`${m} > 1`,()=>(d()?p:f)(m,h))}function d(){return l.length>0&&!l.some(m=>m==="object"||m==="array")}function p(m,h){let g=e.name("item"),v=(0,oO.checkDataTypes)(l,g,a.opts.strictNumbers,oO.DataType.Wrong),b=e.const("indices",(0,Dr._)`{}`);e.for((0,Dr._)`;${m}--;`,()=>{e.let(g,(0,Dr._)`${r}[${m}]`),e.if(v,(0,Dr._)`continue`),l.length>1&&e.if((0,Dr._)`typeof ${g} == "string"`,(0,Dr._)`${g} += "_"`),e.if((0,Dr._)`typeof ${b}[${g}] == "number"`,()=>{e.assign(h,(0,Dr._)`${b}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,Dr._)`${b}[${g}] = ${m}`)})}function f(m,h){let g=(0,sue.useFunc)(e,aue.default),v=e.name("outer");e.label(v).for((0,Dr._)`;${m}--;`,()=>e.for((0,Dr._)`${h} = ${m}; ${h}--;`,()=>e.if((0,Dr._)`${g}(${r}[${m}], ${r}[${h}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};iO.default=lue});var yV=y(aO=>{"use strict";Object.defineProperty(aO,"__esModule",{value:!0});var sO=Ne(),uue=at(),due=Jw(),pue={message:"must be equal to constant",params:({schemaCode:t})=>(0,sO._)`{allowedValue: ${t}}`},fue={keyword:"const",$data:!0,error:pue,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:i}=t;n||i&&typeof i=="object"?t.fail$data((0,sO._)`!${(0,uue.useFunc)(e,due.default)}(${r}, ${o})`):t.fail((0,sO._)`${i} !== ${r}`)}};aO.default=fue});var vV=y(cO=>{"use strict";Object.defineProperty(cO,"__esModule",{value:!0});var Eh=Ne(),mue=at(),hue=Jw(),gue={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,Eh._)`{allowedValues: ${t}}`},yue={keyword:"enum",schemaType:"array",$data:!0,error:gue,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:i,it:s}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=s.opts.loopEnum,c,l=()=>c??(c=(0,mue.useFunc)(e,hue.default)),u;if(a||n)u=e.let("valid"),t.block$data(u,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",i);u=(0,Eh.or)(...o.map((m,h)=>p(f,h)))}t.pass(u);function d(){e.assign(u,!1),e.forOf("v",i,f=>e.if((0,Eh._)`${l()}(${r}, ${f})`,()=>e.assign(u,!0).break()))}function p(f,m){let h=o[m];return typeof h=="object"&&h!==null?(0,Eh._)`${l()}(${r}, ${f}[${m}])`:(0,Eh._)`${r} === ${h}`}}};cO.default=yue});var bV=y(lO=>{"use strict";Object.defineProperty(lO,"__esModule",{value:!0});var vue=sV(),bue=aV(),_ue=uV(),wue=dV(),xue=pV(),Sue=fV(),kue=mV(),Aue=gV(),$ue=yV(),Pue=vV(),Cue=[vue.default,bue.default,_ue.default,wue.default,xue.default,Sue.default,kue.default,Aue.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},$ue.default,Pue.default];lO.default=Cue});var dO=y(Oh=>{"use strict";Object.defineProperty(Oh,"__esModule",{value:!0});Oh.validateAdditionalItems=void 0;var wc=Ne(),uO=at(),Iue={message:({params:{len:t}})=>(0,wc.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,wc._)`{limit: ${t}}`},Tue={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Iue,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,uO.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}_V(t,n)}};function _V(t,e){let{gen:r,schema:n,data:o,keyword:i,it:s}=t;s.items=!0;let a=r.const("len",(0,wc._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,wc._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,uO.alwaysValidSchema)(s,n)){let l=r.var("valid",(0,wc._)`${a} <= ${e.length}`);r.if((0,wc.not)(l),()=>c(l)),t.ok(l)}function c(l){r.forRange("i",e.length,a,u=>{t.subschema({keyword:i,dataProp:u,dataPropType:uO.Type.Num},l),s.allErrors||r.if((0,wc.not)(l),()=>r.break())})}}Oh.validateAdditionalItems=_V;Oh.default=Tue});var pO=y(jh=>{"use strict";Object.defineProperty(jh,"__esModule",{value:!0});jh.validateTuple=void 0;var wV=Ne(),Yw=at(),Eue=mo(),Oue={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return xV(t,"additionalItems",e);r.items=!0,!(0,Yw.alwaysValidSchema)(r,e)&&t.ok((0,Eue.validateArray)(t))}};function xV(t,e,r=t.schema){let{gen:n,parentSchema:o,data:i,keyword:s,it:a}=t;u(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=Yw.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),l=n.const("len",(0,wV._)`${i}.length`);r.forEach((d,p)=>{(0,Yw.alwaysValidSchema)(a,d)||(n.if((0,wV._)`${l} > ${p}`,()=>t.subschema({keyword:s,schemaProp:p,dataProp:p},c)),t.ok(c))});function u(d){let{opts:p,errSchemaPath:f}=a,m=r.length,h=m===d.minItems&&(m===d.maxItems||d[e]===!1);if(p.strictTuples&&!h){let g=`"${s}" is ${m}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,Yw.checkStrictMode)(a,g,p.strictTuples)}}}jh.validateTuple=xV;jh.default=Oue});var SV=y(fO=>{"use strict";Object.defineProperty(fO,"__esModule",{value:!0});var jue=pO(),Nue={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,jue.validateTuple)(t,"items")};fO.default=Nue});var AV=y(mO=>{"use strict";Object.defineProperty(mO,"__esModule",{value:!0});var kV=Ne(),Rue=at(),zue=mo(),Mue=dO(),Due={message:({params:{len:t}})=>(0,kV.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,kV._)`{limit: ${t}}`},que={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:Due,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,Rue.alwaysValidSchema)(n,e)&&(o?(0,Mue.validateAdditionalItems)(t,o):t.ok((0,zue.validateArray)(t)))}};mO.default=que});var $V=y(hO=>{"use strict";Object.defineProperty(hO,"__esModule",{value:!0});var go=Ne(),Qw=at(),Bue={message:({params:{min:t,max:e}})=>e===void 0?(0,go.str)`must contain at least ${t} valid item(s)`:(0,go.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,go._)`{minContains: ${t}}`:(0,go._)`{minContains: ${t}, maxContains: ${e}}`},Uue={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:Bue,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t,s,a,{minContains:c,maxContains:l}=n;i.opts.next?(s=c===void 0?1:c,a=l):s=1;let u=e.const("len",(0,go._)`${o}.length`);if(t.setParams({min:s,max:a}),a===void 0&&s===0){(0,Qw.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,Qw.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,Qw.alwaysValidSchema)(i,r)){let h=(0,go._)`${u} >= ${s}`;a!==void 0&&(h=(0,go._)`${h} && ${u} <= ${a}`),t.pass(h);return}i.items=!0;let d=e.name("valid");a===void 0&&s===1?f(d,()=>e.if(d,()=>e.break())):s===0?(e.let(d,!0),a!==void 0&&e.if((0,go._)`${o}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let h=e.name("_valid"),g=e.let("count",0);f(h,()=>e.if(h,()=>m(g)))}function f(h,g){e.forRange("i",0,u,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:Qw.Type.Num,compositeRule:!0},h),g()})}function m(h){e.code((0,go._)`${h}++`),a===void 0?e.if((0,go._)`${h} >= ${s}`,()=>e.assign(d,!0).break()):(e.if((0,go._)`${h} > ${a}`,()=>e.assign(d,!1).break()),s===1?e.assign(d,!0):e.if((0,go._)`${h} >= ${s}`,()=>e.assign(d,!0)))}}};hO.default=Uue});var IV=y(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.validateSchemaDeps=ki.validatePropertyDeps=ki.error=void 0;var gO=Ne(),Lue=at(),Nh=mo();ki.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,gO.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,gO._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var Fue={keyword:"dependencies",type:"object",schemaType:"object",error:ki.error,code(t){let[e,r]=Vue(t);PV(t,e),CV(t,r)}};function Vue({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function PV(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let i=r.let("missing");for(let s in e){let a=e[s];if(a.length===0)continue;let c=(0,Nh.propertyInData)(r,n,s,o.opts.ownProperties);t.setParams({property:s,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let l of a)(0,Nh.checkReportMissingProp)(t,l)}):(r.if((0,gO._)`${c} && (${(0,Nh.checkMissingProp)(t,a,i)})`),(0,Nh.reportMissingProp)(t,i),r.else())}}ki.validatePropertyDeps=PV;function CV(t,e=t.schema){let{gen:r,data:n,keyword:o,it:i}=t,s=r.name("valid");for(let a in e)(0,Lue.alwaysValidSchema)(i,e[a])||(r.if((0,Nh.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},s);t.mergeValidEvaluated(c,s)},()=>r.var(s,!0)),t.ok(s))}ki.validateSchemaDeps=CV;ki.default=Fue});var EV=y(yO=>{"use strict";Object.defineProperty(yO,"__esModule",{value:!0});var TV=Ne(),Hue=at(),Gue={message:"property name must be valid",params:({params:t})=>(0,TV._)`{propertyName: ${t.propertyName}}`},Wue={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:Gue,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,Hue.alwaysValidSchema)(o,r))return;let i=e.name("valid");e.forIn("key",n,s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},i),e.if((0,TV.not)(i),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(i)}};yO.default=Wue});var bO=y(vO=>{"use strict";Object.defineProperty(vO,"__esModule",{value:!0});var Xw=mo(),Vo=Ne(),Zue=cs(),ex=at(),Kue={message:"must NOT have additional properties",params:({params:t})=>(0,Vo._)`{additionalProperty: ${t.additionalProperty}}`},Jue={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:Kue,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:i,it:s}=t;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=s;if(s.props=!0,c.removeAdditional!=="all"&&(0,ex.alwaysValidSchema)(s,r))return;let l=(0,Xw.allSchemaProperties)(n.properties),u=(0,Xw.allSchemaProperties)(n.patternProperties);d(),t.ok((0,Vo._)`${i} === ${Zue.default.errors}`);function d(){e.forIn("key",o,g=>{!l.length&&!u.length?m(g):e.if(p(g),()=>m(g))})}function p(g){let v;if(l.length>8){let b=(0,ex.schemaRefOrVal)(s,n.properties,"properties");v=(0,Xw.isOwnProperty)(e,b,g)}else l.length?v=(0,Vo.or)(...l.map(b=>(0,Vo._)`${g} === ${b}`)):v=Vo.nil;return u.length&&(v=(0,Vo.or)(v,...u.map(b=>(0,Vo._)`${(0,Xw.usePattern)(t,b)}.test(${g})`))),(0,Vo.not)(v)}function f(g){e.code((0,Vo._)`delete ${o}[${g}]`)}function m(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,ex.alwaysValidSchema)(s,r)){let v=e.name("valid");c.removeAdditional==="failing"?(h(g,v,!1),e.if((0,Vo.not)(v),()=>{t.reset(),f(g)})):(h(g,v),a||e.if((0,Vo.not)(v),()=>e.break()))}}function h(g,v,b){let S={keyword:"additionalProperties",dataProp:g,dataPropType:ex.Type.Str};b===!1&&Object.assign(S,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(S,v)}}};vO.default=Jue});var NV=y(wO=>{"use strict";Object.defineProperty(wO,"__esModule",{value:!0});var Yue=wh(),OV=mo(),_O=at(),jV=bO(),Que={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&jV.default.code(new Yue.KeywordCxt(i,jV.default,"additionalProperties"));let s=(0,OV.allSchemaProperties)(r);for(let d of s)i.definedProperties.add(d);i.opts.unevaluated&&s.length&&i.props!==!0&&(i.props=_O.mergeEvaluated.props(e,(0,_O.toHash)(s),i.props));let a=s.filter(d=>!(0,_O.alwaysValidSchema)(i,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)l(d)?u(d):(e.if((0,OV.propertyInData)(e,o,d,i.opts.ownProperties)),u(d),i.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function l(d){return i.opts.useDefaults&&!i.compositeRule&&r[d].default!==void 0}function u(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};wO.default=Que});var DV=y(xO=>{"use strict";Object.defineProperty(xO,"__esModule",{value:!0});var RV=mo(),tx=Ne(),zV=at(),MV=at(),Xue={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:i}=t,{opts:s}=i,a=(0,RV.allSchemaProperties)(r),c=a.filter(h=>(0,zV.alwaysValidSchema)(i,r[h]));if(a.length===0||c.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let l=s.strictSchema&&!s.allowMatchingProperties&&o.properties,u=e.name("valid");i.props!==!0&&!(i.props instanceof tx.Name)&&(i.props=(0,MV.evaluatedPropsToName)(e,i.props));let{props:d}=i;p();function p(){for(let h of a)l&&f(h),i.allErrors?m(h):(e.var(u,!0),m(h),e.if(u))}function f(h){for(let g in l)new RegExp(h).test(g)&&(0,zV.checkStrictMode)(i,`property ${g} matches pattern ${h} (use allowMatchingProperties)`)}function m(h){e.forIn("key",n,g=>{e.if((0,tx._)`${(0,RV.usePattern)(t,h)}.test(${g})`,()=>{let v=c.includes(h);v||t.subschema({keyword:"patternProperties",schemaProp:h,dataProp:g,dataPropType:MV.Type.Str},u),i.opts.unevaluated&&d!==!0?e.assign((0,tx._)`${d}[${g}]`,!0):!v&&!i.allErrors&&e.if((0,tx.not)(u),()=>e.break())})})}}};xO.default=Xue});var qV=y(SO=>{"use strict";Object.defineProperty(SO,"__esModule",{value:!0});var ede=at(),tde={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,ede.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};SO.default=tde});var BV=y(kO=>{"use strict";Object.defineProperty(kO,"__esModule",{value:!0});var rde=mo(),nde={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:rde.validateUnion,error:{message:"must match a schema in anyOf"}};kO.default=nde});var UV=y(AO=>{"use strict";Object.defineProperty(AO,"__esModule",{value:!0});var rx=Ne(),ode=at(),ide={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,rx._)`{passingSchemas: ${t.passing}}`},sde={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:ide,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let i=r,s=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(l),t.result(s,()=>t.reset(),()=>t.error(!0));function l(){i.forEach((u,d)=>{let p;(0,ode.alwaysValidSchema)(o,u)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,rx._)`${c} && ${s}`).assign(s,!1).assign(a,(0,rx._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(s,!0),e.assign(a,d),p&&t.mergeEvaluated(p,rx.Name)})})}}};AO.default=sde});var LV=y($O=>{"use strict";Object.defineProperty($O,"__esModule",{value:!0});var ade=at(),cde={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((i,s)=>{if((0,ade.alwaysValidSchema)(n,i))return;let a=t.subschema({keyword:"allOf",schemaProp:s},o);t.ok(o),t.mergeEvaluated(a)})}};$O.default=cde});var HV=y(PO=>{"use strict";Object.defineProperty(PO,"__esModule",{value:!0});var nx=Ne(),VV=at(),lde={message:({params:t})=>(0,nx.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,nx._)`{failingKeyword: ${t.ifClause}}`},ude={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:lde,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,VV.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=FV(n,"then"),i=FV(n,"else");if(!o&&!i)return;let s=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&i){let u=e.let("ifClause");t.setParams({ifClause:u}),e.if(a,l("then",u),l("else",u))}else o?e.if(a,l("then")):e.if((0,nx.not)(a),l("else"));t.pass(s,()=>t.error(!0));function c(){let u=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(u)}function l(u,d){return()=>{let p=t.subschema({keyword:u},a);e.assign(s,a),t.mergeValidEvaluated(p,s),d?e.assign(d,(0,nx._)`${u}`):t.setParams({ifClause:u})}}}};function FV(t,e){let r=t.schema[e];return r!==void 0&&!(0,VV.alwaysValidSchema)(t,r)}PO.default=ude});var GV=y(CO=>{"use strict";Object.defineProperty(CO,"__esModule",{value:!0});var dde=at(),pde={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,dde.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};CO.default=pde});var WV=y(IO=>{"use strict";Object.defineProperty(IO,"__esModule",{value:!0});var fde=dO(),mde=SV(),hde=pO(),gde=AV(),yde=$V(),vde=IV(),bde=EV(),_de=bO(),wde=NV(),xde=DV(),Sde=qV(),kde=BV(),Ade=UV(),$de=LV(),Pde=HV(),Cde=GV();function Ide(t=!1){let e=[Sde.default,kde.default,Ade.default,$de.default,Pde.default,Cde.default,bde.default,_de.default,vde.default,wde.default,xde.default];return t?e.push(mde.default,gde.default):e.push(fde.default,hde.default),e.push(yde.default),e}IO.default=Ide});var ZV=y(TO=>{"use strict";Object.defineProperty(TO,"__esModule",{value:!0});var sr=Ne(),Tde={message:({schemaCode:t})=>(0,sr.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,sr._)`{format: ${t}}`},Ede={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:Tde,code(t,e){let{gen:r,data:n,$data:o,schema:i,schemaCode:s,it:a}=t,{opts:c,errSchemaPath:l,schemaEnv:u,self:d}=a;if(!c.validateFormats)return;o?p():f();function p(){let m=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),h=r.const("fDef",(0,sr._)`${m}[${s}]`),g=r.let("fType"),v=r.let("format");r.if((0,sr._)`typeof ${h} == "object" && !(${h} instanceof RegExp)`,()=>r.assign(g,(0,sr._)`${h}.type || "string"`).assign(v,(0,sr._)`${h}.validate`),()=>r.assign(g,(0,sr._)`"string"`).assign(v,h)),t.fail$data((0,sr.or)(b(),S()));function b(){return c.strictSchema===!1?sr.nil:(0,sr._)`${s} && !${v}`}function S(){let j=u.$async?(0,sr._)`(${h}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,sr._)`${v}(${n})`,C=(0,sr._)`(typeof ${v} == "function" ? ${j} : ${v}.test(${n}))`;return(0,sr._)`${v} && ${v} !== true && ${g} === ${e} && !${C}`}}function f(){let m=d.formats[i];if(!m){b();return}if(m===!0)return;let[h,g,v]=S(m);h===e&&t.pass(j());function b(){if(c.strictSchema===!1){d.logger.warn(C());return}throw new Error(C());function C(){return`unknown format "${i}" ignored in schema at path "${l}"`}}function S(C){let ie=C instanceof RegExp?(0,sr.regexpCode)(C):c.code.formats?(0,sr._)`${c.code.formats}${(0,sr.getProperty)(i)}`:void 0,pe=r.scopeValue("formats",{key:i,ref:C,code:ie});return typeof C=="object"&&!(C instanceof RegExp)?[C.type||"string",C.validate,(0,sr._)`${pe}.validate`]:["string",C,pe]}function j(){if(typeof m=="object"&&!(m instanceof RegExp)&&m.async){if(!u.$async)throw new Error("async format in sync schema");return(0,sr._)`await ${v}(${n})`}return typeof g=="function"?(0,sr._)`${v}(${n})`:(0,sr._)`${v}.test(${n})`}}}};TO.default=Ede});var KV=y(EO=>{"use strict";Object.defineProperty(EO,"__esModule",{value:!0});var Ode=ZV(),jde=[Ode.default];EO.default=jde});var JV=y(id=>{"use strict";Object.defineProperty(id,"__esModule",{value:!0});id.contentVocabulary=id.metadataVocabulary=void 0;id.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];id.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var QV=y(OO=>{"use strict";Object.defineProperty(OO,"__esModule",{value:!0});var Nde=iV(),Rde=bV(),zde=WV(),Mde=KV(),YV=JV(),Dde=[Nde.default,Rde.default,(0,zde.default)(),Mde.default,YV.metadataVocabulary,YV.contentVocabulary];OO.default=Dde});var e5=y(ox=>{"use strict";Object.defineProperty(ox,"__esModule",{value:!0});ox.DiscrError=void 0;var XV;(function(t){t.Tag="tag",t.Mapping="mapping"})(XV||(ox.DiscrError=XV={}))});var r5=y(NO=>{"use strict";Object.defineProperty(NO,"__esModule",{value:!0});var sd=Ne(),jO=e5(),t5=Fw(),qde=xh(),Bde=at(),Ude={message:({params:{discrError:t,tagName:e}})=>t===jO.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,sd._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},Lde={keyword:"discriminator",type:"object",schemaType:"object",error:Ude,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:i}=t,{oneOf:s}=o;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),l=e.const("tag",(0,sd._)`${r}${(0,sd.getProperty)(a)}`);e.if((0,sd._)`typeof ${l} == "string"`,()=>u(),()=>t.error(!1,{discrError:jO.DiscrError.Tag,tag:l,tagName:a})),t.ok(c);function u(){let f=p();e.if(!1);for(let m in f)e.elseIf((0,sd._)`${l} === ${m}`),e.assign(c,d(f[m]));e.else(),t.error(!1,{discrError:jO.DiscrError.Mapping,tag:l,tagName:a}),e.endIf()}function d(f){let m=e.name("valid"),h=t.subschema({keyword:"oneOf",schemaProp:f},m);return t.mergeEvaluated(h,sd.Name),m}function p(){var f;let m={},h=v(o),g=!0;for(let j=0;j<s.length;j++){let C=s[j];if(C?.$ref&&!(0,Bde.schemaHasRulesButRef)(C,i.self.RULES)){let pe=C.$ref;if(C=t5.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,pe),C instanceof t5.SchemaEnv&&(C=C.schema),C===void 0)throw new qde.default(i.opts.uriResolver,i.baseId,pe)}let ie=(f=C?.properties)===null||f===void 0?void 0:f[a];if(typeof ie!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(h||v(C)),b(ie,j)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return m;function v({required:j}){return Array.isArray(j)&&j.includes(a)}function b(j,C){if(j.const)S(j.const,C);else if(j.enum)for(let ie of j.enum)S(ie,C);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function S(j,C){if(typeof j!="string"||j in m)throw new Error(`discriminator: "${a}" values must be unique strings`);m[j]=C}}}};NO.default=Lde});var n5=y((pTe,Fde)=>{Fde.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var i5=y((qt,RO)=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.MissingRefError=qt.ValidationError=qt.CodeGen=qt.Name=qt.nil=qt.stringify=qt.str=qt._=qt.KeywordCxt=qt.Ajv=void 0;var Vde=XF(),Hde=QV(),Gde=r5(),o5=n5(),Wde=["/properties"],ix="http://json-schema.org/draft-07/schema",ad=class extends Vde.default{_addVocabularies(){super._addVocabularies(),Hde.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(Gde.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(o5,Wde):o5;this.addMetaSchema(e,ix,!1),this.refs["http://json-schema.org/schema"]=ix}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(ix)?ix:void 0)}};qt.Ajv=ad;RO.exports=qt=ad;RO.exports.Ajv=ad;Object.defineProperty(qt,"__esModule",{value:!0});qt.default=ad;var Zde=wh();Object.defineProperty(qt,"KeywordCxt",{enumerable:!0,get:function(){return Zde.KeywordCxt}});var cd=Ne();Object.defineProperty(qt,"_",{enumerable:!0,get:function(){return cd._}});Object.defineProperty(qt,"str",{enumerable:!0,get:function(){return cd.str}});Object.defineProperty(qt,"stringify",{enumerable:!0,get:function(){return cd.stringify}});Object.defineProperty(qt,"nil",{enumerable:!0,get:function(){return cd.nil}});Object.defineProperty(qt,"Name",{enumerable:!0,get:function(){return cd.Name}});Object.defineProperty(qt,"CodeGen",{enumerable:!0,get:function(){return cd.CodeGen}});var Kde=Uw();Object.defineProperty(qt,"ValidationError",{enumerable:!0,get:function(){return Kde.default}});var Jde=xh();Object.defineProperty(qt,"MissingRefError",{enumerable:!0,get:function(){return Jde.default}})});var s5=y(ld=>{"use strict";Object.defineProperty(ld,"__esModule",{value:!0});ld.formatLimitDefinition=void 0;var Yde=i5(),Ho=Ne(),ma=Ho.operators,sx={formatMaximum:{okStr:"<=",ok:ma.LTE,fail:ma.GT},formatMinimum:{okStr:">=",ok:ma.GTE,fail:ma.LT},formatExclusiveMaximum:{okStr:"<",ok:ma.LT,fail:ma.GTE},formatExclusiveMinimum:{okStr:">",ok:ma.GT,fail:ma.LTE}},Qde={message:({keyword:t,schemaCode:e})=>(0,Ho.str)`should be ${sx[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Ho._)`{comparison: ${sx[t].okStr}, limit: ${e}}`};ld.formatLimitDefinition={keyword:Object.keys(sx),type:"string",schemaType:"string",$data:!0,error:Qde,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:i}=t,{opts:s,self:a}=i;if(!s.validateFormats)return;let c=new Yde.KeywordCxt(i,a.RULES.all.format.definition,"format");c.$data?l():u();function l(){let p=e.scopeValue("formats",{ref:a.formats,code:s.code.formats}),f=e.const("fmt",(0,Ho._)`${p}[${c.schemaCode}]`);t.fail$data((0,Ho.or)((0,Ho._)`typeof ${f} != "object"`,(0,Ho._)`${f} instanceof RegExp`,(0,Ho._)`typeof ${f}.compare != "function"`,d(f)))}function u(){let p=c.schema,f=a.formats[p];if(!f||f===!0)return;if(typeof f!="object"||f instanceof RegExp||typeof f.compare!="function")throw new Error(`"${o}": format "${p}" does not define "compare" function`);let m=e.scopeValue("formats",{key:p,ref:f,code:s.code.formats?(0,Ho._)`${s.code.formats}${(0,Ho.getProperty)(p)}`:void 0});t.fail$data(d(m))}function d(p){return(0,Ho._)`${p}.compare(${r}, ${n}) ${sx[o].fail} 0`}},dependencies:["format"]};var Xde=t=>(t.addKeyword(ld.formatLimitDefinition),t);ld.default=Xde});var u5=y((Rh,l5)=>{"use strict";Object.defineProperty(Rh,"__esModule",{value:!0});var ud=H6(),epe=s5(),zO=Ne(),a5=new zO.Name("fullFormats"),tpe=new zO.Name("fastFormats"),MO=(t,e={keywords:!0})=>{if(Array.isArray(e))return c5(t,e,ud.fullFormats,a5),t;let[r,n]=e.mode==="fast"?[ud.fastFormats,tpe]:[ud.fullFormats,a5],o=e.formats||ud.formatNames;return c5(t,o,r,n),e.keywords&&(0,epe.default)(t),t};MO.get=(t,e="full")=>{let n=(e==="fast"?ud.fastFormats:ud.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function c5(t,e,r,n){var o,i;(o=(i=t.opts.code).formats)!==null&&o!==void 0||(i.formats=(0,zO._)`require("ajv-formats/dist/formats").${n}`);for(let s of e)t.addFormat(s,r[s])}l5.exports=Rh=MO;Object.defineProperty(Rh,"__esModule",{value:!0});Rh.default=MO});function rpe(){let t=new d5.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,p5.default)(t),t}var d5,p5,ax,f5=x(()=>{d5=ct(M6(),1),p5=ct(u5(),1);ax=class{constructor(e){this._ajv=e??rpe()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}}});var cx,m5=x(()=>{Ys();cx=class{constructor(e){this._client=e}async*callToolStream(e,r=Js,n){let o=this._client,i={...n,task:n?.task??(o.isToolTask(e.name)?{}:void 0)},s=o.requestStream({method:"tools/call",params:e},r,i),a=o.getToolOutputValidator(e.name);for await(let c of s){if(c.type==="result"&&a){let l=c.result;if(!l.structuredContent&&!l.isError){yield{type:"error",error:new fe(xe.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`)};return}if(l.structuredContent)try{let u=a(l.structuredContent);if(!u.valid){yield{type:"error",error:new fe(xe.InvalidParams,`Structured content does not match the tool's output schema: ${u.errorMessage}`)};return}}catch(u){if(u instanceof fe){yield{type:"error",error:u};return}yield{type:"error",error:new fe(xe.InvalidParams,`Failed to validate structured content: ${u instanceof Error?u.message:String(u)}`)};return}}yield c}}async getTask(e,r){return this._client.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._client.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._client.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._client.cancelTask({taskId:e},r)}requestStream(e,r,n){return this._client.requestStream(e,r,n)}}});function h5(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function g5(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var y5=x(()=>{});function lx(t,e){if(!(!t||e===null||typeof e!="object")){if(t.type==="object"&&t.properties&&typeof t.properties=="object"){let r=e,n=t.properties;for(let o of Object.keys(n)){let i=n[o];r[o]===void 0&&Object.prototype.hasOwnProperty.call(i,"default")&&(r[o]=i.default),r[o]!==void 0&&lx(i,r[o])}}if(Array.isArray(t.anyOf))for(let r of t.anyOf)typeof r!="boolean"&&lx(r,e);if(Array.isArray(t.oneOf))for(let r of t.oneOf)typeof r!="boolean"&&lx(r,e)}}function npe(t){if(!t)return{supportsFormMode:!1,supportsUrlMode:!1};let e=t.form!==void 0,r=t.url!==void 0;return{supportsFormMode:e||!e&&!r,supportsUrlMode:r}}var ux,v5=x(()=>{dU();Ys();f5();f_();m5();y5();ux=class extends W_{constructor(e,r){super(r),this._clientInfo=e,this._cachedToolOutputValidators=new Map,this._cachedKnownTaskTools=new Set,this._cachedRequiredTaskTools=new Set,this._listChangedDebounceTimers=new Map,this._capabilities=r?.capabilities??{},this._jsonSchemaValidator=r?.jsonSchemaValidator??new ax,r?.listChanged&&(this._pendingListChangedConfig=r.listChanged)}_setupListChangedHandlers(e){e.tools&&this._serverCapabilities?.tools?.listChanged&&this._setupListChangedHandler("tools",jC,e.tools,async()=>(await this.listTools()).tools),e.prompts&&this._serverCapabilities?.prompts?.listChanged&&this._setupListChangedHandler("prompts",OC,e.prompts,async()=>(await this.listPrompts()).prompts),e.resources&&this._serverCapabilities?.resources?.listChanged&&this._setupListChangedHandler("resources",AC,e.resources,async()=>(await this.listResources()).resources)}get experimental(){return this._experimental||(this._experimental={tasks:new cx(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=uU(this._capabilities,e)}setRequestHandler(e,r){let o=p_(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let i;if(Tu(o)){let a=o;i=a._zod?.def?.value??a.value}else{let a=o;i=a._def?.value??a.value}if(typeof i!="string")throw new Error("Schema method literal must be a string");let s=i;if(s==="elicitation/create"){let a=async(c,l)=>{let u=zo(zC,c);if(!u.success){let b=u.error instanceof Error?u.error.message:String(u.error);throw new fe(xe.InvalidParams,`Invalid elicitation request: ${b}`)}let{params:d}=u.data;d.mode=d.mode??"form";let{supportsFormMode:p,supportsUrlMode:f}=npe(this._capabilities.elicitation);if(d.mode==="form"&&!p)throw new fe(xe.InvalidParams,"Client does not support form-mode elicitation requests");if(d.mode==="url"&&!f)throw new fe(xe.InvalidParams,"Client does not support URL-mode elicitation requests");let m=await Promise.resolve(r(c,l));if(d.task){let b=zo(tc,m);if(!b.success){let S=b.error instanceof Error?b.error.message:String(b.error);throw new fe(xe.InvalidParams,`Invalid task creation result: ${S}`)}return b.data}let h=zo(MC,m);if(!h.success){let b=h.error instanceof Error?h.error.message:String(h.error);throw new fe(xe.InvalidParams,`Invalid elicitation result: ${b}`)}let g=h.data,v=d.mode==="form"?d.requestedSchema:void 0;if(d.mode==="form"&&g.action==="accept"&&g.content&&v&&this._capabilities.elicitation?.form?.applyDefaults)try{lx(v,g.content)}catch{}return g};return super.setRequestHandler(e,a)}if(s==="sampling/createMessage"){let a=async(c,l)=>{let u=zo(NC,c);if(!u.success){let m=u.error instanceof Error?u.error.message:String(u.error);throw new fe(xe.InvalidParams,`Invalid sampling request: ${m}`)}let{params:d}=u.data,p=await Promise.resolve(r(c,l));if(d.task){let m=zo(tc,p);if(!m.success){let h=m.error instanceof Error?m.error.message:String(m.error);throw new fe(xe.InvalidParams,`Invalid task creation result: ${h}`)}return m.data}let f=zo(RC,p);if(!f.success){let m=f.error instanceof Error?f.error.message:String(f.error);throw new fe(xe.InvalidParams,`Invalid sampling result: ${m}`)}return f.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapability(e,r){if(!this._serverCapabilities?.[e])throw new Error(`Server does not support ${e} (required for ${r})`)}async connect(e,r){if(await super.connect(e),e.sessionId===void 0)try{let n=await this.request({method:"initialize",params:{protocolVersion:ju,capabilities:this._capabilities,clientInfo:this._clientInfo}},bC,r);if(n===void 0)throw new Error(`Server sent invalid initialize result: ${n}`);if(!LB.includes(n.protocolVersion))throw new Error(`Server's protocol version is not supported: ${n.protocolVersion}`);this._serverCapabilities=n.capabilities,this._serverVersion=n.serverInfo,e.setProtocolVersion&&e.setProtocolVersion(n.protocolVersion),this._instructions=n.instructions,await this.notification({method:"notifications/initialized"}),this._pendingListChangedConfig&&(this._setupListChangedHandlers(this._pendingListChangedConfig),this._pendingListChangedConfig=void 0)}catch(n){throw this.close(),n}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){switch(e){case"logging/setLevel":if(!this._serverCapabilities?.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._serverCapabilities?.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!this._serverCapabilities?.resources)throw new Error(`Server does not support resources (required for ${e})`);if(e==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._serverCapabilities?.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!this._serverCapabilities?.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"initialize":break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/roots/list_changed":if(!this._capabilities.roots?.listChanged)throw new Error(`Client does not support roots list changed notifications (required for ${e})`);break;case"notifications/initialized":break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Client does not support tasks capability (required for ${e})`);break;case"ping":break}}assertTaskCapability(e){h5(this._serverCapabilities?.tasks?.requests,e,"Server")}assertTaskHandlerCapability(e){this._capabilities&&g5(this._capabilities.tasks?.requests,e,"Client")}async ping(e){return this.request({method:"ping"},ec,e)}async complete(e,r){return this.request({method:"completion/complete",params:e},DC,r)}async setLoggingLevel(e,r){return this.request({method:"logging/setLevel",params:{level:e}},ec,r)}async getPrompt(e,r){return this.request({method:"prompts/get",params:e},EC,r)}async listPrompts(e,r){return this.request({method:"prompts/list",params:e},$C,r)}async listResources(e,r){return this.request({method:"resources/list",params:e},wC,r)}async listResourceTemplates(e,r){return this.request({method:"resources/templates/list",params:e},xC,r)}async readResource(e,r){return this.request({method:"resources/read",params:e},kC,r)}async subscribeResource(e,r){return this.request({method:"resources/subscribe",params:e},ec,r)}async unsubscribeResource(e,r){return this.request({method:"resources/unsubscribe",params:e},ec,r)}async callTool(e,r=Js,n){if(this.isToolTaskRequired(e.name))throw new fe(xe.InvalidRequest,`Tool "${e.name}" requires task-based execution. Use client.experimental.tasks.callToolStream() instead.`);let o=await this.request({method:"tools/call",params:e},r,n),i=this.getToolOutputValidator(e.name);if(i){if(!o.structuredContent&&!o.isError)throw new fe(xe.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`);if(o.structuredContent)try{let s=i(o.structuredContent);if(!s.valid)throw new fe(xe.InvalidParams,`Structured content does not match the tool's output schema: ${s.errorMessage}`)}catch(s){throw s instanceof fe?s:new fe(xe.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return o}isToolTask(e){return this._serverCapabilities?.tasks?.requests?.tools?.call?this._cachedKnownTaskTools.has(e):!1}isToolTaskRequired(e){return this._cachedRequiredTaskTools.has(e)}cacheToolMetadata(e){this._cachedToolOutputValidators.clear(),this._cachedKnownTaskTools.clear(),this._cachedRequiredTaskTools.clear();for(let r of e){if(r.outputSchema){let o=this._jsonSchemaValidator.getValidator(r.outputSchema);this._cachedToolOutputValidators.set(r.name,o)}let n=r.execution?.taskSupport;(n==="required"||n==="optional")&&this._cachedKnownTaskTools.add(r.name),n==="required"&&this._cachedRequiredTaskTools.add(r.name)}}getToolOutputValidator(e){return this._cachedToolOutputValidators.get(e)}async listTools(e,r){let n=await this.request({method:"tools/list",params:e},Em,r);return this.cacheToolMetadata(n.tools),n}_setupListChangedHandler(e,r,n,o){let i=nU.safeParse(n);if(!i.success)throw new Error(`Invalid ${e} listChanged options: ${i.error.message}`);if(typeof n.onChanged!="function")throw new Error(`Invalid ${e} listChanged options: onChanged must be a function`);let{autoRefresh:s,debounceMs:a}=i.data,{onChanged:c}=n,l=async()=>{if(!s){c(null,null);return}try{let d=await o();c(null,d)}catch(d){let p=d instanceof Error?d:new Error(String(d));c(p,null)}},u=()=>{if(a){let d=this._listChangedDebounceTimers.get(e);d&&clearTimeout(d);let p=setTimeout(l,a);this._listChangedDebounceTimers.set(e,p)}else l()};this.setNotificationHandler(r,u)}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}});var S5=y((ATe,x5)=>{x5.exports=w5;w5.sync=ipe;var b5=require("fs");function ope(t,e){var r=e.pathExt!==void 0?e.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var n=0;n<r.length;n++){var o=r[n].toLowerCase();if(o&&t.substr(-o.length).toLowerCase()===o)return!0}return!1}function _5(t,e,r){return!t.isSymbolicLink()&&!t.isFile()?!1:ope(e,r)}function w5(t,e,r){b5.stat(t,function(n,o){r(n,n?!1:_5(o,t,e))})}function ipe(t,e){return _5(b5.statSync(t),t,e)}});var C5=y(($Te,P5)=>{P5.exports=A5;A5.sync=spe;var k5=require("fs");function A5(t,e,r){k5.stat(t,function(n,o){r(n,n?!1:$5(o,e))})}function spe(t,e){return $5(k5.statSync(t),e)}function $5(t,e){return t.isFile()&&ape(t,e)}function ape(t,e){var r=t.mode,n=t.uid,o=t.gid,i=e.uid!==void 0?e.uid:process.getuid&&process.getuid(),s=e.gid!==void 0?e.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),l=parseInt("001",8),u=a|c,d=r&l||r&c&&o===s||r&a&&n===i||r&u&&i===0;return d}});var T5=y((CTe,I5)=>{var PTe=require("fs"),dx;process.platform==="win32"||global.TESTING_WINDOWS?dx=S5():dx=C5();I5.exports=DO;DO.sync=cpe;function DO(t,e,r){if(typeof e=="function"&&(r=e,e={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(n,o){DO(t,e||{},function(i,s){i?o(i):n(s)})})}dx(t,e||{},function(n,o){n&&(n.code==="EACCES"||e&&e.ignoreErrors)&&(n=null,o=!1),r(n,o)})}function cpe(t,e){try{return dx.sync(t,e||{})}catch(r){if(e&&e.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var M5=y((ITe,z5)=>{var dd=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",E5=require("path"),lpe=dd?";":":",O5=T5(),j5=t=>Object.assign(new Error(`not found: ${t}`),{code:"ENOENT"}),N5=(t,e)=>{let r=e.colon||lpe,n=t.match(/\//)||dd&&t.match(/\\/)?[""]:[...dd?[process.cwd()]:[],...(e.path||process.env.PATH||"").split(r)],o=dd?e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",i=dd?o.split(r):[""];return dd&&t.indexOf(".")!==-1&&i[0]!==""&&i.unshift(""),{pathEnv:n,pathExt:i,pathExtExe:o}},R5=(t,e,r)=>{typeof e=="function"&&(r=e,e={}),e||(e={});let{pathEnv:n,pathExt:o,pathExtExe:i}=N5(t,e),s=[],a=l=>new Promise((u,d)=>{if(l===n.length)return e.all&&s.length?u(s):d(j5(t));let p=n[l],f=/^".*"$/.test(p)?p.slice(1,-1):p,m=E5.join(f,t),h=!f&&/^\.[\\\/]/.test(t)?t.slice(0,2)+m:m;u(c(h,l,0))}),c=(l,u,d)=>new Promise((p,f)=>{if(d===o.length)return p(a(u+1));let m=o[d];O5(l+m,{pathExt:i},(h,g)=>{if(!h&&g)if(e.all)s.push(l+m);else return p(l+m);return p(c(l,u,d+1))})});return r?a(0).then(l=>r(null,l),r):a(0)},upe=(t,e)=>{e=e||{};let{pathEnv:r,pathExt:n,pathExtExe:o}=N5(t,e),i=[];for(let s=0;s<r.length;s++){let a=r[s],c=/^".*"$/.test(a)?a.slice(1,-1):a,l=E5.join(c,t),u=!c&&/^\.[\\\/]/.test(t)?t.slice(0,2)+l:l;for(let d=0;d<n.length;d++){let p=u+n[d];try{if(O5.sync(p,{pathExt:o}))if(e.all)i.push(p);else return p}catch{}}}if(e.all&&i.length)return i;if(e.nothrow)return null;throw j5(t)};z5.exports=R5;R5.sync=upe});var q5=y((TTe,qO)=>{"use strict";var D5=(t={})=>{let e=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(e).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};qO.exports=D5;qO.exports.default=D5});var F5=y((ETe,L5)=>{"use strict";var B5=require("path"),dpe=M5(),ppe=q5();function U5(t,e){let r=t.options.env||process.env,n=process.cwd(),o=t.options.cwd!=null,i=o&&process.chdir!==void 0&&!process.chdir.disabled;if(i)try{process.chdir(t.options.cwd)}catch{}let s;try{s=dpe.sync(t.command,{path:r[ppe({env:r})],pathExt:e?B5.delimiter:void 0})}catch{}finally{i&&process.chdir(n)}return s&&(s=B5.resolve(o?t.options.cwd:"",s)),s}function fpe(t){return U5(t)||U5(t,!0)}L5.exports=fpe});var V5=y((OTe,UO)=>{"use strict";var BO=/([()\][%!^"`<>&|;, *?])/g;function mpe(t){return t=t.replace(BO,"^$1"),t}function hpe(t,e){return t=`${t}`,t=t.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),t=t.replace(/(?=(\\+?)?)\1$/,"$1$1"),t=`"${t}"`,t=t.replace(BO,"^$1"),e&&(t=t.replace(BO,"^$1")),t}UO.exports.command=mpe;UO.exports.argument=hpe});var G5=y((jTe,H5)=>{"use strict";H5.exports=/^#!(.*)/});var Z5=y((NTe,W5)=>{"use strict";var gpe=G5();W5.exports=(t="")=>{let e=t.match(gpe);if(!e)return null;let[r,n]=e[0].replace(/#! ?/,"").split(" "),o=r.split("/").pop();return o==="env"?n:n?`${o} ${n}`:o}});var J5=y((RTe,K5)=>{"use strict";var LO=require("fs"),ype=Z5();function vpe(t){let r=Buffer.alloc(150),n;try{n=LO.openSync(t,"r"),LO.readSync(n,r,0,150,0),LO.closeSync(n)}catch{}return ype(r.toString())}K5.exports=vpe});var eH=y((zTe,X5)=>{"use strict";var bpe=require("path"),Y5=F5(),Q5=V5(),_pe=J5(),wpe=process.platform==="win32",xpe=/\.(?:com|exe)$/i,Spe=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function kpe(t){t.file=Y5(t);let e=t.file&&_pe(t.file);return e?(t.args.unshift(t.file),t.command=e,Y5(t)):t.file}function Ape(t){if(!wpe)return t;let e=kpe(t),r=!xpe.test(e);if(t.options.forceShell||r){let n=Spe.test(e);t.command=bpe.normalize(t.command),t.command=Q5.command(t.command),t.args=t.args.map(i=>Q5.argument(i,n));let o=[t.command].concat(t.args).join(" ");t.args=["/d","/s","/c",`"${o}"`],t.command=process.env.comspec||"cmd.exe",t.options.windowsVerbatimArguments=!0}return t}function $pe(t,e,r){e&&!Array.isArray(e)&&(r=e,e=null),e=e?e.slice(0):[],r=Object.assign({},r);let n={command:t,args:e,options:r,file:void 0,original:{command:t,args:e}};return r.shell?n:Ape(n)}X5.exports=$pe});var nH=y((MTe,rH)=>{"use strict";var FO=process.platform==="win32";function VO(t,e){return Object.assign(new Error(`${e} ${t.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${e} ${t.command}`,path:t.command,spawnargs:t.args})}function Ppe(t,e){if(!FO)return;let r=t.emit;t.emit=function(n,o){if(n==="exit"){let i=tH(o,e);if(i)return r.call(t,"error",i)}return r.apply(t,arguments)}}function tH(t,e){return FO&&t===1&&!e.file?VO(e.original,"spawn"):null}function Cpe(t,e){return FO&&t===1&&!e.file?VO(e.original,"spawnSync"):null}rH.exports={hookChildProcess:Ppe,verifyENOENT:tH,verifyENOENTSync:Cpe,notFoundError:VO}});var sH=y((DTe,pd)=>{"use strict";var oH=require("child_process"),HO=eH(),GO=nH();function iH(t,e,r){let n=HO(t,e,r),o=oH.spawn(n.command,n.args,n.options);return GO.hookChildProcess(o,n),o}function Ipe(t,e,r){let n=HO(t,e,r),o=oH.spawnSync(n.command,n.args,n.options);return o.error=o.error||GO.verifyENOENTSync(o.status,n),o}pd.exports=iH;pd.exports.spawn=iH;pd.exports.sync=Ipe;pd.exports._parse=HO;pd.exports._enoent=GO});function Tpe(t){return E_.parse(JSON.parse(t))}function aH(t){return JSON.stringify(t)+`
`}var px,cH=x(()=>{Ys();px=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),Tpe(r)}clear(){this._buffer=void 0}}});function Ope(){let t={};for(let e of Epe){let r=zh.default.env[e];r!==void 0&&(r.startsWith("()")||(t[e]=r))}return t}function jpe(){return"type"in zh.default}var lH,zh,uH,Epe,fx,dH=x(()=>{lH=ct(sH(),1),zh=ct(require("node:process"),1),uH=require("node:stream");cH();Epe=zh.default.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];fx=class{constructor(e){this._readBuffer=new px,this._stderrStream=null,this._serverParams=e,(e.stderr==="pipe"||e.stderr==="overlapped")&&(this._stderrStream=new uH.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,r)=>{this._process=(0,lH.default)(this._serverParams.command,this._serverParams.args??[],{env:{...Ope(),...this._serverParams.env},stdio:["pipe","pipe",this._serverParams.stderr??"inherit"],shell:!1,windowsHide:zh.default.platform==="win32"&&jpe(),cwd:this._serverParams.cwd}),this._process.on("error",n=>{r(n),this.onerror?.(n)}),this._process.on("spawn",()=>{e()}),this._process.on("close",n=>{this._process=void 0,this.onclose?.()}),this._process.stdin?.on("error",n=>{this.onerror?.(n)}),this._process.stdout?.on("data",n=>{this._readBuffer.append(n),this.processReadBuffer()}),this._process.stdout?.on("error",n=>{this.onerror?.(n)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){return this._stderrStream?this._stderrStream:this._process?.stderr??null}get pid(){return this._process?.pid??null}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){if(this._process){let e=this._process;this._process=void 0;let r=new Promise(n=>{e.once("close",()=>{n()})});try{e.stdin?.end()}catch{}if(await Promise.race([r,new Promise(n=>setTimeout(n,2e3).unref())]),e.exitCode===null){try{e.kill("SIGTERM")}catch{}await Promise.race([r,new Promise(n=>setTimeout(n,2e3).unref())])}if(e.exitCode===null)try{e.kill("SIGKILL")}catch{}}this._readBuffer.clear()}send(e){return new Promise(r=>{if(!this._process?.stdin)throw new Error("Not connected");let n=aH(e);this._process.stdin.write(n)?r():this._process.stdin.once("drain",r)})}}});function WO(t){}function pH(t){if(typeof t=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=WO,onError:r=WO,onRetry:n=WO,onComment:o}=t,i="",s=!0,a,c="",l="";function u(h){let g=s?h.replace(/^\xEF\xBB\xBF/,""):h,[v,b]=Npe(`${i}${g}`);for(let S of v)d(S);i=b,s=!1}function d(h){if(h===""){f();return}if(h.startsWith(":")){o&&o(h.slice(h.startsWith(": ")?2:1));return}let g=h.indexOf(":");if(g!==-1){let v=h.slice(0,g),b=h[g+1]===" "?2:1,S=h.slice(g+b);p(v,S,h);return}p(h,"",h)}function p(h,g,v){switch(h){case"event":l=g;break;case"data":c=`${c}${g}
`;break;case"id":a=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?n(parseInt(g,10)):r(new mx(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:v}));break;default:r(new mx(`Unknown field "${h.length>20?`${h.slice(0,20)}\u2026`:h}"`,{type:"unknown-field",field:h,value:g,line:v}));break}}function f(){c.length>0&&e({id:a,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),a=void 0,c="",l=""}function m(h={}){i&&h.consume&&d(i),s=!0,a=void 0,c="",l="",i=""}return{feed:u,reset:m}}function Npe(t){let e=[],r="",n=0;for(;n<t.length;){let o=t.indexOf("\r",n),i=t.indexOf(`
`,n),s=-1;if(o!==-1&&i!==-1?s=Math.min(o,i):o!==-1?o===t.length-1?s=-1:s=o:i!==-1&&(s=i),s===-1){r=t.slice(n);break}else{let a=t.slice(n,s);e.push(a),n=s+1,t[n-1]==="\r"&&t[n]===`
`&&n++}}return[e,r]}var mx,fH=x(()=>{mx=class extends Error{constructor(e,r){super(e),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}});function Rpe(t){let e=globalThis.DOMException;return typeof e=="function"?new e(t,"SyntaxError"):new SyntaxError(t)}function ZO(t){return t instanceof Error?"errors"in t&&Array.isArray(t.errors)?t.errors.map(ZO).join(", "):"cause"in t&&t.cause instanceof Error?`${t}: ${ZO(t.cause)}`:t.message:`${t}`}function mH(t){return{type:t.type,message:t.message,code:t.code,defaultPrevented:t.defaultPrevented,cancelable:t.cancelable,timeStamp:t.timeStamp}}function zpe(){let t="document"in globalThis?globalThis.document:void 0;return t&&typeof t=="object"&&"baseURI"in t&&typeof t.baseURI=="string"?t.baseURI:void 0}var gx,gH,rj,Ve,br,Ht,us,Pn,xc,fd,hx,yx,qh,gd,Bh,ha,md,yd,hd,Mh,Go,KO,JO,YO,hH,QO,XO,Dh,ej,tj,Sc,yH=x(()=>{fH();gx=class extends Event{constructor(e,r){var n,o;super(e),this.code=(n=r?.code)!=null?n:void 0,this.message=(o=r?.message)!=null?o:void 0}[Symbol.for("nodejs.util.inspect.custom")](e,r,n){return n(mH(this),r)}[Symbol.for("Deno.customInspect")](e,r){return e(mH(this),r)}};gH=t=>{throw TypeError(t)},rj=(t,e,r)=>e.has(t)||gH("Cannot "+r),Ve=(t,e,r)=>(rj(t,e,"read from private field"),r?r.call(t):e.get(t)),br=(t,e,r)=>e.has(t)?gH("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Ht=(t,e,r,n)=>(rj(t,e,"write to private field"),e.set(t,r),r),us=(t,e,r)=>(rj(t,e,"access private method"),r),Sc=class extends EventTarget{constructor(e,r){var n,o;super(),br(this,Go),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,br(this,Pn),br(this,xc),br(this,fd),br(this,hx),br(this,yx),br(this,qh),br(this,gd),br(this,Bh,null),br(this,ha),br(this,md),br(this,yd,null),br(this,hd,null),br(this,Mh,null),br(this,JO,async i=>{var s;Ve(this,md).reset();let{body:a,redirected:c,status:l,headers:u}=i;if(l===204){us(this,Go,Dh).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(c?Ht(this,fd,new URL(i.url)):Ht(this,fd,void 0),l!==200){us(this,Go,Dh).call(this,`Non-200 status code (${l})`,l);return}if(!(u.get("content-type")||"").startsWith("text/event-stream")){us(this,Go,Dh).call(this,'Invalid content type, expected "text/event-stream"',l);return}if(Ve(this,Pn)===this.CLOSED)return;Ht(this,Pn,this.OPEN);let d=new Event("open");if((s=Ve(this,Mh))==null||s.call(this,d),this.dispatchEvent(d),typeof a!="object"||!a||!("getReader"in a)){us(this,Go,Dh).call(this,"Invalid response body, expected a web ReadableStream",l),this.close();return}let p=new TextDecoder,f=a.getReader(),m=!0;do{let{done:h,value:g}=await f.read();g&&Ve(this,md).feed(p.decode(g,{stream:!h})),h&&(m=!1,Ve(this,md).reset(),us(this,Go,ej).call(this))}while(m)}),br(this,YO,i=>{Ht(this,ha,void 0),!(i.name==="AbortError"||i.type==="aborted")&&us(this,Go,ej).call(this,ZO(i))}),br(this,QO,i=>{typeof i.id=="string"&&Ht(this,Bh,i.id);let s=new MessageEvent(i.event||"message",{data:i.data,origin:Ve(this,fd)?Ve(this,fd).origin:Ve(this,xc).origin,lastEventId:i.id||""});Ve(this,hd)&&(!i.event||i.event==="message")&&Ve(this,hd).call(this,s),this.dispatchEvent(s)}),br(this,XO,i=>{Ht(this,qh,i)}),br(this,tj,()=>{Ht(this,gd,void 0),Ve(this,Pn)===this.CONNECTING&&us(this,Go,KO).call(this)});try{if(e instanceof URL)Ht(this,xc,e);else if(typeof e=="string")Ht(this,xc,new URL(e,zpe()));else throw new Error("Invalid URL")}catch{throw Rpe("An invalid or illegal string was specified")}Ht(this,md,pH({onEvent:Ve(this,QO),onRetry:Ve(this,XO)})),Ht(this,Pn,this.CONNECTING),Ht(this,qh,3e3),Ht(this,yx,(n=r?.fetch)!=null?n:globalThis.fetch),Ht(this,hx,(o=r?.withCredentials)!=null?o:!1),us(this,Go,KO).call(this)}get readyState(){return Ve(this,Pn)}get url(){return Ve(this,xc).href}get withCredentials(){return Ve(this,hx)}get onerror(){return Ve(this,yd)}set onerror(e){Ht(this,yd,e)}get onmessage(){return Ve(this,hd)}set onmessage(e){Ht(this,hd,e)}get onopen(){return Ve(this,Mh)}set onopen(e){Ht(this,Mh,e)}addEventListener(e,r,n){let o=r;super.addEventListener(e,o,n)}removeEventListener(e,r,n){let o=r;super.removeEventListener(e,o,n)}close(){Ve(this,gd)&&clearTimeout(Ve(this,gd)),Ve(this,Pn)!==this.CLOSED&&(Ve(this,ha)&&Ve(this,ha).abort(),Ht(this,Pn,this.CLOSED),Ht(this,ha,void 0))}};Pn=new WeakMap,xc=new WeakMap,fd=new WeakMap,hx=new WeakMap,yx=new WeakMap,qh=new WeakMap,gd=new WeakMap,Bh=new WeakMap,ha=new WeakMap,md=new WeakMap,yd=new WeakMap,hd=new WeakMap,Mh=new WeakMap,Go=new WeakSet,KO=function(){Ht(this,Pn,this.CONNECTING),Ht(this,ha,new AbortController),Ve(this,yx)(Ve(this,xc),us(this,Go,hH).call(this)).then(Ve(this,JO)).catch(Ve(this,YO))},JO=new WeakMap,YO=new WeakMap,hH=function(){var t;let e={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...Ve(this,Bh)?{"Last-Event-ID":Ve(this,Bh)}:void 0},cache:"no-store",signal:(t=Ve(this,ha))==null?void 0:t.signal};return"window"in globalThis&&(e.credentials=this.withCredentials?"include":"same-origin"),e},QO=new WeakMap,XO=new WeakMap,Dh=function(t,e){var r;Ve(this,Pn)!==this.CLOSED&&Ht(this,Pn,this.CLOSED);let n=new gx("error",{code:e,message:t});(r=Ve(this,yd))==null||r.call(this,n),this.dispatchEvent(n)},ej=function(t,e){var r;if(Ve(this,Pn)===this.CLOSED)return;Ht(this,Pn,this.CONNECTING);let n=new gx("error",{code:e,message:t});(r=Ve(this,yd))==null||r.call(this,n),this.dispatchEvent(n),Ht(this,gd,setTimeout(Ve(this,tj),Ve(this,qh)))},tj=new WeakMap,Sc.CONNECTING=0,Sc.OPEN=1,Sc.CLOSED=2});function vx(t){return t?t instanceof Headers?Object.fromEntries(t.entries()):Array.isArray(t)?Object.fromEntries(t):{...t}:{}}function vH(t=fetch,e){return e?async(r,n)=>{let o={...e,...n,headers:n?.headers?{...vx(e.headers),...vx(n.headers)}:e.headers};return t(r,o)}:t}var bH=x(()=>{});async function Mpe(t){return(await nj).getRandomValues(new Uint8Array(t))}async function Dpe(t){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~",r=Math.pow(2,8)-Math.pow(2,8)%e.length,n="";for(;n.length<t;){let o=await Mpe(t-n.length);for(let i of o)i<r&&(n+=e[i%e.length])}return n}async function qpe(t){return await Dpe(t)}async function Bpe(t){let e=await(await nj).subtle.digest("SHA-256",new TextEncoder().encode(t));return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function oj(t){if(t||(t=43),t<43||t>128)throw`Expected a length between 43 and 128. Received ${t}.`;let e=await qpe(t),r=await Bpe(e);return{code_verifier:e,code_challenge:r}}var nj,_H=x(()=>{nj=globalThis.crypto?.webcrypto??globalThis.crypto??import("node:crypto").then(t=>t.webcrypto)});var qr,xH,ij,Upe,SH,kH,AH,wH,Lpe,Fpe,$H,ZTe,KTe,sj=x(()=>{fC();qr=BP().superRefine((t,e)=>{if(!URL.canParse(t))return e.addIssue({code:MB.custom,message:"URL must be parseable",fatal:!0}),wb}).refine(t=>{let e=new URL(t);return e.protocol!=="javascript:"&&e.protocol!=="data:"&&e.protocol!=="vbscript:"},{message:"URL cannot use javascript:, data:, or vbscript: scheme"}),xH=pr({resource:_().url(),authorization_servers:V(qr).optional(),jwks_uri:_().url().optional(),scopes_supported:V(_()).optional(),bearer_methods_supported:V(_()).optional(),resource_signing_alg_values_supported:V(_()).optional(),resource_name:_().optional(),resource_documentation:_().optional(),resource_policy_uri:_().url().optional(),resource_tos_uri:_().url().optional(),tls_client_certificate_bound_access_tokens:pt().optional(),authorization_details_types_supported:V(_()).optional(),dpop_signing_alg_values_supported:V(_()).optional(),dpop_bound_access_tokens_required:pt().optional()}),ij=pr({issuer:_(),authorization_endpoint:qr,token_endpoint:qr,registration_endpoint:qr.optional(),scopes_supported:V(_()).optional(),response_types_supported:V(_()),response_modes_supported:V(_()).optional(),grant_types_supported:V(_()).optional(),token_endpoint_auth_methods_supported:V(_()).optional(),token_endpoint_auth_signing_alg_values_supported:V(_()).optional(),service_documentation:qr.optional(),revocation_endpoint:qr.optional(),revocation_endpoint_auth_methods_supported:V(_()).optional(),revocation_endpoint_auth_signing_alg_values_supported:V(_()).optional(),introspection_endpoint:_().optional(),introspection_endpoint_auth_methods_supported:V(_()).optional(),introspection_endpoint_auth_signing_alg_values_supported:V(_()).optional(),code_challenge_methods_supported:V(_()).optional(),client_id_metadata_document_supported:pt().optional()}),Upe=pr({issuer:_(),authorization_endpoint:qr,token_endpoint:qr,userinfo_endpoint:qr.optional(),jwks_uri:qr,registration_endpoint:qr.optional(),scopes_supported:V(_()).optional(),response_types_supported:V(_()),response_modes_supported:V(_()).optional(),grant_types_supported:V(_()).optional(),acr_values_supported:V(_()).optional(),subject_types_supported:V(_()),id_token_signing_alg_values_supported:V(_()),id_token_encryption_alg_values_supported:V(_()).optional(),id_token_encryption_enc_values_supported:V(_()).optional(),userinfo_signing_alg_values_supported:V(_()).optional(),userinfo_encryption_alg_values_supported:V(_()).optional(),userinfo_encryption_enc_values_supported:V(_()).optional(),request_object_signing_alg_values_supported:V(_()).optional(),request_object_encryption_alg_values_supported:V(_()).optional(),request_object_encryption_enc_values_supported:V(_()).optional(),token_endpoint_auth_methods_supported:V(_()).optional(),token_endpoint_auth_signing_alg_values_supported:V(_()).optional(),display_values_supported:V(_()).optional(),claim_types_supported:V(_()).optional(),claims_supported:V(_()).optional(),service_documentation:_().optional(),claims_locales_supported:V(_()).optional(),ui_locales_supported:V(_()).optional(),claims_parameter_supported:pt().optional(),request_parameter_supported:pt().optional(),request_uri_parameter_supported:pt().optional(),require_request_uri_registration:pt().optional(),op_policy_uri:qr.optional(),op_tos_uri:qr.optional(),client_id_metadata_document_supported:pt().optional()}),SH=G({...Upe.shape,...ij.pick({code_challenge_methods_supported:!0}).shape}),kH=G({access_token:_(),id_token:_().optional(),token_type:_(),expires_in:P_.number().optional(),scope:_().optional(),refresh_token:_().optional()}).strip(),AH=G({error:_(),error_description:_().optional(),error_uri:_().optional()}),wH=qr.optional().or(oe("").transform(()=>{})),Lpe=G({redirect_uris:V(qr),token_endpoint_auth_method:_().optional(),grant_types:V(_()).optional(),response_types:V(_()).optional(),client_name:_().optional(),client_uri:qr.optional(),logo_uri:wH,scope:_().optional(),contacts:V(_()).optional(),tos_uri:wH,policy_uri:_().optional(),jwks_uri:qr.optional(),jwks:nC().optional(),software_id:_().optional(),software_version:_().optional(),software_statement:_().optional()}).strip(),Fpe=G({client_id:_(),client_secret:_().optional(),client_id_issued_at:Qe().optional(),client_secret_expires_at:Qe().optional()}).strip(),$H=Lpe.merge(Fpe),ZTe=G({error:_(),error_description:_().optional()}).strip(),KTe=G({token:_(),token_type_hint:_().optional()}).strip()});function PH(t){let e=typeof t=="string"?new URL(t):new URL(t.href);return e.hash="",e}function CH({requestedResource:t,configuredResource:e}){let r=typeof t=="string"?new URL(t):new URL(t.href),n=typeof e=="string"?new URL(e):new URL(e.href);if(r.origin!==n.origin||r.pathname.length<n.pathname.length)return!1;let o=r.pathname.endsWith("/")?r.pathname:r.pathname+"/",i=n.pathname.endsWith("/")?n.pathname:n.pathname+"/";return o.startsWith(i)}var IH=x(()=>{});var ar,Uh,kc,Ac,$c,Lh,Fh,Vh,ds,Hh,Gh,Wh,Zh,Kh,Jh,Pc,Yh,Qh,TH,EH=x(()=>{ar=class extends Error{constructor(e,r){super(e),this.errorUri=r,this.name=this.constructor.name}toResponseObject(){let e={error:this.errorCode,error_description:this.message};return this.errorUri&&(e.error_uri=this.errorUri),e}get errorCode(){return this.constructor.errorCode}},Uh=class extends ar{};Uh.errorCode="invalid_request";kc=class extends ar{};kc.errorCode="invalid_client";Ac=class extends ar{};Ac.errorCode="invalid_grant";$c=class extends ar{};$c.errorCode="unauthorized_client";Lh=class extends ar{};Lh.errorCode="unsupported_grant_type";Fh=class extends ar{};Fh.errorCode="invalid_scope";Vh=class extends ar{};Vh.errorCode="access_denied";ds=class extends ar{};ds.errorCode="server_error";Hh=class extends ar{};Hh.errorCode="temporarily_unavailable";Gh=class extends ar{};Gh.errorCode="unsupported_response_type";Wh=class extends ar{};Wh.errorCode="unsupported_token_type";Zh=class extends ar{};Zh.errorCode="invalid_token";Kh=class extends ar{};Kh.errorCode="method_not_allowed";Jh=class extends ar{};Jh.errorCode="too_many_requests";Pc=class extends ar{};Pc.errorCode="invalid_client_metadata";Yh=class extends ar{};Yh.errorCode="insufficient_scope";Qh=class extends ar{};Qh.errorCode="invalid_target";TH={[Uh.errorCode]:Uh,[kc.errorCode]:kc,[Ac.errorCode]:Ac,[$c.errorCode]:$c,[Lh.errorCode]:Lh,[Fh.errorCode]:Fh,[Vh.errorCode]:Vh,[ds.errorCode]:ds,[Hh.errorCode]:Hh,[Gh.errorCode]:Gh,[Wh.errorCode]:Wh,[Zh.errorCode]:Zh,[Kh.errorCode]:Kh,[Jh.errorCode]:Jh,[Pc.errorCode]:Pc,[Yh.errorCode]:Yh,[Qh.errorCode]:Qh}});function Vpe(t){return["client_secret_basic","client_secret_post","none"].includes(t)}function Hpe(t,e){let r=t.client_secret!==void 0;return e.length===0?r?"client_secret_post":"none":"token_endpoint_auth_method"in t&&t.token_endpoint_auth_method&&Vpe(t.token_endpoint_auth_method)&&e.includes(t.token_endpoint_auth_method)?t.token_endpoint_auth_method:r&&e.includes("client_secret_basic")?"client_secret_basic":r&&e.includes("client_secret_post")?"client_secret_post":e.includes("none")?"none":r?"client_secret_post":"none"}function Gpe(t,e,r,n){let{client_id:o,client_secret:i}=e;switch(t){case"client_secret_basic":Wpe(o,i,r);return;case"client_secret_post":Zpe(o,i,n);return;case"none":Kpe(o,n);return;default:throw new Error(`Unsupported client authentication method: ${t}`)}}function Wpe(t,e,r){if(!e)throw new Error("client_secret_basic authentication requires a client_secret");let n=btoa(`${t}:${e}`);r.set("Authorization",`Basic ${n}`)}function Zpe(t,e,r){r.set("client_id",t),e&&r.set("client_secret",e)}function Kpe(t,e){e.set("client_id",t)}async function jH(t){let e=t instanceof Response?t.status:void 0,r=t instanceof Response?await t.text():t;try{let n=AH.parse(JSON.parse(r)),{error:o,error_description:i,error_uri:s}=n,a=TH[o]||ds;return new a(i||"",s)}catch(n){let o=`${e?`HTTP ${e}: `:""}Invalid OAuth error response: ${n}. Raw body: ${r}`;return new ds(o)}}async function bx(t,e){try{return await lj(t,e)}catch(r){if(r instanceof kc||r instanceof $c)return await t.invalidateCredentials?.("all"),await lj(t,e);if(r instanceof Ac)return await t.invalidateCredentials?.("tokens"),await lj(t,e);throw r}}async function lj(t,{serverUrl:e,authorizationCode:r,scope:n,resourceMetadataUrl:o,fetchFn:i}){let s,a;try{s=await Qpe(e,{resourceMetadataUrl:o},i),s.authorization_servers&&s.authorization_servers.length>0&&(a=s.authorization_servers[0])}catch{}a||(a=new URL("/",e));let c=await Ype(e,t,s),l=await nfe(a,{fetchFn:i}),u=await Promise.resolve(t.clientInformation());if(!u){if(r!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");let g=l?.client_id_metadata_document_supported===!0,v=t.clientMetadataUrl;if(v&&!Jpe(v))throw new Pc(`clientMetadataUrl must be a valid HTTPS URL with a non-root pathname, got: ${v}`);if(g&&v)u={client_id:v},await t.saveClientInformation?.(u);else{if(!t.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");let S=await cfe(a,{metadata:l,clientMetadata:t.clientMetadata,fetchFn:i});await t.saveClientInformation(S),u=S}}let d=!t.redirectUrl;if(r!==void 0||d){let g=await afe(t,a,{metadata:l,resource:c,authorizationCode:r,fetchFn:i});return await t.saveTokens(g),"AUTHORIZED"}let p=await t.tokens();if(p?.refresh_token)try{let g=await sfe(a,{metadata:l,clientInformation:u,refreshToken:p.refresh_token,resource:c,addClientAuthentication:t.addClientAuthentication,fetchFn:i});return await t.saveTokens(g),"AUTHORIZED"}catch(g){if(!(!(g instanceof ar)||g instanceof ds))throw g}let f=t.state?await t.state():void 0,{authorizationUrl:m,codeVerifier:h}=await ofe(a,{metadata:l,clientInformation:u,state:f,redirectUrl:t.redirectUrl,scope:n||s?.scopes_supported?.join(" ")||t.clientMetadata.scope,resource:c});return await t.saveCodeVerifier(h),await t.redirectToAuthorization(m),"REDIRECT"}function Jpe(t){if(!t)return!1;try{let e=new URL(t);return e.protocol==="https:"&&e.pathname!=="/"}catch{return!1}}async function Ype(t,e,r){let n=PH(t);if(e.validateResourceURL)return await e.validateResourceURL(n,r?.resource);if(r){if(!CH({requestedResource:n,configuredResource:r.resource}))throw new Error(`Protected resource ${r.resource} does not match expected ${n} (or origin)`);return new URL(r.resource)}}function dj(t){let e=t.headers.get("WWW-Authenticate");if(!e)return{};let[r,n]=e.split(" ");if(r.toLowerCase()!=="bearer"||!n)return{};let o=uj(t,"resource_metadata")||void 0,i;if(o)try{i=new URL(o)}catch{}let s=uj(t,"scope")||void 0,a=uj(t,"error")||void 0;return{resourceMetadataUrl:i,scope:s,error:a}}function uj(t,e){let r=t.headers.get("WWW-Authenticate");if(!r)return null;let n=new RegExp(`${e}=(?:"([^"]+)"|([^\\s,]+))`),o=r.match(n);return o?o[1]||o[2]:null}async function Qpe(t,e,r=fetch){let n=await tfe(t,"oauth-protected-resource",r,{protocolVersion:e?.protocolVersion,metadataUrl:e?.resourceMetadataUrl});if(!n||n.status===404)throw await n?.body?.cancel(),new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!n.ok)throw await n.body?.cancel(),new Error(`HTTP ${n.status} trying to load well-known OAuth protected resource metadata.`);return xH.parse(await n.json())}async function pj(t,e,r=fetch){try{return await r(t,{headers:e})}catch(n){if(n instanceof TypeError)return e?pj(t,void 0,r):void 0;throw n}}function Xpe(t,e="",r={}){return e.endsWith("/")&&(e=e.slice(0,-1)),r.prependPathname?`${e}/.well-known/${t}`:`/.well-known/${t}${e}`}async function OH(t,e,r=fetch){return await pj(t,{"MCP-Protocol-Version":e},r)}function efe(t,e){return!t||t.status>=400&&t.status<500&&e!=="/"}async function tfe(t,e,r,n){let o=new URL(t),i=n?.protocolVersion??ju,s;if(n?.metadataUrl)s=new URL(n.metadataUrl);else{let c=Xpe(e,o.pathname);s=new URL(c,n?.metadataServerUrl??o),s.search=o.search}let a=await OH(s,i,r);if(!n?.metadataUrl&&efe(a,o.pathname)){let c=new URL(`/.well-known/${e}`,o);a=await OH(c,i,r)}return a}function rfe(t){let e=typeof t=="string"?new URL(t):t,r=e.pathname!=="/",n=[];if(!r)return n.push({url:new URL("/.well-known/oauth-authorization-server",e.origin),type:"oauth"}),n.push({url:new URL("/.well-known/openid-configuration",e.origin),type:"oidc"}),n;let o=e.pathname;return o.endsWith("/")&&(o=o.slice(0,-1)),n.push({url:new URL(`/.well-known/oauth-authorization-server${o}`,e.origin),type:"oauth"}),n.push({url:new URL(`/.well-known/openid-configuration${o}`,e.origin),type:"oidc"}),n.push({url:new URL(`${o}/.well-known/openid-configuration`,e.origin),type:"oidc"}),n}async function nfe(t,{fetchFn:e=fetch,protocolVersion:r=ju}={}){let n={"MCP-Protocol-Version":r,Accept:"application/json"},o=rfe(t);for(let{url:i,type:s}of o){let a=await pj(i,n,e);if(a){if(!a.ok){if(await a.body?.cancel(),a.status>=400&&a.status<500)continue;throw new Error(`HTTP ${a.status} trying to load ${s==="oauth"?"OAuth":"OpenID provider"} metadata from ${i}`)}return s==="oauth"?ij.parse(await a.json()):SH.parse(await a.json())}}}async function ofe(t,{metadata:e,clientInformation:r,redirectUrl:n,scope:o,state:i,resource:s}){let a;if(e){if(a=new URL(e.authorization_endpoint),!e.response_types_supported.includes(aj))throw new Error(`Incompatible auth server: does not support response type ${aj}`);if(e.code_challenge_methods_supported&&!e.code_challenge_methods_supported.includes(cj))throw new Error(`Incompatible auth server: does not support code challenge method ${cj}`)}else a=new URL("/authorize",t);let c=await oj(),l=c.code_verifier,u=c.code_challenge;return a.searchParams.set("response_type",aj),a.searchParams.set("client_id",r.client_id),a.searchParams.set("code_challenge",u),a.searchParams.set("code_challenge_method",cj),a.searchParams.set("redirect_uri",String(n)),i&&a.searchParams.set("state",i),o&&a.searchParams.set("scope",o),o?.includes("offline_access")&&a.searchParams.append("prompt","consent"),s&&a.searchParams.set("resource",s.href),{authorizationUrl:a,codeVerifier:l}}function ife(t,e,r){return new URLSearchParams({grant_type:"authorization_code",code:t,code_verifier:e,redirect_uri:String(r)})}async function NH(t,{metadata:e,tokenRequestParams:r,clientInformation:n,addClientAuthentication:o,resource:i,fetchFn:s}){let a=e?.token_endpoint?new URL(e.token_endpoint):new URL("/token",t),c=new Headers({"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"});if(i&&r.set("resource",i.href),o)await o(c,r,a,e);else if(n){let u=e?.token_endpoint_auth_methods_supported??[],d=Hpe(n,u);Gpe(d,n,c,r)}let l=await(s??fetch)(a,{method:"POST",headers:c,body:r});if(!l.ok)throw await jH(l);return kH.parse(await l.json())}async function sfe(t,{metadata:e,clientInformation:r,refreshToken:n,resource:o,addClientAuthentication:i,fetchFn:s}){let a=new URLSearchParams({grant_type:"refresh_token",refresh_token:n}),c=await NH(t,{metadata:e,tokenRequestParams:a,clientInformation:r,addClientAuthentication:i,resource:o,fetchFn:s});return{refresh_token:n,...c}}async function afe(t,e,{metadata:r,resource:n,authorizationCode:o,fetchFn:i}={}){let s=t.clientMetadata.scope,a;if(t.prepareTokenRequest&&(a=await t.prepareTokenRequest(s)),!a){if(!o)throw new Error("Either provider.prepareTokenRequest() or authorizationCode is required");if(!t.redirectUrl)throw new Error("redirectUrl is required for authorization_code flow");let l=await t.codeVerifier();a=ife(o,l,t.redirectUrl)}let c=await t.clientInformation();return NH(e,{metadata:r,tokenRequestParams:a,clientInformation:c??void 0,addClientAuthentication:t.addClientAuthentication,resource:n,fetchFn:i})}async function cfe(t,{metadata:e,clientMetadata:r,fetchFn:n}){let o;if(e){if(!e.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");o=new URL(e.registration_endpoint)}else o=new URL("/register",t);let i=await(n??fetch)(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok)throw await jH(i);return $H.parse(await i.json())}var ga,aj,cj,RH=x(()=>{_H();Ys();sj();sj();IH();EH();ga=class extends Error{constructor(e){super(e??"Unauthorized")}};aj="code",cj="S256"});var fj,_x,zH=x(()=>{yH();bH();Ys();RH();fj=class extends Error{constructor(e,r,n){super(`SSE error: ${r}`),this.code=e,this.event=n}},_x=class{constructor(e,r){this._url=e,this._resourceMetadataUrl=void 0,this._scope=void 0,this._eventSourceInit=r?.eventSourceInit,this._requestInit=r?.requestInit,this._authProvider=r?.authProvider,this._fetch=r?.fetch,this._fetchWithInit=vH(r?.fetch,r?.requestInit)}async _authThenStart(){if(!this._authProvider)throw new ga("No auth provider");let e;try{e=await bx(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})}catch(r){throw this.onerror?.(r),r}if(e!=="AUTHORIZED")throw new ga;return await this._startOrAuth()}async _commonHeaders(){let e={};if(this._authProvider){let n=await this._authProvider.tokens();n&&(e.Authorization=`Bearer ${n.access_token}`)}this._protocolVersion&&(e["mcp-protocol-version"]=this._protocolVersion);let r=vx(this._requestInit?.headers);return new Headers({...e,...r})}_startOrAuth(){let e=this?._eventSourceInit?.fetch??this._fetch??fetch;return new Promise((r,n)=>{this._eventSource=new Sc(this._url.href,{...this._eventSourceInit,fetch:async(o,i)=>{let s=await this._commonHeaders();s.set("Accept","text/event-stream");let a=await e(o,{...i,headers:s});if(a.status===401&&a.headers.has("www-authenticate")){let{resourceMetadataUrl:c,scope:l}=dj(a);this._resourceMetadataUrl=c,this._scope=l}return a}}),this._abortController=new AbortController,this._eventSource.onerror=o=>{if(o.code===401&&this._authProvider){this._authThenStart().then(r,n);return}let i=new fj(o.code,o.message,o);n(i),this.onerror?.(i)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",o=>{let i=o;try{if(this._endpoint=new URL(i.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(s){n(s),this.onerror?.(s),this.close();return}r()}),this._eventSource.onmessage=o=>{let i=o,s;try{s=E_.parse(JSON.parse(i.data))}catch(a){this.onerror?.(a);return}this.onmessage?.(s)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(e){if(!this._authProvider)throw new ga("No auth provider");if(await bx(this._authProvider,{serverUrl:this._url,authorizationCode:e,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new ga("Failed to authorize")}async close(){this._abortController?.abort(),this._eventSource?.close(),this.onclose?.()}async send(e){if(!this._endpoint)throw new Error("Not connected");try{let r=await this._commonHeaders();r.set("content-type","application/json");let n={...this._requestInit,method:"POST",headers:r,body:JSON.stringify(e),signal:this._abortController?.signal},o=await(this._fetch??fetch)(this._endpoint,n);if(!o.ok){let i=await o.text().catch(()=>null);if(o.status===401&&this._authProvider){let{resourceMetadataUrl:s,scope:a}=dj(o);if(this._resourceMetadataUrl=s,this._scope=a,await bx(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new ga;return this.send(e)}throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${i}`)}await o.body?.cancel()}catch(r){throw this.onerror?.(r),r}}setProtocolVersion(e){this._protocolVersion=e}}});var At,wx,MH=x(()=>{"use strict";At=ct(require("vscode")),wx=class{constructor(){}getTools(){return[{serverName:"vscode",name:"vscode_read_file",description:"Read the contents of a file in the workspace",inputSchema:{type:"object",properties:{uri:{type:"string",description:"The absolute path or URI of the file to read"}},required:["uri"]}},{serverName:"vscode",name:"vscode_list_files",description:"List files in a directory or search for files matching a pattern",inputSchema:{type:"object",properties:{folder:{type:"string",description:"The absolute path of the folder to list (optional)"},pattern:{type:"string",description:'Glob pattern to search for specific files (e.g. "**/*.ts")'}}}},{serverName:"vscode",name:"vscode_open_file",description:"Open a file in the editor",inputSchema:{type:"object",properties:{uri:{type:"string",description:"The absolute path or URI of the file to open"},range:{type:"array",items:{type:"number"},minItems:2,maxItems:2,description:"Line range to select [startLine, endLine] (0-indexed)"}},required:["uri"]}},{serverName:"vscode",name:"vscode_get_diagnostics",description:"Get validation errors, warnings, and information for files",inputSchema:{type:"object",properties:{max:{type:"number",description:"Maximum number of diagnostics to return (default: 50)"}}}},{serverName:"vscode",name:"vscode_get_active_editor",description:"Get information about the currently active text editor",inputSchema:{type:"object",properties:{}}}]}async callTool(e,r){switch(e){case"vscode_read_file":return this.readFile(r.uri);case"vscode_list_files":return this.listFiles(r.folder,r.pattern);case"vscode_open_file":return this.openFile(r.uri,r.range);case"vscode_get_diagnostics":return this.getDiagnostics(r.max);case"vscode_get_active_editor":return this.getActiveEditor();default:throw new Error(`Unknown tool: ${e}`)}}async readFile(e){let r=At.Uri.file(e),n=await At.workspace.openTextDocument(r);return{content:n.getText(),languageId:n.languageId,lineCount:n.lineCount}}async listFiles(e,r){if(r)return{files:(await At.workspace.findFiles(r,null,50)).map(o=>o.fsPath)};if(e){let n=At.Uri.file(e),o=await At.workspace.fs.readDirectory(n);return{folder:e,entries:o.map(([i,s])=>({name:i,type:s===At.FileType.Directory?"directory":"file"}))}}else return At.workspace.workspaceFolders?{workspaceFolders:At.workspace.workspaceFolders.map(n=>n.uri.fsPath)}:{error:"No workspace folders open"}}async openFile(e,r){let n=At.Uri.file(e),o=await At.workspace.openTextDocument(n),i=await At.window.showTextDocument(o);if(r&&r.length===2){let s=new At.Range(r[0],0,r[1],1e3);i.selection=new At.Selection(s.start,s.end),i.revealRange(s,At.TextEditorRevealType.InCenter)}return{success:!0,opened:e}}async getDiagnostics(e=50){let r=At.languages.getDiagnostics(),n=[],o=0;for(let[i,s]of r){if(s.length===0)continue;let a=s.map(c=>({severity:At.DiagnosticSeverity[c.severity],message:c.message,range:{startLine:c.range.start.line,endLine:c.range.end.line},source:c.source,code:c.code}));if(n.push({file:i.fsPath,diagnostics:a}),o+=a.length,o>=e)break}return{diagnostics:n}}async getActiveEditor(){let e=At.window.activeTextEditor;return e?{active:!0,file:e.document.uri.fsPath,languageId:e.document.languageId,cursor:{line:e.selection.active.line,character:e.selection.active.character},selection:e.document.getText(e.selection)||null,preview:e.document.getText(new At.Range(0,0,Math.min(20,e.document.lineCount),0))+`
...`}:{active:!1,reason:"No editor active"}}}});var qH={};ve(qH,{McpService:()=>mj});var DH,mj,BH=x(()=>{"use strict";DH=ct(require("vscode"));v5();dH();zH();MH();Ys();mj=class{constructor(e){this.output=e;this.vscodeTools=new wx}clients=new Map;cachedTools=[];disposables=[];vscodeTools;async initialize(){await this.refreshServers()}async refreshServers(){for(let o of this.clients.values())await o.close();this.clients.clear();let e=DH.workspace.getConfiguration("githubCopilotApi.mcp");if(!e.get("enabled",!0)){this.output.appendLine("[MCP] Disabled in configuration.");return}let n=e.get("servers",{});for(let[o,i]of Object.entries(n))try{await this.connectToServer(o,i)}catch(s){this.output.appendLine(`[MCP] Failed to connect to server "${o}": ${s}`)}this.cachedTools=await this.getAllTools()}getTools(){return this.cachedTools.length===0?this.vscodeTools.getTools():this.cachedTools}getConnectedServers(){return Array.from(this.clients.keys())}async connectToServer(e,r){let n;if(r.url)n=new _x(new URL(r.url));else if(r.command)n=new fx({command:r.command,args:r.args||[],env:this.getCleanEnv(r.env)});else throw new Error(`Invalid configuration for MCP server "${e}"`);let o=new ux({name:"github-copilot-api-gateway",version:"0.0.1"},{capabilities:{}});await o.connect(n),this.clients.set(e,o),this.output.appendLine(`[MCP] Connected to server "${e}"`)}async getAllTools(){let e=[];for(let[r,n]of this.clients.entries())try{let i=(await n.request({method:"tools/list"},Em)).tools.map(s=>({serverName:r,name:s.name,description:s.description,inputSchema:s.inputSchema}));e.push(...i)}catch(o){this.output.appendLine(`[MCP] Failed to list tools for server "${r}": ${o}`)}return[...e,...this.vscodeTools.getTools()]}async callTool(e,r,n){if(e==="vscode")return this.vscodeTools.callTool(r,n);let o=this.clients.get(e);if(!o)throw new Error(`MCP server "${e}" not found or not connected`);return await o.request({method:"tools/call",params:{name:r,arguments:n}},Js)}getCleanEnv(e){let r={};for(let[n,o]of Object.entries(process.env))o!==void 0&&(r[n]=o);if(e)for(let[n,o]of Object.entries(e))o!==void 0&&(r[n]=o);return r}dispose(){for(let e of this.clients.values())e.close().catch(r=>console.error(`[MCP] Error closing client: ${r}`));this.clients.clear();for(let e of this.disposables)e.dispose()}}});var LH=y(()=>{var UH;(function(t){(function(e){var r=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:a(),n=o(t);typeof r.Reflect<"u"&&(n=o(r.Reflect,n)),e(n,r),typeof r.Reflect>"u"&&(r.Reflect=t);function o(c,l){return function(u,d){Object.defineProperty(c,u,{configurable:!0,writable:!0,value:d}),l&&l(u,d)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return i()||s()}})(function(e,r){var n=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",i=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,u={create:a?function(){return gA(Object.create(null))}:c?function(){return gA({__proto__:null})}:function(){return gA({})},has:l?function(A,$){return n.call(A,$)}:function(A,$){return $ in A},get:l?function(A,$){return n.call(A,$)?A[$]:void 0}:function(A,$){return A[$]}},d=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:$Y(),f=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:PY(),m=typeof WeakMap=="function"?WeakMap:CY(),h=o?Symbol.for("@reflect-metadata:registry"):void 0,g=SY(),v=kY(g);function b(A,$,O,L){if(he(O)){if(!ND(A))throw new TypeError;if(!RD($))throw new TypeError;return nn(A,$)}else{if(!ND(A))throw new TypeError;if(!Zt($))throw new TypeError;if(!Zt(L)&&!he(L)&&!qs(L))throw new TypeError;return qs(L)&&(L=void 0),O=pi(O),Yt(A,$,O,L)}}e("decorate",b);function S(A,$){function O(L,de){if(!Zt(L))throw new TypeError;if(!he(de)&&!wY(de))throw new TypeError;ub(A,$,L,de)}return O}e("metadata",S);function j(A,$,O,L){if(!Zt(O))throw new TypeError;return he(L)||(L=pi(L)),ub(A,$,O,L)}e("defineMetadata",j);function C(A,$,O){if(!Zt($))throw new TypeError;return he(O)||(O=pi(O)),di(A,$,O)}e("hasMetadata",C);function ie(A,$,O){if(!Zt($))throw new TypeError;return he(O)||(O=pi(O)),eu(A,$,O)}e("hasOwnMetadata",ie);function pe(A,$,O){if(!Zt($))throw new TypeError;return he(O)||(O=pi(O)),lb(A,$,O)}e("getMetadata",pe);function me(A,$,O){if(!Zt($))throw new TypeError;return he(O)||(O=pi(O)),tu(A,$,O)}e("getOwnMetadata",me);function Ce(A,$){if(!Zt(A))throw new TypeError;return he($)||($=pi($)),db(A,$)}e("getMetadataKeys",Ce);function Ge(A,$){if(!Zt(A))throw new TypeError;return he($)||($=pi($)),ru(A,$)}e("getOwnMetadataKeys",Ge);function dr(A,$,O){if(!Zt($))throw new TypeError;if(he(O)||(O=pi(O)),!Zt($))throw new TypeError;he(O)||(O=pi(O));var L=hf($,O,!1);return he(L)?!1:L.OrdinaryDeleteMetadata(A,$,O)}e("deleteMetadata",dr);function nn(A,$){for(var O=A.length-1;O>=0;--O){var L=A[O],de=L($);if(!he(de)&&!qs(de)){if(!RD(de))throw new TypeError;$=de}}return $}function Yt(A,$,O,L){for(var de=A.length-1;de>=0;--de){var nr=A[de],yr=nr($,O,L);if(!he(yr)&&!qs(yr)){if(!Zt(yr))throw new TypeError;L=yr}}return L}function di(A,$,O){var L=eu(A,$,O);if(L)return!0;var de=hA($);return qs(de)?!1:di(A,de,O)}function eu(A,$,O){var L=hf($,O,!1);return he(L)?!1:pb(L.OrdinaryHasOwnMetadata(A,$,O))}function lb(A,$,O){var L=eu(A,$,O);if(L)return tu(A,$,O);var de=hA($);if(!qs(de))return lb(A,de,O)}function tu(A,$,O){var L=hf($,O,!1);if(!he(L))return L.OrdinaryGetOwnMetadata(A,$,O)}function ub(A,$,O,L){var de=hf(O,L,!0);de.OrdinaryDefineOwnMetadata(A,$,O,L)}function db(A,$){var O=ru(A,$),L=hA(A);if(L===null)return O;var de=db(L,$);if(de.length<=0)return O;if(O.length<=0)return de;for(var nr=new f,yr=[],Le=0,K=O;Le<K.length;Le++){var ee=K[Le],re=nr.has(ee);re||(nr.add(ee),yr.push(ee))}for(var se=0,We=de;se<We.length;se++){var ee=We[se],re=nr.has(ee);re||(nr.add(ee),yr.push(ee))}return yr}function ru(A,$){var O=hf(A,$,!1);return O?O.OrdinaryOwnMetadataKeys(A,$):[]}function Va(A){if(A===null)return 1;switch(typeof A){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return A===null?1:6;default:return 6}}function he(A){return A===void 0}function qs(A){return A===null}function dA(A){return typeof A=="symbol"}function Zt(A){return typeof A=="object"?A!==null:typeof A=="function"}function pA(A,$){switch(Va(A)){case 0:return A;case 1:return A;case 2:return A;case 3:return A;case 4:return A;case 5:return A}var O=$===3?"string":$===5?"number":"default",L=zD(A,i);if(L!==void 0){var de=L.call(A,O);if(Zt(de))throw new TypeError;return de}return fA(A,O==="default"?"number":O)}function fA(A,$){if($==="string"){var O=A.toString;if(ou(O)){var L=O.call(A);if(!Zt(L))return L}var de=A.valueOf;if(ou(de)){var L=de.call(A);if(!Zt(L))return L}}else{var de=A.valueOf;if(ou(de)){var L=de.call(A);if(!Zt(L))return L}var nr=A.toString;if(ou(nr)){var L=nr.call(A);if(!Zt(L))return L}}throw new TypeError}function pb(A){return!!A}function nu(A){return""+A}function pi(A){var $=pA(A,3);return dA($)?$:nu($)}function ND(A){return Array.isArray?Array.isArray(A):A instanceof Object?A instanceof Array:Object.prototype.toString.call(A)==="[object Array]"}function ou(A){return typeof A=="function"}function RD(A){return typeof A=="function"}function wY(A){switch(Va(A)){case 3:return!0;case 4:return!0;default:return!1}}function mA(A,$){return A===$||A!==A&&$!==$}function zD(A,$){var O=A[$];if(O!=null){if(!ou(O))throw new TypeError;return O}}function MD(A){var $=zD(A,s);if(!ou($))throw new TypeError;var O=$.call(A);if(!Zt(O))throw new TypeError;return O}function DD(A){return A.value}function qD(A){var $=A.next();return $.done?!1:$}function BD(A){var $=A.return;$&&$.call(A)}function hA(A){var $=Object.getPrototypeOf(A);if(typeof A!="function"||A===d||$!==d)return $;var O=A.prototype,L=O&&Object.getPrototypeOf(O);if(L==null||L===Object.prototype)return $;var de=L.constructor;return typeof de!="function"||de===A?$:de}function xY(){var A;!he(h)&&typeof r.Reflect<"u"&&!(h in r.Reflect)&&typeof r.Reflect.defineMetadata=="function"&&(A=AY(r.Reflect));var $,O,L,de=new m,nr={registerProvider:yr,getProvider:K,setProvider:re};return nr;function yr(se){if(!Object.isExtensible(nr))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case A===se:break;case he($):$=se;break;case $===se:break;case he(O):O=se;break;case O===se:break;default:L===void 0&&(L=new f),L.add(se);break}}function Le(se,We){if(!he($)){if($.isProviderFor(se,We))return $;if(!he(O)){if(O.isProviderFor(se,We))return $;if(!he(L))for(var jt=MD(L);;){var or=qD(jt);if(!or)return;var Eo=DD(or);if(Eo.isProviderFor(se,We))return BD(jt),Eo}}}if(!he(A)&&A.isProviderFor(se,We))return A}function K(se,We){var jt=de.get(se),or;return he(jt)||(or=jt.get(We)),he(or)&&(or=Le(se,We),he(or)||(he(jt)&&(jt=new p,de.set(se,jt)),jt.set(We,or))),or}function ee(se){if(he(se))throw new TypeError;return $===se||O===se||!he(L)&&L.has(se)}function re(se,We,jt){if(!ee(jt))throw new Error("Metadata provider not registered.");var or=K(se,We);if(or!==jt){if(!he(or))return!1;var Eo=de.get(se);he(Eo)&&(Eo=new p,de.set(se,Eo)),Eo.set(We,jt)}return!0}}function SY(){var A;return!he(h)&&Zt(r.Reflect)&&Object.isExtensible(r.Reflect)&&(A=r.Reflect[h]),he(A)&&(A=xY()),!he(h)&&Zt(r.Reflect)&&Object.isExtensible(r.Reflect)&&Object.defineProperty(r.Reflect,h,{enumerable:!1,configurable:!1,writable:!1,value:A}),A}function kY(A){var $=new m,O={isProviderFor:function(ee,re){var se=$.get(ee);return he(se)?!1:se.has(re)},OrdinaryDefineOwnMetadata:yr,OrdinaryHasOwnMetadata:de,OrdinaryGetOwnMetadata:nr,OrdinaryOwnMetadataKeys:Le,OrdinaryDeleteMetadata:K};return g.registerProvider(O),O;function L(ee,re,se){var We=$.get(ee),jt=!1;if(he(We)){if(!se)return;We=new p,$.set(ee,We),jt=!0}var or=We.get(re);if(he(or)){if(!se)return;if(or=new p,We.set(re,or),!A.setProvider(ee,re,O))throw We.delete(re),jt&&$.delete(ee),new Error("Wrong provider for target.")}return or}function de(ee,re,se){var We=L(re,se,!1);return he(We)?!1:pb(We.has(ee))}function nr(ee,re,se){var We=L(re,se,!1);if(!he(We))return We.get(ee)}function yr(ee,re,se,We){var jt=L(se,We,!0);jt.set(ee,re)}function Le(ee,re){var se=[],We=L(ee,re,!1);if(he(We))return se;for(var jt=We.keys(),or=MD(jt),Eo=0;;){var UD=qD(or);if(!UD)return se.length=Eo,se;var IY=DD(UD);try{se[Eo]=IY}catch(TY){try{BD(or)}finally{throw TY}}Eo++}}function K(ee,re,se){var We=L(re,se,!1);if(he(We)||!We.delete(ee))return!1;if(We.size===0){var jt=$.get(re);he(jt)||(jt.delete(se),jt.size===0&&$.delete(jt))}return!0}}function AY(A){var $=A.defineMetadata,O=A.hasOwnMetadata,L=A.getOwnMetadata,de=A.getOwnMetadataKeys,nr=A.deleteMetadata,yr=new m,Le={isProviderFor:function(K,ee){var re=yr.get(K);return!he(re)&&re.has(ee)?!0:de(K,ee).length?(he(re)&&(re=new f,yr.set(K,re)),re.add(ee),!0):!1},OrdinaryDefineOwnMetadata:$,OrdinaryHasOwnMetadata:O,OrdinaryGetOwnMetadata:L,OrdinaryOwnMetadataKeys:de,OrdinaryDeleteMetadata:nr};return Le}function hf(A,$,O){var L=g.getProvider(A,$);if(!he(L))return L;if(O){if(g.setProvider(A,$,v))return v;throw new Error("Illegal state.")}}function $Y(){var A={},$=[],O=(function(){function Le(K,ee,re){this._index=0,this._keys=K,this._values=ee,this._selector=re}return Le.prototype["@@iterator"]=function(){return this},Le.prototype[s]=function(){return this},Le.prototype.next=function(){var K=this._index;if(K>=0&&K<this._keys.length){var ee=this._selector(this._keys[K],this._values[K]);return K+1>=this._keys.length?(this._index=-1,this._keys=$,this._values=$):this._index++,{value:ee,done:!1}}return{value:void 0,done:!0}},Le.prototype.throw=function(K){throw this._index>=0&&(this._index=-1,this._keys=$,this._values=$),K},Le.prototype.return=function(K){return this._index>=0&&(this._index=-1,this._keys=$,this._values=$),{value:K,done:!0}},Le})(),L=(function(){function Le(){this._keys=[],this._values=[],this._cacheKey=A,this._cacheIndex=-2}return Object.defineProperty(Le.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Le.prototype.has=function(K){return this._find(K,!1)>=0},Le.prototype.get=function(K){var ee=this._find(K,!1);return ee>=0?this._values[ee]:void 0},Le.prototype.set=function(K,ee){var re=this._find(K,!0);return this._values[re]=ee,this},Le.prototype.delete=function(K){var ee=this._find(K,!1);if(ee>=0){for(var re=this._keys.length,se=ee+1;se<re;se++)this._keys[se-1]=this._keys[se],this._values[se-1]=this._values[se];return this._keys.length--,this._values.length--,mA(K,this._cacheKey)&&(this._cacheKey=A,this._cacheIndex=-2),!0}return!1},Le.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=A,this._cacheIndex=-2},Le.prototype.keys=function(){return new O(this._keys,this._values,de)},Le.prototype.values=function(){return new O(this._keys,this._values,nr)},Le.prototype.entries=function(){return new O(this._keys,this._values,yr)},Le.prototype["@@iterator"]=function(){return this.entries()},Le.prototype[s]=function(){return this.entries()},Le.prototype._find=function(K,ee){if(!mA(this._cacheKey,K)){this._cacheIndex=-1;for(var re=0;re<this._keys.length;re++)if(mA(this._keys[re],K)){this._cacheIndex=re;break}}return this._cacheIndex<0&&ee&&(this._cacheIndex=this._keys.length,this._keys.push(K),this._values.push(void 0)),this._cacheIndex},Le})();return L;function de(Le,K){return Le}function nr(Le,K){return K}function yr(Le,K){return[Le,K]}}function PY(){var A=(function(){function $(){this._map=new p}return Object.defineProperty($.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),$.prototype.has=function(O){return this._map.has(O)},$.prototype.add=function(O){return this._map.set(O,O),this},$.prototype.delete=function(O){return this._map.delete(O)},$.prototype.clear=function(){this._map.clear()},$.prototype.keys=function(){return this._map.keys()},$.prototype.values=function(){return this._map.keys()},$.prototype.entries=function(){return this._map.entries()},$.prototype["@@iterator"]=function(){return this.keys()},$.prototype[s]=function(){return this.keys()},$})();return A}function CY(){var A=16,$=u.create(),O=L();return(function(){function K(){this._key=L()}return K.prototype.has=function(ee){var re=de(ee,!1);return re!==void 0?u.has(re,this._key):!1},K.prototype.get=function(ee){var re=de(ee,!1);return re!==void 0?u.get(re,this._key):void 0},K.prototype.set=function(ee,re){var se=de(ee,!0);return se[this._key]=re,this},K.prototype.delete=function(ee){var re=de(ee,!1);return re!==void 0?delete re[this._key]:!1},K.prototype.clear=function(){this._key=L()},K})();function L(){var K;do K="@@WeakMap@@"+Le();while(u.has($,K));return $[K]=!0,K}function de(K,ee){if(!n.call(K,O)){if(!ee)return;Object.defineProperty(K,O,{value:u.create()})}return K[O]}function nr(K,ee){for(var re=0;re<ee;++re)K[re]=Math.random()*255|0;return K}function yr(K){if(typeof Uint8Array=="function"){var ee=new Uint8Array(K);return typeof crypto<"u"?crypto.getRandomValues(ee):typeof msCrypto<"u"?msCrypto.getRandomValues(ee):nr(ee,K),ee}return nr(new Array(K),K)}function Le(){var K=yr(A);K[6]=K[6]&79|64,K[8]=K[8]&191|128;for(var ee="",re=0;re<A;++re){var se=K[re];(re===4||re===6||re===8)&&(ee+="-"),se<16&&(ee+="0"),ee+=se.toString(16).toLowerCase()}return ee}}function gA(A){return A.__=void 0,delete A.__,A}})})(UH||(UH={}))});var T={};ve(T,{__addDisposableResource:()=>f3,__assign:()=>xx,__asyncDelegator:()=>i3,__asyncGenerator:()=>o3,__asyncValues:()=>s3,__await:()=>vd,__awaiter:()=>QH,__classPrivateFieldGet:()=>u3,__classPrivateFieldIn:()=>p3,__classPrivateFieldSet:()=>d3,__createBinding:()=>kx,__decorate:()=>HH,__disposeResources:()=>m3,__esDecorate:()=>WH,__exportStar:()=>e3,__extends:()=>FH,__generator:()=>XH,__importDefault:()=>l3,__importStar:()=>c3,__makeTemplateObject:()=>a3,__metadata:()=>YH,__param:()=>GH,__propKey:()=>KH,__read:()=>yj,__rest:()=>VH,__rewriteRelativeImportExtension:()=>h3,__runInitializers:()=>ZH,__setFunctionName:()=>JH,__spread:()=>t3,__spreadArray:()=>n3,__spreadArrays:()=>r3,__values:()=>Sx,default:()=>dfe});function FH(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");hj(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function VH(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r}function HH(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i}function GH(t,e){return function(r,n){e(r,n,t)}}function WH(t,e,r,n,o,i){function s(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var a=n.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&t?n.static?t:t.prototype:null,u=e||(l?Object.getOwnPropertyDescriptor(l,n.name):{}),d,p=!1,f=r.length-1;f>=0;f--){var m={};for(var h in n)m[h]=h==="access"?{}:n[h];for(var h in n.access)m.access[h]=n.access[h];m.addInitializer=function(v){if(p)throw new TypeError("Cannot add initializers after decoration has completed");i.push(s(v||null))};var g=(0,r[f])(a==="accessor"?{get:u.get,set:u.set}:u[c],m);if(a==="accessor"){if(g===void 0)continue;if(g===null||typeof g!="object")throw new TypeError("Object expected");(d=s(g.get))&&(u.get=d),(d=s(g.set))&&(u.set=d),(d=s(g.init))&&o.unshift(d)}else(d=s(g))&&(a==="field"?o.unshift(d):u[c]=d)}l&&Object.defineProperty(l,n.name,u),p=!0}function ZH(t,e,r){for(var n=arguments.length>2,o=0;o<e.length;o++)r=n?e[o].call(t,r):e[o].call(t);return n?r:void 0}function KH(t){return typeof t=="symbol"?t:"".concat(t)}function JH(t,e,r){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:r?"".concat(r," ",e):e})}function YH(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function QH(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(u){try{l(n.next(u))}catch(d){s(d)}}function c(u){try{l(n.throw(u))}catch(d){s(d)}}function l(u){u.done?i(u.value):o(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})}function XH(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(r=0)),r;)try{if(n=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],o=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function e3(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&kx(e,t,r)}function Sx(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function yj(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function t3(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(yj(arguments[e]));return t}function r3(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}function n3(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}function vd(t){return this instanceof vd?(this.v=t,this):new vd(t)}function o3(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(m){return Promise.resolve(m).then(f,d)}}function a(f,m){n[f]&&(o[f]=function(h){return new Promise(function(g,v){i.push([f,h,g,v])>1||c(f,h)})},m&&(o[f]=m(o[f])))}function c(f,m){try{l(n[f](m))}catch(h){p(i[0][3],h)}}function l(f){f.value instanceof vd?Promise.resolve(f.value.v).then(u,d):p(i[0][2],f)}function u(f){c("next",f)}function d(f){c("throw",f)}function p(f,m){f(m),i.shift(),i.length&&c(i[0][0],i[0][1])}}function i3(t){var e,r;return e={},n("next"),n("throw",function(o){throw o}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(o,i){e[o]=t[o]?function(s){return(r=!r)?{value:vd(t[o](s)),done:!1}:i?i(s):s}:i}}function s3(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Sx=="function"?Sx(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(s){return new Promise(function(a,c){s=t[i](s),o(a,c,s.done,s.value)})}}function o(i,s,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},s)}}function a3(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function c3(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r=gj(t),n=0;n<r.length;n++)r[n]!=="default"&&kx(e,t,r[n]);return lfe(e,t),e}function l3(t){return t&&t.__esModule?t:{default:t}}function u3(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function d3(t,e,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(t,r):o?o.value=r:e.set(t,r),r}function p3(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function f3(t,e,r){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var n,o;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],r&&(o=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");o&&(n=function(){try{o.call(this)}catch(i){return Promise.reject(i)}}),t.stack.push({value:e,dispose:n,async:r})}else r&&t.stack.push({async:!0});return e}function m3(t){function e(i){t.error=t.hasError?new ufe(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}var r,n=0;function o(){for(;r=t.stack.pop();)try{if(!r.async&&n===1)return n=0,t.stack.push(r),Promise.resolve().then(o);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(o,function(s){return e(s),o()})}else n|=1}catch(s){e(s)}if(n===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return o()}function h3(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,o,i,s){return n?e?".jsx":".js":o&&(!i||!s)?r:o+i+"."+s.toLowerCase()+"js"}):t}var hj,xx,kx,lfe,gj,ufe,dfe,E=x(()=>{hj=function(t,e){return hj=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},hj(t,e)};xx=function(){return xx=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},xx.apply(this,arguments)};kx=Object.create?(function(t,e,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]});lfe=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},gj=function(t){return gj=Object.getOwnPropertyNames||function(e){var r=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[r.length]=n);return r},gj(t)};ufe=typeof SuppressedError=="function"?SuppressedError:function(t,e,r){var n=new Error(r);return n.name="SuppressedError",n.error=t,n.suppressed=e,n};dfe={__extends:FH,__assign:xx,__rest:VH,__decorate:HH,__param:GH,__esDecorate:WH,__runInitializers:ZH,__propKey:KH,__setFunctionName:JH,__metadata:YH,__awaiter:QH,__generator:XH,__createBinding:kx,__exportStar:e3,__values:Sx,__read:yj,__spread:t3,__spreadArrays:r3,__spreadArray:n3,__await:vd,__asyncGenerator:o3,__asyncDelegator:i3,__asyncValues:s3,__makeTemplateObject:a3,__importStar:c3,__importDefault:l3,__classPrivateFieldGet:u3,__classPrivateFieldSet:d3,__classPrivateFieldIn:p3,__addDisposableResource:f3,__disposeResources:m3,__rewriteRelativeImportExtension:h3}});var fs=y(bd=>{"use strict";var pfe="[object ArrayBuffer]",ps=class t{static isArrayBuffer(e){return Object.prototype.toString.call(e)===pfe}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,r){if(e.constructor===r)return e;if(this.isArrayBuffer(e))return new r(e);if(this.isArrayBufferView(e))return new r(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,r){let n=t.toUint8Array(e),o=t.toUint8Array(r);if(n.length!==o.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==o[i])return!1;return!0}static concat(...e){let r;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?r=e[0]:e[e.length-1]instanceof Function?r=e.slice(0,e.length-1):r=e;let n=0;for(let s of r)n+=s.byteLength;let o=new Uint8Array(n),i=0;for(let s of r){let a=this.toUint8Array(s);o.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(o,e[e.length-1]):o.buffer}},vj="string",ffe=/^[0-9a-f\s]+$/i,mfe=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,hfe=/^[a-zA-Z0-9-_]+$/,Ax=class{static fromString(e){let r=unescape(encodeURIComponent(e)),n=new Uint8Array(r.length);for(let o=0;o<r.length;o++)n[o]=r.charCodeAt(o);return n.buffer}static toString(e){let r=ps.toUint8Array(e),n="";for(let i=0;i<r.length;i++)n+=String.fromCharCode(r[i]);return decodeURIComponent(escape(n))}},yo=class{static toString(e,r=!1){let n=ps.toArrayBuffer(e),o=new DataView(n),i="";for(let s=0;s<n.byteLength;s+=2){let a=o.getUint16(s,r);i+=String.fromCharCode(a)}return i}static fromString(e,r=!1){let n=new ArrayBuffer(e.length*2),o=new DataView(n);for(let i=0;i<e.length;i++)o.setUint16(i*2,e.charCodeAt(i),r);return n}},$x=class t{static isHex(e){return typeof e===vj&&ffe.test(e)}static isBase64(e){return typeof e===vj&&mfe.test(e)}static isBase64Url(e){return typeof e===vj&&hfe.test(e)}static ToString(e,r="utf8"){let n=ps.toUint8Array(e);switch(r.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return yo.toString(n,!0);case"utf16":case"utf16be":return yo.toString(n);default:throw new Error(`Unknown type of encoding '${r}'`)}}static FromString(e,r="utf8"){if(!e)return new ArrayBuffer(0);switch(r.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return yo.fromString(e,!0);case"utf16":case"utf16be":return yo.fromString(e);default:throw new Error(`Unknown type of encoding '${r}'`)}}static ToBase64(e){let r=ps.toUint8Array(e);if(typeof btoa<"u"){let n=this.ToString(r,"binary");return btoa(n)}else return Buffer.from(r).toString("base64")}static FromBase64(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}static FromBase64Url(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,r=t.DEFAULT_UTF8_ENCODING){switch(r){case"ascii":return this.FromBinary(e);case"utf8":return Ax.fromString(e);case"utf16":case"utf16be":return yo.fromString(e);case"utf16le":case"usc2":return yo.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${r}'`)}}static ToUtf8String(e,r=t.DEFAULT_UTF8_ENCODING){switch(r){case"ascii":return this.ToBinary(e);case"utf8":return Ax.toString(e);case"utf16":case"utf16be":return yo.toString(e);case"utf16le":case"usc2":return yo.toString(e,!0);default:throw new Error(`Unknown type of encoding '${r}'`)}}static FromBinary(e){let r=e.length,n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e.charCodeAt(o);return n.buffer}static ToBinary(e){let r=ps.toUint8Array(e),n="";for(let o=0;o<r.length;o++)n+=String.fromCharCode(r[o]);return n}static ToHex(e){let r=ps.toUint8Array(e),n="",o=r.length;for(let i=0;i<o;i++){let s=r[i];s<16&&(n+="0"),n+=s.toString(16)}return n}static FromHex(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r=`0${r}`);let n=new Uint8Array(r.length/2);for(let o=0;o<r.length;o=o+2){let i=r.slice(o,o+2);n[o/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(e,r=!1){return yo.toString(e,r)}static FromUtf16String(e,r=!1){return yo.fromString(e,r)}static Base64Padding(e){let r=4-e.length%4;if(r<4)for(let n=0;n<r;n++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}};$x.DEFAULT_UTF8_ENCODING="utf8";function gfe(t,...e){let r=arguments[0];for(let n=1;n<arguments.length;n++){let o=arguments[n];for(let i in o)r[i]=o[i]}return r}function yfe(...t){let e=t.map(o=>o.byteLength).reduce((o,i)=>o+i),r=new Uint8Array(e),n=0;return t.map(o=>new Uint8Array(o)).forEach(o=>{for(let i of o)r[n++]=i}),r.buffer}function vfe(t,e){if(!(t&&e)||t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<t.byteLength;o++)if(r[o]!==n[o])return!1;return!0}bd.BufferSourceConverter=ps;bd.Convert=$x;bd.assign=gfe;bd.combine=yfe;bd.isEqual=vfe});var v3=y(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});function bfe(t){return new Date(t.getTime()+t.getTimezoneOffset()*6e4)}function _fe(t,e,r){var n;return t instanceof Object&&(n=t[e])!==null&&n!==void 0?n:r}function wfe(t,e=0,r=t.byteLength-e,n=!1){let o="";for(let i of new Uint8Array(t,e,r)){let s=i.toString(16).toUpperCase();s.length===1&&(o+="0"),o+=s,n&&(o+=" ")}return o.trim()}function xfe(t,e,r,n){return e instanceof ArrayBuffer?e.byteLength?r<0?(t.error="Wrong parameter: inputOffset less than zero",!1):n<0?(t.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-r-n<0?(t.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(t.error="Wrong parameter: inputBuffer has zero length",!1):(t.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1)}function bj(t,e){let r=0;if(t.length===1)return t[0];for(let n=t.length-1;n>=0;n--)r+=t[t.length-1-n]*Math.pow(2,e*n);return r}function _j(t,e,r=-1){let n=r,o=t,i=0,s=Math.pow(2,e);for(let a=1;a<8;a++){if(t<s){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let l=new Uint8Array(c);for(let u=a-1;u>=0;u--){let d=Math.pow(2,u*e);l[i-u-1]=Math.floor(o/d),o-=l[i-u-1]*d}return c}s*=Math.pow(2,e)}return new ArrayBuffer(0)}function Sfe(...t){let e=0,r=0;for(let i of t)e+=i.byteLength;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of t)o.set(new Uint8Array(i),r),r+=i.byteLength;return n}function kfe(...t){let e=0,r=0;for(let i of t)e+=i.length;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of t)o.set(i,r),r+=i.length;return o}function Afe(){let t=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=t[0]===255&&t[1]&128,c=t[0]===0&&(t[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)r[a]=0;r[0]=t[0]&128;let n=bj(r,8),o=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(o);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=t[a];return i[0]&=127,bj(i,8)-n}function $fe(t){let e=t<0?t*-1:t,r=128;for(let n=1;n<8;n++){if(e<=r){if(t<0){let s=r-e,a=_j(s,8,n),c=new Uint8Array(a);return c[0]|=128,a}let o=_j(e,8,n),i=new Uint8Array(o);if(i[0]&128){let s=o.slice(0),a=new Uint8Array(s);o=new ArrayBuffer(o.byteLength+1),i=new Uint8Array(o);for(let c=0;c<s.byteLength;c++)i[c+1]=a[c];i[0]=0}return o}r*=Math.pow(2,8)}return new ArrayBuffer(0)}function Pfe(t,e){if(t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<r.length;o++)if(r[o]!==n[o])return!1;return!0}function Cfe(t,e){let r=t.toString(10);if(e<r.length)return"";let n=e-r.length,o=new Array(n);for(let s=0;s<n;s++)o[s]="0";return o.join("").concat(r)}var g3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",y3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Ife(t,e=!1,r=!1,n=!1){let o=0,i=0,s=0,a="",c=e?y3:g3;if(n){let l=0;for(let u=0;u<t.length;u++)if(t.charCodeAt(u)!==0){l=u;break}t=t.slice(l)}for(;o<t.length;){let l=t.charCodeAt(o++);o>=t.length&&(i=1);let u=t.charCodeAt(o++);o>=t.length&&(s=1);let d=t.charCodeAt(o++),p=l>>2,f=(l&3)<<4|u>>4,m=(u&15)<<2|d>>6,h=d&63;i===1?m=h=64:s===1&&(h=64),r?m===64?a+=`${c.charAt(p)}${c.charAt(f)}`:h===64?a+=`${c.charAt(p)}${c.charAt(f)}${c.charAt(m)}`:a+=`${c.charAt(p)}${c.charAt(f)}${c.charAt(m)}${c.charAt(h)}`:a+=`${c.charAt(p)}${c.charAt(f)}${c.charAt(m)}${c.charAt(h)}`}return a}function Tfe(t,e=!1,r=!1){let n=e?y3:g3;function o(c){for(let l=0;l<64;l++)if(n.charAt(l)===c)return l;return 64}function i(c){return c===64?0:c}let s=0,a="";for(;s<t.length;){let c=o(t.charAt(s++)),l=s>=t.length?0:o(t.charAt(s++)),u=s>=t.length?0:o(t.charAt(s++)),d=s>=t.length?0:o(t.charAt(s++)),p=i(c)<<2|i(l)>>4,f=(i(l)&15)<<4|i(u)>>2,m=(i(u)&3)<<6|i(d);a+=String.fromCharCode(p),u!==64&&(a+=String.fromCharCode(f)),d!==64&&(a+=String.fromCharCode(m))}if(r){let c=a.length,l=-1;for(let u=c-1;u>=0;u--)if(a.charCodeAt(u)!==0){l=u;break}l!==-1?a=a.slice(0,l+1):a=""}return a}function Efe(t){let e="",r=new Uint8Array(t);for(let n of r)e+=String.fromCharCode(n);return e}function Ofe(t){let e=t.length,r=new ArrayBuffer(e),n=new Uint8Array(r);for(let o=0;o<e;o++)n[o]=t.charCodeAt(o);return r}var jfe=Math.log(2);function Nfe(t){let e=Math.log(t)/jfe,r=Math.floor(e),n=Math.round(e);return r===n?r:n}function Rfe(t,e){for(let r of e)delete t[r]}mr.arrayBufferToString=Efe;mr.bufferToHexCodes=wfe;mr.checkBufferParams=xfe;mr.clearProps=Rfe;mr.fromBase64=Tfe;mr.getParametersValue=_fe;mr.getUTCDate=bfe;mr.isEqualBuffer=Pfe;mr.nearestPowerOf2=Nfe;mr.padNumber=Cfe;mr.stringToArrayBuffer=Ofe;mr.toBase64=Ife;mr.utilConcatBuf=Sfe;mr.utilConcatView=kfe;mr.utilDecodeTC=Afe;mr.utilEncodeTC=$fe;mr.utilFromBase=bj;mr.utilToBase=_j});var ya=y($e=>{"use strict";var zfe=fs(),Mfe=v3();function x3(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,Object.freeze(e)}var He=x3(zfe),ft=x3(Mfe);function Px(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Sj(t){let e=0,r=0;for(let o=0;o<t.length;o++){let i=t[o];e+=i.byteLength}let n=new Uint8Array(e);for(let o=0;o<t.length;o++){let i=t[o];n.set(new Uint8Array(i),r),r+=i.byteLength}return n.buffer}function gs(t,e,r,n){return e instanceof Uint8Array?e.byteLength?r<0?(t.error="Wrong parameter: inputOffset less than zero",!1):n<0?(t.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-r-n<0?(t.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(t.error="Wrong parameter: inputBuffer has zero length",!1):(t.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var wd=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Sj(this.items)}},Xh=[new Uint8Array([1])],b3="0123456789",wj="name",_3="valueHexView",Dfe="isHexOnly",qfe="idBlock",Bfe="tagClass",Ufe="tagNumber",Lfe="isConstructed",Ffe="fromBER",Vfe="toBER",Hfe="local",Cn="",Pi=new ArrayBuffer(0),Fx=new Uint8Array(0),tg="EndOfContent",S3="OCTET STRING",k3="BIT STRING";function Ci(t){var e;return e=class extends t{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var o;super(...n);let i=n[0]||{};this.isHexOnly=(o=i.isHexOnly)!==null&&o!==void 0?o:!1,this.valueHexView=i.valueHex?He.BufferSourceConverter.toUint8Array(i.valueHex):Fx}fromBER(n,o,i){let s=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!gs(this,s,o,i))return-1;let a=o+i;return this.valueHexView=s.subarray(o,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),o)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Pi)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:He.Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}var ms=class{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:r=Cn,warnings:n=[],valueBeforeDecode:o=Fx}={}){this.blockLength=e,this.error=r,this.warnings=n,this.valueBeforeDecodeView=He.BufferSourceConverter.toUint8Array(o)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:He.Convert.ToHex(this.valueBeforeDecodeView)}}};ms.NAME="baseBlock";var Br=class extends ms{fromBER(e,r,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};Br.NAME="valueBlock";var Cx=class extends Ci(ms){constructor({idBlock:e={}}={}){var r,n,o,i;super(),e?(this.isHexOnly=(r=e.isHexOnly)!==null&&r!==void 0?r:!1,this.valueHexView=e.valueHex?He.BufferSourceConverter.toUint8Array(e.valueHex):Fx,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(o=e.tagNumber)!==null&&o!==void 0?o:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let r=0;switch(this.tagClass){case 1:r|=0;break;case 2:r|=64;break;case 3:r|=128;break;case 4:r|=192;break;default:return this.error="Unknown tag class",Pi}if(this.isConstructed&&(r|=32),this.tagNumber<31&&!this.isHexOnly){let o=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,r|=i,o[0]=r}return o.buffer}if(!this.isHexOnly){let o=ft.utilToBase(this.tagNumber,7),i=new Uint8Array(o),s=o.byteLength,a=new Uint8Array(s+1);if(a[0]=r|31,!e){for(let c=0;c<s-1;c++)a[c+1]=i[c]|128;a[s]=i[s-1]}return a.buffer}let n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=r|31,!e){let o=this.valueHexView;for(let i=0;i<o.length-1;i++)n[i+1]=o[i]|128;n[this.valueHexView.byteLength]=o[o.length-1]}return n.buffer}fromBER(e,r,n){let o=He.BufferSourceConverter.toUint8Array(e);if(!gs(this,o,r,n))return-1;let i=o.subarray(r,r+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;let a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),u=255;for(;i[c]&128;){if(l[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===u){u+=255;let p=new Uint8Array(u);for(let f=0;f<l.length;f++)p[f]=l[f];l=this.valueHexView=new Uint8Array(u)}}this.blockLength=c+1,l[c-1]=i[c]&127;let d=new Uint8Array(c);for(let p=0;p<c;p++)d[p]=l[p];l=this.valueHexView=new Uint8Array(c),l.set(d),this.blockLength<=9?this.tagNumber=ft.utilFromBase(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return r+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};Cx.NAME="identificationBlock";var Ix=class extends ms{constructor({lenBlock:e={}}={}){var r,n,o;super(),this.isIndefiniteForm=(r=e.isIndefiniteForm)!==null&&r!==void 0?r:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(o=e.length)!==null&&o!==void 0?o:0}fromBER(e,r,n){let o=He.BufferSourceConverter.toUint8Array(e);if(!gs(this,o,r,n))return-1;let i=o.subarray(r,r+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,r+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,r+this.blockLength;let s=i[0]&127;if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let a=r+1,c=o.subarray(a,a+s);return c[s-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=ft.utilFromBase(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,r+this.blockLength}toBER(e=!1){let r,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return r=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(r),n[0]=128),r;if(this.longFormUsed){let o=ft.utilToBase(this.length,8);if(o.byteLength>127)return this.error="Too big length",Pi;if(r=new ArrayBuffer(o.byteLength+1),e)return r;let i=new Uint8Array(o);n=new Uint8Array(r),n[0]=o.byteLength|128;for(let s=0;s<o.byteLength;s++)n[s+1]=i[s];return r}return r=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(r),n[0]=this.length),r}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};Ix.NAME="lengthBlock";var Y={},Ar=class extends ms{constructor({name:e=Cn,optional:r=!1,primitiveSchema:n,...o}={},i){super(o),this.name=e,this.optional=r,n&&(this.primitiveSchema=n),this.idBlock=new Cx(o),this.lenBlock=new Ix(o),this.valueBlock=i?new i(o):new Br(o)}fromBER(e,r,n){let o=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}toBER(e,r){let n=r||new wd;r||A3(this);let o=this.idBlock.toBER(e);if(n.write(o),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{let i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;let s=this.lenBlock.toBER(e);n.write(s),n.write(i)}return r?Pi:n.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():He.Convert.ToHex(this.toBER())}onAsciiEncoding(){let e=this.constructor.NAME,r=He.Convert.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${r}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;let r=this.toBER(),n=e.toBER();return ft.isEqualBuffer(r,n)}};Ar.NAME="BaseBlock";function A3(t){var e;if(t instanceof Y.Constructed)for(let r of t.valueBlock.value)A3(r)&&(t.lenBlock.isIndefiniteForm=!0);return!!(!((e=t.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}var rg=class extends Ar{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Cn,...r}={},n){super(r,n),e&&this.fromString(e)}fromBER(e,r,n){let o=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};rg.NAME="BaseStringBlock";var Tx=class extends Ci(Br){constructor({isHexOnly:e=!0,...r}={}){super(r),this.isHexOnly=e}};Tx.NAME="PrimitiveValueBlock";var $3,ng=class extends Ar{constructor(e={}){super(e,Tx),this.idBlock.isConstructed=!1}};$3=ng;Y.Primitive=$3;ng.NAME="PRIMITIVE";function Gfe(t,e){if(t instanceof e)return t;let r=new e;return r.idBlock=t.idBlock,r.lenBlock=t.lenBlock,r.warnings=t.warnings,r.valueBeforeDecodeView=t.valueBeforeDecodeView,r}function Ad(t,e=0,r=t.length){let n=e,o=new Ar({},Br),i=new ms;if(!gs(i,t,e,r))return o.error=i.error,{offset:-1,result:o};if(!t.subarray(e,e+r).length)return o.error="Zero buffer length",{offset:-1,result:o};let a=o.idBlock.fromBER(t,e,r);if(o.idBlock.warnings.length&&o.warnings.concat(o.idBlock.warnings),a===-1)return o.error=o.idBlock.error,{offset:-1,result:o};if(e=a,r-=o.idBlock.blockLength,a=o.lenBlock.fromBER(t,e,r),o.lenBlock.warnings.length&&o.warnings.concat(o.lenBlock.warnings),a===-1)return o.error=o.lenBlock.error,{offset:-1,result:o};if(e=a,r-=o.lenBlock.blockLength,!o.idBlock.isConstructed&&o.lenBlock.isIndefiniteForm)return o.error="Indefinite length form used for primitive encoding form",{offset:-1,result:o};let c=Ar;switch(o.idBlock.tagClass){case 1:if(o.idBlock.tagNumber>=37&&o.idBlock.isHexOnly===!1)return o.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:o};switch(o.idBlock.tagNumber){case 0:if(o.idBlock.isConstructed&&o.lenBlock.length>0)return o.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:o};c=Y.EndOfContent;break;case 1:c=Y.Boolean;break;case 2:c=Y.Integer;break;case 3:c=Y.BitString;break;case 4:c=Y.OctetString;break;case 5:c=Y.Null;break;case 6:c=Y.ObjectIdentifier;break;case 10:c=Y.Enumerated;break;case 12:c=Y.Utf8String;break;case 13:c=Y.RelativeObjectIdentifier;break;case 14:c=Y.TIME;break;case 15:return o.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:o};case 16:c=Y.Sequence;break;case 17:c=Y.Set;break;case 18:c=Y.NumericString;break;case 19:c=Y.PrintableString;break;case 20:c=Y.TeletexString;break;case 21:c=Y.VideotexString;break;case 22:c=Y.IA5String;break;case 23:c=Y.UTCTime;break;case 24:c=Y.GeneralizedTime;break;case 25:c=Y.GraphicString;break;case 26:c=Y.VisibleString;break;case 27:c=Y.GeneralString;break;case 28:c=Y.UniversalString;break;case 29:c=Y.CharacterString;break;case 30:c=Y.BmpString;break;case 31:c=Y.DATE;break;case 32:c=Y.TimeOfDay;break;case 33:c=Y.DateTime;break;case 34:c=Y.Duration;break;default:{let l=o.idBlock.isConstructed?new Y.Constructed:new Y.Primitive;l.idBlock=o.idBlock,l.lenBlock=o.lenBlock,l.warnings=o.warnings,o=l}}break;default:c=o.idBlock.isConstructed?Y.Constructed:Y.Primitive}return o=Gfe(o,c),a=o.fromBER(t,e,o.lenBlock.isIndefiniteForm?r:o.lenBlock.length),o.valueBeforeDecodeView=t.subarray(n,n+o.blockLength),{offset:a,result:o}}function Wfe(t){if(!t.byteLength){let e=new Ar({},Br);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Ad(He.BufferSourceConverter.toUint8Array(t).slice(),0,t.byteLength)}function Zfe(t,e){return t?1:e}var Ai=class extends Br{constructor({value:e=[],isIndefiniteForm:r=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=r}fromBER(e,r,n){let o=He.BufferSourceConverter.toUint8Array(e);if(!gs(this,o,r,n))return-1;if(this.valueBeforeDecodeView=o.subarray(r,r+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),r;let i=r;for(;Zfe(this.isIndefiniteForm,n)>0;){let s=Ad(o,i,n);if(s.offset===-1)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(i=s.offset,this.blockLength+=s.result.blockLength,n-=s.result.blockLength,this.value.push(s.result),this.isIndefiniteForm&&s.result.constructor.NAME===tg)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===tg?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,r){let n=r||new wd;for(let o=0;o<this.value.length;o++)this.value[o].toBER(e,n);return r?Pi:n.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let r of this.value)e.value.push(r.toJSON());return e}};Ai.NAME="ConstructedValueBlock";var P3,hs=class extends Ar{constructor(e={}){super(e,Ai),this.idBlock.isConstructed=!0}fromBER(e,r,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let o=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(o=>`  ${o}`).join(`
`));let r=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${r} :
${e.join(`
`)}`:`${r} :`}};P3=hs;Y.Constructed=P3;hs.NAME="CONSTRUCTED";var Ex=class extends Br{fromBER(e,r,n){return r}toBER(e){return Pi}};Ex.override="EndOfContentValueBlock";var C3,og=class extends Ar{constructor(e={}){super(e,Ex),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};C3=og;Y.EndOfContent=C3;og.NAME=tg;var I3,ig=class extends Ar{constructor(e={}){super(e,Br),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,r,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,r+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):r+n}toBER(e,r){let n=new ArrayBuffer(2);if(!e){let o=new Uint8Array(n);o[0]=5,o[1]=0}return r&&r.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};I3=ig;Y.Null=I3;ig.NAME="NULL";var Ox=class extends Ci(Br){get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...r}={}){super(r),r.valueHex?this.valueHexView=He.BufferSourceConverter.toUint8Array(r.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,r,n){let o=He.BufferSourceConverter.toUint8Array(e);return gs(this,o,r,n)?(this.valueHexView=o.subarray(r,r+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,ft.utilDecodeTC.call(this),this.blockLength=n,r+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};Ox.NAME="BooleanValueBlock";var T3,sg=class extends Ar{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,Ox),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};T3=sg;Y.Boolean=T3;sg.NAME="BOOLEAN";var jx=class extends Ci(Ai){constructor({isConstructed:e=!1,...r}={}){super(r),this.isConstructed=e}fromBER(e,r,n){let o=0;if(this.isConstructed){if(this.isHexOnly=!1,o=Ai.prototype.fromBER.call(this,e,r,n),o===-1)return o;for(let i=0;i<this.value.length;i++){let s=this.value[i].constructor.NAME;if(s===tg){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==S3)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,o=super.fromBER(e,r,n),this.blockLength=n;return o}toBER(e,r){return this.isConstructed?Ai.prototype.toBER.call(this,e,r):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};jx.NAME="OctetStringValueBlock";var kj,ag=class extends Ar{constructor({idBlock:e={},lenBlock:r={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...r,isIndefiniteForm:!!n.isIndefiniteForm},...n},jx),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,r,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),r;if(!this.valueBlock.isConstructed){let i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(r,r+n);try{if(i.byteLength){let s=Ad(i,0,i.byteLength);s.offset!==-1&&s.offset===n&&(this.valueBlock.value=[s.result])}}catch{}}return super.fromBER(e,r,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return hs.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,r=He.Convert.ToHex(this.valueBlock.valueHexView);return`${e} : ${r}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let r of this.valueBlock.value)r instanceof kj&&e.push(r.valueBlock.valueHexView);return He.BufferSourceConverter.concat(e)}};kj=ag;Y.OctetString=kj;ag.NAME=S3;var Nx=class extends Ci(Ai){constructor({unusedBits:e=0,isConstructed:r=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=r,this.blockLength=this.valueHexView.byteLength}fromBER(e,r,n){if(!n)return r;let o=-1;if(this.isConstructed){if(o=Ai.prototype.fromBER.call(this,e,r,n),o===-1)return o;for(let a of this.value){let c=a.constructor.NAME;if(c===tg){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==k3)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return o}let i=He.BufferSourceConverter.toUint8Array(e);if(!gs(this,i,r,n))return-1;let s=i.subarray(r,r+n);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=s.subarray(1);try{if(a.byteLength){let c=Ad(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,r+n}toBER(e,r){if(this.isConstructed)return Ai.prototype.toBER.call(this,e,r);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength){let o=new Uint8Array(1);return o[0]=0,o.buffer}let n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};Nx.NAME="BitStringValueBlock";var E3,cg=class extends Ar{constructor({idBlock:e={},lenBlock:r={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...r,isIndefiniteForm:!!n.isIndefiniteForm},...n},Nx),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,r,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,r,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return hs.prototype.onAsciiEncoding.call(this);{let e=[],r=this.valueBlock.valueHexView;for(let s of r)e.push(s.toString(2).padStart(8,"0"));let n=e.join(""),o=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${o} : ${i}`}}};E3=cg;Y.BitString=E3;cg.NAME=k3;var O3;function Kfe(t,e){let r=new Uint8Array([0]),n=new Uint8Array(t),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,l=0,u=c<s?s:c,d=0;for(let p=u;p>=0;p--,d++)!0===d<a.length?l=i[s-d]+a[c-d]+r[0]:l=i[s-d]+r[0],r[0]=l/10,!0===d>=i.length?i=ft.utilConcatView(new Uint8Array([l%10]),i):i[s-d]=l%10;return r[0]>0&&(i=ft.utilConcatView(r,i)),i}function w3(t){if(t>=Xh.length)for(let e=Xh.length;e<=t;e++){let r=new Uint8Array([0]),n=Xh[e-1].slice(0);for(let o=n.length-1;o>=0;o--){let i=new Uint8Array([(n[o]<<1)+r[0]]);r[0]=i[0]/10,n[o]=i[0]%10}r[0]>0&&(n=ft.utilConcatView(r,n)),Xh.push(n)}return Xh[t]}function Jfe(t,e){let r=0,n=new Uint8Array(t),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,l,u=0;for(let d=c;d>=0;d--,u++)l=i[s-u]-a[c-u]-r,!0===l<0?(r=1,i[s-u]=l+10):(r=0,i[s-u]=l);if(r>0)for(let d=s-c+1;d>=0;d--,u++)if(l=i[s-u]-r,l<0)r=1,i[s-u]=l+10;else{r=0,i[s-u]=l;break}return i.slice()}var lg=class extends Ci(Br){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=ft.utilDecodeTC.call(this)))}constructor({value:e,...r}={}){super(r),this._valueDec=0,r.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(ft.utilEncodeTC(e))}get valueDec(){return this._valueDec}fromDER(e,r,n,o=0){let i=this.fromBER(e,r,n);if(i===-1)return i;let s=this.valueHexView;return s[0]===0&&(s[1]&128)!==0?this.valueHexView=s.subarray(1):o!==0&&s.length<o&&(o-s.length>1&&(o=s.length+1),this.valueHexView=s.subarray(o-s.length)),i}toDER(e=!1){let r=this.valueHexView;switch(!0){case(r[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(r,1),this.valueHexView=n}break;case(r[0]===0&&(r[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,r,n){let o=super.fromBER(e,r,n);return o===-1||this.setValueHex(),o}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e=this.valueHexView.length*8-1,r=new Uint8Array(this.valueHexView.length*8/3),n=0,o,i=this.valueHexView,s="",a=!1;for(let c=i.byteLength-1;c>=0;c--){o=i[c];for(let l=0;l<8;l++)(o&1)===1&&(n===e?(r=Jfe(w3(n),r),s="-"):r=Kfe(r,w3(n))),n++,o>>=1}for(let c=0;c<r.length;c++)r[c]&&(a=!0),a&&(s+=b3.charAt(r[c]));return a===!1&&(s+=b3.charAt(0)),s}};O3=lg;lg.NAME="IntegerValueBlock";Object.defineProperty(O3.prototype,"valueHex",{set:function(t){this.valueHexView=new Uint8Array(t),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var eg,xd=class extends Ar{constructor(e={}){super(e,lg),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Px(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Px();let r=BigInt(e),n=new wd,o=r.toString(16).replace(/^-/,""),i=new Uint8Array(He.Convert.FromHex(o));if(r<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let l=BigInt(`0x${He.Convert.ToHex(a)}`)+r,u=He.BufferSourceConverter.toUint8Array(He.Convert.FromHex(l.toString(16)));u[0]|=128,n.write(u)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new eg({valueHex:n.final()})}convertToDER(){let e=new eg({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new eg({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};eg=xd;Y.Integer=eg;xd.NAME="INTEGER";var j3,ug=class extends xd{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};j3=ug;Y.Enumerated=j3;ug.NAME="ENUMERATED";var dg=class extends Ci(Br){constructor({valueDec:e=-1,isFirstSid:r=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=r}fromBER(e,r,n){if(!n)return r;let o=He.BufferSourceConverter.toUint8Array(e);if(!gs(this,o,r,n))return-1;let i=o.subarray(r,r+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ft.utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),r+this.blockLength)}set valueBigInt(e){Px();let r=BigInt(e).toString(2);for(;r.length%7;)r="0"+r;let n=new Uint8Array(r.length/7);for(let o=0;o<n.length;o++)n[o]=parseInt(r.slice(o*7,o*7+7),2)+(o+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let r=ft.utilToBase(this.valueDec,7);if(r.byteLength===0)return this.error="Error during encoding SID value",Pi;let n=new Uint8Array(r.byteLength);if(!e){let o=new Uint8Array(r),i=r.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n}toString(){let e="";if(this.isHexOnly)e=He.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let r=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",r-=40):(e="2.",r-=80),e+=r.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};dg.NAME="sidBlock";var Rx=class extends Br{constructor({value:e=Cn,...r}={}){super(r),this.value=[],e&&this.fromString(e)}fromBER(e,r,n){let o=r;for(;n>0;){let i=new dg;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e){let r=[];for(let n=0;n<this.value.length;n++){let o=this.value[n].toBER(e);if(o.byteLength===0)return this.error=this.value[n].error,Pi;r.push(o)}return Sj(r)}fromString(e){this.value=[];let r=0,n=0,o="",i=!1;do if(n=e.indexOf(".",r),n===-1?o=e.substring(r):o=e.substring(r,n),r=n+1,i){let s=this.value[0],a=0;switch(s.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}let c=parseInt(o,10);if(isNaN(c))return;s.valueDec=c+a,i=!1}else{let s=new dg;if(o>Number.MAX_SAFE_INTEGER){Px();let a=BigInt(o);s.valueBigInt=a}else if(s.valueDec=parseInt(o,10),isNaN(s.valueDec))return;this.value.length||(s.isFirstSid=!0,i=!0),this.value.push(s)}while(n!==-1)}toString(){let e="",r=!1;for(let n=0;n<this.value.length;n++){r=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),r?(o=`{${o}}`,this.value[n].isFirstSid?e=`2.{${o} - 80}`:e+=o):e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}};Rx.NAME="ObjectIdentifierValueBlock";var N3,pg=class extends Ar{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Rx),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};N3=pg;Y.ObjectIdentifier=N3;pg.NAME="OBJECT IDENTIFIER";var fg=class extends Ci(ms){constructor({valueDec:e=0,...r}={}){super(r),this.valueDec=e}fromBER(e,r,n){if(n===0)return r;let o=He.BufferSourceConverter.toUint8Array(e);if(!gs(this,o,r,n))return-1;let i=o.subarray(r,r+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ft.utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),r+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let r=ft.utilToBase(this.valueDec,7);if(r.byteLength===0)return this.error="Error during encoding SID value",Pi;let n=new Uint8Array(r.byteLength);if(!e){let o=new Uint8Array(r),i=r.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n.buffer}toString(){let e="";return this.isHexOnly?e=He.Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};fg.NAME="relativeSidBlock";var zx=class extends Br{constructor({value:e=Cn,...r}={}){super(r),this.value=[],e&&this.fromString(e)}fromBER(e,r,n){let o=r;for(;n>0;){let i=new fg;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e,r){let n=[];for(let o=0;o<this.value.length;o++){let i=this.value[o].toBER(e);if(i.byteLength===0)return this.error=this.value[o].error,Pi;n.push(i)}return Sj(n)}fromString(e){this.value=[];let r=0,n=0,o="";do{n=e.indexOf(".",r),n===-1?o=e.substring(r):o=e.substring(r,n),r=n+1;let i=new fg;if(i.valueDec=parseInt(o,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let e="",r=!1;for(let n=0;n<this.value.length;n++){r=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),r&&(o=`{${o}}`),e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}};zx.NAME="RelativeObjectIdentifierValueBlock";var R3,mg=class extends Ar{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,zx),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};R3=mg;Y.RelativeObjectIdentifier=R3;mg.NAME="RelativeObjectIdentifier";var z3,hg=class extends hs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};z3=hg;Y.Sequence=z3;hg.NAME="SEQUENCE";var M3,gg=class extends hs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};M3=gg;Y.Set=M3;gg.NAME="SET";var Mx=class extends Ci(Br){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Cn}toJSON(){return{...super.toJSON(),value:this.value}}};Mx.NAME="StringValueBlock";var Dx=class extends Mx{};Dx.NAME="SimpleStringValueBlock";var fn=class extends rg{constructor({...e}={}){super(e,Dx)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,He.BufferSourceConverter.toUint8Array(e))}fromString(e){let r=e.length,n=this.valueBlock.valueHexView=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e.charCodeAt(o);this.valueBlock.value=e}};fn.NAME="SIMPLE STRING";var qx=class extends fn{fromBuffer(e){this.valueBlock.valueHexView=He.BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=He.Convert.ToUtf8String(e)}catch(r){this.warnings.push(`Error during "decodeURIComponent": ${r}, using raw string`),this.valueBlock.value=He.Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(He.Convert.FromUtf8String(e)),this.valueBlock.value=e}};qx.NAME="Utf8StringValueBlock";var D3,$i=class extends qx{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};D3=$i;Y.Utf8String=D3;$i.NAME="UTF8String";var Bx=class extends fn{fromBuffer(e){this.valueBlock.value=He.Convert.ToUtf16String(e),this.valueBlock.valueHexView=He.BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(He.Convert.FromUtf16String(e))}};Bx.NAME="BmpStringValueBlock";var q3,yg=class extends Bx{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};q3=yg;Y.BmpString=q3;yg.NAME="BMPString";var Ux=class extends fn{fromBuffer(e){let r=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(r);for(let o=0;o<n.length;o+=4)n[o]=n[o+3],n[o+1]=n[o+2],n[o+2]=0,n[o+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(r))}fromString(e){let r=e.length,n=this.valueBlock.valueHexView=new Uint8Array(r*4);for(let o=0;o<r;o++){let i=ft.utilToBase(e.charCodeAt(o),8),s=new Uint8Array(i);if(s.length>4)continue;let a=4-s.length;for(let c=s.length-1;c>=0;c--)n[o*4+c+a]=s[c]}this.valueBlock.value=e}};Ux.NAME="UniversalStringValueBlock";var B3,vg=class extends Ux{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};B3=vg;Y.UniversalString=B3;vg.NAME="UniversalString";var U3,bg=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};U3=bg;Y.NumericString=U3;bg.NAME="NumericString";var L3,_g=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};L3=_g;Y.PrintableString=L3;_g.NAME="PrintableString";var F3,wg=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};F3=wg;Y.TeletexString=F3;wg.NAME="TeletexString";var V3,xg=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};V3=xg;Y.VideotexString=V3;xg.NAME="VideotexString";var H3,Sg=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};H3=Sg;Y.IA5String=H3;Sg.NAME="IA5String";var G3,kg=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};G3=kg;Y.GraphicString=G3;kg.NAME="GraphicString";var W3,Sd=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};W3=Sd;Y.VisibleString=W3;Sd.NAME="VisibleString";var Z3,Ag=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};Z3=Ag;Y.GeneralString=Z3;Ag.NAME="GeneralString";var K3,$g=class extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};K3=$g;Y.CharacterString=K3;$g.NAME="CharacterString";var J3,kd=class extends Sd{constructor({value:e,valueDate:r,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let o=0;o<e.length;o++)this.valueBlock.valueHexView[o]=e.charCodeAt(o)}r&&(this.fromDate(r),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,He.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),r=new ArrayBuffer(e.length),n=new Uint8Array(r);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return r}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let o=parseInt(n[1],10);o>=50?this.year=1900+o:this.year=2e3+o,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let r=new Array(7);return r[0]=ft.padNumber(this.year<2e3?this.year-1900:this.year-2e3,2),r[1]=ft.padNumber(this.month,2),r[2]=ft.padNumber(this.day,2),r[3]=ft.padNumber(this.hour,2),r[4]=ft.padNumber(this.minute,2),r[5]=ft.padNumber(this.second,2),r[6]="Z",r.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};J3=kd;Y.UTCTime=J3;kd.NAME="UTCTime";var Y3,Pg=class extends kd{constructor(e={}){var r;super(e),(r=this.millisecond)!==null&&r!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){let e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let r=!1,n="",o="",i=0,s,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),r=!0;else{let d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,p=n.indexOf("+"),f="";if(p===-1&&(p=n.indexOf("-"),d=-1),p!==-1){if(f=n.substring(p+1),n=n.substring(0,p),f.length!==2&&f.length!==4)throw new Error("Wrong input string for conversion");let m=parseInt(f.substring(0,2),10);if(isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");if(a=d*m,f.length===4){if(m=parseInt(f.substring(2,4),10),isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");c=d*m}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){let d=new Number(`0${n.substring(l)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");i=d.valueOf(),o=n.substring(0,l)}else o=n;switch(!0){case o.length===8:if(s=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case o.length===10:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case o.length===12:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case o.length===14:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=1e3*i;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}let u=s.exec(o);if(u===null)throw new Error("Wrong input string for conversion");for(let d=1;d<u.length;d++)switch(d){case 1:this.year=parseInt(u[d],10);break;case 2:this.month=parseInt(u[d],10);break;case 3:this.day=parseInt(u[d],10);break;case 4:this.hour=parseInt(u[d],10)+a;break;case 5:this.minute=parseInt(u[d],10)+c;break;case 6:this.second=parseInt(u[d],10);break;default:throw new Error("Wrong input string for conversion")}if(r===!1){let d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let r=[];return r.push(ft.padNumber(this.year,4)),r.push(ft.padNumber(this.month,2)),r.push(ft.padNumber(this.day,2)),r.push(ft.padNumber(this.hour,2)),r.push(ft.padNumber(this.minute,2)),r.push(ft.padNumber(this.second,2)),this.millisecond!==0&&(r.push("."),r.push(ft.padNumber(this.millisecond,3))),r.push("Z"),r.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};Y3=Pg;Y.GeneralizedTime=Y3;Pg.NAME="GeneralizedTime";var Q3,Cg=class extends $i{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};Q3=Cg;Y.DATE=Q3;Cg.NAME="DATE";var X3,Ig=class extends $i{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};X3=Ig;Y.TimeOfDay=X3;Ig.NAME="TimeOfDay";var eG,Tg=class extends $i{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};eG=Tg;Y.DateTime=eG;Tg.NAME="DateTime";var tG,Eg=class extends $i{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};tG=Eg;Y.Duration=tG;Eg.NAME="Duration";var rG,Og=class extends $i{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};rG=Og;Y.TIME=rG;Og.NAME="TIME";var Cc=class{constructor({name:e=Cn,optional:r=!1}={}){this.name=e,this.optional=r}},Lx=class extends Cc{constructor({value:e=[],...r}={}){super(r),this.value=e}},jg=class extends Cc{constructor({value:e=new Cc,local:r=!1,...n}={}){super(n),this.value=e,this.local=r}},xj=class{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=He.BufferSourceConverter.toUint8Array(e)}constructor({data:e=Fx}={}){this.dataView=He.BufferSourceConverter.toUint8Array(e)}fromBER(e,r,n){let o=r+n;return this.dataView=He.BufferSourceConverter.toUint8Array(e).subarray(r,o),o}toBER(e){return this.dataView.slice().buffer}};function _d(t,e,r){if(r instanceof Lx){for(let i of r.value)if(_d(t,e,i).verified)return{verified:!0,result:t};{let i={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(wj)&&(i.name=r.name),i}}if(r instanceof Cc)return r.hasOwnProperty(wj)&&(t[r.name]=e),{verified:!0,result:t};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(qfe in r))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(Ffe in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(Vfe in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=r.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(r.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(r.idBlock.hasOwnProperty(Bfe)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:t};if(r.idBlock.hasOwnProperty(Ufe)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:t};if(r.idBlock.hasOwnProperty(Lfe)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:t};if(!(Dfe in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:t};if(r.idBlock.isHexOnly){if(!(_3 in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=r.idBlock.valueHexView,s=e.idBlock.valueHexView;if(i.length!==s.length)return{verified:!1,result:t};for(let a=0;a<i.length;a++)if(i[a]!==s[1])return{verified:!1,result:t}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Cn),r.name&&(t[r.name]=e)),r instanceof Y.Constructed){let i=0,s={verified:!1,result:{error:"Unknown error"}},a=r.valueBlock.value.length;if(a>0&&r.valueBlock.value[0]instanceof jg&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:t};if(e.valueBlock.value.length===0&&r.valueBlock.value.length!==0){let c=!0;for(let l=0;l<r.valueBlock.value.length;l++)c=c&&(r.valueBlock.value[l].optional||!1);return c?{verified:!0,result:t}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Cn),r.name&&delete t[r.name]),t.error="Inconsistent object length",{verified:!1,result:t})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(r.valueBlock.value[c].optional===!1){let l={verified:!1,result:t};return t.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Cn),r.name&&(delete t[r.name],l.name=r.name)),l}}else if(r.valueBlock.value[0]instanceof jg){if(s=_d(t,e.valueBlock.value[c],r.valueBlock.value[0].value),s.verified===!1)if(r.valueBlock.value[0].optional)i++;else return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Cn),r.name&&delete t[r.name]),s;if(wj in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let l={};Hfe in r.valueBlock.value[0]&&r.valueBlock.value[0].local?l=e:l=t,typeof l[r.valueBlock.value[0].name]>"u"&&(l[r.valueBlock.value[0].name]=[]),l[r.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(s=_d(t,e.valueBlock.value[c-i],r.valueBlock.value[c]),s.verified===!1)if(r.valueBlock.value[c].optional)i++;else return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Cn),r.name&&delete t[r.name]),s;if(s.verified===!1){let c={verified:!1,result:t};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Cn),r.name&&(delete t[r.name],c.name=r.name)),c}return{verified:!0,result:t}}if(r.primitiveSchema&&_3 in e.valueBlock){let i=Ad(e.valueBlock.valueHexView);if(i.offset===-1){let s={verified:!1,result:i.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Cn),r.name&&(delete t[r.name],s.name=r.name)),s}return _d(t,i.result,r.primitiveSchema)}return{verified:!0,result:t}}function Yfe(t,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let r=Ad(He.BufferSourceConverter.toUint8Array(t));return r.offset===-1?{verified:!1,result:r.result}:_d(r.result,r.result,e)}$e.Any=Cc;$e.BaseBlock=Ar;$e.BaseStringBlock=rg;$e.BitString=cg;$e.BmpString=yg;$e.Boolean=sg;$e.CharacterString=$g;$e.Choice=Lx;$e.Constructed=hs;$e.DATE=Cg;$e.DateTime=Tg;$e.Duration=Eg;$e.EndOfContent=og;$e.Enumerated=ug;$e.GeneralString=Ag;$e.GeneralizedTime=Pg;$e.GraphicString=kg;$e.HexBlock=Ci;$e.IA5String=Sg;$e.Integer=xd;$e.Null=ig;$e.NumericString=bg;$e.ObjectIdentifier=pg;$e.OctetString=ag;$e.Primitive=ng;$e.PrintableString=_g;$e.RawData=xj;$e.RelativeObjectIdentifier=mg;$e.Repeated=jg;$e.Sequence=hg;$e.Set=gg;$e.TIME=Og;$e.TeletexString=wg;$e.TimeOfDay=Ig;$e.UTCTime=kd;$e.UniversalString=vg;$e.Utf8String=$i;$e.ValueBlock=Br;$e.VideotexString=xg;$e.ViewWriter=wd;$e.VisibleString=Sd;$e.compareSchema=_d;$e.fromBER=Wfe;$e.verifySchema=Yfe});var Ic=y($d=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});$d.AsnPropTypes=$d.AsnTypeTypes=void 0;var nG;(function(t){t[t.Sequence=0]="Sequence",t[t.Set=1]="Set",t[t.Choice=2]="Choice"})(nG||($d.AsnTypeTypes=nG={}));var oG;(function(t){t[t.Any=1]="Any",t[t.Boolean=2]="Boolean",t[t.OctetString=3]="OctetString",t[t.BitString=4]="BitString",t[t.Integer=5]="Integer",t[t.Enumerated=6]="Enumerated",t[t.ObjectIdentifier=7]="ObjectIdentifier",t[t.Utf8String=8]="Utf8String",t[t.BmpString=9]="BmpString",t[t.UniversalString=10]="UniversalString",t[t.NumericString=11]="NumericString",t[t.PrintableString=12]="PrintableString",t[t.TeletexString=13]="TeletexString",t[t.VideotexString=14]="VideotexString",t[t.IA5String=15]="IA5String",t[t.GraphicString=16]="GraphicString",t[t.VisibleString=17]="VisibleString",t[t.GeneralString=18]="GeneralString",t[t.CharacterString=19]="CharacterString",t[t.UTCTime=20]="UTCTime",t[t.GeneralizedTime=21]="GeneralizedTime",t[t.DATE=22]="DATE",t[t.TimeOfDay=23]="TimeOfDay",t[t.DateTime=24]="DateTime",t[t.Duration=25]="Duration",t[t.TIME=26]="TIME",t[t.Null=27]="Null"})(oG||($d.AsnPropTypes=oG={}))});var sG=y(Vx=>{"use strict";Object.defineProperty(Vx,"__esModule",{value:!0});Vx.BitString=void 0;var Aj=ya(),iG=fs(),$j=class{constructor(e,r=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(iG.BufferSourceConverter.isBufferSource(e))this.unusedBits=r,this.value=iG.BufferSourceConverter.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Aj.BitString))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Aj.BitString({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Aj.BitString({name:e})}toNumber(){let e="",r=new Uint8Array(this.value);for(let n of r)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let r=e.toString(2),n=r.length+7>>3;this.unusedBits=(n<<3)-r.length;let o=new Uint8Array(n);r=r.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)o[i]=parseInt(r.slice(i<<3,(i<<3)+8),2),i++;this.value=o.buffer}};Vx.BitString=$j});var cG=y(Hx=>{"use strict";Object.defineProperty(Hx,"__esModule",{value:!0});Hx.OctetString=void 0;var Pj=ya(),aG=fs(),Cj=class{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):aG.BufferSourceConverter.isBufferSource(e)?this.buffer=aG.BufferSourceConverter.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof Pj.OctetString))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new Pj.OctetString({valueHex:this.buffer})}toSchema(e){return new Pj.OctetString({name:e})}};Hx.OctetString=Cj});var Ij=y(Gx=>{"use strict";Object.defineProperty(Gx,"__esModule",{value:!0});var lG=(E(),I(T));lG.__exportStar(sG(),Gx);lG.__exportStar(cG(),Gx)});var Ng=y(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.AsnNullConverter=Z.AsnGeneralizedTimeConverter=Z.AsnUTCTimeConverter=Z.AsnCharacterStringConverter=Z.AsnGeneralStringConverter=Z.AsnVisibleStringConverter=Z.AsnGraphicStringConverter=Z.AsnIA5StringConverter=Z.AsnVideotexStringConverter=Z.AsnTeletexStringConverter=Z.AsnPrintableStringConverter=Z.AsnNumericStringConverter=Z.AsnUniversalStringConverter=Z.AsnBmpStringConverter=Z.AsnUtf8StringConverter=Z.AsnConstructedOctetStringConverter=Z.AsnOctetStringConverter=Z.AsnBooleanConverter=Z.AsnObjectIdentifierConverter=Z.AsnBitStringConverter=Z.AsnIntegerBigIntConverter=Z.AsnIntegerArrayBufferConverter=Z.AsnEnumeratedConverter=Z.AsnIntegerConverter=Z.AsnAnyConverter=void 0;Z.defaultConverter=Xfe;var Et=ya(),Xt=Ic(),Qfe=Ij();Z.AsnAnyConverter={fromASN:t=>t instanceof Et.Null?null:t.valueBeforeDecodeView,toASN:t=>{if(t===null)return new Et.Null;let e=Et.fromBER(t);if(e.result.error)throw new Error(e.result.error);return e.result}};Z.AsnIntegerConverter={fromASN:t=>t.valueBlock.valueHexView.byteLength>=4?t.valueBlock.toString():t.valueBlock.valueDec,toASN:t=>new Et.Integer({value:+t})};Z.AsnEnumeratedConverter={fromASN:t=>t.valueBlock.valueDec,toASN:t=>new Et.Enumerated({value:t})};Z.AsnIntegerArrayBufferConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new Et.Integer({valueHex:t})};Z.AsnIntegerBigIntConverter={fromASN:t=>t.toBigInt(),toASN:t=>Et.Integer.fromBigInt(t)};Z.AsnBitStringConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new Et.BitString({valueHex:t})};Z.AsnObjectIdentifierConverter={fromASN:t=>t.valueBlock.toString(),toASN:t=>new Et.ObjectIdentifier({value:t})};Z.AsnBooleanConverter={fromASN:t=>t.valueBlock.value,toASN:t=>new Et.Boolean({value:t})};Z.AsnOctetStringConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new Et.OctetString({valueHex:t})};Z.AsnConstructedOctetStringConverter={fromASN:t=>new Qfe.OctetString(t.getValue()),toASN:t=>t.toASN()};function vo(t){return{fromASN:e=>e.valueBlock.value,toASN:e=>new t({value:e})}}Z.AsnUtf8StringConverter=vo(Et.Utf8String);Z.AsnBmpStringConverter=vo(Et.BmpString);Z.AsnUniversalStringConverter=vo(Et.UniversalString);Z.AsnNumericStringConverter=vo(Et.NumericString);Z.AsnPrintableStringConverter=vo(Et.PrintableString);Z.AsnTeletexStringConverter=vo(Et.TeletexString);Z.AsnVideotexStringConverter=vo(Et.VideotexString);Z.AsnIA5StringConverter=vo(Et.IA5String);Z.AsnGraphicStringConverter=vo(Et.GraphicString);Z.AsnVisibleStringConverter=vo(Et.VisibleString);Z.AsnGeneralStringConverter=vo(Et.GeneralString);Z.AsnCharacterStringConverter=vo(Et.CharacterString);Z.AsnUTCTimeConverter={fromASN:t=>t.toDate(),toASN:t=>new Et.UTCTime({valueDate:t})};Z.AsnGeneralizedTimeConverter={fromASN:t=>t.toDate(),toASN:t=>new Et.GeneralizedTime({valueDate:t})};Z.AsnNullConverter={fromASN:()=>null,toASN:()=>new Et.Null};function Xfe(t){switch(t){case Xt.AsnPropTypes.Any:return Z.AsnAnyConverter;case Xt.AsnPropTypes.BitString:return Z.AsnBitStringConverter;case Xt.AsnPropTypes.BmpString:return Z.AsnBmpStringConverter;case Xt.AsnPropTypes.Boolean:return Z.AsnBooleanConverter;case Xt.AsnPropTypes.CharacterString:return Z.AsnCharacterStringConverter;case Xt.AsnPropTypes.Enumerated:return Z.AsnEnumeratedConverter;case Xt.AsnPropTypes.GeneralString:return Z.AsnGeneralStringConverter;case Xt.AsnPropTypes.GeneralizedTime:return Z.AsnGeneralizedTimeConverter;case Xt.AsnPropTypes.GraphicString:return Z.AsnGraphicStringConverter;case Xt.AsnPropTypes.IA5String:return Z.AsnIA5StringConverter;case Xt.AsnPropTypes.Integer:return Z.AsnIntegerConverter;case Xt.AsnPropTypes.Null:return Z.AsnNullConverter;case Xt.AsnPropTypes.NumericString:return Z.AsnNumericStringConverter;case Xt.AsnPropTypes.ObjectIdentifier:return Z.AsnObjectIdentifierConverter;case Xt.AsnPropTypes.OctetString:return Z.AsnOctetStringConverter;case Xt.AsnPropTypes.PrintableString:return Z.AsnPrintableStringConverter;case Xt.AsnPropTypes.TeletexString:return Z.AsnTeletexStringConverter;case Xt.AsnPropTypes.UTCTime:return Z.AsnUTCTimeConverter;case Xt.AsnPropTypes.UniversalString:return Z.AsnUniversalStringConverter;case Xt.AsnPropTypes.Utf8String:return Z.AsnUtf8StringConverter;case Xt.AsnPropTypes.VideotexString:return Z.AsnVideotexStringConverter;case Xt.AsnPropTypes.VisibleString:return Z.AsnVisibleStringConverter;default:return null}}});var Wx=y(Rg=>{"use strict";Object.defineProperty(Rg,"__esModule",{value:!0});Rg.isConvertible=uG;Rg.isTypeOfArray=dG;Rg.isArrayEqual=eme;function uG(t){return typeof t=="function"&&t.prototype?t.prototype.toASN&&t.prototype.fromASN?!0:uG(t.prototype):!!(t&&typeof t=="object"&&"toASN"in t&&"fromASN"in t)}function dG(t){var e;if(t){let r=Object.getPrototypeOf(t);return((e=r?.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:dG(r)}return!1}function eme(t,e){if(!(t&&e)||t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<t.byteLength;o++)if(r[o]!==n[o])return!1;return!0}});var fG=y(Zx=>{"use strict";Object.defineProperty(Zx,"__esModule",{value:!0});Zx.AsnSchemaStorage=void 0;var Zn=ya(),Pd=Ic(),pG=Wx(),Tj=class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,r=!1){let n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(r&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){let r=this.get(e);r.schema||(r.schema=this.create(e,!0))}createDefault(e){let r={type:Pd.AsnTypeTypes.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(r,n),r.items=Object.assign({},r.items,n.items)),r}create(e,r){let n=this.items.get(e)||this.createDefault(e),o=[];for(let i in n.items){let s=n.items[i],a=r?i:"",c;if(typeof s.type=="number"){let u=Pd.AsnPropTypes[s.type],d=Zn[u];if(!d)throw new Error(`Cannot get ASN1 class by name '${u}'`);c=new d({name:a})}else(0,pG.isConvertible)(s.type)?c=new s.type().toSchema(a):s.optional?this.get(s.type).type===Pd.AsnTypeTypes.Choice?c=new Zn.Any({name:a}):(c=this.create(s.type,!1),c.name=a):c=new Zn.Any({name:a});let l=!!s.optional||s.defaultValue!==void 0;if(s.repeated){c.name="";let u=s.repeated==="set"?Zn.Set:Zn.Sequence;c=new u({name:"",value:[new Zn.Repeated({name:a,value:c})]})}if(s.context!==null&&s.context!==void 0)if(s.implicit)if(typeof s.type=="number"||(0,pG.isConvertible)(s.type)){let u=s.repeated?Zn.Constructed:Zn.Primitive;o.push(new u({name:a,optional:l,idBlock:{tagClass:3,tagNumber:s.context}}))}else{this.cache(s.type);let u=!!s.repeated,d=u?c:this.get(s.type,!0).schema;d="valueBlock"in d?d.valueBlock.value:d.value,o.push(new Zn.Constructed({name:u?"":a,optional:l,idBlock:{tagClass:3,tagNumber:s.context},value:d}))}else o.push(new Zn.Constructed({optional:l,idBlock:{tagClass:3,tagNumber:s.context},value:[c]}));else c.optional=l,o.push(c)}switch(n.type){case Pd.AsnTypeTypes.Sequence:return new Zn.Sequence({value:o,name:""});case Pd.AsnTypeTypes.Set:return new Zn.Set({value:o,name:""});case Pd.AsnTypeTypes.Choice:return new Zn.Choice({value:o,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,r){return this.items.set(e,r),this}findParentSchema(e){let r=Object.getPrototypeOf(e);return r?this.items.get(r)||this.findParentSchema(r):null}};Zx.AsnSchemaStorage=Tj});var Jx=y(Kx=>{"use strict";Object.defineProperty(Kx,"__esModule",{value:!0});Kx.schemaStorage=void 0;var tme=fG();Kx.schemaStorage=new tme.AsnSchemaStorage});var mG=y(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.AsnProp=mn.AsnSequenceType=mn.AsnSetType=mn.AsnChoiceType=mn.AsnType=void 0;var rme=Ng(),Ej=Ic(),va=Jx(),nme=t=>e=>{let r;va.schemaStorage.has(e)?r=va.schemaStorage.get(e):(r=va.schemaStorage.createDefault(e),va.schemaStorage.set(e,r)),Object.assign(r,t)};mn.AsnType=nme;var ome=()=>(0,mn.AsnType)({type:Ej.AsnTypeTypes.Choice});mn.AsnChoiceType=ome;var ime=t=>(0,mn.AsnType)({type:Ej.AsnTypeTypes.Set,...t});mn.AsnSetType=ime;var sme=t=>(0,mn.AsnType)({type:Ej.AsnTypeTypes.Sequence,...t});mn.AsnSequenceType=sme;var ame=t=>(e,r)=>{let n;va.schemaStorage.has(e.constructor)?n=va.schemaStorage.get(e.constructor):(n=va.schemaStorage.createDefault(e.constructor),va.schemaStorage.set(e.constructor,n));let o=Object.assign({},t);if(typeof o.type=="number"&&!o.converter){let i=rme.defaultConverter(t.type);if(!i)throw new Error(`Cannot get default converter for property '${r}' of ${e.constructor.name}`);o.converter=i}o.raw=t.raw,n.items[r]=o};mn.AsnProp=ame});var hG=y(Yx=>{"use strict";Object.defineProperty(Yx,"__esModule",{value:!0});Yx.AsnSchemaValidationError=void 0;var Oj=class extends Error{constructor(){super(...arguments),this.schemas=[]}};Yx.AsnSchemaValidationError=Oj});var Nj=y(jj=>{"use strict";Object.defineProperty(jj,"__esModule",{value:!0});var cme=(E(),I(T));cme.__exportStar(hG(),jj)});var Mj=y(Qx=>{"use strict";Object.defineProperty(Qx,"__esModule",{value:!0});Qx.AsnParser=void 0;var In=ya(),ba=Ic(),Rj=Ng(),zg=Nj(),Mg=Wx(),Tc=Jx(),zj=class{static parse(e,r){let n=In.fromBER(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,r)}static fromASN(e,r){try{if((0,Mg.isConvertible)(r))return new r().fromASN(e);let n=Tc.schemaStorage.get(r);Tc.schemaStorage.cache(r);let o=n.schema,i=this.handleChoiceTypes(e,n,r,o);if(i?.result)return i.result;i?.targetSchema&&(o=i.targetSchema);let s=this.handleSequenceTypes(e,n,r,o),a=new r;return(0,Mg.isTypeOfArray)(r)?this.handleArrayTypes(e,n,r):(this.processSchemaItems(n,s,a),a)}catch(n){throw n instanceof zg.AsnSchemaValidationError&&n.schemas.push(r.name),n}}static handleChoiceTypes(e,r,n,o){if(e.constructor===In.Constructed&&r.type===ba.AsnTypeTypes.Choice&&e.idBlock.tagClass===3)for(let i in r.items){let s=r.items[i];if(s.context===e.idBlock.tagNumber&&s.implicit&&typeof s.type=="function"&&Tc.schemaStorage.has(s.type)){let a=Tc.schemaStorage.get(s.type);if(a&&a.type===ba.AsnTypeTypes.Sequence){let c=new In.Sequence;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in c.valueBlock){c.valueBlock.value=e.valueBlock.value;let l=this.fromASN(c,s.type),u=new n;return u[i]=l,{result:u}}}}}else if(e.constructor===In.Constructed&&r.type!==ba.AsnTypeTypes.Choice){let i=new In.Constructed({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:r.schema.valueBlock.value});for(let s in r.items)delete e[s];return{targetSchema:i}}return null}static handleSequenceTypes(e,r,n,o){if(r.type===ba.AsnTypeTypes.Sequence){let i=In.compareSchema({},e,o);if(!i.verified)throw new zg.AsnSchemaValidationError(`Data does not match to ${n.name} ASN1 schema.${i.result.error?` ${i.result.error}`:""}`);return i}else{let i=In.compareSchema({},e,o);if(!i.verified)throw new zg.AsnSchemaValidationError(`Data does not match to ${n.name} ASN1 schema.${i.result.error?` ${i.result.error}`:""}`);return i}}static processRepeatedField(e,r,n){let o=e.slice(r);if(o.length===1&&o[0].constructor.name==="Sequence"){let i=o[0];i.valueBlock&&i.valueBlock.value&&Array.isArray(i.valueBlock.value)&&(o=i.valueBlock.value)}if(typeof n.type=="number"){let i=Rj.defaultConverter(n.type);if(!i)throw new Error(`No converter for ASN.1 type ${n.type}`);return o.filter(s=>s&&s.valueBlock).map(s=>{try{return i.fromASN(s)}catch{return}}).filter(s=>s!==void 0)}else return o.filter(i=>i&&i.valueBlock).map(i=>{try{return this.fromASN(i,n.type)}catch{return}}).filter(i=>i!==void 0)}static processPrimitiveField(e,r){let n=Rj.defaultConverter(r.type);if(!n)throw new Error(`No converter for ASN.1 type ${r.type}`);return n.fromASN(e)}static isOptionalChoiceField(e){return e.optional&&typeof e.type=="function"&&Tc.schemaStorage.has(e.type)&&Tc.schemaStorage.get(e.type).type===ba.AsnTypeTypes.Choice}static processOptionalChoiceField(e,r){try{return{processed:!0,value:this.fromASN(e,r.type)}}catch(n){if(n instanceof zg.AsnSchemaValidationError&&/Wrong values for Choice type/.test(n.message))return{processed:!1};throw n}}static handleArrayTypes(e,r,n){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let o=r.itemType;if(typeof o=="number"){let i=Rj.defaultConverter(o);if(!i)throw new Error(`Cannot get default converter for array item of ${n.name} ASN1 schema`);return n.from(e.valueBlock.value,s=>i.fromASN(s))}else return n.from(e.valueBlock.value,i=>this.fromASN(i,o))}static processSchemaItems(e,r,n){for(let o in e.items){let i=r.result[o];if(!i)continue;let s=e.items[o],a=s.type,c;typeof a=="number"||(0,Mg.isConvertible)(a)?c=this.processPrimitiveSchemaItem(i,s,a):c=this.processComplexSchemaItem(i,s,a),c&&typeof c=="object"&&"value"in c&&"raw"in c?(n[o]=c.value,n[`${o}Raw`]=c.raw):n[o]=c}}static processPrimitiveSchemaItem(e,r,n){var o;let i=(o=r.converter)!==null&&o!==void 0?o:(0,Mg.isConvertible)(n)?new n:null;if(!i)throw new Error("Converter is empty");return r.repeated?this.processRepeatedPrimitiveItem(e,r,i):this.processSinglePrimitiveItem(e,r,n,i)}static processRepeatedPrimitiveItem(e,r,n){if(r.implicit){let o=r.repeated==="sequence"?In.Sequence:In.Set,i=new o;i.valueBlock=e.valueBlock;let s=In.fromBER(i.toBER(!1));if(s.offset===-1)throw new Error(`Cannot parse the child item. ${s.result.error}`);if(!("value"in s.result.valueBlock&&Array.isArray(s.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let a=s.result.valueBlock.value;return Array.from(a,c=>n.fromASN(c))}else return Array.from(e,o=>n.fromASN(o))}static processSinglePrimitiveItem(e,r,n,o){let i=e;if(r.implicit){let s;if((0,Mg.isConvertible)(n))s=new n().toSchema("");else{let a=ba.AsnPropTypes[n],c=In[a];if(!c)throw new Error(`Cannot get '${a}' class from asn1js module`);s=new c}s.valueBlock=i.valueBlock,i=In.fromBER(s.toBER(!1)).result}return o.fromASN(i)}static processComplexSchemaItem(e,r,n){if(r.repeated){if(!Array.isArray(e))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");return Array.from(e,o=>this.fromASN(o,n))}else{let o=this.handleImplicitTagging(e,r,n);if(this.isOptionalChoiceField(r))try{return this.fromASN(o,n)}catch(i){if(i instanceof zg.AsnSchemaValidationError&&/Wrong values for Choice type/.test(i.message))return;throw i}else{let i=this.fromASN(o,n);return r.raw?{value:i,raw:e.valueBeforeDecodeView}:i}}}static handleImplicitTagging(e,r,n){if(r.implicit&&typeof r.context=="number"){let o=Tc.schemaStorage.get(n);if(o.type===ba.AsnTypeTypes.Sequence){let i=new In.Sequence;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in i.valueBlock)return i.valueBlock.value=e.valueBlock.value,i}else if(o.type===ba.AsnTypeTypes.Set){let i=new In.Set;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in i.valueBlock)return i.valueBlock.value=e.valueBlock.value,i}}return e}};Qx.AsnParser=zj});var Bj=y(e0=>{"use strict";Object.defineProperty(e0,"__esModule",{value:!0});e0.AsnSerializer=void 0;var Wo=ya(),lme=Ng(),Xx=Ic(),Dj=Wx(),gG=Jx(),qj=class t{static serialize(e){return e instanceof Wo.BaseBlock?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&(0,Dj.isConvertible)(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");let r=e.constructor,n=gG.schemaStorage.get(r);gG.schemaStorage.cache(r);let o=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){let s=lme.defaultConverter(n.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${r.name} ASN1 schema`);o=e.map(a=>s.toASN(a))}else o=e.map(s=>this.toAsnItem({type:n.itemType},"[]",r,s))}else for(let s in n.items){let a=n.items[s],c=e[s];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&(0,Dj.isArrayEqual)(this.serialize(a.defaultValue),this.serialize(c)))continue;let l=t.toAsnItem(a,s,r,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||(0,Dj.isConvertible)(a.type))){let u={};u.valueHex=l instanceof Wo.Null?l.valueBeforeDecodeView:l.valueBlock.toBER(),o.push(new Wo.Primitive({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...u}))}else o.push(new Wo.Constructed({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else o.push(new Wo.Constructed({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?o=o.concat(l):o.push(l)}let i;switch(n.type){case Xx.AsnTypeTypes.Sequence:i=new Wo.Sequence({value:o});break;case Xx.AsnTypeTypes.Set:i=new Wo.Set({value:o});break;case Xx.AsnTypeTypes.Choice:if(!o[0])throw new Error(`Schema '${r.name}' has wrong data. Choice cannot be empty.`);i=o[0];break}return i}static toAsnItem(e,r,n,o){let i;if(typeof e.type=="number"){let s=e.converter;if(!s)throw new Error(`Property '${r}' doesn't have converter for type ${Xx.AsnPropTypes[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let a=Array.from(o,l=>s.toASN(l)),c=e.repeated==="sequence"?Wo.Sequence:Wo.Set;i=new c({value:a})}else i=s.toASN(o)}else if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let s=Array.from(o,c=>this.toASN(c)),a=e.repeated==="sequence"?Wo.Sequence:Wo.Set;i=new a({value:s})}else i=this.toASN(o);return i}};e0.AsnSerializer=qj});var yG=y(t0=>{"use strict";Object.defineProperty(t0,"__esModule",{value:!0});t0.AsnArray=void 0;var Uj=class extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(let r of e)this.push(r)}}};t0.AsnArray=Uj});var bG=y(r0=>{"use strict";Object.defineProperty(r0,"__esModule",{value:!0});r0.AsnConvert=void 0;var ume=ya(),vG=fs(),dme=Mj(),pme=Bj(),Lj=class t{static serialize(e){return pme.AsnSerializer.serialize(e)}static parse(e,r){return dme.AsnParser.parse(e,r)}static toString(e){let r=vG.BufferSourceConverter.isBufferSource(e)?vG.BufferSourceConverter.toArrayBuffer(e):t.serialize(e),n=ume.fromBER(r);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}};r0.AsnConvert=Lj});var z=y(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.AsnSerializer=Bt.AsnParser=Bt.AsnPropTypes=Bt.AsnTypeTypes=Bt.AsnSetType=Bt.AsnSequenceType=Bt.AsnChoiceType=Bt.AsnType=Bt.AsnProp=void 0;var Dg=(E(),I(T));Dg.__exportStar(Ng(),Bt);Dg.__exportStar(Ij(),Bt);var qg=mG();Object.defineProperty(Bt,"AsnProp",{enumerable:!0,get:function(){return qg.AsnProp}});Object.defineProperty(Bt,"AsnType",{enumerable:!0,get:function(){return qg.AsnType}});Object.defineProperty(Bt,"AsnChoiceType",{enumerable:!0,get:function(){return qg.AsnChoiceType}});Object.defineProperty(Bt,"AsnSequenceType",{enumerable:!0,get:function(){return qg.AsnSequenceType}});Object.defineProperty(Bt,"AsnSetType",{enumerable:!0,get:function(){return qg.AsnSetType}});var _G=Ic();Object.defineProperty(Bt,"AsnTypeTypes",{enumerable:!0,get:function(){return _G.AsnTypeTypes}});Object.defineProperty(Bt,"AsnPropTypes",{enumerable:!0,get:function(){return _G.AsnPropTypes}});var fme=Mj();Object.defineProperty(Bt,"AsnParser",{enumerable:!0,get:function(){return fme.AsnParser}});var mme=Bj();Object.defineProperty(Bt,"AsnSerializer",{enumerable:!0,get:function(){return mme.AsnSerializer}});Dg.__exportStar(Nj(),Bt);Dg.__exportStar(yG(),Bt);Dg.__exportStar(bG(),Bt)});var wG=y(n0=>{"use strict";Object.defineProperty(n0,"__esModule",{value:!0});n0.IpConverter=void 0;var hme=fs(),Fj=class{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){let r=e.split(".");if(r.length!==4)throw new Error("Invalid IPv4 address");return r.map(n=>{let o=parseInt(n,10);if(isNaN(o)||o<0||o>255)throw new Error("Invalid IPv4 address part");return o})}static parseIPv6(e){let n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((o,i)=>{let s=parseInt(i,16);if(isNaN(s)||s<0||s>65535)throw new Error("Invalid IPv6 address part");return o.push(s>>8&255),o.push(s&255),o},[])}static expandIPv6(e){if(!e.includes("::"))return e;let r=e.split("::");if(r.length>2)throw new Error("Invalid IPv6 address");let n=r[0]?r[0].split(":"):[],o=r[1]?r[1].split(":"):[],i=8-(n.length+o.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...o].join(":")}static formatIPv6(e){let r=[];for(let n=0;n<16;n+=2)r.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(r.join(":"))}static compressIPv6(e){let r=e.split(":"),n=-1,o=0,i=-1,s=0;for(let a=0;a<r.length;a++)r[a]==="0"?(i===-1&&(i=a),s++):(s>o&&(n=i,o=s),i=-1,s=0);if(s>o&&(n=i,o=s),o>1){let a=r.slice(0,n).join(":"),c=r.slice(n+o).join(":");return`${a}::${c}`}return e}static parseCIDR(e){let[r,n]=e.split("/"),o=parseInt(n,10);if(this.isIPv4(r)){if(o<0||o>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(r),o]}else{if(o<0||o>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(r),o]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;let r=parseInt(e.slice(8),16).toString(2).split("").reduce((o,i)=>o+ +i,0),n=e.slice(0,8).replace(/(.{2})/g,o=>`${parseInt(o,16)}.`);return n=n.slice(0,-1),`${n}/${r}`}static toString(e){let r=new Uint8Array(e);if(r.length===4)return Array.from(r).join(".");if(r.length===16)return this.formatIPv6(r);if(r.length===8||r.length===32){let n=r.length/2,o=r.slice(0,n),i=r.slice(n);if(r.every(c=>c===0))return r.length===8?"0.0.0.0/0":"::/0";let a=i.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return r.length===8?`${Array.from(o).join(".")}/${a}`:`${this.formatIPv6(o)}/${a}`}return this.decodeIP(hme.Convert.ToHex(e))}static fromString(e){if(e.includes("/")){let[n,o]=this.parseCIDR(e),i=new Uint8Array(n.length),s=o;for(let c=0;c<i.length;c++)s>=8?(i[c]=255,s-=8):s>0&&(i[c]=255<<8-s,s=0);let a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}let r=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(r).buffer}};n0.IpConverter=Fj});var Id=y(_r=>{"use strict";var Vj,Hj,Gj;Object.defineProperty(_r,"__esModule",{value:!0});_r.Name=_r.RDNSequence=_r.RelativeDistinguishedName=_r.AttributeTypeAndValue=_r.AttributeValue=_r.DirectoryString=void 0;var Tn=(E(),I(T)),mt=z(),gme=fs(),ys=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};_r.DirectoryString=ys;Tn.__decorate([(0,mt.AsnProp)({type:mt.AsnPropTypes.TeletexString})],ys.prototype,"teletexString",void 0);Tn.__decorate([(0,mt.AsnProp)({type:mt.AsnPropTypes.PrintableString})],ys.prototype,"printableString",void 0);Tn.__decorate([(0,mt.AsnProp)({type:mt.AsnPropTypes.UniversalString})],ys.prototype,"universalString",void 0);Tn.__decorate([(0,mt.AsnProp)({type:mt.AsnPropTypes.Utf8String})],ys.prototype,"utf8String",void 0);Tn.__decorate([(0,mt.AsnProp)({type:mt.AsnPropTypes.BmpString})],ys.prototype,"bmpString",void 0);_r.DirectoryString=ys=Tn.__decorate([(0,mt.AsnType)({type:mt.AsnTypeTypes.Choice})],ys);var Ec=class extends ys{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?gme.Convert.ToHex(this.anyValue):super.toString())}};_r.AttributeValue=Ec;Tn.__decorate([(0,mt.AsnProp)({type:mt.AsnPropTypes.IA5String})],Ec.prototype,"ia5String",void 0);Tn.__decorate([(0,mt.AsnProp)({type:mt.AsnPropTypes.Any})],Ec.prototype,"anyValue",void 0);_r.AttributeValue=Ec=Tn.__decorate([(0,mt.AsnType)({type:mt.AsnTypeTypes.Choice})],Ec);var Cd=class{constructor(e={}){this.type="",this.value=new Ec,Object.assign(this,e)}};_r.AttributeTypeAndValue=Cd;Tn.__decorate([(0,mt.AsnProp)({type:mt.AsnPropTypes.ObjectIdentifier})],Cd.prototype,"type",void 0);Tn.__decorate([(0,mt.AsnProp)({type:Ec})],Cd.prototype,"value",void 0);var o0=Vj=class extends mt.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Vj.prototype)}};_r.RelativeDistinguishedName=o0;_r.RelativeDistinguishedName=o0=Vj=Tn.__decorate([(0,mt.AsnType)({type:mt.AsnTypeTypes.Set,itemType:Cd})],o0);var i0=Hj=class extends mt.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Hj.prototype)}};_r.RDNSequence=i0;_r.RDNSequence=i0=Hj=Tn.__decorate([(0,mt.AsnType)({type:mt.AsnTypeTypes.Sequence,itemType:o0})],i0);var Wj=Gj=class extends i0{constructor(e){super(e),Object.setPrototypeOf(this,Gj.prototype)}};_r.Name=Wj;_r.Name=Wj=Gj=Tn.__decorate([(0,mt.AsnType)({type:mt.AsnTypeTypes.Sequence})],Wj)});var Oc=y(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.GeneralName=bo.EDIPartyName=bo.OtherName=bo.AsnIpConverter=void 0;var En=(E(),I(T)),Ut=z(),xG=wG(),s0=Id();bo.AsnIpConverter={fromASN:t=>xG.IpConverter.toString(Ut.AsnOctetStringConverter.fromASN(t)),toASN:t=>Ut.AsnOctetStringConverter.toASN(xG.IpConverter.fromString(t))};var Td=class{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};bo.OtherName=Td;En.__decorate([(0,Ut.AsnProp)({type:Ut.AsnPropTypes.ObjectIdentifier})],Td.prototype,"typeId",void 0);En.__decorate([(0,Ut.AsnProp)({type:Ut.AsnPropTypes.Any,context:0})],Td.prototype,"value",void 0);var Ed=class{constructor(e={}){this.partyName=new s0.DirectoryString,Object.assign(this,e)}};bo.EDIPartyName=Ed;En.__decorate([(0,Ut.AsnProp)({type:s0.DirectoryString,optional:!0,context:0,implicit:!0})],Ed.prototype,"nameAssigner",void 0);En.__decorate([(0,Ut.AsnProp)({type:s0.DirectoryString,context:1,implicit:!0})],Ed.prototype,"partyName",void 0);var _o=class{constructor(e={}){Object.assign(this,e)}};bo.GeneralName=_o;En.__decorate([(0,Ut.AsnProp)({type:Td,context:0,implicit:!0})],_o.prototype,"otherName",void 0);En.__decorate([(0,Ut.AsnProp)({type:Ut.AsnPropTypes.IA5String,context:1,implicit:!0})],_o.prototype,"rfc822Name",void 0);En.__decorate([(0,Ut.AsnProp)({type:Ut.AsnPropTypes.IA5String,context:2,implicit:!0})],_o.prototype,"dNSName",void 0);En.__decorate([(0,Ut.AsnProp)({type:Ut.AsnPropTypes.Any,context:3,implicit:!0})],_o.prototype,"x400Address",void 0);En.__decorate([(0,Ut.AsnProp)({type:s0.Name,context:4,implicit:!1})],_o.prototype,"directoryName",void 0);En.__decorate([(0,Ut.AsnProp)({type:Ed,context:5})],_o.prototype,"ediPartyName",void 0);En.__decorate([(0,Ut.AsnProp)({type:Ut.AsnPropTypes.IA5String,context:6,implicit:!0})],_o.prototype,"uniformResourceIdentifier",void 0);En.__decorate([(0,Ut.AsnProp)({type:Ut.AsnPropTypes.OctetString,context:7,implicit:!0,converter:bo.AsnIpConverter})],_o.prototype,"iPAddress",void 0);En.__decorate([(0,Ut.AsnProp)({type:Ut.AsnPropTypes.ObjectIdentifier,context:8,implicit:!0})],_o.prototype,"registeredID",void 0);bo.GeneralName=_o=En.__decorate([(0,Ut.AsnType)({type:Ut.AsnTypeTypes.Choice})],_o)});var Ot=y(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.id_ce=Ke.id_ad_caRepository=Ke.id_ad_timeStamping=Ke.id_ad_caIssuers=Ke.id_ad_ocsp=Ke.id_qt_unotice=Ke.id_qt_csp=Ke.id_ad=Ke.id_kp=Ke.id_qt=Ke.id_pe=Ke.id_pkix=void 0;Ke.id_pkix="1.3.6.1.5.5.7";Ke.id_pe=`${Ke.id_pkix}.1`;Ke.id_qt=`${Ke.id_pkix}.2`;Ke.id_kp=`${Ke.id_pkix}.3`;Ke.id_ad=`${Ke.id_pkix}.48`;Ke.id_qt_csp=`${Ke.id_qt}.1`;Ke.id_qt_unotice=`${Ke.id_qt}.2`;Ke.id_ad_ocsp=`${Ke.id_ad}.1`;Ke.id_ad_caIssuers=`${Ke.id_ad}.2`;Ke.id_ad_timeStamping=`${Ke.id_ad}.3`;Ke.id_ad_caRepository=`${Ke.id_ad}.5`;Ke.id_ce="2.5.29"});var Yj=y(vs=>{"use strict";var Zj;Object.defineProperty(vs,"__esModule",{value:!0});vs.AuthorityInfoAccessSyntax=vs.AccessDescription=vs.id_pe_authorityInfoAccess=void 0;var Jj=(E(),I(T)),Od=z(),SG=Oc(),yme=Ot();vs.id_pe_authorityInfoAccess=`${yme.id_pe}.1`;var jd=class{constructor(e={}){this.accessMethod="",this.accessLocation=new SG.GeneralName,Object.assign(this,e)}};vs.AccessDescription=jd;Jj.__decorate([(0,Od.AsnProp)({type:Od.AsnPropTypes.ObjectIdentifier})],jd.prototype,"accessMethod",void 0);Jj.__decorate([(0,Od.AsnProp)({type:SG.GeneralName})],jd.prototype,"accessLocation",void 0);var Kj=Zj=class extends Od.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Zj.prototype)}};vs.AuthorityInfoAccessSyntax=Kj;vs.AuthorityInfoAccessSyntax=Kj=Zj=Jj.__decorate([(0,Od.AsnType)({type:Od.AsnTypeTypes.Sequence,itemType:jd})],Kj)});var Xj=y(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.AuthorityKeyIdentifier=_a.KeyIdentifier=_a.id_ce_authorityKeyIdentifier=void 0;var Qj=(E(),I(T)),Nd=z(),vme=Oc(),bme=Ot();_a.id_ce_authorityKeyIdentifier=`${bme.id_ce}.35`;var a0=class extends Nd.OctetString{};_a.KeyIdentifier=a0;var Rd=class{constructor(e={}){e&&Object.assign(this,e)}};_a.AuthorityKeyIdentifier=Rd;Qj.__decorate([(0,Nd.AsnProp)({type:a0,context:0,optional:!0,implicit:!0})],Rd.prototype,"keyIdentifier",void 0);Qj.__decorate([(0,Nd.AsnProp)({type:vme.GeneralName,context:1,optional:!0,implicit:!0,repeated:"sequence"})],Rd.prototype,"authorityCertIssuer",void 0);Qj.__decorate([(0,Nd.AsnProp)({type:Nd.AsnPropTypes.Integer,context:2,optional:!0,implicit:!0,converter:Nd.AsnIntegerArrayBufferConverter})],Rd.prototype,"authorityCertSerialNumber",void 0)});var AG=y(zd=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});zd.BasicConstraints=zd.id_ce_basicConstraints=void 0;var kG=(E(),I(T)),c0=z(),_me=Ot();zd.id_ce_basicConstraints=`${_me.id_ce}.19`;var Bg=class{constructor(e={}){this.cA=!1,Object.assign(this,e)}};zd.BasicConstraints=Bg;kG.__decorate([(0,c0.AsnProp)({type:c0.AsnPropTypes.Boolean,defaultValue:!1})],Bg.prototype,"cA",void 0);kG.__decorate([(0,c0.AsnProp)({type:c0.AsnPropTypes.Integer,optional:!0})],Bg.prototype,"pathLenConstraint",void 0)});var Lg=y(Ug=>{"use strict";var eN;Object.defineProperty(Ug,"__esModule",{value:!0});Ug.GeneralNames=void 0;var wme=(E(),I(T)),$G=z(),xme=Oc(),Sme=z(),tN=eN=class extends Sme.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,eN.prototype)}};Ug.GeneralNames=tN;Ug.GeneralNames=tN=eN=wme.__decorate([(0,$G.AsnType)({type:$G.AsnTypeTypes.Sequence,itemType:xme.GeneralName})],tN)});var CG=y(jc=>{"use strict";var rN;Object.defineProperty(jc,"__esModule",{value:!0});jc.CertificateIssuer=jc.id_ce_certificateIssuer=void 0;var kme=(E(),I(T)),PG=z(),Ame=Lg(),$me=Ot();jc.id_ce_certificateIssuer=`${$me.id_ce}.29`;var nN=rN=class extends Ame.GeneralNames{constructor(e){super(e),Object.setPrototypeOf(this,rN.prototype)}};jc.CertificateIssuer=nN;jc.CertificateIssuer=nN=rN=kme.__decorate([(0,PG.AsnType)({type:PG.AsnTypeTypes.Sequence})],nN)});var IG=y(Gt=>{"use strict";var oN;Object.defineProperty(Gt,"__esModule",{value:!0});Gt.CertificatePolicies=Gt.PolicyInformation=Gt.PolicyQualifierInfo=Gt.Qualifier=Gt.UserNotice=Gt.NoticeReference=Gt.DisplayText=Gt.id_ce_certificatePolicies_anyPolicy=Gt.id_ce_certificatePolicies=void 0;var Ur=(E(),I(T)),ut=z(),Pme=Ot();Gt.id_ce_certificatePolicies=`${Pme.id_ce}.32`;Gt.id_ce_certificatePolicies_anyPolicy=`${Gt.id_ce_certificatePolicies}.0`;var Ii=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};Gt.DisplayText=Ii;Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.IA5String})],Ii.prototype,"ia5String",void 0);Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.VisibleString})],Ii.prototype,"visibleString",void 0);Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.BmpString})],Ii.prototype,"bmpString",void 0);Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.Utf8String})],Ii.prototype,"utf8String",void 0);Gt.DisplayText=Ii=Ur.__decorate([(0,ut.AsnType)({type:ut.AsnTypeTypes.Choice})],Ii);var Md=class{constructor(e={}){this.organization=new Ii,this.noticeNumbers=[],Object.assign(this,e)}};Gt.NoticeReference=Md;Ur.__decorate([(0,ut.AsnProp)({type:Ii})],Md.prototype,"organization",void 0);Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.Integer,repeated:"sequence"})],Md.prototype,"noticeNumbers",void 0);var Dd=class{constructor(e={}){Object.assign(this,e)}};Gt.UserNotice=Dd;Ur.__decorate([(0,ut.AsnProp)({type:Md,optional:!0})],Dd.prototype,"noticeRef",void 0);Ur.__decorate([(0,ut.AsnProp)({type:Ii,optional:!0})],Dd.prototype,"explicitText",void 0);var Fg=class{constructor(e={}){Object.assign(this,e)}};Gt.Qualifier=Fg;Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.IA5String})],Fg.prototype,"cPSuri",void 0);Ur.__decorate([(0,ut.AsnProp)({type:Dd})],Fg.prototype,"userNotice",void 0);Gt.Qualifier=Fg=Ur.__decorate([(0,ut.AsnType)({type:ut.AsnTypeTypes.Choice})],Fg);var qd=class{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}};Gt.PolicyQualifierInfo=qd;Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.ObjectIdentifier})],qd.prototype,"policyQualifierId",void 0);Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.Any})],qd.prototype,"qualifier",void 0);var Bd=class{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}};Gt.PolicyInformation=Bd;Ur.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.ObjectIdentifier})],Bd.prototype,"policyIdentifier",void 0);Ur.__decorate([(0,ut.AsnProp)({type:qd,repeated:"sequence",optional:!0})],Bd.prototype,"policyQualifiers",void 0);var iN=oN=class extends ut.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,oN.prototype)}};Gt.CertificatePolicies=iN;Gt.CertificatePolicies=iN=oN=Ur.__decorate([(0,ut.AsnType)({type:ut.AsnTypeTypes.Sequence,itemType:Bd})],iN)});var sN=y(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.CRLNumber=Nc.id_ce_cRLNumber=void 0;var TG=(E(),I(T)),l0=z(),Cme=Ot();Nc.id_ce_cRLNumber=`${Cme.id_ce}.20`;var u0=class{constructor(e=0){this.value=e}};Nc.CRLNumber=u0;TG.__decorate([(0,l0.AsnProp)({type:l0.AsnPropTypes.Integer})],u0.prototype,"value",void 0);Nc.CRLNumber=u0=TG.__decorate([(0,l0.AsnType)({type:l0.AsnTypeTypes.Choice})],u0)});var OG=y(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.BaseCRLNumber=Rc.id_ce_deltaCRLIndicator=void 0;var Ime=(E(),I(T)),EG=z(),Tme=Ot(),Eme=sN();Rc.id_ce_deltaCRLIndicator=`${Tme.id_ce}.27`;var aN=class extends Eme.CRLNumber{};Rc.BaseCRLNumber=aN;Rc.BaseCRLNumber=aN=Ime.__decorate([(0,EG.AsnType)({type:EG.AsnTypeTypes.Choice})],aN)});var p0=y(Qr=>{"use strict";var cN;Object.defineProperty(Qr,"__esModule",{value:!0});Qr.CRLDistributionPoints=Qr.DistributionPoint=Qr.DistributionPointName=Qr.Reason=Qr.ReasonFlags=Qr.id_ce_cRLDistributionPoints=void 0;var Mc=(E(),I(T)),Ko=z(),Ome=Id(),jG=Oc(),jme=Ot();Qr.id_ce_cRLDistributionPoints=`${jme.id_ce}.31`;var Zo;(function(t){t[t.unused=1]="unused",t[t.keyCompromise=2]="keyCompromise",t[t.cACompromise=4]="cACompromise",t[t.affiliationChanged=8]="affiliationChanged",t[t.superseded=16]="superseded",t[t.cessationOfOperation=32]="cessationOfOperation",t[t.certificateHold=64]="certificateHold",t[t.privilegeWithdrawn=128]="privilegeWithdrawn",t[t.aACompromise=256]="aACompromise"})(Zo||(Qr.ReasonFlags=Zo={}));var d0=class extends Ko.BitString{toJSON(){let e=[],r=this.toNumber();return r&Zo.aACompromise&&e.push("aACompromise"),r&Zo.affiliationChanged&&e.push("affiliationChanged"),r&Zo.cACompromise&&e.push("cACompromise"),r&Zo.certificateHold&&e.push("certificateHold"),r&Zo.cessationOfOperation&&e.push("cessationOfOperation"),r&Zo.keyCompromise&&e.push("keyCompromise"),r&Zo.privilegeWithdrawn&&e.push("privilegeWithdrawn"),r&Zo.superseded&&e.push("superseded"),r&Zo.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}};Qr.Reason=d0;var Ud=class{constructor(e={}){Object.assign(this,e)}};Qr.DistributionPointName=Ud;Mc.__decorate([(0,Ko.AsnProp)({type:jG.GeneralName,context:0,repeated:"sequence",implicit:!0})],Ud.prototype,"fullName",void 0);Mc.__decorate([(0,Ko.AsnProp)({type:Ome.RelativeDistinguishedName,context:1,implicit:!0})],Ud.prototype,"nameRelativeToCRLIssuer",void 0);Qr.DistributionPointName=Ud=Mc.__decorate([(0,Ko.AsnType)({type:Ko.AsnTypeTypes.Choice})],Ud);var zc=class{constructor(e={}){Object.assign(this,e)}};Qr.DistributionPoint=zc;Mc.__decorate([(0,Ko.AsnProp)({type:Ud,context:0,optional:!0})],zc.prototype,"distributionPoint",void 0);Mc.__decorate([(0,Ko.AsnProp)({type:d0,context:1,optional:!0,implicit:!0})],zc.prototype,"reasons",void 0);Mc.__decorate([(0,Ko.AsnProp)({type:jG.GeneralName,context:2,optional:!0,repeated:"sequence",implicit:!0})],zc.prototype,"cRLIssuer",void 0);var lN=cN=class extends Ko.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,cN.prototype)}};Qr.CRLDistributionPoints=lN;Qr.CRLDistributionPoints=lN=cN=Mc.__decorate([(0,Ko.AsnType)({type:Ko.AsnTypeTypes.Sequence,itemType:zc})],lN)});var zG=y(Dc=>{"use strict";var uN;Object.defineProperty(Dc,"__esModule",{value:!0});Dc.FreshestCRL=Dc.id_ce_freshestCRL=void 0;var Nme=(E(),I(T)),NG=z(),Rme=Ot(),RG=p0();Dc.id_ce_freshestCRL=`${Rme.id_ce}.46`;var dN=uN=class extends RG.CRLDistributionPoints{constructor(e){super(e),Object.setPrototypeOf(this,uN.prototype)}};Dc.FreshestCRL=dN;Dc.FreshestCRL=dN=uN=Nme.__decorate([(0,NG.AsnType)({type:NG.AsnTypeTypes.Sequence,itemType:RG.DistributionPoint})],dN)});var DG=y(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});Ld.IssuingDistributionPoint=Ld.id_ce_issuingDistributionPoint=void 0;var Fd=(E(),I(T)),Vd=z(),MG=p0(),zme=Ot(),f0=z();Ld.id_ce_issuingDistributionPoint=`${zme.id_ce}.28`;var On=class t{constructor(e={}){this.onlyContainsUserCerts=t.ONLY,this.onlyContainsCACerts=t.ONLY,this.indirectCRL=t.ONLY,this.onlyContainsAttributeCerts=t.ONLY,Object.assign(this,e)}};Ld.IssuingDistributionPoint=On;On.ONLY=!1;Fd.__decorate([(0,Vd.AsnProp)({type:MG.DistributionPointName,context:0,optional:!0})],On.prototype,"distributionPoint",void 0);Fd.__decorate([(0,Vd.AsnProp)({type:f0.AsnPropTypes.Boolean,context:1,defaultValue:On.ONLY,implicit:!0})],On.prototype,"onlyContainsUserCerts",void 0);Fd.__decorate([(0,Vd.AsnProp)({type:f0.AsnPropTypes.Boolean,context:2,defaultValue:On.ONLY,implicit:!0})],On.prototype,"onlyContainsCACerts",void 0);Fd.__decorate([(0,Vd.AsnProp)({type:MG.Reason,context:3,optional:!0,implicit:!0})],On.prototype,"onlySomeReasons",void 0);Fd.__decorate([(0,Vd.AsnProp)({type:f0.AsnPropTypes.Boolean,context:4,defaultValue:On.ONLY,implicit:!0})],On.prototype,"indirectCRL",void 0);Fd.__decorate([(0,Vd.AsnProp)({type:f0.AsnPropTypes.Boolean,context:5,defaultValue:On.ONLY,implicit:!0})],On.prototype,"onlyContainsAttributeCerts",void 0)});var BG=y(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});bs.CRLReason=bs.CRLReasons=bs.id_ce_cRLReasons=void 0;var qG=(E(),I(T)),m0=z(),Mme=Ot();bs.id_ce_cRLReasons=`${Mme.id_ce}.21`;var Vg;(function(t){t[t.unspecified=0]="unspecified",t[t.keyCompromise=1]="keyCompromise",t[t.cACompromise=2]="cACompromise",t[t.affiliationChanged=3]="affiliationChanged",t[t.superseded=4]="superseded",t[t.cessationOfOperation=5]="cessationOfOperation",t[t.certificateHold=6]="certificateHold",t[t.removeFromCRL=8]="removeFromCRL",t[t.privilegeWithdrawn=9]="privilegeWithdrawn",t[t.aACompromise=10]="aACompromise"})(Vg||(bs.CRLReasons=Vg={}));var h0=class{constructor(e=Vg.unspecified){this.reason=Vg.unspecified,this.reason=e}toJSON(){return Vg[this.reason]}toString(){return this.toJSON()}};bs.CRLReason=h0;qG.__decorate([(0,m0.AsnProp)({type:m0.AsnPropTypes.Enumerated})],h0.prototype,"reason",void 0);bs.CRLReason=h0=qG.__decorate([(0,m0.AsnType)({type:m0.AsnTypeTypes.Choice})],h0)});var UG=y(er=>{"use strict";var pN;Object.defineProperty(er,"__esModule",{value:!0});er.id_kp_OCSPSigning=er.id_kp_timeStamping=er.id_kp_emailProtection=er.id_kp_codeSigning=er.id_kp_clientAuth=er.id_kp_serverAuth=er.anyExtendedKeyUsage=er.ExtendedKeyUsage=er.id_ce_extKeyUsage=void 0;var Dme=(E(),I(T)),g0=z(),qc=Ot();er.id_ce_extKeyUsage=`${qc.id_ce}.37`;var fN=pN=class extends g0.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,pN.prototype)}};er.ExtendedKeyUsage=fN;er.ExtendedKeyUsage=fN=pN=Dme.__decorate([(0,g0.AsnType)({type:g0.AsnTypeTypes.Sequence,itemType:g0.AsnPropTypes.ObjectIdentifier})],fN);er.anyExtendedKeyUsage=`${er.id_ce_extKeyUsage}.0`;er.id_kp_serverAuth=`${qc.id_kp}.1`;er.id_kp_clientAuth=`${qc.id_kp}.2`;er.id_kp_codeSigning=`${qc.id_kp}.3`;er.id_kp_emailProtection=`${qc.id_kp}.4`;er.id_kp_timeStamping=`${qc.id_kp}.8`;er.id_kp_OCSPSigning=`${qc.id_kp}.9`});var FG=y(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});Bc.InhibitAnyPolicy=Bc.id_ce_inhibitAnyPolicy=void 0;var LG=(E(),I(T)),Hg=z(),qme=Ot();Bc.id_ce_inhibitAnyPolicy=`${qme.id_ce}.54`;var y0=class{constructor(e=new ArrayBuffer(0)){this.value=e}};Bc.InhibitAnyPolicy=y0;LG.__decorate([(0,Hg.AsnProp)({type:Hg.AsnPropTypes.Integer,converter:Hg.AsnIntegerArrayBufferConverter})],y0.prototype,"value",void 0);Bc.InhibitAnyPolicy=y0=LG.__decorate([(0,Hg.AsnType)({type:Hg.AsnTypeTypes.Choice})],y0)});var HG=y(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.InvalidityDate=Uc.id_ce_invalidityDate=void 0;var VG=(E(),I(T)),v0=z(),Bme=Ot();Uc.id_ce_invalidityDate=`${Bme.id_ce}.24`;var b0=class{constructor(e){this.value=new Date,e&&(this.value=e)}};Uc.InvalidityDate=b0;VG.__decorate([(0,v0.AsnProp)({type:v0.AsnPropTypes.GeneralizedTime})],b0.prototype,"value",void 0);Uc.InvalidityDate=b0=VG.__decorate([(0,v0.AsnType)({type:v0.AsnTypeTypes.Choice})],b0)});var WG=y(Lc=>{"use strict";var mN;Object.defineProperty(Lc,"__esModule",{value:!0});Lc.IssueAlternativeName=Lc.id_ce_issuerAltName=void 0;var Ume=(E(),I(T)),GG=z(),Lme=Lg(),Fme=Ot();Lc.id_ce_issuerAltName=`${Fme.id_ce}.18`;var hN=mN=class extends Lme.GeneralNames{constructor(e){super(e),Object.setPrototypeOf(this,mN.prototype)}};Lc.IssueAlternativeName=hN;Lc.IssueAlternativeName=hN=mN=Ume.__decorate([(0,GG.AsnType)({type:GG.AsnTypeTypes.Sequence})],hN)});var ZG=y(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.KeyUsage=wa.KeyUsageFlags=wa.id_ce_keyUsage=void 0;var Vme=z(),Hme=Ot();wa.id_ce_keyUsage=`${Hme.id_ce}.15`;var Jo;(function(t){t[t.digitalSignature=1]="digitalSignature",t[t.nonRepudiation=2]="nonRepudiation",t[t.keyEncipherment=4]="keyEncipherment",t[t.dataEncipherment=8]="dataEncipherment",t[t.keyAgreement=16]="keyAgreement",t[t.keyCertSign=32]="keyCertSign",t[t.cRLSign=64]="cRLSign",t[t.encipherOnly=128]="encipherOnly",t[t.decipherOnly=256]="decipherOnly"})(Jo||(wa.KeyUsageFlags=Jo={}));var gN=class extends Vme.BitString{toJSON(){let e=this.toNumber(),r=[];return e&Jo.cRLSign&&r.push("crlSign"),e&Jo.dataEncipherment&&r.push("dataEncipherment"),e&Jo.decipherOnly&&r.push("decipherOnly"),e&Jo.digitalSignature&&r.push("digitalSignature"),e&Jo.encipherOnly&&r.push("encipherOnly"),e&Jo.keyAgreement&&r.push("keyAgreement"),e&Jo.keyCertSign&&r.push("keyCertSign"),e&Jo.keyEncipherment&&r.push("keyEncipherment"),e&Jo.nonRepudiation&&r.push("nonRepudiation"),r}toString(){return`[${this.toJSON().join(", ")}]`}};wa.KeyUsage=gN});var JG=y(Yo=>{"use strict";var yN;Object.defineProperty(Yo,"__esModule",{value:!0});Yo.NameConstraints=Yo.GeneralSubtrees=Yo.GeneralSubtree=Yo.id_ce_nameConstraints=void 0;var Hd=(E(),I(T)),Ti=z(),KG=Oc(),Gme=Ot();Yo.id_ce_nameConstraints=`${Gme.id_ce}.30`;var Fc=class{constructor(e={}){this.base=new KG.GeneralName,this.minimum=0,Object.assign(this,e)}};Yo.GeneralSubtree=Fc;Hd.__decorate([(0,Ti.AsnProp)({type:KG.GeneralName})],Fc.prototype,"base",void 0);Hd.__decorate([(0,Ti.AsnProp)({type:Ti.AsnPropTypes.Integer,context:0,defaultValue:0,implicit:!0})],Fc.prototype,"minimum",void 0);Hd.__decorate([(0,Ti.AsnProp)({type:Ti.AsnPropTypes.Integer,context:1,optional:!0,implicit:!0})],Fc.prototype,"maximum",void 0);var Gg=yN=class extends Ti.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,yN.prototype)}};Yo.GeneralSubtrees=Gg;Yo.GeneralSubtrees=Gg=yN=Hd.__decorate([(0,Ti.AsnType)({type:Ti.AsnTypeTypes.Sequence,itemType:Fc})],Gg);var Wg=class{constructor(e={}){Object.assign(this,e)}};Yo.NameConstraints=Wg;Hd.__decorate([(0,Ti.AsnProp)({type:Gg,context:0,optional:!0,implicit:!0})],Wg.prototype,"permittedSubtrees",void 0);Hd.__decorate([(0,Ti.AsnProp)({type:Gg,context:1,optional:!0,implicit:!0})],Wg.prototype,"excludedSubtrees",void 0)});var QG=y(Wd=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});Wd.PolicyConstraints=Wd.id_ce_policyConstraints=void 0;var YG=(E(),I(T)),Gd=z(),Wme=Ot();Wd.id_ce_policyConstraints=`${Wme.id_ce}.36`;var Zg=class{constructor(e={}){Object.assign(this,e)}};Wd.PolicyConstraints=Zg;YG.__decorate([(0,Gd.AsnProp)({type:Gd.AsnPropTypes.Integer,context:0,implicit:!0,optional:!0,converter:Gd.AsnIntegerArrayBufferConverter})],Zg.prototype,"requireExplicitPolicy",void 0);YG.__decorate([(0,Gd.AsnProp)({type:Gd.AsnPropTypes.Integer,context:1,implicit:!0,optional:!0,converter:Gd.AsnIntegerArrayBufferConverter})],Zg.prototype,"inhibitPolicyMapping",void 0)});var XG=y(_s=>{"use strict";var vN;Object.defineProperty(_s,"__esModule",{value:!0});_s.PolicyMappings=_s.PolicyMapping=_s.id_ce_policyMappings=void 0;var _N=(E(),I(T)),Vc=z(),Zme=Ot();_s.id_ce_policyMappings=`${Zme.id_ce}.33`;var Zd=class{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}};_s.PolicyMapping=Zd;_N.__decorate([(0,Vc.AsnProp)({type:Vc.AsnPropTypes.ObjectIdentifier})],Zd.prototype,"issuerDomainPolicy",void 0);_N.__decorate([(0,Vc.AsnProp)({type:Vc.AsnPropTypes.ObjectIdentifier})],Zd.prototype,"subjectDomainPolicy",void 0);var bN=vN=class extends Vc.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,vN.prototype)}};_s.PolicyMappings=bN;_s.PolicyMappings=bN=vN=_N.__decorate([(0,Vc.AsnType)({type:Vc.AsnTypeTypes.Sequence,itemType:Zd})],bN)});var tW=y(Hc=>{"use strict";var wN;Object.defineProperty(Hc,"__esModule",{value:!0});Hc.SubjectAlternativeName=Hc.id_ce_subjectAltName=void 0;var Kme=(E(),I(T)),eW=z(),Jme=Lg(),Yme=Ot();Hc.id_ce_subjectAltName=`${Yme.id_ce}.17`;var xN=wN=class extends Jme.GeneralNames{constructor(e){super(e),Object.setPrototypeOf(this,wN.prototype)}};Hc.SubjectAlternativeName=xN;Hc.SubjectAlternativeName=xN=wN=Kme.__decorate([(0,eW.AsnType)({type:eW.AsnTypeTypes.Sequence})],xN)});var SN=y(w0=>{"use strict";Object.defineProperty(w0,"__esModule",{value:!0});w0.Attribute=void 0;var rW=(E(),I(T)),_0=z(),Kg=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};w0.Attribute=Kg;rW.__decorate([(0,_0.AsnProp)({type:_0.AsnPropTypes.ObjectIdentifier})],Kg.prototype,"type",void 0);rW.__decorate([(0,_0.AsnProp)({type:_0.AsnPropTypes.Any,repeated:"set"})],Kg.prototype,"values",void 0)});var nW=y(Gc=>{"use strict";var kN;Object.defineProperty(Gc,"__esModule",{value:!0});Gc.SubjectDirectoryAttributes=Gc.id_ce_subjectDirectoryAttributes=void 0;var Qme=(E(),I(T)),AN=z(),Xme=SN(),ehe=Ot();Gc.id_ce_subjectDirectoryAttributes=`${ehe.id_ce}.9`;var $N=kN=class extends AN.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,kN.prototype)}};Gc.SubjectDirectoryAttributes=$N;Gc.SubjectDirectoryAttributes=$N=kN=Qme.__decorate([(0,AN.AsnType)({type:AN.AsnTypeTypes.Sequence,itemType:Xme.Attribute})],$N)});var oW=y(Kd=>{"use strict";Object.defineProperty(Kd,"__esModule",{value:!0});Kd.SubjectKeyIdentifier=Kd.id_ce_subjectKeyIdentifier=void 0;var the=Ot(),rhe=Xj();Kd.id_ce_subjectKeyIdentifier=`${the.id_ce}.14`;var PN=class extends rhe.KeyIdentifier{};Kd.SubjectKeyIdentifier=PN});var sW=y(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});Jd.PrivateKeyUsagePeriod=Jd.id_ce_privateKeyUsagePeriod=void 0;var iW=(E(),I(T)),x0=z(),nhe=Ot();Jd.id_ce_privateKeyUsagePeriod=`${nhe.id_ce}.16`;var Jg=class{constructor(e={}){Object.assign(this,e)}};Jd.PrivateKeyUsagePeriod=Jg;iW.__decorate([(0,x0.AsnProp)({type:x0.AsnPropTypes.GeneralizedTime,context:0,implicit:!0,optional:!0})],Jg.prototype,"notBefore",void 0);iW.__decorate([(0,x0.AsnProp)({type:x0.AsnPropTypes.GeneralizedTime,context:1,implicit:!0,optional:!0})],Jg.prototype,"notAfter",void 0)});var cW=y(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.EntrustVersionInfo=Ei.EntrustInfo=Ei.EntrustInfoFlags=Ei.id_entrust_entrustVersInfo=void 0;var aW=(E(),I(T)),S0=z();Ei.id_entrust_entrustVersInfo="1.2.840.113533.7.65.0";var Yg;(function(t){t[t.keyUpdateAllowed=1]="keyUpdateAllowed",t[t.newExtensions=2]="newExtensions",t[t.pKIXCertificate=4]="pKIXCertificate"})(Yg||(Ei.EntrustInfoFlags=Yg={}));var Qg=class extends S0.BitString{toJSON(){let e=[],r=this.toNumber();return r&Yg.pKIXCertificate&&e.push("pKIXCertificate"),r&Yg.newExtensions&&e.push("newExtensions"),r&Yg.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}};Ei.EntrustInfo=Qg;var Xg=class{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new Qg,Object.assign(this,e)}};Ei.EntrustVersionInfo=Xg;aW.__decorate([(0,S0.AsnProp)({type:S0.AsnPropTypes.GeneralString})],Xg.prototype,"entrustVers",void 0);aW.__decorate([(0,S0.AsnProp)({type:Qg})],Xg.prototype,"entrustInfoFlags",void 0)});var lW=y(Wc=>{"use strict";var CN;Object.defineProperty(Wc,"__esModule",{value:!0});Wc.SubjectInfoAccessSyntax=Wc.id_pe_subjectInfoAccess=void 0;var ohe=(E(),I(T)),IN=z(),ihe=Ot(),she=Yj();Wc.id_pe_subjectInfoAccess=`${ihe.id_pe}.11`;var TN=CN=class extends IN.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,CN.prototype)}};Wc.SubjectInfoAccessSyntax=TN;Wc.SubjectInfoAccessSyntax=TN=CN=ohe.__decorate([(0,IN.AsnType)({type:IN.AsnTypeTypes.Sequence,itemType:she.AccessDescription})],TN)});var uW=y($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});var Lt=(E(),I(T));Lt.__exportStar(Yj(),$t);Lt.__exportStar(Xj(),$t);Lt.__exportStar(AG(),$t);Lt.__exportStar(CG(),$t);Lt.__exportStar(IG(),$t);Lt.__exportStar(OG(),$t);Lt.__exportStar(p0(),$t);Lt.__exportStar(zG(),$t);Lt.__exportStar(DG(),$t);Lt.__exportStar(sN(),$t);Lt.__exportStar(BG(),$t);Lt.__exportStar(UG(),$t);Lt.__exportStar(FG(),$t);Lt.__exportStar(HG(),$t);Lt.__exportStar(WG(),$t);Lt.__exportStar(ZG(),$t);Lt.__exportStar(JG(),$t);Lt.__exportStar(QG(),$t);Lt.__exportStar(XG(),$t);Lt.__exportStar(tW(),$t);Lt.__exportStar(nW(),$t);Lt.__exportStar(oW(),$t);Lt.__exportStar(sW(),$t);Lt.__exportStar(cW(),$t);Lt.__exportStar(lW(),$t)});var Zc=y(A0=>{"use strict";Object.defineProperty(A0,"__esModule",{value:!0});A0.AlgorithmIdentifier=void 0;var dW=(E(),I(T)),k0=z(),ahe=fs(),ey=class t{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof t&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&ahe.isEqual(e.parameters,this.parameters)||e.parameters===this.parameters)}};A0.AlgorithmIdentifier=ey;dW.__decorate([(0,k0.AsnProp)({type:k0.AsnPropTypes.ObjectIdentifier})],ey.prototype,"algorithm",void 0);dW.__decorate([(0,k0.AsnProp)({type:k0.AsnPropTypes.Any,optional:!0})],ey.prototype,"parameters",void 0)});var ON=y($0=>{"use strict";Object.defineProperty($0,"__esModule",{value:!0});$0.SubjectPublicKeyInfo=void 0;var pW=(E(),I(T)),EN=z(),fW=Zc(),ty=class{constructor(e={}){this.algorithm=new fW.AlgorithmIdentifier,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}};$0.SubjectPublicKeyInfo=ty;pW.__decorate([(0,EN.AsnProp)({type:fW.AlgorithmIdentifier})],ty.prototype,"algorithm",void 0);pW.__decorate([(0,EN.AsnProp)({type:EN.AsnPropTypes.BitString})],ty.prototype,"subjectPublicKey",void 0)});var P0=y(ny=>{"use strict";Object.defineProperty(ny,"__esModule",{value:!0});ny.Time=void 0;var jN=(E(),I(T)),Yd=z(),ry=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){let r=new Date(e);r.getUTCFullYear()>2049?this.generalTime=r:this.utcTime=r}else Object.assign(this,e)}getTime(){let e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};ny.Time=ry;jN.__decorate([(0,Yd.AsnProp)({type:Yd.AsnPropTypes.UTCTime})],ry.prototype,"utcTime",void 0);jN.__decorate([(0,Yd.AsnProp)({type:Yd.AsnPropTypes.GeneralizedTime})],ry.prototype,"generalTime",void 0);ny.Time=ry=jN.__decorate([(0,Yd.AsnType)({type:Yd.AsnTypeTypes.Choice})],ry)});var NN=y(C0=>{"use strict";Object.defineProperty(C0,"__esModule",{value:!0});C0.Validity=void 0;var mW=(E(),I(T)),hW=z(),Qd=P0(),oy=class{constructor(e){this.notBefore=new Qd.Time(new Date),this.notAfter=new Qd.Time(new Date),e&&(this.notBefore=new Qd.Time(e.notBefore),this.notAfter=new Qd.Time(e.notAfter))}};C0.Validity=oy;mW.__decorate([(0,hW.AsnProp)({type:Qd.Time})],oy.prototype,"notBefore",void 0);mW.__decorate([(0,hW.AsnProp)({type:Qd.Time})],oy.prototype,"notAfter",void 0)});var T0=y(Kc=>{"use strict";var RN;Object.defineProperty(Kc,"__esModule",{value:!0});Kc.Extensions=Kc.Extension=void 0;var I0=(E(),I(T)),Oi=z(),ws=class t{constructor(e={}){this.extnID="",this.critical=t.CRITICAL,this.extnValue=new Oi.OctetString,Object.assign(this,e)}};Kc.Extension=ws;ws.CRITICAL=!1;I0.__decorate([(0,Oi.AsnProp)({type:Oi.AsnPropTypes.ObjectIdentifier})],ws.prototype,"extnID",void 0);I0.__decorate([(0,Oi.AsnProp)({type:Oi.AsnPropTypes.Boolean,defaultValue:ws.CRITICAL})],ws.prototype,"critical",void 0);I0.__decorate([(0,Oi.AsnProp)({type:Oi.OctetString})],ws.prototype,"extnValue",void 0);var zN=RN=class extends Oi.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,RN.prototype)}};Kc.Extensions=zN;Kc.Extensions=zN=RN=I0.__decorate([(0,Oi.AsnType)({type:Oi.AsnTypeTypes.Sequence,itemType:ws})],zN)});var MN=y(E0=>{"use strict";Object.defineProperty(E0,"__esModule",{value:!0});E0.Version=void 0;var gW;(function(t){t[t.v1=0]="v1",t[t.v2=1]="v2",t[t.v3=2]="v3"})(gW||(E0.Version=gW={}))});var DN=y(j0=>{"use strict";Object.defineProperty(j0,"__esModule",{value:!0});j0.TBSCertificate=void 0;var ji=(E(),I(T)),hn=z(),yW=Zc(),O0=Id(),vW=ON(),bW=NN(),che=T0(),_W=MN(),Kn=class{constructor(e={}){this.version=_W.Version.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new yW.AlgorithmIdentifier,this.issuer=new O0.Name,this.validity=new bW.Validity,this.subject=new O0.Name,this.subjectPublicKeyInfo=new vW.SubjectPublicKeyInfo,Object.assign(this,e)}};j0.TBSCertificate=Kn;ji.__decorate([(0,hn.AsnProp)({type:hn.AsnPropTypes.Integer,context:0,defaultValue:_W.Version.v1})],Kn.prototype,"version",void 0);ji.__decorate([(0,hn.AsnProp)({type:hn.AsnPropTypes.Integer,converter:hn.AsnIntegerArrayBufferConverter})],Kn.prototype,"serialNumber",void 0);ji.__decorate([(0,hn.AsnProp)({type:yW.AlgorithmIdentifier})],Kn.prototype,"signature",void 0);ji.__decorate([(0,hn.AsnProp)({type:O0.Name})],Kn.prototype,"issuer",void 0);ji.__decorate([(0,hn.AsnProp)({type:bW.Validity})],Kn.prototype,"validity",void 0);ji.__decorate([(0,hn.AsnProp)({type:O0.Name})],Kn.prototype,"subject",void 0);ji.__decorate([(0,hn.AsnProp)({type:vW.SubjectPublicKeyInfo})],Kn.prototype,"subjectPublicKeyInfo",void 0);ji.__decorate([(0,hn.AsnProp)({type:hn.AsnPropTypes.BitString,context:1,implicit:!0,optional:!0})],Kn.prototype,"issuerUniqueID",void 0);ji.__decorate([(0,hn.AsnProp)({type:hn.AsnPropTypes.BitString,context:2,implicit:!0,optional:!0})],Kn.prototype,"subjectUniqueID",void 0);ji.__decorate([(0,hn.AsnProp)({type:che.Extensions,context:3,optional:!0})],Kn.prototype,"extensions",void 0)});var SW=y(R0=>{"use strict";Object.defineProperty(R0,"__esModule",{value:!0});R0.Certificate=void 0;var qN=(E(),I(T)),N0=z(),wW=Zc(),xW=DN(),Xd=class{constructor(e={}){this.tbsCertificate=new xW.TBSCertificate,this.signatureAlgorithm=new wW.AlgorithmIdentifier,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};R0.Certificate=Xd;qN.__decorate([(0,N0.AsnProp)({type:xW.TBSCertificate,raw:!0})],Xd.prototype,"tbsCertificate",void 0);qN.__decorate([(0,N0.AsnProp)({type:wW.AlgorithmIdentifier})],Xd.prototype,"signatureAlgorithm",void 0);qN.__decorate([(0,N0.AsnProp)({type:N0.AsnPropTypes.BitString})],Xd.prototype,"signatureValue",void 0)});var BN=y(ep=>{"use strict";Object.defineProperty(ep,"__esModule",{value:!0});ep.TBSCertList=ep.RevokedCertificate=void 0;var Ri=(E(),I(T)),Jn=z(),kW=Zc(),AW=Id(),iy=P0(),$W=T0(),Jc=class{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new iy.Time,Object.assign(this,e)}};ep.RevokedCertificate=Jc;Ri.__decorate([(0,Jn.AsnProp)({type:Jn.AsnPropTypes.Integer,converter:Jn.AsnIntegerArrayBufferConverter})],Jc.prototype,"userCertificate",void 0);Ri.__decorate([(0,Jn.AsnProp)({type:iy.Time})],Jc.prototype,"revocationDate",void 0);Ri.__decorate([(0,Jn.AsnProp)({type:$W.Extension,optional:!0,repeated:"sequence"})],Jc.prototype,"crlEntryExtensions",void 0);var Ni=class{constructor(e={}){this.signature=new kW.AlgorithmIdentifier,this.issuer=new AW.Name,this.thisUpdate=new iy.Time,Object.assign(this,e)}};ep.TBSCertList=Ni;Ri.__decorate([(0,Jn.AsnProp)({type:Jn.AsnPropTypes.Integer,optional:!0})],Ni.prototype,"version",void 0);Ri.__decorate([(0,Jn.AsnProp)({type:kW.AlgorithmIdentifier})],Ni.prototype,"signature",void 0);Ri.__decorate([(0,Jn.AsnProp)({type:AW.Name})],Ni.prototype,"issuer",void 0);Ri.__decorate([(0,Jn.AsnProp)({type:iy.Time})],Ni.prototype,"thisUpdate",void 0);Ri.__decorate([(0,Jn.AsnProp)({type:iy.Time,optional:!0})],Ni.prototype,"nextUpdate",void 0);Ri.__decorate([(0,Jn.AsnProp)({type:Jc,repeated:"sequence",optional:!0})],Ni.prototype,"revokedCertificates",void 0);Ri.__decorate([(0,Jn.AsnProp)({type:$W.Extension,optional:!0,context:0,repeated:"sequence"})],Ni.prototype,"crlExtensions",void 0)});var IW=y(M0=>{"use strict";Object.defineProperty(M0,"__esModule",{value:!0});M0.CertificateList=void 0;var UN=(E(),I(T)),z0=z(),PW=Zc(),CW=BN(),tp=class{constructor(e={}){this.tbsCertList=new CW.TBSCertList,this.signatureAlgorithm=new PW.AlgorithmIdentifier,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};M0.CertificateList=tp;UN.__decorate([(0,z0.AsnProp)({type:CW.TBSCertList,raw:!0})],tp.prototype,"tbsCertList",void 0);UN.__decorate([(0,z0.AsnProp)({type:PW.AlgorithmIdentifier})],tp.prototype,"signatureAlgorithm",void 0);UN.__decorate([(0,z0.AsnProp)({type:z0.AsnPropTypes.BitString})],tp.prototype,"signature",void 0)});var tt=y($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});var Xr=(E(),I(T));Xr.__exportStar(uW(),$r);Xr.__exportStar(Zc(),$r);Xr.__exportStar(SN(),$r);Xr.__exportStar(SW(),$r);Xr.__exportStar(IW(),$r);Xr.__exportStar(T0(),$r);Xr.__exportStar(Oc(),$r);Xr.__exportStar(Lg(),$r);Xr.__exportStar(Id(),$r);Xr.__exportStar(Ot(),$r);Xr.__exportStar(ON(),$r);Xr.__exportStar(BN(),$r);Xr.__exportStar(DN(),$r);Xr.__exportStar(P0(),$r);Xr.__exportStar(MN(),$r);Xr.__exportStar(NN(),$r)});var ay=y(q0=>{"use strict";Object.defineProperty(q0,"__esModule",{value:!0});q0.IssuerAndSerialNumber=void 0;var TW=(E(),I(T)),D0=z(),EW=tt(),sy=class{constructor(e={}){this.issuer=new EW.Name,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}};q0.IssuerAndSerialNumber=sy;TW.__decorate([(0,D0.AsnProp)({type:EW.Name})],sy.prototype,"issuer",void 0);TW.__decorate([(0,D0.AsnProp)({type:D0.AsnPropTypes.Integer,converter:D0.AsnIntegerArrayBufferConverter})],sy.prototype,"serialNumber",void 0)});var FN=y(ly=>{"use strict";Object.defineProperty(ly,"__esModule",{value:!0});ly.SignerIdentifier=void 0;var LN=(E(),I(T)),B0=z(),lhe=ay(),uhe=tt(),cy=class{constructor(e={}){Object.assign(this,e)}};ly.SignerIdentifier=cy;LN.__decorate([(0,B0.AsnProp)({type:uhe.SubjectKeyIdentifier,context:0,implicit:!0})],cy.prototype,"subjectKeyIdentifier",void 0);LN.__decorate([(0,B0.AsnProp)({type:lhe.IssuerAndSerialNumber})],cy.prototype,"issuerAndSerialNumber",void 0);ly.SignerIdentifier=cy=LN.__decorate([(0,B0.AsnType)({type:B0.AsnTypeTypes.Choice})],cy)});var zi=y(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.KeyDerivationAlgorithmIdentifier=tr.MessageAuthenticationCodeAlgorithm=tr.ContentEncryptionAlgorithmIdentifier=tr.KeyEncryptionAlgorithmIdentifier=tr.SignatureAlgorithmIdentifier=tr.DigestAlgorithmIdentifier=tr.CMSVersion=void 0;var rp=(E(),I(T)),np=tt(),wo=z(),OW;(function(t){t[t.v0=0]="v0",t[t.v1=1]="v1",t[t.v2=2]="v2",t[t.v3=3]="v3",t[t.v4=4]="v4",t[t.v5=5]="v5"})(OW||(tr.CMSVersion=OW={}));var VN=class extends np.AlgorithmIdentifier{};tr.DigestAlgorithmIdentifier=VN;tr.DigestAlgorithmIdentifier=VN=rp.__decorate([(0,wo.AsnType)({type:wo.AsnTypeTypes.Sequence})],VN);var HN=class extends np.AlgorithmIdentifier{};tr.SignatureAlgorithmIdentifier=HN;tr.SignatureAlgorithmIdentifier=HN=rp.__decorate([(0,wo.AsnType)({type:wo.AsnTypeTypes.Sequence})],HN);var GN=class extends np.AlgorithmIdentifier{};tr.KeyEncryptionAlgorithmIdentifier=GN;tr.KeyEncryptionAlgorithmIdentifier=GN=rp.__decorate([(0,wo.AsnType)({type:wo.AsnTypeTypes.Sequence})],GN);var WN=class extends np.AlgorithmIdentifier{};tr.ContentEncryptionAlgorithmIdentifier=WN;tr.ContentEncryptionAlgorithmIdentifier=WN=rp.__decorate([(0,wo.AsnType)({type:wo.AsnTypeTypes.Sequence})],WN);var ZN=class extends np.AlgorithmIdentifier{};tr.MessageAuthenticationCodeAlgorithm=ZN;tr.MessageAuthenticationCodeAlgorithm=ZN=rp.__decorate([(0,wo.AsnType)({type:wo.AsnTypeTypes.Sequence})],ZN);var KN=class extends np.AlgorithmIdentifier{};tr.KeyDerivationAlgorithmIdentifier=KN;tr.KeyDerivationAlgorithmIdentifier=KN=rp.__decorate([(0,wo.AsnType)({type:wo.AsnTypeTypes.Sequence})],KN)});var F0=y(L0=>{"use strict";Object.defineProperty(L0,"__esModule",{value:!0});L0.Attribute=void 0;var jW=(E(),I(T)),U0=z(),uy=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};L0.Attribute=uy;jW.__decorate([(0,U0.AsnProp)({type:U0.AsnPropTypes.ObjectIdentifier})],uy.prototype,"attrType",void 0);jW.__decorate([(0,U0.AsnProp)({type:U0.AsnPropTypes.Any,repeated:"set"})],uy.prototype,"attrValues",void 0)});var V0=y(Yc=>{"use strict";var JN;Object.defineProperty(Yc,"__esModule",{value:!0});Yc.SignerInfos=Yc.SignerInfo=void 0;var xa=(E(),I(T)),Yn=z(),NW=FN(),dy=zi(),RW=F0(),Qo=class{constructor(e={}){this.version=dy.CMSVersion.v0,this.sid=new NW.SignerIdentifier,this.digestAlgorithm=new dy.DigestAlgorithmIdentifier,this.signatureAlgorithm=new dy.SignatureAlgorithmIdentifier,this.signature=new Yn.OctetString,Object.assign(this,e)}};Yc.SignerInfo=Qo;xa.__decorate([(0,Yn.AsnProp)({type:Yn.AsnPropTypes.Integer})],Qo.prototype,"version",void 0);xa.__decorate([(0,Yn.AsnProp)({type:NW.SignerIdentifier})],Qo.prototype,"sid",void 0);xa.__decorate([(0,Yn.AsnProp)({type:dy.DigestAlgorithmIdentifier})],Qo.prototype,"digestAlgorithm",void 0);xa.__decorate([(0,Yn.AsnProp)({type:RW.Attribute,repeated:"set",context:0,implicit:!0,optional:!0,raw:!0})],Qo.prototype,"signedAttrs",void 0);xa.__decorate([(0,Yn.AsnProp)({type:dy.SignatureAlgorithmIdentifier})],Qo.prototype,"signatureAlgorithm",void 0);xa.__decorate([(0,Yn.AsnProp)({type:Yn.OctetString})],Qo.prototype,"signature",void 0);xa.__decorate([(0,Yn.AsnProp)({type:RW.Attribute,repeated:"set",context:1,implicit:!0,optional:!0})],Qo.prototype,"unsignedAttrs",void 0);var YN=JN=class extends Yn.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,JN.prototype)}};Yc.SignerInfos=YN;Yc.SignerInfos=YN=JN=xa.__decorate([(0,Yn.AsnType)({type:Yn.AsnTypeTypes.Set,itemType:Qo})],YN)});var MW=y(Qc=>{"use strict";Object.defineProperty(Qc,"__esModule",{value:!0});Qc.CounterSignature=Qc.id_counterSignature=void 0;var dhe=(E(),I(T)),zW=z(),phe=V0();Qc.id_counterSignature="1.2.840.113549.1.9.6";var QN=class extends phe.SignerInfo{};Qc.CounterSignature=QN;Qc.CounterSignature=QN=dhe.__decorate([(0,zW.AsnType)({type:zW.AsnTypeTypes.Sequence})],QN)});var DW=y(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});op.MessageDigest=op.id_messageDigest=void 0;var fhe=z();op.id_messageDigest="1.2.840.113549.1.9.4";var XN=class extends fhe.OctetString{};op.MessageDigest=XN});var BW=y(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.SigningTime=Xc.id_signingTime=void 0;var mhe=(E(),I(T)),hhe=tt(),qW=z();Xc.id_signingTime="1.2.840.113549.1.9.5";var eR=class extends hhe.Time{};Xc.SigningTime=eR;Xc.SigningTime=eR=mhe.__decorate([(0,qW.AsnType)({type:qW.AsnTypeTypes.Choice})],eR)});var UW=y(el=>{"use strict";Object.defineProperty(el,"__esModule",{value:!0});el.id_contentType=void 0;var tR=(E(),I(T));tR.__exportStar(MW(),el);tR.__exportStar(DW(),el);tR.__exportStar(BW(),el);el.id_contentType="1.2.840.113549.1.9.3"});var LW=y(G0=>{"use strict";Object.defineProperty(G0,"__esModule",{value:!0});G0.ACClearAttrs=void 0;var rR=(E(),I(T)),H0=z(),nR=tt(),ip=class{constructor(e={}){this.acIssuer=new nR.GeneralName,this.acSerial=0,this.attrs=[],Object.assign(this,e)}};G0.ACClearAttrs=ip;rR.__decorate([(0,H0.AsnProp)({type:nR.GeneralName})],ip.prototype,"acIssuer",void 0);rR.__decorate([(0,H0.AsnProp)({type:H0.AsnPropTypes.Integer})],ip.prototype,"acSerial",void 0);rR.__decorate([(0,H0.AsnProp)({type:nR.Attribute,repeated:"sequence"})],ip.prototype,"attrs",void 0)});var sR=y(py=>{"use strict";var oR;Object.defineProperty(py,"__esModule",{value:!0});py.AttrSpec=void 0;var ghe=(E(),I(T)),W0=z(),iR=oR=class extends W0.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,oR.prototype)}};py.AttrSpec=iR;py.AttrSpec=iR=oR=ghe.__decorate([(0,W0.AsnType)({type:W0.AsnTypeTypes.Sequence,itemType:W0.AsnPropTypes.ObjectIdentifier})],iR)});var VW=y(K0=>{"use strict";Object.defineProperty(K0,"__esModule",{value:!0});K0.AAControls=void 0;var Z0=(E(),I(T)),sp=z(),FW=sR(),tl=class{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}};K0.AAControls=tl;Z0.__decorate([(0,sp.AsnProp)({type:sp.AsnPropTypes.Integer,optional:!0})],tl.prototype,"pathLenConstraint",void 0);Z0.__decorate([(0,sp.AsnProp)({type:FW.AttrSpec,implicit:!0,context:0,optional:!0})],tl.prototype,"permittedAttrs",void 0);Z0.__decorate([(0,sp.AsnProp)({type:FW.AttrSpec,implicit:!0,context:1,optional:!0})],tl.prototype,"excludedAttrs",void 0);Z0.__decorate([(0,sp.AsnProp)({type:sp.AsnPropTypes.Boolean,defaultValue:!0})],tl.prototype,"permitUnSpecified",void 0)});var fy=y(J0=>{"use strict";Object.defineProperty(J0,"__esModule",{value:!0});J0.IssuerSerial=void 0;var aR=(E(),I(T)),ap=z(),HW=tt(),cp=class{constructor(e={}){this.issuer=new HW.GeneralNames,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}};J0.IssuerSerial=cp;aR.__decorate([(0,ap.AsnProp)({type:HW.GeneralNames})],cp.prototype,"issuer",void 0);aR.__decorate([(0,ap.AsnProp)({type:ap.AsnPropTypes.Integer,converter:ap.AsnIntegerArrayBufferConverter})],cp.prototype,"serial",void 0);aR.__decorate([(0,ap.AsnProp)({type:ap.AsnPropTypes.BitString,optional:!0})],cp.prototype,"issuerUID",void 0)});var my=y(lp=>{"use strict";Object.defineProperty(lp,"__esModule",{value:!0});lp.ObjectDigestInfo=lp.DigestedObjectType=void 0;var Y0=(E(),I(T)),rl=z(),GW=tt(),cR;(function(t){t[t.publicKey=0]="publicKey",t[t.publicKeyCert=1]="publicKeyCert",t[t.otherObjectTypes=2]="otherObjectTypes"})(cR||(lp.DigestedObjectType=cR={}));var nl=class{constructor(e={}){this.digestedObjectType=cR.publicKey,this.digestAlgorithm=new GW.AlgorithmIdentifier,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}};lp.ObjectDigestInfo=nl;Y0.__decorate([(0,rl.AsnProp)({type:rl.AsnPropTypes.Enumerated})],nl.prototype,"digestedObjectType",void 0);Y0.__decorate([(0,rl.AsnProp)({type:rl.AsnPropTypes.ObjectIdentifier,optional:!0})],nl.prototype,"otherObjectTypeID",void 0);Y0.__decorate([(0,rl.AsnProp)({type:GW.AlgorithmIdentifier})],nl.prototype,"digestAlgorithm",void 0);Y0.__decorate([(0,rl.AsnProp)({type:rl.AsnPropTypes.BitString})],nl.prototype,"objectDigest",void 0)});var dR=y(Q0=>{"use strict";Object.defineProperty(Q0,"__esModule",{value:!0});Q0.V2Form=void 0;var lR=(E(),I(T)),uR=z(),yhe=tt(),vhe=fy(),bhe=my(),up=class{constructor(e={}){Object.assign(this,e)}};Q0.V2Form=up;lR.__decorate([(0,uR.AsnProp)({type:yhe.GeneralNames,optional:!0})],up.prototype,"issuerName",void 0);lR.__decorate([(0,uR.AsnProp)({type:vhe.IssuerSerial,context:0,implicit:!0,optional:!0})],up.prototype,"baseCertificateID",void 0);lR.__decorate([(0,uR.AsnProp)({type:bhe.ObjectDigestInfo,context:1,implicit:!0,optional:!0})],up.prototype,"objectDigestInfo",void 0)});var fR=y(gy=>{"use strict";Object.defineProperty(gy,"__esModule",{value:!0});gy.AttCertIssuer=void 0;var pR=(E(),I(T)),X0=z(),_he=tt(),whe=dR(),hy=class{constructor(e={}){Object.assign(this,e)}};gy.AttCertIssuer=hy;pR.__decorate([(0,X0.AsnProp)({type:_he.GeneralName,repeated:"sequence"})],hy.prototype,"v1Form",void 0);pR.__decorate([(0,X0.AsnProp)({type:whe.V2Form,context:0,implicit:!0})],hy.prototype,"v2Form",void 0);gy.AttCertIssuer=hy=pR.__decorate([(0,X0.AsnType)({type:X0.AsnTypeTypes.Choice})],hy)});var mR=y(tS=>{"use strict";Object.defineProperty(tS,"__esModule",{value:!0});tS.AttCertValidityPeriod=void 0;var WW=(E(),I(T)),eS=z(),yy=class{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}};tS.AttCertValidityPeriod=yy;WW.__decorate([(0,eS.AsnProp)({type:eS.AsnPropTypes.GeneralizedTime})],yy.prototype,"notBeforeTime",void 0);WW.__decorate([(0,eS.AsnProp)({type:eS.AsnPropTypes.GeneralizedTime})],yy.prototype,"notAfterTime",void 0)});var yR=y(rS=>{"use strict";Object.defineProperty(rS,"__esModule",{value:!0});rS.Holder=void 0;var hR=(E(),I(T)),gR=z(),xhe=fy(),She=tt(),khe=my(),dp=class{constructor(e={}){Object.assign(this,e)}};rS.Holder=dp;hR.__decorate([(0,gR.AsnProp)({type:xhe.IssuerSerial,implicit:!0,context:0,optional:!0})],dp.prototype,"baseCertificateID",void 0);hR.__decorate([(0,gR.AsnProp)({type:She.GeneralNames,implicit:!0,context:1,optional:!0})],dp.prototype,"entityName",void 0);hR.__decorate([(0,gR.AsnProp)({type:khe.ObjectDigestInfo,implicit:!0,context:2,optional:!0})],dp.prototype,"objectDigestInfo",void 0)});var bR=y(pp=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});pp.AttributeCertificateInfo=pp.AttCertVersion=void 0;var xs=(E(),I(T)),Qn=z(),nS=tt(),ZW=yR(),KW=fR(),JW=mR(),vR;(function(t){t[t.v2=1]="v2"})(vR||(pp.AttCertVersion=vR={}));var xo=class{constructor(e={}){this.version=vR.v2,this.holder=new ZW.Holder,this.issuer=new KW.AttCertIssuer,this.signature=new nS.AlgorithmIdentifier,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new JW.AttCertValidityPeriod,this.attributes=[],Object.assign(this,e)}};pp.AttributeCertificateInfo=xo;xs.__decorate([(0,Qn.AsnProp)({type:Qn.AsnPropTypes.Integer})],xo.prototype,"version",void 0);xs.__decorate([(0,Qn.AsnProp)({type:ZW.Holder})],xo.prototype,"holder",void 0);xs.__decorate([(0,Qn.AsnProp)({type:KW.AttCertIssuer})],xo.prototype,"issuer",void 0);xs.__decorate([(0,Qn.AsnProp)({type:nS.AlgorithmIdentifier})],xo.prototype,"signature",void 0);xs.__decorate([(0,Qn.AsnProp)({type:Qn.AsnPropTypes.Integer,converter:Qn.AsnIntegerArrayBufferConverter})],xo.prototype,"serialNumber",void 0);xs.__decorate([(0,Qn.AsnProp)({type:JW.AttCertValidityPeriod})],xo.prototype,"attrCertValidityPeriod",void 0);xs.__decorate([(0,Qn.AsnProp)({type:nS.Attribute,repeated:"sequence"})],xo.prototype,"attributes",void 0);xs.__decorate([(0,Qn.AsnProp)({type:Qn.AsnPropTypes.BitString,optional:!0})],xo.prototype,"issuerUniqueID",void 0);xs.__decorate([(0,Qn.AsnProp)({type:nS.Extensions,optional:!0})],xo.prototype,"extensions",void 0)});var XW=y(iS=>{"use strict";Object.defineProperty(iS,"__esModule",{value:!0});iS.AttributeCertificate=void 0;var _R=(E(),I(T)),oS=z(),YW=tt(),QW=bR(),fp=class{constructor(e={}){this.acinfo=new QW.AttributeCertificateInfo,this.signatureAlgorithm=new YW.AlgorithmIdentifier,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};iS.AttributeCertificate=fp;_R.__decorate([(0,oS.AsnProp)({type:QW.AttributeCertificateInfo})],fp.prototype,"acinfo",void 0);_R.__decorate([(0,oS.AsnProp)({type:YW.AlgorithmIdentifier})],fp.prototype,"signatureAlgorithm",void 0);_R.__decorate([(0,oS.AsnProp)({type:oS.AsnPropTypes.BitString})],fp.prototype,"signatureValue",void 0)});var xR=y(mp=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});mp.ClassList=mp.ClassListFlags=void 0;var Ahe=z(),eZ;(function(t){t[t.unmarked=1]="unmarked",t[t.unclassified=2]="unclassified",t[t.restricted=4]="restricted",t[t.confidential=8]="confidential",t[t.secret=16]="secret",t[t.topSecret=32]="topSecret"})(eZ||(mp.ClassListFlags=eZ={}));var wR=class extends Ahe.BitString{};mp.ClassList=wR});var SR=y(aS=>{"use strict";Object.defineProperty(aS,"__esModule",{value:!0});aS.SecurityCategory=void 0;var tZ=(E(),I(T)),sS=z(),vy=class{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};aS.SecurityCategory=vy;tZ.__decorate([(0,sS.AsnProp)({type:sS.AsnPropTypes.ObjectIdentifier,implicit:!0,context:0})],vy.prototype,"type",void 0);tZ.__decorate([(0,sS.AsnProp)({type:sS.AsnPropTypes.Any,implicit:!0,context:1})],vy.prototype,"value",void 0)});var rZ=y(lS=>{"use strict";Object.defineProperty(lS,"__esModule",{value:!0});lS.Clearance=void 0;var kR=(E(),I(T)),cS=z(),by=xR(),$he=SR(),hp=class{constructor(e={}){this.policyId="",this.classList=new by.ClassList(by.ClassListFlags.unclassified),Object.assign(this,e)}};lS.Clearance=hp;kR.__decorate([(0,cS.AsnProp)({type:cS.AsnPropTypes.ObjectIdentifier})],hp.prototype,"policyId",void 0);kR.__decorate([(0,cS.AsnProp)({type:by.ClassList,defaultValue:new by.ClassList(by.ClassListFlags.unclassified)})],hp.prototype,"classList",void 0);kR.__decorate([(0,cS.AsnProp)({type:$he.SecurityCategory,repeated:"set"})],hp.prototype,"securityCategories",void 0)});var nZ=y(gp=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0});gp.IetfAttrSyntax=gp.IetfAttrSyntaxValueChoices=void 0;var wy=(E(),I(T)),Sa=z(),Phe=tt(),ol=class{constructor(e={}){Object.assign(this,e)}};gp.IetfAttrSyntaxValueChoices=ol;wy.__decorate([(0,Sa.AsnProp)({type:Sa.OctetString})],ol.prototype,"cotets",void 0);wy.__decorate([(0,Sa.AsnProp)({type:Sa.AsnPropTypes.ObjectIdentifier})],ol.prototype,"oid",void 0);wy.__decorate([(0,Sa.AsnProp)({type:Sa.AsnPropTypes.Utf8String})],ol.prototype,"string",void 0);var _y=class{constructor(e={}){this.values=[],Object.assign(this,e)}};gp.IetfAttrSyntax=_y;wy.__decorate([(0,Sa.AsnProp)({type:Phe.GeneralNames,implicit:!0,context:0,optional:!0})],_y.prototype,"policyAuthority",void 0);wy.__decorate([(0,Sa.AsnProp)({type:ol,repeated:"sequence"})],_y.prototype,"values",void 0)});var oZ=y(rt=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});rt.id_at_clearance=rt.id_at_role=rt.id_at=rt.id_aca_encAttrs=rt.id_aca_group=rt.id_aca_chargingIdentity=rt.id_aca_accessIdentity=rt.id_aca_authenticationInfo=rt.id_aca=rt.id_ce_targetInformation=rt.id_pe_ac_proxying=rt.id_pe_aaControls=rt.id_pe_ac_auditIdentity=void 0;var xy=tt();rt.id_pe_ac_auditIdentity=`${xy.id_pe}.4`;rt.id_pe_aaControls=`${xy.id_pe}.6`;rt.id_pe_ac_proxying=`${xy.id_pe}.10`;rt.id_ce_targetInformation=`${xy.id_ce}.55`;rt.id_aca=`${xy.id_pkix}.10`;rt.id_aca_authenticationInfo=`${rt.id_aca}.1`;rt.id_aca_accessIdentity=`${rt.id_aca}.2`;rt.id_aca_chargingIdentity=`${rt.id_aca}.3`;rt.id_aca_group=`${rt.id_aca}.4`;rt.id_aca_encAttrs=`${rt.id_aca}.6`;rt.id_at="2.5.4";rt.id_at_role=`${rt.id_at}.72`;rt.id_at_clearance="2.5.1.5.55"});var CR=y(Mi=>{"use strict";var AR;Object.defineProperty(Mi,"__esModule",{value:!0});Mi.Targets=Mi.Target=Mi.TargetCert=void 0;var ka=(E(),I(T)),Xo=z(),PR=tt(),iZ=fy(),Che=my(),il=class{constructor(e={}){this.targetCertificate=new iZ.IssuerSerial,Object.assign(this,e)}};Mi.TargetCert=il;ka.__decorate([(0,Xo.AsnProp)({type:iZ.IssuerSerial})],il.prototype,"targetCertificate",void 0);ka.__decorate([(0,Xo.AsnProp)({type:PR.GeneralName,optional:!0})],il.prototype,"targetName",void 0);ka.__decorate([(0,Xo.AsnProp)({type:Che.ObjectDigestInfo,optional:!0})],il.prototype,"certDigestInfo",void 0);var sl=class{constructor(e={}){Object.assign(this,e)}};Mi.Target=sl;ka.__decorate([(0,Xo.AsnProp)({type:PR.GeneralName,context:0,implicit:!0})],sl.prototype,"targetName",void 0);ka.__decorate([(0,Xo.AsnProp)({type:PR.GeneralName,context:1,implicit:!0})],sl.prototype,"targetGroup",void 0);ka.__decorate([(0,Xo.AsnProp)({type:il,context:2,implicit:!0})],sl.prototype,"targetCert",void 0);Mi.Target=sl=ka.__decorate([(0,Xo.AsnType)({type:Xo.AsnTypeTypes.Choice})],sl);var $R=AR=class extends Xo.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,AR.prototype)}};Mi.Targets=$R;Mi.Targets=$R=AR=ka.__decorate([(0,Xo.AsnType)({type:Xo.AsnTypeTypes.Sequence,itemType:sl})],$R)});var sZ=y(Sy=>{"use strict";var IR;Object.defineProperty(Sy,"__esModule",{value:!0});Sy.ProxyInfo=void 0;var Ihe=(E(),I(T)),TR=z(),The=CR(),ER=IR=class extends TR.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,IR.prototype)}};Sy.ProxyInfo=ER;Sy.ProxyInfo=ER=IR=Ihe.__decorate([(0,TR.AsnType)({type:TR.AsnTypeTypes.Sequence,itemType:The.Targets})],ER)});var uZ=y(uS=>{"use strict";Object.defineProperty(uS,"__esModule",{value:!0});uS.RoleSyntax=void 0;var aZ=(E(),I(T)),cZ=z(),lZ=tt(),ky=class{constructor(e={}){Object.assign(this,e)}};uS.RoleSyntax=ky;aZ.__decorate([(0,cZ.AsnProp)({type:lZ.GeneralNames,implicit:!0,context:0,optional:!0})],ky.prototype,"roleAuthority",void 0);aZ.__decorate([(0,cZ.AsnProp)({type:lZ.GeneralName,implicit:!0,context:1})],ky.prototype,"roleName",void 0)});var dZ=y(fS=>{"use strict";Object.defineProperty(fS,"__esModule",{value:!0});fS.SvceAuthInfo=void 0;var OR=(E(),I(T)),dS=z(),pS=tt(),yp=class{constructor(e={}){this.service=new pS.GeneralName,this.ident=new pS.GeneralName,Object.assign(this,e)}};fS.SvceAuthInfo=yp;OR.__decorate([(0,dS.AsnProp)({type:pS.GeneralName})],yp.prototype,"service",void 0);OR.__decorate([(0,dS.AsnProp)({type:pS.GeneralName})],yp.prototype,"ident",void 0);OR.__decorate([(0,dS.AsnProp)({type:dS.OctetString,optional:!0})],yp.prototype,"authInfo",void 0)});var jR=y(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});var hr=(E(),I(T));hr.__exportStar(LW(),rr);hr.__exportStar(VW(),rr);hr.__exportStar(fR(),rr);hr.__exportStar(mR(),rr);hr.__exportStar(sR(),rr);hr.__exportStar(XW(),rr);hr.__exportStar(bR(),rr);hr.__exportStar(xR(),rr);hr.__exportStar(rZ(),rr);hr.__exportStar(yR(),rr);hr.__exportStar(nZ(),rr);hr.__exportStar(fy(),rr);hr.__exportStar(my(),rr);hr.__exportStar(oZ(),rr);hr.__exportStar(sZ(),rr);hr.__exportStar(uZ(),rr);hr.__exportStar(SR(),rr);hr.__exportStar(dZ(),rr);hr.__exportStar(CR(),rr);hr.__exportStar(dR(),rr)});var mS=y(Di=>{"use strict";var NR;Object.defineProperty(Di,"__esModule",{value:!0});Di.CertificateSet=Di.CertificateChoices=Di.OtherCertificateFormat=void 0;var cl=(E(),I(T)),So=z(),Ehe=tt(),Ohe=jR(),vp=class{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}};Di.OtherCertificateFormat=vp;cl.__decorate([(0,So.AsnProp)({type:So.AsnPropTypes.ObjectIdentifier})],vp.prototype,"otherCertFormat",void 0);cl.__decorate([(0,So.AsnProp)({type:So.AsnPropTypes.Any})],vp.prototype,"otherCert",void 0);var al=class{constructor(e={}){Object.assign(this,e)}};Di.CertificateChoices=al;cl.__decorate([(0,So.AsnProp)({type:Ehe.Certificate})],al.prototype,"certificate",void 0);cl.__decorate([(0,So.AsnProp)({type:Ohe.AttributeCertificate,context:2,implicit:!0})],al.prototype,"v2AttrCert",void 0);cl.__decorate([(0,So.AsnProp)({type:vp,context:3,implicit:!0})],al.prototype,"other",void 0);Di.CertificateChoices=al=cl.__decorate([(0,So.AsnType)({type:So.AsnTypeTypes.Choice})],al);var RR=NR=class extends So.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,NR.prototype)}};Di.CertificateSet=RR;Di.CertificateSet=RR=NR=cl.__decorate([(0,So.AsnType)({type:So.AsnTypeTypes.Set,itemType:al})],RR)});var fZ=y(gS=>{"use strict";Object.defineProperty(gS,"__esModule",{value:!0});gS.ContentInfo=void 0;var pZ=(E(),I(T)),hS=z(),Ay=class{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}};gS.ContentInfo=Ay;pZ.__decorate([(0,hS.AsnProp)({type:hS.AsnPropTypes.ObjectIdentifier})],Ay.prototype,"contentType",void 0);pZ.__decorate([(0,hS.AsnProp)({type:hS.AsnPropTypes.Any,context:0})],Ay.prototype,"content",void 0)});var zR=y(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});ll.EncapsulatedContentInfo=ll.EncapsulatedContent=void 0;var Py=(E(),I(T)),Ss=z(),bp=class{constructor(e={}){Object.assign(this,e)}};ll.EncapsulatedContent=bp;Py.__decorate([(0,Ss.AsnProp)({type:Ss.OctetString})],bp.prototype,"single",void 0);Py.__decorate([(0,Ss.AsnProp)({type:Ss.AsnPropTypes.Any})],bp.prototype,"any",void 0);ll.EncapsulatedContent=bp=Py.__decorate([(0,Ss.AsnType)({type:Ss.AsnTypeTypes.Choice})],bp);var $y=class{constructor(e={}){this.eContentType="",Object.assign(this,e)}};ll.EncapsulatedContentInfo=$y;Py.__decorate([(0,Ss.AsnProp)({type:Ss.AsnPropTypes.ObjectIdentifier})],$y.prototype,"eContentType",void 0);Py.__decorate([(0,Ss.AsnProp)({type:bp,context:0,optional:!0})],$y.prototype,"eContent",void 0)});var MR=y(ul=>{"use strict";Object.defineProperty(ul,"__esModule",{value:!0});ul.EncryptedContentInfo=ul.EncryptedContent=void 0;var xp=(E(),I(T)),ei=z(),mZ=zi(),_p=class{constructor(e={}){Object.assign(this,e)}};ul.EncryptedContent=_p;xp.__decorate([(0,ei.AsnProp)({type:ei.OctetString,context:0,implicit:!0,optional:!0})],_p.prototype,"value",void 0);xp.__decorate([(0,ei.AsnProp)({type:ei.OctetString,converter:ei.AsnConstructedOctetStringConverter,context:0,implicit:!0,optional:!0,repeated:"sequence"})],_p.prototype,"constructedValue",void 0);ul.EncryptedContent=_p=xp.__decorate([(0,ei.AsnType)({type:ei.AsnTypeTypes.Choice})],_p);var wp=class{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new mZ.ContentEncryptionAlgorithmIdentifier,Object.assign(this,e)}};ul.EncryptedContentInfo=wp;xp.__decorate([(0,ei.AsnProp)({type:ei.AsnPropTypes.ObjectIdentifier})],wp.prototype,"contentType",void 0);xp.__decorate([(0,ei.AsnProp)({type:mZ.ContentEncryptionAlgorithmIdentifier})],wp.prototype,"contentEncryptionAlgorithm",void 0);xp.__decorate([(0,ei.AsnProp)({type:_p,optional:!0})],wp.prototype,"encryptedContent",void 0)});var DR=y(vS=>{"use strict";Object.defineProperty(vS,"__esModule",{value:!0});vS.OtherKeyAttribute=void 0;var hZ=(E(),I(T)),yS=z(),Cy=class{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}};vS.OtherKeyAttribute=Cy;hZ.__decorate([(0,yS.AsnProp)({type:yS.AsnPropTypes.ObjectIdentifier})],Cy.prototype,"keyAttrId",void 0);hZ.__decorate([(0,yS.AsnProp)({type:yS.AsnPropTypes.Any,optional:!0})],Cy.prototype,"keyAttr",void 0)});var UR=y(wr=>{"use strict";var qR;Object.defineProperty(wr,"__esModule",{value:!0});wr.KeyAgreeRecipientInfo=wr.OriginatorIdentifierOrKey=wr.OriginatorPublicKey=wr.RecipientEncryptedKeys=wr.RecipientEncryptedKey=wr.KeyAgreeRecipientIdentifier=wr.RecipientKeyIdentifier=void 0;var gr=(E(),I(T)),dt=z(),BR=zi(),gZ=ay(),Ty=tt(),jhe=DR(),dl=class{constructor(e={}){this.subjectKeyIdentifier=new Ty.SubjectKeyIdentifier,Object.assign(this,e)}};wr.RecipientKeyIdentifier=dl;gr.__decorate([(0,dt.AsnProp)({type:Ty.SubjectKeyIdentifier})],dl.prototype,"subjectKeyIdentifier",void 0);gr.__decorate([(0,dt.AsnProp)({type:dt.AsnPropTypes.GeneralizedTime,optional:!0})],dl.prototype,"date",void 0);gr.__decorate([(0,dt.AsnProp)({type:jhe.OtherKeyAttribute,optional:!0})],dl.prototype,"other",void 0);var pl=class{constructor(e={}){Object.assign(this,e)}};wr.KeyAgreeRecipientIdentifier=pl;gr.__decorate([(0,dt.AsnProp)({type:dl,context:0,implicit:!0,optional:!0})],pl.prototype,"rKeyId",void 0);gr.__decorate([(0,dt.AsnProp)({type:gZ.IssuerAndSerialNumber,optional:!0})],pl.prototype,"issuerAndSerialNumber",void 0);wr.KeyAgreeRecipientIdentifier=pl=gr.__decorate([(0,dt.AsnType)({type:dt.AsnTypeTypes.Choice})],pl);var Sp=class{constructor(e={}){this.rid=new pl,this.encryptedKey=new dt.OctetString,Object.assign(this,e)}};wr.RecipientEncryptedKey=Sp;gr.__decorate([(0,dt.AsnProp)({type:pl})],Sp.prototype,"rid",void 0);gr.__decorate([(0,dt.AsnProp)({type:dt.OctetString})],Sp.prototype,"encryptedKey",void 0);var Iy=qR=class extends dt.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,qR.prototype)}};wr.RecipientEncryptedKeys=Iy;wr.RecipientEncryptedKeys=Iy=qR=gr.__decorate([(0,dt.AsnType)({type:dt.AsnTypeTypes.Sequence,itemType:Sp})],Iy);var kp=class{constructor(e={}){this.algorithm=new Ty.AlgorithmIdentifier,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}};wr.OriginatorPublicKey=kp;gr.__decorate([(0,dt.AsnProp)({type:Ty.AlgorithmIdentifier})],kp.prototype,"algorithm",void 0);gr.__decorate([(0,dt.AsnProp)({type:dt.AsnPropTypes.BitString})],kp.prototype,"publicKey",void 0);var Aa=class{constructor(e={}){Object.assign(this,e)}};wr.OriginatorIdentifierOrKey=Aa;gr.__decorate([(0,dt.AsnProp)({type:Ty.SubjectKeyIdentifier,context:0,implicit:!0,optional:!0})],Aa.prototype,"subjectKeyIdentifier",void 0);gr.__decorate([(0,dt.AsnProp)({type:kp,context:1,implicit:!0,optional:!0})],Aa.prototype,"originatorKey",void 0);gr.__decorate([(0,dt.AsnProp)({type:gZ.IssuerAndSerialNumber,optional:!0})],Aa.prototype,"issuerAndSerialNumber",void 0);wr.OriginatorIdentifierOrKey=Aa=gr.__decorate([(0,dt.AsnType)({type:dt.AsnTypeTypes.Choice})],Aa);var $a=class{constructor(e={}){this.version=BR.CMSVersion.v3,this.originator=new Aa,this.keyEncryptionAlgorithm=new BR.KeyEncryptionAlgorithmIdentifier,this.recipientEncryptedKeys=new Iy,Object.assign(this,e)}};wr.KeyAgreeRecipientInfo=$a;gr.__decorate([(0,dt.AsnProp)({type:dt.AsnPropTypes.Integer})],$a.prototype,"version",void 0);gr.__decorate([(0,dt.AsnProp)({type:Aa,context:0})],$a.prototype,"originator",void 0);gr.__decorate([(0,dt.AsnProp)({type:dt.OctetString,context:1,optional:!0})],$a.prototype,"ukm",void 0);gr.__decorate([(0,dt.AsnProp)({type:BR.KeyEncryptionAlgorithmIdentifier})],$a.prototype,"keyEncryptionAlgorithm",void 0);gr.__decorate([(0,dt.AsnProp)({type:Iy})],$a.prototype,"recipientEncryptedKeys",void 0)});var FR=y(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.KeyTransRecipientInfo=hl.RecipientIdentifier=void 0;var gl=(E(),I(T)),ti=z(),LR=zi(),Nhe=ay(),Rhe=tt(),fl=class{constructor(e={}){Object.assign(this,e)}};hl.RecipientIdentifier=fl;gl.__decorate([(0,ti.AsnProp)({type:Rhe.SubjectKeyIdentifier,context:0,implicit:!0})],fl.prototype,"subjectKeyIdentifier",void 0);gl.__decorate([(0,ti.AsnProp)({type:Nhe.IssuerAndSerialNumber})],fl.prototype,"issuerAndSerialNumber",void 0);hl.RecipientIdentifier=fl=gl.__decorate([(0,ti.AsnType)({type:ti.AsnTypeTypes.Choice})],fl);var ml=class{constructor(e={}){this.version=LR.CMSVersion.v0,this.rid=new fl,this.keyEncryptionAlgorithm=new LR.KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new ti.OctetString,Object.assign(this,e)}};hl.KeyTransRecipientInfo=ml;gl.__decorate([(0,ti.AsnProp)({type:ti.AsnPropTypes.Integer})],ml.prototype,"version",void 0);gl.__decorate([(0,ti.AsnProp)({type:fl})],ml.prototype,"rid",void 0);gl.__decorate([(0,ti.AsnProp)({type:LR.KeyEncryptionAlgorithmIdentifier})],ml.prototype,"keyEncryptionAlgorithm",void 0);gl.__decorate([(0,ti.AsnProp)({type:ti.OctetString})],ml.prototype,"encryptedKey",void 0)});var HR=y(Ap=>{"use strict";Object.defineProperty(Ap,"__esModule",{value:!0});Ap.KEKRecipientInfo=Ap.KEKIdentifier=void 0;var vl=(E(),I(T)),Xn=z(),zhe=DR(),VR=zi(),Pa=class{constructor(e={}){this.keyIdentifier=new Xn.OctetString,Object.assign(this,e)}};Ap.KEKIdentifier=Pa;vl.__decorate([(0,Xn.AsnProp)({type:Xn.OctetString})],Pa.prototype,"keyIdentifier",void 0);vl.__decorate([(0,Xn.AsnProp)({type:Xn.AsnPropTypes.GeneralizedTime,optional:!0})],Pa.prototype,"date",void 0);vl.__decorate([(0,Xn.AsnProp)({type:zhe.OtherKeyAttribute,optional:!0})],Pa.prototype,"other",void 0);var yl=class{constructor(e={}){this.version=VR.CMSVersion.v4,this.kekid=new Pa,this.keyEncryptionAlgorithm=new VR.KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new Xn.OctetString,Object.assign(this,e)}};Ap.KEKRecipientInfo=yl;vl.__decorate([(0,Xn.AsnProp)({type:Xn.AsnPropTypes.Integer})],yl.prototype,"version",void 0);vl.__decorate([(0,Xn.AsnProp)({type:Pa})],yl.prototype,"kekid",void 0);vl.__decorate([(0,Xn.AsnProp)({type:VR.KeyEncryptionAlgorithmIdentifier})],yl.prototype,"keyEncryptionAlgorithm",void 0);vl.__decorate([(0,Xn.AsnProp)({type:Xn.OctetString})],yl.prototype,"encryptedKey",void 0)});var GR=y(wS=>{"use strict";Object.defineProperty(wS,"__esModule",{value:!0});wS.PasswordRecipientInfo=void 0;var _S=(E(),I(T)),bl=z(),bS=zi(),_l=class{constructor(e={}){this.version=bS.CMSVersion.v0,this.keyEncryptionAlgorithm=new bS.KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new bl.OctetString,Object.assign(this,e)}};wS.PasswordRecipientInfo=_l;_S.__decorate([(0,bl.AsnProp)({type:bl.AsnPropTypes.Integer})],_l.prototype,"version",void 0);_S.__decorate([(0,bl.AsnProp)({type:bS.KeyDerivationAlgorithmIdentifier,context:0,optional:!0})],_l.prototype,"keyDerivationAlgorithm",void 0);_S.__decorate([(0,bl.AsnProp)({type:bS.KeyEncryptionAlgorithmIdentifier})],_l.prototype,"keyEncryptionAlgorithm",void 0);_S.__decorate([(0,bl.AsnProp)({type:bl.OctetString})],_l.prototype,"encryptedKey",void 0)});var WR=y(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});wl.RecipientInfo=wl.OtherRecipientInfo=void 0;var Ia=(E(),I(T)),ri=z(),Mhe=UR(),Dhe=FR(),qhe=HR(),Bhe=GR(),$p=class{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}};wl.OtherRecipientInfo=$p;Ia.__decorate([(0,ri.AsnProp)({type:ri.AsnPropTypes.ObjectIdentifier})],$p.prototype,"oriType",void 0);Ia.__decorate([(0,ri.AsnProp)({type:ri.AsnPropTypes.Any})],$p.prototype,"oriValue",void 0);var Ca=class{constructor(e={}){Object.assign(this,e)}};wl.RecipientInfo=Ca;Ia.__decorate([(0,ri.AsnProp)({type:Dhe.KeyTransRecipientInfo,optional:!0})],Ca.prototype,"ktri",void 0);Ia.__decorate([(0,ri.AsnProp)({type:Mhe.KeyAgreeRecipientInfo,context:1,implicit:!0,optional:!0})],Ca.prototype,"kari",void 0);Ia.__decorate([(0,ri.AsnProp)({type:qhe.KEKRecipientInfo,context:2,implicit:!0,optional:!0})],Ca.prototype,"kekri",void 0);Ia.__decorate([(0,ri.AsnProp)({type:Bhe.PasswordRecipientInfo,context:3,implicit:!0,optional:!0})],Ca.prototype,"pwri",void 0);Ia.__decorate([(0,ri.AsnProp)({type:$p,context:4,implicit:!0,optional:!0})],Ca.prototype,"ori",void 0);wl.RecipientInfo=Ca=Ia.__decorate([(0,ri.AsnType)({type:ri.AsnTypeTypes.Choice})],Ca)});var YR=y(Ey=>{"use strict";var ZR;Object.defineProperty(Ey,"__esModule",{value:!0});Ey.RecipientInfos=void 0;var Uhe=(E(),I(T)),KR=z(),Lhe=WR(),JR=ZR=class extends KR.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,ZR.prototype)}};Ey.RecipientInfos=JR;Ey.RecipientInfos=JR=ZR=Uhe.__decorate([(0,KR.AsnType)({type:KR.AsnTypeTypes.Set,itemType:Lhe.RecipientInfo})],JR)});var xS=y(Pr=>{"use strict";var QR;Object.defineProperty(Pr,"__esModule",{value:!0});Pr.RevocationInfoChoices=Pr.RevocationInfoChoice=Pr.OtherRevocationInfoFormat=Pr.id_ri_scvp=Pr.id_ri_ocsp_response=Pr.id_ri=void 0;var jy=(E(),I(T)),qi=z(),Fhe=tt();Pr.id_ri=`${Fhe.id_pkix}.16`;Pr.id_ri_ocsp_response=`${Pr.id_ri}.2`;Pr.id_ri_scvp=`${Pr.id_ri}.4`;var xl=class{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}};Pr.OtherRevocationInfoFormat=xl;jy.__decorate([(0,qi.AsnProp)({type:qi.AsnPropTypes.ObjectIdentifier})],xl.prototype,"otherRevInfoFormat",void 0);jy.__decorate([(0,qi.AsnProp)({type:qi.AsnPropTypes.Any})],xl.prototype,"otherRevInfo",void 0);var Oy=class{constructor(e={}){this.other=new xl,Object.assign(this,e)}};Pr.RevocationInfoChoice=Oy;jy.__decorate([(0,qi.AsnProp)({type:xl,context:1,implicit:!0})],Oy.prototype,"other",void 0);Pr.RevocationInfoChoice=Oy=jy.__decorate([(0,qi.AsnType)({type:qi.AsnTypeTypes.Choice})],Oy);var XR=QR=class extends qi.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,QR.prototype)}};Pr.RevocationInfoChoices=XR;Pr.RevocationInfoChoices=XR=QR=jy.__decorate([(0,qi.AsnType)({type:qi.AsnTypeTypes.Set,itemType:Oy})],XR)});var ez=y(SS=>{"use strict";Object.defineProperty(SS,"__esModule",{value:!0});SS.OriginatorInfo=void 0;var yZ=(E(),I(T)),vZ=z(),Vhe=mS(),Hhe=xS(),Ny=class{constructor(e={}){Object.assign(this,e)}};SS.OriginatorInfo=Ny;yZ.__decorate([(0,vZ.AsnProp)({type:Vhe.CertificateSet,context:0,implicit:!0,optional:!0})],Ny.prototype,"certs",void 0);yZ.__decorate([(0,vZ.AsnProp)({type:Hhe.RevocationInfoChoices,context:1,implicit:!0,optional:!0})],Ny.prototype,"crls",void 0)});var wZ=y(Sl=>{"use strict";var tz;Object.defineProperty(Sl,"__esModule",{value:!0});Sl.EnvelopedData=Sl.UnprotectedAttributes=void 0;var Pp=(E(),I(T)),ks=z(),Ghe=zi(),Whe=F0(),bZ=YR(),Zhe=ez(),_Z=MR(),kS=tz=class extends ks.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,tz.prototype)}};Sl.UnprotectedAttributes=kS;Sl.UnprotectedAttributes=kS=tz=Pp.__decorate([(0,ks.AsnType)({type:ks.AsnTypeTypes.Set,itemType:Whe.Attribute})],kS);var Ta=class{constructor(e={}){this.version=Ghe.CMSVersion.v0,this.recipientInfos=new bZ.RecipientInfos,this.encryptedContentInfo=new _Z.EncryptedContentInfo,Object.assign(this,e)}};Sl.EnvelopedData=Ta;Pp.__decorate([(0,ks.AsnProp)({type:ks.AsnPropTypes.Integer})],Ta.prototype,"version",void 0);Pp.__decorate([(0,ks.AsnProp)({type:Zhe.OriginatorInfo,context:0,implicit:!0,optional:!0})],Ta.prototype,"originatorInfo",void 0);Pp.__decorate([(0,ks.AsnProp)({type:bZ.RecipientInfos})],Ta.prototype,"recipientInfos",void 0);Pp.__decorate([(0,ks.AsnProp)({type:_Z.EncryptedContentInfo})],Ta.prototype,"encryptedContentInfo",void 0);Pp.__decorate([(0,ks.AsnProp)({type:kS,context:1,implicit:!0,optional:!0})],Ta.prototype,"unprotectedAttrs",void 0)});var xZ=y(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.id_authData=en.id_encryptedData=en.id_digestedData=en.id_envelopedData=en.id_signedData=en.id_data=en.id_ct_contentInfo=void 0;en.id_ct_contentInfo="1.2.840.113549.1.9.16.1.6";en.id_data="1.2.840.113549.1.7.1";en.id_signedData="1.2.840.113549.1.7.2";en.id_envelopedData="1.2.840.113549.1.7.3";en.id_digestedData="1.2.840.113549.1.7.5";en.id_encryptedData="1.2.840.113549.1.7.6";en.id_authData="1.2.840.113549.1.9.16.1.2"});var $Z=y(kl=>{"use strict";var rz;Object.defineProperty(kl,"__esModule",{value:!0});kl.SignedData=kl.DigestAlgorithmIdentifiers=void 0;var Al=(E(),I(T)),Bi=z(),Khe=mS(),SZ=zi(),kZ=zR(),Jhe=xS(),AZ=V0(),Ry=rz=class extends Bi.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,rz.prototype)}};kl.DigestAlgorithmIdentifiers=Ry;kl.DigestAlgorithmIdentifiers=Ry=rz=Al.__decorate([(0,Bi.AsnType)({type:Bi.AsnTypeTypes.Set,itemType:SZ.DigestAlgorithmIdentifier})],Ry);var As=class{constructor(e={}){this.version=SZ.CMSVersion.v0,this.digestAlgorithms=new Ry,this.encapContentInfo=new kZ.EncapsulatedContentInfo,this.signerInfos=new AZ.SignerInfos,Object.assign(this,e)}};kl.SignedData=As;Al.__decorate([(0,Bi.AsnProp)({type:Bi.AsnPropTypes.Integer})],As.prototype,"version",void 0);Al.__decorate([(0,Bi.AsnProp)({type:Ry})],As.prototype,"digestAlgorithms",void 0);Al.__decorate([(0,Bi.AsnProp)({type:kZ.EncapsulatedContentInfo})],As.prototype,"encapContentInfo",void 0);Al.__decorate([(0,Bi.AsnProp)({type:Khe.CertificateSet,context:0,implicit:!0,optional:!0})],As.prototype,"certificates",void 0);Al.__decorate([(0,Bi.AsnProp)({type:Jhe.RevocationInfoChoices,context:1,implicit:!0,optional:!0})],As.prototype,"crls",void 0);Al.__decorate([(0,Bi.AsnProp)({type:AZ.SignerInfos})],As.prototype,"signerInfos",void 0)});var zy=y(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});var cr=(E(),I(T));cr.__exportStar(UW(),Kt);cr.__exportStar(F0(),Kt);cr.__exportStar(mS(),Kt);cr.__exportStar(fZ(),Kt);cr.__exportStar(zR(),Kt);cr.__exportStar(MR(),Kt);cr.__exportStar(wZ(),Kt);cr.__exportStar(ay(),Kt);cr.__exportStar(HR(),Kt);cr.__exportStar(UR(),Kt);cr.__exportStar(FR(),Kt);cr.__exportStar(xZ(),Kt);cr.__exportStar(ez(),Kt);cr.__exportStar(GR(),Kt);cr.__exportStar(WR(),Kt);cr.__exportStar(YR(),Kt);cr.__exportStar(xS(),Kt);cr.__exportStar($Z(),Kt);cr.__exportStar(FN(),Kt);cr.__exportStar(V0(),Kt);cr.__exportStar(zi(),Kt)});var nz=y(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.id_sect571r1=we.id_sect571k1=we.id_secp521r1=we.id_sect409r1=we.id_sect409k1=we.id_secp384r1=we.id_sect283r1=we.id_sect283k1=we.id_secp256r1=we.id_sect233r1=we.id_sect233k1=we.id_secp224r1=we.id_sect163r2=we.id_sect163k1=we.id_secp192r1=we.id_ecdsaWithSHA512=we.id_ecdsaWithSHA384=we.id_ecdsaWithSHA256=we.id_ecdsaWithSHA224=we.id_ecdsaWithSHA1=we.id_ecMQV=we.id_ecDH=we.id_ecPublicKey=void 0;we.id_ecPublicKey="1.2.840.10045.2.1";we.id_ecDH="1.3.132.1.12";we.id_ecMQV="1.3.132.1.13";we.id_ecdsaWithSHA1="1.2.840.10045.4.1";we.id_ecdsaWithSHA224="1.2.840.10045.4.3.1";we.id_ecdsaWithSHA256="1.2.840.10045.4.3.2";we.id_ecdsaWithSHA384="1.2.840.10045.4.3.3";we.id_ecdsaWithSHA512="1.2.840.10045.4.3.4";we.id_secp192r1="1.2.840.10045.3.1.1";we.id_sect163k1="1.3.132.0.1";we.id_sect163r2="1.3.132.0.15";we.id_secp224r1="1.3.132.0.33";we.id_sect233k1="1.3.132.0.26";we.id_sect233r1="1.3.132.0.27";we.id_secp256r1="1.2.840.10045.3.1.7";we.id_sect283k1="1.3.132.0.16";we.id_sect283r1="1.3.132.0.17";we.id_secp384r1="1.3.132.0.34";we.id_sect409k1="1.3.132.0.36";we.id_sect409r1="1.3.132.0.37";we.id_secp521r1="1.3.132.0.35";we.id_sect571k1="1.3.132.0.38";we.id_sect571r1="1.3.132.0.39"});var PZ=y(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.ecdsaWithSHA512=ko.ecdsaWithSHA384=ko.ecdsaWithSHA256=ko.ecdsaWithSHA224=ko.ecdsaWithSHA1=void 0;var Yhe=tt(),My=nz();function Dy(t){return new Yhe.AlgorithmIdentifier({algorithm:t})}ko.ecdsaWithSHA1=Dy(My.id_ecdsaWithSHA1);ko.ecdsaWithSHA224=Dy(My.id_ecdsaWithSHA224);ko.ecdsaWithSHA256=Dy(My.id_ecdsaWithSHA256);ko.ecdsaWithSHA384=Dy(My.id_ecdsaWithSHA384);ko.ecdsaWithSHA512=Dy(My.id_ecdsaWithSHA512)});var sz=y(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.SpecifiedECDomain=Lr.ECPVer=Lr.Curve=Lr.FieldElement=Lr.ECPoint=Lr.FieldID=void 0;var jn=(E(),I(T)),bt=z(),Cp=class{constructor(e={}){Object.assign(this,e)}};Lr.FieldID=Cp;jn.__decorate([(0,bt.AsnProp)({type:bt.AsnPropTypes.ObjectIdentifier})],Cp.prototype,"fieldType",void 0);jn.__decorate([(0,bt.AsnProp)({type:bt.AsnPropTypes.Any})],Cp.prototype,"parameters",void 0);Lr.FieldID=Cp=jn.__decorate([(0,bt.AsnType)({type:bt.AsnTypeTypes.Sequence})],Cp);var AS=class extends bt.OctetString{};Lr.ECPoint=AS;var oz=class extends bt.OctetString{};Lr.FieldElement=oz;var $l=class{constructor(e={}){Object.assign(this,e)}};Lr.Curve=$l;jn.__decorate([(0,bt.AsnProp)({type:bt.AsnPropTypes.OctetString})],$l.prototype,"a",void 0);jn.__decorate([(0,bt.AsnProp)({type:bt.AsnPropTypes.OctetString})],$l.prototype,"b",void 0);jn.__decorate([(0,bt.AsnProp)({type:bt.AsnPropTypes.BitString,optional:!0})],$l.prototype,"seed",void 0);Lr.Curve=$l=jn.__decorate([(0,bt.AsnType)({type:bt.AsnTypeTypes.Sequence})],$l);var iz;(function(t){t[t.ecpVer1=1]="ecpVer1"})(iz||(Lr.ECPVer=iz={}));var $s=class{constructor(e={}){this.version=iz.ecpVer1,Object.assign(this,e)}};Lr.SpecifiedECDomain=$s;jn.__decorate([(0,bt.AsnProp)({type:bt.AsnPropTypes.Integer})],$s.prototype,"version",void 0);jn.__decorate([(0,bt.AsnProp)({type:Cp})],$s.prototype,"fieldID",void 0);jn.__decorate([(0,bt.AsnProp)({type:$l})],$s.prototype,"curve",void 0);jn.__decorate([(0,bt.AsnProp)({type:AS})],$s.prototype,"base",void 0);jn.__decorate([(0,bt.AsnProp)({type:bt.AsnPropTypes.Integer,converter:bt.AsnIntegerArrayBufferConverter})],$s.prototype,"order",void 0);jn.__decorate([(0,bt.AsnProp)({type:bt.AsnPropTypes.Integer,optional:!0})],$s.prototype,"cofactor",void 0);Lr.SpecifiedECDomain=$s=jn.__decorate([(0,bt.AsnType)({type:bt.AsnTypeTypes.Sequence})],$s)});var az=y(qy=>{"use strict";Object.defineProperty(qy,"__esModule",{value:!0});qy.ECParameters=void 0;var $S=(E(),I(T)),Pl=z(),Qhe=sz(),Ip=class{constructor(e={}){Object.assign(this,e)}};qy.ECParameters=Ip;$S.__decorate([(0,Pl.AsnProp)({type:Pl.AsnPropTypes.ObjectIdentifier})],Ip.prototype,"namedCurve",void 0);$S.__decorate([(0,Pl.AsnProp)({type:Pl.AsnPropTypes.Null})],Ip.prototype,"implicitCurve",void 0);$S.__decorate([(0,Pl.AsnProp)({type:Qhe.SpecifiedECDomain})],Ip.prototype,"specifiedCurve",void 0);qy.ECParameters=Ip=$S.__decorate([(0,Pl.AsnType)({type:Pl.AsnTypeTypes.Choice})],Ip)});var CZ=y(CS=>{"use strict";Object.defineProperty(CS,"__esModule",{value:!0});CS.ECPrivateKey=void 0;var PS=(E(),I(T)),Ea=z(),Xhe=az(),Cl=class{constructor(e={}){this.version=1,this.privateKey=new Ea.OctetString,Object.assign(this,e)}};CS.ECPrivateKey=Cl;PS.__decorate([(0,Ea.AsnProp)({type:Ea.AsnPropTypes.Integer})],Cl.prototype,"version",void 0);PS.__decorate([(0,Ea.AsnProp)({type:Ea.OctetString})],Cl.prototype,"privateKey",void 0);PS.__decorate([(0,Ea.AsnProp)({type:Xhe.ECParameters,context:0,optional:!0})],Cl.prototype,"parameters",void 0);PS.__decorate([(0,Ea.AsnProp)({type:Ea.AsnPropTypes.BitString,context:1,optional:!0})],Cl.prototype,"publicKey",void 0)});var TZ=y(IS=>{"use strict";Object.defineProperty(IS,"__esModule",{value:!0});IS.ECDSASigValue=void 0;var IZ=(E(),I(T)),Tp=z(),By=class{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}};IS.ECDSASigValue=By;IZ.__decorate([(0,Tp.AsnProp)({type:Tp.AsnPropTypes.Integer,converter:Tp.AsnIntegerArrayBufferConverter})],By.prototype,"r",void 0);IZ.__decorate([(0,Tp.AsnProp)({type:Tp.AsnPropTypes.Integer,converter:Tp.AsnIntegerArrayBufferConverter})],By.prototype,"s",void 0)});var EZ=y(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});var Ep=(E(),I(T));Ep.__exportStar(PZ(),Oa);Ep.__exportStar(az(),Oa);Ep.__exportStar(CZ(),Oa);Ep.__exportStar(TZ(),Oa);Ep.__exportStar(nz(),Oa);Ep.__exportStar(sz(),Oa)});var Uy=y(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.id_mgf1=Q.id_md5=Q.id_md2=Q.id_sha512_256=Q.id_sha512_224=Q.id_sha512=Q.id_sha384=Q.id_sha256=Q.id_sha224=Q.id_sha1=Q.id_sha512_256WithRSAEncryption=Q.id_sha512_224WithRSAEncryption=Q.id_sha512WithRSAEncryption=Q.id_sha384WithRSAEncryption=Q.id_sha256WithRSAEncryption=Q.id_ssha224WithRSAEncryption=Q.id_sha224WithRSAEncryption=Q.id_sha1WithRSAEncryption=Q.id_md5WithRSAEncryption=Q.id_md2WithRSAEncryption=Q.id_RSASSA_PSS=Q.id_pSpecified=Q.id_RSAES_OAEP=Q.id_rsaEncryption=Q.id_pkcs_1=void 0;Q.id_pkcs_1="1.2.840.113549.1.1";Q.id_rsaEncryption=`${Q.id_pkcs_1}.1`;Q.id_RSAES_OAEP=`${Q.id_pkcs_1}.7`;Q.id_pSpecified=`${Q.id_pkcs_1}.9`;Q.id_RSASSA_PSS=`${Q.id_pkcs_1}.10`;Q.id_md2WithRSAEncryption=`${Q.id_pkcs_1}.2`;Q.id_md5WithRSAEncryption=`${Q.id_pkcs_1}.4`;Q.id_sha1WithRSAEncryption=`${Q.id_pkcs_1}.5`;Q.id_sha224WithRSAEncryption=`${Q.id_pkcs_1}.14`;Q.id_ssha224WithRSAEncryption=Q.id_sha224WithRSAEncryption;Q.id_sha256WithRSAEncryption=`${Q.id_pkcs_1}.11`;Q.id_sha384WithRSAEncryption=`${Q.id_pkcs_1}.12`;Q.id_sha512WithRSAEncryption=`${Q.id_pkcs_1}.13`;Q.id_sha512_224WithRSAEncryption=`${Q.id_pkcs_1}.15`;Q.id_sha512_256WithRSAEncryption=`${Q.id_pkcs_1}.16`;Q.id_sha1="1.3.14.3.2.26";Q.id_sha224="2.16.840.1.101.3.4.2.4";Q.id_sha256="2.16.840.1.101.3.4.2.1";Q.id_sha384="2.16.840.1.101.3.4.2.2";Q.id_sha512="2.16.840.1.101.3.4.2.3";Q.id_sha512_224="2.16.840.1.101.3.4.2.5";Q.id_sha512_256="2.16.840.1.101.3.4.2.6";Q.id_md2="1.2.840.113549.2.2";Q.id_md5="1.2.840.113549.2.5";Q.id_mgf1=`${Q.id_pkcs_1}.8`});var TS=y(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.sha512_256WithRSAEncryption=Pe.sha512_224WithRSAEncryption=Pe.sha512WithRSAEncryption=Pe.sha384WithRSAEncryption=Pe.sha256WithRSAEncryption=Pe.sha224WithRSAEncryption=Pe.sha1WithRSAEncryption=Pe.md5WithRSAEncryption=Pe.md2WithRSAEncryption=Pe.rsaEncryption=Pe.pSpecifiedEmpty=Pe.mgf1SHA1=Pe.sha512_256=Pe.sha512_224=Pe.sha512=Pe.sha384=Pe.sha256=Pe.sha224=Pe.sha1=Pe.md4=Pe.md2=void 0;var cz=z(),lz=tt(),lr=Uy();function xr(t){return new lz.AlgorithmIdentifier({algorithm:t,parameters:null})}Pe.md2=xr(lr.id_md2);Pe.md4=xr(lr.id_md5);Pe.sha1=xr(lr.id_sha1);Pe.sha224=xr(lr.id_sha224);Pe.sha256=xr(lr.id_sha256);Pe.sha384=xr(lr.id_sha384);Pe.sha512=xr(lr.id_sha512);Pe.sha512_224=xr(lr.id_sha512_224);Pe.sha512_256=xr(lr.id_sha512_256);Pe.mgf1SHA1=new lz.AlgorithmIdentifier({algorithm:lr.id_mgf1,parameters:cz.AsnConvert.serialize(Pe.sha1)});Pe.pSpecifiedEmpty=new lz.AlgorithmIdentifier({algorithm:lr.id_pSpecified,parameters:cz.AsnConvert.serialize(cz.AsnOctetStringConverter.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});Pe.rsaEncryption=xr(lr.id_rsaEncryption);Pe.md2WithRSAEncryption=xr(lr.id_md2WithRSAEncryption);Pe.md5WithRSAEncryption=xr(lr.id_md5WithRSAEncryption);Pe.sha1WithRSAEncryption=xr(lr.id_sha1WithRSAEncryption);Pe.sha224WithRSAEncryption=xr(lr.id_sha512_224WithRSAEncryption);Pe.sha256WithRSAEncryption=xr(lr.id_sha512_256WithRSAEncryption);Pe.sha384WithRSAEncryption=xr(lr.id_sha384WithRSAEncryption);Pe.sha512WithRSAEncryption=xr(lr.id_sha512WithRSAEncryption);Pe.sha512_224WithRSAEncryption=xr(lr.id_sha512_224WithRSAEncryption);Pe.sha512_256WithRSAEncryption=xr(lr.id_sha512_256WithRSAEncryption)});var jZ=y(jp=>{"use strict";Object.defineProperty(jp,"__esModule",{value:!0});jp.RSAES_OAEP=jp.RsaEsOaepParams=void 0;var uz=(E(),I(T)),Ly=z(),Il=tt(),OZ=Uy(),Op=TS(),Tl=class{constructor(e={}){this.hashAlgorithm=new Il.AlgorithmIdentifier(Op.sha1),this.maskGenAlgorithm=new Il.AlgorithmIdentifier({algorithm:OZ.id_mgf1,parameters:Ly.AsnConvert.serialize(Op.sha1)}),this.pSourceAlgorithm=new Il.AlgorithmIdentifier(Op.pSpecifiedEmpty),Object.assign(this,e)}};jp.RsaEsOaepParams=Tl;uz.__decorate([(0,Ly.AsnProp)({type:Il.AlgorithmIdentifier,context:0,defaultValue:Op.sha1})],Tl.prototype,"hashAlgorithm",void 0);uz.__decorate([(0,Ly.AsnProp)({type:Il.AlgorithmIdentifier,context:1,defaultValue:Op.mgf1SHA1})],Tl.prototype,"maskGenAlgorithm",void 0);uz.__decorate([(0,Ly.AsnProp)({type:Il.AlgorithmIdentifier,context:2,defaultValue:Op.pSpecifiedEmpty})],Tl.prototype,"pSourceAlgorithm",void 0);jp.RSAES_OAEP=new Il.AlgorithmIdentifier({algorithm:OZ.id_RSAES_OAEP,parameters:Ly.AsnConvert.serialize(new Tl)})});var RZ=y(Np=>{"use strict";Object.defineProperty(Np,"__esModule",{value:!0});Np.RSASSA_PSS=Np.RsaSaPssParams=void 0;var OS=(E(),I(T)),ja=z(),Fy=tt(),NZ=Uy(),ES=TS(),Na=class{constructor(e={}){this.hashAlgorithm=new Fy.AlgorithmIdentifier(ES.sha1),this.maskGenAlgorithm=new Fy.AlgorithmIdentifier({algorithm:NZ.id_mgf1,parameters:ja.AsnConvert.serialize(ES.sha1)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}};Np.RsaSaPssParams=Na;OS.__decorate([(0,ja.AsnProp)({type:Fy.AlgorithmIdentifier,context:0,defaultValue:ES.sha1})],Na.prototype,"hashAlgorithm",void 0);OS.__decorate([(0,ja.AsnProp)({type:Fy.AlgorithmIdentifier,context:1,defaultValue:ES.mgf1SHA1})],Na.prototype,"maskGenAlgorithm",void 0);OS.__decorate([(0,ja.AsnProp)({type:ja.AsnPropTypes.Integer,context:2,defaultValue:20})],Na.prototype,"saltLength",void 0);OS.__decorate([(0,ja.AsnProp)({type:ja.AsnPropTypes.Integer,context:3,defaultValue:1})],Na.prototype,"trailerField",void 0);Np.RSASSA_PSS=new Fy.AlgorithmIdentifier({algorithm:NZ.id_RSASSA_PSS,parameters:ja.AsnConvert.serialize(new Na)})});var DZ=y(NS=>{"use strict";Object.defineProperty(NS,"__esModule",{value:!0});NS.DigestInfo=void 0;var zZ=(E(),I(T)),MZ=tt(),jS=z(),Vy=class{constructor(e={}){this.digestAlgorithm=new MZ.AlgorithmIdentifier,this.digest=new jS.OctetString,Object.assign(this,e)}};NS.DigestInfo=Vy;zZ.__decorate([(0,jS.AsnProp)({type:MZ.AlgorithmIdentifier})],Vy.prototype,"digestAlgorithm",void 0);zZ.__decorate([(0,jS.AsnProp)({type:jS.OctetString})],Vy.prototype,"digest",void 0)});var qZ=y(Hy=>{"use strict";Object.defineProperty(Hy,"__esModule",{value:!0});var dz=(E(),I(T));dz.__exportStar(jZ(),Hy);dz.__exportStar(RZ(),Hy);dz.__exportStar(DZ(),Hy)});var mz=y(Ol=>{"use strict";var pz;Object.defineProperty(Ol,"__esModule",{value:!0});Ol.OtherPrimeInfos=Ol.OtherPrimeInfo=void 0;var RS=(E(),I(T)),Ao=z(),El=class{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};Ol.OtherPrimeInfo=El;RS.__decorate([(0,Ao.AsnProp)({type:Ao.AsnPropTypes.Integer,converter:Ao.AsnIntegerArrayBufferConverter})],El.prototype,"prime",void 0);RS.__decorate([(0,Ao.AsnProp)({type:Ao.AsnPropTypes.Integer,converter:Ao.AsnIntegerArrayBufferConverter})],El.prototype,"exponent",void 0);RS.__decorate([(0,Ao.AsnProp)({type:Ao.AsnPropTypes.Integer,converter:Ao.AsnIntegerArrayBufferConverter})],El.prototype,"coefficient",void 0);var fz=pz=class extends Ao.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,pz.prototype)}};Ol.OtherPrimeInfos=fz;Ol.OtherPrimeInfos=fz=pz=RS.__decorate([(0,Ao.AsnType)({type:Ao.AsnTypeTypes.Sequence,itemType:El})],fz)});var BZ=y(zS=>{"use strict";Object.defineProperty(zS,"__esModule",{value:!0});zS.RSAPrivateKey=void 0;var Ui=(E(),I(T)),Pt=z(),ege=mz(),eo=class{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};zS.RSAPrivateKey=eo;Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer})],eo.prototype,"version",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer,converter:Pt.AsnIntegerArrayBufferConverter})],eo.prototype,"modulus",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer,converter:Pt.AsnIntegerArrayBufferConverter})],eo.prototype,"publicExponent",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer,converter:Pt.AsnIntegerArrayBufferConverter})],eo.prototype,"privateExponent",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer,converter:Pt.AsnIntegerArrayBufferConverter})],eo.prototype,"prime1",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer,converter:Pt.AsnIntegerArrayBufferConverter})],eo.prototype,"prime2",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer,converter:Pt.AsnIntegerArrayBufferConverter})],eo.prototype,"exponent1",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer,converter:Pt.AsnIntegerArrayBufferConverter})],eo.prototype,"exponent2",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:Pt.AsnPropTypes.Integer,converter:Pt.AsnIntegerArrayBufferConverter})],eo.prototype,"coefficient",void 0);Ui.__decorate([(0,Pt.AsnProp)({type:ege.OtherPrimeInfos,optional:!0})],eo.prototype,"otherPrimeInfos",void 0)});var LZ=y(MS=>{"use strict";Object.defineProperty(MS,"__esModule",{value:!0});MS.RSAPublicKey=void 0;var UZ=(E(),I(T)),Rp=z(),Gy=class{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}};MS.RSAPublicKey=Gy;UZ.__decorate([(0,Rp.AsnProp)({type:Rp.AsnPropTypes.Integer,converter:Rp.AsnIntegerArrayBufferConverter})],Gy.prototype,"modulus",void 0);UZ.__decorate([(0,Rp.AsnProp)({type:Rp.AsnPropTypes.Integer,converter:Rp.AsnIntegerArrayBufferConverter})],Gy.prototype,"publicExponent",void 0)});var hz=y(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});var zp=(E(),I(T));zp.__exportStar(qZ(),Ra);zp.__exportStar(TS(),Ra);zp.__exportStar(Uy(),Ra);zp.__exportStar(mz(),Ra);zp.__exportStar(BZ(),Ra);zp.__exportStar(LZ(),Ra)});var DS={};ve(DS,{__assign:()=>yz,__asyncDelegator:()=>fge,__asyncGenerator:()=>pge,__asyncValues:()=>mge,__await:()=>Wy,__awaiter:()=>sge,__classPrivateFieldGet:()=>vge,__classPrivateFieldSet:()=>bge,__createBinding:()=>cge,__decorate:()=>nge,__exportStar:()=>lge,__extends:()=>tge,__generator:()=>age,__importDefault:()=>yge,__importStar:()=>gge,__makeTemplateObject:()=>hge,__metadata:()=>ige,__param:()=>oge,__read:()=>FZ,__rest:()=>rge,__spread:()=>uge,__spreadArrays:()=>dge,__values:()=>vz});function tge(t,e){gz(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function rge(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r}function nge(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i}function oge(t,e){return function(r,n){e(r,n,t)}}function ige(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function sge(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(u){try{l(n.next(u))}catch(d){s(d)}}function c(u){try{l(n.throw(u))}catch(d){s(d)}}function l(u){u.done?i(u.value):o(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})}function age(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],o=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function cge(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function lge(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function vz(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function FZ(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function uge(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(FZ(arguments[e]));return t}function dge(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}function Wy(t){return this instanceof Wy?(this.v=t,this):new Wy(t)}function pge(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),o,i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(p){n[p]&&(o[p]=function(f){return new Promise(function(m,h){i.push([p,f,m,h])>1||a(p,f)})})}function a(p,f){try{c(n[p](f))}catch(m){d(i[0][3],m)}}function c(p){p.value instanceof Wy?Promise.resolve(p.value.v).then(l,u):d(i[0][2],p)}function l(p){a("next",p)}function u(p){a("throw",p)}function d(p,f){p(f),i.shift(),i.length&&a(i[0][0],i[0][1])}}function fge(t){var e,r;return e={},n("next"),n("throw",function(o){throw o}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(o,i){e[o]=t[o]?function(s){return(r=!r)?{value:Wy(t[o](s)),done:o==="return"}:i?i(s):s}:i}}function mge(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof vz=="function"?vz(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(s){return new Promise(function(a,c){s=t[i](s),o(a,c,s.done,s.value)})}}function o(i,s,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},s)}}function hge(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function gge(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function yge(t){return t&&t.__esModule?t:{default:t}}function vge(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function bge(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var gz,yz,qS=x(()=>{gz=function(t,e){return gz=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},gz(t,e)};yz=function(){return yz=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},yz.apply(this,arguments)}});var wz=y(_z=>{"use strict";Object.defineProperty(_z,"__esModule",{value:!0});var bz;(function(t){t[t.Transient=0]="Transient",t[t.Singleton=1]="Singleton",t[t.ResolutionScoped=2]="ResolutionScoped",t[t.ContainerScoped=3]="ContainerScoped"})(bz||(bz={}));_z.default=bz});var VZ=y(xz=>{"use strict";Object.defineProperty(xz,"__esModule",{value:!0});var _ge=wz();Object.defineProperty(xz,"Lifecycle",{enumerable:!0,get:function(){return _ge.default}})});var jl=y(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.defineInjectionTokenMetadata=ni.getParamInfo=ni.INJECTION_TOKEN_METADATA_KEY=void 0;ni.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function wge(t){let e=Reflect.getMetadata("design:paramtypes",t)||[],r=Reflect.getOwnMetadata(ni.INJECTION_TOKEN_METADATA_KEY,t)||{};return Object.keys(r).forEach(n=>{e[+n]=r[n]}),e}ni.getParamInfo=wge;function xge(t,e){return function(r,n,o){let i=Reflect.getOwnMetadata(ni.INJECTION_TOKEN_METADATA_KEY,r)||{};i[o]=e?{token:t,transform:e.transformToken,transformArgs:e.args||[]}:t,Reflect.defineMetadata(ni.INJECTION_TOKEN_METADATA_KEY,i,r)}}ni.defineInjectionTokenMetadata=xge});var Sz=y(BS=>{"use strict";Object.defineProperty(BS,"__esModule",{value:!0});BS.isClassProvider=void 0;function Sge(t){return!!t.useClass}BS.isClassProvider=Sge});var kz=y(US=>{"use strict";Object.defineProperty(US,"__esModule",{value:!0});US.isFactoryProvider=void 0;function kge(t){return!!t.useFactory}US.isFactoryProvider=kge});var FS=y(Mp=>{"use strict";Object.defineProperty(Mp,"__esModule",{value:!0});Mp.delay=Mp.DelayedConstructor=void 0;var LS=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let r={},n=!1,o,i=()=>(n||(o=e(this.wrap()),n=!0),o);return new Proxy(r,this.createHandler(i))}createHandler(e){let r={},n=o=>{r[o]=(...i)=>{i[0]=e();let s=Reflect[o];return s(...i)}};return this.reflectMethods.forEach(n),r}};Mp.DelayedConstructor=LS;function Age(t){if(typeof t>"u")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new LS(t)}Mp.delay=Age});var VS=y(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.isConstructorToken=Li.isTransformDescriptor=Li.isTokenDescriptor=Li.isNormalToken=void 0;var $ge=FS();function Pge(t){return typeof t=="string"||typeof t=="symbol"}Li.isNormalToken=Pge;function Cge(t){return typeof t=="object"&&"token"in t&&"multiple"in t}Li.isTokenDescriptor=Cge;function Ige(t){return typeof t=="object"&&"token"in t&&"transform"in t}Li.isTransformDescriptor=Ige;function Tge(t){return typeof t=="function"||t instanceof $ge.DelayedConstructor}Li.isConstructorToken=Tge});var Az=y(HS=>{"use strict";Object.defineProperty(HS,"__esModule",{value:!0});HS.isTokenProvider=void 0;function Ege(t){return!!t.useToken}HS.isTokenProvider=Ege});var $z=y(GS=>{"use strict";Object.defineProperty(GS,"__esModule",{value:!0});GS.isValueProvider=void 0;function Oge(t){return t.useValue!=null}GS.isValueProvider=Oge});var Pz=y(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});var jge=Sz();Object.defineProperty(Nl,"isClassProvider",{enumerable:!0,get:function(){return jge.isClassProvider}});var Nge=kz();Object.defineProperty(Nl,"isFactoryProvider",{enumerable:!0,get:function(){return Nge.isFactoryProvider}});var Rge=VS();Object.defineProperty(Nl,"isNormalToken",{enumerable:!0,get:function(){return Rge.isNormalToken}});var zge=Az();Object.defineProperty(Nl,"isTokenProvider",{enumerable:!0,get:function(){return zge.isTokenProvider}});var Mge=$z();Object.defineProperty(Nl,"isValueProvider",{enumerable:!0,get:function(){return Mge.isValueProvider}})});var HZ=y(WS=>{"use strict";Object.defineProperty(WS,"__esModule",{value:!0});WS.isProvider=void 0;var Dge=Sz(),qge=$z(),Bge=Az(),Uge=kz();function Lge(t){return Dge.isClassProvider(t)||qge.isValueProvider(t)||Bge.isTokenProvider(t)||Uge.isFactoryProvider(t)}WS.isProvider=Lge});var Tz=y(Iz=>{"use strict";Object.defineProperty(Iz,"__esModule",{value:!0});var Cz=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let r=this._registryMap.get(e);return r[r.length-1]||null}set(e,r){this.ensure(e),this._registryMap.get(e).push(r)}setAll(e,r){this._registryMap.set(e,r)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};Iz.default=Cz});var GZ=y(Oz=>{"use strict";Object.defineProperty(Oz,"__esModule",{value:!0});var Fge=Tz(),Ez=class extends Fge.default{};Oz.default=Ez});var WZ=y(Nz=>{"use strict";Object.defineProperty(Nz,"__esModule",{value:!0});var jz=class{constructor(){this.scopedResolutions=new Map}};Nz.default=jz});var Rz=y(ZS=>{"use strict";Object.defineProperty(ZS,"__esModule",{value:!0});ZS.formatErrorCtor=void 0;function Vge(t,e){return t===null?`at position #${e}`:`"${t.split(",")[e].trim()}" at position #${e}`}function Hge(t,e,r="    "){return[t,...e.message.split(`
`).map(n=>r+n)].join(`
`)}function Gge(t,e,r){let[,n=null]=t.toString().match(/constructor\(([\w, ]+)\)/)||[],o=Vge(n,e);return Hge(`Cannot inject the dependency ${o} of "${t.name}" constructor. Reason:`,r)}ZS.formatErrorCtor=Gge});var ZZ=y(KS=>{"use strict";Object.defineProperty(KS,"__esModule",{value:!0});KS.isDisposable=void 0;function Wge(t){return!(typeof t.dispose!="function"||t.dispose.length>0)}KS.isDisposable=Wge});var JZ=y(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});Rl.PostResolutionInterceptors=Rl.PreResolutionInterceptors=void 0;var KZ=Tz(),JS=class extends KZ.default{};Rl.PreResolutionInterceptors=JS;var YS=class extends KZ.default{};Rl.PostResolutionInterceptors=YS;var zz=class{constructor(){this.preResolution=new JS,this.postResolution=new YS}};Rl.default=zz});var za=y(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});Ps.instance=Ps.typeInfo=void 0;var Zge=(qS(),I(DS)),gn=Pz(),Kge=HZ(),QS=VS(),Jge=GZ(),Nn=wz(),XS=WZ(),Yge=Rz(),Qge=FS(),Xge=ZZ(),eye=JZ();Ps.typeInfo=new Map;var Mz=class t{constructor(e){this.parent=e,this._registry=new Jge.default,this.interceptors=new eye.default,this.disposed=!1,this.disposables=new Set}register(e,r,n={lifecycle:Nn.default.Transient}){this.ensureNotDisposed();let o;if(Kge.isProvider(r)?o=r:o={useClass:r},gn.isTokenProvider(o)){let i=[e],s=o;for(;s!=null;){let a=s.useToken;if(i.includes(a))throw new Error(`Token registration cycle detected! ${[...i,a].join(" -> ")}`);i.push(a);let c=this._registry.get(a);c&&gn.isTokenProvider(c.provider)?s=c.provider:s=null}}if((n.lifecycle===Nn.default.Singleton||n.lifecycle==Nn.default.ContainerScoped||n.lifecycle==Nn.default.ResolutionScoped)&&(gn.isValueProvider(o)||gn.isFactoryProvider(o)))throw new Error(`Cannot use lifecycle "${Nn.default[n.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:o,options:n}),this}registerType(e,r){return this.ensureNotDisposed(),gn.isNormalToken(r)?this.register(e,{useToken:r}):this.register(e,{useClass:r})}registerInstance(e,r){return this.ensureNotDisposed(),this.register(e,{useValue:r})}registerSingleton(e,r){if(this.ensureNotDisposed(),gn.isNormalToken(e)){if(gn.isNormalToken(r))return this.register(e,{useToken:r},{lifecycle:Nn.default.Singleton});if(r)return this.register(e,{useClass:r},{lifecycle:Nn.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let n=e;return r&&!gn.isNormalToken(r)&&(n=r),this.register(e,{useClass:n},{lifecycle:Nn.default.Singleton})}resolve(e,r=new XS.default,n=!1){this.ensureNotDisposed();let o=this.getRegistration(e);if(!o&&gn.isNormalToken(e)){if(n)return;throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"Single"),o){let i=this.resolveRegistration(o,r);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(QS.isConstructorToken(e)){let i=this.construct(e,r);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,r){if(this.interceptors.preResolution.has(e)){let n=[];for(let o of this.interceptors.preResolution.getAll(e))o.options.frequency!="Once"&&n.push(o),o.callback(e,r);this.interceptors.preResolution.setAll(e,n)}}executePostResolutionInterceptor(e,r,n){if(this.interceptors.postResolution.has(e)){let o=[];for(let i of this.interceptors.postResolution.getAll(e))i.options.frequency!="Once"&&o.push(i),i.callback(e,r,n);this.interceptors.postResolution.setAll(e,o)}}resolveRegistration(e,r){if(this.ensureNotDisposed(),e.options.lifecycle===Nn.default.ResolutionScoped&&r.scopedResolutions.has(e))return r.scopedResolutions.get(e);let n=e.options.lifecycle===Nn.default.Singleton,o=e.options.lifecycle===Nn.default.ContainerScoped,i=n||o,s;return gn.isValueProvider(e.provider)?s=e.provider.useValue:gn.isTokenProvider(e.provider)?s=i?e.instance||(e.instance=this.resolve(e.provider.useToken,r)):this.resolve(e.provider.useToken,r):gn.isClassProvider(e.provider)?s=i?e.instance||(e.instance=this.construct(e.provider.useClass,r)):this.construct(e.provider.useClass,r):gn.isFactoryProvider(e.provider)?s=e.provider.useFactory(this):s=this.construct(e.provider,r),e.options.lifecycle===Nn.default.ResolutionScoped&&r.scopedResolutions.set(e,s),s}resolveAll(e,r=new XS.default,n=!1){this.ensureNotDisposed();let o=this.getAllRegistrations(e);if(!o&&gn.isNormalToken(e)){if(n)return[];throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"All"),o){let s=o.map(a=>this.resolveRegistration(a,r));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,r)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,r=!1){return this.ensureNotDisposed(),this._registry.has(e)||r&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,r]of this._registry.entries())this._registry.setAll(e,r.filter(n=>!gn.isValueProvider(n.provider)).map(n=>(n.instance=void 0,n)))}createChildContainer(){this.ensureNotDisposed();let e=new t(this);for(let[r,n]of this._registry.entries())n.some(({options:o})=>o.lifecycle===Nn.default.ContainerScoped)&&e._registry.setAll(r,n.map(o=>o.options.lifecycle===Nn.default.ContainerScoped?{provider:o.provider,options:o.options}:o));return e}beforeResolution(e,r,n={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:r,options:n})}afterResolution(e,r,n={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:r,options:n})}dispose(){return Zge.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(r=>{let n=r.dispose();n&&e.push(n)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,r){if(e instanceof Qge.DelayedConstructor)return e.createProxy(o=>this.resolve(o,r));let n=(()=>{let o=Ps.typeInfo.get(e);if(!o||o.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let i=o.map(this.resolveParams(r,e));return new e(...i)})();return Xge.isDisposable(n)&&this.disposables.add(n),n}resolveParams(e,r){return(n,o)=>{try{return QS.isTokenDescriptor(n)?QS.isTransformDescriptor(n)?n.multiple?this.resolve(n.transform).transform(this.resolveAll(n.token,new XS.default,n.isOptional),...n.transformArgs):this.resolve(n.transform).transform(this.resolve(n.token,e,n.isOptional),...n.transformArgs):n.multiple?this.resolveAll(n.token,new XS.default,n.isOptional):this.resolve(n.token,e,n.isOptional):QS.isTransformDescriptor(n)?this.resolve(n.transform,e).transform(this.resolve(n.token,e),...n.transformArgs):this.resolve(n,e)}catch(i){throw new Error(Yge.formatErrorCtor(r,o,i))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};Ps.instance=new Mz;Ps.default=Ps.instance});var YZ=y(qz=>{"use strict";Object.defineProperty(qz,"__esModule",{value:!0});var tye=jl(),Cs=za(),Dz=VS(),rye=Rz();function nye(){return function(t){let e=tye.getParamInfo(t);return class extends t{constructor(...r){super(...r.concat(e.slice(r.length).map((n,o)=>{try{return Dz.isTokenDescriptor(n)?Dz.isTransformDescriptor(n)?n.multiple?Cs.instance.resolve(n.transform).transform(Cs.instance.resolveAll(n.token),...n.transformArgs):Cs.instance.resolve(n.transform).transform(Cs.instance.resolve(n.token),...n.transformArgs):n.multiple?Cs.instance.resolveAll(n.token):Cs.instance.resolve(n.token):Dz.isTransformDescriptor(n)?Cs.instance.resolve(n.transform).transform(Cs.instance.resolve(n.token),...n.transformArgs):Cs.instance.resolve(n)}catch(i){let s=o+r.length;throw new Error(rye.formatErrorCtor(t,s,i))}})))}}}}qz.default=nye});var QZ=y(Bz=>{"use strict";Object.defineProperty(Bz,"__esModule",{value:!0});var oye=jl();function iye(t,e){let r={token:t,multiple:!1,isOptional:e&&e.isOptional};return oye.defineInjectionTokenMetadata(r)}Bz.default=iye});var ek=y(Uz=>{"use strict";Object.defineProperty(Uz,"__esModule",{value:!0});var sye=jl(),aye=za(),XZ=za();function cye(t){return function(e){aye.typeInfo.set(e,sye.getParamInfo(e)),t&&t.token&&(Array.isArray(t.token)?t.token.forEach(r=>{XZ.instance.register(r,e)}):XZ.instance.register(t.token,e))}}Uz.default=cye});var e8=y(Lz=>{"use strict";Object.defineProperty(Lz,"__esModule",{value:!0});var lye=(qS(),I(DS)),uye=za();function dye(t=[]){return function(e){return t.forEach(r=>{var{token:n,options:o}=r,i=lye.__rest(r,["token","options"]);return uye.instance.register(n,i,o)}),e}}Lz.default=dye});var t8=y(Fz=>{"use strict";Object.defineProperty(Fz,"__esModule",{value:!0});var pye=ek(),fye=za();function mye(){return function(t){pye.default()(t),fye.instance.registerSingleton(t)}}Fz.default=mye});var r8=y(Vz=>{"use strict";Object.defineProperty(Vz,"__esModule",{value:!0});var hye=jl();function gye(t,e){let r={token:t,multiple:!0,isOptional:e&&e.isOptional};return hye.defineInjectionTokenMetadata(r)}Vz.default=gye});var n8=y(Hz=>{"use strict";Object.defineProperty(Hz,"__esModule",{value:!0});var yye=jl();function vye(t,e,...r){let n={token:t,multiple:!0,transform:e,transformArgs:r};return yye.defineInjectionTokenMetadata(n)}Hz.default=vye});var o8=y(Gz=>{"use strict";Object.defineProperty(Gz,"__esModule",{value:!0});var bye=jl();function _ye(t,e,...r){return bye.defineInjectionTokenMetadata(t,{transformToken:e,args:r})}Gz.default=_ye});var i8=y(Wz=>{"use strict";Object.defineProperty(Wz,"__esModule",{value:!0});var wye=ek(),xye=za();function Sye(t,e){return function(r){wye.default()(r),xye.instance.register(e||r,r,{lifecycle:t})}}Wz.default=Sye});var s8=y(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});var kye=YZ();Object.defineProperty(oi,"autoInjectable",{enumerable:!0,get:function(){return kye.default}});var Aye=QZ();Object.defineProperty(oi,"inject",{enumerable:!0,get:function(){return Aye.default}});var $ye=ek();Object.defineProperty(oi,"injectable",{enumerable:!0,get:function(){return $ye.default}});var Pye=e8();Object.defineProperty(oi,"registry",{enumerable:!0,get:function(){return Pye.default}});var Cye=t8();Object.defineProperty(oi,"singleton",{enumerable:!0,get:function(){return Cye.default}});var Iye=r8();Object.defineProperty(oi,"injectAll",{enumerable:!0,get:function(){return Iye.default}});var Tye=n8();Object.defineProperty(oi,"injectAllWithTransform",{enumerable:!0,get:function(){return Tye.default}});var Eye=o8();Object.defineProperty(oi,"injectWithTransform",{enumerable:!0,get:function(){return Eye.default}});var Oye=i8();Object.defineProperty(oi,"scoped",{enumerable:!0,get:function(){return Oye.default}})});var a8=y(Zz=>{"use strict";Object.defineProperty(Zz,"__esModule",{value:!0});function jye(t){let e;return r=>(e==null&&(e=t(r)),e)}Zz.default=jye});var c8=y(Kz=>{"use strict";Object.defineProperty(Kz,"__esModule",{value:!0});function Nye(t){let e=new WeakMap;return r=>{let n=e.get(r);return n==null&&(n=t(r),e.set(r,n)),n}}Kz.default=Nye});var l8=y(Jz=>{"use strict";Object.defineProperty(Jz,"__esModule",{value:!0});function Rye(t,e,r,n=!0){let o,i;return s=>{let a=t(s);return(!n||i!==a)&&((i=a)?o=s.resolve(e):o=s.resolve(r)),o}}Jz.default=Rye});var u8=y(Zy=>{"use strict";Object.defineProperty(Zy,"__esModule",{value:!0});var zye=a8();Object.defineProperty(Zy,"instanceCachingFactory",{enumerable:!0,get:function(){return zye.default}});var Mye=c8();Object.defineProperty(Zy,"instancePerContainerCachingFactory",{enumerable:!0,get:function(){return Mye.default}});var Dye=l8();Object.defineProperty(Zy,"predicateAwareClassFactory",{enumerable:!0,get:function(){return Dye.default}})});var d8=y(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});var Yz=(qS(),I(DS));if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var qye=VZ();Object.defineProperty(Ma,"Lifecycle",{enumerable:!0,get:function(){return qye.Lifecycle}});Yz.__exportStar(s8(),Ma);Yz.__exportStar(u8(),Ma);Yz.__exportStar(Pz(),Ma);var Bye=FS();Object.defineProperty(Ma,"delay",{enumerable:!0,get:function(){return Bye.delay}});var Uye=za();Object.defineProperty(Ma,"container",{enumerable:!0,get:function(){return Uye.instance}})});var tM=y(Ml=>{"use strict";var Qz;Object.defineProperty(Ml,"__esModule",{value:!0});Ml.PKCS12AttrSet=Ml.PKCS12Attribute=void 0;var eM=(E(),I(T)),zl=z(),Dp=class{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}};Ml.PKCS12Attribute=Dp;eM.__decorate([(0,zl.AsnProp)({type:zl.AsnPropTypes.ObjectIdentifier})],Dp.prototype,"attrId",void 0);eM.__decorate([(0,zl.AsnProp)({type:zl.AsnPropTypes.Any,repeated:"set"})],Dp.prototype,"attrValues",void 0);var Xz=Qz=class extends zl.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Qz.prototype)}};Ml.PKCS12AttrSet=Xz;Ml.PKCS12AttrSet=Xz=Qz=eM.__decorate([(0,zl.AsnType)({type:zl.AsnTypeTypes.Sequence,itemType:Dp})],Xz)});var p8=y(Ky=>{"use strict";var rM;Object.defineProperty(Ky,"__esModule",{value:!0});Ky.AuthenticatedSafe=void 0;var Lye=(E(),I(T)),nM=z(),Fye=zy(),oM=rM=class extends nM.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,rM.prototype)}};Ky.AuthenticatedSafe=oM;Ky.AuthenticatedSafe=oM=rM=Lye.__decorate([(0,nM.AsnType)({type:nM.AsnTypeTypes.Sequence,itemType:Fye.ContentInfo})],oM)});var iM=y(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.id_bagtypes=nt.id_pbewithSHAAnd40BitRC2_CBC=nt.id_pbeWithSHAAnd128BitRC2_CBC=nt.id_pbeWithSHAAnd2_KeyTripleDES_CBC=nt.id_pbeWithSHAAnd3_KeyTripleDES_CBC=nt.id_pbeWithSHAAnd40BitRC4=nt.id_pbeWithSHAAnd128BitRC4=nt.id_pkcs_12PbeIds=nt.id_pkcs_12=nt.id_pkcs=nt.id_rsadsi=void 0;nt.id_rsadsi="1.2.840.113549";nt.id_pkcs=`${nt.id_rsadsi}.1`;nt.id_pkcs_12=`${nt.id_pkcs}.12`;nt.id_pkcs_12PbeIds=`${nt.id_pkcs_12}.1`;nt.id_pbeWithSHAAnd128BitRC4=`${nt.id_pkcs_12PbeIds}.1`;nt.id_pbeWithSHAAnd40BitRC4=`${nt.id_pkcs_12PbeIds}.2`;nt.id_pbeWithSHAAnd3_KeyTripleDES_CBC=`${nt.id_pkcs_12PbeIds}.3`;nt.id_pbeWithSHAAnd2_KeyTripleDES_CBC=`${nt.id_pkcs_12PbeIds}.4`;nt.id_pbeWithSHAAnd128BitRC2_CBC=`${nt.id_pkcs_12PbeIds}.5`;nt.id_pbewithSHAAnd40BitRC2_CBC=`${nt.id_pkcs_12PbeIds}.6`;nt.id_bagtypes=`${nt.id_pkcs_12}.10.1`});var tk=y(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});tn.id_pkcs_9=tn.id_SafeContents=tn.id_SecretBag=tn.id_CRLBag=tn.id_certBag=tn.id_pkcs8ShroudedKeyBag=tn.id_keyBag=void 0;var qp=iM();tn.id_keyBag=`${qp.id_bagtypes}.1`;tn.id_pkcs8ShroudedKeyBag=`${qp.id_bagtypes}.2`;tn.id_certBag=`${qp.id_bagtypes}.3`;tn.id_CRLBag=`${qp.id_bagtypes}.4`;tn.id_SecretBag=`${qp.id_bagtypes}.5`;tn.id_SafeContents=`${qp.id_bagtypes}.6`;tn.id_pkcs_9="1.2.840.113549.1.9"});var m8=y($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.id_sdsiCertificate=$o.id_x509Certificate=$o.id_certTypes=$o.CertBag=void 0;var f8=(E(),I(T)),rk=z(),Vye=tk(),Jy=class{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}};$o.CertBag=Jy;f8.__decorate([(0,rk.AsnProp)({type:rk.AsnPropTypes.ObjectIdentifier})],Jy.prototype,"certId",void 0);f8.__decorate([(0,rk.AsnProp)({type:rk.AsnPropTypes.Any,context:0})],Jy.prototype,"certValue",void 0);$o.id_certTypes=`${Vye.id_pkcs_9}.22`;$o.id_x509Certificate=`${$o.id_certTypes}.1`;$o.id_sdsiCertificate=`${$o.id_certTypes}.2`});var g8=y(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Is.id_x509CRL=Is.id_crlTypes=Is.CRLBag=void 0;var h8=(E(),I(T)),nk=z(),Hye=tk(),Yy=class{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}};Is.CRLBag=Yy;h8.__decorate([(0,nk.AsnProp)({type:nk.AsnPropTypes.ObjectIdentifier})],Yy.prototype,"crlId",void 0);h8.__decorate([(0,nk.AsnProp)({type:nk.AsnPropTypes.Any,context:0})],Yy.prototype,"crltValue",void 0);Is.id_crlTypes=`${Hye.id_pkcs_9}.23`;Is.id_x509CRL=`${Is.id_crlTypes}.1`});var b8=y(Bp=>{"use strict";Object.defineProperty(Bp,"__esModule",{value:!0});Bp.EncryptedPrivateKeyInfo=Bp.EncryptedData=void 0;var y8=(E(),I(T)),sM=z(),v8=tt(),Qy=class extends sM.OctetString{};Bp.EncryptedData=Qy;var Xy=class{constructor(e={}){this.encryptionAlgorithm=new v8.AlgorithmIdentifier,this.encryptedData=new Qy,Object.assign(this,e)}};Bp.EncryptedPrivateKeyInfo=Xy;y8.__decorate([(0,sM.AsnProp)({type:v8.AlgorithmIdentifier})],Xy.prototype,"encryptionAlgorithm",void 0);y8.__decorate([(0,sM.AsnProp)({type:Qy})],Xy.prototype,"encryptedData",void 0)});var _8=y(ii=>{"use strict";var aM;Object.defineProperty(ii,"__esModule",{value:!0});ii.PrivateKeyInfo=ii.Attributes=ii.PrivateKey=ii.Version=void 0;var tv=(E(),I(T)),Ts=z(),lM=tt(),cM;(function(t){t[t.v1=0]="v1"})(cM||(ii.Version=cM={}));var ev=class extends Ts.OctetString{};ii.PrivateKey=ev;var ok=aM=class extends Ts.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,aM.prototype)}};ii.Attributes=ok;ii.Attributes=ok=aM=tv.__decorate([(0,Ts.AsnType)({type:Ts.AsnTypeTypes.Sequence,itemType:lM.Attribute})],ok);var Dl=class{constructor(e={}){this.version=cM.v1,this.privateKeyAlgorithm=new lM.AlgorithmIdentifier,this.privateKey=new ev,Object.assign(this,e)}};ii.PrivateKeyInfo=Dl;tv.__decorate([(0,Ts.AsnProp)({type:Ts.AsnPropTypes.Integer})],Dl.prototype,"version",void 0);tv.__decorate([(0,Ts.AsnProp)({type:lM.AlgorithmIdentifier})],Dl.prototype,"privateKeyAlgorithm",void 0);tv.__decorate([(0,Ts.AsnProp)({type:ev})],Dl.prototype,"privateKey",void 0);tv.__decorate([(0,Ts.AsnProp)({type:ok,implicit:!0,context:0,optional:!0})],Dl.prototype,"attributes",void 0)});var sk=y(ik=>{"use strict";Object.defineProperty(ik,"__esModule",{value:!0});var w8=(E(),I(T));w8.__exportStar(b8(),ik);w8.__exportStar(_8(),ik)});var S8=y(rv=>{"use strict";Object.defineProperty(rv,"__esModule",{value:!0});rv.KeyBag=void 0;var Gye=(E(),I(T)),Wye=sk(),x8=z(),uM=class extends Wye.PrivateKeyInfo{};rv.KeyBag=uM;rv.KeyBag=uM=Gye.__decorate([(0,x8.AsnType)({type:x8.AsnTypeTypes.Sequence})],uM)});var A8=y(nv=>{"use strict";Object.defineProperty(nv,"__esModule",{value:!0});nv.PKCS8ShroudedKeyBag=void 0;var Zye=(E(),I(T)),Kye=sk(),k8=z(),dM=class extends Kye.EncryptedPrivateKeyInfo{};nv.PKCS8ShroudedKeyBag=dM;nv.PKCS8ShroudedKeyBag=dM=Zye.__decorate([(0,k8.AsnType)({type:k8.AsnTypeTypes.Sequence})],dM)});var P8=y(ck=>{"use strict";Object.defineProperty(ck,"__esModule",{value:!0});ck.SecretBag=void 0;var $8=(E(),I(T)),ak=z(),ov=class{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}};ck.SecretBag=ov;$8.__decorate([(0,ak.AsnProp)({type:ak.AsnPropTypes.ObjectIdentifier})],ov.prototype,"secretTypeId",void 0);$8.__decorate([(0,ak.AsnProp)({type:ak.AsnPropTypes.Any,context:0})],ov.prototype,"secretValue",void 0)});var C8=y(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});var Up=(E(),I(T));Up.__exportStar(m8(),Da);Up.__exportStar(g8(),Da);Up.__exportStar(S8(),Da);Up.__exportStar(A8(),Da);Up.__exportStar(P8(),Da);Up.__exportStar(tk(),Da)});var fM=y(lk=>{"use strict";Object.defineProperty(lk,"__esModule",{value:!0});lk.MacData=void 0;var pM=(E(),I(T)),I8=hz(),Lp=z(),Fp=class{constructor(e={}){this.mac=new I8.DigestInfo,this.macSalt=new Lp.OctetString,this.iterations=1,Object.assign(this,e)}};lk.MacData=Fp;pM.__decorate([(0,Lp.AsnProp)({type:I8.DigestInfo})],Fp.prototype,"mac",void 0);pM.__decorate([(0,Lp.AsnProp)({type:Lp.OctetString})],Fp.prototype,"macSalt",void 0);pM.__decorate([(0,Lp.AsnProp)({type:Lp.AsnPropTypes.Integer,defaultValue:1})],Fp.prototype,"iterations",void 0)});var O8=y(dk=>{"use strict";Object.defineProperty(dk,"__esModule",{value:!0});dk.PFX=void 0;var mM=(E(),I(T)),uk=z(),T8=zy(),E8=fM(),Vp=class{constructor(e={}){this.version=3,this.authSafe=new T8.ContentInfo,this.macData=new E8.MacData,Object.assign(this,e)}};dk.PFX=Vp;mM.__decorate([(0,uk.AsnProp)({type:uk.AsnPropTypes.Integer})],Vp.prototype,"version",void 0);mM.__decorate([(0,uk.AsnProp)({type:T8.ContentInfo})],Vp.prototype,"authSafe",void 0);mM.__decorate([(0,uk.AsnProp)({type:E8.MacData,optional:!0})],Vp.prototype,"macData",void 0)});var j8=y(Bl=>{"use strict";var hM;Object.defineProperty(Bl,"__esModule",{value:!0});Bl.SafeContents=Bl.SafeBag=void 0;var pk=(E(),I(T)),qa=z(),Jye=tM(),ql=class{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}};Bl.SafeBag=ql;pk.__decorate([(0,qa.AsnProp)({type:qa.AsnPropTypes.ObjectIdentifier})],ql.prototype,"bagId",void 0);pk.__decorate([(0,qa.AsnProp)({type:qa.AsnPropTypes.Any,context:0})],ql.prototype,"bagValue",void 0);pk.__decorate([(0,qa.AsnProp)({type:Jye.PKCS12Attribute,repeated:"set",optional:!0})],ql.prototype,"bagAttributes",void 0);var gM=hM=class extends qa.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,hM.prototype)}};Bl.SafeContents=gM;Bl.SafeContents=gM=hM=pk.__decorate([(0,qa.AsnType)({type:qa.AsnTypeTypes.Sequence,itemType:ql})],gM)});var N8=y(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});var Ul=(E(),I(T));Ul.__exportStar(tM(),Es);Ul.__exportStar(p8(),Es);Ul.__exportStar(C8(),Es);Ul.__exportStar(fM(),Es);Ul.__exportStar(iM(),Es);Ul.__exportStar(O8(),Es);Ul.__exportStar(j8(),Es)});var R8=y(w=>{"use strict";var yM,vM,bM;Object.defineProperty(w,"__esModule",{value:!0});w.DateOfBirth=w.UnstructuredAddress=w.UnstructuredName=w.EmailAddress=w.EncryptedPrivateKeyInfo=w.UserPKCS12=w.Pkcs7PDU=w.PKCS9String=w.id_at_pseudonym=w.crlTypes=w.id_certTypes=w.id_smime=w.id_pkcs9_mr_signingTimeMatch=w.id_pkcs9_mr_caseIgnoreMatch=w.id_pkcs9_sx_signingTime=w.id_pkcs9_sx_pkcs9String=w.id_pkcs9_at_countryOfResidence=w.id_pkcs9_at_countryOfCitizenship=w.id_pkcs9_at_gender=w.id_pkcs9_at_placeOfBirth=w.id_pkcs9_at_dateOfBirth=w.id_ietf_at=w.id_pkcs9_at_pkcs7PDU=w.id_pkcs9_at_sequenceNumber=w.id_pkcs9_at_randomNonce=w.id_pkcs9_at_encryptedPrivateKeyInfo=w.id_pkcs9_at_pkcs15Token=w.id_pkcs9_at_userPKCS12=w.id_pkcs9_at_localKeyId=w.id_pkcs9_at_friendlyName=w.id_pkcs9_at_smimeCapabilities=w.id_pkcs9_at_extensionRequest=w.id_pkcs9_at_signingDescription=w.id_pkcs9_at_extendedCertificateAttributes=w.id_pkcs9_at_unstructuredAddress=w.id_pkcs9_at_challengePassword=w.id_pkcs9_at_counterSignature=w.id_pkcs9_at_signingTime=w.id_pkcs9_at_messageDigest=w.id_pkcs9_at_contentType=w.id_pkcs9_at_unstructuredName=w.id_pkcs9_at_emailAddress=w.id_pkcs9_oc_naturalPerson=w.id_pkcs9_oc_pkcsEntity=w.id_pkcs9_mr=w.id_pkcs9_sx=w.id_pkcs9_at=w.id_pkcs9_oc=w.id_pkcs9_mo=w.id_pkcs9=void 0;w.SMIMECapabilities=w.SMIMECapability=w.SigningDescription=w.LocalKeyId=w.FriendlyName=w.ExtendedCertificateAttributes=w.ExtensionRequest=w.ChallengePassword=w.CounterSignature=w.SequenceNumber=w.RandomNonce=w.SigningTime=w.MessageDigest=w.ContentType=w.Pseudonym=w.CountryOfResidence=w.CountryOfCitizenship=w.Gender=w.PlaceOfBirth=void 0;var lt=(E(),I(T)),X=z(),DM=zy(),Yye=N8(),Qye=sk(),Os=tt(),Xye=jR();w.id_pkcs9="1.2.840.113549.1.9";w.id_pkcs9_mo=`${w.id_pkcs9}.0`;w.id_pkcs9_oc=`${w.id_pkcs9}.24`;w.id_pkcs9_at=`${w.id_pkcs9}.25`;w.id_pkcs9_sx=`${w.id_pkcs9}.26`;w.id_pkcs9_mr=`${w.id_pkcs9}.27`;w.id_pkcs9_oc_pkcsEntity=`${w.id_pkcs9_oc}.1`;w.id_pkcs9_oc_naturalPerson=`${w.id_pkcs9_oc}.2`;w.id_pkcs9_at_emailAddress=`${w.id_pkcs9}.1`;w.id_pkcs9_at_unstructuredName=`${w.id_pkcs9}.2`;w.id_pkcs9_at_contentType=`${w.id_pkcs9}.3`;w.id_pkcs9_at_messageDigest=`${w.id_pkcs9}.4`;w.id_pkcs9_at_signingTime=`${w.id_pkcs9}.5`;w.id_pkcs9_at_counterSignature=`${w.id_pkcs9}.6`;w.id_pkcs9_at_challengePassword=`${w.id_pkcs9}.7`;w.id_pkcs9_at_unstructuredAddress=`${w.id_pkcs9}.8`;w.id_pkcs9_at_extendedCertificateAttributes=`${w.id_pkcs9}.9`;w.id_pkcs9_at_signingDescription=`${w.id_pkcs9}.13`;w.id_pkcs9_at_extensionRequest=`${w.id_pkcs9}.14`;w.id_pkcs9_at_smimeCapabilities=`${w.id_pkcs9}.15`;w.id_pkcs9_at_friendlyName=`${w.id_pkcs9}.20`;w.id_pkcs9_at_localKeyId=`${w.id_pkcs9}.21`;w.id_pkcs9_at_userPKCS12="2.16.840.1.113730.3.1.216";w.id_pkcs9_at_pkcs15Token=`${w.id_pkcs9_at}.1`;w.id_pkcs9_at_encryptedPrivateKeyInfo=`${w.id_pkcs9_at}.2`;w.id_pkcs9_at_randomNonce=`${w.id_pkcs9_at}.3`;w.id_pkcs9_at_sequenceNumber=`${w.id_pkcs9_at}.4`;w.id_pkcs9_at_pkcs7PDU=`${w.id_pkcs9_at}.5`;w.id_ietf_at="1.3.6.1.5.5.7.9";w.id_pkcs9_at_dateOfBirth=`${w.id_ietf_at}.1`;w.id_pkcs9_at_placeOfBirth=`${w.id_ietf_at}.2`;w.id_pkcs9_at_gender=`${w.id_ietf_at}.3`;w.id_pkcs9_at_countryOfCitizenship=`${w.id_ietf_at}.4`;w.id_pkcs9_at_countryOfResidence=`${w.id_ietf_at}.5`;w.id_pkcs9_sx_pkcs9String=`${w.id_pkcs9_sx}.1`;w.id_pkcs9_sx_signingTime=`${w.id_pkcs9_sx}.2`;w.id_pkcs9_mr_caseIgnoreMatch=`${w.id_pkcs9_mr}.1`;w.id_pkcs9_mr_signingTimeMatch=`${w.id_pkcs9_mr}.2`;w.id_smime=`${w.id_pkcs9}.16`;w.id_certTypes=`${w.id_pkcs9}.22`;w.crlTypes=`${w.id_pkcs9}.23`;w.id_at_pseudonym=`${Xye.id_at}.65`;var iv=class extends Os.DirectoryString{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};w.PKCS9String=iv;lt.__decorate([(0,X.AsnProp)({type:X.AsnPropTypes.IA5String})],iv.prototype,"ia5String",void 0);w.PKCS9String=iv=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],iv);var _M=class extends DM.ContentInfo{};w.Pkcs7PDU=_M;w.Pkcs7PDU=_M=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Sequence})],_M);var wM=class extends Yye.PFX{};w.UserPKCS12=wM;w.UserPKCS12=wM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Sequence})],wM);var xM=class extends Qye.EncryptedPrivateKeyInfo{};w.EncryptedPrivateKeyInfo=xM;w.EncryptedPrivateKeyInfo=xM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Sequence})],xM);var fk=class{constructor(e=""){this.value=e}toString(){return this.value}};w.EmailAddress=fk;lt.__decorate([(0,X.AsnProp)({type:X.AsnPropTypes.IA5String})],fk.prototype,"value",void 0);w.EmailAddress=fk=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],fk);var SM=class extends iv{};w.UnstructuredName=SM;w.UnstructuredName=SM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],SM);var kM=class extends Os.DirectoryString{};w.UnstructuredAddress=kM;w.UnstructuredAddress=kM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],kM);var mk=class{constructor(e=new Date){this.value=e}};w.DateOfBirth=mk;lt.__decorate([(0,X.AsnProp)({type:X.AsnPropTypes.GeneralizedTime})],mk.prototype,"value",void 0);w.DateOfBirth=mk=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],mk);var AM=class extends Os.DirectoryString{};w.PlaceOfBirth=AM;w.PlaceOfBirth=AM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],AM);var hk=class{constructor(e="M"){this.value=e}toString(){return this.value}};w.Gender=hk;lt.__decorate([(0,X.AsnProp)({type:X.AsnPropTypes.PrintableString})],hk.prototype,"value",void 0);w.Gender=hk=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],hk);var sv=class{constructor(e=""){this.value=e}toString(){return this.value}};w.CountryOfCitizenship=sv;lt.__decorate([(0,X.AsnProp)({type:X.AsnPropTypes.PrintableString})],sv.prototype,"value",void 0);w.CountryOfCitizenship=sv=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],sv);var $M=class extends sv{};w.CountryOfResidence=$M;w.CountryOfResidence=$M=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],$M);var PM=class extends Os.DirectoryString{};w.Pseudonym=PM;w.Pseudonym=PM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],PM);var gk=class{constructor(e=""){this.value=e}toString(){return this.value}};w.ContentType=gk;lt.__decorate([(0,X.AsnProp)({type:X.AsnPropTypes.ObjectIdentifier})],gk.prototype,"value",void 0);w.ContentType=gk=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],gk);var CM=class extends X.OctetString{};w.MessageDigest=CM;var IM=class extends Os.Time{};w.SigningTime=IM;w.SigningTime=IM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],IM);var TM=class extends X.OctetString{};w.RandomNonce=TM;var yk=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};w.SequenceNumber=yk;lt.__decorate([(0,X.AsnProp)({type:X.AsnPropTypes.Integer})],yk.prototype,"value",void 0);w.SequenceNumber=yk=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],yk);var EM=class extends DM.SignerInfo{};w.CounterSignature=EM;w.CounterSignature=EM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Sequence})],EM);var OM=class extends Os.DirectoryString{};w.ChallengePassword=OM;w.ChallengePassword=OM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],OM);var jM=yM=class extends Os.Extensions{constructor(e){super(e),Object.setPrototypeOf(this,yM.prototype)}};w.ExtensionRequest=jM;w.ExtensionRequest=jM=yM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Sequence})],jM);var NM=vM=class extends X.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,vM.prototype)}};w.ExtendedCertificateAttributes=NM;w.ExtendedCertificateAttributes=NM=vM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Set,itemType:DM.Attribute})],NM);var vk=class{constructor(e=""){this.value=e}toString(){return this.value}};w.FriendlyName=vk;lt.__decorate([(0,X.AsnProp)({type:X.AsnPropTypes.BmpString})],vk.prototype,"value",void 0);w.FriendlyName=vk=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Choice})],vk);var RM=class extends X.OctetString{};w.LocalKeyId=RM;var zM=class extends Os.DirectoryString{};w.SigningDescription=zM;var bk=class extends Os.AlgorithmIdentifier{};w.SMIMECapability=bk;w.SMIMECapability=bk=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Sequence})],bk);var MM=bM=class extends X.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,bM.prototype)}};w.SMIMECapabilities=MM;w.SMIMECapabilities=MM=bM=lt.__decorate([(0,X.AsnType)({type:X.AsnTypeTypes.Sequence,itemType:bk})],MM)});var LM=y(av=>{"use strict";var qM;Object.defineProperty(av,"__esModule",{value:!0});av.Attributes=void 0;var eve=(E(),I(T)),BM=z(),tve=tt(),UM=qM=class extends BM.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,qM.prototype)}};av.Attributes=UM;av.Attributes=UM=qM=eve.__decorate([(0,BM.AsnType)({type:BM.AsnTypeTypes.Sequence,itemType:tve.Attribute})],UM)});var FM=y(xk=>{"use strict";Object.defineProperty(xk,"__esModule",{value:!0});xk.CertificationRequestInfo=void 0;var wk=(E(),I(T)),cv=z(),_k=tt(),z8=LM(),Ll=class{constructor(e={}){this.version=0,this.subject=new _k.Name,this.subjectPKInfo=new _k.SubjectPublicKeyInfo,this.attributes=new z8.Attributes,Object.assign(this,e)}};xk.CertificationRequestInfo=Ll;wk.__decorate([(0,cv.AsnProp)({type:cv.AsnPropTypes.Integer})],Ll.prototype,"version",void 0);wk.__decorate([(0,cv.AsnProp)({type:_k.Name})],Ll.prototype,"subject",void 0);wk.__decorate([(0,cv.AsnProp)({type:_k.SubjectPublicKeyInfo})],Ll.prototype,"subjectPKInfo",void 0);wk.__decorate([(0,cv.AsnProp)({type:z8.Attributes,implicit:!0,context:0,optional:!0})],Ll.prototype,"attributes",void 0)});var q8=y(kk=>{"use strict";Object.defineProperty(kk,"__esModule",{value:!0});kk.CertificationRequest=void 0;var VM=(E(),I(T)),Sk=z(),M8=FM(),D8=tt(),Hp=class{constructor(e={}){this.certificationRequestInfo=new M8.CertificationRequestInfo,this.signatureAlgorithm=new D8.AlgorithmIdentifier,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};kk.CertificationRequest=Hp;VM.__decorate([(0,Sk.AsnProp)({type:M8.CertificationRequestInfo,raw:!0})],Hp.prototype,"certificationRequestInfo",void 0);VM.__decorate([(0,Sk.AsnProp)({type:D8.AlgorithmIdentifier})],Hp.prototype,"signatureAlgorithm",void 0);VM.__decorate([(0,Sk.AsnProp)({type:Sk.AsnPropTypes.BitString})],Hp.prototype,"signature",void 0)});var B8=y(lv=>{"use strict";Object.defineProperty(lv,"__esModule",{value:!0});var HM=(E(),I(T));HM.__exportStar(LM(),lv);HM.__exportStar(q8(),lv);HM.__exportStar(FM(),lv)});var k9=y(U=>{"use strict";LH();var R=z(),te=tt(),q=fs(),M=(E(),I(T)),rve=zy(),Dk=EZ(),zn=hz(),It=d8(),QM=R8(),qk=B8();function Qv(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,Object.freeze(e)}var N=Qv(te),Rn=Qv(rve),Ft=Qv(Dk),Ct=Qv(zn),Xp=Qv(QM),of="crypto.algorithm",Bk=class{getAlgorithms(){return It.container.resolveAll(of)}toAsnAlgorithm(e){({...e});for(let r of this.getAlgorithms()){let n=r.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){let r=new te.AlgorithmIdentifier({algorithm:e.name});if("parameters"in e){let n=e;r.parameters=n.parameters}return r}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(let n of this.getAlgorithms()){let o=n.toWebAlgorithm(e);if(o)return o}return{name:e.algorithm,parameters:e.parameters}}},ci="crypto.algorithmProvider";It.container.registerSingleton(ci,Bk);var Pk,Bn="1.3.36.3.3.2.8.1.1",U8=`${Bn}.1`,L8=`${Bn}.2`,F8=`${Bn}.3`,V8=`${Bn}.4`,H8=`${Bn}.5`,G8=`${Bn}.6`,W8=`${Bn}.7`,Z8=`${Bn}.8`,K8=`${Bn}.9`,J8=`${Bn}.10`,Y8=`${Bn}.11`,Q8=`${Bn}.12`,X8=`${Bn}.13`,e9=`${Bn}.14`,t9="brainpoolP160r1",r9="brainpoolP160t1",n9="brainpoolP192r1",o9="brainpoolP192t1",i9="brainpoolP224r1",s9="brainpoolP224t1",a9="brainpoolP256r1",c9="brainpoolP256t1",l9="brainpoolP320r1",u9="brainpoolP320t1",d9="brainpoolP384r1",p9="brainpoolP384t1",f9="brainpoolP512r1",m9="brainpoolP512t1",Jt="ECDSA";U.EcAlgorithm=Pk=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Jt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return Ft.ecdsaWithSHA1;case"sha-256":return Ft.ecdsaWithSHA256;case"sha-384":return Ft.ecdsaWithSHA384;case"sha-512":return Ft.ecdsaWithSHA512}else if("namedCurve"in e){let r="";switch(e.namedCurve){case"P-256":r=Ft.id_secp256r1;break;case"K-256":r=Pk.SECP256K1;break;case"P-384":r=Ft.id_secp384r1;break;case"P-521":r=Ft.id_secp521r1;break;case t9:r=U8;break;case r9:r=L8;break;case n9:r=F8;break;case o9:r=V8;break;case i9:r=H8;break;case s9:r=G8;break;case a9:r=W8;break;case c9:r=Z8;break;case l9:r=K8;break;case u9:r=J8;break;case d9:r=Y8;break;case p9:r=Q8;break;case f9:r=X8;break;case m9:r=e9;break}if(r)return new te.AlgorithmIdentifier({algorithm:Ft.id_ecPublicKey,parameters:R.AsnConvert.serialize(new Ft.ECParameters({namedCurve:r}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case Ft.id_ecdsaWithSHA1:return{name:Jt,hash:{name:"SHA-1"}};case Ft.id_ecdsaWithSHA256:return{name:Jt,hash:{name:"SHA-256"}};case Ft.id_ecdsaWithSHA384:return{name:Jt,hash:{name:"SHA-384"}};case Ft.id_ecdsaWithSHA512:return{name:Jt,hash:{name:"SHA-512"}};case Ft.id_ecPublicKey:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(R.AsnConvert.parse(e.parameters,Ft.ECParameters).namedCurve){case Ft.id_secp256r1:return{name:Jt,namedCurve:"P-256"};case Pk.SECP256K1:return{name:Jt,namedCurve:"K-256"};case Ft.id_secp384r1:return{name:Jt,namedCurve:"P-384"};case Ft.id_secp521r1:return{name:Jt,namedCurve:"P-521"};case U8:return{name:Jt,namedCurve:t9};case L8:return{name:Jt,namedCurve:r9};case F8:return{name:Jt,namedCurve:n9};case V8:return{name:Jt,namedCurve:o9};case H8:return{name:Jt,namedCurve:i9};case G8:return{name:Jt,namedCurve:s9};case W8:return{name:Jt,namedCurve:a9};case Z8:return{name:Jt,namedCurve:c9};case K8:return{name:Jt,namedCurve:l9};case J8:return{name:Jt,namedCurve:u9};case Y8:return{name:Jt,namedCurve:d9};case Q8:return{name:Jt,namedCurve:p9};case X8:return{name:Jt,namedCurve:f9};case e9:return{name:Jt,namedCurve:m9}}}}return null}};U.EcAlgorithm.SECP256K1="1.3.132.0.10";U.EcAlgorithm=Pk=M.__decorate([It.injectable()],U.EcAlgorithm);It.container.registerSingleton(of,U.EcAlgorithm);var _9=Symbol("name"),w9=Symbol("value"),Ue=class{constructor(e,r={},n=""){this[_9]=e,this[w9]=n;for(let o in r)this[o]=r[o]}};Ue.NAME=_9;Ue.VALUE=w9;var Uk=class{static toTextObject(e){let r=new Ue("Algorithm Identifier",{},Po.toString(e.algorithm));if(e.parameters)if(e.algorithm===Ft.id_ecPublicKey){let n=new U.EcAlgorithm().toWebAlgorithm(e);n&&"namedCurve"in n?r["Named Curve"]=n.namedCurve:r.Parameters=e.parameters}else r.Parameters=e.parameters;return r}},Po=class{static toString(e){let r=this.items[e];return r||e}};Po.items={[Ct.id_sha1]:"sha1",[Ct.id_sha224]:"sha224",[Ct.id_sha256]:"sha256",[Ct.id_sha384]:"sha384",[Ct.id_sha512]:"sha512",[Ct.id_rsaEncryption]:"rsaEncryption",[Ct.id_sha1WithRSAEncryption]:"sha1WithRSAEncryption",[Ct.id_sha224WithRSAEncryption]:"sha224WithRSAEncryption",[Ct.id_sha256WithRSAEncryption]:"sha256WithRSAEncryption",[Ct.id_sha384WithRSAEncryption]:"sha384WithRSAEncryption",[Ct.id_sha512WithRSAEncryption]:"sha512WithRSAEncryption",[Ft.id_ecPublicKey]:"ecPublicKey",[Ft.id_ecdsaWithSHA1]:"ecdsaWithSHA1",[Ft.id_ecdsaWithSHA224]:"ecdsaWithSHA224",[Ft.id_ecdsaWithSHA256]:"ecdsaWithSHA256",[Ft.id_ecdsaWithSHA384]:"ecdsaWithSHA384",[Ft.id_ecdsaWithSHA512]:"ecdsaWithSHA512",[N.id_kp_serverAuth]:"TLS WWW server authentication",[N.id_kp_clientAuth]:"TLS WWW client authentication",[N.id_kp_codeSigning]:"Code Signing",[N.id_kp_emailProtection]:"E-mail Protection",[N.id_kp_timeStamping]:"Time Stamping",[N.id_kp_OCSPSigning]:"OCSP Signing",[Rn.id_signedData]:"Signed Data"};var li=class{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,r=0){let n=[],o=this.pad(r++),i="",s=e[Ue.VALUE];s&&(i=` ${s}`),n.push(`${o}${e[Ue.NAME]}:${i}`),o=this.pad(r);for(let a in e){if(typeof a=="symbol")continue;let c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${o}${l}${c}`);else if(c instanceof Date)n.push(`${o}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(let u of c)u[Ue.NAME]=a,n.push(...this.serializeObj(u,r));else if(c instanceof Ue)c[Ue.NAME]=a,n.push(...this.serializeObj(c,r));else if(q.BufferSourceConverter.isBufferSource(c))a?(n.push(`${o}${l}`),n.push(...this.serializeBufferSource(c,r+1))):n.push(...this.serializeBufferSource(c,r));else if("toTextObject"in c){let u=c.toTextObject();u[Ue.NAME]=a,n.push(...this.serializeObj(u,r))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,r=0){let n=this.pad(r),o=q.BufferSourceConverter.toUint8Array(e),i=[];for(let s=0;s<o.length;){let a=[];for(let c=0;c<16&&s<o.length;c++){c===8&&a.push("");let l=o[s++].toString(16).padStart(2,"0");a.push(l)}i.push(`${n}${a.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}};li.oidSerializer=Po;li.algorithmSerializer=Uk;var Gp,Fi=class t{get rawData(){return M.__classPrivateFieldGet(this,Gp,"f")||M.__classPrivateFieldSet(this,Gp,R.AsnConvert.serialize(this.asn),"f"),M.__classPrivateFieldGet(this,Gp,"f")}constructor(...e){Gp.set(this,void 0),q.BufferSourceConverter.isBufferSource(e[0])?(this.asn=R.AsnConvert.parse(e[0],e[1]),M.__classPrivateFieldSet(this,Gp,q.BufferSourceConverter.toArrayBuffer(e[0]),"f"),this.onInit(this.asn)):(this.asn=e[0],this.onInit(this.asn))}equal(e){return e instanceof t?q.isEqual(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return R.AsnConvert.toString(this.rawData);case"text":return li.serialize(this.toTextObject());case"hex":return q.Convert.ToHex(this.rawData);case"base64":return q.Convert.ToBase64(this.rawData);case"base64url":return q.Convert.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new Ue(this.getTextName(),{},e)}};Gp=new WeakMap;Fi.NAME="ASN";var Mn=class t extends Fi{constructor(...e){let r;q.BufferSourceConverter.isBufferSource(e[0])?r=q.BufferSourceConverter.toArrayBuffer(e[0]):r=R.AsnConvert.serialize(new te.Extension({extnID:e[0],critical:e[1],extnValue:new R.OctetString(q.BufferSourceConverter.toArrayBuffer(e[2]))})),super(r,te.Extension)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[Ue.NAME]===t.NAME&&(e[Ue.NAME]=Po.toString(this.type)),e}},x9,ef=class t{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[x9]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(t.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(t.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,r){return this.items.forEach(e,r)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=t.DEFAULT){let r=this.items.get(e.toLowerCase());if(!r)throw new Error(`Cannot get Crypto by name '${e}'`);return r}set(e,r){if(typeof e=="string"){if(!r)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),r)}else this.items.set(t.DEFAULT,e);return this}};x9=Symbol.toStringTag;ef.DEFAULT="default";var Vt=new ef,nve=/^[0-2](?:\.[1-9][0-9]*)+$/;function ove(t){return new RegExp(nve).test(t)}var Dv=class{constructor(e={}){this.items={};for(let r in e)this.register(r,e[r])}get(e){return this.items[e]||null}findId(e){return ove(e)?e:this.get(e)}register(e,r){this.items[e]=r,this.items[r]=e}},Dn=new Dv;Dn.register("CN","2.5.4.3");Dn.register("L","2.5.4.7");Dn.register("ST","2.5.4.8");Dn.register("O","2.5.4.10");Dn.register("OU","2.5.4.11");Dn.register("C","2.5.4.6");Dn.register("DC","0.9.2342.19200300.100.1.25");Dn.register("E","1.2.840.113549.1.9.1");Dn.register("G","2.5.4.42");Dn.register("I","2.5.4.43");Dn.register("SN","2.5.4.4");Dn.register("T","2.5.4.12");function ive(t,e){return`\\${q.Convert.ToHex(q.Convert.FromUtf8String(e)).toUpperCase()}`}function sve(t){return t.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,ive)}var Sr=class t{static isASCII(e){for(let r=0;r<e.length;r++)if(e.charCodeAt(r)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,r={}){this.extraNames=new Dv,this.asn=new te.Name;for(let n in r)if(Object.prototype.hasOwnProperty.call(r,n)){let o=r[n];this.extraNames.register(n,o)}typeof e=="string"?this.asn=this.fromString(e):e instanceof te.Name?this.asn=e:q.BufferSourceConverter.isBufferSource(e)?this.asn=R.AsnConvert.parse(e,te.Name):this.asn=this.fromJSON(e)}getField(e){let r=this.extraNames.findId(e)||Dn.findId(e),n=[];for(let o of this.asn)for(let i of o)i.type===r&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||Dn.get(e)}toString(){return this.asn.map(e=>e.map(r=>{let n=this.getName(r.type)||r.type,o=r.value.anyValue?`#${q.Convert.ToHex(r.value.anyValue)}`:sve(r.value.toString());return`${n}=${o}`}).join("+")).join(", ")}toJSON(){var e;let r=[];for(let n of this.asn){let o={};for(let i of n){let s=this.getName(i.type)||i.type;(e=o[s])!==null&&e!==void 0||(o[s]=[]),o[s].push(i.value.anyValue?`#${q.Convert.ToHex(i.value.anyValue)}`:i.value.toString())}r.push(o)}return r}fromString(e){let r=new te.Name,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,o=null,i=",";for(;o=n.exec(`${e},`);){let[,s,a]=o,c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),o[3]=c);let l=o[3];s=this.getTypeOid(s);let u=this.createAttribute(s,a);i==="+"?r[r.length-1].push(u):r.push(new te.RelativeDistinguishedName([u])),i=l}return r}fromJSON(e){let r=new te.Name;for(let n of e){let o=new te.RelativeDistinguishedName;for(let i in n){let s=this.getTypeOid(i),a=n[i];for(let c of a){let l=this.createAttribute(s,c);o.push(l)}}r.push(o)}return r}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,r){let n=new te.AttributeTypeAndValue({type:e});if(typeof r=="object")for(let o in r)switch(o){case"ia5String":n.value.ia5String=r[o];break;case"utf8String":n.value.utf8String=r[o];break;case"universalString":n.value.universalString=r[o];break;case"bmpString":n.value.bmpString=r[o];break;case"printableString":n.value.printableString=r[o];break}else if(r[0]==="#")n.value.anyValue=q.Convert.FromHex(r.slice(1));else{let o=this.processStringValue(r);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=o:t.isPrintableString(o)?n.value.printableString=o:n.value.utf8String=o}return n}processStringValue(e){let r=/"(.*?[^\\])?"/.exec(e);return r&&(e=r[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return R.AsnConvert.serialize(this.asn)}async getThumbprint(...e){var r;let n,o="SHA-1";return e.length>=1&&!(!((r=e[0])===null||r===void 0)&&r.subtle)?(o=e[0]||o,n=e[1]||Vt.get()):n=e[0]||Vt.get(),await n.subtle.digest(o,this.toArrayBuffer())}},S9="Cannot initialize GeneralName from ASN.1 data.",h9=`${S9} Unsupported string format in use.`,ave=`${S9} Value doesn't match to GUID regular expression.`,g9=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,y9="1.3.6.1.4.1.311.25.1",v9="1.3.6.1.4.1.311.20.2.3",Ck="dns",Ik="dn",Tk="email",Ek="ip",Ok="url",jk="guid",Nk="upn",uv="id",si=class extends Fi{constructor(...e){let r;if(e.length===2)switch(e[0]){case Ik:{let n=new Sr(e[1]).toArrayBuffer(),o=R.AsnConvert.parse(n,N.Name);r=new N.GeneralName({directoryName:o});break}case Ck:r=new N.GeneralName({dNSName:e[1]});break;case Tk:r=new N.GeneralName({rfc822Name:e[1]});break;case jk:{let n=new RegExp(g9,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");let o=n.slice(1).map((i,s)=>s<3?q.Convert.ToHex(new Uint8Array(q.Convert.FromHex(i)).reverse()):i).join("");r=new N.GeneralName({otherName:new N.OtherName({typeId:y9,value:R.AsnConvert.serialize(new R.OctetString(q.Convert.FromHex(o)))})});break}case Ek:r=new N.GeneralName({iPAddress:e[1]});break;case uv:r=new N.GeneralName({registeredID:e[1]});break;case Nk:{r=new N.GeneralName({otherName:new N.OtherName({typeId:v9,value:R.AsnConvert.serialize(R.AsnUtf8StringConverter.toASN(e[1]))})});break}case Ok:r=new N.GeneralName({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else q.BufferSourceConverter.isBufferSource(e[0])?r=R.AsnConvert.parse(e[0],N.GeneralName):r=e[0];super(r)}onInit(e){if(e.dNSName!=null)this.type=Ck,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=Tk,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=Ek,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=Ok,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=uv,this.value=e.registeredID;else if(e.directoryName!=null)this.type=Ik,this.value=new Sr(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===y9){this.type=jk;let r=R.AsnConvert.parse(e.otherName.value,R.OctetString),n=new RegExp(g9,"i").exec(q.Convert.ToHex(r));if(!n)throw new Error(ave);this.value=n.slice(1).map((o,i)=>i<3?q.Convert.ToHex(new Uint8Array(q.Convert.FromHex(o)).reverse()):o).join("-")}else if(e.otherName.typeId===v9)this.type=Nk,this.value=R.AsnConvert.parse(e.otherName.value,N.DirectoryString).toString();else throw new Error(h9);else throw new Error(h9)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case Ik:case Ck:case jk:case Ek:case uv:case Nk:case Ok:e=this.type.toUpperCase();break;case Tk:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let r=this.value;return this.type===uv&&(r=Po.toString(r)),new Ue(e,void 0,r)}},Vi=class extends Fi{constructor(e){let r;if(e instanceof N.GeneralNames)r=e;else if(Array.isArray(e)){let n=[];for(let o of e)if(o instanceof N.GeneralName)n.push(o);else{let i=R.AsnConvert.parse(new si(o.type,o.value).rawData,N.GeneralName);n.push(i)}r=new N.GeneralNames(n)}else if(q.BufferSourceConverter.isBufferSource(e))r=R.AsnConvert.parse(e,N.GeneralNames);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(r)}onInit(e){let r=[];for(let n of e){let o=null;try{o=new si(n)}catch{continue}r.push(o)}this.items=r}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){let e=super.toTextObjectEmpty();for(let r of this.items){let n=r.toTextObject(),o=e[n[Ue.NAME]];Array.isArray(o)||(o=[],e[n[Ue.NAME]]=o),o.push(n)}return e}};Vi.NAME="GeneralNames";var Mv="-{5}",qv="\\n",cve=`[^${qv}]+`,lve=`${Mv}BEGIN (${cve}(?=${Mv}))${Mv}`,uve=`${Mv}END \\1${Mv}`,tf="\\n",dve=`[^:${qv}]+`,pve=`(?:[^${qv}]+${tf}(?: +[^${qv}]+${tf})*)`,fve="[a-zA-Z0-9=+/]+",mve=`(?:${fve}${tf})+`,b9=`${lve}${tf}(?:((?:${dve}: ${pve})+))?${tf}?(${mve})${uve}`,Cr=class{static isPem(e){return typeof e=="string"&&new RegExp(b9,"g").test(e.replace(/\r/g,""))}static decodeWithHeaders(e){e=e.replace(/\r/g,"");let r=new RegExp(b9,"g"),n=[],o=null;for(;o=r.exec(e);){let i=o[3].replace(new RegExp(`[${qv}]+`,"g"),""),s={type:o[1],headers:[],rawData:q.Convert.FromBase64(i)},a=o[2];if(a){let c=a.split(new RegExp(tf,"g")),l=null;for(let u of c){let[d,p]=u.split(/:(.*)/);if(p===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=d.trim()}else l&&s.headers.push(l),l={key:d,value:p.trim()}}l&&s.headers.push(l)}n.push(s)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){let r=this.decode(e);if(!r.length)throw new RangeError("PEM string doesn't contain any objects");return r[0]}static encode(e,r){if(Array.isArray(e)){let n=new Array;return r?e.forEach(o=>{if(!q.BufferSourceConverter.isBufferSource(o))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:r,rawData:q.BufferSourceConverter.toArrayBuffer(o)}))}):e.forEach(o=>{if(!("type"in o))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(o))}),n.join(`
`)}else{if(!r)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:r,rawData:q.BufferSourceConverter.toArrayBuffer(e)})}}static encodeStruct(e){var r;let n=e.type.toLocaleUpperCase(),o=[];if(o.push(`-----BEGIN ${n}-----`),!((r=e.headers)===null||r===void 0)&&r.length){for(let l of e.headers)o.push(`${l.key}: ${l.value}`);o.push("")}let i=q.Convert.ToBase64(e.rawData),s,a=0,c=Array();for(;a<i.length&&(i.length-a<64?s=i.substring(a):(s=i.substring(a,a+64),a+=64),s.length!==0);)if(c.push(s),s.length<64)break;return o.push(...c),o.push(`-----END ${n}-----`),o.join(`
`)}};Cr.CertificateTag="CERTIFICATE";Cr.CrlTag="CRL";Cr.CertificateRequestTag="CERTIFICATE REQUEST";Cr.PublicKeyTag="PUBLIC KEY";Cr.PrivateKeyTag="PRIVATE KEY";var qn=class t extends Fi{static isAsnEncoded(e){return q.BufferSourceConverter.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(Cr.isPem(e))return Cr.decode(e)[0];if(q.Convert.isHex(e))return q.Convert.FromHex(e);if(q.Convert.isBase64(e))return q.Convert.FromBase64(e);if(q.Convert.isBase64Url(e))return q.Convert.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{let r=q.BufferSourceConverter.toUint8Array(e);if(r.length>0&&r[0]===48)return q.BufferSourceConverter.toArrayBuffer(e);let n=q.Convert.ToBinary(e);if(Cr.isPem(n))return Cr.decode(n)[0];if(q.Convert.isHex(n))return q.Convert.FromHex(n);if(q.Convert.isBase64(n))return q.Convert.FromBase64(n);if(q.Convert.isBase64Url(n))return q.Convert.FromBase64Url(n);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}}constructor(...e){t.isAsnEncoded(e[0])?super(t.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){return e==="pem"?Cr.encode(this.rawData,this.tag):super.toString(e)}},ai=class t extends qn{static async create(e,r=Vt.get()){if(e instanceof t)return e;if(ef.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");let n=await r.subtle.exportKey("spki",e);return new t(n)}else{if(e.publicKey)return e.publicKey;if(q.BufferSourceConverter.isBufferSource(e))return new t(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){qn.isAsnEncoded(e)?super(e,te.SubjectPublicKeyInfo):super(e),this.tag=Cr.PublicKeyTag}async export(...e){let r,n=["verify"],o={hash:"SHA-256",...this.algorithm};e.length>1?(o=e[0]||o,n=e[1]||n,r=e[2]||Vt.get()):r=e[0]||Vt.get();let i=this.rawData,s=R.AsnConvert.parse(this.rawData,te.SubjectPublicKeyInfo);return s.algorithm.algorithm===zn.id_RSASSA_PSS&&(i=hve(s,i)),r.subtle.importKey("spki",i,o,!0,n)}onInit(e){let r=It.container.resolve(ci),n=this.algorithm=r.toWebAlgorithm(e.algorithm);if(e.algorithm.algorithm===zn.id_rsaEncryption){let o=R.AsnConvert.parse(e.subjectPublicKey,zn.RSAPublicKey),i=q.BufferSourceConverter.toUint8Array(o.modulus);n.publicExponent=q.BufferSourceConverter.toUint8Array(o.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3}}async getThumbprint(...e){var r;let n,o="SHA-1";return e.length>=1&&!(!((r=e[0])===null||r===void 0)&&r.subtle)?(o=e[0]||o,n=e[1]||Vt.get()):n=e[0]||Vt.get(),await n.subtle.digest(o,this.rawData)}async getKeyIdentifier(...e){let r,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],r=Vt.get()):r=e[0]:e.length===2?(n=e[0],r=e[1]):r=Vt.get();let o=R.AsnConvert.parse(this.rawData,te.SubjectPublicKeyInfo);return await r.subtle.digest(n,o.subjectPublicKey)}toTextObject(){let e=this.toTextObjectEmpty(),r=R.AsnConvert.parse(this.rawData,te.SubjectPublicKeyInfo);switch(e.Algorithm=li.serializeAlgorithm(r.algorithm),r.algorithm.algorithm){case Dk.id_ecPublicKey:e["EC Point"]=r.subjectPublicKey;break;case zn.id_rsaEncryption:default:e["Raw Data"]=r.subjectPublicKey}return e}};function hve(t,e){return t.algorithm=new te.AlgorithmIdentifier({algorithm:zn.id_rsaEncryption,parameters:null}),e=R.AsnConvert.serialize(t),e}var Bv=class t extends Mn{static async create(e,r=!1,n=Vt.get()){if("name"in e&&"serialNumber"in e)return new t(e,r);let i=await(await ai.create(e,n)).getKeyIdentifier(n);return new t(q.Convert.ToHex(i),r)}constructor(...e){if(q.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){let r=new N.AuthorityKeyIdentifier({keyIdentifier:new N.KeyIdentifier(q.Convert.FromHex(e[0]))});super(N.id_ce_authorityKeyIdentifier,e[1],R.AsnConvert.serialize(r))}else{let r=e[0],n=r.name instanceof Vi?R.AsnConvert.parse(r.name.rawData,N.GeneralNames):r.name,o=new N.AuthorityKeyIdentifier({authorityCertIssuer:n,authorityCertSerialNumber:q.Convert.FromHex(r.serialNumber)});super(N.id_ce_authorityKeyIdentifier,e[1],R.AsnConvert.serialize(o))}}onInit(e){super.onInit(e);let r=R.AsnConvert.parse(e.extnValue,N.AuthorityKeyIdentifier);r.keyIdentifier&&(this.keyId=q.Convert.ToHex(r.keyIdentifier)),(r.authorityCertIssuer||r.authorityCertSerialNumber)&&(this.certId={name:r.authorityCertIssuer||[],serialNumber:r.authorityCertSerialNumber?q.Convert.ToHex(r.authorityCertSerialNumber):""})}toTextObject(){let e=this.toTextObjectWithoutValue(),r=R.AsnConvert.parse(this.value,N.AuthorityKeyIdentifier);return r.authorityCertIssuer&&(e["Authority Issuer"]=new Vi(r.authorityCertIssuer).toTextObject()),r.authorityCertSerialNumber&&(e["Authority Serial Number"]=r.authorityCertSerialNumber),r.keyIdentifier&&(e[""]=r.keyIdentifier),e}};Bv.NAME="Authority Key Identifier";var Uv=class extends Mn{constructor(...e){if(q.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let r=R.AsnConvert.parse(this.value,te.BasicConstraints);this.ca=r.cA,this.pathLength=r.pathLenConstraint}else{let r=new te.BasicConstraints({cA:e[0],pathLenConstraint:e[1]});super(te.id_ce_basicConstraints,e[2],R.AsnConvert.serialize(r)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}};Uv.NAME="Basic Constraints";U.ExtendedKeyUsage=void 0;(function(t){t.serverAuth="1.3.6.1.5.5.7.3.1",t.clientAuth="1.3.6.1.5.5.7.3.2",t.codeSigning="1.3.6.1.5.5.7.3.3",t.emailProtection="1.3.6.1.5.5.7.3.4",t.timeStamping="1.3.6.1.5.5.7.3.8",t.ocspSigning="1.3.6.1.5.5.7.3.9"})(U.ExtendedKeyUsage||(U.ExtendedKeyUsage={}));var Lv=class extends Mn{constructor(...e){if(q.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let r=R.AsnConvert.parse(this.value,N.ExtendedKeyUsage);this.usages=r.map(n=>n)}else{let r=new N.ExtendedKeyUsage(e[0]);super(N.id_ce_extKeyUsage,e[1],R.AsnConvert.serialize(r)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(r=>Po.toString(r)).join(", "),e}};Lv.NAME="Extended Key Usages";U.KeyUsageFlags=void 0;(function(t){t[t.digitalSignature=1]="digitalSignature",t[t.nonRepudiation=2]="nonRepudiation",t[t.keyEncipherment=4]="keyEncipherment",t[t.dataEncipherment=8]="dataEncipherment",t[t.keyAgreement=16]="keyAgreement",t[t.keyCertSign=32]="keyCertSign",t[t.cRLSign=64]="cRLSign",t[t.encipherOnly=128]="encipherOnly",t[t.decipherOnly=256]="decipherOnly"})(U.KeyUsageFlags||(U.KeyUsageFlags={}));var Fv=class extends Mn{constructor(...e){if(q.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let r=R.AsnConvert.parse(this.value,te.KeyUsage);this.usages=r.toNumber()}else{let r=new te.KeyUsage(e[0]);super(te.id_ce_keyUsage,e[1],R.AsnConvert.serialize(r)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue(),r=R.AsnConvert.parse(this.value,te.KeyUsage);return e[""]=r.toJSON().join(", "),e}};Fv.NAME="Key Usages";var Vv=class t extends Mn{static async create(e,r=!1,n=Vt.get()){let i=await(await ai.create(e,n)).getKeyIdentifier(n);return new t(q.Convert.ToHex(i),r)}constructor(...e){if(q.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let r=R.AsnConvert.parse(this.value,N.SubjectKeyIdentifier);this.keyId=q.Convert.ToHex(r)}else{let r=typeof e[0]=="string"?q.Convert.FromHex(e[0]):e[0],n=new N.SubjectKeyIdentifier(r);super(N.id_ce_subjectKeyIdentifier,e[1],R.AsnConvert.serialize(n)),this.keyId=q.Convert.ToHex(r)}}toTextObject(){let e=this.toTextObjectWithoutValue(),r=R.AsnConvert.parse(this.value,N.SubjectKeyIdentifier);return e[""]=r,e}};Vv.NAME="Subject Key Identifier";var Hv=class extends Mn{constructor(...e){q.BufferSourceConverter.isBufferSource(e[0])?super(e[0]):super(N.id_ce_subjectAltName,e[1],new Vi(e[0]||[]).rawData)}onInit(e){super.onInit(e);let r=R.AsnConvert.parse(e.extnValue,N.SubjectAlternativeName);this.names=new Vi(r)}toTextObject(){let e=this.toTextObjectWithoutValue(),r=this.names.toTextObject();for(let n in r)e[n]=r[n];return e}};Hv.NAME="Subject Alternative Name";var Ir=class{static register(e,r){this.items.set(e,r)}static create(e){let r=new Mn(e),n=this.items.get(r.type);return n?new n(e):r}};Ir.items=new Map;var Gv=class extends Mn{constructor(...e){var r;if(q.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let n=R.AsnConvert.parse(this.value,N.CertificatePolicies);this.policies=n.map(o=>o.policyIdentifier)}else{let n=e[0],o=(r=e[1])!==null&&r!==void 0?r:!1,i=new N.CertificatePolicies(n.map(s=>new N.PolicyInformation({policyIdentifier:s})));super(N.id_ce_certificatePolicies,o,R.AsnConvert.serialize(i)),this.policies=n}}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(r=>new Ue("",{},Po.toString(r))),e}};Gv.NAME="Certificate Policies";Ir.register(N.id_ce_certificatePolicies,Gv);var Wv=class extends Mn{constructor(...e){var r;if(q.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){let o=e[0].map(s=>new N.DistributionPoint({distributionPoint:new N.DistributionPointName({fullName:[new N.GeneralName({uniformResourceIdentifier:s})]})})),i=new N.CRLDistributionPoints(o);super(N.id_ce_cRLDistributionPoints,e[1],R.AsnConvert.serialize(i))}else{let n=new N.CRLDistributionPoints(e[0]);super(N.id_ce_cRLDistributionPoints,e[1],R.AsnConvert.serialize(n))}(r=this.distributionPoints)!==null&&r!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);let r=R.AsnConvert.parse(e.extnValue,N.CRLDistributionPoints);this.distributionPoints=r}toTextObject(){let e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(r=>{var n;let o={};return r.distributionPoint&&(o[""]=(n=r.distributionPoint.fullName)===null||n===void 0?void 0:n.map(i=>new si(i).toString()).join(", ")),r.reasons&&(o.Reasons=r.reasons.toString()),r.cRLIssuer&&(o["CRL Issuer"]=r.cRLIssuer.map(i=>i.toString()).join(", ")),o}),e}};Wv.NAME="CRL Distribution Points";var Zv=class extends Mn{constructor(...e){var r,n,o,i;if(q.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof N.AuthorityInfoAccessSyntax){let s=new N.AuthorityInfoAccessSyntax(e[0]);super(N.id_pe_authorityInfoAccess,e[1],R.AsnConvert.serialize(s))}else{let s=e[0],a=new N.AuthorityInfoAccessSyntax;$k(a,s,N.id_ad_ocsp,"ocsp"),$k(a,s,N.id_ad_caIssuers,"caIssuers"),$k(a,s,N.id_ad_timeStamping,"timeStamping"),$k(a,s,N.id_ad_caRepository,"caRepository"),super(N.id_pe_authorityInfoAccess,e[1],R.AsnConvert.serialize(a))}(r=this.ocsp)!==null&&r!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(o=this.timeStamping)!==null&&o!==void 0||(this.timeStamping=[]),(i=this.caRepository)!==null&&i!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],R.AsnConvert.parse(e.extnValue,N.AuthorityInfoAccessSyntax).forEach(n=>{switch(n.accessMethod){case N.id_ad_ocsp:this.ocsp.push(new si(n.accessLocation));break;case N.id_ad_caIssuers:this.caIssuers.push(new si(n.accessLocation));break;case N.id_ad_timeStamping:this.timeStamping.push(new si(n.accessLocation));break;case N.id_ad_caRepository:this.caRepository.push(new si(n.accessLocation));break}})}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ocsp.length&&Ak(e,"OCSP",this.ocsp),this.caIssuers.length&&Ak(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&Ak(e,"Time Stamping",this.timeStamping),this.caRepository.length&&Ak(e,"CA Repository",this.caRepository),e}};Zv.NAME="Authority Info Access";function Ak(t,e,r){if(r.length===1)t[e]=r[0].toTextObject();else{let n=new Ue("");r.forEach((o,i)=>{let s=o.toTextObject(),a=`${s[Ue.NAME]} ${i+1}`,c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(s)}),t[e]=n}}function $k(t,e,r,n){let o=e[n];o&&(Array.isArray(o)?o:[o]).forEach(s=>{typeof s=="string"&&(s=new si("url",s)),t.push(new N.AccessDescription({accessMethod:r,accessLocation:R.AsnConvert.parse(s.rawData,N.GeneralName)}))})}var Kv=class extends Mn{constructor(...e){q.BufferSourceConverter.isBufferSource(e[0])?super(e[0]):super(N.id_ce_issuerAltName,e[1],new Vi(e[0]||[]).rawData)}onInit(e){super.onInit(e);let r=R.AsnConvert.parse(e.extnValue,N.GeneralNames);this.names=new Vi(r)}toTextObject(){let e=this.toTextObjectWithoutValue(),r=this.names.toTextObject();for(let n in r)e[n]=r[n];return e}};Kv.NAME="Issuer Alternative Name";var Fl=class t extends Fi{constructor(...e){let r;if(q.BufferSourceConverter.isBufferSource(e[0]))r=q.BufferSourceConverter.toArrayBuffer(e[0]);else{let n=e[0],o=Array.isArray(e[1])?e[1].map(i=>q.BufferSourceConverter.toArrayBuffer(i)):[];r=R.AsnConvert.serialize(new te.Attribute({type:n,values:o}))}super(r,te.Attribute)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Value=this.values.map(r=>new Ue("",{"":r})),e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty();return e[Ue.NAME]===t.NAME&&(e[Ue.NAME]=Po.toString(this.type)),e}};Fl.NAME="Attribute";var Jv=class extends Fl{constructor(...e){var r;if(q.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=new Xp.ChallengePassword({printableString:e[0]});super(Xp.id_pkcs9_at_challengePassword,[R.AsnConvert.serialize(n)])}(r=this.password)!==null&&r!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){let r=R.AsnConvert.parse(this.values[0],Xp.ChallengePassword);this.password=r.toString()}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[Ue.VALUE]=this.password,e}};Jv.NAME="Challenge Password";var rf=class extends Fl{constructor(...e){var r;if(q.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=e[0],o=new N.Extensions;for(let i of n)o.push(R.AsnConvert.parse(i.rawData,N.Extension));super(Xp.id_pkcs9_at_extensionRequest,[R.AsnConvert.serialize(o)])}(r=this.items)!==null&&r!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){let r=R.AsnConvert.parse(this.values[0],N.Extensions);this.items=r.map(n=>Ir.create(R.AsnConvert.serialize(n)))}}toTextObject(){let e=this.toTextObjectWithoutValue(),r=this.items.map(n=>n.toTextObject());for(let n of r)e[n[Ue.NAME]]=n;return e}};rf.NAME="Extensions";var Vl=class{static register(e,r){this.items.set(e,r)}static create(e){let r=new Fl(e),n=this.items.get(r.type);return n?new n(e):r}};Vl.items=new Map;var js="crypto.signatureFormatter",Lk=class{toAsnSignature(e,r){return q.BufferSourceConverter.toArrayBuffer(r)}toWebSignature(e,r){return q.BufferSourceConverter.toArrayBuffer(r)}},Rk;U.RsaAlgorithm=Rk=class{static createPssParams(e,r){let n=Rk.getHashAlgorithm(e);return n?new Ct.RsaSaPssParams({hashAlgorithm:n,maskGenAlgorithm:new te.AlgorithmIdentifier({algorithm:Ct.id_mgf1,parameters:R.AsnConvert.serialize(n)}),saltLength:r}):null}static getHashAlgorithm(e){let r=It.container.resolve(ci);return typeof e=="string"?r.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?r.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let r;if(typeof e.hash=="string")r=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")r=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(r.toLowerCase()){case"sha-1":return new te.AlgorithmIdentifier({algorithm:Ct.id_sha1WithRSAEncryption,parameters:null});case"sha-256":return new te.AlgorithmIdentifier({algorithm:Ct.id_sha256WithRSAEncryption,parameters:null});case"sha-384":return new te.AlgorithmIdentifier({algorithm:Ct.id_sha384WithRSAEncryption,parameters:null});case"sha-512":return new te.AlgorithmIdentifier({algorithm:Ct.id_sha512WithRSAEncryption,parameters:null})}}else return new te.AlgorithmIdentifier({algorithm:Ct.id_rsaEncryption,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");let r=Rk.createPssParams(e.hash,e.saltLength);if(!r)throw new Error("Cannot create PSS parameters");return new te.AlgorithmIdentifier({algorithm:Ct.id_RSASSA_PSS,parameters:R.AsnConvert.serialize(r)})}else return new te.AlgorithmIdentifier({algorithm:Ct.id_RSASSA_PSS,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case Ct.id_rsaEncryption:return{name:"RSASSA-PKCS1-v1_5"};case Ct.id_sha1WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case Ct.id_sha256WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case Ct.id_sha384WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Ct.id_sha512WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case Ct.id_RSASSA_PSS:if(e.parameters){let r=R.AsnConvert.parse(e.parameters,Ct.RsaSaPssParams);return{name:"RSA-PSS",hash:It.container.resolve(ci).toWebAlgorithm(r.hashAlgorithm),saltLength:r.saltLength}}else return{name:"RSA-PSS"}}return null}};U.RsaAlgorithm=Rk=M.__decorate([It.injectable()],U.RsaAlgorithm);It.container.registerSingleton(of,U.RsaAlgorithm);U.ShaAlgorithm=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new te.AlgorithmIdentifier({algorithm:zn.id_sha1});case"sha-256":return new te.AlgorithmIdentifier({algorithm:zn.id_sha256});case"sha-384":return new te.AlgorithmIdentifier({algorithm:zn.id_sha384});case"sha-512":return new te.AlgorithmIdentifier({algorithm:zn.id_sha512})}return null}toWebAlgorithm(e){switch(e.algorithm){case zn.id_sha1:return{name:"SHA-1"};case zn.id_sha256:return{name:"SHA-256"};case zn.id_sha384:return{name:"SHA-384"};case zn.id_sha512:return{name:"SHA-512"}}return null}};U.ShaAlgorithm=M.__decorate([It.injectable()],U.ShaAlgorithm);It.container.registerSingleton(of,U.ShaAlgorithm);var Hi=class t{addPadding(e,r){let n=q.BufferSourceConverter.toUint8Array(r),o=new Uint8Array(e);return o.set(n,e-n.length),o.buffer}removePadding(e,r=!1){let n=q.BufferSourceConverter.toUint8Array(e);for(let o=0;o<n.length;o++)if(n[o]){n=n.slice(o);break}if(r&&n[0]>127){let o=new Uint8Array(n.length+1);return o.set(n,1),o.buffer}return n.buffer}toAsnSignature(e,r){if(e.name==="ECDSA"){let n=e.namedCurve,o=t.namedCurveSize.get(n)||t.defaultNamedCurveSize,i=new Dk.ECDSASigValue,s=q.BufferSourceConverter.toUint8Array(r);return i.r=this.removePadding(s.slice(0,o),!0),i.s=this.removePadding(s.slice(o,o+o),!0),R.AsnConvert.serialize(i)}return null}toWebSignature(e,r){if(e.name==="ECDSA"){let n=R.AsnConvert.parse(r,Dk.ECDSASigValue),o=e.namedCurve,i=t.namedCurveSize.get(o)||t.defaultNamedCurveSize,s=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return q.combine(s,a)}return null}};Hi.namedCurveSize=new Map;Hi.defaultNamedCurveSize=32;var zk="1.3.101.110",GM="1.3.101.111",Mk="1.3.101.112",WM="1.3.101.113";U.EdAlgorithm=class{toAsnAlgorithm(e){let r=null;switch(e.name.toLowerCase()){case"ed25519":r=Mk;break;case"x25519":r=zk;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":r=Mk;break;case"ed448":r=WM;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":r=zk;break;case"x448":r=GM;break}}return r?new te.AlgorithmIdentifier({algorithm:r}):null}toWebAlgorithm(e){switch(e.algorithm){case Mk:return{name:"Ed25519"};case WM:return{name:"EdDSA",namedCurve:"Ed448"};case zk:return{name:"X25519"};case GM:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};U.EdAlgorithm=M.__decorate([It.injectable()],U.EdAlgorithm);It.container.registerSingleton(of,U.EdAlgorithm);var dv,pv,fv,mv,hv,gv,yv,Wp,Yv=class extends qn{get subjectName(){return M.__classPrivateFieldGet(this,pv,"f")||M.__classPrivateFieldSet(this,pv,new Sr(this.asn.certificationRequestInfo.subject),"f"),M.__classPrivateFieldGet(this,pv,"f")}get subject(){return M.__classPrivateFieldGet(this,fv,"f")||M.__classPrivateFieldSet(this,fv,this.subjectName.toString(),"f"),M.__classPrivateFieldGet(this,fv,"f")}get signatureAlgorithm(){if(!M.__classPrivateFieldGet(this,mv,"f")){let e=It.container.resolve(ci);M.__classPrivateFieldSet(this,mv,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return M.__classPrivateFieldGet(this,mv,"f")}get signature(){return M.__classPrivateFieldGet(this,hv,"f")||M.__classPrivateFieldSet(this,hv,this.asn.signature,"f"),M.__classPrivateFieldGet(this,hv,"f")}get publicKey(){return M.__classPrivateFieldGet(this,gv,"f")||M.__classPrivateFieldSet(this,gv,new ai(this.asn.certificationRequestInfo.subjectPKInfo),"f"),M.__classPrivateFieldGet(this,gv,"f")}get attributes(){return M.__classPrivateFieldGet(this,yv,"f")||M.__classPrivateFieldSet(this,yv,this.asn.certificationRequestInfo.attributes.map(e=>Vl.create(R.AsnConvert.serialize(e))),"f"),M.__classPrivateFieldGet(this,yv,"f")}get extensions(){if(!M.__classPrivateFieldGet(this,Wp,"f")){M.__classPrivateFieldSet(this,Wp,[],"f");let e=this.getAttribute(QM.id_pkcs9_at_extensionRequest);e instanceof rf&&M.__classPrivateFieldSet(this,Wp,e.items,"f")}return M.__classPrivateFieldGet(this,Wp,"f")}get tbs(){return M.__classPrivateFieldGet(this,dv,"f")||M.__classPrivateFieldSet(this,dv,this.asn.certificationRequestInfoRaw||R.AsnConvert.serialize(this.asn.certificationRequestInfo),"f"),M.__classPrivateFieldGet(this,dv,"f")}constructor(e){let r=qn.isAsnEncoded(e)?[e,qk.CertificationRequest]:[e];super(r[0],r[1]),dv.set(this,void 0),pv.set(this,void 0),fv.set(this,void 0),mv.set(this,void 0),hv.set(this,void 0),gv.set(this,void 0),yv.set(this,void 0),Wp.set(this,void 0),this.tag=Cr.CertificateRequestTag}onInit(e){}getAttribute(e){for(let r of this.attributes)if(r.type===e)return r;return null}getAttributes(e){return this.attributes.filter(r=>r.type===e)}getExtension(e){for(let r of this.extensions)if(r.type===e)return r;return null}getExtensions(e){return this.extensions.filter(r=>r.type===e)}async verify(e=Vt.get()){let r={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(r,["verify"],e),o=It.container.resolveAll(js).reverse(),i=null;for(let a of o)if(i=a.toWebSignature(r,this.signature),i)break;if(!i)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,i,this.tbs)}toTextObject(){let e=this.toTextObjectEmpty(),r=R.AsnConvert.parse(this.rawData,qk.CertificationRequest),n=r.certificationRequestInfo,o=new Ue("",{Version:`${te.Version[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){let i=new Ue("");for(let s of this.attributes){let a=s.toTextObject();i[a[Ue.NAME]]=a}o.Attributes=i}return e.Data=o,e.Signature=new Ue("",{Algorithm:li.serializeAlgorithm(r.signatureAlgorithm),"":r.signature}),e}};dv=new WeakMap,pv=new WeakMap,fv=new WeakMap,mv=new WeakMap,hv=new WeakMap,gv=new WeakMap,yv=new WeakMap,Wp=new WeakMap;Yv.NAME="PKCS#10 Certificate Request";var ZM=class{static async create(e,r=Vt.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");let n=await r.subtle.exportKey("spki",e.keys.publicKey),o=new qk.CertificationRequest({certificationRequestInfo:new qk.CertificationRequestInfo({subjectPKInfo:R.AsnConvert.parse(n,te.SubjectPublicKeyInfo)})});if(e.name){let d=e.name instanceof Sr?e.name:new Sr(e.name);o.certificationRequestInfo.subject=R.AsnConvert.parse(d.toArrayBuffer(),te.Name)}if(e.attributes)for(let d of e.attributes)o.certificationRequestInfo.attributes.push(R.AsnConvert.parse(d.rawData,te.Attribute));if(e.extensions&&e.extensions.length){let d=new te.Attribute({type:QM.id_pkcs9_at_extensionRequest}),p=new te.Extensions;for(let f of e.extensions)p.push(R.AsnConvert.parse(f.rawData,te.Extension));d.values.push(R.AsnConvert.serialize(p)),o.certificationRequestInfo.attributes.push(d)}let i={...e.signingAlgorithm,...e.keys.privateKey.algorithm},s=It.container.resolve(ci);o.signatureAlgorithm=s.toAsnAlgorithm(i);let a=R.AsnConvert.serialize(o.certificationRequestInfo),c=await r.subtle.sign(i,e.keys.privateKey,a),l=It.container.resolveAll(js).reverse(),u=null;for(let d of l)if(u=d.toAsnSignature(i,c),u)break;if(!u)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return o.signature=u,new Yv(R.AsnConvert.serialize(o))}},vv,bv,_v,wv,xv,Sv,kv,Av,$v,Pv,Zp,Cv,Ba=class extends qn{get publicKey(){return M.__classPrivateFieldGet(this,Cv,"f")||M.__classPrivateFieldSet(this,Cv,new ai(this.asn.tbsCertificate.subjectPublicKeyInfo),"f"),M.__classPrivateFieldGet(this,Cv,"f")}get serialNumber(){if(!M.__classPrivateFieldGet(this,bv,"f")){let e=this.asn.tbsCertificate,r=new Uint8Array(e.serialNumber);r.length>1&&r[0]===0&&r[1]>127&&(r=r.slice(1)),M.__classPrivateFieldSet(this,bv,q.Convert.ToHex(r),"f")}return M.__classPrivateFieldGet(this,bv,"f")}get subjectName(){return M.__classPrivateFieldGet(this,_v,"f")||M.__classPrivateFieldSet(this,_v,new Sr(this.asn.tbsCertificate.subject),"f"),M.__classPrivateFieldGet(this,_v,"f")}get subject(){return M.__classPrivateFieldGet(this,wv,"f")||M.__classPrivateFieldSet(this,wv,this.subjectName.toString(),"f"),M.__classPrivateFieldGet(this,wv,"f")}get issuerName(){return M.__classPrivateFieldGet(this,xv,"f")||M.__classPrivateFieldSet(this,xv,new Sr(this.asn.tbsCertificate.issuer),"f"),M.__classPrivateFieldGet(this,xv,"f")}get issuer(){return M.__classPrivateFieldGet(this,Sv,"f")||M.__classPrivateFieldSet(this,Sv,this.issuerName.toString(),"f"),M.__classPrivateFieldGet(this,Sv,"f")}get notBefore(){if(!M.__classPrivateFieldGet(this,kv,"f")){let e=this.asn.tbsCertificate.validity.notBefore.utcTime||this.asn.tbsCertificate.validity.notBefore.generalTime;if(!e)throw new Error("Cannot get 'notBefore' value");M.__classPrivateFieldSet(this,kv,e,"f")}return M.__classPrivateFieldGet(this,kv,"f")}get notAfter(){if(!M.__classPrivateFieldGet(this,Av,"f")){let e=this.asn.tbsCertificate.validity.notAfter.utcTime||this.asn.tbsCertificate.validity.notAfter.generalTime;if(!e)throw new Error("Cannot get 'notAfter' value");M.__classPrivateFieldSet(this,Av,e,"f")}return M.__classPrivateFieldGet(this,Av,"f")}get signatureAlgorithm(){if(!M.__classPrivateFieldGet(this,$v,"f")){let e=It.container.resolve(ci);M.__classPrivateFieldSet(this,$v,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return M.__classPrivateFieldGet(this,$v,"f")}get signature(){return M.__classPrivateFieldGet(this,Pv,"f")||M.__classPrivateFieldSet(this,Pv,this.asn.signatureValue,"f"),M.__classPrivateFieldGet(this,Pv,"f")}get extensions(){return M.__classPrivateFieldGet(this,Zp,"f")||(M.__classPrivateFieldSet(this,Zp,[],"f"),this.asn.tbsCertificate.extensions&&M.__classPrivateFieldSet(this,Zp,this.asn.tbsCertificate.extensions.map(e=>Ir.create(R.AsnConvert.serialize(e))),"f")),M.__classPrivateFieldGet(this,Zp,"f")}get tbs(){return M.__classPrivateFieldGet(this,vv,"f")||M.__classPrivateFieldSet(this,vv,this.asn.tbsCertificateRaw||R.AsnConvert.serialize(this.asn.tbsCertificate),"f"),M.__classPrivateFieldGet(this,vv,"f")}constructor(e){let r=qn.isAsnEncoded(e)?[e,te.Certificate]:[e];super(r[0],r[1]),vv.set(this,void 0),bv.set(this,void 0),_v.set(this,void 0),wv.set(this,void 0),xv.set(this,void 0),Sv.set(this,void 0),kv.set(this,void 0),Av.set(this,void 0),$v.set(this,void 0),Pv.set(this,void 0),Zp.set(this,void 0),Cv.set(this,void 0),this.tag=Cr.CertificateTag}onInit(e){}getExtension(e){for(let r of this.extensions)if(typeof e=="string"){if(r.type===e)return r}else if(r instanceof e)return r;return null}getExtensions(e){return this.extensions.filter(r=>typeof e=="string"?r.type===e:r instanceof e)}async verify(e={},r=Vt.get()){let n,o,i=e.publicKey;try{if(!i)n={...this.publicKey.algorithm,...this.signatureAlgorithm},o=await this.publicKey.export(n,["verify"],r);else if("publicKey"in i)n={...i.publicKey.algorithm,...this.signatureAlgorithm},o=await i.publicKey.export(n,["verify"],r);else if(i instanceof ai)n={...i.algorithm,...this.signatureAlgorithm},o=await i.export(n,["verify"],r);else if(q.BufferSourceConverter.isBufferSource(i)){let l=new ai(i);n={...l.algorithm,...this.signatureAlgorithm},o=await l.export(n,["verify"],r)}else n={...i.algorithm,...this.signatureAlgorithm},o=i}catch{return!1}let s=It.container.resolveAll(js).reverse(),a=null;for(let l of s)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let c=await r.subtle.verify(this.signatureAlgorithm,o,a,this.tbs);if(e.signatureOnly)return c;{let u=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<u&&u<this.notAfter.getTime()}}async getThumbprint(...e){let r,n="SHA-1";return e[0]&&(e[0].subtle?r=e[0]:(n=e[0]||n,r=e[1])),r??(r=Vt.get()),await r.subtle.digest(n,this.rawData)}async isSelfSigned(e=Vt.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){let e=this.toTextObjectEmpty(),r=R.AsnConvert.parse(this.rawData,te.Certificate),n=r.tbsCertificate,o=new Ue("",{Version:`${te.Version[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":li.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new Ue("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(o["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(o["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){let i=new Ue("");for(let s of this.extensions){let a=s.toTextObject();i[a[Ue.NAME]]=a}o.Extensions=i}return e.Data=o,e.Signature=new Ue("",{Algorithm:li.serializeAlgorithm(r.signatureAlgorithm),"":r.signatureValue}),e}};vv=new WeakMap,bv=new WeakMap,_v=new WeakMap,wv=new WeakMap,xv=new WeakMap,Sv=new WeakMap,kv=new WeakMap,Av=new WeakMap,$v=new WeakMap,Pv=new WeakMap,Zp=new WeakMap,Cv=new WeakMap;Ba.NAME="Certificate";var Fk=class extends Array{constructor(e){if(super(),qn.isAsnEncoded(e))this.import(e);else if(e instanceof Ba)this.push(e);else if(Array.isArray(e))for(let r of e)this.push(r)}export(e){let r=new Rn.SignedData;r.version=1,r.encapContentInfo.eContentType=Rn.id_data,r.encapContentInfo.eContent=new Rn.EncapsulatedContent({single:new R.OctetString}),r.certificates=new Rn.CertificateSet(this.map(i=>new Rn.CertificateChoices({certificate:R.AsnConvert.parse(i.rawData,te.Certificate)})));let n=new Rn.ContentInfo({contentType:Rn.id_signedData,content:R.AsnConvert.serialize(r)}),o=R.AsnConvert.serialize(n);return e==="raw"?o:this.toString(e)}import(e){let r=qn.toArrayBuffer(e),n=R.AsnConvert.parse(r,Rn.ContentInfo);if(n.contentType!==Rn.id_signedData)throw new TypeError("Cannot parse CMS package. Incoming data is not a SignedData object.");let o=R.AsnConvert.parse(n.content,Rn.SignedData);this.clear();for(let i of o.certificates||[])i.certificate&&this.push(new Ba(i.certificate))}clear(){for(;this.pop(););}toString(e="pem"){let r=this.export("raw");switch(e){case"pem":return Cr.encode(r,"CMS");case"pem-chain":return this.map(n=>n.toString("pem")).join(`
`);case"asn":return R.AsnConvert.toString(r);case"hex":return q.Convert.ToHex(r);case"base64":return q.Convert.ToBase64(r);case"base64url":return q.Convert.ToBase64Url(r);case"text":return li.serialize(this.toTextObject());default:throw TypeError("Argument 'format' is unsupported value")}}toTextObject(){let e=R.AsnConvert.parse(this.export("raw"),Rn.ContentInfo),r=R.AsnConvert.parse(e.content,Rn.SignedData);return new Ue("X509Certificates",{"Content Type":Po.toString(e.contentType),Content:new Ue("",{Version:`${Rn.CMSVersion[r.version]} (${r.version})`,Certificates:new Ue("",{Certificate:this.map(o=>o.toTextObject())})})})}},KM=class{constructor(e={}){this.certificates=[],e.certificates&&(this.certificates=e.certificates)}async build(e,r=Vt.get()){let n=new Fk(e),o=e;for(;o=await this.findIssuer(o,r);){let i=await o.getThumbprint(r);for(let s of n){let a=await s.getThumbprint(r);if(q.isEqual(i,a))throw new Error("Cannot build a certificate chain. Circular dependency.")}n.push(o)}return n}async findIssuer(e,r=Vt.get()){if(!await e.isSelfSigned(r)){let n=e.getExtension(N.id_ce_authorityKeyIdentifier);for(let o of this.certificates)if(o.subject===e.issuer){if(n){if(n.keyId){let i=o.getExtension(N.id_ce_subjectKeyIdentifier);if(i&&i.keyId!==n.keyId)continue}else if(n.certId){let i=o.getExtension(N.id_ce_subjectAltName);if(i&&!(n.certId.serialNumber===o.serialNumber&&q.isEqual(R.AsnConvert.serialize(n.certId.name),R.AsnConvert.serialize(i))))continue}}try{let i={...o.publicKey.algorithm,...e.signatureAlgorithm},s=await o.publicKey.export(i,["verify"],r);if(!await e.verify({publicKey:s,signatureOnly:!0},r))continue}catch{continue}return o}}return null}};function XM(t,e=Vt.get()){let r=q.BufferSourceConverter.toUint8Array(q.Convert.FromHex(t||"")),n=r&&r.length&&r.some(i=>i>0)?new Uint8Array(r):void 0;n||(n=e.getRandomValues(new Uint8Array(16)));let o=0;for(;o<n.length-1&&n[o]===0;)o++;if(n=n.slice(o),n[0]>127){let i=new Uint8Array(n.length+1);i[0]=0,i.set(n,1),n=i}return n.buffer}var JM=class{static async createSelfSigned(e,r=Vt.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},r)}static async create(e,r=Vt.get()){var n;let o;e.publicKey instanceof ai?o=e.publicKey.rawData:"publicKey"in e.publicKey?o=e.publicKey.publicKey.rawData:q.BufferSourceConverter.isBufferSource(e.publicKey)?o=e.publicKey:o=await r.subtle.exportKey("spki",e.publicKey);let i=XM(e.serialNumber,r),s=e.notBefore||new Date,a=e.notAfter||new Date(s.getTime()+31536e6),c=new N.Certificate({tbsCertificate:new N.TBSCertificate({version:N.Version.v3,serialNumber:i,validity:new N.Validity({notBefore:s,notAfter:a}),extensions:new N.Extensions(((n=e.extensions)===null||n===void 0?void 0:n.map(g=>R.AsnConvert.parse(g.rawData,N.Extension)))||[]),subjectPublicKeyInfo:R.AsnConvert.parse(o,N.SubjectPublicKeyInfo)})});if(e.subject){let g=e.subject instanceof Sr?e.subject:new Sr(e.subject);c.tbsCertificate.subject=R.AsnConvert.parse(g.toArrayBuffer(),N.Name)}if(e.issuer){let g=e.issuer instanceof Sr?e.issuer:new Sr(e.issuer);c.tbsCertificate.issuer=R.AsnConvert.parse(g.toArrayBuffer(),N.Name)}let l={hash:"SHA-256"},u="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},d=It.container.resolve(ci);c.tbsCertificate.signature=c.signatureAlgorithm=d.toAsnAlgorithm(u);let p=R.AsnConvert.serialize(c.tbsCertificate),f="signingKey"in e?await r.subtle.sign(u,e.signingKey,p):e.signature,m=It.container.resolveAll(js).reverse(),h=null;for(let g of m)if(h=g.toAsnSignature(u,f),h)break;if(!h)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=h,new Ba(R.AsnConvert.serialize(c))}},Iv,Tv,Kp,Jp,Yp;U.X509CrlReason=void 0;(function(t){t[t.unspecified=0]="unspecified",t[t.keyCompromise=1]="keyCompromise",t[t.cACompromise=2]="cACompromise",t[t.affiliationChanged=3]="affiliationChanged",t[t.superseded=4]="superseded",t[t.cessationOfOperation=5]="cessationOfOperation",t[t.certificateHold=6]="certificateHold",t[t.removeFromCRL=8]="removeFromCRL",t[t.privilegeWithdrawn=9]="privilegeWithdrawn",t[t.aACompromise=10]="aACompromise"})(U.X509CrlReason||(U.X509CrlReason={}));var nf=class extends Fi{get serialNumber(){return M.__classPrivateFieldGet(this,Iv,"f")||M.__classPrivateFieldSet(this,Iv,q.Convert.ToHex(this.asn.userCertificate),"f"),M.__classPrivateFieldGet(this,Iv,"f")}get revocationDate(){return M.__classPrivateFieldGet(this,Tv,"f")||M.__classPrivateFieldSet(this,Tv,this.asn.revocationDate.getTime(),"f"),M.__classPrivateFieldGet(this,Tv,"f")}get reason(){return M.__classPrivateFieldGet(this,Kp,"f")===void 0&&this.extensions,M.__classPrivateFieldGet(this,Kp,"f")}get invalidity(){return M.__classPrivateFieldGet(this,Jp,"f")===void 0&&this.extensions,M.__classPrivateFieldGet(this,Jp,"f")}get extensions(){return M.__classPrivateFieldGet(this,Yp,"f")||(M.__classPrivateFieldSet(this,Yp,[],"f"),this.asn.crlEntryExtensions&&M.__classPrivateFieldSet(this,Yp,this.asn.crlEntryExtensions.map(e=>{let r=Ir.create(R.AsnConvert.serialize(e));switch(r.type){case te.id_ce_cRLReasons:M.__classPrivateFieldGet(this,Kp,"f")===void 0&&M.__classPrivateFieldSet(this,Kp,R.AsnConvert.parse(r.value,te.CRLReason).reason,"f");break;case te.id_ce_invalidityDate:M.__classPrivateFieldGet(this,Jp,"f")===void 0&&M.__classPrivateFieldSet(this,Jp,R.AsnConvert.parse(r.value,te.InvalidityDate).value,"f");break}return r}),"f")),M.__classPrivateFieldGet(this,Yp,"f")}constructor(...e){let r;if(q.BufferSourceConverter.isBufferSource(e[0])?r=q.BufferSourceConverter.toArrayBuffer(e[0]):typeof e[0]=="string"?r=R.AsnConvert.serialize(new te.RevokedCertificate({userCertificate:XM(e[0]),revocationDate:new te.Time(e[1]),crlEntryExtensions:e[2]})):e[0]instanceof te.RevokedCertificate&&(r=e[0]),!r)throw new TypeError("Cannot create X509CrlEntry instance. Wrong constructor arguments.");super(r,te.RevokedCertificate),Iv.set(this,void 0),Tv.set(this,void 0),Kp.set(this,void 0),Jp.set(this,void 0),Yp.set(this,void 0)}onInit(e){}};Iv=new WeakMap,Tv=new WeakMap,Kp=new WeakMap,Jp=new WeakMap,Yp=new WeakMap;var Ev,Ov,jv,Nv,Rv,zv,Qp,Vk=class extends qn{get version(){return this.asn.tbsCertList.version}get signatureAlgorithm(){if(!M.__classPrivateFieldGet(this,Ov,"f")){let e=It.container.resolve(ci);M.__classPrivateFieldSet(this,Ov,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return M.__classPrivateFieldGet(this,Ov,"f")}get signature(){return this.asn.signature}get issuer(){return this.issuerName.toString()}get issuerName(){return M.__classPrivateFieldGet(this,jv,"f")||M.__classPrivateFieldSet(this,jv,new Sr(this.asn.tbsCertList.issuer),"f"),M.__classPrivateFieldGet(this,jv,"f")}get thisUpdate(){if(!M.__classPrivateFieldGet(this,Nv,"f")){let e=this.asn.tbsCertList.thisUpdate.getTime();if(!e)throw new Error("Cannot get 'thisUpdate' value");M.__classPrivateFieldSet(this,Nv,e,"f")}return M.__classPrivateFieldGet(this,Nv,"f")}get nextUpdate(){var e;return M.__classPrivateFieldGet(this,Rv,"f")===void 0&&M.__classPrivateFieldSet(this,Rv,((e=this.asn.tbsCertList.nextUpdate)===null||e===void 0?void 0:e.getTime())||void 0,"f"),M.__classPrivateFieldGet(this,Rv,"f")}get entries(){var e;return M.__classPrivateFieldGet(this,zv,"f")||M.__classPrivateFieldSet(this,zv,((e=this.asn.tbsCertList.revokedCertificates)===null||e===void 0?void 0:e.map(r=>new nf(r)))||[],"f"),M.__classPrivateFieldGet(this,zv,"f")}get extensions(){return M.__classPrivateFieldGet(this,Qp,"f")||(M.__classPrivateFieldSet(this,Qp,[],"f"),this.asn.tbsCertList.crlExtensions&&M.__classPrivateFieldSet(this,Qp,this.asn.tbsCertList.crlExtensions.map(e=>Ir.create(R.AsnConvert.serialize(e))),"f")),M.__classPrivateFieldGet(this,Qp,"f")}get tbs(){return M.__classPrivateFieldGet(this,Ev,"f")||M.__classPrivateFieldSet(this,Ev,this.asn.tbsCertListRaw||R.AsnConvert.serialize(this.asn.tbsCertList),"f"),M.__classPrivateFieldGet(this,Ev,"f")}get tbsCertListSignatureAlgorithm(){return this.asn.tbsCertList.signature}get certListSignatureAlgorithm(){return this.asn.signatureAlgorithm}constructor(e){super(e,qn.isAsnEncoded(e)?te.CertificateList:void 0),this.tag=Cr.CrlTag,Ev.set(this,void 0),Ov.set(this,void 0),jv.set(this,void 0),Nv.set(this,void 0),Rv.set(this,void 0),zv.set(this,void 0),Qp.set(this,void 0)}onInit(e){}getExtension(e){for(let r of this.extensions)if(typeof e=="string"){if(r.type===e)return r}else if(r instanceof e)return r;return null}getExtensions(e){return this.extensions.filter(r=>typeof e=="string"?r.type===e:r instanceof e)}async verify(e,r=Vt.get()){if(!this.certListSignatureAlgorithm.isEqual(this.tbsCertListSignatureAlgorithm))throw new Error("algorithm identifier in the sequence tbsCertList and CertificateList mismatch");let n,o,i=e.publicKey;try{i instanceof Ba?(n={...i.publicKey.algorithm,...i.signatureAlgorithm},o=await i.publicKey.export(n,["verify"])):i instanceof ai?(n={...i.algorithm,...this.signatureAlgorithm},o=await i.export(n,["verify"])):(n={...i.algorithm,...this.signatureAlgorithm},o=i)}catch{return!1}let s=It.container.resolveAll(js).reverse(),a=null;for(let c of s)if(a=c.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return await r.subtle.verify(this.signatureAlgorithm,o,a,this.tbs)}async getThumbprint(...e){let r,n="SHA-1";return e[0]&&(e[0].subtle?r=e[0]:(n=e[0]||n,r=e[1])),r??(r=Vt.get()),await r.subtle.digest(n,this.rawData)}findRevoked(e){let r=typeof e=="string"?e:e.serialNumber,n=XM(r);for(let o of this.asn.tbsCertList.revokedCertificates||[])if(q.BufferSourceConverter.isEqual(o.userCertificate,n))return new nf(R.AsnConvert.serialize(o));return null}};Ev=new WeakMap,Ov=new WeakMap,jv=new WeakMap,Nv=new WeakMap,Rv=new WeakMap,zv=new WeakMap,Qp=new WeakMap;var YM=class{static async create(e,r=Vt.get()){var n;let o=e.issuer instanceof Sr?e.issuer:new Sr(e.issuer),i=new N.CertificateList({tbsCertList:new N.TBSCertList({version:N.Version.v2,issuer:R.AsnConvert.parse(o.toArrayBuffer(),N.Name),thisUpdate:new te.Time(e.thisUpdate||new Date)})});if(e.nextUpdate&&(i.tbsCertList.nextUpdate=new te.Time(e.nextUpdate)),e.extensions&&e.extensions.length&&(i.tbsCertList.crlExtensions=new N.Extensions(e.extensions.map(p=>R.AsnConvert.parse(p.rawData,N.Extension))||[])),e.entries&&e.entries.length){i.tbsCertList.revokedCertificates=[];for(let p of e.entries){let f=qn.toArrayBuffer(p.serialNumber);if(i.tbsCertList.revokedCertificates.findIndex(g=>q.isEqual(g.userCertificate,f))>-1)throw new Error(`Certificate serial number ${p.serialNumber} already exists in tbsCertList`);let h=new te.RevokedCertificate({userCertificate:f,revocationDate:new te.Time(p.revocationDate||new Date)});if("extensions"in p&&(!((n=p.extensions)===null||n===void 0)&&n.length)?h.crlEntryExtensions=p.extensions.map(g=>R.AsnConvert.parse(g.rawData,N.Extension)):h.crlEntryExtensions=[],!(p instanceof nf)&&(p.reason&&h.crlEntryExtensions.push(new N.Extension({extnID:N.id_ce_cRLReasons,critical:!1,extnValue:new R.OctetString(R.AsnConvert.serialize(new N.CRLReason(p.reason)))})),p.invalidity&&h.crlEntryExtensions.push(new N.Extension({extnID:N.id_ce_invalidityDate,critical:!1,extnValue:new R.OctetString(R.AsnConvert.serialize(new N.InvalidityDate(p.invalidity)))})),p.issuer)){let g=e.issuer instanceof Sr?e.issuer:new Sr(e.issuer);h.crlEntryExtensions.push(new N.Extension({extnID:N.id_ce_certificateIssuer,critical:!1,extnValue:new R.OctetString(R.AsnConvert.serialize(R.AsnConvert.parse(g.toArrayBuffer(),N.Name)))}))}i.tbsCertList.revokedCertificates.push(h)}}let s={...e.signingAlgorithm,...e.signingKey.algorithm},a=It.container.resolve(ci);i.tbsCertList.signature=i.signatureAlgorithm=a.toAsnAlgorithm(s);let c=R.AsnConvert.serialize(i.tbsCertList),l=await r.subtle.sign(s,e.signingKey,c),u=It.container.resolveAll(js).reverse(),d=null;for(let p of u)if(d=p.toAsnSignature(s,l),d)break;if(!d)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return i.signature=d,new Vk(R.AsnConvert.serialize(i))}};Ir.register(N.id_ce_basicConstraints,Uv);Ir.register(N.id_ce_extKeyUsage,Lv);Ir.register(N.id_ce_keyUsage,Fv);Ir.register(N.id_ce_subjectKeyIdentifier,Vv);Ir.register(N.id_ce_authorityKeyIdentifier,Bv);Ir.register(N.id_ce_subjectAltName,Hv);Ir.register(N.id_ce_cRLDistributionPoints,Wv);Ir.register(N.id_pe_authorityInfoAccess,Zv);Ir.register(N.id_ce_issuerAltName,Kv);Vl.register(Xp.id_pkcs9_at_challengePassword,Jv);Vl.register(Xp.id_pkcs9_at_extensionRequest,rf);It.container.registerSingleton(js,Lk);It.container.registerSingleton(js,Hi);Hi.namedCurveSize.set("P-256",32);Hi.namedCurveSize.set("K-256",32);Hi.namedCurveSize.set("P-384",48);Hi.namedCurveSize.set("P-521",66);U.AlgorithmProvider=Bk;U.AsnData=Fi;U.AsnDefaultSignatureFormatter=Lk;U.AsnEcSignatureFormatter=Hi;U.Attribute=Fl;U.AttributeFactory=Vl;U.AuthorityInfoAccessExtension=Zv;U.AuthorityKeyIdentifierExtension=Bv;U.BasicConstraintsExtension=Uv;U.CRLDistributionPointsExtension=Wv;U.CertificatePolicyExtension=Gv;U.ChallengePasswordAttribute=Jv;U.CryptoProvider=ef;U.DN=Ik;U.DNS=Ck;U.DefaultAlgorithmSerializer=Uk;U.EMAIL=Tk;U.ExtendedKeyUsageExtension=Lv;U.Extension=Mn;U.ExtensionFactory=Ir;U.ExtensionsAttribute=rf;U.GUID=jk;U.GeneralName=si;U.GeneralNames=Vi;U.IP=Ek;U.IssuerAlternativeNameExtension=Kv;U.KeyUsagesExtension=Fv;U.Name=Sr;U.NameIdentifier=Dv;U.OidSerializer=Po;U.PemConverter=Cr;U.PemData=qn;U.Pkcs10CertificateRequest=Yv;U.Pkcs10CertificateRequestGenerator=ZM;U.PublicKey=ai;U.REGISTERED_ID=uv;U.SubjectAlternativeNameExtension=Hv;U.SubjectKeyIdentifierExtension=Vv;U.TextConverter=li;U.TextObject=Ue;U.UPN=Nk;U.URL=Ok;U.X509Certificate=Ba;U.X509CertificateGenerator=JM;U.X509Certificates=Fk;U.X509ChainBuilder=KM;U.X509Crl=Vk;U.X509CrlEntry=nf;U.X509CrlGenerator=YM;U.cryptoProvider=Vt;U.diAlgorithm=of;U.diAlgorithmProvider=ci;U.diAsnSignatureFormatter=js;U.idEd25519=Mk;U.idEd448=WM;U.idX25519=zk;U.idX448=GM});var E9=y(T9=>{var{X509CertificateGenerator:eD,X509Certificate:tD,X509ChainBuilder:gve,BasicConstraintsExtension:yve,KeyUsagesExtension:vve,KeyUsageFlags:A9,ExtendedKeyUsageExtension:bve,ExtendedKeyUsage:$9,SubjectAlternativeNameExtension:_ve,GeneralName:Eze}=k9(),nD=require("crypto"),Co=nD.webcrypto;function P9(t){var e=parseInt(t[0],16);return e<8?t:(e-=8,e.toString()+t.substring(1))}function sf(t){switch(t){case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:return"SHA-1"}}function C9(t){return{name:"RSASSA-PKCS1-v1_5",hash:sf(t)}}function rD(t){let e={commonName:"CN",countryName:"C",ST:"ST",localityName:"L",organizationName:"O",OU:"OU"};return t.map(r=>{let n=r.name||r.shortName;return`${e[n]||n}=${r.value}`}).join(", ")}async function I9(t,e){let r=t.match(/-----BEGIN PRIVATE KEY-----([\s\S]*?)-----END PRIVATE KEY-----/),n=t.match(/-----BEGIN RSA PRIVATE KEY-----([\s\S]*?)-----END RSA PRIVATE KEY-----/);if(r){let o=r[1].replace(/\s/g,""),i=Buffer.from(o,"base64");return await Co.subtle.importKey("pkcs8",i,{name:"RSASSA-PKCS1-v1_5",hash:sf(e)},!0,["sign"])}else if(n){let s=nD.createPrivateKey(t).export({type:"pkcs8",format:"pem"}).replace(/-----BEGIN PRIVATE KEY-----/,"").replace(/-----END PRIVATE KEY-----/,"").replace(/\s/g,""),a=Buffer.from(s,"base64");return await Co.subtle.importKey("pkcs8",a,{name:"RSASSA-PKCS1-v1_5",hash:sf(e)},!0,["sign"])}else throw new Error("Unsupported private key format. Expected PKCS#8 or PKCS#1 RSA key.")}async function wve(t,e){let r=t.replace(/-----BEGIN PUBLIC KEY-----/,"").replace(/-----END PUBLIC KEY-----/,"").replace(/\s/g,""),n=Buffer.from(r,"base64");return await Co.subtle.importKey("spki",n,{name:"RSASSA-PKCS1-v1_5",hash:sf(e)},!0,["verify"])}async function xve(t,e,r,n){let{privateKey:o,publicKey:i}=t,s=Co.getRandomValues(new Uint8Array(9)),a=P9(Buffer.from(s).toString("hex")),c=r.notBeforeDate||new Date,l;r.notAfterDate?l=r.notAfterDate:(l=new Date(c),l.setDate(l.getDate()+365)),e=e||[{name:"commonName",value:"example.org"},{name:"countryName",value:"US"},{shortName:"ST",value:"Virginia"},{name:"localityName",value:"Blacksburg"},{name:"organizationName",value:"Test"},{shortName:"OU",value:"Test"}];let u=rD(e),d=C9(r.algorithm),p=e.find(Yt=>Yt.name==="commonName"||Yt.shortName==="CN"),f=p?p.value:"localhost",m=[new yve(!1,void 0,!0),new vve(A9.digitalSignature|A9.keyEncipherment,!0),new bve([$9.serverAuth,$9.clientAuth],!1),new _ve([{type:"dns",value:f},...f==="localhost"?[{type:"ip",value:"127.0.0.1"}]:[]],!1)],h;if(n){let Yt=new tD(n.cert),di=await I9(n.key,r.algorithm||"sha256");h=await eD.create({serialNumber:a,subject:u,issuer:Yt.subject,notBefore:c,notAfter:l,signingAlgorithm:d,publicKey:i,signingKey:di,extensions:m})}else h=await eD.createSelfSigned({serialNumber:a,name:u,notBefore:c,notAfter:l,signingAlgorithm:d,keys:{privateKey:o,publicKey:i},extensions:m});let g=h.rawData,v=await Co.subtle.digest("SHA-1",g),b=Buffer.from(v).toString("hex").match(/.{2}/g).join(":"),S=await Co.subtle.exportKey("pkcs8",o),j=await Co.subtle.exportKey("spki",i),C;r.passphrase?C=nD.createPrivateKey({key:Buffer.from(S),format:"der",type:"pkcs8"}).export({type:"pkcs8",format:"pem",cipher:"aes-256-cbc",passphrase:r.passphrase}):C=`-----BEGIN PRIVATE KEY-----
`+Buffer.from(S).toString("base64").match(/.{1,64}/g).join(`
`)+`
-----END PRIVATE KEY-----
`;let ie=`-----BEGIN PUBLIC KEY-----
`+Buffer.from(j).toString("base64").match(/.{1,64}/g).join(`
`)+`
-----END PUBLIC KEY-----
`,pe=h.toString("pem"),me={private:C,public:ie,cert:pe,fingerprint:b};if(r&&r.clientCertificate){let Yt=typeof r.clientCertificate=="object"?r.clientCertificate:{},di=Yt.keySize||r.clientCertificateKeySize||2048,eu=Yt.algorithm||r.algorithm||"sha1",lb=Yt.cn||r.clientCertificateCN||"John Doe jdoe123",tu=await Co.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:di,publicExponent:new Uint8Array([1,0,1]),hash:sf(eu)},!0,["sign","verify"]),ub=Co.getRandomValues(new Uint8Array(9)),db=P9(Buffer.from(ub).toString("hex")),ru=Yt.notBeforeDate||new Date,Va;Yt.notAfterDate?Va=Yt.notAfterDate:(Va=new Date(ru),Va.setFullYear(ru.getFullYear()+1));let he=JSON.parse(JSON.stringify(e));for(let nu=0;nu<he.length;nu++)he[nu].name==="commonName"&&(he[nu]={name:"commonName",value:lb});let qs=rD(he),dA=rD(e),Zt=C9(eu),pA=await eD.create({serialNumber:db,subject:qs,issuer:dA,notBefore:ru,notAfter:Va,signingAlgorithm:Zt,publicKey:tu.publicKey,signingKey:o}),fA=await Co.subtle.exportKey("pkcs8",tu.privateKey),pb=await Co.subtle.exportKey("spki",tu.publicKey);me.clientprivate=`-----BEGIN PRIVATE KEY-----
`+Buffer.from(fA).toString("base64").match(/.{1,64}/g).join(`
`)+`
-----END PRIVATE KEY-----
`,me.clientpublic=`-----BEGIN PUBLIC KEY-----
`+Buffer.from(pb).toString("base64").match(/.{1,64}/g).join(`
`)+`
-----END PUBLIC KEY-----
`,me.clientcert=pA.toString("pem")}let Ce=new tD(h.rawData),Ge=[Ce];if(n){let Yt=new tD(n.cert);Ge.push(Yt)}if((await new gve({certificates:Ge}).build(Ce)).length===0)throw new Error("Certificate could not be verified.");return me}T9.generate=async function(e,r){e=e||void 0,r=r||{};let n=r.keySize||2048,o;return r.keyPair?o={privateKey:await I9(r.keyPair.privateKey,r.algorithm||"sha1"),publicKey:await wve(r.keyPair.publicKey,r.algorithm||"sha1")}:o=await Co.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:n,publicExponent:new Uint8Array([1,0,1]),hash:sf(r.algorithm||"sha1")},!0,["sign","verify"]),await xve(o,e,r,r.ca)}});var Ns=y((jze,N9)=>{"use strict";var O9=["nodebuffer","arraybuffer","fragments"],j9=typeof Blob<"u";j9&&O9.push("blob");N9.exports={BINARY_TYPES:O9,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:j9,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Xv=y((Nze,Hk)=>{"use strict";var{EMPTY_BUFFER:Sve}=Ns(),oD=Buffer[Symbol.species];function kve(t,e){if(t.length===0)return Sve;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let o=0;o<t.length;o++){let i=t[o];r.set(i,n),n+=i.length}return n<e?new oD(r.buffer,r.byteOffset,n):r}function R9(t,e,r,n,o){for(let i=0;i<o;i++)r[n+i]=t[i]^e[i&3]}function z9(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function Ave(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function iD(t){if(iD.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new oD(t):ArrayBuffer.isView(t)?e=new oD(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),iD.readOnly=!1),e}Hk.exports={concat:kve,mask:R9,toArrayBuffer:Ave,toBuffer:iD,unmask:z9};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");Hk.exports.mask=function(e,r,n,o,i){i<48?R9(e,r,n,o,i):t.mask(e,r,n,o,i)},Hk.exports.unmask=function(e,r){e.length<32?z9(e,r):t.unmask(e,r)}}catch{}});var q9=y((Rze,D9)=>{"use strict";var M9=Symbol("kDone"),sD=Symbol("kRun"),aD=class{constructor(e){this[M9]=()=>{this.pending--,this[sD]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[sD]()}[sD](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[M9])}}};D9.exports=aD});var tb=y((zze,F9)=>{"use strict";var eb=require("zlib"),B9=Xv(),$ve=q9(),{kStatusCode:U9}=Ns(),Pve=Buffer[Symbol.species],Cve=Buffer.from([0,0,255,255]),Wk=Symbol("permessage-deflate"),Rs=Symbol("total-length"),af=Symbol("callback"),Ua=Symbol("buffers"),cf=Symbol("error"),Gk,cD=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Gk){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Gk=new $ve(o)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[af];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(o=>!(r.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>o.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let o=r[n];if(o.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(o=o[0],n==="client_max_window_bits"){if(o!==!0){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else if(n==="server_max_window_bits"){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=i}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=o})}),e}decompress(e,r,n){Gk.add(o=>{this._decompress(e,r,(i,s)=>{o(),n(i,s)})})}compress(e,r,n){Gk.add(o=>{this._compress(e,r,(i,s)=>{o(),n(i,s)})})}_decompress(e,r,n){let o=this._isServer?"client":"server";if(!this._inflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?eb.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=eb.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[Wk]=this,this._inflate[Rs]=0,this._inflate[Ua]=[],this._inflate.on("error",Tve),this._inflate.on("data",L9)}this._inflate[af]=n,this._inflate.write(e),r&&this._inflate.write(Cve),this._inflate.flush(()=>{let i=this._inflate[cf];if(i){this._inflate.close(),this._inflate=null,n(i);return}let s=B9.concat(this._inflate[Ua],this._inflate[Rs]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Rs]=0,this._inflate[Ua]=[],r&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),n(null,s)})}_compress(e,r,n){let o=this._isServer?"server":"client";if(!this._deflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?eb.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=eb.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[Rs]=0,this._deflate[Ua]=[],this._deflate.on("data",Ive)}this._deflate[af]=n,this._deflate.write(e),this._deflate.flush(eb.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=B9.concat(this._deflate[Ua],this._deflate[Rs]);r&&(i=new Pve(i.buffer,i.byteOffset,i.length-4)),this._deflate[af]=null,this._deflate[Rs]=0,this._deflate[Ua]=[],r&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),n(null,i)})}};F9.exports=cD;function Ive(t){this[Ua].push(t),this[Rs]+=t.length}function L9(t){if(this[Rs]+=t.length,this[Wk]._maxPayload<1||this[Rs]<=this[Wk]._maxPayload){this[Ua].push(t);return}this[cf]=new RangeError("Max payload size exceeded"),this[cf].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[cf][U9]=1009,this.removeListener("data",L9),this.reset()}function Tve(t){if(this[Wk]._inflate=null,this[cf]){this[af](this[cf]);return}t[U9]=1007,this[af](t)}});var lf=y((Mze,Zk)=>{"use strict";var{isUtf8:V9}=require("buffer"),{hasBlob:Eve}=Ns(),Ove=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function jve(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function lD(t){let e=t.length,r=0;for(;r<e;)if((t[r]&128)===0)r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function Nve(t){return Eve&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}Zk.exports={isBlob:Nve,isValidStatusCode:jve,isValidUTF8:lD,tokenChars:Ove};if(V9)Zk.exports.isValidUTF8=function(t){return t.length<24?lD(t):V9(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");Zk.exports.isValidUTF8=function(e){return e.length<32?lD(e):t(e)}}catch{}});var mD=y((Dze,Y9)=>{"use strict";var{Writable:Rve}=require("stream"),H9=tb(),{BINARY_TYPES:zve,EMPTY_BUFFER:G9,kStatusCode:Mve,kWebSocket:Dve}=Ns(),{concat:uD,toArrayBuffer:qve,unmask:Bve}=Xv(),{isValidStatusCode:Uve,isValidUTF8:W9}=lf(),Kk=Buffer[Symbol.species],Io=0,Z9=1,K9=2,J9=3,dD=4,pD=5,Jk=6,fD=class extends Rve{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||zve[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Dve]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=Io}_write(e,r,n){if(this._opcode===8&&this._state==Io)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Kk(n.buffer,n.byteOffset+e,n.length-e),new Kk(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],o=r.length-e;e>=n.length?r.set(this._buffers.shift(),o):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),o),this._buffers[0]=new Kk(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case Io:this.getInfo(e);break;case Z9:this.getPayloadLength16(e);break;case K9:this.getPayloadLength64(e);break;case J9:this.getMask();break;case dD:this.getData(e);break;case pD:case Jk:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if((r[0]&48)!==0){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(o);return}let n=(r[0]&64)===64;if(n&&!this._extensions[H9.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(o);return}if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(o);return}this._payloadLength===126?this._state=Z9:this._payloadLength===127?this._state=K9:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(o);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=J9:this._state=dD}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=dD}getData(e){let r=G9;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&Bve(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=pD,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[H9.extensionName].decompress(e,this._fin,(o,i)=>{if(o)return r(o);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(s);return}this._fragments.push(i)}this.dataMessage(r),this._state===Io&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=Io;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=uD(n,r):this._binaryType==="arraybuffer"?o=qve(uD(n,r)):this._binaryType==="blob"?o=new Blob(n):o=n,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=Io):(this._state=Jk,setImmediate(()=>{this.emit("message",o,!0),this._state=Io,this.startLoop(e)}))}else{let o=uD(n,r);if(!this._skipUTF8Validation&&!W9(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===pD||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=Io):(this._state=Jk,setImmediate(()=>{this.emit("message",o,!1),this._state=Io,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,G9),this.end();else{let n=e.readUInt16BE(0);if(!Uve(n)){let i=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(i);return}let o=new Kk(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!W9(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(i);return}this._loop=!1,this.emit("conclude",n,o),this.end()}this._state=Io;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=Io):(this._state=Jk,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=Io,this.startLoop(r)}))}createError(e,r,n,o,i){this._loop=!1,this._errored=!0;let s=new e(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(s,this.createError),s.code=i,s[Mve]=o,s}};Y9.exports=fD});var yD=y((Bze,eK)=>{"use strict";var{Duplex:qze}=require("stream"),{randomFillSync:Lve}=require("crypto"),Q9=tb(),{EMPTY_BUFFER:Fve,kWebSocket:Vve,NOOP:Hve}=Ns(),{isBlob:uf,isValidStatusCode:Gve}=lf(),{mask:X9,toBuffer:Hl}=Xv(),To=Symbol("kByteLength"),Wve=Buffer.alloc(4),Yk=8*1024,Gl,df=Yk,ui=0,Zve=1,Kve=2,hD=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=ui,this.onerror=Hve,this[Vve]=void 0}static frame(e,r){let n,o=!1,i=2,s=!1;r.mask&&(n=r.maskBuffer||Wve,r.generateMask?r.generateMask(n):(df===Yk&&(Gl===void 0&&(Gl=Buffer.alloc(Yk)),Lve(Gl,0,Yk),df=0),n[0]=Gl[df++],n[1]=Gl[df++],n[2]=Gl[df++],n[3]=Gl[df++]),s=(n[0]|n[1]|n[2]|n[3])===0,i=6);let a;typeof e=="string"?(!r.mask||s)&&r[To]!==void 0?a=r[To]:(e=Buffer.from(e),a=e.length):(a=e.length,o=r.mask&&r.readOnly&&!s);let c=a;a>=65536?(i+=8,c=127):a>125&&(i+=2,c=126);let l=Buffer.allocUnsafe(o?a+i:i);return l[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(l[0]|=64),l[1]=c,c===126?l.writeUInt16BE(a,2):c===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),r.mask?(l[1]|=128,l[i-4]=n[0],l[i-3]=n[1],l[i-2]=n[2],l[i-1]=n[3],s?[l,e]:o?(X9(e,n,l,i,a),[l]):(X9(e,n,e,0,a),[l,e])):[l,e]}close(e,r,n,o){let i;if(e===void 0)i=Fve;else{if(typeof e!="number"||!Gve(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof r=="string"?i.write(r,2):i.set(r,2)}}let s={[To]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==ui?this.enqueue([this.dispatch,i,!1,s,o]):this.sendFrame(t.frame(i,s),o)}ping(e,r,n){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):uf(e)?(o=e.size,i=!1):(e=Hl(e),o=e.length,i=Hl.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[To]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};uf(e)?this._state!==ui?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):this._state!==ui?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}pong(e,r,n){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):uf(e)?(o=e.size,i=!1):(e=Hl(e),o=e.length,i=Hl.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[To]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};uf(e)?this._state!==ui?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):this._state!==ui?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}send(e,r,n){let o=this._extensions[Q9.extensionName],i=r.binary?2:1,s=r.compress,a,c;typeof e=="string"?(a=Buffer.byteLength(e),c=!1):uf(e)?(a=e.size,c=!1):(e=Hl(e),a=e.length,c=Hl.readOnly),this._firstFragment?(this._firstFragment=!1,s&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=a>=o._threshold),this._compress=s):(s=!1,i=0),r.fin&&(this._firstFragment=!0);let l={[To]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:s};uf(e)?this._state!==ui?this.enqueue([this.getBlobData,e,this._compress,l,n]):this.getBlobData(e,this._compress,l,n):this._state!==ui?this.enqueue([this.dispatch,e,this._compress,l,n]):this.dispatch(e,this._compress,l,n)}getBlobData(e,r,n,o){this._bufferedBytes+=n[To],this._state=Kve,e.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(gD,this,a,o);return}this._bufferedBytes-=n[To];let s=Hl(i);r?this.dispatch(s,r,n,o):(this._state=ui,this.sendFrame(t.frame(s,n),o),this.dequeue())}).catch(i=>{process.nextTick(Jve,this,i,o)})}dispatch(e,r,n,o){if(!r){this.sendFrame(t.frame(e,n),o);return}let i=this._extensions[Q9.extensionName];this._bufferedBytes+=n[To],this._state=Zve,i.compress(e,n.fin,(s,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");gD(this,c,o);return}this._bufferedBytes-=n[To],this._state=ui,n.readOnly=!1,this.sendFrame(t.frame(a,n),o),this.dequeue()})}dequeue(){for(;this._state===ui&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][To],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][To],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};eK.exports=hD;function gD(t,e,r){typeof r=="function"&&r(e);for(let n=0;n<t._queue.length;n++){let o=t._queue[n],i=o[o.length-1];typeof i=="function"&&i(e)}}function Jve(t,e,r){gD(t,e,r),t.onerror(e)}});var lK=y((Uze,cK)=>{"use strict";var{kForOnEventAttribute:rb,kListener:vD}=Ns(),tK=Symbol("kCode"),rK=Symbol("kData"),nK=Symbol("kError"),oK=Symbol("kMessage"),iK=Symbol("kReason"),pf=Symbol("kTarget"),sK=Symbol("kType"),aK=Symbol("kWasClean"),zs=class{constructor(e){this[pf]=null,this[sK]=e}get target(){return this[pf]}get type(){return this[sK]}};Object.defineProperty(zs.prototype,"target",{enumerable:!0});Object.defineProperty(zs.prototype,"type",{enumerable:!0});var Wl=class extends zs{constructor(e,r={}){super(e),this[tK]=r.code===void 0?0:r.code,this[iK]=r.reason===void 0?"":r.reason,this[aK]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[tK]}get reason(){return this[iK]}get wasClean(){return this[aK]}};Object.defineProperty(Wl.prototype,"code",{enumerable:!0});Object.defineProperty(Wl.prototype,"reason",{enumerable:!0});Object.defineProperty(Wl.prototype,"wasClean",{enumerable:!0});var ff=class extends zs{constructor(e,r={}){super(e),this[nK]=r.error===void 0?null:r.error,this[oK]=r.message===void 0?"":r.message}get error(){return this[nK]}get message(){return this[oK]}};Object.defineProperty(ff.prototype,"error",{enumerable:!0});Object.defineProperty(ff.prototype,"message",{enumerable:!0});var nb=class extends zs{constructor(e,r={}){super(e),this[rK]=r.data===void 0?null:r.data}get data(){return this[rK]}};Object.defineProperty(nb.prototype,"data",{enumerable:!0});var Yve={addEventListener(t,e,r={}){for(let o of this.listeners(t))if(!r[rb]&&o[vD]===e&&!o[rb])return;let n;if(t==="message")n=function(i,s){let a=new nb("message",{data:s?i:i.toString()});a[pf]=this,Qk(e,this,a)};else if(t==="close")n=function(i,s){let a=new Wl("close",{code:i,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[pf]=this,Qk(e,this,a)};else if(t==="error")n=function(i){let s=new ff("error",{error:i,message:i.message});s[pf]=this,Qk(e,this,s)};else if(t==="open")n=function(){let i=new zs("open");i[pf]=this,Qk(e,this,i)};else return;n[rb]=!!r[rb],n[vD]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[vD]===e&&!r[rb]){this.removeListener(t,r);break}}};cK.exports={CloseEvent:Wl,ErrorEvent:ff,Event:zs,EventTarget:Yve,MessageEvent:nb};function Qk(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var bD=y((Lze,uK)=>{"use strict";var{tokenChars:ob}=lf();function Gi(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function Qve(t){let e=Object.create(null),r=Object.create(null),n=!1,o=!1,i=!1,s,a,c=-1,l=-1,u=-1,d=0;for(;d<t.length;d++)if(l=t.charCodeAt(d),s===void 0)if(u===-1&&ob[l]===1)c===-1&&(c=d);else if(d!==0&&(l===32||l===9))u===-1&&c!==-1&&(u=d);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);u===-1&&(u=d);let f=t.slice(c,u);l===44?(Gi(e,f,r),r=Object.create(null)):s=f,c=u=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);else if(a===void 0)if(u===-1&&ob[l]===1)c===-1&&(c=d);else if(l===32||l===9)u===-1&&c!==-1&&(u=d);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);u===-1&&(u=d),Gi(r,t.slice(c,u),!0),l===44&&(Gi(e,s,r),r=Object.create(null),s=void 0),c=u=-1}else if(l===61&&c!==-1&&u===-1)a=t.slice(c,d),c=u=-1;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(o){if(ob[l]!==1)throw new SyntaxError(`Unexpected character at index ${d}`);c===-1?c=d:n||(n=!0),o=!1}else if(i)if(ob[l]===1)c===-1&&(c=d);else if(l===34&&c!==-1)i=!1,u=d;else if(l===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(l===34&&t.charCodeAt(d-1)===61)i=!0;else if(u===-1&&ob[l]===1)c===-1&&(c=d);else if(c!==-1&&(l===32||l===9))u===-1&&(u=d);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);u===-1&&(u=d);let f=t.slice(c,u);n&&(f=f.replace(/\\/g,""),n=!1),Gi(r,a,f),l===44&&(Gi(e,s,r),r=Object.create(null),s=void 0),a=void 0,c=u=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);if(c===-1||i||l===32||l===9)throw new SyntaxError("Unexpected end of input");u===-1&&(u=d);let p=t.slice(c,u);return s===void 0?Gi(e,p,r):(a===void 0?Gi(r,p,!0):n?Gi(r,a,p.replace(/\\/g,"")):Gi(r,a,p),Gi(e,s,r)),e}function Xve(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(o=>{let i=n[o];return Array.isArray(i)||(i=[i]),i.map(s=>s===!0?o:`${o}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}uK.exports={format:Xve,parse:Qve}});var rA=y((Hze,xK)=>{"use strict";var ebe=require("events"),tbe=require("https"),rbe=require("http"),fK=require("net"),nbe=require("tls"),{randomBytes:obe,createHash:ibe}=require("crypto"),{Duplex:Fze,Readable:Vze}=require("stream"),{URL:_D}=require("url"),La=tb(),sbe=mD(),abe=yD(),{isBlob:cbe}=lf(),{BINARY_TYPES:dK,EMPTY_BUFFER:Xk,GUID:lbe,kForOnEventAttribute:wD,kListener:ube,kStatusCode:dbe,kWebSocket:Tr,NOOP:mK}=Ns(),{EventTarget:{addEventListener:pbe,removeEventListener:fbe}}=lK(),{format:mbe,parse:hbe}=bD(),{toBuffer:gbe}=Xv(),ybe=30*1e3,hK=Symbol("kAborted"),xD=[8,13],Ms=["CONNECTING","OPEN","CLOSING","CLOSED"],vbe=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,Wt=class t extends ebe{constructor(e,r,n){super(),this._binaryType=dK[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Xk,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),gK(this,e,r,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){dK.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let o=new sbe({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new abe(e,this._extensions,n.generateMask);this._receiver=o,this._sender=i,this._socket=e,o[Tr]=this,i[Tr]=this,e[Tr]=this,o.on("conclude",wbe),o.on("drain",xbe),o.on("error",Sbe),o.on("message",kbe),o.on("ping",Abe),o.on("pong",$be),i.onerror=Pbe,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",bK),e.on("data",tA),e.on("end",_K),e.on("error",wK),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[La.extensionName]&&this._extensions[La.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){to(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),vK(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){SD(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Xk,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){SD(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Xk,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){SD(this,e,n);return}let o={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[La.extensionName]||(o.compress=!1),this._sender.send(e||Xk,o,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){to(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(Wt,"CONNECTING",{enumerable:!0,value:Ms.indexOf("CONNECTING")});Object.defineProperty(Wt.prototype,"CONNECTING",{enumerable:!0,value:Ms.indexOf("CONNECTING")});Object.defineProperty(Wt,"OPEN",{enumerable:!0,value:Ms.indexOf("OPEN")});Object.defineProperty(Wt.prototype,"OPEN",{enumerable:!0,value:Ms.indexOf("OPEN")});Object.defineProperty(Wt,"CLOSING",{enumerable:!0,value:Ms.indexOf("CLOSING")});Object.defineProperty(Wt.prototype,"CLOSING",{enumerable:!0,value:Ms.indexOf("CLOSING")});Object.defineProperty(Wt,"CLOSED",{enumerable:!0,value:Ms.indexOf("CLOSED")});Object.defineProperty(Wt.prototype,"CLOSED",{enumerable:!0,value:Ms.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(Wt.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(Wt.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[wD])return e[ube];return null},set(e){for(let r of this.listeners(t))if(r[wD]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[wD]:!0})}})});Wt.prototype.addEventListener=pbe;Wt.prototype.removeEventListener=fbe;xK.exports=Wt;function gK(t,e,r,n){let o={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:xD[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=o.autoPong,!xD.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${xD.join(", ")})`);let i;if(e instanceof _D)i=e;else try{i=new _D(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),t._url=i.href;let s=i.protocol==="wss:",a=i.protocol==="ws+unix:",c;if(i.protocol!=="ws:"&&!s&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"),c){let h=new SyntaxError(c);if(t._redirects===0)throw h;eA(t,h);return}let l=s?443:80,u=obe(16).toString("base64"),d=s?tbe.request:rbe.request,p=new Set,f;if(o.createConnection=o.createConnection||(s?_be:bbe),o.defaultPort=o.defaultPort||l,o.port=i.port||l,o.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},o.path=i.pathname+i.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(f=new La(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=mbe({[La.extensionName]:f.offer()})),r.length){for(let h of r){if(typeof h!="string"||!vbe.test(h)||p.has(h))throw new SyntaxError("An invalid or duplicated subprotocol was specified");p.add(h)}o.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(i.username||i.password)&&(o.auth=`${i.username}:${i.password}`),a){let h=o.path.split(":");o.socketPath=h[0],o.path=h[1]}let m;if(o.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=s,t._originalHostOrSocketPath=a?o.socketPath:i.host;let h=n&&n.headers;if(n={...n,headers:{}},h)for(let[g,v]of Object.entries(h))n.headers[g.toLowerCase()]=v}else if(t.listenerCount("redirect")===0){let h=a?t._originalIpc?o.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:i.host===t._originalHostOrSocketPath;(!h||t._originalSecure&&!s)&&(delete o.headers.authorization,delete o.headers.cookie,h||delete o.headers.host,o.auth=void 0)}o.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),m=t._req=d(o),t._redirects&&t.emit("redirect",t.url,m)}else m=t._req=d(o);o.timeout&&m.on("timeout",()=>{to(t,m,"Opening handshake has timed out")}),m.on("error",h=>{m===null||m[hK]||(m=t._req=null,eA(t,h))}),m.on("response",h=>{let g=h.headers.location,v=h.statusCode;if(g&&o.followRedirects&&v>=300&&v<400){if(++t._redirects>o.maxRedirects){to(t,m,"Maximum redirects exceeded");return}m.abort();let b;try{b=new _D(g,e)}catch{let j=new SyntaxError(`Invalid URL: ${g}`);eA(t,j);return}gK(t,b,r,n)}else t.emit("unexpected-response",m,h)||to(t,m,`Unexpected server response: ${h.statusCode}`)}),m.on("upgrade",(h,g,v)=>{if(t.emit("upgrade",h),t.readyState!==Wt.CONNECTING)return;m=t._req=null;let b=h.headers.upgrade;if(b===void 0||b.toLowerCase()!=="websocket"){to(t,g,"Invalid Upgrade header");return}let S=ibe("sha1").update(u+lbe).digest("base64");if(h.headers["sec-websocket-accept"]!==S){to(t,g,"Invalid Sec-WebSocket-Accept header");return}let j=h.headers["sec-websocket-protocol"],C;if(j!==void 0?p.size?p.has(j)||(C="Server sent an invalid subprotocol"):C="Server sent a subprotocol but none was requested":p.size&&(C="Server sent no subprotocol"),C){to(t,g,C);return}j&&(t._protocol=j);let ie=h.headers["sec-websocket-extensions"];if(ie!==void 0){if(!f){to(t,g,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let pe;try{pe=hbe(ie)}catch{to(t,g,"Invalid Sec-WebSocket-Extensions header");return}let me=Object.keys(pe);if(me.length!==1||me[0]!==La.extensionName){to(t,g,"Server indicated an extension that was not requested");return}try{f.accept(pe[La.extensionName])}catch{to(t,g,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[La.extensionName]=f}t.setSocket(g,v,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(m,t):m.end()}function eA(t,e){t._readyState=Wt.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function bbe(t){return t.path=t.socketPath,fK.connect(t)}function _be(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=fK.isIP(t.host)?"":t.host),nbe.connect(t)}function to(t,e,r){t._readyState=Wt.CLOSING;let n=new Error(r);Error.captureStackTrace(n,to),e.setHeader?(e[hK]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(eA,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function SD(t,e,r){if(e){let n=cbe(e)?e.size:gbe(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${Ms[t.readyState]})`);process.nextTick(r,n)}}function wbe(t,e){let r=this[Tr];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[Tr]!==void 0&&(r._socket.removeListener("data",tA),process.nextTick(yK,r._socket),t===1005?r.close():r.close(t,e))}function xbe(){let t=this[Tr];t.isPaused||t._socket.resume()}function Sbe(t){let e=this[Tr];e._socket[Tr]!==void 0&&(e._socket.removeListener("data",tA),process.nextTick(yK,e._socket),e.close(t[dbe])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function pK(){this[Tr].emitClose()}function kbe(t,e){this[Tr].emit("message",t,e)}function Abe(t){let e=this[Tr];e._autoPong&&e.pong(t,!this._isServer,mK),e.emit("ping",t)}function $be(t){this[Tr].emit("pong",t)}function yK(t){t.resume()}function Pbe(t){let e=this[Tr];e.readyState!==Wt.CLOSED&&(e.readyState===Wt.OPEN&&(e._readyState=Wt.CLOSING,vK(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function vK(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),ybe)}function bK(){let t=this[Tr];this.removeListener("close",bK),this.removeListener("data",tA),this.removeListener("end",_K),t._readyState=Wt.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[Tr]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",pK),t._receiver.on("finish",pK))}function tA(t){this[Tr]._receiver.write(t)||this.pause()}function _K(){let t=this[Tr];t._readyState=Wt.CLOSING,t._receiver.end(),this.end()}function wK(){let t=this[Tr];this.removeListener("error",wK),this.on("error",mK),t&&(t._readyState=Wt.CLOSING,this.destroy())}});var $K=y((Wze,AK)=>{"use strict";var Gze=rA(),{Duplex:Cbe}=require("stream");function SK(t){t.emit("close")}function Ibe(){!this.destroyed&&this._writableState.finished&&this.destroy()}function kK(t){this.removeListener("error",kK),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function Tbe(t,e){let r=!0,n=new Cbe({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(i,s){let a=!s&&n._readableState.objectMode?i.toString():i;n.push(a)||t.pause()}),t.once("error",function(i){n.destroyed||(r=!1,n.destroy(i))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(o,i){if(t.readyState===t.CLOSED){i(o),process.nextTick(SK,n);return}let s=!1;t.once("error",function(c){s=!0,i(c)}),t.once("close",function(){s||i(o),process.nextTick(SK,n)}),r&&t.terminate()},n._final=function(o){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(o)});return}t._socket!==null&&(t._socket._writableState.finished?(o(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){o()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(o,i,s){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(o,i,s)});return}t.send(o,s)},n.on("end",Ibe),n.on("error",kK),n}AK.exports=Tbe});var CK=y((Zze,PK)=>{"use strict";var{tokenChars:Ebe}=lf();function Obe(t){let e=new Set,r=-1,n=-1,o=0;for(o;o<t.length;o++){let s=t.charCodeAt(o);if(n===-1&&Ebe[s]===1)r===-1&&(r=o);else if(o!==0&&(s===32||s===9))n===-1&&r!==-1&&(n=o);else if(s===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${o}`);n===-1&&(n=o);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let i=t.slice(r,o);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}PK.exports={parse:Obe}});var RK=y((Jze,NK)=>{"use strict";var jbe=require("events"),nA=require("http"),{Duplex:Kze}=require("stream"),{createHash:Nbe}=require("crypto"),IK=bD(),Zl=tb(),Rbe=CK(),zbe=rA(),{GUID:Mbe,kWebSocket:Dbe}=Ns(),qbe=/^[+/0-9A-Za-z]{22}==$/,TK=0,EK=1,jK=2,kD=class extends jbe{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:zbe,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=nA.createServer((n,o)=>{let i=nA.STATUS_CODES[426];o.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),o.end(i)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=Bbe(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,i,s)=>{this.handleUpgrade(o,i,s,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=TK}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===jK){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(ib,this);return}if(e&&this.once("close",e),this._state!==EK)if(this._state=EK,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(ib,this):process.nextTick(ib,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{ib(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,o){r.on("error",OK);let i=e.headers["sec-websocket-key"],s=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){Kl(this,e,r,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){Kl(this,e,r,400,"Invalid Upgrade header");return}if(i===void 0||!qbe.test(i)){Kl(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){Kl(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){sb(r,400);return}let c=e.headers["sec-websocket-protocol"],l=new Set;if(c!==void 0)try{l=Rbe.parse(c)}catch{Kl(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let u=e.headers["sec-websocket-extensions"],d={};if(this.options.perMessageDeflate&&u!==void 0){let p=new Zl(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let f=IK.parse(u);f[Zl.extensionName]&&(p.accept(f[Zl.extensionName]),d[Zl.extensionName]=p)}catch{Kl(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let p={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(p,(f,m,h,g)=>{if(!f)return sb(r,m||401,h,g);this.completeUpgrade(d,i,l,e,r,n,o)});return}if(!this.options.verifyClient(p))return sb(r,401)}this.completeUpgrade(d,i,l,e,r,n,o)}completeUpgrade(e,r,n,o,i,s,a){if(!i.readable||!i.writable)return i.destroy();if(i[Dbe])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>TK)return sb(i,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Nbe("sha1").update(r+Mbe).digest("base64")}`],u=new this.options.WebSocket(null,void 0,this.options);if(n.size){let d=this.options.handleProtocols?this.options.handleProtocols(n,o):n.values().next().value;d&&(l.push(`Sec-WebSocket-Protocol: ${d}`),u._protocol=d)}if(e[Zl.extensionName]){let d=e[Zl.extensionName].params,p=IK.format({[Zl.extensionName]:[d]});l.push(`Sec-WebSocket-Extensions: ${p}`),u._extensions=e}this.emit("headers",l,o),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",OK),u.setSocket(i,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(u),u.on("close",()=>{this.clients.delete(u),this._shouldEmitClose&&!this.clients.size&&process.nextTick(ib,this)})),a(u,o)}};NK.exports=kD;function Bbe(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function ib(t){t._state=jK,t.emit("close")}function OK(){this.destroy()}function sb(t,e,r,n){r=r||nA.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${nA.STATUS_CODES[e]}\r
`+Object.keys(n).map(o=>`${o}: ${n[o]}`).join(`\r
`)+`\r
\r
`+r)}function Kl(t,e,r,n,o,i){if(t.listenerCount("wsClientError")){let s=new Error(o);Error.captureStackTrace(s,Kl),t.emit("wsClientError",s,r,e)}else sb(r,n,o,i)}});var BK={};ve(BK,{Receiver:()=>MK.default,Sender:()=>DK.default,WebSocket:()=>AD.default,WebSocketServer:()=>qK.default,createWebSocketStream:()=>zK.default,default:()=>Ube});var zK,MK,DK,AD,qK,Ube,UK=x(()=>{zK=ct($K(),1),MK=ct(mD(),1),DK=ct(yD(),1),AD=ct(rA(),1),qK=ct(RK(),1),Ube=AD.default});var HK={};ve(HK,{decisionDoctorApp:()=>Hbe});var Hbe,GK=x(()=>{"use strict";Hbe={id:"decision-doctor",name:"Decision Doctor",icon:"\u{1F914}",description:"Frameworks to help you make tough choices",category:"productivity",tags:["decisions","strategy","thinking","productivity"],primaryAction:"Diagnose Decision",inputs:[{id:"dilemma",label:"What decision do you need to make?",type:"textarea",placeholder:"e.g., Should I rewrite this legacy service in Go or just refactor the TypeScript?",required:!0},{id:"options",label:"What are the options on the table?",type:"textarea",placeholder:`Option A: Rewrite in Go
Option B: Refactor TS
Option C: Do nothing`,required:!0},{id:"context",label:"Any constraints or context?",type:"text",placeholder:"e.g., strict deadline, team knows TS better"}],systemPrompt:`You are the Decision Doctor, an expert in strategic thinking and decision-making frameworks.
Your goal is to help the user gain clarity on a difficult decision.

Follow this structure in your response:
1. **The Core Dilemma**: Briefly restate the conflicting values or trade-offs (e.g., "Speed vs. Maintainability").
2. **Analysis Framework**: Choose the BEST framework for this specific decision (e.g., Pareto Principle, Regret Minimization, Second-Order Thinking, Weighted Matrix) and explain WHY you chose it.
3. **Structured Evaluation**: Apply the framework to their options. Use a markdown table if comparing features/options.
4. **The Doctor's Prescription**: Give a clear, unbiased recommendation based on the logic.
5. **Pre-Mortem**: Briefly mention what could go wrong with the recommended choice and how to mitigate it.

Tone: Professional, objective, yet empathetic to the difficulty of choice.`,buildUserPrompt:t=>`Decision: ${t.dilemma}
Options:
${t.options}

Context:
${t.context}`}});var WK={};ve(WK,{skillSprinterApp:()=>Gbe});var Gbe,ZK=x(()=>{"use strict";Gbe={id:"skill-sprinter",name:"Skill Sprinter",icon:"\u{1F4DA}",description:"Generate a focused learning plan for any topic",category:"inspiration",tags:["learning","growth","education","planning"],primaryAction:"Create Learning Plan",inputs:[{id:"topic",label:"What do you want to learn?",type:"text",placeholder:"e.g., Rust, Sourdough Baking, Kubernetes, public speaking",required:!0},{id:"timeframe",label:"How much time do you have?",type:"select",options:[{label:"1 Hour (Crash Course)",value:"1 hour"},{label:"1 Weekend (Deep Dive)",value:"1 weekend"},{label:"1 Month (Mastery)",value:"1 month"}],required:!0},{id:"level",label:"Current Level",type:"select",options:[{label:"Beginner",value:"beginner"},{label:"Intermediate",value:"intermediate"},{label:"Advanced",value:"advanced"}],required:!0}],systemPrompt:`You are Skill Sprinter, an elite learning coach who creates high-efficiency learning paths.
Design a learning plan that focuses on the 20% of concepts that provide 80% of the value (Pareto Principle).

Structure the plan based on the timeframe:
- **1 Hour**: strict concise "need to know" bullet points + 1 hands-on exercise.
- **1 Weekend**: Day 1 (Theory + Basics), Day 2 (Building/Doing something real).
- **1 Month**: Week-by-week breakdown with distinct milestones.

For each plan include:
1. **The Goal**: What exactly will they be able to DO by the end?
2. **The Plan**: Structured timeline.
3. **Key Resources**: Specific search terms or types of docs to look for (don't hallucinate generic URLs).
4. **The Final Boss**: A capstone project or test to prove mastery.

Tone: Encouraging, energetic, and highly structured.`,buildUserPrompt:t=>`Topic: ${t.topic}
Timeframe: ${t.timeframe}
Current Level: ${t.level}`}});var KK={};ve(KK,{universalSummarizerApp:()=>Wbe});var Wbe,JK=x(()=>{"use strict";Wbe={id:"universal-summarizer",name:"Universal Summarizer",icon:"\u{1F4DD}",description:"Quickly summarize any text into clear takeaways",category:"productivity",tags:["summary","reading","productivity","tools"],primaryAction:"Summarize",inputs:[{id:"text",label:"Text to Summarize",type:"textarea",placeholder:"Paste email, article, or specs here...",required:!0},{id:"format",label:"Output Format",type:"select",options:[{label:"Bulleted List (Standard)",value:"bullets"},{label:"TL;DR (1 Sentence)",value:"tldr"},{label:"ELI5 (Simple)",value:"eli5"},{label:"Executive Brief (Decision focused)",value:"executive"}],required:!0}],systemPrompt:`You are the Universal Summarizer, an AI engine for text compression and clarity.
Your goal is to extract the signal from the noise.

Rules based on format:
- **bullets**: Main ideas in bold, supporting details indented.
- **tldr**: A single, punchy sentence capturing the essence.
- **eli5**: Simple analogies, no jargon, easy to understand.
- **executive**: 1. The Ask/Problem, 2. The Facts, 3. The Recommendation/Action.

Always output a "BLUF" (Bottom Line Up Front) section first\u2014a 1-sentence grasp of the text.`,buildUserPrompt:t=>`Format: ${t.format}

Text to summarize:
${t.text}`}});var YK={};ve(YK,{icebreakerChefApp:()=>Zbe});var Zbe,QK=x(()=>{"use strict";Zbe={id:"icebreaker-chef",name:"Icebreaker Chef",icon:"\u{1F9CA}",description:"Cook up fresh questions for team bonding",category:"communication",tags:["team","meetings","social","fun"],primaryAction:"Serve Questions",inputs:[{id:"context",label:"Meeting Type",type:"text",placeholder:"e.g., Daily Standup, Team Retrospective, New Hire Onboarding, Friday Social",required:!0},{id:"vibe",label:"Vibe",type:"select",options:[{label:"Fun & Light (Quick)",value:"fun"},{label:"Deep & Meaningful (Trust building)",value:"deep"},{label:"Professional / Work-focused",value:"work"},{label:"Weird / Creative",value:"weird"}],required:!0}],systemPrompt:`You are the Icebreaker Chef. You cook up fresh, non-boring conversational prompts.
Avoid cliches like "What is your favorite color?" or "How was your weekend?".

Generate 5 distinct icebreaker questions based on the Vibe:
- **Fun**: Quick, low stakes, maybe controversial food opinions.
- **Deep**: Thought-provoking, safe but personal (e.g., "What's a lesson you learned the hard way?").
- **Work**: Professional growth, habits, or recognition.
- **Weird**: hypothetical scenarios, zombie apocalypse plans, etc.

For each question, add a 1-sentence "Why ask this?" note explaining what it reveals about the person.`,buildUserPrompt:t=>`Meeting Context: ${t.context}
Vibe: ${t.vibe}`}});var XK,eJ,sA,tJ,rJ,ab,CD,Ql,ID=x(()=>{"use strict";XK=ct(require("vscode")),eJ=ct(require("path")),sA=ct(require("fs")),tJ=require("child_process"),rJ=require("util"),ab=(0,rJ.promisify)(tJ.exec),CD=class t{static instance;context;constructor(){}static getInstance(){return t.instance||(t.instance=new t),t.instance}initialize(e){this.context=e}getSavedProjects(){return this.context?this.context.globalState.get("apps.savedProjects",[]):[]}async addProject(e){if(!this.context||!sA.existsSync(e)||!sA.statSync(e).isDirectory())return null;let r=this.getSavedProjects(),n=r.find(i=>i.path===e);if(n)return n.lastUsed=Date.now(),await this.context.globalState.update("apps.savedProjects",r),n;let o={id:`proj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,path:e,name:eJ.basename(e),lastUsed:Date.now(),favorite:!1};return r.push(o),await this.context.globalState.update("apps.savedProjects",r),o}async removeProject(e){if(!this.context)return;let n=this.getSavedProjects().filter(o=>o.id!==e);await this.context.globalState.update("apps.savedProjects",n)}async toggleFavorite(e){if(!this.context)return;let r=this.getSavedProjects(),n=r.find(o=>o.id===e);n&&(n.favorite=!n.favorite,await this.context.globalState.update("apps.savedProjects",r))}async pickProjectFolder(){let e=await XK.window.showOpenDialog({canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:"Select Project Folder",openLabel:"Select Project"});if(e&&e.length>0)return e[0].fsPath}async isGitRepository(e){try{return await ab("git rev-parse --git-dir",{cwd:e}),!0}catch{return!1}}async getGitDiff(e,r){try{if(!await this.isGitRepository(e))return{diff:"",error:"Not a git repository"};let n;switch(r.type){case"staged":n="git diff --cached";break;case"unstaged":n="git diff";break;case"commits":n=`git diff HEAD~${r.commits||5}..HEAD`;break;case"branches":let a=r.baseBranch||"main",c=r.targetBranch||"HEAD";n=`git diff ${a}...${c}`;break;default:n="git diff"}n+=" --no-color";let{stdout:o,stderr:i}=await ab(n,{cwd:e,maxBuffer:10*1024*1024});return i&&!o?{diff:"",error:i}:{diff:o}}catch(n){return{diff:"",error:n instanceof Error?n.message:String(n)}}}async getBranches(e){try{let{stdout:r}=await ab('git branch -a --format="%(refname:short)"',{cwd:e});return r.split(`
`).filter(n=>n.trim()).map(n=>n.trim())}catch{return[]}}async getCurrentBranch(e){try{let{stdout:r}=await ab("git branch --show-current",{cwd:e});return r.trim()||null}catch{return null}}async getRecentCommits(e,r=10){try{let{stdout:n}=await ab(`git log -${r} --format="%H|%s|%an|%ad" --date=short`,{cwd:e});return n.split(`
`).filter(o=>o.trim()).map(o=>{let[i,s,a,c]=o.split("|");return{hash:i,message:s,author:a,date:c}})}catch{return[]}}async getCombinedDiff(e){return await Promise.all(e.map(async n=>{let o=await this.getGitDiff(n.path,{type:n.diffType,...n.options});return{projectPath:n.path,...o}}))}},Ql=CD.getInstance()});var nJ={};ve(nJ,{codeReviewApp:()=>Kbe});var Kbe,oJ=x(()=>{"use strict";ID();Kbe={id:"code-review",name:"Code Review",description:"Full project code review using git diff",icon:"\u{1F50D}",category:"developer",helpDocumentation:`
### What is this?
The **Code Review** app provides an AI-powered senior engineer's perspective on your changes. It analyzes your git diff and provides constructive feedback on code quality, security, and performance.

### How to use it:
1. **Select Projects**: Add the local folders you want to review.
2. **Choose Diff Type**: Review staged changes, unstaged work, recent commits, or compare two branches.
3. **Set Depth**: Choose from Quick, Thorough, or category-specific focus (Security/Performance).
4. **Execution**: The AI will generate a structured report with Critical, Warning, and Suggestion findings.

### Use cases:
- Preparing a PR for review.
- Auditing a colleague's complex changes.
- Quick security sanity checks on recent work.
    `,inputs:[{id:"projectPaths",label:"Project Folders",type:"project-picker",placeholder:"Add project folders to review...",required:!0,hint:'Select the folders you want to review. Use "Pick Project Folder" to add new ones.'},{id:"diffType",label:"What to Review",type:"radio",required:!0,defaultValue:"unstaged",options:[{value:"staged",label:"Staged Changes",icon:"\u{1F4E6}",description:"Changes added to git staging"},{value:"unstaged",label:"Unstaged Changes",icon:"\u{1F4DD}",description:"Current working directory changes"},{value:"commits",label:"Last N Commits",icon:"\u{1F4DC}",description:"Review recent commits"},{value:"branches",label:"Branch Comparison",icon:"\u{1F500}",description:"Compare between branches"}]},{id:"numCommits",label:"Number of Commits",type:"text",defaultValue:"5",placeholder:"5",rows:5,hint:"We'll enhance these into professional reproduction steps with clear preconditions.",showIf:{field:"diffType",equals:"commits"}},{id:"baseBranch",label:"Base Branch",type:"text",defaultValue:"main",placeholder:"main",hint:"The branch to compare against",showIf:{field:"diffType",equals:"branches"}},{id:"targetBranch",label:"Target Branch",type:"text",defaultValue:"HEAD",placeholder:"HEAD or branch name",hint:"The branch with your changes",showIf:{field:"diffType",equals:"branches"}},{id:"reviewFocus",label:"Review Focus (optional)",type:"textarea",placeholder:"e.g., Focus on security vulnerabilities, performance issues, and error handling...",rows:3,hint:"Describe what went wrong. Be as specific as possible about the error symptoms."},{id:"reviewType",label:"Review Depth",type:"select",defaultValue:"thorough",options:[{value:"quick",label:"\u26A1 Quick Scan",description:"High-level overview, critical issues only"},{value:"thorough",label:"\u{1F50D} Thorough Review",description:"Comprehensive analysis"},{value:"security",label:"\u{1F512} Security Focus",description:"Deep security analysis"},{value:"performance",label:"\u26A1 Performance Focus",description:"Performance and optimization"}]}],primaryAction:"Start Code Review",systemPrompt:`You are a senior software engineer conducting a thorough, constructive code review.
Your goal is to help improve code quality while being respectful and educational.

## Review Guidelines

1. **Be Constructive**: Frame feedback as suggestions, not criticisms
2. **Explain Why**: Always explain the reason behind each suggestion
3. **Prioritize**: Focus on issues that matter most
4. **Be Specific**: Reference exact files and line numbers when possible
5. **Acknowledge Good Work**: Mention well-written code too

## Output Format

Structure your review using these sections:

### \u{1F4CB} Summary
- Brief overview of changes reviewed
- Overall assessment (1-2 sentences)

### \u{1F534} Critical Issues (Must Fix)
Issues that could cause bugs, security vulnerabilities, or data loss.
Format each as:
- **[File:Line]** Issue title
  - What: Description of the issue
  - Why: Why this is critical
  - Fix: Specific recommendation

### \u{1F7E1} Warnings (Should Fix)
Issues that could cause problems or are bad practices.
Same format as above.

### \u{1F4A1} Suggestions (Nice to Have)
Improvements for code quality, readability, or maintainability.
Same format as above.

### \u2705 What's Good
Acknowledge well-written code, good patterns, or improvements.

### \u{1F4CA} Summary Stats
- Files changed: X
- Critical: X | Warnings: X | Suggestions: X

If the diff is empty or there are no changes, say so clearly and suggest the user check their git status.`,buildUserPrompt:(t,e)=>{let r=[];t.reviewFocus&&r.push(`## Review Focus
${t.reviewFocus}
`);let n={quick:"Perform a quick scan focusing only on critical issues and obvious bugs.",thorough:"Perform a comprehensive review covering all aspects of code quality.",security:"Focus heavily on security vulnerabilities, input validation, authentication, authorization, and data protection.",performance:"Focus on performance issues, memory leaks, inefficient algorithms, and optimization opportunities."};return t.reviewType&&n[t.reviewType]&&r.push(`## Review Type
${n[t.reviewType]}
`),e?.gitDiff?r.push(`## Git Diff to Review
\`\`\`diff
${e.gitDiff}
\`\`\``):e?.errors&&e.errors.length>0?r.push(`## Errors
Could not retrieve git diff:
${e.errors.join(`
`)}`):r.push(`## Note
No diff content available. The diff may be empty or there may be no changes to review.`),e?.projectPaths&&e.projectPaths.length>0&&r.push(`
## Projects Reviewed
${e.projectPaths.join(`
`)}`),r.join(`

`)},fetchContext:async t=>{let e={projectPaths:[],errors:[]},r=[];try{t.projectPaths.startsWith("[")?r=JSON.parse(t.projectPaths):r=t.projectPaths.split(",").map(o=>o.trim()).filter(Boolean)}catch{r=[t.projectPaths]}if(r.length===0)return e.errors.push("No project paths provided"),e;e.projectPaths=r;let n=[];for(let o of r){let i=await Ql.getGitDiff(o,{type:t.diffType,commits:t.numCommits?parseInt(t.numCommits,10):5,baseBranch:t.baseBranch||"main",targetBranch:t.targetBranch||"HEAD"});i.error&&e.errors.push(`${o}: ${i.error}`),i.diff&&n.push(`# Project: ${o}
${i.diff}`)}return e.gitDiff=n.join(`

---

`),e.gitDiff.length>5e4&&(e.gitDiff=e.gitDiff.substring(0,5e4)+`

[... diff truncated due to size. Showing first 50,000 characters ...]`),e},parseResponse:(t,e)=>{let r=[],n=t.match(/###  Critical Issues[\s\S]*?(?=###|$)/i);n&&!n[0].includes("None")&&n[0].length>50&&r.push({title:"\u{1F534} Critical Issues",content:n[0].replace(/###  Critical Issues[^\n]*\n/,"").trim(),severity:"critical",collapsible:!0,collapsed:!1});let o=t.match(/###  Warnings[\s\S]*?(?=###|$)/i);o&&!o[0].includes("None")&&o[0].length>50&&r.push({title:"\u{1F7E1} Warnings",content:o[0].replace(/###  Warnings[^\n]*\n/,"").trim(),severity:"warning",collapsible:!0,collapsed:!1});let i=t.match(/###  Suggestions[\s\S]*?(?=###|$)/i);return i&&!i[0].includes("None")&&i[0].length>50&&r.push({title:"\u{1F4A1} Suggestions",content:i[0].replace(/###  Suggestions[^\n]*\n/,"").trim(),severity:"info",collapsible:!0,collapsed:!0}),r.length===0?{type:"markdown",content:t,actions:[{label:"Copy Review",icon:"\u{1F4CB}",action:"copy"},{label:"Save as Markdown",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md",suggestedFilename:"code-review.md"}]}:{type:"structured",content:t,sections:r,summary:`Found ${r.filter(s=>s.severity==="critical").length} critical, ${r.filter(s=>s.severity==="warning").length} warnings`,actions:[{label:"Copy Review",icon:"\u{1F4CB}",action:"copy"},{label:"Save as Markdown",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md",suggestedFilename:"code-review.md"}]}},defaultActions:[{label:"Copy Review",icon:"\u{1F4CB}",action:"copy"},{label:"Save as Markdown",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md",suggestedFilename:"code-review.md"}],requirements:{git:!0,copilot:!0},examples:[{name:"Review staged changes",inputs:{diffType:"staged",reviewType:"thorough",reviewFocus:"Focus on security and error handling"}},{name:"Security review of recent commits",inputs:{diffType:"commits",numCommits:"10",reviewType:"security"}}]}});var iJ={};ve(iJ,{testCaseGeneratorApp:()=>Jbe});var Jbe,sJ=x(()=>{"use strict";Jbe={id:"test-case-generator",name:"Test Case Generator",description:"Generate test cases from requirements/user stories",icon:"\u{1F9EA}",category:"qa",helpDocumentation:`
### What is this?
The **Test Case Generator** helps QA and Developers ensure comprehensive coverage by converting requirements into structured test plans.

### How to use it:
1. **Input Requirement**: Paste a user story or feature description.
2. **Choose Test Types**: Select from Functional, Edge Cases, Security, Accessibility, etc.
3. **Pick Format**: Choose your preferred documentation style (Gherkin, Traditional Table, or Checklist).
4. **Generate**: The AI will design a series of test cases with clear Pass/Fail criteria.

### Use cases:
- Drafting a test plan for a new feature.
- Generating BDD-style "Given-When-Then" scenarios.
- Ensuring edge cases are considered during the design phase.
    `,inputs:[{id:"requirement",label:"Requirement / User Story",type:"textarea",placeholder:`Example:
As a user, I want to reset my password so that I can regain access to my account if I forget it.

Acceptance Criteria:
- User can request password reset via email
- Reset link expires after 24 hours
- Password must meet complexity requirements`,required:!0,rows:8,hint:"Paste the user story, requirement, or feature description"},{id:"testTypes",label:"Test Types to Include",type:"multi-select",options:[{value:"functional",label:"\u2705 Functional",description:"Happy path scenarios"},{value:"edge",label:"\u{1F532} Edge Cases",description:"Boundary conditions"},{value:"negative",label:"\u274C Negative",description:"Error scenarios"},{value:"security",label:"\u{1F512} Security",description:"Security test cases"},{value:"performance",label:"\u26A1 Performance",description:"Performance considerations"},{value:"accessibility",label:"\u267F Accessibility",description:"A11y test cases"}],defaultValue:"functional,edge,negative"},{id:"outputFormat",label:"Output Format",type:"select",required:!0,defaultValue:"gherkin",options:[{value:"gherkin",label:"\u{1F952} Gherkin (BDD)",description:"Given/When/Then format"},{value:"traditional",label:"\u{1F4CB} Traditional",description:"ID, Steps, Expected Results"},{value:"checklist",label:"\u2714\uFE0F Checklist",description:"Simple test checklist"},{value:"xunit",label:"\u{1F9EA} xUnit Style",description:"Test method structure"}]},{id:"priority",label:"Include Priority Levels",type:"checkbox",defaultValue:"true"},{id:"jiraIssueId",label:"Jira Issue ID (optional)",type:"text",placeholder:"e.g., PROJ-123, TEST-456",hint:"Auto-fetch requirements from Jira. Configure Jira in Apps Hub first.",required:!1},{id:"additionalContext",label:"Additional Context (optional)",type:"textarea",placeholder:"Any additional technical details, constraints, or context...",rows:3}],primaryAction:"Generate Test Cases",systemPrompt:`You are an expert QA engineer specializing in test case design.
Generate comprehensive, actionable test cases based on the given requirements.

## Guidelines

1. **Coverage**: Ensure all acceptance criteria are covered
2. **Completeness**: Each test case should be standalone and complete
3. **Clarity**: Use clear, unambiguous language
4. **Testability**: Each test must have a clear pass/fail criteria
5. **Prioritization**: Order tests by importance/risk

## Output Formats

### Gherkin (BDD) Format
\`\`\`gherkin
Feature: [Feature Name]

  Scenario: [Scenario Name]
    Given [precondition]
    When [action]
    Then [expected result]
    And [additional expectation]
\`\`\`

### Traditional Format
| Test ID | Test Case | Priority | Preconditions | Steps | Expected Result |
|---------|-----------|----------|---------------|-------|-----------------|

### Checklist Format
- [ ] [P1] Test case description
  - Step 1
  - Step 2
  - \u2713 Expected: result

### xUnit Style Format
\`\`\`
Test: testFeatureName_WhenCondition_ShouldExpectedBehavior
Arrange: [setup]
Act: [action]
Assert: [verification]
\`\`\`

Always include:
- Happy path scenarios (functional)
- Edge cases and boundary conditions
- Negative/error scenarios
- Any specific test types requested`,buildUserPrompt:t=>{let e=[];e.push(`## Requirement to Test
${t.requirement}`),t.additionalContext&&e.push(`## Additional Context
${t.additionalContext}`);let r=t.testTypes?t.testTypes.split(","):["functional","edge","negative"],n={functional:"Functional (happy path)",edge:"Edge Cases (boundaries)",negative:"Negative (error scenarios)",security:"Security",performance:"Performance",accessibility:"Accessibility"},o=r.map(s=>n[s]||s).join(", ");e.push(`## Test Types Required
${o}`);let i={gherkin:"Gherkin (BDD) - Given/When/Then format",traditional:"Traditional table format with Test ID, Steps, Expected Results",checklist:"Simple checklist format",xunit:"xUnit test method structure (Arrange/Act/Assert)"};return e.push(`## Output Format
${i[t.outputFormat]||t.outputFormat}`),t.priority==="true"&&e.push(`## Include Priority
Yes - mark each test case with priority (P1=Critical, P2=High, P3=Medium, P4=Low)`),t.jiraContext&&t.jiraContext.trim()&&e.push(`## Jira Issue Context
${t.jiraContext}`),e.push(`
Please generate comprehensive test cases covering all the requested types in the specified format.`),e.join(`

`)},parseResponse:(t,e)=>{let n={gherkin:".feature",traditional:".md",checklist:".md",xunit:".txt"}[e.outputFormat]||".md",o=`test-cases${n}`;return{type:e.outputFormat==="gherkin"?"code":"markdown",content:t,language:e.outputFormat==="gherkin"?"gherkin":void 0,actions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save as File",icon:"\u{1F4BE}",action:"newFile",fileExtension:n,suggestedFilename:o},{label:"Insert at Cursor",icon:"\u{1F4DD}",action:"insert"}]}},defaultActions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save as File",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md"}],requirements:{copilot:!0},examples:[{name:"Login Feature",inputs:{requirement:`As a user, I want to log in with my email and password so that I can access my account.

Acceptance Criteria:
- Valid email format required
- Password minimum 8 characters
- Show error for invalid credentials
- Lock account after 5 failed attempts
- Remember me option for 30 days`,testTypes:"functional,edge,negative,security",outputFormat:"gherkin"}},{name:"Shopping Cart",inputs:{requirement:"Users can add items to cart, update quantities, and remove items. Cart persists across sessions.",testTypes:"functional,edge",outputFormat:"traditional"}}]}});var aJ={};ve(aJ,{bugReportWriterApp:()=>Ybe});var Ybe,cJ=x(()=>{"use strict";Ybe={id:"bug-report-writer",name:"Bug Report Writer",description:"Create structured bug reports with repro steps",icon:"\u{1F41B}",category:"qa",helpDocumentation:`
### What is this?
The **Bug Report Writer** ensures your issues are addressed quickly by helping you write clear, comprehensive, and professional bug reports.

### How to use it:
1. **Describe the Bug**: provide a brief summary of what happened and what you expected.
2. **Add Context**: (Optional) Include reproduction steps, URLs, and environment details (Browser/OS).
3. **Set Severity**: Help developers prioritize by correctly identifying the impact.
4. **Result**: The AI will generate a structured report with clear sections for Environment, Repro Steps, and Expected/Actual behavior.

### Use cases:
- Filing a high-quality GitHub issue.
- Drafting a JIRA ticket for a complex bug.
- Communicating an issue clearly to a remote engineering team.
    `,inputs:[{id:"whatHappened",label:"What happened? (brief description)",type:"textarea",placeholder:"Describe the bug in a few sentences...",required:!0,rows:3,hint:"Describe what went wrong. Be as specific as possible about the error symptoms."},{id:"expected",label:"What did you expect to happen?",type:"textarea",placeholder:"What should have happened instead...",required:!0,rows:2},{id:"steps",label:"Steps you took (optional)",type:"textarea",placeholder:`1. Opened the login page
2. Entered email and password
3. Clicked login button
4. Nothing happened`,rows:5,hint:"We'll enhance these into professional reproduction steps with clear preconditions."},{id:"url",label:"URL / Page (optional)",type:"text",placeholder:"https://app.example.com/login"},{id:"browser",label:"Browser",type:"select",defaultValue:"chrome",options:[{value:"chrome",label:"Chrome"},{value:"firefox",label:"Firefox"},{value:"safari",label:"Safari"},{value:"edge",label:"Edge"},{value:"mobile-ios",label:"Mobile Safari (iOS)"},{value:"mobile-android",label:"Chrome (Android)"},{value:"other",label:"Other"}]},{id:"os",label:"Operating System",type:"select",defaultValue:"macos",options:[{value:"macos",label:"macOS"},{value:"windows",label:"Windows"},{value:"linux",label:"Linux"},{value:"ios",label:"iOS"},{value:"android",label:"Android"},{value:"other",label:"Other"}]},{id:"severity",label:"Severity",type:"radio",defaultValue:"high",options:[{value:"critical",label:"\u{1F534} Critical",description:"System down, data loss, security issue"},{value:"high",label:"\u{1F7E0} High",description:"Major feature broken, no workaround"},{value:"medium",label:"\u{1F7E1} Medium",description:"Feature impaired, workaround exists"},{value:"low",label:"\u{1F7E2} Low",description:"Minor issue, cosmetic"}]},{id:"additionalInfo",label:"Additional Information (optional)",type:"textarea",placeholder:"Console errors, screenshots description, account details (non-sensitive)...",rows:3},{id:"outputFormat",label:"Output Format",type:"select",defaultValue:"markdown",options:[{value:"markdown",label:"\u{1F4DD} Markdown",description:"GitHub/GitLab issues"},{value:"jira",label:"\u{1F3AB} JIRA",description:"JIRA ticket format"},{value:"plain",label:"\u{1F4C4} Plain Text",description:"Simple text format"}]}],primaryAction:"Generate Bug Report",systemPrompt:`You are an expert QA engineer who writes clear, comprehensive bug reports.
Create a well-structured bug report that developers can easily understand and act upon.

## Guidelines

1. **Clear Title**: Concise, descriptive title that summarizes the issue
2. **Reproducible Steps**: Detailed, numbered steps anyone can follow
3. **Expected vs Actual**: Clear distinction between expected and actual behavior
4. **Environment Details**: Browser, OS, and relevant versions
5. **Root Cause Hints**: If obvious, suggest possible causes
6. **Attachments Note**: Mention what screenshots/logs would help

## Output Formats

### Markdown Format
Use standard markdown with headers, bullet points, and code blocks.

### JIRA Format
Use JIRA wiki markup:
- h2. for headers
- * for bullets
- {code} blocks
- {color:red}text{color} for emphasis

### Plain Text
Simple structured text without markdown.

## Structure

1. **Title**: Bug: [Concise description]
2. **Summary**: 1-2 sentence overview
3. **Environment**: Browser, OS, URL
4. **Severity**: With justification
5. **Steps to Reproduce**: Detailed numbered steps
6. **Expected Behavior**: What should happen
7. **Actual Behavior**: What actually happens
8. **Additional Notes**: Possible causes, workarounds
9. **Attachments Needed**: What would help investigation`,buildUserPrompt:t=>{let e=[];e.push(`## Bug Description
${t.whatHappened}`),e.push(`## Expected Behavior
${t.expected}`),t.steps&&e.push(`## Steps Taken (to enhance)
${t.steps}`),e.push("## Environment"),e.push(`- Browser: ${t.browser||"Not specified"}`),e.push(`- OS: ${t.os||"Not specified"}`),t.url&&e.push(`- URL: ${t.url}`);let r={critical:"Critical - System down, data loss, or security issue",high:"High - Major feature broken, no workaround",medium:"Medium - Feature impaired, workaround exists",low:"Low - Minor issue, cosmetic"};return e.push(`
## Severity
${r[t.severity]||t.severity}`),t.additionalInfo&&e.push(`## Additional Information
${t.additionalInfo}`),e.push(`
## Output Format
${t.outputFormat||"markdown"}`),e.push(`
Please generate a comprehensive, professional bug report.`),e.join(`
`)},parseResponse:(t,e)=>{let r={markdown:".md",jira:".txt",plain:".txt"};return{type:"markdown",content:t,actions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save as File",icon:"\u{1F4BE}",action:"newFile",fileExtension:r[e.outputFormat]||".md",suggestedFilename:"bug-report"+(r[e.outputFormat]||".md")},{label:"Insert at Cursor",icon:"\u{1F4DD}",action:"insert"}]}},defaultActions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save as File",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md"}],requirements:{copilot:!0},examples:[{name:"Login Button Issue",inputs:{whatHappened:"Login button does not respond when clicked after entering credentials",expected:"Should redirect to dashboard after successful login",steps:`1. Go to login page
2. Enter email
3. Enter password
4. Click login
5. Nothing happens`,browser:"chrome",os:"macos",severity:"critical",outputFormat:"markdown"}}]}});var lJ={};ve(lJ,{regexGeneratorApp:()=>Qbe});var Qbe,uJ=x(()=>{"use strict";Qbe={id:"regex-generator",name:"Regex Generator",description:"Describe what you want to match, get a working regex",icon:"\u{1F523}",category:"developer",primaryAction:"\u2728 Generate Regex",helpDocumentation:`### What is this?
The **Regex Generator** helps you create regular expressions by describing what you want to match in plain English.

### How to use it
1. Describe the pattern you want to match (e.g., "email addresses", "phone numbers with country code", "URLs starting with https").
2. Optionally specify the target language/flavor (JavaScript, Python, etc.).
3. Click **Generate Regex** to get a working pattern with explanation.

### Use cases
- Validating user input (emails, phones, IDs)
- Extracting data from text
- Search and replace operations
- Log parsing and analysis`,inputs:[{id:"description",label:"What do you want to match?",type:"textarea",placeholder:"e.g., Match email addresses that end with .com or .org",required:!0,rows:3,hint:"Be as specific as possible about the pattern"},{id:"flavor",label:"Regex Flavor",type:"select",options:[{value:"javascript",label:"JavaScript / TypeScript"},{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"csharp",label:"C# / .NET"},{value:"go",label:"Go"},{value:"pcre",label:"PCRE (PHP, Perl)"}],defaultValue:"javascript"},{id:"testCases",label:"Test Cases (optional)",type:"textarea",placeholder:`One example per line:
valid@email.com (should match)
invalid-email (should not match)`,rows:4,hint:"Provide examples to validate the regex"}],systemPrompt:`You are an expert regex engineer. Create precise, efficient regular expressions based on user descriptions.

Your response MUST include:
1. **The Regex Pattern** - The actual regex, properly escaped for the target language
2. **Explanation** - Break down each part of the regex
3. **Usage Example** - Code snippet showing how to use it
4. **Test Results** - If test cases provided, show which ones match/don't match
5. **Edge Cases** - Mention any limitations or edge cases

Keep patterns as simple as possible while being accurate. Prefer readability over cleverness.`,buildUserPrompt:t=>{let e=`Create a regex pattern for: ${t.description}

Target language/flavor: ${t.flavor}`;return t.testCases?.trim()&&(e+=`

Test cases:
${t.testCases}`),e},parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Generated Regex",content:t}]})}});var dJ={};ve(dJ,{apiDocWriterApp:()=>Xbe});var Xbe,pJ=x(()=>{"use strict";Xbe={id:"api-doc-writer",name:"API Documentation Writer",description:"Generate OpenAPI/Swagger docs from code or descriptions",icon:"\u{1F4D6}",category:"developer",primaryAction:"\u{1F4DD} Generate Docs",helpDocumentation:`### What is this?
The **API Documentation Writer** generates professional API documentation in OpenAPI/Swagger format from your code or plain-text descriptions.

### How to use it
1. Paste your API endpoint code (controller, route handler) or describe the endpoints.
2. Select the output format (OpenAPI 3.0, Swagger 2.0, or Markdown).
3. Click **Generate Docs** to get structured documentation.

### Use cases
- Documenting existing REST APIs
- Creating API specs before implementation
- Generating client SDK documentation
- Preparing API references for external developers`,inputs:[{id:"apiCode",label:"API Code or Description",type:"textarea",placeholder:`Paste your endpoint code or describe the API...

Example:
GET /users - List all users
POST /users - Create a new user (body: name, email)
GET /users/:id - Get user by ID`,required:!0,rows:10,hint:"Paste code or describe endpoints with methods, paths, and parameters"},{id:"format",label:"Output Format",type:"radio",options:[{value:"openapi3",label:"OpenAPI 3.0 (YAML)",description:"Modern standard, widely supported"},{value:"swagger2",label:"Swagger 2.0 (JSON)",description:"Legacy format for older tools"},{value:"markdown",label:"Markdown",description:"Human-readable documentation"}],defaultValue:"openapi3"},{id:"apiTitle",label:"API Title",type:"text",placeholder:"My Service API",hint:"Name of your API for the documentation header"}],systemPrompt:`You are a technical writer specializing in API documentation. Generate clean, accurate API documentation from code or descriptions.

Guidelines:
- Infer request/response schemas from the code when possible
- Include example values for all fields
- Document error responses (400, 401, 404, 500)
- Use consistent naming conventions
- Add brief descriptions for each endpoint
- Include authentication requirements if detectable

For OpenAPI/Swagger, produce valid YAML/JSON that can be used directly with tools like Swagger UI.`,buildUserPrompt:t=>{let e=`Generate ${t.format==="openapi3"?"OpenAPI 3.0 YAML":t.format==="swagger2"?"Swagger 2.0 JSON":"Markdown"} documentation for the following API:

${t.apiCode}`;return t.apiTitle?.trim()&&(e+=`

API Title: ${t.apiTitle}`),e},parseResponse:t=>({type:"code",content:t,language:"yaml",sections:[{title:"API Documentation",content:t}]})}});var fJ={};ve(fJ,{sqlQueryBuilderApp:()=>e_e});var e_e,mJ=x(()=>{"use strict";e_e={id:"sql-query-builder",name:"SQL Query Builder",description:"Describe your data need in plain English, get the SQL query",icon:"\u{1F5C3}\uFE0F",category:"developer",primaryAction:"\u26A1 Build Query",helpDocumentation:`### What is this?
The **SQL Query Builder** translates plain-English data requests into SQL queries, helping you construct complex queries without memorizing syntax.

### How to use it
1. Describe what data you need (e.g., "Get all orders from last month with total > $100").
2. Optionally provide your table schema for more accurate queries.
3. Select your database dialect (PostgreSQL, MySQL, etc.).
4. Click **Build Query** to get the SQL.

### Use cases
- Writing complex JOINs and subqueries
- Aggregation and reporting queries
- Data migration scripts
- Quick prototyping before optimization`,inputs:[{id:"request",label:"What data do you need?",type:"textarea",placeholder:"e.g., Show me the top 10 customers by total order value in the last 30 days, including their email and order count",required:!0,rows:4,hint:"Describe your data requirements in plain English"},{id:"schema",label:"Table Schema (optional)",type:"textarea",placeholder:`users (id, name, email, created_at)
orders (id, user_id, total, status, created_at)
products (id, name, price, category_id)`,rows:5,hint:"Provide table structure for more accurate queries"},{id:"dialect",label:"SQL Dialect",type:"select",options:[{value:"postgresql",label:"PostgreSQL"},{value:"mysql",label:"MySQL / MariaDB"},{value:"sqlite",label:"SQLite"},{value:"mssql",label:"SQL Server"},{value:"oracle",label:"Oracle"}],defaultValue:"postgresql"}],systemPrompt:`You are a database expert. Generate accurate, optimized SQL queries based on natural language requests.

Guidelines:
- Use proper syntax for the specified dialect
- Include comments explaining complex parts
- Suggest indexes if relevant for performance
- Handle NULL values appropriately
- Use parameterized queries where user input is involved
- Provide alternative approaches for complex queries

Format your response as:
1. **The Query** - Ready-to-use SQL
2. **Explanation** - What each part does
3. **Notes** - Performance tips or alternative approaches`,buildUserPrompt:t=>{let e=`Generate a ${t.dialect.toUpperCase()} query for: ${t.request}`;return t.schema?.trim()&&(e+=`

Table schema:
${t.schema}`),e},parseResponse:t=>({type:"code",content:t,language:"sql",sections:[{title:"SQL Query",content:t}]})}});var hJ={};ve(hJ,{meetingNotesToActionsApp:()=>t_e});var t_e,gJ=x(()=>{"use strict";t_e={id:"meeting-notes-to-actions",name:"Meeting Notes \u2192 Actions",description:"Extract action items from meeting notes",icon:"\u{1F4DD}",category:"leadership",helpDocumentation:`
### What is this?
**Meeting Notes \u2192 Actions** is a productivity tool that extracts clear, assigned tasks and key decisions from unstructured meeting notes or transcripts.

### How to use it:
1. **Paste Notes**: Drop in your raw notes, a Slack thread, or a meeting transcript.
2. **Configure Extraction**: Select which items you want to focus on (Actions, Decisions, Risks, etc.).
3. **Set Format**: Choose between Markdown, Slack-ready formatting, or professional Email style.
4. **Identify Owners**: (Recommended) Enable this to have the AI attempt to assign tasks based on the conversation context.

### Use cases:
- Quickly updating a team Slack channel after a sync.
- Drafting a project follow-up email.
- Extracting JIRA-ready tasks from a planning session.
    `,inputs:[{id:"meetingNotes",label:"Paste Meeting Notes",type:"textarea",placeholder:`Example:
Sprint planning call - Dec 21
Attendees: John, Sarah, Mike

Discussed the new auth feature. John said we should use OAuth2.
Sarah mentioned we need to update the docs by Friday.
Mike will handle the frontend integration.

We agreed to ship by next Friday. Need to check with legal about 
the privacy policy changes. Budget approved for new tools.`,required:!0,rows:12,hint:"Paste raw meeting notes, transcript, or summary"},{id:"extractTypes",label:"What to Extract",type:"multi-select",defaultValue:"actions,decisions,followups",options:[{value:"actions",label:"\u2705 Action Items",description:"Tasks assigned to people"},{value:"decisions",label:"\u{1F4CC} Decisions",description:"Decisions that were made"},{value:"followups",label:"\u{1F504} Follow-ups",description:"Items needing follow-up"},{value:"questions",label:"\u2753 Open Questions",description:"Unresolved questions"},{value:"risks",label:"\u26A0\uFE0F Risks",description:"Risks or concerns raised"},{value:"deadlines",label:"\u{1F4C5} Deadlines",description:"Important dates mentioned"}]},{id:"meetingTitle",label:"Meeting Title (optional)",type:"text",placeholder:"e.g., Sprint Planning - Week 51"},{id:"outputFormat",label:"Output Format",type:"select",defaultValue:"markdown",options:[{value:"markdown",label:"\u{1F4DD} Markdown",description:"Formatted with tables and sections"},{value:"slack",label:"\u{1F4AC} Slack-Ready",description:"Formatted for Slack posting"},{value:"email",label:"\u{1F4E7} Email",description:"Ready to send as follow-up email"},{value:"jira",label:"\u{1F3AB} JIRA Tasks",description:"Formatted as JIRA task descriptions"}]},{id:"includeOwners",label:"Identify Owners",type:"checkbox",defaultValue:"true",hint:"Attempt to identify who is responsible for each action"}],primaryAction:"Extract Actions",systemPrompt:`You are an expert at analyzing meeting notes and extracting actionable information.
Your goal is to transform unstructured meeting notes into clear, organized action items.

## Guidelines

1. **Be Thorough**: Extract ALL action items, even implied ones
2. **Identify Owners**: Assign owners when mentioned or implied
3. **Add Due Dates**: Extract or infer reasonable deadlines
4. **Capture Context**: Preserve important context for each item
5. **Highlight Decisions**: Clearly mark decisions that were made
6. **Flag Uncertainties**: Note when ownership or details are unclear

## Output Structure

### Meeting Summary
Brief 2-3 sentence summary of the meeting.

### \u{1F4CC} Decisions Made
Numbered list of decisions with context.

### \u2705 Action Items
| Owner | Task | Due Date | Priority |
|-------|------|----------|----------|
Use "TBD" for unknown owners, "ASAP" or specific date for due dates.

### \u{1F504} Follow-ups Required
Items that need follow-up but aren't specific tasks.

### \u2753 Open Questions
Questions that weren't answered in the meeting.

### \u26A0\uFE0F Risks & Concerns
Any risks or concerns that were raised.

### \u{1F4C5} Key Dates
Important deadlines or milestones mentioned.

## Format-Specific Instructions

### Slack Format
- Use *bold* for headers
- Use bullet points with emojis
- Keep it concise

### Email Format
- Professional tone
- Include greeting and sign-off structure
- Numbered action items

### JIRA Format
- Each action as a separate task
- Include acceptance criteria where possible
- Use JIRA wiki markup`,buildUserPrompt:t=>{let e=[];t.meetingTitle&&e.push(`## Meeting: ${t.meetingTitle}`),e.push(`## Meeting Notes
${t.meetingNotes}`);let r=t.extractTypes?t.extractTypes.split(","):["actions","decisions","followups"],n={actions:"Action Items (tasks with owners)",decisions:"Decisions Made",followups:"Follow-ups Required",questions:"Open Questions",risks:"Risks and Concerns",deadlines:"Key Dates and Deadlines"},o=r.map(i=>n[i]||i);return e.push(`## Extract These Items
${o.map(i=>`- ${i}`).join(`
`)}`),e.push(`## Output Format
${t.outputFormat||"markdown"}`),t.includeOwners==="true"&&e.push(`
IMPORTANT: Identify and assign owners for each action item based on the notes. Use "TBD" if unclear.`),e.push(`
Analyze the meeting notes and extract all requested information in a clear, organized format.`),e.join(`

`)},parseResponse:(t,e)=>{let r=[],n=t.match(/###?\s*?\s*Action Items[\s\S]*?(?=###|$)/i);n&&r.push({title:"\u2705 Action Items",content:n[0].replace(/###?\s*?\s*Action Items[^\n]*\n/,"").trim(),severity:"info",collapsible:!1});let o=t.match(/###?\s*?\s*Decisions[\s\S]*?(?=###|$)/i);o&&r.push({title:"\u{1F4CC} Decisions",content:o[0].replace(/###?\s*?\s*Decisions[^\n]*\n/,"").trim(),severity:"success",collapsible:!0,collapsed:!1});let i=t.match(/###?\s*?\s*Follow-ups[\s\S]*?(?=###|$)/i);return i&&r.push({title:"\u{1F504} Follow-ups",content:i[0].replace(/###?\s*?\s*Follow-ups[^\n]*\n/,"").trim(),severity:"warning",collapsible:!0,collapsed:!0}),{type:r.length>0?"structured":"markdown",content:t,sections:r.length>0?r:void 0,actions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save as File",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md",suggestedFilename:"meeting-actions.md"},{label:"Insert at Cursor",icon:"\u{1F4DD}",action:"insert"}]}},defaultActions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save as File",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md"}],requirements:{copilot:!0},examples:[{name:"Sprint Planning Notes",inputs:{meetingNotes:`Sprint planning - Week 51
Team: John (BE), Sarah (FE), Mike (QA), Lisa (PM)

Discussed Q1 priorities. Auth feature is top priority.
John will implement OAuth2 backend by end of week.
Sarah to update UI components, needs design specs from Lisa.
Mike mentioned we need more test coverage.
Lisa to check with legal about GDPR requirements.
Deadline: Launch by Jan 15th.`,extractTypes:"actions,decisions,deadlines",outputFormat:"markdown",includeOwners:"true"}}]}});var yJ={};ve(yJ,{standupSummaryApp:()=>r_e});var r_e,vJ=x(()=>{"use strict";r_e={id:"standup-summary",name:"Standup Summary",description:"Format your daily standup update",icon:"\u{1F4CA}",category:"productivity",helpDocumentation:`
### What is this?
The **Standup Summary** app transforms your informal thoughts or "stream of consciousness" notes into a professionally formatted daily update.

### How to use it:
1. **Unload Your Thoughts**: Just type what you did yesterday, what you're doing today, and any blockers. Don't worry about formatting.
2. **Choose Format**: Select your target channel (Slack, Teams, etc.).
3. **Set Tone**: Match your team's culture with Professional, Casual, or Ultra-Brief styles.
4. **Generate**: The AI will organize your points using action verbs and highlight blockers clearly.

### Use cases:
- Preparing for a morning standup call.
- Posting a daily update to an async team channel.
- Maintaining a personal log of daily engineering activity.
    `,inputs:[{id:"thoughts",label:"What's on your mind? (stream of consciousness is fine)",type:"textarea",placeholder:`Just type what you're thinking, e.g.:

yesterday fixed that auth bug that was blocking QA, also reviewed 3 PRs for the team. today gonna work on the payment integration, need to figure out stripe webhooks. blocked on getting API keys from finance team, sent email but no response yet. also need to sync with Sarah about the design...`,required:!0,rows:8,hint:"Don't worry about formatting - we'll organize it for you"},{id:"outputFormat",label:"Output Format",type:"select",defaultValue:"slack",options:[{value:"slack",label:"\u{1F4AC} Slack-Ready",description:"With emojis, formatted for Slack"},{value:"teams",label:"\u{1F465} Microsoft Teams",description:"Teams-compatible formatting"},{value:"jira",label:"\u{1F3AB} JIRA Comment",description:"For JIRA standup notes"},{value:"plain",label:"\u{1F4C4} Plain Text",description:"Simple, no formatting"},{value:"email",label:"\u{1F4E7} Email",description:"Professional email format"},{value:"bullet",label:"\u2022 Bullet Points",description:"Simple bullet list"}]},{id:"includeDate",label:"Include Date",type:"checkbox",defaultValue:"true"},{id:"tone",label:"Tone",type:"select",defaultValue:"professional",options:[{value:"casual",label:"\u{1F60E} Casual",description:"Relaxed, friendly"},{value:"professional",label:"\u{1F454} Professional",description:"Clear and business-like"},{value:"brief",label:"\u26A1 Ultra-Brief",description:"Minimal words, just the essentials"}]},{id:"teamContext",label:"Team/Project (optional)",type:"text",placeholder:"e.g., Platform Team, Project Phoenix",hint:"Adds context if posting to shared channels"}],primaryAction:"Generate Summary",systemPrompt:`You are an expert at turning informal thoughts into clear, professional standup updates.
Transform the user's stream of consciousness into a well-organized standup summary.

## Standard Standup Structure

1. **Yesterday/Done** - What was completed
2. **Today/Doing** - What's planned for today
3. **Blockers** - Any blockers or impediments (if any)

## Guidelines

1. **Be Concise**: Keep each item to one line when possible
2. **Use Action Verbs**: "Fixed", "Completed", "Working on", "Reviewing"
3. **Highlight Impact**: Mention who benefits or why it matters
4. **Be Specific**: Include ticket numbers, feature names, etc. if mentioned
5. **Group Related Items**: Combine related work into single points
6. **Blockers are Important**: Always highlight blockers clearly

## Format-Specific Instructions

### Slack Format
\`\`\`
\u{1F504} *Standup Update - [Date]*

*Yesterday:*
\u2705 [Completed item 1]
\u2705 [Completed item 2]

*Today:*
\u{1F3AF} [Planned item 1]
\u{1F3AF} [Planned item 2]

*Blockers:*
\u{1F6A7} [Blocker if any] (or \u2728 No blockers!)
\`\`\`

### Teams Format
Use **bold** for headers, standard bullets.

### JIRA Format
Use h4. for headers, * for bullets.

### Email Format
Professional tone, proper greeting, signature placeholder.

### Plain/Bullet
Simple, clean formatting.

## Tone Guidelines

- **Casual**: Use contractions, friendly language, more emojis
- **Professional**: Clear, business-like, minimal emojis
- **Ultra-Brief**: Just the facts, no fluff, telegram style`,buildUserPrompt:t=>{let e=[];if(e.push(`## My Thoughts/Notes
${t.thoughts}`),e.push(`## Output Format: ${t.outputFormat||"slack"}`),e.push(`## Tone: ${t.tone||"professional"}`),t.includeDate==="true"){let r=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});e.push(`## Date: ${r}`)}return t.teamContext&&e.push(`## Context: ${t.teamContext}`),e.push(`
Please transform my notes into a clean, organized standup update following the format and tone specified.`),e.join(`

`)},parseResponse:(t,e)=>({type:"markdown",content:t,actions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Insert at Cursor",icon:"\u{1F4DD}",action:"insert"}]}),defaultActions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"}],requirements:{copilot:!0},examples:[{name:"Typical Developer Day",inputs:{thoughts:"yesterday fixed the auth bug in the login flow, the one that was causing 500 errors. also reviewed prs from john and sarah. today going to start on the new dashboard feature, need to check requirements with PM first. might be blocked on design mocks, asked in slack but havent heard back",outputFormat:"slack",tone:"professional",includeDate:"true"}},{name:"Quick Update",inputs:{thoughts:"finished api integration, starting frontend now, no blockers",outputFormat:"bullet",tone:"brief",includeDate:"false"}}]}});var bJ={};ve(bJ,{oneOnOnePrepApp:()=>n_e});var n_e,_J=x(()=>{"use strict";n_e={id:"one-on-one-prep",name:"1:1 Meeting Prep",description:"Prepare effective 1:1 meetings with team members",icon:"\u{1F465}",category:"leadership",tags:["meetings","management","1:1","coaching"],helpDocumentation:`
### What is this?
Prepare for meaningful 1:1 meetings with your direct reports.

### How to use:
1. Enter team member name and role
2. Add context (recent work, concerns, goals)
3. Generate personalized talking points and questions
    `,inputs:[{id:"memberName",label:"Team Member Name",type:"text",placeholder:"e.g., Sarah Chen",required:!0},{id:"memberRole",label:"Role / Position",type:"text",placeholder:"e.g., Senior Software Engineer",required:!0},{id:"recentContext",label:"Recent Context",type:"textarea",placeholder:`Recent highlights or concerns:
- Delivered feature X ahead of schedule
- Seemed stressed during sprint planning
- Asked about promotion path`,rows:5,hint:"What has been going on with this person recently?"},{id:"meetingGoals",label:"Meeting Goals",type:"multi-select",defaultValue:"check-in,growth",options:[{value:"check-in",label:"\u{1F4AC} General Check-in"},{value:"growth",label:"\u{1F4C8} Career Growth"},{value:"feedback",label:"\u{1F3AF} Give Feedback"},{value:"blockers",label:"\u{1F6A7} Address Blockers"},{value:"recognition",label:"\u{1F31F} Recognition"},{value:"difficult",label:"\u26A0\uFE0F Difficult Conversation"}]},{id:"lastMeetingNotes",label:"Last Meeting Notes (optional)",type:"textarea",placeholder:"Any notes from the previous 1:1...",rows:3}],primaryAction:"Generate Meeting Prep",systemPrompt:`You are an expert leadership coach helping managers prepare effective 1:1 meetings.

## Your Output Should Include:

### \u{1F4CB} Agenda (5-10 items)
Suggested topics and time allocation

### \u{1F4AC} Conversation Starters
3-5 open-ended questions to build rapport

### \u{1F3AF} Key Questions to Ask
Based on the goals, provide specific questions

### \u{1F4DD} Notes Template
Structure for taking notes during the meeting

### \u23ED\uFE0F Follow-up Actions
Suggested action items to track

Be warm, empathetic, and focus on the team member's growth and well-being.`,buildUserPrompt:t=>`## Team Member: ${t.memberName}
**Role:** ${t.memberRole}

## Recent Context
${t.recentContext||"No specific context provided"}

## Meeting Goals
${t.meetingGoals?.split(",").join(", ")||"General check-in"}

${t.lastMeetingNotes?`## Last Meeting Notes
${t.lastMeetingNotes}`:""}

Please prepare a comprehensive 1:1 meeting prep document.`,parseResponse:t=>({type:"markdown",content:t,actions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md"}]}),requirements:{copilot:!0}}});var wJ={};ve(wJ,{performanceReviewApp:()=>o_e});var o_e,xJ=x(()=>{"use strict";o_e={id:"performance-review-writer",name:"Performance Review Writer",description:"Write balanced and constructive performance reviews",icon:"\u{1F4CA}",category:"leadership",tags:["reviews","feedback","hr","management"],helpDocumentation:`
### What is this?
Generate well-structured, fair, and constructive performance reviews.

### How to use:
1. Enter employee details and review period
2. Add achievements and areas for improvement
3. Choose review style and tone
4. Generate a professional review
    `,inputs:[{id:"employeeName",label:"Employee Name",type:"text",placeholder:"e.g., Alex Johnson",required:!0},{id:"role",label:"Role",type:"text",placeholder:"e.g., Product Manager",required:!0},{id:"reviewPeriod",label:"Review Period",type:"text",placeholder:"e.g., Q4 2024, H2 2024",defaultValue:"Last 6 months"},{id:"overallRating",label:"Overall Performance Rating",type:"select",defaultValue:"meets",options:[{value:"exceptional",label:"\u2B50 Exceptional - Far exceeds expectations"},{value:"exceeds",label:"\u{1F31F} Exceeds Expectations"},{value:"meets",label:"\u2705 Meets Expectations"},{value:"developing",label:"\u{1F4C8} Developing - Some improvement needed"},{value:"needs-improvement",label:"\u26A0\uFE0F Needs Significant Improvement"}]},{id:"achievements",label:"Key Achievements",type:"textarea",placeholder:`List key accomplishments:
- Led successful launch of feature X
- Mentored 2 junior engineers
- Improved system performance by 30%`,rows:5,required:!0},{id:"areasForGrowth",label:"Areas for Growth",type:"textarea",placeholder:`Areas to develop:
- Need to improve communication with stakeholders
- Could delegate more effectively
- Time management during sprints`,rows:4},{id:"goals",label:"Goals for Next Period",type:"textarea",placeholder:"What should they focus on going forward?",rows:3},{id:"tone",label:"Review Tone",type:"radio",defaultValue:"balanced",options:[{value:"formal",label:"\u{1F4CB} Formal / Corporate"},{value:"balanced",label:"\u2696\uFE0F Balanced / Professional"},{value:"encouraging",label:"\u{1F4AA} Encouraging / Supportive"}]}],primaryAction:"Generate Performance Review",systemPrompt:`You are an expert HR consultant helping managers write effective performance reviews.

## Guidelines:
1. **Be Specific**: Use concrete examples, not vague statements
2. **Be Balanced**: Include both strengths and growth areas
3. **Be Constructive**: Frame feedback positively
4. **Be Fair**: Avoid bias and focus on behaviors/outcomes
5. **Be Forward-Looking**: Include actionable goals

## Output Structure:
1. **Executive Summary** (2-3 sentences)
2. **Key Accomplishments** (bulleted, specific)
3. **Strengths Demonstrated**
4. **Areas for Development** (constructive framing)
5. **Goals for Next Period** (SMART format)
6. **Overall Assessment**
7. **Manager Recommendations**`,buildUserPrompt:t=>{let e={exceptional:"Exceptional - Far exceeds expectations",exceeds:"Exceeds Expectations",meets:"Meets Expectations",developing:"Developing - Needs some improvement","needs-improvement":"Needs Significant Improvement"};return`## Performance Review Request

**Employee:** ${t.employeeName}
**Role:** ${t.role}
**Review Period:** ${t.reviewPeriod}
**Overall Rating:** ${e[t.overallRating]||t.overallRating}
**Tone:** ${t.tone}

## Key Achievements
${t.achievements}

## Areas for Growth
${t.areasForGrowth||"None specified"}

## Suggested Goals
${t.goals||"To be determined"}

Please write a comprehensive, professional performance review.`},parseResponse:t=>({type:"markdown",content:t,actions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save as Doc",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md"}]}),requirements:{copilot:!0}}});var SJ={};ve(SJ,{teamFeedbackApp:()=>i_e});var i_e,kJ=x(()=>{"use strict";i_e={id:"team-feedback-generator",name:"Team Feedback Generator",description:"Craft constructive feedback using proven frameworks",icon:"\u{1F4AC}",category:"leadership",tags:["feedback","coaching","communication","management"],helpDocumentation:`
### What is this?
Generate professional, constructive feedback using proven frameworks like SBI (Situation-Behavior-Impact).

### How to use:
1. Describe the situation and behavior
2. Choose feedback type and framework
3. Get well-structured, actionable feedback
    `,inputs:[{id:"recipientName",label:"Feedback Recipient",type:"text",placeholder:"e.g., Jamie",required:!0},{id:"feedbackType",label:"Feedback Type",type:"radio",defaultValue:"constructive",options:[{value:"positive",label:"\u{1F31F} Positive / Recognition",description:"Reinforce great behavior"},{value:"constructive",label:"\u{1F527} Constructive",description:"Help them improve"},{value:"redirect",label:"\u{1F504} Redirect",description:"Course correction needed"}]},{id:"situation",label:"Situation",type:"textarea",placeholder:`What happened? When and where?

e.g., During yesterday's sprint planning meeting...`,rows:3,required:!0,hint:"Be specific about time, place, and context"},{id:"behavior",label:"Observed Behavior",type:"textarea",placeholder:`What did they do or say?

e.g., They interrupted teammates 3 times and dismissed alternative ideas quickly.`,rows:3,required:!0,hint:"Focus on observable facts, not assumptions"},{id:"impact",label:"Impact",type:"textarea",placeholder:`What was the effect?

e.g., Other team members stopped sharing their ideas and the meeting ended without buy-in.`,rows:3,hint:"How did it affect the team, project, or outcomes?"},{id:"desiredOutcome",label:"Desired Outcome",type:"textarea",placeholder:"What would you like to see instead?",rows:2},{id:"framework",label:"Feedback Framework",type:"select",defaultValue:"sbi",options:[{value:"sbi",label:"\u{1F3AF} SBI (Situation-Behavior-Impact)"},{value:"star",label:"\u2B50 STAR (Situation-Task-Action-Result)"},{value:"coin",label:"\u{1FA99} COIN (Context-Observation-Impact-Next)"},{value:"simple",label:"\u{1F4DD} Simple Direct Feedback"}]},{id:"deliveryMethod",label:"Delivery Method",type:"radio",defaultValue:"verbal",options:[{value:"verbal",label:"\u{1F5E3}\uFE0F In-person / Video",description:"Script for conversation"},{value:"written",label:"\u2709\uFE0F Written / Email",description:"Written message"},{value:"both",label:"\u{1F4CB} Both",description:"Script + follow-up email"}]}],primaryAction:"Generate Feedback",systemPrompt:`You are an expert leadership coach helping managers deliver effective feedback.

## Key Principles:
1. **Be Specific**: Use concrete examples
2. **Be Timely**: Reference recent events
3. **Be Constructive**: Focus on growth, not blame
4. **Be Actionable**: Provide clear next steps
5. **Be Empathetic**: Consider their perspective

## Output Should Include:
1. **Opening** - Set positive tone
2. **Feedback (using selected framework)**
3. **Discussion Prompts** - Questions to ask them
4. **Suggested Next Steps** - Concrete actions
5. **Closing** - End on supportive note

For written feedback, use a professional but warm tone.
For verbal scripts, include pauses and checkpoints for dialogue.`,buildUserPrompt:t=>{let e={sbi:"SBI (Situation-Behavior-Impact)",star:"STAR (Situation-Task-Action-Result)",coin:"COIN (Context-Observation-Impact-Next)",simple:"Simple Direct"};return`## Feedback Request

**Recipient:** ${t.recipientName}
**Type:** ${t.feedbackType}
**Framework:** ${e[t.framework]}
**Delivery:** ${t.deliveryMethod}

### Situation
${t.situation}

### Observed Behavior
${t.behavior}

### Impact
${t.impact||"Not specified"}

### Desired Outcome
${t.desiredOutcome||"Improvement in this area"}

Please generate professional feedback ready for delivery.`},parseResponse:t=>({type:"markdown",content:t,actions:[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Save",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md"}]}),requirements:{copilot:!0}}});var AJ={};ve(AJ,{playwrightGeneratorApp:()=>s_e});var s_e,$J=x(()=>{"use strict";s_e={id:"playwright-generator",name:"Playwright Script Generator",description:"Generate automation scripts from test steps",icon:"\u{1F3AD}",category:"qa",helpDocumentation:`
### What is this?
The **Playwright Script Generator** turns manual test steps or requirements into high-quality automation scripts. It supports TypeScript, JavaScript, and Python.

### How to use it:
1. **Define Steps**: Paste your steps in the textarea or **attach an Excel/Word file** containing the test cases.
2. **Provide Locators**: (Optional) If you have specific IDs or selectors, list them to ensure the AI uses your preferred identifiers.
3. **Configure**: Choose your target language, browser, and features (like screenshots or video).
4. **Generate**: Click the primary action. 
5. **Magic Feature**: Once the script is generated, use the **\u{1F680} Create Full Project** button to automatically scaffold a complete, ready-to-run Playwright environment.

### Use cases:
- Rapidly automating manual regression tests.
- Scaffolding new end-to-end test suites.
- Converting legacy test documentation into executable code.
    `,inputs:[{id:"attachedFiles",label:"Attach Files (optional)",type:"file-picker",placeholder:"Attach Excel, DOCX, TXT, or MD files with test steps/locators",hint:"Upload test scripts from Excel, Word docs, or text files. File contents will be extracted and used.",rows:0},{id:"testSteps",label:"Test Steps",type:"textarea",placeholder:`Paste your test steps here, e.g.:

1. Navigate to https://example.com/login
2. Enter "testuser@email.com" in email field
3. Enter "password123" in password field
4. Click the Login button
5. Verify dashboard page loads
6. Click on Settings menu
7. Verify Settings page title is visible`,required:!1,rows:10,hint:"Paste test steps directly, or use the file attachment above"},{id:"locators",label:"Element Locators (optional)",type:"textarea",placeholder:`Provide locators if you have them:

email field: #email-input
password field: input[name="password"]
Login button: button.login-btn
Settings menu: [data-testid="settings-link"]`,rows:6,hint:"CSS selectors, data-testid, or other locators for elements"},{id:"requirements",label:"Additional Requirements (optional)",type:"textarea",placeholder:`Any special requirements:
- Wait for network idle after login
- Handle cookie consent popup
- Test should work for mobile viewport
- Need to handle 2FA if prompted`,rows:4},{id:"baseUrl",label:"Base URL",type:"text",placeholder:"https://your-app.com",hint:"The starting URL for your test"},{id:"language",label:"Programming Language",type:"radio",defaultValue:"typescript",options:[{value:"typescript",label:"\u{1F537} TypeScript",description:"Recommended - Type safety & better IDE support"},{value:"javascript",label:"\u{1F7E8} JavaScript",description:"Simple and widely used"},{value:"python",label:"\u{1F40D} Python",description:"Great for data-driven testing"}]},{id:"browser",label:"Browser",type:"select",defaultValue:"chrome",options:[{value:"chrome",label:"\u{1F310} Google Chrome"},{value:"msedge",label:"\u{1F537} Microsoft Edge"}]},{id:"headless",label:"Run Mode",type:"radio",defaultValue:"headed",options:[{value:"headed",label:"\u{1F441}\uFE0F Headed (Visible browser)",description:"Watch the test run"},{value:"headless",label:"\u26A1 Headless (No UI)",description:"Faster, for CI/CD"}]},{id:"features",label:"Additional Features",type:"multi-select",defaultValue:"screenshots,report,retry",options:[{value:"screenshots",label:"\u{1F4F8} Screenshots per step",description:"Capture screenshot after each action"},{value:"video",label:"\u{1F3A5} Video recording",description:"Record full test execution"},{value:"report",label:"\u{1F4CA} HTML Report",description:"Generate visual test report"},{value:"retry",label:"\u{1F504} Auto-retry on failure",description:"Retry failed tests automatically"},{value:"trace",label:"\u{1F50D} Trace on failure",description:"Capture trace for debugging"},{value:"parallel",label:"\u26A1 Parallel execution",description:"Run tests in parallel"}]},{id:"testName",label:"Test Name",type:"text",placeholder:"Login Flow Test",defaultValue:"Automated Test",hint:"Name for your test suite (also used as folder name)"},{id:"targetFolder",label:"Target Folder",type:"project-picker",required:!0,placeholder:"Select where to create the test project",hint:"A folder named after your test will be created here with all files"},{id:"jiraIssueId",label:"Jira Issue ID (optional)",type:"text",placeholder:"e.g., PROJ-123, TEST-456",hint:"Enter a Jira issue ID to auto-fetch requirements as context. Configure Jira in Apps Hub settings.",required:!1},{id:"model",label:"AI Model",type:"model-picker",defaultValue:"auto",hint:"Select which AI model to use for generating the script"}],primaryAction:"Generate & Create Project",systemPrompt:`You are an expert Playwright automation engineer. Generate production-ready, enterprise-grade Playwright test scripts.

## Guidelines

1. **Robust Locators**: Use resilient selectors (data-testid > role > text > css)
2. **Proper Waits**: Use auto-waiting, avoid hardcoded delays
3. **Error Handling**: Include try-catch for critical steps
4. **Screenshots**: Capture screenshots at key points for debugging
5. **Assertions**: Add meaningful assertions after each significant action
6. **Comments**: Add clear comments explaining each step
7. **Best Practices**: Follow Playwright best practices

## Output Structure

Generate the script in THREE sections:

### SECTION 1: SETUP FILES
First, provide package.json and config files needed.

### SECTION 2: MAIN TEST FILE
The complete test script with:
- Proper imports
- Test setup/teardown
- Step-by-step actions with comments
- Screenshots after key steps
- Assertions to verify behavior
- Error handling

### SECTION 3: COMMANDS
Provide exact terminal commands to:
1. Install dependencies
2. Run the test
3. View the report

## Code Quality Requirements

- No syntax errors
- Proper async/await usage
- Type safety (for TypeScript)
- Descriptive variable names
- Modular helper functions where appropriate

## Screenshot Convention

For each step, capture screenshot with descriptive name:
await page.screenshot({ path: 'screenshots/01-login-page.png' });
await page.screenshot({ path: 'screenshots/02-after-credentials.png' });

## Report Configuration

Include HTML reporter configuration for visual reports.`,buildUserPrompt:t=>{let e=[];e.push("## Configuration"),e.push(`- **Language**: ${t.language||"typescript"}`),e.push(`- **Browser**: ${t.browser||"chrome"}`),e.push(`- **Mode**: ${t.headless==="headless"?"Headless":"Headed"}`);let r=(t.features||"screenshots,report").split(",");if(e.push(`- **Features**: ${r.join(", ")}`),t.testName&&e.push(`- **Test Name**: ${t.testName}`),t.baseUrl&&e.push(`- **Base URL**: ${t.baseUrl}`),t.attachedFiles&&t.attachedFiles.trim()&&t.attachedFiles!=="[]")try{let n=JSON.parse(t.attachedFiles);if(n.length>0){e.push(`
## Attached Files`);for(let o of n)e.push(`
### File: ${o.name}`),e.push("```"),e.push(o.content),e.push("```")}}catch{}return t.testSteps&&t.testSteps.trim()&&e.push(`
## Test Steps to Automate
${t.testSteps}`),t.locators&&t.locators.trim()?e.push(`
## Element Locators Provided
${t.locators}`):e.push(`
## Locators
No specific locators provided. Please use best practices to identify elements (prefer data-testid, role, text, then CSS selectors).`),t.requirements&&t.requirements.trim()&&e.push(`
## Additional Requirements
${t.requirements}`),t.jiraContext&&t.jiraContext.trim()&&e.push(`
## Jira Issue Context
${t.jiraContext}`),e.push(`
## Instructions
Generate a complete, ready-to-run Playwright test script. Include:
1. All necessary setup files (package.json, playwright.config)
2. The main test file with proper structure
3. Exact commands to install and run

Make sure the code has NO ERRORS and follows best practices.`),e.join(`
`)},parseResponse:(t,e)=>{let r=e.language||"typescript",n={typescript:".ts",javascript:".js",python:".py"},o=[],i=t.match(/###?\s*(?:SECTION 1|SETUP|Setup Files)[\s\S]*?(?=###?\s*(?:SECTION 2|MAIN|Main Test)|$)/i);i&&o.push({title:"\u{1F4E6} Setup Files",content:i[0].replace(/###?\s*(?:SECTION 1|SETUP|Setup Files)[^\n]*\n/i,"").trim(),severity:"info",collapsible:!0,collapsed:!1});let s=t.match(/###?\s*(?:SECTION 2|MAIN|Main Test)[\s\S]*?(?=###?\s*(?:SECTION 3|COMMANDS|Commands)|$)/i);s&&o.push({title:"\u{1F3AD} Main Test File",content:s[0].replace(/###?\s*(?:SECTION 2|MAIN|Main Test)[^\n]*\n/i,"").trim(),severity:"success",collapsible:!1});let a=t.match(/###?\s*(?:SECTION 3|COMMANDS|Commands)[\s\S]*/i);a&&o.push({title:"\u{1F4BB} Run Commands",content:a[0].replace(/###?\s*(?:SECTION 3|COMMANDS|Commands)[^\n]*\n/i,"").trim(),severity:"info",collapsible:!0,collapsed:!1,actions:[{label:"Copy Commands",icon:"\u{1F4CB}",action:"copy"}]});let c=t.match(/```(?:typescript|javascript|python|ts|js|py)\n([\s\S]*?)\n```/),l=c?c[1]:"",u=`test${n[r]}`;return{type:o.length>0?"structured":"markdown",content:t,sections:o.length>0?o:void 0,summary:`Generated ${r.toUpperCase()} Playwright script`,actions:[{label:`Download ${u}`,icon:"\u2B07\uFE0F",action:"newFile",fileExtension:n[r],suggestedFilename:u,data:l||t},{label:"\u{1F680} Create Full Project",icon:"\u{1F4C1}",action:"export",data:"extractAndCreateProject"},{label:"Copy All",icon:"\u{1F4CB}",action:"copy"},{label:"Insert at Cursor",icon:"\u{1F4DD}",action:"insert"}]}},defaultActions:[{label:"\u{1F680} Create Project",icon:"\u{1F4C1}",action:"export",data:"extractAndCreateProject"},{label:"Download Script",icon:"\u2B07\uFE0F",action:"newFile",fileExtension:".ts"},{label:"Copy",icon:"\u{1F4CB}",action:"copy"}],requirements:{copilot:!0},examples:[{name:"Login Flow Test",inputs:{testSteps:`1. Navigate to https://example.com/login
2. Enter "testuser@email.com" in the email field
3. Enter "password123" in the password field
4. Click the Login button
5. Verify the dashboard page loads successfully
6. Check that the welcome message shows the username`,locators:`email field: #email
password field: #password
Login button: button[type="submit"]
welcome message: .welcome-text`,language:"typescript",browser:"chromium",headless:"headed",features:"screenshots,report,retry",testName:"Login Flow Test"}},{name:"E-commerce Checkout",inputs:{testSteps:`1. Go to the product page
2. Select size "Medium"
3. Click Add to Cart
4. Go to Cart
5. Click Checkout
6. Fill shipping details
7. Select payment method
8. Complete purchase
9. Verify order confirmation`,language:"python",browser:"all",features:"screenshots,video,report",testName:"Checkout Flow Test"}}]}});var PJ={};ve(PJ,{accessibilityCheckerApp:()=>a_e});var a_e,CJ=x(()=>{"use strict";a_e={id:"accessibility-checker",name:"Accessibility Checker",description:"Get a11y recommendations for your UI components",icon:"\u267F",category:"qa",primaryAction:"\u{1F50D} Check Accessibility",helpDocumentation:`### What is this?
The **Accessibility Checker** analyzes UI code or descriptions and provides WCAG-compliant accessibility recommendations.

### How to use it
1. Paste your UI code (HTML, JSX, Vue template) or describe the component.
2. Select the WCAG conformance level you're targeting.
3. Click **Check Accessibility** to get detailed recommendations.

### Use cases
- Auditing existing components for a11y issues
- Learning accessibility best practices
- Preparing for WCAG compliance audits
- Improving keyboard navigation and screen reader support`,inputs:[{id:"uiCode",label:"UI Code or Description",type:"textarea",placeholder:`Paste your component code (HTML, JSX, Vue) or describe the UI...

Example:
A modal dialog with a form containing name and email fields, a submit button, and a close icon button.`,required:!0,rows:8,hint:"Include all interactive elements for a thorough review"},{id:"wcagLevel",label:"WCAG Level",type:"radio",options:[{value:"A",label:"Level A",description:"Minimum accessibility (essential)"},{value:"AA",label:"Level AA",description:"Standard target (recommended)"},{value:"AAA",label:"Level AAA",description:"Highest conformance"}],defaultValue:"AA"},{id:"focus",label:"Focus Areas",type:"multi-select",options:[{value:"keyboard",label:"Keyboard Navigation"},{value:"screen-reader",label:"Screen Reader"},{value:"color",label:"Color Contrast"},{value:"forms",label:"Form Labels & Errors"},{value:"motion",label:"Motion & Animation"}]}],systemPrompt:`You are an accessibility expert specializing in web applications. Analyze UI components and provide actionable WCAG-compliant recommendations.

For each issue found:
1. **Issue** - What's wrong
2. **WCAG Criterion** - e.g., "1.4.3 Contrast (Minimum)"
3. **Impact** - Who is affected and how
4. **Fix** - Code example showing the solution

Organize by severity: Critical > Serious > Moderate > Minor

Also include:
- \u2705 What's already good
- \u{1F9EA} How to test each fix
- \u{1F4DA} Resources for learning more`,buildUserPrompt:t=>{let e=`Check this UI for WCAG Level ${t.wcagLevel} accessibility issues:

${t.uiCode}`;return t.focus?.trim()&&(e+=`

Focus specifically on: ${t.focus.split(",").join(", ")}`),e},parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Accessibility Report",content:t}]})}});var IJ={};ve(IJ,{vulnerabilityScannerApp:()=>c_e});var c_e,TJ=x(()=>{"use strict";c_e={id:"vulnerability-scanner",name:"Vulnerability Scanner",description:"Scan code for security anti-patterns and vulnerabilities",icon:"\u{1F6E1}\uFE0F",category:"security",helpDocumentation:`
### What is this?
The **Vulnerability Scanner** is a static analysis tool that scans your code for common security anti-patterns, potential exploits, and poor security hygiene. It maps findings to OWASP standards.

### How to use it:
1. **Provide Code**: Either paste a snippet directly or leave the field empty to scan the file currently open in your editor.
2. **Select Depth**: 
   - **Quick Scan**: Best for common accidental exposures (secrets, basic injection).
   - **Standard Scan**: Recommended for general code health.
   - **Deep Audit**: Use before major releases or on high-security modules.
3. **Review**: Findings are categorized by severity. Check the "Fix" section for recommended code changes.

### Use cases:
- Pre-commit security check.
- Auditing third-party code snippets.
- Validating sanitization logic.
    `,inputs:[{id:"codeSnippet",label:"Code to Scan",type:"code",placeholder:"Paste code here or leave empty to scan current file...",required:!1,hint:"If empty, the currently active file in your editor will be analyzed for vulnerabilities."},{id:"scanDepth",label:"Scan Depth",type:"select",defaultValue:"standard",options:[{value:"quick",label:"\u26A1 Quick Scan",description:"Checks for the Top 10 most common security anti-patterns"},{value:"standard",label:"\u{1F50D} Standard Scan",description:"Comprehensive analysis of common and complex vulnerabilities"},{value:"deep",label:"\u{1F52C} Deep Audit",description:"Exhaustive security analysis including subtle edge cases"}],hint:"Select how deep you want the security analysis to go."}],primaryAction:"Start Security Scan",systemPrompt:`You are a world-class security researcher and professional white-hat pentester.
Your goal is to identify potential security vulnerabilities, anti-patterns, and compliance issues in the provided code.

## Scanning Guidelines
1. **Be Precise**: Minimize false positives. Explain why something is a risk.
2. **Follow OWASP**: Reference OWASP Top 10 categories where applicable.
3. **Check for**:
    - Injection (SQL, NoSQL, OS, LDAPs)
    - Broken Authentication & Session Management
    - Sensitive Data Exposure
    - XML External Entities (XXE)
    - Broken Access Control
    - Security Misconfiguration
    - Cross-Site Scripting (XSS)
    - Insecure Deserialization
    - Using Components with Known Vulnerabilities
    - Insufficient Logging & Monitoring

## Output Format
Structure your report using these sections:

### \u{1F6A8} Critical Vulnerabilities
Issues that pose an immediate risk of data breach or system compromise.
Format:
- **[Severity: CRITICAL]** Title
  - **Type**: OWASP Category
  - **Risk**: What could happen
  - **Fix**: Remediated code snippet

### \u26A0\uFE0F Security Warnings
Potential issues or anti-patterns that increase the attack surface.
Same format as above.

### \u{1F4DD} Best Practices
General security improvements and hygiene.

### \u{1F4CA} Security Score
- Overall Rating: A-F
- Issues Found: Critical (X), Warning (X), Info (X)`,buildUserPrompt:(t,e)=>{let r=[],n=t.codeSnippet||e?.fileContents?.[0]?.content||"";return n?r.push(`## Code to Scan
\`\`\`
${n}
\`\`\``):r.push(`## Note
No code content provided. Please provide a code snippet to scan.`),r.push(`## Scan Depth
${t.scanDepth||"standard"}`),r.join(`

`)},parseResponse:t=>{let e=[],r=t.match(/###  Critical Vulnerabilities[\s\S]*?(?=###|$)/i);r&&!r[0].includes("None found")&&r[0].length>50&&e.push({title:"\u{1F6A8} Critical Vulnerabilities",content:r[0].replace(/###  Critical Vulnerabilities[^\n]*\n/,"").trim(),severity:"critical",collapsible:!0,collapsed:!1});let n=t.match(/###  Security Warnings[\s\S]*?(?=###|$)/i);return n&&!n[0].includes("None found")&&n[0].length>50&&e.push({title:"\u26A0\uFE0F Security Warnings",content:n[0].replace(/###  Security Warnings[^\n]*\n/,"").trim(),severity:"warning",collapsible:!0,collapsed:!1}),e.length===0?{type:"markdown",content:t}:{type:"structured",content:t,sections:e,summary:`Security scan complete. Found ${e.filter(o=>o.severity==="critical").length} critical issues.`}}}});var EJ={};ve(EJ,{iacGeneratorApp:()=>l_e});var l_e,OJ=x(()=>{"use strict";l_e={id:"iac-generator",name:"IaC Generator",description:"Generate Infrastructure as Code (Terraform, Pulumi, etc.)",icon:"\u2601\uFE0F",category:"devops",helpDocumentation:`
### What is this?
The **IaC Generator** accelerates cloud infrastructure deployment by converting natural language requirements into production-ready Infrastructure as Code (IaC).

### How to use it:
1. **Describe Infrastructure**: Provide a detailed description of the resources you need (e.g., "A VPC with 3 subnets and an RDS instance").
2. **Select Provider**: Choose between AWS, Azure, Google Cloud, or Kubernetes.
3. **Select Tool**: Choose your preferred IaC tool (Terraform, Pulumi, CloudFormation, or CDK).
4. **Generate**: The AI will produce well-commented code following best practices for naming, tagging, and security.

### Use cases:
- Scaffolding new environments.
- Translating architecture diagrams into code.
- Learning the syntax of a new IaC provider or tool.
    `,inputs:[{id:"requirement",label:"Infrastructure Requirements",type:"textarea",placeholder:"e.g., A highly available AWS VPC with 2 public and 2 private subnets across 2 AZs...",required:!0,rows:4},{id:"provider",label:"Cloud Provider",type:"select",defaultValue:"aws",options:[{value:"aws",label:"AWS",icon:"\u2601\uFE0F"},{value:"azure",label:"Azure",icon:"\u2601\uFE0F"},{value:"gcp",label:"Google Cloud",icon:"\u2601\uFE0F"},{value:"kubernetes",label:"Kubernetes",icon:"\u2638\uFE0F"}]},{id:"tool",label:"IaC Tool",type:"select",defaultValue:"terraform",options:[{value:"terraform",label:"Terraform",icon:"\u{1F3D7}\uFE0F"},{value:"pulumi",label:"Pulumi",icon:"\u{1F3D7}\uFE0F"},{value:"cloudformation",label:"CloudFormation",icon:"\u{1F3D7}\uFE0F"},{value:"cdk",label:"AWS CDK",icon:"\u{1F3D7}\uFE0F"}]}],primaryAction:"Generate IaC",systemPrompt:`You are an expert DevOps and Infrastructure Engineer. 
Your goal is to provide high-quality, production-ready Infrastructure as Code (IaC) snippets based on natural language descriptions.

## Guidelines
1. **Best Practices**: Use official provider modules or best practices (e.g., tagging, variables).
2. **Security**: Ensure secure defaults (e.g., private subnets, least privilege).
3. **Modular**: Structure the code to be reusable.
4. **Explanation**: Provide a brief explanation of the architecture created.

## Output Format
1. **Brief Summary**: What this code creates.
2. **Code Block**: The actual IaC code.
3. **Prerequisites**: Any steps needed to run this (e.g., CLI config).`,buildUserPrompt:t=>`Generate IaC for the following requirements:
        
Requirements: ${t.requirement}
Provider: ${t.provider}
Tool: ${t.tool}

Please include variables and tags for better resource management.`,parseResponse:(t,e)=>({type:"code",content:t,language:{terraform:"hcl",pulumi:"typescript",cloudformation:"yaml",cdk:"typescript"}[e.tool]||"hcl",actions:[{label:"Copy Code",icon:"\u{1F4CB}",action:"copy"},{label:"Save File",icon:"\u{1F4BE}",action:"newFile",suggestedFilename:`main.${e.tool==="terraform"?"tf":"ts"}`}]})}});var jJ={};ve(jJ,{adrDraftsmanApp:()=>u_e});var u_e,NJ=x(()=>{"use strict";u_e={id:"adr-draftsman",name:"ADR Draftsman",description:"Draft Architecture Decision Records (ADRs)",icon:"\u{1F3DB}\uFE0F",category:"architecture",helpDocumentation:`
### What is this?
The **ADR Draftsman** helps maintain a clear technical history by generating Architecture Decision Records (ADRs). It ensures that "Why" a decision was made is captured alongside the "What".

### How to use it:
1. **Title**: Give your decision a clear, searchable name.
2. **Provide Context**: Explain the current problem or constraint driving this decision.
3. **List Options**: (Optional) Mention what other approaches were considered and why they were rejected.
4. **Result**: The AI will draft a professional record including Status, Context, Decision, and Consequences.

### Use cases:
- Documenting a change in database provider.
- Formalizing the adoption of a new frontend framework.
- Recording technical debt trade-offs.
    `,inputs:[{id:"title",label:"Decision Title",type:"text",placeholder:"e.g., Use Postgres instead of MongoDB for User Service",required:!0,hint:"A clear, descriptive title for the architectural decision."},{id:"context",label:"Context & Problem",type:"textarea",placeholder:"Describe the problem we are trying to solve and any constraints...",required:!0,rows:3,hint:"What is the current situation? Why is this decision being made now?"},{id:"options",label:"Options Considered",type:"textarea",placeholder:"List the options you have looked at...",required:!1,rows:2,hint:"Optional: List other alternatives and why they were or weren't chosen."}],primaryAction:"Draft ADR",systemPrompt:`You are a Senior Software Architect. 
Your goal is to help teams document their architectural decisions clearly and concisely using the ADR (Architecture Decision Record) format.

## ADR Format
Use the standard MADR or similar template:
1. **Title**: The name of the decision.
2. **Status**: Proposed / Accepted / Superseded.
3. **Context**: Why are we doing this? What is the problem?
4. **Decision**: What are we doing?
5. **Consequences**: What is the impact? (Good and Bad).

## Tone
Professional, objective, and analytical.`,buildUserPrompt:t=>`Draft an ADR for:
        
Title: ${t.title}
Context: ${t.context}
Options: ${t.options||"Not specified"}`,parseResponse:t=>({type:"markdown",content:t,actions:[{label:"Copy ADR",icon:"\u{1F4CB}",action:"copy"},{label:"Save as ADR",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md",suggestedFilename:"ADR-XXX.md"}]})}});var RJ={};ve(RJ,{prdDraftsmanApp:()=>d_e});var d_e,zJ=x(()=>{"use strict";d_e={id:"prd-draftsman",name:"PRD Draftsman",description:"Turn ideas into Product Requirements Documents",icon:"\u{1F4C8}",category:"product",helpDocumentation:`
### What is this?
The **PRD Draftsman** bridges the gap between rough ideas and engineering reality. It transforms feature concepts into professional Product Requirements Documents (PRDs).

### How to use it:
1. **Describe the Idea**: Provide a high-level overview of the feature or product you're envisioning.
2. **Define Audience**: (Optional) Specify who the intended users are to help focus the requirements.
3. **Draft**: The AI will generate a structured PRD including Goals, User Stories, Functional Requirements, and Success Metrics.

### Use cases:
- Preparing for a product-engineering sync.
- Flesh out a "brainstorm" into a formal proposal.
- Creating standardized documentation for new feature requests.
    `,inputs:[{id:"idea",label:"Product Idea / Feature",type:"textarea",placeholder:"e.g., A mobile app for tracking local coffee shop rewards points...",required:!0,rows:4,hint:"What is the core idea? What problem does it solve for the user?"},{id:"audience",label:"Target Audience",type:"text",placeholder:"e.g., Coffee enthusiasts, local business owners",required:!1,hint:"Who are we building this for?"}],primaryAction:"Generate PRD",systemPrompt:`You are an expert Product Manager.
Your goal is to take a raw feature idea and flesh it out into a professional PRD.

## PRD Structure
1. **Goal**: What problem are we solving?
2. **User Stories**: What can the user do?
3. **Functional Requirements**: Detailed breakdown of features.
4. **Non-Functional Requirements**: Performance, Security, etc.
5. **Success Metrics**: How do we measure success?

## Tone
Structured, visionary, yet practical.`,buildUserPrompt:t=>`Generate a PRD for:
        
Idea: ${t.idea}
Target Audience: ${t.audience||"General users"}`,parseResponse:t=>({type:"markdown",content:t,actions:[{label:"Copy PRD",icon:"\u{1F4CB}",action:"copy"},{label:"Save as PRD",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md",suggestedFilename:"PRD.md"}]})}});var MJ={};ve(MJ,{jiraStoryWriterApp:()=>p_e});var p_e,DJ=x(()=>{"use strict";p_e={id:"jira-story-writer",name:"JIRA Story Writer",description:"Describe a feature, get a full user story with acceptance criteria",icon:"\u{1F4CB}",category:"jira",primaryAction:"\u270D\uFE0F Write Story",helpDocumentation:`### What is this?
The **JIRA Story Writer** transforms feature ideas into well-structured user stories with acceptance criteria, ready to paste into your project management tool.

### How to use it
1. Describe the feature or requirement in plain language.
2. Select the story type (User Story, Bug, Task, Epic).
3. Click **Write Story** to generate the complete ticket.

### Use cases
- Converting stakeholder requests into structured tickets
- Ensuring consistent story quality across the team
- Breaking down large features into actionable stories
- Training new team members on good story writing`,inputs:[{id:"featureDescription",label:"Feature Description",type:"textarea",placeholder:`Describe the feature, bug, or task...

Example: Users should be able to export their dashboard as a PDF so they can share it with stakeholders who don't have system access.`,required:!0,rows:5,hint:"Include the why, what, and who if possible"},{id:"storyType",label:"Story Type",type:"radio",options:[{value:"user-story",label:"User Story",description:"Feature from user perspective"},{value:"bug",label:"Bug",description:"Defect report"},{value:"task",label:"Technical Task",description:"Technical work item"},{value:"epic",label:"Epic",description:"Large feature with child stories"}],defaultValue:"user-story"},{id:"context",label:"Additional Context (optional)",type:"textarea",placeholder:"Any constraints, dependencies, or technical considerations...",rows:3}],systemPrompt:`You are an expert Agile coach and product manager. Create well-structured JIRA tickets that are clear, actionable, and follow best practices.

For User Stories, use the format:
**Title**: [Concise, action-oriented title]

**Description**:
As a [user type],
I want [goal],
So that [benefit].

**Acceptance Criteria**:
- [ ] Given [context], when [action], then [outcome]
- [ ] ...

**Technical Notes** (if applicable):
- Implementation hints
- API changes needed
- Security considerations

**Story Points**: [Estimate if possible]
**Labels**: [Suggested labels]`,buildUserPrompt:t=>{let e=`Create a ${t.storyType} ticket for:

${t.featureDescription}`;return t.context?.trim()&&(e+=`

Additional context:
${t.context}`),e},parseResponse:t=>({type:"markdown",content:t,sections:[{title:"JIRA Story",content:t}]})}});var qJ={};ve(qJ,{sprintRetroApp:()=>f_e});var f_e,BJ=x(()=>{"use strict";f_e={id:"sprint-retro",name:"Sprint Retrospective",description:"Summarize sprint activity into structured retro points",icon:"\u{1F504}",category:"jira",primaryAction:"\u{1F4CA} Generate Retro",helpDocumentation:`### What is this?
The **Sprint Retrospective** app helps you prepare for retro meetings by organizing sprint notes into structured discussion points.

### How to use it
1. Paste your sprint notes, completed tickets, or team observations.
2. Select your preferred retro format.
3. Click **Generate Retro** to get organized talking points.

### Use cases
- Preparing for sprint retrospective meetings
- Documenting team learnings and action items
- Identifying patterns across multiple sprints
- Facilitating more productive retro discussions`,inputs:[{id:"sprintNotes",label:"Sprint Notes & Observations",type:"textarea",placeholder:`Paste completed tickets, incident notes, team feedback, blockers encountered...

Example:
- Completed: User auth, Dashboard redesign
- Blocked on: API rate limits, unclear requirements for export feature
- Team feedback: Too many meetings, good collaboration on auth`,required:!0,rows:8,hint:"Include the good, the bad, and everything in between"},{id:"format",label:"Retro Format",type:"radio",options:[{value:"start-stop-continue",label:"Start, Stop, Continue",description:"Classic format for change-focused retros"},{value:"liked-learned-lacked",label:"Liked, Learned, Lacked",description:"Positive, reflective format"},{value:"mad-sad-glad",label:"Mad, Sad, Glad",description:"Emotion-based categorization"},{value:"sailboat",label:"Sailboat",description:"Wind (helps), Anchor (slows), Rocks (risks)"}],defaultValue:"start-stop-continue"},{id:"sprintGoal",label:"Sprint Goal (optional)",type:"text",placeholder:"What was the main sprint objective?",hint:"Helps evaluate if the sprint achieved its purpose"}],systemPrompt:`You are an Agile coach facilitating a sprint retrospective. Organize the provided notes into a structured retro format that drives actionable improvements.

Guidelines:
- Be specific, not generic (use examples from the notes)
- Prioritize items by impact
- Suggest 2-3 concrete action items
- Include a brief sprint summary at the top
- Keep it constructive and team-focused
- Add facilitation tips for discussing each point`,buildUserPrompt:t=>{let e=`Create a ${t.format.replace(/-/g,", ")} retrospective from these sprint notes:

${t.sprintNotes}`;return t.sprintGoal?.trim()&&(e+=`

Sprint goal was: ${t.sprintGoal}`),e},parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Sprint Retrospective",content:t}]})}});var UJ={};ve(UJ,{emailComposerApp:()=>m_e});var m_e,LJ=x(()=>{"use strict";m_e={id:"email-composer",name:"Email Composer",description:"Draft professional emails from key points",icon:"\u{1F4E7}",category:"communication",primaryAction:"\u2709\uFE0F Compose Email",helpDocumentation:`### What is this?
The **Email Composer** transforms bullet points and rough notes into polished, professional emails ready to send.

### How to use it
1. Enter the key points you want to communicate.
2. Select the tone and purpose of your email.
3. Click **Compose Email** to get a well-structured draft.

### Use cases
- Writing status updates to stakeholders
- Sending project proposals
- Following up on meetings
- Communicating difficult messages professionally`,inputs:[{id:"keyPoints",label:"Key Points",type:"textarea",placeholder:`- Project deadline moved to next Friday
- Need design approval by Wednesday
- Budget approved for additional resources
- Thanks for their support`,required:!0,rows:5,hint:"List the main things you want to say"},{id:"recipient",label:"Who is this for?",type:"text",placeholder:"e.g., My manager, Client stakeholder, Team members",hint:"Helps adjust formality and context"},{id:"tone",label:"Tone",type:"radio",options:[{value:"professional",label:"Professional",description:"Formal and business-appropriate"},{value:"friendly",label:"Friendly",description:"Warm but still professional"},{value:"urgent",label:"Urgent",description:"Direct and action-focused"},{value:"apologetic",label:"Apologetic",description:"Acknowledging mistakes or delays"}],defaultValue:"professional"},{id:"purpose",label:"Email Purpose",type:"select",options:[{value:"update",label:"Status Update"},{value:"request",label:"Request / Ask"},{value:"followup",label:"Follow-up"},{value:"announcement",label:"Announcement"},{value:"thankyou",label:"Thank You"},{value:"introduction",label:"Introduction"}],defaultValue:"update"}],systemPrompt:`You are an expert business communicator. Draft clear, professional emails that effectively convey the key messages while maintaining the appropriate tone.

Guidelines:
- Start with a clear subject line suggestion
- Keep paragraphs short and scannable
- Use bullet points for lists when appropriate
- Include a clear call-to-action if needed
- End with an appropriate closing
- Keep the email concise (under 200 words unless complex)

Format:
**Subject:** [Suggested subject line]

[Email body]

[Closing]`,buildUserPrompt:t=>{let e=`Write a ${t.tone} ${t.purpose} email with these key points:

${t.keyPoints}`;return t.recipient?.trim()&&(e+=`

Recipient: ${t.recipient}`),e},parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Email Draft",content:t}]})}});var FJ={};ve(FJ,{slackPolisherApp:()=>h_e});var h_e,VJ=x(()=>{"use strict";h_e={id:"slack-polisher",name:"Slack Message Polisher",description:"Rewrite casual text into clear, professional messages",icon:"\u{1F4AC}",category:"communication",primaryAction:"\u2728 Polish Message",helpDocumentation:`### What is this?
The **Slack Message Polisher** takes your rough draft messages and refines them for clarity, professionalism, and impact\u2014perfect for important Slack communications.

### How to use it
1. Type your rough message as you'd naturally write it.
2. Select your target audience and desired outcome.
3. Click **Polish Message** to get an improved version.

### Use cases
- Announcing project updates to the team
- Asking for help without sounding needy
- Giving feedback constructively
- Communicating across time zones clearly`,inputs:[{id:"roughMessage",label:"Your Draft Message",type:"textarea",placeholder:"hey so we finished the thing but there were some issues and we might need to push the deadline a bit, can someone look at the api stuff?",required:!0,rows:4,hint:"Write naturally, we'll polish it for you"},{id:"audience",label:"Who's reading this?",type:"select",options:[{value:"team",label:"My Team"},{value:"manager",label:"My Manager"},{value:"leadership",label:"Leadership / Executives"},{value:"cross-team",label:"Cross-functional Team"},{value:"external",label:"External Partner / Client"}],defaultValue:"team"},{id:"goal",label:"What's the goal?",type:"select",options:[{value:"inform",label:"Inform / Update"},{value:"ask",label:"Ask for Help"},{value:"decide",label:"Get a Decision"},{value:"celebrate",label:"Celebrate / Recognize"},{value:"warn",label:"Flag a Risk / Issue"}],defaultValue:"inform"},{id:"channelType",label:"Channel Type",type:"radio",options:[{value:"public",label:"Public Channel",description:"Visible to many people"},{value:"private",label:"Private / DM",description:"More informal ok"}],defaultValue:"public"}],systemPrompt:`You are a communication coach specializing in async workplace messaging. Rewrite the user's draft into a clear, effective Slack message.

Guidelines:
- Keep it concise (Slack is for quick reads)
- Use emoji sparingly but effectively
- Structure longer messages with bullet points
- Make the ask or update crystal clear
- Add context without over-explaining
- Match formality to the audience

Provide:
1. The polished message
2. Brief note on what was improved (1-2 sentences)`,buildUserPrompt:t=>`Rewrite this ${t.channelType} Slack message for ${t.audience}. Goal: ${t.goal}.

Original draft:
${t.roughMessage}`,parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Polished Message",content:t}]})}});var HJ={};ve(HJ,{ecardRecognitionApp:()=>g_e});var g_e,GJ=x(()=>{"use strict";g_e={id:"ecard-recognition",name:"eCard & Recognition",description:"Generate heartfelt recognition messages and eCards for colleagues",icon:"\u{1F389}",category:"communication",primaryAction:"\u2728 Generate Messages",helpDocumentation:`### What is this?
The **eCard & Recognition** app helps you craft thoughtful, personalized recognition messages for your teammates and colleagues.

### How to use it
1. Enter the name(s) of the person/people you're recognizing
2. Describe what you're calling out (achievement, behavior, milestone)
3. Select one or more tones that fit the occasion
4. Click **Generate Messages** for multiple options

### Use cases
- Peer recognition and kudos
- Team milestone celebrations
- Work anniversary messages
- Project completion shoutouts
- Thank you notes`,inputs:[{id:"recipients",label:"\u{1F464} Who is this for?",type:"textarea",placeholder:'Enter name(s) - e.g., "Sarah" or "The DevOps Team" or "Mike, Lisa, and Raj"',required:!0},{id:"occasion",label:"\u{1F3AF} What are we celebrating?",type:"select",options:[{value:"achievement",label:"\u{1F3C6} Achievement / Milestone"},{value:"teamwork",label:"\u{1F91D} Great Teamwork"},{value:"helping",label:"\u{1F4AA} Going Above & Beyond"},{value:"innovation",label:"\u{1F4A1} Innovation / Great Idea"},{value:"delivery",label:"\u{1F680} Successful Delivery"},{value:"anniversary",label:"\u{1F382} Work Anniversary"},{value:"welcome",label:"\u{1F44B} Welcome to Team"},{value:"farewell",label:"\u{1F44B} Farewell / Best Wishes"},{value:"thankyou",label:"\u{1F64F} Thank You"},{value:"other",label:"\u270D\uFE0F Other (describe below)"}],defaultValue:"achievement"},{id:"details",label:"\u{1F4DD} Details / Context",type:"textarea",placeholder:'What specifically did they do? Any background or details to include? (e.g., "Led the migration to the new platform ahead of schedule despite challenges")',required:!0},{id:"tones",label:"\u{1F3A8} Tone (select all that apply)",type:"checkbox-group",options:[{value:"professional",label:"\u{1F4BC} Professional"},{value:"warm",label:"\u2764\uFE0F Warm & Heartfelt"},{value:"funny",label:"\u{1F604} Funny / Light"},{value:"inspiring",label:"\u2728 Inspiring"},{value:"casual",label:"\u{1F642} Casual / Friendly"},{value:"formal",label:"\u{1F4DC} Formal"},{value:"enthusiastic",label:"\u{1F389} Enthusiastic"},{value:"sincere",label:"\u{1F4AF} Sincere & Genuine"}],defaultValue:"professional,warm"},{id:"length",label:"\u{1F4CF} Message Length",type:"radio",options:[{value:"short",label:"Short (1-2 sentences)",description:"Quick kudos"},{value:"medium",label:"Medium (3-4 sentences)",description:"Standard recognition"},{value:"long",label:"Long (paragraph)",description:"Detailed appreciation"}],defaultValue:"medium"},{id:"count",label:"\u{1F522} How many options?",type:"select",options:[{value:"3",label:"3 variations"},{value:"5",label:"5 variations"},{value:"7",label:"7 variations"}],defaultValue:"3"}],systemPrompt:`You are an expert at crafting recognition messages and eCards. Your messages are genuine, impactful, and memorable.

CRITICAL RULES:
1. Output ONLY plain text - no markdown, no formatting, no asterisks, no headers
2. Generate the EXACT number of variations requested
3. Each variation should feel distinct - different opening, structure, and emphasis
4. Keep the specified length strictly
5. Blend ALL selected tones naturally together

For each message:
- Start differently (don't always start with "I want to..." or "Congratulations...")
- Be specific about the achievement when details are provided
- Make it feel personal and genuine, not generic
- Avoid corporate jargon and clich\xE9s when possible
- If "funny" is selected, add tasteful humor that's workplace-appropriate

Format your response as numbered messages, each separated by a blank line:

1. [First message]

2. [Second message]

3. [Third message]

(and so on for the requested count)`,buildUserPrompt:t=>{let e=Array.isArray(t.tones)?t.tones.join(", "):t.tones;return`Generate ${t.count} recognition messages.

Recipient(s): ${t.recipients}
Occasion: ${t.occasion}
Details: ${t.details}
Tones to blend: ${e}
Length: ${t.length}

Remember: Plain text only, no markdown. Make each variation unique and memorable.`},parseResponse:t=>{let r=t.split(/\n\n(?=\d+\.)/).map((n,o)=>({title:`Option ${o+1}`,content:n.replace(/^\d+\.\s*/,"").trim()}));return{type:"sections",content:t,sections:r.length>0?r:[{title:"Messages",content:t}]}}}});var WJ={};ve(WJ,{emailResponseHelperApp:()=>y_e});var y_e,ZJ=x(()=>{"use strict";y_e={id:"email-response-helper",name:"Email Response Helper",description:"Get help responding to tricky emails you don't know how to answer",icon:"\u{1F4E7}",category:"communication",primaryAction:"\u2728 Generate Responses",helpDocumentation:`### What is this?
The **Email Response Helper** helps you craft the perfect response to emails that leave you stumped - whether it's a difficult request, awkward situation, or you just don't know what to say.

### How to use it
1. Paste the email you received
2. Tell us what kind of response you want to send
3. Add any context or constraints
4. Get multiple response options to choose from

### Use cases
- Declining requests politely
- Responding to vague or confusing emails
- Handling difficult conversations
- Navigating office politics
- Buying time when you need to think`,inputs:[{id:"originalEmail",label:"\u{1F4E5} Paste the email you need to respond to",type:"textarea",placeholder:"Paste the full email here... (You can include the whole thread if helpful)",required:!0},{id:"responseIntent",label:"\u{1F3AF} What do you want to achieve?",type:"select",options:[{value:"accept",label:"\u2705 Accept / Agree"},{value:"decline",label:"\u274C Decline / Say No"},{value:"delay",label:"\u23F0 Buy Time / Delay"},{value:"clarify",label:"\u2753 Ask for Clarification"},{value:"escalate",label:"\u2B06\uFE0F Escalate / Loop Someone In"},{value:"apologize",label:"\u{1F64F} Apologize"},{value:"pushback",label:"\u{1F6E1}\uFE0F Push Back / Set Boundaries"},{value:"delegate",label:"\u27A1\uFE0F Redirect / Delegate"},{value:"neutral",label:"\u{1F610} Neutral Acknowledgement"},{value:"other",label:"\u270D\uFE0F Other (describe below)"}],defaultValue:"decline"},{id:"additionalContext",label:"\u{1F4DD} Additional context (optional)",type:"textarea",placeholder:`Any background info, constraints, or specific points to include? (e.g., "I actually can't do this because of project X deadline" or "I need to sound firm but not rude")`},{id:"tone",label:"\u{1F3A8} Tone",type:"checkbox-group",options:[{value:"professional",label:"\u{1F4BC} Professional"},{value:"friendly",label:"\u{1F642} Friendly"},{value:"firm",label:"\u{1F6E1}\uFE0F Firm"},{value:"diplomatic",label:"\u{1F91D} Diplomatic"},{value:"empathetic",label:"\u2764\uFE0F Empathetic"},{value:"brief",label:"\u26A1 Brief / Direct"},{value:"formal",label:"\u{1F4DC} Formal"},{value:"casual",label:"\u{1F44B} Casual"}],defaultValue:"professional,friendly"},{id:"length",label:"\u{1F4CF} Response Length",type:"radio",options:[{value:"short",label:"Short (2-3 sentences)",description:"Quick and direct"},{value:"medium",label:"Medium (1 paragraph)",description:"Standard email"},{value:"long",label:"Long (multiple paragraphs)",description:"Detailed explanation"}],defaultValue:"medium"},{id:"count",label:"\u{1F522} How many options?",type:"select",options:[{value:"3",label:"3 variations"},{value:"5",label:"5 variations"}],defaultValue:"3"}],systemPrompt:`You are an expert at crafting email responses for difficult or awkward situations. You help people respond when they don't know what to say.

CRITICAL RULES:
1. Output ONLY plain text - no markdown, no formatting, no asterisks, no headers
2. Generate the EXACT number of variations requested
3. Each variation should take a different approach - different opening, different framing, different emphasis
4. Keep the specified length strictly
5. Blend ALL selected tones naturally together
6. Make responses feel natural and human, not robotic

Read the original email carefully and craft responses that:
- Address the core issue appropriately
- Match the requested intent (accept, decline, delay, etc.)
- Feel authentic and appropriate for workplace communication
- Don't sound AI-generated or templated

Format your response as numbered options, each separated by a blank line:

1. [First response option]

2. [Second response option]

3. [Third response option]

(and so on for the requested count)`,buildUserPrompt:t=>{let e=Array.isArray(t.tone)?t.tone.join(", "):t.tone;return`Generate ${t.count} email response options.

ORIGINAL EMAIL TO RESPOND TO:
---
${t.originalEmail}
---

Response Goal: ${t.responseIntent}
${t.additionalContext?`Additional Context: ${t.additionalContext}`:""}
Tone: ${e}
Length: ${t.length}

Remember: Plain text only, no markdown. Make each response feel genuine and natural. Each variation should take a slightly different approach.`},parseResponse:t=>{let r=t.split(/\n\n(?=\d+\.)/).map((n,o)=>({title:`Option ${o+1}`,content:n.replace(/^\d+\.\s*/,"").trim()}));return{type:"sections",content:t,sections:r.length>0?r:[{title:"Responses",content:t}]}}}});var KJ={};ve(KJ,{brainstormingPartnerApp:()=>v_e});var v_e,JJ=x(()=>{"use strict";v_e={id:"brainstorming-partner",name:"Brainstorming Partner",description:"Explore ideas and get creative suggestions",icon:"\u{1F4A1}",category:"inspiration",primaryAction:"\u{1F9E0} Brainstorm",helpDocumentation:`### What is this?
The **Brainstorming Partner** is your creative thinking companion. Share a problem or idea, and get diverse perspectives, alternative approaches, and creative suggestions.

### How to use it
1. Describe the problem, idea, or topic you want to explore.
2. Select the type of brainstorming you want.
3. Click **Brainstorm** to generate ideas.

### Use cases
- Exploring new project ideas
- Finding creative solutions to problems
- Breaking through writer's or designer's block
- Planning features and roadmaps`,inputs:[{id:"topic",label:"What do you want to brainstorm?",type:"textarea",placeholder:`e.g., Ways to improve user onboarding for our app

Or: Name ideas for a new productivity tool

Or: How might we reduce meeting fatigue?`,required:!0,rows:4,hint:"Be specific about what you're trying to solve or explore"},{id:"style",label:"Brainstorming Style",type:"radio",options:[{value:"divergent",label:"Divergent (Many Ideas)",description:"Quantity over quality, wild ideas welcome"},{value:"convergent",label:"Convergent (Focused)",description:"Fewer, more refined ideas"},{value:"sixhats",label:"Six Thinking Hats",description:"Multiple perspectives approach"},{value:"scamper",label:"SCAMPER",description:"Substitute, Combine, Adapt, Modify, Put to other uses, Eliminate, Reverse"}],defaultValue:"divergent"},{id:"constraints",label:"Constraints (optional)",type:"text",placeholder:"e.g., Low budget, 2-week timeline, must work on mobile",hint:"Constraints can actually spark creativity"}],systemPrompt:`You are a creative thinking partner and innovation facilitator. Help the user explore ideas with enthusiasm and constructive suggestions.

Guidelines:
- Generate diverse, actionable ideas
- Challenge assumptions
- Build on ideas ("Yes, and..." approach)
- Include a few "wild card" creative ideas
- Organize ideas by theme or feasibility
- End with next steps or questions to explore

For Six Thinking Hats, cover: Facts (White), Emotions (Red), Caution (Black), Benefits (Yellow), Creativity (Green), Process (Blue).

Keep the energy positive and exploratory!`,buildUserPrompt:t=>{let e=`Let's brainstorm: ${t.topic}

Style: ${t.style}`;return t.constraints?.trim()&&(e+=`
Constraints: ${t.constraints}`),e},parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Ideas",content:t}]})}});var YJ={};ve(YJ,{promptExplorerApp:()=>b_e});var b_e,QJ=x(()=>{"use strict";b_e={id:"prompt-explorer",name:"Prompt Explorer",description:"Generate effective prompts for AI tools",icon:"\u{1F52E}",category:"inspiration",primaryAction:"\u2728 Generate Prompts",helpDocumentation:`### What is this?
The **Prompt Explorer** helps you craft better prompts for AI tools like ChatGPT, Midjourney, Claude, and more. Get optimized prompts that deliver better results.

### How to use it
1. Describe what you want the AI to do.
2. Select the target AI tool.
3. Click **Generate Prompts** to get optimized prompt variations.

### Use cases
- Writing effective prompts for code generation
- Creating detailed image generation prompts
- Improving AI writing assistant outputs
- Learning prompt engineering techniques`,inputs:[{id:"goal",label:"What do you want the AI to do?",type:"textarea",placeholder:`e.g., Write a marketing email for a product launch

Or: Generate an image of a futuristic city

Or: Help me debug a React component`,required:!0,rows:3,hint:"Be specific about your desired outcome"},{id:"targetAi",label:"Target AI Tool",type:"select",options:[{value:"chatgpt",label:"ChatGPT / GPT-4"},{value:"claude",label:"Claude"},{value:"copilot",label:"GitHub Copilot"},{value:"midjourney",label:"Midjourney"},{value:"dalle",label:"DALL-E"},{value:"stable-diffusion",label:"Stable Diffusion"},{value:"general",label:"General Purpose"}],defaultValue:"general"},{id:"style",label:"Prompt Style",type:"radio",options:[{value:"simple",label:"Simple & Direct",description:"Clear, straightforward prompts"},{value:"detailed",label:"Detailed & Structured",description:"With context, examples, constraints"},{value:"chain",label:"Chain of Thought",description:"Step-by-step reasoning approach"}],defaultValue:"detailed"}],systemPrompt:`You are an expert prompt engineer. Create optimized prompts that get the best results from AI tools.

Generate 3-4 prompt variations, from simple to advanced:
1. **Basic Prompt**: Quick, direct approach
2. **Structured Prompt**: With context and constraints
3. **Expert Prompt**: Using advanced techniques (few-shot, chain-of-thought, etc.)

For each prompt:
- Show the actual prompt text in a code block
- Add a brief note on when to use it
- Include any variables/placeholders in [brackets]

Also include tips specific to the target AI tool.`,buildUserPrompt:t=>`Create ${t.style} prompts for ${t.targetAi} to accomplish:

${t.goal}`,parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Prompt Ideas",content:t}]})}});var XJ={};ve(XJ,{dailyInspirationApp:()=>__e});var __e,eY=x(()=>{"use strict";__e={id:"daily-inspiration",name:"Daily Inspiration",description:"Get a motivational quote with meaningful context",icon:"\u{1F31F}",category:"inspiration",primaryAction:"\u{1F4AB} Inspire Me",helpDocumentation:`### What is this?
The **Daily Inspiration** app delivers curated motivational quotes with context and reflection prompts to start your day on a positive note.

### How to use it
1. Select a theme that resonates with your current needs.
2. Choose how you'd like the quote presented.
3. Click **Inspire Me** for your dose of motivation.

### Use cases
- Starting your workday with a positive mindset
- Finding motivation during challenging projects
- Team meeting openers
- Personal reflection and journaling`,inputs:[{id:"theme",label:"What kind of inspiration?",type:"select",options:[{value:"general",label:"\u2728 General Motivation"},{value:"productivity",label:"\u26A1 Productivity & Focus"},{value:"creativity",label:"\u{1F3A8} Creativity & Innovation"},{value:"leadership",label:"\u{1F451} Leadership & Growth"},{value:"resilience",label:"\u{1F4AA} Resilience & Perseverance"},{value:"teamwork",label:"\u{1F91D} Teamwork & Collaboration"},{value:"tech",label:"\u{1F4BB} Tech & Engineering"},{value:"surprise",label:"\u{1F3B2} Surprise Me"}],defaultValue:"surprise"},{id:"style",label:"Quote Style",type:"radio",options:[{value:"classic",label:"Classic",description:"Timeless wisdom from notable figures"},{value:"modern",label:"Modern",description:"Contemporary voices and insights"},{value:"tech",label:"Tech World",description:"From innovators and builders"},{value:"unexpected",label:"Unexpected",description:"From unlikely sources"}],defaultValue:"classic"},{id:"context",label:"Current Situation (optional)",type:"text",placeholder:"e.g., Feeling stuck on a project, Starting a new role",hint:"For more relevant inspiration"}],systemPrompt:`You are a thoughtful curator of wisdom and inspiration. Provide meaningful quotes with context that resonates.

Format:
## \u{1F4AC} [The Quote]
\u2014 [Author], [Brief context about who they are]

### \u{1F331} Why This Matters
[2-3 sentences connecting the quote to work, creativity, or personal growth]

### \u{1F4AD} Reflection
[A thought-provoking question based on the quote]

### \u26A1 Today's Challenge
[A simple, actionable way to apply this wisdom today]

Select real, accurate quotes. Avoid misattributed or made-up quotes.`,buildUserPrompt:t=>{let e=`Give me a ${t.style} inspirational quote about ${t.theme}.`;return t.context?.trim()&&(e+=` Context: ${t.context}`),e},parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Inspiration",content:t}]})}});var tY={};ve(tY,{rubberDuckTherapistApp:()=>w_e});var w_e,rY=x(()=>{"use strict";w_e={id:"rubber-duck-therapist",name:"Rubber Duck Therapist",description:"Talk through problems with a supportive listener",icon:"\u{1F986}",category:"wellness",primaryAction:"\u{1F4AC} Start Talking",helpDocumentation:`### What is this?
The **Rubber Duck Therapist** is a supportive conversation partner. Based on the "rubber duck debugging" technique, it helps you talk through problems, gain clarity, and feel heard.

### \u26A0\uFE0F Important Note
This is NOT a replacement for professional mental health support. If you're struggling with serious issues, please reach out to a qualified professional.

### How to use it
1. Share what's on your mind\u2014work stress, a decision you're facing, or just need to vent.
2. The duck will listen, ask clarifying questions, and help you think it through.
3. Continue the conversation as long as you need.

### Use cases
- Working through frustrating problems
- Making difficult decisions
- Decompressing after a tough day
- Gaining perspective on challenges`,inputs:[{id:"thoughts",label:"What's on your mind?",type:"textarea",placeholder:"Share whatever you're thinking about. This is a safe space to express yourself...",required:!0,rows:6,hint:"Be as open as you feel comfortable. Everything stays here."},{id:"support",label:"What would help most?",type:"radio",options:[{value:"listen",label:"\u{1F442} Just Listen",description:"Validate and understand"},{value:"questions",label:"\u2753 Ask Questions",description:"Help me think it through"},{value:"perspective",label:"\u{1F52E} New Perspective",description:"Offer alternative viewpoints"},{value:"action",label:"\u26A1 Action Ideas",description:"Help me figure out next steps"}],defaultValue:"questions"}],systemPrompt:`You are a supportive, empathetic listener (the "rubber duck therapist"). Your role is to help the user process their thoughts and feelings.

Guidelines:
- Be warm, supportive, and non-judgmental
- Don't give medical or psychological advice
- Use active listening techniques (reflect, validate, clarify)
- Ask open-ended questions to help them explore
- Acknowledge emotions before offering perspective
- Keep responses conversational, not clinical
- Use gentle humor when appropriate (you ARE a duck \u{1F986})

IMPORTANT: If someone expresses serious mental health concerns or thoughts of self-harm, provide appropriate resources and encourage professional support.

Start with warmth, end with gentle encouragement.`,buildUserPrompt:t=>`Mode: ${t.support}

${t.thoughts}`,parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Response",content:t}]})}});var nY={};ve(nY,{gratitudeJournalApp:()=>x_e});var x_e,oY=x(()=>{"use strict";x_e={id:"gratitude-journal",name:"Gratitude Journal",description:"Reflect on positive moments with guided prompts",icon:"\u{1F64F}",category:"wellness",primaryAction:"\u270D\uFE0F Reflect",helpDocumentation:`### What is this?
The **Gratitude Journal** provides guided prompts to help you reflect on positive moments, boosting your mood and well-being through the practice of gratitude.

### How to use it
1. Choose a reflection style that suits your mood.
2. Optionally share something specific you're grateful for.
3. Click **Reflect** for personalized gratitude prompts and insights.

### Use cases
- Starting or ending your workday positively
- Building a daily gratitude practice
- Shifting perspective during stressful times
- Team gratitude exercises`,inputs:[{id:"something",label:"Something on your mind? (optional)",type:"textarea",placeholder:"Share something you're grateful for, or leave blank for fresh prompts...",rows:3,hint:"Big or small\u2014all gratitude matters"},{id:"focus",label:"Focus Area",type:"select",options:[{value:"general",label:"\u{1F308} Open Reflection"},{value:"work",label:"\u{1F4BC} Work & Career"},{value:"people",label:"\u2764\uFE0F Relationships & People"},{value:"growth",label:"\u{1F331} Personal Growth"},{value:"simple",label:"\u2600\uFE0F Simple Pleasures"},{value:"challenges",label:"\u{1F4AA} Challenges Overcome"}],defaultValue:"general"},{id:"depth",label:"Reflection Depth",type:"radio",options:[{value:"quick",label:"Quick",description:"1-2 minute reflection"},{value:"deep",label:"Deep",description:"Thoughtful exploration"}],defaultValue:"quick"}],systemPrompt:`You are a gentle, thoughtful journaling companion helping someone practice gratitude.

For quick reflections:
- 3 simple gratitude prompts
- Brief affirmation

For deep reflections:
- Acknowledge what they shared (if anything)
- 3 thoughtful prompts with context
- A "reframe" prompt (finding silver linings)
- Closing reflection or affirmation

Guidelines:
- Be warm but not overly enthusiastic
- Focus on specificity (specific > general gratitude)
- Include sensory details when helpful
- Don't lecture about the benefits of gratitude
- Make it feel natural, not forced

Use gentle formatting with emojis sparingly.`,buildUserPrompt:t=>{let e=`Create ${t.depth} gratitude prompts focused on ${t.focus}.`;return t.something?.trim()&&(e+=`

They shared: ${t.something}`),e},parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Gratitude Reflection",content:t}]})}});var iY={};ve(iY,{focusMindfulnessApp:()=>S_e});var S_e,sY=x(()=>{"use strict";S_e={id:"focus-mindfulness",name:"Focus & Mindfulness",description:"Quick guided breathing or focus exercises",icon:"\u{1F9D8}",category:"wellness",primaryAction:"\u{1F32C}\uFE0F Start Exercise",helpDocumentation:`### What is this?
The **Focus & Mindfulness** app provides quick mental reset exercises to help you regain focus, reduce stress, or prepare for important tasks.

### How to use it
1. Select the type of exercise you need.
2. Choose how much time you have.
3. Click **Start Exercise** for a guided session.

### Use cases
- Mental reset before a big meeting
- Decompression after intense focus work
- Starting the day with intention
- Breaking out of an afternoon slump`,inputs:[{id:"exerciseType",label:"What do you need?",type:"radio",options:[{value:"breathing",label:"\u{1F32C}\uFE0F Breathing Exercise",description:"Calm your nervous system"},{value:"focus",label:"\u{1F3AF} Focus Reset",description:"Sharpen concentration"},{value:"energy",label:"\u26A1 Energy Boost",description:"Shake off sluggishness"},{value:"calm",label:"\u{1F60C} Stress Relief",description:"Release tension"},{value:"transition",label:"\u{1F6AA} Work Transition",description:"Shift between tasks/contexts"}],defaultValue:"breathing"},{id:"duration",label:"How much time?",type:"select",options:[{value:"1",label:"1 minute (super quick)"},{value:"3",label:"3 minutes (short break)"},{value:"5",label:"5 minutes (proper reset)"}],defaultValue:"3"},{id:"style",label:"Guidance Style",type:"radio",options:[{value:"gentle",label:"Gentle",description:"Soft, calming instructions"},{value:"direct",label:"Direct",description:"Clear, efficient guidance"}],defaultValue:"gentle"}],systemPrompt:`You are a mindfulness guide providing quick, effective exercises for busy professionals.

Create an exercise that fits the requested duration. Structure:
1. **Setup** (10-15 seconds read time)
   - What position to take
   - What to do with eyes/hands
   
2. **The Exercise** (main content)
   - Step-by-step guidance
   - Use time cues ("For the next 30 seconds...")
   - For breathing: specific patterns (e.g., 4-7-8)
   
3. **Return** (10 seconds)
   - Gentle return to activity
   - One-line intention or reminder

Guidelines:
- Be concise\u2014this is for busy people
- Use formatting for easy scanning
- Include physical cues (body awareness)
- No spiritual/religious language
- End on an empowering note

Format with clear steps, using numbers or bullet points.`,buildUserPrompt:t=>`Create a ${t.duration}-minute ${t.exerciseType} exercise. Style: ${t.style}.`,parseResponse:t=>({type:"markdown",content:t,sections:[{title:"Exercise",content:t}]})}});var aY={};ve(aY,{storyChainApp:()=>k_e});var k_e,cY=x(()=>{"use strict";k_e={id:"story-chain",name:"Story Chain",icon:"\u{1F3AD}",description:"Collaborative storytelling with AI plot twists",category:"games",tags:["team","creative","storytelling","fun"],inputs:[{id:"genre",label:"Story Genre",type:"radio",required:!0,defaultValue:"fantasy",options:[{value:"fantasy",label:"\u{1F9D9} Fantasy",description:"Magic, dragons, quests"},{value:"scifi",label:"\u{1F680} Sci-Fi",description:"Space, tech, future"},{value:"mystery",label:"\u{1F50D} Mystery",description:"Clues, suspense, twists"},{value:"comedy",label:"\u{1F602} Comedy",description:"Silly, absurd, fun"},{value:"horror",label:"\u{1F47B} Horror",description:"Spooky, tense, creepy"}]},{id:"mode",label:"Game Mode",type:"radio",required:!0,defaultValue:"collaborative",options:[{value:"collaborative",label:"\u{1F91D} Collaborative",description:"You write, AI continues"},{value:"challenge",label:"\u2694\uFE0F Challenge",description:"AI tries to stump you with plot twists"}]},{id:"opening",label:"Story Opening (or leave blank for AI start)",type:"textarea",placeholder:'e.g., "The old lighthouse keeper had never seen anything like it..."',rows:3},{id:"rounds",label:"Number of Rounds",type:"select",defaultValue:"5",options:[{value:"3",label:"3 rounds (Quick)"},{value:"5",label:"5 rounds (Standard)"},{value:"10",label:"10 rounds (Epic)"}]}],primaryAction:"\u{1F4D6} Begin Story",systemPrompt:`You are a collaborative storytelling AI for a fun team game called "Story Chain".

Your role is to:
1. Continue the story based on player contributions
2. Maintain narrative continuity and character consistency
3. Add unexpected but logical plot twists
4. Keep the tone matching the chosen genre
5. End each turn with a hook that invites the next contribution

GENRE STYLES:
- Fantasy: Rich descriptions, magical elements, heroic moments
- Sci-Fi: Technical details, futuristic concepts, exploration themes
- Mystery: Suspense building, clue dropping, red herrings
- Comedy: Absurd situations, wordplay, unexpected humor
- Horror: Atmospheric tension, creeping dread, jump scares

FORMAT YOUR RESPONSE:

---STORY_CONTINUATION---
[Your 2-3 paragraphs continuing the story]

---TWIST---
[A short, surprising twist or cliffhanger to end on]

---PROMPT---
[An engaging question or prompt for the next player, like "What does our hero discover behind the door?"]`,buildUserPrompt:t=>{let e=t.genre||"fantasy",r=t.mode||"collaborative",n=t.opening?.trim(),o=t.rounds||"5";return n?`GENRE: ${e.toUpperCase()}
MODE: ${r}
TOTAL ROUNDS: ${o}

The player has started the story with:
"${n}"

Please continue this story with 2-3 paragraphs, add a twist, and provide a prompt for the next contribution.`:`GENRE: ${e.toUpperCase()}
MODE: ${r}
TOTAL ROUNDS: ${o}

Please START a brand new ${e} story with an engaging opening (2-3 paragraphs), introduce the main character(s), add an early twist or hook, and provide a prompt for the player to continue.`}}});var lY={};ve(lY,{triviaShowdownApp:()=>A_e});var A_e,uY=x(()=>{"use strict";A_e={id:"trivia-showdown",name:"Trivia Showdown",icon:"\u{1F9E0}",description:"Endless trivia on any topic - test your knowledge!",category:"games",tags:["team","trivia","knowledge","competitive"],inputs:[{id:"topic",label:"Trivia Topic",type:"text",required:!0,placeholder:"e.g., 90s Movies, World Geography, Programming Languages...",hint:"Be specific for better questions!"},{id:"difficulty",label:"Difficulty Level",type:"radio",required:!0,defaultValue:"medium",options:[{value:"easy",label:"\u{1F7E2} Easy",description:"Warm-up questions"},{value:"medium",label:"\u{1F7E1} Medium",description:"Challenging but fair"},{value:"hard",label:"\u{1F534} Hard",description:"Expert level"},{value:"impossible",label:"\u{1F480} Impossible",description:"Good luck!"}]},{id:"questionCount",label:"Number of Questions",type:"select",defaultValue:"5",options:[{value:"3",label:"3 Questions (Quick)"},{value:"5",label:"5 Questions (Standard)"},{value:"10",label:"10 Questions (Marathon)"}]},{id:"format",label:"Question Format",type:"radio",defaultValue:"multiple",options:[{value:"multiple",label:"\u{1F4DD} Multiple Choice",description:"4 options per question"},{value:"truefalse",label:"\u2705 True/False",description:"Quick fire!"}]}],primaryAction:"\u{1F3AF} Start Trivia",systemPrompt:`You are a trivia game master creating engaging quiz questions.

RULES:
1. Generate the requested number of questions on the specified topic
2. Match the difficulty level accurately
3. Make questions interesting and educational
4. For multiple choice: 1 correct answer + 3 plausible wrong answers
5. Include a fun fact after each answer
6. Shuffle answer order (don't always put correct first)

FORMAT YOUR RESPONSE EXACTLY LIKE THIS:

---QUESTION_1---
**Question:** [The question text]

A) [Option A]
B) [Option B]
C) [Option C]
D) [Option D]

<details>
<summary>\u{1F3AF} Reveal Answer</summary>

**Correct Answer:** [Letter]

**Fun Fact:** [An interesting related fact]
</details>

---QUESTION_2---
[Continue same format...]

At the end, add:
---FINAL_SCORE---
Rate yourself! How many did you get right?
\u{1F3C6} All correct = Trivia Champion!
\u2B50 Most correct = Strong showing!
\u{1F4DA} Some correct = Keep learning!`,buildUserPrompt:t=>{let e=t.topic||"General Knowledge",r=t.difficulty||"medium",n=t.questionCount||"5",o=t.format||"multiple";return`Generate ${n} ${r}-difficulty trivia questions about: "${e}"

Format: ${o==="multiple"?"Multiple choice with 4 options (A, B, C, D)":"True/False only"}

Make questions ${r==="easy"?"accessible for beginners":r==="hard"?"challenging for experts":r==="impossible"?"incredibly obscure - only specialists would know":"moderately challenging"}.

Remember to:
- Make wrong answers plausible (not obviously wrong)
- Add fun facts that teach something new
- Keep a playful, game-show host tone`}}});var dY={};ve(dY,{captionBattleApp:()=>$_e});var $_e,pY=x(()=>{"use strict";$_e={id:"caption-battle",name:"Caption Battle",icon:"\u{1F3A8}",description:"Write hilarious captions for AI-generated scenarios",category:"games",tags:["team","creative","funny","party"],inputs:[{id:"vibe",label:"Caption Vibe",type:"radio",required:!0,defaultValue:"absurd",options:[{value:"absurd",label:"\u{1F92A} Absurd",description:"Weird and wacky"},{value:"wholesome",label:"\u{1F970} Wholesome",description:"Heartwarming humor"},{value:"corporate",label:"\u{1F4BC} Corporate",description:"Office humor"},{value:"dark",label:"\u{1F311} Dark",description:"Edgy comedy"},{value:"random",label:"\u{1F3B2} Random",description:"Anything goes!"}]},{id:"scenarioCount",label:"Number of Scenarios",type:"select",defaultValue:"3",options:[{value:"1",label:"1 Scenario (Quick)"},{value:"3",label:"3 Scenarios (Standard)"},{value:"5",label:"5 Scenarios (Party Mode)"}]},{id:"theme",label:"Optional Theme",type:"text",placeholder:"e.g., Cats, Space, Monday mornings...",hint:"Leave blank for random scenarios"}],primaryAction:"\u{1F3AC} Generate Scenarios",systemPrompt:`You are the host of a hilarious party game called "Caption Battle"!

Your job is to create absurd, funny scenarios that players will write captions for.

SCENARIO STYLES:
- Absurd: Completely ridiculous situations that defy logic
- Wholesome: Sweet but funny misunderstandings
- Corporate: Office life taken to extremes
- Dark: Edgy humor (but nothing offensive)
- Random: Mix of everything

IMPORTANT:
1. Describe visual scenarios vividly - paint a picture with words
2. Include unexpected elements that beg for funny commentary
3. Keep scenarios universally relatable
4. End each scenario with a prompt for caption writers

FORMAT YOUR RESPONSE:

---SCENARIO_1---
# \u{1F3AC} Scene 1

**The Scene:**
[Vivid 2-3 sentence description of the scenario. Be specific and paint a picture!]

**The Details:**
[One or two absurd additional details that make it funnier]

\u{1F4AC} **Your Caption:** _____________________

---SCENARIO_2---
[Same format...]

---TIPS---
\u{1F3C6} **Winning Caption Tips:**
- Subvert expectations
- Add a twist ending
- Reference something unexpected
- Keep it punchy!`,buildUserPrompt:t=>{let e=t.vibe||"absurd",r=t.scenarioCount||"3",n=t.theme?.trim();return`Generate ${r} ${e} scenarios for Caption Battle.

${n?`Theme to incorporate: "${n}"`:"Use completely random themes."}

Each scenario should:
1. Be vividly described so players can "see" it
2. Have at least one absurd or unexpected element
3. Be perfect for writing funny one-liners about
4. Work for a diverse team audience (SFW)

Make them genuinely funny and caption-worthy!`}}});var fY={};ve(fY,{debateArenaApp:()=>P_e});var P_e,mY=x(()=>{"use strict";P_e={id:"debate-arena",name:"Debate Arena",icon:"\u2694\uFE0F",description:"Defend random hot takes - AI judges your arguments",category:"games",tags:["team","debate","thinking","competitive"],inputs:[{id:"category",label:"Debate Category",type:"radio",required:!0,defaultValue:"tech",options:[{value:"tech",label:"\u{1F4BB} Tech Wars",description:"Tabs vs spaces, etc."},{value:"food",label:"\u{1F355} Food Fights",description:"Pineapple on pizza?"},{value:"life",label:"\u{1F30D} Life Choices",description:"Morning person vs night owl"},{value:"work",label:"\u{1F4BC} Work Style",description:"Remote vs office"},{value:"random",label:"\u{1F3B2} Random",description:"Anything goes!"}]},{id:"mode",label:"Game Mode",type:"radio",required:!0,defaultValue:"solo",options:[{value:"solo",label:"\u{1F3A4} Solo",description:"You vs yourself - argue both sides!"},{value:"vsai",label:"\u{1F916} vs AI",description:"Debate against the AI"},{value:"prep",label:"\u{1F4DD} Prep Mode",description:"Get arguments for a 1v1 with a friend"}]},{id:"customTopic",label:"Custom Topic (Optional)",type:"text",placeholder:'e.g., "Cereal is a soup"',hint:"Leave blank for a random spicy take"}],primaryAction:"\u2694\uFE0F Enter the Arena",systemPrompt:`You are the host of "Debate Arena" - a fun debate game for teams!

Your job is to:
1. Generate or use a debate topic
2. Present both sides fairly
3. Provide compelling arguments for each position
4. Add humor and personality
5. Encourage friendly debate

TOPIC CATEGORIES:
- Tech Wars: Programming languages, tools, practices
- Food Fights: Culinary controversies
- Life Choices: Lifestyle debates
- Work Style: Professional preferences
- Random: Anything debatable!

FORMAT YOUR RESPONSE:

---TOPIC---
# \u2694\uFE0F Today's Debate

**The Motion:** "[State the debate topic as a motion]"

This is a {category} debate. Get ready to defend your position!

---SIDE_A---
## \u{1F535} Team PRO

**Position:** [Side that supports the motion]

**Key Arguments:**
1. **[Argument Title]** - [1-2 sentence explanation]
2. **[Argument Title]** - [1-2 sentence explanation]
3. **[Argument Title]** - [1-2 sentence explanation]

**Killer Closing Line:**
> "[A memorable one-liner to end your case]"

---SIDE_B---
## \u{1F534} Team CON

**Position:** [Side that opposes the motion]

**Key Arguments:**
1. **[Argument Title]** - [1-2 sentence explanation]
2. **[Argument Title]** - [1-2 sentence explanation]
3. **[Argument Title]** - [1-2 sentence explanation]

**Killer Closing Line:**
> "[A memorable one-liner to end your case]"

---JUDGE_NOTES---
## \u{1F3DB}\uFE0F Judge's Notes

**Common Pitfalls:**
- [Weak argument to avoid]
- [Logical fallacy warning]

**Bonus Points For:**
- [Creative angle that would impress]
- [Unexpected perspective]

*May the best arguer win!* \u2694\uFE0F`,buildUserPrompt:t=>{let e=t.category||"random",r=t.mode||"solo",n=t.customTopic?.trim();return n?`Create a debate setup for the custom topic: "${n}"

Category context: ${e}
Mode: ${r}

Provide arguments for BOTH sides fairly, with creative and fun angles.`:`Generate a fun, debatable topic from the "${e}" category.

The topic should be:
- Lighthearted but arguable
- Something people have genuine opinions on  
- Not actually controversial or offensive
- Perfect for friendly team debates

Mode: ${r}

Provide compelling arguments for BOTH sides!`}}});var T_e={};ve(T_e,{activate:()=>C_e,deactivate:()=>I_e});module.exports=I(T_e);var Ie=ct(require("vscode"));var rn=require("crypto"),$D=require("http"),FK=require("https"),Yl=ct(require("os")),P=ct(require("vscode")),kr=ct(require("fs")),Fr=ct(require("path"));var Oo=ct(require("fs")),iu=ct(require("path")),FD=ct(require("vscode")),mb=class{storageDir;writeQueue=[];flushInterval;FLUSH_MS=2e3;context;cachedLifetimeStats=null;dailyStatsCache=null;DAILY_STATS_CACHE_TTL_MS=3e4;constructor(e){this.context=e,this.storageDir=iu.join(e.globalStorageUri.fsPath,"audit_logs"),this.initAsync()}async initAsync(){await this.ensureStorageDir(),this.startPeriodicFlush(),this.cleanupOldLogs().catch(e=>console.error("Failed to cleanup old logs:",e))}async cleanupOldLogs(){let r=FD.workspace.getConfiguration("githubCopilotApi.audit").get("retentionDays",30);if(!(r<=0))try{let n=await Oo.promises.readdir(this.storageDir),o=Date.now(),i=r*24*60*60*1e3;for(let s of n){if(!s.startsWith("audit-")||!s.endsWith(".jsonl"))continue;let a=s.slice(6,-6),c=new Date(a).getTime();if(!isNaN(c)&&o-c>i){let l=iu.join(this.storageDir,s);await Oo.promises.unlink(l)}}}catch(n){console.error("Error cleaning up old audit logs:",n)}}async ensureStorageDir(){try{await Oo.promises.mkdir(this.storageDir,{recursive:!0})}catch(e){e.code!=="EEXIST"&&console.error("Failed to create audit storage dir:",e)}}async logRequest(e){this.writeQueue.push(e),this.cachedLifetimeStats&&(this.cachedLifetimeStats.totalRequests++,this.cachedLifetimeStats.totalTokensIn+=e.tokensIn||0,this.cachedLifetimeStats.totalTokensOut+=e.tokensOut||0,this.cachedLifetimeStats.totalRequests%10===0&&this.context.globalState.update("lifetimeStats",this.cachedLifetimeStats))}startPeriodicFlush(){this.flushInterval&&clearInterval(this.flushInterval),this.flushInterval=setInterval(()=>this.flush(),this.FLUSH_MS)}async flush(){if(this.writeQueue.length===0)return;let e=[...this.writeQueue];this.writeQueue=[];let r=new Map;for(let n of e){let o=n.timestamp.split("T")[0];r.has(o)||r.set(o,[]),r.get(o).push(n)}for(let[n,o]of r){let i=iu.join(this.storageDir,`audit-${n}.jsonl`),s=o.map(a=>JSON.stringify(a)).join(`
`)+`
`;try{await Oo.promises.appendFile(i,s,"utf8")}catch(a){console.error(`Failed to write audit logs for ${n}:`,a)}}}async getDailyStats(e=30){if(this.dailyStatsCache&&this.dailyStatsCache.days===e&&Date.now()-this.dailyStatsCache.timestamp<this.DAILY_STATS_CACHE_TTL_MS)return this.dailyStatsCache.data;let r=[],n=new Date;for(let i=0;i<e;i++){let s=new Date(n);s.setDate(s.getDate()-i);let a=s.toISOString().split("T")[0],c=iu.join(this.storageDir,`audit-${a}.jsonl`),l=!1;try{await Oo.promises.access(c),l=!0}catch{l=!1}if(l)try{let d=(await Oo.promises.readFile(c,"utf8")).trim().split(`
`),p=0,f=0,m=0,h=0,g=0,v=new Set;for(let b of d)if(b)try{let S=JSON.parse(b);p++,f+=S.durationMs,S.tokensIn&&(m+=S.tokensIn),S.tokensOut&&(h+=S.tokensOut),S.status>=400&&g++,S.ip&&v.add(S.ip)}catch{}r.push({date:a,totalRequests:p,avgLatency:p>0?Math.round(f/p):0,tokensIn:m,tokensOut:h,totalTokens:m+h,errorCount:g,uniqueIps:v.size})}catch(u){console.error(`Error reading log ${c}`,u)}else r.push({date:a,totalRequests:0,avgLatency:0,tokensIn:0,tokensOut:0,totalTokens:0,errorCount:0,uniqueIps:0})}let o=r.sort((i,s)=>i.date.localeCompare(s.date));return this.dailyStatsCache={data:o,timestamp:Date.now(),days:e},o}async getLogEntries(e=1,r=10){try{if(!Oo.existsSync(this.storageDir))return{total:0,entries:[]};let o=(await Oo.promises.readdir(this.storageDir)).filter(l=>l.startsWith("audit-")&&l.endsWith(".jsonl")).sort().reverse(),i=[];for(let l of o.slice(0,14))try{let u=await Oo.promises.readFile(iu.join(this.storageDir,l),"utf8"),d=[];u.split(`
`).forEach(p=>{if(p.trim())try{let f=JSON.parse(p);f&&f.timestamp&&d.push(f)}catch{}}),i=i.concat(d.reverse())}catch(u){console.error(`[AuditService] Error reading ${l}`,u)}i.sort((l,u)=>new Date(u.timestamp).getTime()-new Date(l.timestamp).getTime());let s=i.length,a=(e-1)*r,c=a+r;return{total:s,entries:i.slice(a,c)}}catch(n){return console.error("[AuditService] Failed to get logs:",n),{total:0,entries:[]}}}getLogFolderPath(){return this.storageDir}async getLifetimeStats(){if(this.cachedLifetimeStats)return this.cachedLifetimeStats;let e=this.context.globalState.get("lifetimeStats");if(e)return this.cachedLifetimeStats=e,e;let r=await this.getDailyStats(365);return this.cachedLifetimeStats=r.reduce((n,o)=>({totalRequests:n.totalRequests+o.totalRequests,totalTokensIn:n.totalTokensIn+o.tokensIn,totalTokensOut:n.totalTokensOut+o.tokensOut}),{totalRequests:0,totalTokensIn:0,totalTokensOut:0}),await this.context.globalState.update("lifetimeStats",this.cachedLifetimeStats),this.cachedLifetimeStats}dispose(){this.flushInterval&&(clearInterval(this.flushInterval),this.flush())}};var Lbe="GitHub.copilot-chat",Fbe="@id:GitHub.copilot-chat",ue=class extends Error{constructor(r,n,o,i,s){super(n);this.status=r;this.type=o;this.code=i;this.details=s;this.name="ApiError"}},Vbe=[{id:"ssn",name:"US Social Security",pattern:"\\b\\d{3}-\\d{2}-\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"credit-card",name:"Credit/Debit Card",pattern:"\\b(?:\\d{4}[- ]?){3}\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"aadhaar",name:"Aadhaar Number",pattern:"\\b\\d{4}\\s?\\d{4}\\s?\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"passport-in",name:"Indian Passport",pattern:"\\b[A-Z]\\d{7}\\b",enabled:!0,isBuiltin:!0},{id:"passport-us",name:"US Passport",pattern:"\\b\\d{9}\\b",enabled:!0,isBuiltin:!0},{id:"email",name:"Email Address",pattern:"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}",enabled:!0,isBuiltin:!0},{id:"url",name:"URLs",pattern:"https?://[^\\s]+",enabled:!0,isBuiltin:!0},{id:"phone-us",name:"US Phone Number",pattern:"\\b\\d{3}[-.]?\\d{3}[-.]?\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"phone-in",name:"Indian Phone",pattern:"\\b[6-9]\\d{9}\\b",enabled:!0,isBuiltin:!0},{id:"api-key",name:"API Keys",pattern:"(sk-[a-zA-Z0-9]{20,})|(api[_-]?key[=:]\\s*[\\w-]+)",enabled:!0,isBuiltin:!0},{id:"password-json",name:"Passwords in JSON",pattern:'"password"\\s*:\\s*"[^"]*"',enabled:!0,isBuiltin:!0},{id:"bearer-token",name:"Bearer Tokens",pattern:"Bearer\\s+[A-Za-z0-9\\-._~+/]+=*",enabled:!0,isBuiltin:!0}],oA=class{constructor(e,r,n){this.output=e;this.statusItem=r;this.context=n,this.auditService=new mb(n);let o=P.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("githubCopilotApi.server")){if(this.suppressRestart)return;this.restart().catch(s=>{this.logError("Failed to restart API server after configuration change",s)})}});this.disposables.push(o),this.initializeStats().catch(i=>console.error("Failed to initialize stats:",i)),setImmediate(()=>this.loadHistory())}httpServer;wsServer;disposables=[];config=LK();disposed=!1;activeRequests=0;isHttps=!1;suppressRestart=!1;_onDidChangeStatus=new P.EventEmitter;onDidChangeStatus=this._onDidChangeStatus.event;_onDidLogRequest=new P.EventEmitter;onDidLogRequest=this._onDidLogRequest.event;_onDidLogRequestStart=new P.EventEmitter;onDidLogRequestStart=this._onDidLogRequestStart.event;domainCache=new Map;domainRefreshInterval;usageStats={totalRequests:0,totalTokensIn:0,totalTokensOut:0,requestsByEndpoint:{},startTime:Date.now()};realtimeStats={requestsPerMinute:0,avgLatencyMs:0,latencyHistory:[],tokensPerMinute:0,errorRate:0,lastMinuteRequests:[],lastMinuteErrors:0};requestHistory=[];connections=new Set;isShuttingDown=!1;MAX_HISTORY_SIZE=100;context;rateLimitBucket=[];requestCache=new Map;CACHE_TTL_MS=5e3;statsInterval;activeConnectionsPerIp=new Map;auditService;mcpService;mcpInitPromise;async initializeStats(){try{let e=await this.auditService.getLifetimeStats();this.usageStats.totalRequests=e.totalRequests,this.usageStats.totalTokensIn=e.totalTokensIn,this.usageStats.totalTokensOut=e.totalTokensOut}catch(e){console.error("Failed to load lifetime stats:",e)}}async ensureMcpService(){if(P.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0))return this.mcpService?this.mcpService:(this.mcpInitPromise||(this.mcpInitPromise=(async()=>{let{McpService:r}=await Promise.resolve().then(()=>(BH(),qH));this.mcpService=new r(this.output),await this.mcpService.initialize()})()),await this.mcpInitPromise,this.mcpService)}async getStatus(){return{running:!!this.httpServer,isHttps:this.isHttps,config:this.config,activeRequests:this.activeRequests,networkInfo:this.getNetworkInfo(),stats:this.getStats(),realtimeStats:this.realtimeStats,historyCount:this.requestHistory.length,mcp:this.getMcpStatus(),copilot:await this.getCopilotHealth()}}async getCopilotHealth(){let e=P.extensions.all,r=e.find(s=>s.id.toLowerCase()==="github.copilot"||s.id.toLowerCase()==="github.copilot-nightly"||s.packageJSON?.publisher==="GitHub"&&s.packageJSON?.name==="copilot"),n=e.find(s=>s.id.toLowerCase()==="github.copilot-chat"||s.packageJSON?.publisher==="GitHub"&&s.packageJSON?.name==="copilot-chat"),o=!1;try{let s=await P.lm.selectChatModels({vendor:"copilot"});o=s&&s.length>0}catch{o=!1}return{installed:!!r||o,chatInstalled:!!n||o,signedIn:o,ready:o||!!r&&!!n&&o}}getMcpStatus(){return{enabled:P.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0),servers:this.mcpService?.getConnectedServers()??[],tools:this.mcpService?.getTools()??[]}}getStats(){return{...this.usageStats,uptimeMs:Date.now()-this.usageStats.startTime,avgLatencyMs:this.realtimeStats.avgLatencyMs,requestsPerMinute:this.realtimeStats.requestsPerMinute,errorRate:this.realtimeStats.errorRate,mcp:this.getMcpStatus()}}getHistory(e){let r=[...this.requestHistory].reverse();return e?r.slice(0,e):r}async getDailyStats(e){return this.auditService.getDailyStats(e)}async getAuditLogs(e,r){return this.auditService.getLogEntries(e,r)}getLogFolderPath(){return this.auditService.getLogFolderPath()}clearHistory(){this.requestHistory=[],this.saveHistory(),this._onDidChangeStatus.fire()}loadHistory(){if(!this.context)return;let e=this.context.globalState.get("requestHistory",[]);this.requestHistory=e.slice(-this.MAX_HISTORY_SIZE)}saveHistory(){this.context&&this.context.globalState.update("requestHistory",this.requestHistory.slice(-this.MAX_HISTORY_SIZE))}addHistoryEntry(e){let r=this.redactSensitiveData(e);this.requestHistory.push(r),this.requestHistory.length>this.MAX_HISTORY_SIZE&&(this.requestHistory=this.requestHistory.slice(-this.MAX_HISTORY_SIZE)),this.requestHistory.length%10===0&&this.saveHistory(),this._onDidChangeStatus.fire()}redactSensitiveData(e){let r=this.config.redactionPatterns.filter(i=>i.enabled);if(`${this.config.redactionPatterns.length}${r.length}`,!r.length)return e;let n=i=>{let s=i;for(let a of r)try{let c=new RegExp(a.pattern,"gi");s=s.replace(c,"[REDACTED]")}catch{}return s},o=i=>{if(typeof i=="string")return n(i);if(Array.isArray(i))return i.map(o);if(i&&typeof i=="object"){let s={};for(let[a,c]of Object.entries(i))s[a]=o(c);return s}return i};return o(e)}redactMessagesContent(e){let r=this.config.redactionPatterns.filter(o=>o.enabled);if(!r.length)return e;let n=o=>{let i=o;for(let s of r)try{let a=new RegExp(s.pattern,"gi");i=i.replace(a,"[REDACTED]")}catch{}return i};return e.map(o=>{let i=o.content;return typeof i=="string"?i=n(i):Array.isArray(i)&&(i=i.map(s=>typeof s=="string"?n(s):s&&typeof s=="object"&&typeof s.text=="string"?{...s,text:n(s.text)}:s)),{...o,content:i}})}redactPromptString(e){let r=this.config.redactionPatterns.filter(o=>o.enabled);if(!r.length)return e;let n=e;for(let o of r)try{let i=new RegExp(o.pattern,"gi");n=n.replace(i,"[REDACTED]")}catch{}return n}startStatsUpdater(){this.statsInterval=setInterval(()=>{this.updateRealtimeStats(),this._onDidChangeStatus.fire()},5e3)}startDomainCacheRefresh(){this.refreshDomainCache(),this.domainRefreshInterval=setInterval(()=>{this.refreshDomainCache()},300*1e3)}updateRealtimeStats(){let r=Date.now()-6e4;if(this.realtimeStats.latencyHistory=this.realtimeStats.latencyHistory.filter(n=>n.timestamp>r),this.realtimeStats.lastMinuteRequests=this.realtimeStats.lastMinuteRequests.filter(n=>n>r),this.realtimeStats.requestsPerMinute=this.realtimeStats.lastMinuteRequests.length,this.realtimeStats.latencyHistory.length>0){let n=this.realtimeStats.latencyHistory.reduce((o,i)=>o+i.latency,0);this.realtimeStats.avgLatencyMs=Math.round(n/this.realtimeStats.latencyHistory.length)}else this.realtimeStats.avgLatencyMs=0;this.realtimeStats.lastMinuteRequests.length>0?this.realtimeStats.errorRate=Math.round(this.realtimeStats.lastMinuteErrors/this.realtimeStats.lastMinuteRequests.length*100):this.realtimeStats.errorRate=0,this.realtimeStats.lastMinuteRequests.length===0&&(this.realtimeStats.lastMinuteErrors=0)}recordRequestStats(e,r,n,o){let i=Date.now();this.usageStats.totalRequests++,this.usageStats.totalTokensIn+=r,this.usageStats.totalTokensOut+=n,this.realtimeStats.lastMinuteRequests.push(i),this.realtimeStats.latencyHistory.push({timestamp:i,latency:e}),o&&this.realtimeStats.lastMinuteErrors++,this.realtimeStats.tokensPerMinute=Math.round((this.usageStats.totalTokensIn+this.usageStats.totalTokensOut)/Math.max(1,(i-this.usageStats.startTime)/6e4))}async addRedactionPattern(e,r){try{new RegExp(r);let n=this.config.redactionPatterns,i={id:`custom-${Date.now()}`,name:e,pattern:r,enabled:!0,isBuiltin:!1};return await this.updateServerConfig({redactionPatterns:[...n,i]}),!0}catch{return!1}}async removeRedactionPattern(e){let r=this.config.redactionPatterns.filter(n=>n.id!==e);await this.updateServerConfig({redactionPatterns:r})}async toggleRedactionPattern(e,r){let n=this.config.redactionPatterns.map(o=>o.id===e?{...o,enabled:r}:o);await this.updateServerConfig({redactionPatterns:n})}getRedactionPatterns(){return[...this.config.redactionPatterns]}async addIpAllowlistEntry(e){let r=e.trim();if(!r)return!1;let n=/^[\d\.\/]+$|^[\da-fA-F:\/]+$/.test(r),o=/^[a-zA-Z0-9]([a-zA-Z0-9\-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]*[a-zA-Z0-9])?)+$/.test(r);if(!n&&!o)return!1;let i=[...this.config.ipAllowlist,r];return await P.workspace.getConfiguration("githubCopilotApi").update("server.ipAllowlist",i,P.ConfigurationTarget.Global),!0}async removeIpAllowlistEntry(e){let r=this.config.ipAllowlist.filter(n=>n!==e);await this.updateServerConfig({ipAllowlist:r})}getNetworkInfo(){if(this.config.host!=="0.0.0.0")return null;let e=Yl.hostname(),r=[],n=Yl.networkInterfaces();for(let o of Object.keys(n)){let i=n[o];if(i)for(let s of i)!s.internal&&s.family==="IPv4"&&r.push(s.address)}return{hostname:e,localIPs:r}}async startServer(){await this.updateServerConfig({enabled:!0})}async stopServer(){await this.updateServerConfig({enabled:!1})}async toggleHttp(){await this.updateServerConfig({enableHttp:!this.config.enableHttp,enabled:!0})}async toggleWebSocket(){await this.updateServerConfig({enableWebSocket:!this.config.enableWebSocket,enabled:!0})}async toggleLogging(){await this.updateServerConfig({enableLogging:!this.config.enableLogging})}async toggleHttps(){await this.updateServerConfig({enableHttps:!this.config.enableHttps,enabled:!0})}async setApiKey(e){let r=(e??"").trim();await this.updateServerConfig({apiKey:r})}async setRateLimit(e){let r=Number.isFinite(e)?Math.max(0,Math.floor(e)):60;await this.updateServerConfig({rateLimitPerMinute:r})}getVersion(){return this.context?.extension.packageJSON.version||"0.0.1"}async setHost(e){let r=(e??"").trim();r&&await this.updateServerConfig({host:r,enabled:!0})}async setPort(e){let r=Number.isFinite(e)?Math.max(1,Math.min(65535,Math.floor(e))):this.config.port;await this.updateServerConfig({port:r,enabled:!0})}async toggleMcp(e){this.suppressRestart=!0,await P.workspace.getConfiguration("githubCopilotApi.mcp").update("enabled",e,P.ConfigurationTarget.Global),e&&await(await this.ensureMcpService())?.refreshServers(),this.config.mcpEnabled=e,this.suppressRestart=!1}async setDefaultModel(e){let r=(e??"").trim();r&&await this.updateServerConfig({defaultModel:r,enabled:!0})}async setRequestTimeout(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):180;await this.updateServerConfig({requestTimeoutSeconds:r})}async setMaxPayloadSize(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):1;await this.updateServerConfig({maxPayloadSizeMb:r})}async setMaxConnectionsPerIp(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):10;await this.updateServerConfig({maxConnectionsPerIp:r})}async setMaxConcurrency(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):4;await this.updateServerConfig({maxConcurrentRequests:r})}async start(){if(this.disposed)return;if(this.startStatsUpdater(),this.startDomainCacheRefresh(),await this.stop(),this.config=LK(),!this.config.enabled){this.updateStatusBar("stopped","Server disabled in settings"),this._onDidChangeStatus.fire();return}this.updateStatusBar("starting"),this._onDidChangeStatus.fire();let e=(o,i)=>{this.connections.add(i),i.on("close",()=>this.connections.delete(i));let s=Date.now(),a=(0,rn.randomUUID)().slice(0,8);this._onDidLogRequestStart.fire({requestId:a,method:o.method||"UNKNOWN",path:o.url||"/",timestamp:new Date().toISOString()}),this.handleHttpRequest(o,i,a,s).catch(c=>{let l=Date.now()-s;c instanceof ue?(this.logRequest(a,o.method||"UNKNOWN",o.url||"/",c.status,l,{error:c.message,requestHeaders:o.headers}),this.sendError(i,c)):(this.logRequest(a,o.method||"UNKNOWN",o.url||"/",500,l,{error:c instanceof Error?c.message:String(c),requestHeaders:o.headers}),this.logError("Unhandled error in HTTP request handler",c),this.sendError(i,new ue(500,"An unexpected error occurred.","server_error")))}).finally(()=>{this.activeRequests--,this._onDidChangeStatus.fire()}),this.activeRequests++,this._onDidChangeStatus.fire()},r=!1;if(this.config.enableHttps)try{let o=null;if(this.config.tlsCertPath&&this.config.tlsKeyPath){let i=this.config.tlsCertPath.startsWith("~")?Fr.join(Yl.homedir(),this.config.tlsCertPath.slice(1)):this.config.tlsCertPath,s=this.config.tlsKeyPath.startsWith("~")?Fr.join(Yl.homedir(),this.config.tlsKeyPath.slice(1)):this.config.tlsKeyPath;kr.existsSync(i)&&kr.existsSync(s)&&(o={cert:kr.readFileSync(i),key:kr.readFileSync(s)},this.logInfo(`HTTPS enabled with certificate from ${i}`))}if(!o){let i=E9(),s=[{name:"commonName",value:"localhost"}],a=i.generate(s,{days:365,keySize:2048,algorithm:"sha256"});o={cert:a.cert,key:a.private},this.logInfo("HTTPS enabled with auto-generated self-signed certificate (valid 365 days)")}this.httpServer=(0,FK.createServer)(o,e),r=!0}catch(o){this.logError("Failed to setup HTTPS, falling back to HTTP",o),this.httpServer=(0,$D.createServer)(e)}else this.httpServer=(0,$D.createServer)(e);if(this.isHttps=r,this.httpServer.on("error",o=>{this.logError("HTTP server error",o)}),this.config.enableWebSocket){let{WebSocketServer:o}=await Promise.resolve().then(()=>(UK(),BK));this.wsServer=new o({noServer:!0}),this.wsServer.on("error",s=>{this.logError("WebSocket server error",s)});let i=["/v1/realtime","/anthropic/v1/realtime","/google/v1/realtime","/llama/v1/realtime"];this.httpServer.on("upgrade",(s,a,c)=>{if(!s.url){a.destroy();return}let l=this.buildUrl(s.url),u=i.find(d=>l.pathname===d);u?this.wsServer?.handleUpgrade(s,a,c,d=>{d._endpoint=u,this.handleWebSocketConnection(d,u)}):a.destroy()})}await new Promise((o,i)=>{let s=a=>{this.httpServer?.off("error",s),i(a)};this.httpServer?.once("error",s),this.httpServer?.listen(this.config.port,this.config.host,()=>{this.httpServer?.off("error",s),o()})});let n=this.httpServer.address();if(n){let i=`${r?"https":"http"}://${n.address}:${n.port}`;this.logInfo(`${r?"HTTPS":"HTTP"} server listening on ${i}`),this.updateStatusBar("running",`${r?"HTTPS":"HTTP"}${this.config.enableWebSocket?"+WS":""} on ${i}`),this._onDidChangeStatus.fire()}}async restart(){this.disposed||(this.logInfo("Restarting API server to apply configuration changes..."),await this.start())}async stop(){this.wsServer&&await new Promise(e=>{for(let r of this.wsServer?.clients??[])r.close(1001,"Server shutting down");this.wsServer?.close(()=>e())}),this.httpServer&&await new Promise((e,r)=>{this.httpServer?.close(n=>{n?r(n):e()})}),this.httpServer=void 0,this.wsServer=void 0,this.activeRequests=0,this.updateStatusBar("stopped"),this._onDidChangeStatus.fire()}async dispose(){if(this.disposed=!0,this.isShuttingDown=!0,this.logInfo("Shutting down API Gateway..."),this.statsInterval&&(clearInterval(this.statsInterval),this.statsInterval=void 0),this.domainRefreshInterval&&(clearInterval(this.domainRefreshInterval),this.domainRefreshInterval=void 0),this.saveHistory(),this.activeRequests>0){this.logInfo(`Waiting for ${this.activeRequests} active requests to complete...`);let e=0;for(;this.activeRequests>0&&e<3e3;)await new Promise(r=>setTimeout(r,100)),e+=100;this.activeRequests>0&&this.logInfo(`Forcing close of ${this.activeRequests} remaining requests.`)}for(let e of this.connections)e.writableEnded||(e.writeHead(503,{"Content-Type":"application/json"}),e.end(JSON.stringify({error:{message:"Server is shutting down",type:"service_unavailable"}})));this.connections.clear(),await this.stop().catch(e=>{this.logError("Failed to stop API server during dispose",e)});for(let e of this.disposables.splice(0))e.dispose();await this.mcpService?.dispose(),this._onDidChangeStatus.dispose(),this.logInfo("API Gateway shut down successfully.")}async handleHttpRequest(e,r,n,o){if(this.isShuttingDown){r.writeHead(503,{"Content-Type":"application/json"}),r.end(JSON.stringify({error:{message:"Server is shutting down",type:"service_unavailable"}}));return}if(this.setCorsHeaders(r),r.setHeader("X-Request-ID",n),e.method==="OPTIONS"){r.writeHead(204),r.end();return}if(!this.config.enableHttp)throw new ue(503,"HTTP API is disabled. Enable it from the Copilot API controls.","service_unavailable","http_disabled");let i=this.buildUrl(e.url),s=this.getClientIp(e),a=this.activeConnectionsPerIp.get(s)||0;if(a>=this.config.maxConnectionsPerIp)throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,429,Date.now()-o,{requestHeaders:e.headers}),new ue(429,`Too many connections from your IP. Maximum ${this.config.maxConnectionsPerIp} concurrent connections allowed.`,"rate_limit_error","too_many_connections");if(this.activeConnectionsPerIp.set(s,a+1),r.on("close",()=>{let p=this.activeConnectionsPerIp.get(s)||1;p<=1?this.activeConnectionsPerIp.delete(s):this.activeConnectionsPerIp.set(s,p-1)}),this.config.apiKey&&i.pathname!=="/health"){let p=e.headers.authorization;if((p?.startsWith("Bearer ")?p.slice(7):null)!==this.config.apiKey)throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,401,Date.now()-o,{requestHeaders:e.headers}),new ue(401,"Invalid or missing API key. Provide a valid Bearer token.","authentication_error","invalid_api_key")}if(!this.checkRateLimit())throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,429,Date.now()-o,{requestHeaders:e.headers}),new ue(429,"Rate limit exceeded. Please try again later.","rate_limit_error","rate_limit_exceeded");if(!this.checkIpAllowlist(e))throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,403,Date.now()-o,{requestHeaders:e.headers}),new ue(403,"Access denied. Your IP address is not allowed.","access_denied","ip_not_allowed");if(this.usageStats.totalRequests++,this.usageStats.requestsByEndpoint[i.pathname]=(this.usageStats.requestsByEndpoint[i.pathname]||0)+1,e.method==="GET"&&i.pathname==="/health"){try{let p=await P.lm.selectChatModels({vendor:"copilot"});p&&p.length>0?this.sendJson(r,200,{status:"ok",service:"github-copilot-api-vscode",copilot:"available",models:p.length}):this.sendJson(r,200,{status:"degraded",service:"github-copilot-api-vscode",copilot:"unavailable",message:"No Copilot models found. Check if GitHub Copilot is installed and signed in."})}catch{this.sendJson(r,200,{status:"degraded",service:"github-copilot-api-vscode",copilot:"error",message:"Failed to check Copilot availability."})}return}if(e.method==="GET"&&i.pathname==="/openapi.json"){this.sendJson(r,200,this.getOpenApiSpec());return}if(e.method==="GET"&&i.pathname==="/debug-paths"){this.sendDebugPaths(r);return}if(e.method==="GET"&&i.pathname==="/docs"){this.sendSwaggerUi(r);return}if(e.method==="GET"&&i.pathname.startsWith("/swagger-ui/")){this.serveStaticFile(e,r,i.pathname);return}if(e.method==="GET"&&i.pathname==="/v1/usage"){let p=Math.floor((Date.now()-this.usageStats.startTime)/1e3);this.sendJson(r,200,{object:"usage",total_requests:this.usageStats.totalRequests,total_tokens:{input:this.usageStats.totalTokensIn,output:this.usageStats.totalTokensOut,total:this.usageStats.totalTokensIn+this.usageStats.totalTokensOut},requests_by_endpoint:this.usageStats.requestsByEndpoint,uptime_seconds:p,active_requests:this.activeRequests});return}if(e.method==="GET"&&i.pathname==="/metrics"){let p=Math.floor((Date.now()-this.usageStats.startTime)/1e3),f=["# HELP copilot_api_requests_total Total number of API requests","# TYPE copilot_api_requests_total counter",`copilot_api_requests_total ${this.usageStats.totalRequests}`,"","# HELP copilot_api_active_requests Current number of active requests","# TYPE copilot_api_active_requests gauge",`copilot_api_active_requests ${this.activeRequests}`,"","# HELP copilot_api_tokens_input_total Total input tokens consumed","# TYPE copilot_api_tokens_input_total counter",`copilot_api_tokens_input_total ${this.usageStats.totalTokensIn}`,"","# HELP copilot_api_tokens_output_total Total output tokens generated","# TYPE copilot_api_tokens_output_total counter",`copilot_api_tokens_output_total ${this.usageStats.totalTokensOut}`,"","# HELP copilot_api_uptime_seconds Server uptime in seconds","# TYPE copilot_api_uptime_seconds gauge",`copilot_api_uptime_seconds ${p}`,"","# HELP copilot_api_requests_per_minute Rate of requests per minute","# TYPE copilot_api_requests_per_minute gauge",`copilot_api_requests_per_minute ${this.realtimeStats.requestsPerMinute}`,"","# HELP copilot_api_latency_avg_ms Average request latency in milliseconds","# TYPE copilot_api_latency_avg_ms gauge",`copilot_api_latency_avg_ms ${this.realtimeStats.avgLatencyMs}`,"","# HELP copilot_api_error_rate_percent Error rate percentage","# TYPE copilot_api_error_rate_percent gauge",`copilot_api_error_rate_percent ${this.realtimeStats.errorRate}`,""].join(`
`);r.writeHead(200,{"Content-Type":"text/plain; version=0.0.4; charset=utf-8"}),r.end(f);return}if(e.method==="GET"&&i.pathname==="/v1/models"){let p=await this.getAvailableModels();this.sendJson(r,200,{object:"list",data:p});return}let c=i.pathname.match(/^\/v1\/models\/(.+)$/);if(e.method==="GET"&&c){let p=decodeURIComponent(c[1]),m=(await this.getAvailableModels()).find(h=>h.id===p);if(!m)throw new ue(404,`Model '${p}' not found`,"not_found","model_not_found");this.sendJson(r,200,m);return}if(e.method==="POST"&&i.pathname==="/v1/chat/completions"){let p=await this.readJsonBody(e);if(p?.stream===!0)await this.processStreamingChatCompletion(p,e,r,n,o);else{let f=await this.processChatCompletion(p,{source:"http",endpoint:"/v1/chat/completions"});this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.prompt_tokens,tokensOut:f?.usage?.completion_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}return}if(e.method==="POST"&&i.pathname==="/v1/messages"){let p=await this.readJsonBody(e);if(p?.model&&!this.resolveModel(p.model))throw new ue(400,`Model '${p.model}' is not supported.`,"invalid_request_error","model_not_found");if(p?.stream===!0)await this.processStreamingAnthropicMessages(p,e,r,n,o);else try{let f=await this.processAnthropicMessages(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.input_tokens,tokensOut:f?.usage?.output_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}catch(f){let m=f instanceof ue?f:new ue(500,f.message||"Internal Server Error","api_error");this.sendJson(r,m.status,{type:"error",error:{type:m.code||"api_error",message:m.message}})}return}if(e.method==="POST"&&i.pathname==="/v1/completions"){let p=await this.readJsonBody(e),f=await this.processCompletion(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.prompt_tokens,tokensOut:f?.usage?.completion_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f);return}if(e.method==="POST"&&i.pathname==="/v1/tokenize"){let p=await this.readJsonBody(e),f=await this.processTokenize(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f);return}if(e.method==="POST"&&i.pathname==="/v1/count_tokens"){let p=await this.readJsonBody(e),f=await this.processTokenize(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f);return}if(e.method==="POST"&&i.pathname==="/v1/responses"){let p=await this.readJsonBody(e),f=await this.processResponsesApi(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.input_tokens,tokensOut:f?.usage?.output_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f);return}let l=i.pathname.match(/^\/v1beta\/models\/(.+):generateContent$/),u=i.pathname.match(/^\/v1beta\/models\/(.+):streamGenerateContent$/);if(e.method==="POST"&&(l||u)){let p=decodeURIComponent((l||u)[1]),f=await this.readJsonBody(e);if(p&&!this.resolveModel(p))throw new ue(400,`Model '${p}' is not supported.`,"invalid_request_error","model_not_found");if(u)await this.processStreamingGoogleGenerateContent(p,f,e,r,n,o);else try{let m=await this.processGoogleGenerateContent(p,f);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:f,responsePayload:m,tokensIn:m?.usageMetadata?.promptTokenCount,tokensOut:m?.usageMetadata?.candidatesTokenCount,model:p,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,m)}catch(m){let h=m instanceof ue?m:new ue(500,m.message||"Internal Server Error","server_error");this.sendJson(r,h.status,{error:{code:h.status,message:h.message,status:h.code||"INTERNAL"}})}return}if(e.method==="POST"&&i.pathname==="/llama/v1/chat/completions"){let p=await this.readJsonBody(e);if(p?.max_completion_tokens&&!p?.max_tokens&&(p.max_tokens=p.max_completion_tokens),p?.stream===!0)await this.processStreamingChatCompletion(p,e,r,n,o);else{let f=await this.processChatCompletion(p,{source:"http",endpoint:"/llama/v1/chat/completions"});this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.prompt_tokens,tokensOut:f?.usage?.completion_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}return}if(e.method==="POST"&&i.pathname==="/v1/embeddings")throw new ue(501,"Embeddings are not supported by Copilot.","not_implemented","embeddings_not_supported");if(i.pathname.startsWith("/v1/images"))throw new ue(501,"Image generation is not supported by Copilot.","not_implemented","images_not_supported");if(i.pathname.startsWith("/v1/audio"))throw new ue(501,"Audio processing is not supported by Copilot.","not_implemented","audio_not_supported");let d=["/v1/realtime","/anthropic/v1/realtime","/google/v1/realtime","/llama/v1/realtime"];if(e.method==="GET"&&d.includes(i.pathname)){r.writeHead(426,{"Content-Type":"application/json",Upgrade:"websocket"}),r.end(JSON.stringify({error:{message:"This is a WebSocket endpoint. Please use a WebSocket client and Upgrade header.",type:"upgrade_required",code:"websocket_only"}}));return}throw new ue(404,`No route for ${e.method??"UNKNOWN"} ${i.pathname}`,"not_found")}async processStreamingGoogleGenerateContent(e,r,n,o,i,s){let a=[];if(r.systemInstruction){let p=r.systemInstruction.parts.map(f=>f.text).join(" ");a.push(P.LanguageModelChatMessage.User(this.redactPromptString(p)))}for(let p of r.contents){let f=p.role==="model"?P.LanguageModelChatMessageRole.Assistant:P.LanguageModelChatMessageRole.User,m=p.parts.map(g=>g.text).join(" "),h=this.redactPromptString(m);f===P.LanguageModelChatMessageRole.User?a.push(P.LanguageModelChatMessage.User(h)):a.push(P.LanguageModelChatMessage.Assistant(h))}let c=this.resolveModel(e),l=a.map(p=>typeof p.content=="string"?p.content:p.content.map(f=>"text"in f?f.text:"").join(" ")).join(`
`);o.writeHead(200,{"Content-Type":"application/json","X-HTTP-Content-Type-Options":"nosniff","Transfer-Encoding":"chunked"});let u="",d=new P.CancellationTokenSource;n.on("close",()=>{d.cancel(),`${i||""}`});try{let p=await P.lm.selectChatModels({vendor:"copilot"});if(!p||p.length===0)throw new ue(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let f=p[0],m=await f.sendRequest(a,{},d.token);o.write(`[
`);let h=!0;for await(let b of m.stream){if(d.token.isCancellationRequested)break;if(b instanceof P.LanguageModelTextPart){u+=b.value,h||o.write(`,
`);let S={candidates:[{content:{role:"model",parts:[{text:b.value}]},finishReason:"STOP",index:0}],usageMetadata:{promptTokenCount:0,candidatesTokenCount:0,totalTokenCount:0}};o.write(JSON.stringify(S)),h=!1}}d.token.isCancellationRequested||(o.write(`
]
`),o.end());let g=0,v=0;try{g=await f.countTokens(l,d.token),v=await f.countTokens(u,d.token)}catch{}i&&this.logRequest(i,"POST",`/v1beta/models/${e}:streamGenerateContent`,200,Date.now()-(s||0),{requestPayload:r,responsePayload:{candidates:[{content:{parts:[{text:u}]}}]},tokensIn:g,tokensOut:v,model:c})}catch(p){if(d.token.isCancellationRequested)return;console.error("Google streaming error:",p);let f=p instanceof ue?p:new ue(500,p.message||"Internal Server Error","server_error");o.write(JSON.stringify({error:{code:f.status,message:f.message,status:f.code}})),o.end()}finally{d.dispose()}}async processStreamingAnthropicMessages(e,r,n,o,i){let s=[];e.system&&s.push(P.LanguageModelChatMessage.User(this.redactPromptString(e.system)));for(let f of e.messages){let m=f.role==="user"?P.LanguageModelChatMessageRole.User:P.LanguageModelChatMessageRole.Assistant,h=typeof f.content=="string"?f.content:f.content.map(v=>v.text).join(" "),g=this.redactPromptString(h);m===P.LanguageModelChatMessageRole.User?s.push(P.LanguageModelChatMessage.User(g)):s.push(P.LanguageModelChatMessage.Assistant(g))}let a=this.resolveModel(e.model),c=s.map(f=>typeof f.content=="string"?f.content:f.content.map(m=>"text"in m?m.text:"").join(" ")).join(`
`);n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});let l="ant-"+(0,rn.randomUUID)(),u="",d=new P.CancellationTokenSource;r.on("close",()=>{d.cancel(),`${o||""}`});let p=setInterval(()=>{n.writableEnded||n.write(`: ping

`)},15e3);try{let f=await P.lm.selectChatModels({vendor:"copilot"});if(!f||f.length===0)throw new ue(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let m=f[0],h=await m.sendRequest(s,{},d.token);n.write(`event: message_start
data: ${JSON.stringify({type:"message_start",message:{id:l,type:"message",role:"assistant",content:[],model:a,stop_reason:null,stop_sequence:null,usage:{input_tokens:0,output_tokens:0}}})}

`),n.write(`event: content_block_start
data: ${JSON.stringify({type:"content_block_start",index:0,content_block:{type:"text",text:""}})}

`);for await(let b of h.stream){if(d.token.isCancellationRequested)break;b instanceof P.LanguageModelTextPart&&(u+=b.value,n.write(`event: content_block_delta
data: ${JSON.stringify({type:"content_block_delta",index:0,delta:{type:"text_delta",text:b.value}})}

`))}d.token.isCancellationRequested||(n.write(`event: content_block_stop
data: ${JSON.stringify({type:"content_block_stop",index:0})}

`),n.write(`event: message_delta
data: ${JSON.stringify({type:"message_delta",delta:{stop_reason:"end_turn",stop_sequence:null},usage:{output_tokens:0}})}

`),n.write(`event: message_stop
data: ${JSON.stringify({type:"message_stop"})}

`),n.end());let g=0,v=0;try{g=await m.countTokens(c,d.token),v=await m.countTokens(u,d.token)}catch{}o&&this.logRequest(o,"POST","/v1/messages",200,Date.now()-(i||0),{requestPayload:e,responsePayload:{id:l,type:"message",content:[{type:"text",text:u}]},tokensIn:g,tokensOut:v,model:a})}catch(f){if(d.token.isCancellationRequested)return;console.error("Anthropic streaming error:",f);let m=f instanceof ue?f:new ue(500,f.message||"Internal Server Error","server_error");n.write(`event: error
data: ${JSON.stringify({type:"error",error:{type:m.code||"api_error",message:m.message}})}

`),n.end()}finally{clearInterval(p),d.dispose()}}async getAvailableModels(){let e=Math.floor(Date.now()/1e3);return(await P.lm.selectChatModels({vendor:"copilot"})).map(o=>({id:o.id,object:"model",created:e,owned_by:o.vendor||"github-copilot",name:o.name,family:o.family,version:o.version,max_input_tokens:o.maxInputTokens,capabilities:{chat_completion:!0,text_completion:!0,streaming:!0,token_counting:!0}}))}async processStreamingChatCompletion(e,r,n,o,i){let s=this.normalizeChatMessages(e);s=this.redactMessagesContent(s);let a=this.resolveModel(e?.model),c=this.normalizeTools(e?.tools||e?.functions),l=e?.tool_choice||e?.function_call,u=`chatcmpl-${(0,rn.randomUUID)()}`,d=Math.floor(Date.now()/1e3),p="";n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});try{let f=await P.lm.selectChatModels({vendor:"copilot"});if(!f||f.length===0)throw new ue(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let m=f[0],h=[];for(let me of s){let Ce=typeof me.content=="string"?me.content:JSON.stringify(me.content);switch(me.role){case"system":h.push(P.LanguageModelChatMessage.User(`[System]: ${Ce}`));break;case"user":h.push(P.LanguageModelChatMessage.User(Ce));break;case"assistant":if(me.tool_calls&&me.tool_calls.length>0){let dr=me.tool_calls.map(nn=>`[Called function: ${nn.function?.name||nn.name}(${nn.function?.arguments||JSON.stringify(nn.arguments)})]`).join(`
`);h.push(P.LanguageModelChatMessage.Assistant(dr))}else h.push(P.LanguageModelChatMessage.Assistant(Ce));break;case"tool":let Ge=`[Tool result for ${me.tool_call_id||"unknown"}]: ${Ce}`;h.push(P.LanguageModelChatMessage.User(Ge));break;default:h.push(P.LanguageModelChatMessage.User(Ce))}}let g={};c&&c.length>0&&(g.tools=c,l==="required"||l==="any"?g.toolMode=P.LanguageModelChatToolMode.Required:g.toolMode=P.LanguageModelChatToolMode.Auto);let v=await m.sendRequest(h,g,new P.CancellationTokenSource().token),b=[],S=0;for await(let me of v.stream)if(me instanceof P.LanguageModelTextPart){p+=me.value;let Ce={id:u,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{content:me.value},finish_reason:null}]};n.write(`data: ${JSON.stringify(Ce)}

`)}else if(me instanceof P.LanguageModelToolCallPart){let Ce=`call_${(0,rn.randomUUID)().slice(0,24)}`,Ge=typeof me.input=="string"?me.input:JSON.stringify(me.input);b.push({id:Ce,name:me.name,arguments:Ge});let dr={id:u,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{tool_calls:[{index:S,id:Ce,type:"function",function:{name:me.name,arguments:Ge}}]},finish_reason:null}]};n.write(`data: ${JSON.stringify(dr)}

`),S++}let j=b.length>0?"tool_calls":"stop",C={id:u,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{},finish_reason:j}]};n.write(`data: ${JSON.stringify(C)}

`),n.write(`data: [DONE]

`),n.end();let ie=0,pe=0;try{let me=h.map(Ce=>typeof Ce.content=="string"?Ce.content:JSON.stringify(Ce.content)).join(`
`);ie=await m.countTokens(me,new P.CancellationTokenSource().token),pe=await m.countTokens(p,new P.CancellationTokenSource().token)}catch(me){console.error("Failed to count tokens:",me)}o&&i&&this.logRequest(o,"POST","/v1/chat/completions",200,Date.now()-i,{requestPayload:e,responsePayload:{streamed:!0,content_preview:p.slice(0,500),tool_calls:b},model:e?.model,requestHeaders:r.headers,responseHeaders:n.getHeaders(),tokensIn:ie,tokensOut:pe})}catch(f){let m={error:{message:f instanceof Error?f.message:"Unknown error",type:"server_error"}};n.write(`data: ${JSON.stringify(m)}

`),n.end(),o&&i&&this.logRequest(o,"POST","/v1/chat/completions",500,Date.now()-i,{requestPayload:e,error:f instanceof Error?f.message:String(f),model:e?.model,requestHeaders:r.headers})}}async processTokenize(e){let r=e?.text||e?.input||"",n=this.resolveModel(e?.model),o=await P.lm.selectChatModels({vendor:"copilot"});if(!o||o.length===0)throw new ue(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let s=await o[0].countTokens(r);return{object:"token_count",model:n,token_count:s,text_length:r.length}}async processResponsesApi(e){let r=e?.input,n=[];typeof r=="string"?n=[{role:"user",content:r}]:Array.isArray(r)&&(n=r.map(l=>typeof l=="string"?{role:"user",content:l}:{role:l.role||"user",content:typeof l.content=="string"?l.content:JSON.stringify(l.content)}));let o=this.composePrompt(n);o=this.redactPromptString(o);let i=this.resolveModel(e?.model),s=await this.runWithConcurrency(()=>this.invokeCopilot(o)),a=0,c=0;try{let l=await P.lm.selectChatModels({vendor:"copilot"});if(l&&l.length>0){let u=l[0];a=await u.countTokens(o),c=await u.countTokens(s||"")}}catch(l){console.error("Token counting failed:",l)}return{id:`resp-${(0,rn.randomUUID)()}`,object:"response",created_at:Math.floor(Date.now()/1e3),model:i,output:[{type:"message",id:`msg-${(0,rn.randomUUID)()}`,role:"assistant",content:[{type:"output_text",text:s}]}],usage:{prompt_tokens:a,completion_tokens:c,total_tokens:a+c}}}async processAnthropicMessages(e){let r=[];e.system&&r.push(P.LanguageModelChatMessage.User(this.redactPromptString(e.system)));for(let c of e.messages){let l=c.role==="user"?P.LanguageModelChatMessageRole.User:P.LanguageModelChatMessageRole.Assistant,u=typeof c.content=="string"?c.content:c.content.map(p=>p.text).join(" "),d=this.redactPromptString(u);l===P.LanguageModelChatMessageRole.User?r.push(P.LanguageModelChatMessage.User(d)):r.push(P.LanguageModelChatMessage.Assistant(d))}let n=this.resolveModel(e.model),o=r.map(c=>typeof c.content=="string"?c.content:c.content.map(l=>"text"in l?l.text:"").join(" ")).join(`
`),i=await this.runWithConcurrency(async()=>{let c=await P.lm.selectChatModels({vendor:"copilot"});if(!c||c.length===0)throw new ue(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let u=await c[0].sendRequest(r,{},new P.CancellationTokenSource().token),d="";for await(let p of u.stream)p instanceof P.LanguageModelTextPart&&(d+=p.value);return d}),s=0,a=0;try{let c=r.map(u=>u.content).join(" "),l=await P.lm.selectChatModels({vendor:"copilot"});if(l&&l.length>0){let u=l[0];s=await u.countTokens(c),a=await u.countTokens(i||"")}}catch(c){console.error("Anthropic token counting failed:",c)}return{id:"ant-"+(0,rn.randomUUID)(),type:"message",role:"assistant",content:[{type:"text",text:i||""}],model:n,stop_reason:"end_turn",stop_sequence:null,usage:{input_tokens:s,output_tokens:a}}}async processGoogleGenerateContent(e,r){let n=[];if(r.systemInstruction){let l=r.systemInstruction.parts.map(u=>u.text).join(" ");n.push(P.LanguageModelChatMessage.User(this.redactPromptString(l)))}for(let l of r.contents){let u=l.role==="model"?P.LanguageModelChatMessageRole.Assistant:P.LanguageModelChatMessageRole.User,d=l.parts.map(f=>f.text).join(" "),p=this.redactPromptString(d);u===P.LanguageModelChatMessageRole.User?n.push(P.LanguageModelChatMessage.User(p)):n.push(P.LanguageModelChatMessage.Assistant(p))}let o=this.resolveModel(e),i=n.map(l=>typeof l.content=="string"?l.content:l.content.map(u=>"text"in u?u.text:"").join(" ")).join(`
`),s=await this.runWithConcurrency(async()=>{let l=await P.lm.selectChatModels({vendor:"copilot"});if(!l||l.length===0)throw new ue(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let d=await l[0].sendRequest(n,{},new P.CancellationTokenSource().token),p="";for await(let f of d.stream)f instanceof P.LanguageModelTextPart&&(p+=f.value);return p}),a=0,c=0;try{let l=n.map(d=>d.content).join(" "),u=await P.lm.selectChatModels({vendor:"copilot"});if(u&&u.length>0){let d=u[0];a=await d.countTokens(l),c=await d.countTokens(s||"")}}catch(l){console.error("Google token counting failed:",l)}return{candidates:[{content:{role:"model",parts:[{text:s||""}]},finishReason:"STOP",index:0}],usageMetadata:{promptTokenCount:a,candidatesTokenCount:c,totalTokenCount:a+c}}}async processChatCompletion(e,r){let n=this.normalizeChatMessages(e);n=this.injectSystemPrompt(n),n=this.redactMessagesContent(n);let o=this.resolveModel(e?.model),i=this.normalizeTools(e?.tools||e?.functions)||[],s=await this.ensureMcpService(),c=(s?await s.getAllTools():[]).map(b=>({name:`mcp_${b.serverName}_${b.name}`,description:b.description||`Tool from MCP server ${b.serverName}`,inputSchema:b.inputSchema})),l=[...i,...c],u=e?.tool_choice||e?.function_call;if(e?.response_format?.type==="json_object"){let b=n.map(S=>S.role).lastIndexOf("user");if(b>=0){let S=n[b].content;n[b]={...n[b],content:`${S}

IMPORTANT: You MUST respond with valid JSON only.No markdown, no explanation, just pure JSON.`}}}let p=0,f=5,m;for(;p<f;){if(m=await this.runWithConcurrency(()=>this.invokeCopilotWithTools(n,l,u)),m.toolCalls&&m.toolCalls.length>0){let b=m.toolCalls.filter(S=>S.name.startsWith("mcp_"));if(b.length>0){n.push({role:"assistant",content:m.content||null,tool_calls:m.toolCalls.map(S=>({id:`call_${(0,rn.randomUUID)().slice(0,24)}`,type:"function",function:{name:S.name,arguments:typeof S.arguments=="string"?S.arguments:JSON.stringify(S.arguments)}}))});for(let S of b){let j=S.name.split("_"),C=j[1],ie=j.slice(2).join("_");try{let pe=await this.ensureMcpService();if(!pe)throw new Error("MCP service not available");let me=await pe.callTool(C,ie,S.arguments);n.push({role:"tool",tool_call_id:`call_${(0,rn.randomUUID)().slice(0,24)}`,content:JSON.stringify(me)})}catch(pe){n.push({role:"tool",tool_call_id:`call_${(0,rn.randomUUID)().slice(0,24)}`,content:`Error executing MCP tool: ${pe.message}`})}}p++;continue}}break}let h=Math.floor(Date.now()/1e3),g=0,v=0;try{let b=await P.lm.selectChatModels({vendor:"copilot"});if(b&&b.length>0){let S=b[0],j=n.map(pe=>typeof pe.content=="string"?pe.content:JSON.stringify(pe.content)).join(`
`);g=await S.countTokens(j);let C=m.content||"",ie=m.toolCalls?JSON.stringify(m.toolCalls):"";v=await S.countTokens(C+ie)}}catch(b){console.error("Token counting failed:",b)}return m.toolCalls&&m.toolCalls.length>0?{id:`chatcmpl-${(0,rn.randomUUID)()}`,object:"chat.completion",created:h,model:o,choices:[{index:0,message:{role:"assistant",content:m.content||null,tool_calls:m.toolCalls.map((b,S)=>({id:`call_${(0,rn.randomUUID)().slice(0,24)}`,type:"function",function:{name:b.name,arguments:typeof b.arguments=="string"?b.arguments:JSON.stringify(b.arguments)}}))},finish_reason:"tool_calls"}],usage:{prompt_tokens:g,completion_tokens:v,total_tokens:g+v},system_fingerprint:null}:{id:`chatcmpl-${(0,rn.randomUUID)()}`,object:"chat.completion",created:h,model:o,choices:[{index:0,message:{role:"assistant",content:m.content},finish_reason:"stop"}],usage:{prompt_tokens:g,completion_tokens:v,total_tokens:g+v},system_fingerprint:null}}normalizeTools(e){if(!(!e||!Array.isArray(e)||e.length===0))return e.map(r=>{let n=r.type==="function"?r.function:r;return{name:n.name,description:n.description||"",inputSchema:n.parameters||n.inputSchema||void 0}})}async invokeCopilotWithTools(e,r,n){let o=await this.getCopilotHealth();if(!o.installed)throw new ue(503,"GitHub Copilot extension is not installed.","service_unavailable","copilot_not_installed");if(!o.chatInstalled)throw new ue(503,"GitHub Copilot Chat extension is not installed.","service_unavailable","copilot_chat_not_installed");if(!o.signedIn)throw new ue(401,"Not signed in to GitHub Copilot. Please sign in in VS Code.","unauthorized","copilot_not_signed_in");let i=await P.lm.selectChatModels({vendor:"copilot"});if(!i||i.length===0)throw new ue(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let s=i[0],a=[];for(let d of e){let p=typeof d.content=="string"?d.content:JSON.stringify(d.content);switch(d.role){case"system":a.push(P.LanguageModelChatMessage.User(`[System]: ${p}`));break;case"user":a.push(P.LanguageModelChatMessage.User(p));break;case"assistant":if(d.tool_calls&&d.tool_calls.length>0){let m=d.tool_calls.map(h=>`[Called function: $ { tc.function?.name || tc.name }(${h.function?.arguments||JSON.stringify(h.arguments)})]`).join(`
`);a.push(P.LanguageModelChatMessage.Assistant(m))}else a.push(P.LanguageModelChatMessage.Assistant(p));break;case"tool":let f=`[Tool result for ${d.tool_call_id||"unknown"}]: ${p} `;a.push(P.LanguageModelChatMessage.User(f));break;default:a.push(P.LanguageModelChatMessage.User(p))}}let c={};r&&r.length>0&&(c.tools=r,n==="required"||n==="any"?c.toolMode=P.LanguageModelChatToolMode.Required:c.toolMode=P.LanguageModelChatToolMode.Auto);let l=new P.CancellationTokenSource,u=setTimeout(()=>l.cancel(),(this.config.requestTimeoutSeconds||180)*1e3);try{let d=await s.sendRequest(a,c,l.token),p="",f=[];for await(let m of d.stream){if(l.token.isCancellationRequested)throw new ue(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout");m instanceof P.LanguageModelTextPart?p+=m.value:m instanceof P.LanguageModelToolCallPart&&f.push({name:m.name,arguments:m.input})}return{content:p.trim(),toolCalls:f.length>0?f:void 0}}catch(d){throw d instanceof ue?d:l.token.isCancellationRequested?new ue(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout"):new ue(502,`Failed to retrieve Copilot response: ${Jl(d)} `,"bad_gateway","command_failed",{cause:d})}finally{clearTimeout(u),l.dispose()}}async processCompletion(e){let r=this.normalizePromptInput(e?.prompt);if(!r)throw new ue(400,"prompt is required","invalid_request_error","missing_prompt");r=this.redactPromptString(r);let n=this.resolveModel(e?.model),o=await this.runWithConcurrency(()=>this.invokeCopilot(r)),i=Math.floor(Date.now()/1e3),s=0,a=0;try{let c=await P.lm.selectChatModels({vendor:"copilot"});if(c&&c.length>0){let l=c[0],u=r;s=await l.countTokens(u);let d=o||"";a=await l.countTokens(d)}}catch(c){console.error("Token counting failed:",c)}return{id:`cmpl - ${(0,rn.randomUUID)()} `,object:"text_completion",created:i,model:n,choices:[{index:0,text:o,finish_reason:"stop",logprobs:null}],usage:{prompt_tokens:s,completion_tokens:a,total_tokens:s+a}}}async handleWebSocketMessage(e,r,n){let o=typeof r=="string"?r:r.toString("utf8"),i;try{i=JSON.parse(o)}catch{throw new ue(400,"WebSocket payload must be valid JSON.","invalid_request_error","invalid_json")}let s=i?.type??i?.event??i?.action;if(s==="ping"){e.send(JSON.stringify({type:"pong",timestamp:Date.now()}));return}if(s==="models.list"){let a=await this.getAvailableModels();e.send(JSON.stringify({type:"models.result",data:{object:"list",data:a}}));return}switch(n){case"/v1/realtime":case"/llama/v1/realtime":await this.handleOpenAIWebSocketMessage(e,i,s,n);return;case"/anthropic/v1/realtime":await this.handleAnthropicWebSocketMessage(e,i,s);return;case"/google/v1/realtime":await this.handleGoogleWebSocketMessage(e,i,s);return;default:throw new ue(400,`Unknown WebSocket endpoint: ${n}`,"invalid_request_error","unknown_endpoint")}}async handleOpenAIWebSocketMessage(e,r,n,o){if(!n||n==="chat.completions.create"){let i=r?.data??r?.request??r;o==="/llama/v1/realtime"&&i?.max_completion_tokens&&!i?.max_tokens&&(i.max_tokens=i.max_completion_tokens);let s=await this.processChatCompletion(i,{source:"websocket",endpoint:o});e.send(JSON.stringify({type:"chat.completion.result",data:s}));return}if(n==="completions.create"){let i=r?.data??r?.request??r,s=await this.processCompletion(i);e.send(JSON.stringify({type:"completion.result",data:s}));return}throw new ue(400,`Unsupported OpenAI WebSocket message type: ${n}`,"invalid_request_error","unsupported_ws_message")}async handleAnthropicWebSocketMessage(e,r,n){if(!n||n==="messages.create"){let o=r?.data??r?.request??r,i=await this.processAnthropicMessages(o);e.send(JSON.stringify({type:"message.result",data:i}));return}throw new ue(400,`Unsupported Anthropic WebSocket message type: ${n}`,"invalid_request_error","unsupported_ws_message")}async handleGoogleWebSocketMessage(e,r,n){if(!n||n==="generateContent"){let o=r?.data??r?.request??r,i=r?.model??"gemini-pro",s=await this.processGoogleGenerateContent(i,o);e.send(JSON.stringify({type:"content.result",data:s}));return}throw new ue(400,`Unsupported Google WebSocket message type: ${n}`,"invalid_request_error","unsupported_ws_message")}handleWebSocketConnection(e,r){e.send(JSON.stringify({type:"session.created",session:{id:(0,rn.randomUUID)(),model:this.config.defaultModel,created:Math.floor(Date.now()/1e3),endpoint:r}})),e.on("message",n=>{this.handleWebSocketMessage(e,n,r).catch(o=>{o instanceof ue?this.sendWsError(e,o):(this.logError("Unhandled WebSocket error",o),this.sendWsError(e,new ue(500,"An unexpected error occurred.","server_error")))})}),e.on("error",n=>{this.logError("WebSocket client error",n)})}async runWithConcurrency(e){if(this.activeRequests>=this.config.maxConcurrentRequests)throw new ue(429,"Too many concurrent requests. Try again shortly.","rate_limit_exceeded","concurrency_limit");this.activeRequests+=1;try{return await e()}finally{this.activeRequests-=1}}async invokeCopilot(e){let r=await P.lm.selectChatModels({vendor:"copilot"});if(!r||r.length===0)throw new ue(503,"No Copilot language model available. Make sure GitHub Copilot is installed and signed in.","service_unavailable","copilot_unavailable");let n=r[0],o=[P.LanguageModelChatMessage.User(e)],i=new P.CancellationTokenSource,s=setTimeout(()=>i.cancel(),(this.config.requestTimeoutSeconds||180)*1e3);try{let a=await n.sendRequest(o,{},i.token),c="";for await(let l of a.text){if(i.token.isCancellationRequested)throw new ue(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout");c+=l}if(!c.trim())throw new ue(502,"Copilot did not return any content.","bad_gateway","empty_response");return c.trim()}catch(a){throw a instanceof ue?a:i.token.isCancellationRequested?new ue(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout"):new ue(502,`Failed to retrieve Copilot response: ${Jl(a)} `,"bad_gateway","command_failed",{cause:a})}finally{clearTimeout(s),i.dispose()}}extractTextFromChatResult(e){if(e){if(typeof e=="string")return e.trim()||void 0;if(Array.isArray(e))return e.map(r=>typeof r=="string"?r:"").join(" ").trim()||void 0;if(typeof e=="object"){let r=e,n=r.response??r.result??r.body;if(typeof n=="string")return n.trim()||void 0;if(n&&typeof n=="object"){let o=n.text??n.message;if(typeof o=="string"&&o.trim())return o.trim();let i=n.responseContent;if(Array.isArray(i)){let s=i.map(a=>typeof a=="string"?a:a&&typeof a=="object"&&typeof a.text=="string"?String(a.text):"").join("").trim();if(s)return s}}if(Array.isArray(r.choices)&&r.choices.length>0){let o=r.choices[0];if(typeof o?.text=="string"&&o.text.trim())return o.text.trim();let i=o?.message;if(i&&typeof i.content=="string"&&i.content.trim())return i.content.trim()}}}}normalizeChatMessages(e){let r=e?.messages;if(Array.isArray(r)&&r.length>0)return r.map((o,i)=>({role:typeof o?.role=="string"?o.role:i===r.length-1?"user":"system",content:o?.content,tool_calls:o?.tool_calls,tool_call_id:o?.tool_call_id}));let n=this.normalizePromptInput(e?.prompt??e?.input);if(n)return[{role:"user",content:n}];throw new ue(400,"messages must be a non-empty array or prompt must be provided.","invalid_request_error","missing_messages")}normalizePromptInput(e){if(typeof e=="string")return e.trim()||void 0;if(Array.isArray(e))return e.map(n=>typeof n=="string"?n:"").join(`
`).trim()||void 0}composePrompt(e){return e.map(({role:r,content:n})=>{let o=r||"user",i=this.flattenMessageContent(n);return`[${o}]
${i} `}).join(`

`)}flattenMessageContent(e){return typeof e=="string"?e:e==null?"":Array.isArray(e)?e.map(r=>typeof r=="string"?r:r&&typeof r=="object"&&typeof r.text=="string"?String(r.text):"").join(`
`):String(e)}resolveModel(e){return typeof e=="string"&&e.trim()?e.trim():this.config.defaultModel}injectSystemPrompt(e){return!this.config.defaultSystemPrompt||e.some(n=>n.role==="system")?e:[{role:"system",content:this.config.defaultSystemPrompt},...e]}async readJsonBody(e){let r=[],n=0;if(await new Promise((i,s)=>{e.on("data",a=>{let c=typeof a=="string"?Buffer.from(a):a;n+=c.length;let l=(this.config.maxPayloadSizeMb||1)*1024*1024;if(n>l){e.destroy(),s(new ue(413,`Request body too large.Maximum size is ${Math.round(l/1024)} KB.`,"invalid_request_error","payload_too_large"));return}r.push(c)}),e.on("end",()=>i()),e.on("error",a=>s(a))}),r.length===0)return{};let o=Buffer.concat(r).toString("utf8");if(!o.trim())return{};try{return JSON.parse(o)}catch(i){throw new ue(400,"Request body must be valid JSON.","invalid_request_error","invalid_json",{cause:i})}}sendJson(e,r,n){e.headersSent||(e.statusCode=r,e.setHeader("Content-Type","application/json")),e.end(JSON.stringify(n))}sendSwaggerUi(e){let r=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot API - Swagger UI</title>
    <link rel="stylesheet" href="/swagger-ui/swagger-ui.css">
    <style>
        body { margin: 0; background: #fafafa; }
        .swagger-ui .topbar { display: none; }
        .swagger-ui .info { margin: 30px 0; }
        .swagger-ui .info .title { font-size: 2em; }
    </style>
</head>
<body>
    <div id="swagger-ui"></div>
    <script src="/swagger-ui/swagger-ui-bundle.js"></script>
    <script src="/swagger-ui/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function() {
            SwaggerUIBundle({
                url: '/openapi.json',
                dom_id: '#swagger-ui',
                presets: [SwaggerUIBundle.presets.apis, SwaggerUIBundle.SwaggerUIStandalonePreset],
                layout: 'BaseLayout',
                deepLinking: true,
                showExtensions: true,
                showCommonExtensions: true
            });
        };
    </script>
</body>
</html>`;e.statusCode=200,e.setHeader("Content-Type","text/html"),e.end(r)}serveStaticFile(e,r,n){let o=Fr.basename(n),i=[];if(this.context)try{i.push(this.context.asAbsolutePath(Fr.join("dist","swagger-ui",o)))}catch{}i.push(Fr.join(__dirname,"swagger-ui",o),Fr.join(__dirname,"..","swagger-ui",o),Fr.join(__dirname,"dist","swagger-ui",o));let s="";for(let a of i)if(kr.existsSync(a)){s=a;break}if(s){let a=kr.statSync(s),c=Fr.extname(s),l="text/plain";c===".css"?l="text/css":c===".js"&&(l="application/javascript"),r.writeHead(200,{"Content-Type":l,"Content-Length":a.size}),kr.createReadStream(s).pipe(r)}else{let a=`[Static] File not found: ${o}. Checked: ${JSON.stringify(i)}`;if(console.error(a),this.output.appendLine(`[${new Date().toISOString()}] ERROR ${a}`),this.context)try{let c=this.context.asAbsolutePath(Fr.join("dist","swagger-ui"));kr.existsSync(c)?this.output.appendLine(`Contents of ${c}: ${kr.readdirSync(c).join(", ")}`):this.output.appendLine(`Directory not found: ${c}`)}catch(c){this.output.appendLine(`Error listing directory: ${c}`)}r.statusCode=404,r.end("Not found")}}sendDebugPaths(e){let r={dirname:__dirname,cwd:process.cwd(),contextExtensionUri:this.context?.extensionUri.fsPath??"undefined",candidates_css:[],dist_swagger_contents:"N/A"},n="swagger-ui.css",o=[];if(this.context)try{let i=this.context.asAbsolutePath(Fr.join("dist","swagger-ui",n)),s=Fr.dirname(i),a="N/A";kr.existsSync(s)&&(a=kr.readdirSync(s).join(", ")),o.push({type:"context.asAbsolutePath",path:i,exists:kr.existsSync(i),dir_exists:kr.existsSync(s),dir_contents:a}),r.dist_swagger_contents=a}catch(i){o.push({error:String(i)})}o.push({type:"fallback_dirname",path:Fr.join(__dirname,"swagger-ui",n),exists:kr.existsSync(Fr.join(__dirname,"swagger-ui",n))}),r.candidates_css=o,e.statusCode=200,e.setHeader("Content-Type","application/json"),e.end(JSON.stringify(r,null,2))}getOpenApiSpec(){return{openapi:"3.1.0",info:{title:"Copilot API Gateway",description:"Local OpenAI-compatible API server powered by GitHub Copilot. Provides REST and WebSocket endpoints for chat completions, text completions, tokenization, and more.",version:"1.0.0",contact:{name:"GitHub Copilot API VS Code Extension"},license:{name:"MIT"}},servers:[{url:"/",description:"Local Copilot API Server"}],tags:[{name:"Chat",description:"Chat completion endpoints"},{name:"Completions",description:"Text completion endpoints"},{name:"Anthropic",description:"Anthropic Messages API compatible endpoints"},{name:"Google",description:"Google Generative AI API compatible endpoints"},{name:"Llama",description:"Meta Llama API compatible endpoints"},{name:"Models",description:"Model information"},{name:"Utilities",description:"Utility endpoints"},{name:"WebSocket",description:"Real-time WebSocket endpoints for all providers"}],paths:{"/v1/chat/completions":{post:{tags:["Chat"],summary:"Create chat completion",description:"Creates a chat completion for the given messages using the OpenAI format.\n\n**Supported Features:**\n- **Streaming:** Server-Sent Events (SSE)\n- **Function Calling:** Tool use with `tools` and `tool_choice`\n- **JSON Mode:** Structured output with `response_format`\n- **Token usage:** Detailed usage statistics",operationId:"createChatCompletion",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ChatCompletionRequest"},examples:{basic:{summary:"Basic chat",value:{model:this.config.defaultModel,messages:[{role:"user",content:"Hello!"}]}},streaming:{summary:"Streaming response",value:{model:this.config.defaultModel,messages:[{role:"user",content:"Tell me a story"}],stream:!0}},tools:{summary:"With tools/functions",value:{model:this.config.defaultModel,messages:[{role:"user",content:"What is the weather?"}],tools:[{type:"function",function:{name:"get_weather",description:"Get weather for a location",parameters:{type:"object",properties:{location:{type:"string"}},required:["location"]}}}]}}}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/ChatCompletionResponse"}},"text/event-stream":{description:"Server-sent events for streaming responses"}}},400:{description:"Bad request",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},401:{description:"Unauthorized",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},429:{description:"Rate limited",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/completions":{post:{tags:["Completions"],summary:"Create text completion",description:"Creates a text completion for the given prompt.",operationId:"createCompletion",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/CompletionRequest"},example:{model:this.config.defaultModel,prompt:"Once upon a time",max_tokens:100}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/CompletionResponse"}}}},400:{description:"Bad request"},401:{description:"Unauthorized"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/responses":{post:{tags:["Chat"],summary:"Create response (simplified API)",description:"Simplified OpenAI Responses API format for easier integration.",operationId:"createResponse",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ResponsesRequest"},example:{model:this.config.defaultModel,input:"What is 2+2?"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/ResponsesResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/models":{get:{tags:["Models"],summary:"List models",description:"Lists all available models from GitHub Copilot.",operationId:"listModels",responses:{200:{description:"List of models",content:{"application/json":{schema:{$ref:"#/components/schemas/ModelList"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/models/{model_id}":{get:{tags:["Models"],summary:"Get model",description:"Retrieves details about a specific model.",operationId:"getModel",parameters:[{name:"model_id",in:"path",required:!0,schema:{type:"string"},description:"The ID of the model"}],responses:{200:{description:"Model details",content:{"application/json":{schema:{$ref:"#/components/schemas/Model"}}}},404:{description:"Model not found"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/tokenize":{post:{tags:["Utilities"],summary:"Count tokens",description:"Counts the number of tokens in the given text.",operationId:"tokenize",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/TokenizeRequest"},example:{model:this.config.defaultModel,text:"Hello, world!"}}}},responses:{200:{description:"Token count",content:{"application/json":{schema:{$ref:"#/components/schemas/TokenizeResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/usage":{get:{tags:["Utilities"],summary:"Get usage statistics",description:"Returns usage statistics including request counts, token usage, and uptime.",operationId:"getUsage",responses:{200:{description:"Usage statistics",content:{"application/json":{schema:{$ref:"#/components/schemas/UsageResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/messages":{post:{tags:["Anthropic"],summary:"Anthropic Messages API",description:"Create a message using the Anthropic-compatible API format.",operationId:"anthropicMessages",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/AnthropicMessageRequest"},example:{model:"claude-3-5-sonnet-20240620",max_tokens:1024,messages:[{role:"user",content:"Hello, Claude"}]}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/AnthropicMessageResponse"}},"text/event-stream":{description:"Anthropic-style event stream"}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1beta/models/{model}:generateContent":{post:{tags:["Google"],summary:"Google Generative AI generateContent",description:"Generate content using the Google-compatible API format.",operationId:"googleGenerateContent",parameters:[{name:"model",in:"path",required:!0,schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentRequest"},example:{contents:[{role:"user",parts:[{text:"Write a story about a magic backpack"}]}],generationConfig:{temperature:.9,maxOutputTokens:200}}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1beta/models/{model}:streamGenerateContent":{post:{tags:["Google"],summary:"Google Generative AI streamGenerateContent",description:"Stream content generation using the Google-compatible API format.",operationId:"googleStreamGenerateContent",parameters:[{name:"model",in:"path",required:!0,schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/GoogleGenerateContentResponse"}}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/llama/v1/chat/completions":{post:{tags:["Llama"],summary:"Llama Chat Completions",description:"Create a chat completion using the Llama-compatible API format.\n\nCompatible with `llama-api` Python/JS SDKs. Supports standard OpenAI parameters including `max_completion_tokens`.",operationId:"llamaChatCompletions",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/LlamaMessageRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/LlamaMessageResponse"}},"text/event-stream":{description:"OpenAI-style SSE event stream for streaming responses"}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/health":{get:{tags:["Utilities"],summary:"Health check",description:"Simple health check endpoint for monitoring.",operationId:"healthCheck",responses:{200:{description:"Service is healthy",content:{"application/json":{schema:{type:"object",properties:{status:{type:"string",example:"ok"},service:{type:"string",example:"github-copilot-api-vscode"}}}}}}}}},"/v1/realtime":{get:{tags:["WebSocket"],summary:"OpenAI Realtime WebSocket",description:"Initiate a WebSocket connection for real-time chat completions using the OpenAI format. Requires `Upgrade: websocket` header.",operationId:"connectOpenAIRealtime",responses:{101:{description:"Switching Protocols to WebSocket"},426:{description:"Upgrade Required - Use WebSocket client"}}}},"/anthropic/v1/realtime":{get:{tags:["WebSocket","Anthropic"],summary:"Anthropic Realtime WebSocket",description:"Initiate a WebSocket connection using the Anthropic Messages API format.",operationId:"connectAnthropicRealtime",responses:{101:{description:"Switching Protocols to WebSocket"},426:{description:"Upgrade Required - Use WebSocket client"}}}},"/google/v1/realtime":{get:{tags:["WebSocket","Google"],summary:"Google Realtime WebSocket",description:"Initiate a WebSocket connection using the Google Gemini format.",operationId:"connectGoogleRealtime",responses:{101:{description:"Switching Protocols to WebSocket"},426:{description:"Upgrade Required - Use WebSocket client"}}}},"/llama/v1/realtime":{get:{tags:["WebSocket","Llama"],summary:"Llama Realtime WebSocket",description:"Initiate a WebSocket connection using the Llama/OpenAI format.",operationId:"connectLlamaRealtime",responses:{101:{description:"Switching Protocols to WebSocket"},426:{description:"Upgrade Required - Use WebSocket client"}}}}},components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer",description:"API key authentication (optional, configure in extension settings)"}},schemas:{ChatCompletionRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string",description:"Model ID to use",example:this.config.defaultModel},messages:{type:"array",items:{$ref:"#/components/schemas/Message"},description:"List of messages in the conversation"},stream:{type:"boolean",default:!1,description:"Enable streaming responses"},temperature:{type:"number",minimum:0,maximum:2,description:"Sampling temperature"},max_tokens:{type:"integer",description:"Maximum tokens to generate"},tools:{type:"array",items:{$ref:"#/components/schemas/Tool"},description:"List of tools/functions available"},tool_choice:{type:"string",description:"How to select tools: auto, none, or specific"},response_format:{type:"object",properties:{type:{type:"string",enum:["text","json_object"]}},description:"Response format (json_object for JSON mode)"}}},Message:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["system","user","assistant","tool"],description:"Role of the message sender"},content:{type:"string",description:"Message content"},name:{type:"string",description:"Name of the sender (optional)"},tool_calls:{type:"array",items:{$ref:"#/components/schemas/ToolCall"}},tool_call_id:{type:"string",description:"ID of tool call this message responds to"}}},Tool:{type:"object",required:["type","function"],properties:{type:{type:"string",enum:["function"]},function:{type:"object",required:["name"],properties:{name:{type:"string"},description:{type:"string"},parameters:{type:"object",description:"JSON Schema for function parameters"}}}}},ToolCall:{type:"object",properties:{id:{type:"string"},type:{type:"string",enum:["function"]},function:{type:"object",properties:{name:{type:"string"},arguments:{type:"string"}}}}},ChatCompletionResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"chat.completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{index:{type:"integer"},message:{$ref:"#/components/schemas/Message"},finish_reason:{type:"string",enum:["stop","length","tool_calls"]}}}},usage:{$ref:"#/components/schemas/Usage"}}},CompletionRequest:{type:"object",required:["model","prompt"],properties:{model:{type:"string"},prompt:{type:"string",description:"Text prompt to complete"},max_tokens:{type:"integer",default:100},temperature:{type:"number"}}},CompletionResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"text_completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{text:{type:"string"},index:{type:"integer"},finish_reason:{type:"string"}}}},usage:{$ref:"#/components/schemas/Usage"}}},ResponsesRequest:{type:"object",required:["input"],properties:{model:{type:"string"},input:{type:"string",description:"User input/question"},instructions:{type:"string",description:"System instructions"}}},ResponsesResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string"},created_at:{type:"integer"},output:{type:"array",items:{type:"object",properties:{type:{type:"string"},content:{type:"array",items:{type:"object",properties:{type:{type:"string"},text:{type:"string"}}}}}}},usage:{$ref:"#/components/schemas/Usage"}}},TokenizeRequest:{type:"object",required:["text"],properties:{model:{type:"string"},text:{type:"string",description:"Text to tokenize"}}},TokenizeResponse:{type:"object",properties:{model:{type:"string"},token_count:{type:"integer"}}},ModelList:{type:"object",properties:{object:{type:"string",example:"list"},data:{type:"array",items:{$ref:"#/components/schemas/Model"}}}},Model:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"model"},created:{type:"integer"},owned_by:{type:"string"}}},UsageResponse:{type:"object",properties:{object:{type:"string",example:"usage"},total_requests:{type:"integer"},total_tokens:{type:"object",properties:{input:{type:"integer"},output:{type:"integer"},total:{type:"integer"}}},uptime_seconds:{type:"integer"},active_requests:{type:"integer"}}},Usage:{type:"object",properties:{prompt_tokens:{type:"integer"},completion_tokens:{type:"integer"},total_tokens:{type:"integer"}}},Error:{type:"object",properties:{error:{type:"object",properties:{message:{type:"string"},type:{type:"string"},code:{type:"string"}}}}},AnthropicMessageRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string"},messages:{type:"array",items:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["user","assistant"]},content:{type:"string"}}}},system:{type:"string"},max_tokens:{type:"integer"},stream:{type:"boolean"}}},AnthropicMessageResponse:{type:"object",properties:{id:{type:"string"},type:{type:"string",example:"message"},role:{type:"string",example:"assistant"},content:{type:"array",items:{type:"object",properties:{type:{type:"string",example:"text"},text:{type:"string"}}}},model:{type:"string"},stop_reason:{type:"string"},usage:{type:"object",properties:{input_tokens:{type:"integer"},output_tokens:{type:"integer"}}}}},GoogleGenerateContentRequest:{type:"object",required:["contents"],properties:{contents:{type:"array",items:{type:"object",required:["parts"],properties:{role:{type:"string",enum:["user","model"]},parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}}},systemInstruction:{type:"object",properties:{parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}},generationConfig:{type:"object"}}},GoogleGenerateContentResponse:{type:"object",properties:{candidates:{type:"array",items:{type:"object",properties:{content:{type:"object",properties:{role:{type:"string"},parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}},finishReason:{type:"string"}}}},usageMetadata:{type:"object",properties:{promptTokenCount:{type:"integer"},candidatesTokenCount:{type:"integer"},totalTokenCount:{type:"integer"}}}}},LlamaMessageRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string",description:"Model ID to use"},messages:{type:"array",description:"List of messages in the conversation",items:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["system","user","assistant","tool"]},content:{type:"string"}}}},temperature:{type:"number",minimum:0,maximum:2},max_tokens:{type:"integer",description:"Maximum tokens to generate"},max_completion_tokens:{type:"integer",description:"Llama-style max tokens parameter"},stream:{type:"boolean",default:!1},top_p:{type:"number"},stop:{oneOf:[{type:"string"},{type:"array",items:{type:"string"}}]}}},LlamaMessageResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"chat.completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{index:{type:"integer"},message:{type:"object",properties:{role:{type:"string",example:"assistant"},content:{type:"string"}}},finish_reason:{type:"string",enum:["stop","length","tool_calls","content_filter"]}}}},usage:{type:"object",properties:{prompt_tokens:{type:"integer"},completion_tokens:{type:"integer"},total_tokens:{type:"integer"}}}}}}}}}sendError(e,r){let n=r.status??500,o={error:{message:r.message,type:r.type,code:r.code??null,param:null}};this.sendJson(e,n,o)}sendWsError(e,r){e.send(JSON.stringify({type:"error",error:{message:r.message,type:r.type,code:r.code??null}}))}setCorsHeaders(e){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Headers","authorization, content-type, x-requested-with"),e.setHeader("Access-Control-Allow-Methods","GET,POST,OPTIONS")}checkRateLimit(){if(this.config.rateLimitPerMinute<=0)return!0;let e=Date.now(),r=e-6e4;return this.rateLimitBucket=this.rateLimitBucket.filter(n=>n>r),this.rateLimitBucket.length>=this.config.rateLimitPerMinute?!1:(this.rateLimitBucket.push(e),!0)}getClientIp(e){let r=e.headers["x-forwarded-for"];if(r){let i=(typeof r=="string"?r:r[0])?.split(",")[0]?.trim();if(i)return i}let n=e.socket.remoteAddress||"unknown";return n.startsWith("::ffff:")?n.substring(7):n}checkIpAllowlist(e){let r=this.config.ipAllowlist;if(!r||r.length===0)return!0;let n=e.socket.remoteAddress;if(!n)return!1;let o=n.startsWith("::ffff:")?n.substring(7):n;for(let i of r)if(i.includes("/")){if(this.isIpInCidr(o,i))return!0}else if(/^[\d\.]+$|^[\da-fA-F:]+$/.test(i)){if(i===o)return!0}else{let s=this.domainCache.get(i);if(s&&s.includes(o))return!0}return!1}async refreshDomainCache(){let e=await import("dns").then(r=>r.promises);for(let r of this.config.ipAllowlist)if(/[a-zA-Z]/.test(r)&&!r.includes("/"))try{let n=await e.resolve4(r).catch(()=>[]),o=await e.resolve6(r).catch(()=>[]),i=[...n,...o];i.length>0&&this.domainCache.set(r,i)}catch{}}isIpInCidr(e,r){try{let[n,o]=r.split("/"),i=~(2**(32-parseInt(o,10))-1),s=e.split(".").map(Number),a=n.split(".").map(Number),c=s[0]<<24|s[1]<<16|s[2]<<8|s[3],l=a[0]<<24|a[1]<<16|a[2]<<8|a[3];return(c&i)===(l&i)}catch{return!1}}logRequest(e,r,n,o,i,s){let a=o>=400,c=s?.tokensIn??0,l=s?.tokensOut??0;this.recordRequestStats(i,c,l,a);let u={timestamp:new Date().toISOString(),requestId:e,method:r,path:n,status:o,durationMs:i,tokensIn:s?.tokensIn,tokensOut:s?.tokensOut,error:s?.error,model:s?.model,requestBody:s?.requestPayload,responseBody:s?.responsePayload,requestHeaders:s?.requestHeaders,responseHeaders:s?.responseHeaders},d=this.redactSensitiveData(u);if(this.auditService.logRequest(d),this._onDidLogRequest.fire(d),this.wsServer){let p=JSON.stringify({type:"log",data:d});this.wsServer.clients.forEach(f=>{f.readyState===1&&f.send(p)})}if(this.config.enableLogging){let p=a?"\u274C":o>=300?"\u26A0\uFE0F":"\u2705";this.output.appendLine(`[${new Date().toLocaleTimeString()}] ${p} ${r} ${n} ${o} (${i}ms)`),s?.error&&this.output.appendLine(`  Error: ${s.error}`)}}getCacheKey(e){return JSON.stringify({model:e?.model,messages:e?.messages,prompt:e?.prompt,tools:e?.tools,stream:e?.stream})}getFromCache(e){let r=this.requestCache.get(e);if(r&&Date.now()-r.timestamp<this.CACHE_TTL_MS)return r.response;this.requestCache.delete(e)}setCache(e,r){if(this.requestCache.size>100){let n=Date.now();for(let[o,i]of this.requestCache.entries())n-i.timestamp>this.CACHE_TTL_MS&&this.requestCache.delete(o)}this.requestCache.set(e,{response:r,timestamp:Date.now()})}buildUrl(e){let r=`http://${this.config.host}:${this.config.port}`;return new URL(e??"/",r)}async updateServerConfig(e){this.config={...this.config,...e},this._onDidChangeStatus.fire();let r=P.workspace.getConfiguration("githubCopilotApi"),n=[];e.enabled!==void 0&&n.push(Promise.resolve(r.update("server.enabled",e.enabled,P.ConfigurationTarget.Global))),e.enableHttp!==void 0&&n.push(Promise.resolve(r.update("server.enableHttp",e.enableHttp,P.ConfigurationTarget.Global))),e.enableWebSocket!==void 0&&n.push(Promise.resolve(r.update("server.enableWebSocket",e.enableWebSocket,P.ConfigurationTarget.Global))),e.enableHttps!==void 0&&n.push(Promise.resolve(r.update("server.enableHttps",e.enableHttps,P.ConfigurationTarget.Global))),e.host!==void 0&&n.push(Promise.resolve(r.update("server.host",e.host,P.ConfigurationTarget.Global))),e.port!==void 0&&n.push(Promise.resolve(r.update("server.port",e.port,P.ConfigurationTarget.Global))),e.maxConcurrentRequests!==void 0&&n.push(Promise.resolve(r.update("server.maxConcurrentRequests",e.maxConcurrentRequests,P.ConfigurationTarget.Global))),e.defaultModel!==void 0&&n.push(Promise.resolve(r.update("server.defaultModel",e.defaultModel,P.ConfigurationTarget.Global))),e.enableLogging!==void 0&&n.push(Promise.resolve(r.update("server.enableLogging",e.enableLogging,P.ConfigurationTarget.Global))),e.apiKey!==void 0&&n.push(Promise.resolve(r.update("server.apiKey",e.apiKey,P.ConfigurationTarget.Global))),e.rateLimitPerMinute!==void 0&&n.push(Promise.resolve(r.update("server.rateLimitPerMinute",e.rateLimitPerMinute,P.ConfigurationTarget.Global))),e.requestTimeoutSeconds!==void 0&&n.push(Promise.resolve(r.update("server.requestTimeoutSeconds",e.requestTimeoutSeconds,P.ConfigurationTarget.Global))),e.maxPayloadSizeMb!==void 0&&n.push(Promise.resolve(r.update("server.maxPayloadSizeMb",e.maxPayloadSizeMb,P.ConfigurationTarget.Global))),e.maxConnectionsPerIp!==void 0&&n.push(Promise.resolve(r.update("server.maxConnectionsPerIp",e.maxConnectionsPerIp,P.ConfigurationTarget.Global))),e.redactionPatterns!==void 0&&n.push(Promise.resolve(r.update("server.redactionPatterns",e.redactionPatterns,P.ConfigurationTarget.Global))),e.ipAllowlist!==void 0&&n.push(Promise.resolve(r.update("server.ipAllowlist",e.ipAllowlist,P.ConfigurationTarget.Global))),this.suppressRestart=!0;try{await Promise.all(n)}finally{this.suppressRestart=!1}await this.restart()}updateStatusBar(e,r){let n=`${this.config.enableHttp?"HTTP":""}${this.config.enableHttp&&this.config.enableWebSocket?"+":""}${this.config.enableWebSocket?"WS":""}`||"disabled";if(e==="starting"){this.statusItem.text="$(broadcast) Copilot API: Starting\u2026",this.statusItem.tooltip="Starting Copilot API gateway",this.statusItem.show();return}if(e==="running"){this.statusItem.text=`$(broadcast) Copilot API: On (${n})`;let o=`${this.config.host}:${this.config.port}`;this.statusItem.tooltip=r||`Copilot API is running on ${o}`,this.statusItem.show();return}this.statusItem.text="$(broadcast) Copilot API: Off",this.statusItem.tooltip=r??"Copilot API gateway is stopped",this.statusItem.hide()}async showControlPalette(){let e=P.workspace.getConfiguration("githubCopilotApi"),r=[{label:"$(check) Start HTTP + WebSocket",description:"Enable and start all endpoints"},{label:"$(primitive-square) Stop Server",description:"Disable all endpoints"},{label:`${this.config.enableHttp?"$(circle-slash)":"$(play)"} Toggle HTTP`,description:this.config.enableHttp?"Disable HTTP REST endpoints":"Enable HTTP REST endpoints"},{label:`${this.config.enableWebSocket?"$(circle-slash)":"$(play)"} Toggle WebSocket`,description:this.config.enableWebSocket?"Disable WebSocket realtime endpoint":"Enable WebSocket realtime endpoint"},{label:"$(globe) Listen on localhost",description:"Bind to 127.0.0.1"},{label:"$(rss) Listen on all interfaces",description:"Bind to 0.0.0.0 for LAN access"},{label:"$(plug) Change port",description:`Current: ${this.config.port}`},{label:"$(settings) Open settings",description:"Open Copilot API settings"}],n=await P.window.showQuickPick(r,{placeHolder:"Copilot API controls"});if(n){if(n.label.includes("Start")){await e.update("server.enabled",!0,P.ConfigurationTarget.Global),await e.update("server.enableHttp",!0,P.ConfigurationTarget.Global),await e.update("server.enableWebSocket",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("Stop")){await e.update("server.enabled",!1,P.ConfigurationTarget.Global);return}if(n.label.includes("Toggle HTTP")){await e.update("server.enableHttp",!this.config.enableHttp,P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("Toggle WebSocket")){await e.update("server.enableWebSocket",!this.config.enableWebSocket,P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("localhost")){await e.update("server.host","127.0.0.1",P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("all interfaces")){await e.update("server.host","0.0.0.0",P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("Change port")){let o=await P.window.showInputBox({title:"Set API server port",value:String(this.config.port),validateInput:i=>{let s=Number(i);return!Number.isFinite(s)||s<=0||s>65535?"Enter a valid port between 1 and 65535":null}});o&&(await e.update("server.port",Number(o),P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global));return}n.label.includes("settings")&&await P.commands.executeCommand("workbench.action.openSettings","githubCopilotApi.server")}}logInfo(e){this.output.appendLine(`[${new Date().toISOString()}] INFO ${e}`)}logError(e,r){this.output.appendLine(`[${new Date().toISOString()}] ERROR ${e}: ${Jl(r)}`)}};async function iA(){let t=P.extensions.getExtension(Lbe);if(!t)return await P.window.showWarningMessage("GitHub Copilot Chat extension is required. Install it from the Marketplace to continue.","Open Marketplace","Cancel")==="Open Marketplace"&&await P.commands.executeCommand("workbench.extensions.search",Fbe),!1;if(!t.isActive)try{await t.activate()}catch(e){return P.window.showErrorMessage(`Failed to activate GitHub Copilot Chat: ${Jl(e)}`),!1}return!0}function PD(t){if(typeof t=="string")return t.trim()||void 0;if(Array.isArray(t))return t.map(e=>typeof e=="string"?e:"").join(" ").trim()||void 0}function LK(){let t=P.workspace.getConfiguration("githubCopilotApi"),e=t.get("server.enabled",!1),r=t.get("server.enableHttp",!0),n=t.get("server.enableWebSocket",!0),o=t.get("server.enableHttps",!1),i=t.get("server.tlsCertPath","").trim(),s=t.get("server.tlsKeyPath","").trim(),a=t.get("server.host","127.0.0.1").trim()||"127.0.0.1",c=t.get("server.port",3030),l=Number.isFinite(c)?Math.max(1,Math.floor(c)):3030,u=t.get("server.maxConcurrentRequests",4),d=Number.isFinite(u)?Math.max(1,Math.floor(u)):4,p=(t.get("server.defaultModel","gpt-4o-copilot")??"gpt-4o-copilot").trim()||"gpt-4o-copilot",f=t.get("server.apiKey","").trim(),m=t.get("server.enableLogging",!1),h=t.get("server.rateLimitPerMinute",60),g=Number.isFinite(h)?Math.max(0,Math.floor(h)):60,v=t.get("server.defaultSystemPrompt","").trim(),S=t.get("server.redactionPatterns",[]).map((Ge,dr)=>typeof Ge=="string"?{id:`migrated-${dr}`,name:`Custom Pattern ${dr+1}`,pattern:Ge,enabled:!0,isBuiltin:!1}:Ge),j=[];for(let Ge of Vbe){let dr=S.find(nn=>nn.id===Ge.id);dr?j.push({...Ge,enabled:dr.enabled}):j.push(Ge)}for(let Ge of S)Ge.isBuiltin||j.push(Ge);let C=t.get("server.ipAllowlist",[]),ie=t.get("server.requestTimeoutSeconds",180),pe=t.get("server.maxPayloadSizeMb",1),me=t.get("server.maxConnectionsPerIp",10),Ce=P.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0);return{enabled:e,enableHttp:r,enableWebSocket:n,enableHttps:o,tlsCertPath:i,tlsKeyPath:s,host:a,port:l,maxConcurrentRequests:d,defaultModel:p,apiKey:f,enableLogging:m,rateLimitPerMinute:g,defaultSystemPrompt:v,redactionPatterns:j,ipAllowlist:C,requestTimeoutSeconds:ie,maxPayloadSizeMb:pe,maxConnectionsPerIp:me,mcpEnabled:Ce}}function Jl(t){return t instanceof Error&&t.message?t.message:String(t)}var ur=ct(require("vscode")),Fa=class t{constructor(e,r){this._extensionUri=e;this._gateway=r;this._gateway.onDidChangeStatus(async()=>{let n=await this._gateway.getStatus();if(this._lastRunningState===n.running){this._view&&(this._view.webview.postMessage({type:"statsData",data:n.stats}),this._view.webview.postMessage({type:"realtimeStats",data:n.realtimeStats})),t.currentPanel&&(t.currentPanel.webview.postMessage({type:"statsData",data:n.stats}),t.currentPanel.webview.postMessage({type:"realtimeStats",data:n.realtimeStats}));return}this._lastRunningState=n.running,this._view&&(this._view.webview.html=await this._getSidebarHtml(this._view.webview)),t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,this._gateway))}),this._gateway.onDidLogRequest(n=>{this._view&&this._view.webview.postMessage({type:"liveLog",value:n}),t.currentPanel&&t.currentPanel.webview.postMessage({type:"liveLog",value:n})}),this._gateway.onDidLogRequestStart(n=>{this._view&&this._view.webview.postMessage({type:"liveLogStart",value:n}),t.currentPanel&&t.currentPanel.webview.postMessage({type:"liveLogStart",value:n})})}static viewType="copilotApiControls";_view;static currentPanel;_lastRunningState;static panelDisposables=[];static async createOrShow(e,r,n){let o=ur.window.activeTextEditor?.viewColumn??ur.ViewColumn.One;if(t.currentPanel){t.currentPanel.reveal(o),t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r),n&&t.currentPanel.webview.postMessage({type:"scrollTo",target:n});return}let i=ur.window.createWebviewPanel("copilotApiDashboard","Copilot API Dashboard",o,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});t.currentPanel=i,i.webview.html=await t.getPanelHtml(i.webview,r),n&&setTimeout(()=>{i.webview.postMessage({type:"scrollTo",target:n})},300),i.webview.onDidReceiveMessage(s=>{t.handleMessage(s,r)},void 0,t.panelDisposables),i.onDidDispose(()=>{t.currentPanel=void 0;for(let s of t.panelDisposables)s.dispose();t.panelDisposables=[]},null,t.panelDisposables)}static handleMessage(e,r){switch(e.type){case"openChat":ur.commands.executeCommand("github-copilot-api-vscode.openCopilotChat");break;case"askCopilot":ur.commands.executeCommand("github-copilot-api-vscode.askCopilot");break;case"showControls":ur.commands.executeCommand("github-copilot-api-vscode.showServerControls");break;case"startServer":r.startServer();break;case"stopServer":r.stopServer();break;case"toggleHttp":r.toggleHttp();break;case"toggleWs":r.toggleWebSocket();break;case"toggleLogging":r.toggleLogging();break;case"toggleHttps":r.toggleHttps();break;case"setApiKey":typeof e.value=="string"&&r.setApiKey(e.value);break;case"setRateLimit":typeof e.value=="number"&&r.setRateLimit(e.value);break;case"hostLocal":r.setHost("127.0.0.1");break;case"hostLan":r.setHost("0.0.0.0");break;case"setHost":typeof e.value=="string"&&r.setHost(e.value);break;case"setPort":typeof e.value=="number"&&r.setPort(e.value);break;case"setModel":typeof e.value=="string"&&r.setDefaultModel(e.value);break;case"clearHistory":r.clearHistory();break;case"toggleMcp":typeof e.value=="boolean"&&r.toggleMcp(e.value);break;case"addRedactionPattern":if(e.value&&typeof e.value=="object"){let{name:o,pattern:i}=e.value;r.addRedactionPattern(o,i).then(async s=>{s?t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r)):ur.window.showErrorMessage("Invalid regex pattern")})}break;case"removeRedactionPattern":typeof e.value=="string"&&r.removeRedactionPattern(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"toggleRedactionPattern":if(e.value&&typeof e.value=="object"){let{id:o,enabled:i}=e.value;r.toggleRedactionPattern(o,i)}break;case"addIpAllowlistEntry":typeof e.value=="string"&&r.addIpAllowlistEntry(e.value).then(async o=>{o?t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r)):ur.window.showErrorMessage("Invalid IP address or CIDR range")});break;case"removeIpAllowlistEntry":typeof e.value=="string"&&r.removeIpAllowlistEntry(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setRequestTimeout":typeof e.value=="number"&&r.setRequestTimeout(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxPayloadSize":typeof e.value=="number"&&r.setMaxPayloadSize(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxConnectionsPerIp":typeof e.value=="number"&&r.setMaxConnectionsPerIp(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxConcurrency":typeof e.value=="number"&&r.setMaxConcurrency(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"getHistory":if(t.currentPanel){let o=r.getHistory(50);t.currentPanel.webview.postMessage({type:"historyData",data:o})}break;case"getStats":t.currentPanel&&t.currentPanel.webview.postMessage({type:"statsData",data:r.getStats()});break;case"getAuditStats":t.currentPanel&&r.getDailyStats(30).then(o=>{t.currentPanel?.webview.postMessage({type:"auditStatsData",data:o})});break;case"getAuditLogs":if(t.currentPanel){let o=e.value||{},i=o.page||1,s=o.pageSize||10;r.getAuditLogs(i,s).then(a=>{a.total,a.entries.length,t.currentPanel?.webview.postMessage({type:"auditLogData",data:a.entries,page:i,total:a.total,pageSize:s})}).catch(a=>{console.error("[CopilotPanel] Error getting audit logs:",a),t.currentPanel?.webview.postMessage({type:"auditLogData",data:[],page:i,total:0,pageSize:s})})}else console.warn("[CopilotPanel] No currentPanel available for getAuditLogs response");break;case"openLogFolder":let n=r.getLogFolderPath();n?ur.commands.executeCommand("revealFileInOS",ur.Uri.file(n)):ur.window.showErrorMessage("Log folder not found");break;case"generatePrompt":case"enhancePrompt":if(e.data&&typeof e.data=="object"){let o=e.data,s=e.type==="enhancePrompt"?`You are an expert prompt engineer. Enhance and improve the following prompt to make it more detailed, specific, and effective:

${o.existingPrompt||o.context}

Make it more comprehensive with clear objectives, constraints, and expected deliverables.`:`You are an expert prompt engineer. Create a comprehensive, high-quality prompt for an AI coding assistant based on these specifications:

${o.projectType?`**Project Type:** ${o.projectType}`:""}
${o.techStack?`**Tech Stack:** ${o.techStack}`:""}
${o.goal?`**Goal:** ${o.goal}`:""}
${o.complexity?`**Complexity Level:** ${o.complexity}`:""}
${o.context?`**User Description:** ${o.context}`:""}

Generate a detailed, actionable prompt that includes:
1. Clear project objective and scope
2. Specific technical requirements
3. Step-by-step implementation plan
4. Best practices and considerations
5. Expected deliverables and success criteria

Format the output as a ready-to-use prompt that the user can copy and paste into an AI assistant.`;r.invokeCopilot(s).then(a=>{t.currentPanel&&t.currentPanel.webview.postMessage({type:"promptResult",data:a})}).catch(a=>{t.currentPanel&&t.currentPanel.webview.postMessage({type:"promptError",error:a.message})})}break}}async _getSidebarHtml(e){let r=VK(),n=await this._gateway.getStatus(),o=n.running,i=o?"var(--vscode-testing-iconPassed)":"var(--vscode-testing-iconFailed)",s=o?"Running":"Stopped",a=n.isHttps?"https":"http",c=n.config.host==="0.0.0.0"&&n.networkInfo?.localIPs?.length?n.networkInfo.localIPs[0]:n.config.host,l=`${a}://${c}:${n.config.port}`,u=n.stats||{totalRequests:0,totalTokensIn:0,totalTokensOut:0,requestsPerMinute:0,avgLatencyMs:0},d=n.realtimeStats||{requestsPerMinute:0,avgLatencyMs:0,errorRate:0},p=await this._gateway.getDailyStats(7),f=Math.max(...p.map(S=>S.totalRequests),1),m=20,h=6,g=50,v=(m+h)*7,b=p.map((S,j)=>{let C=Math.max(2,S.totalRequests/f*g),ie=j*(m+h),pe=g-C,me=new Date(S.date).toLocaleDateString("en",{weekday:"short"}).charAt(0);return`
                <rect x="${ie}" y="${pe}" width="${m}" height="${C}" rx="3" fill="var(--vscode-charts-blue)" opacity="0.8"/>
                <text x="${ie+m/2}" y="${g+12}" font-size="8" fill="var(--vscode-descriptionForeground)" text-anchor="middle">${me}</text>
            `}).join("");return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${r}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 0; font-family: var(--vscode-font-family); color: var(--vscode-foreground); background: var(--vscode-sideBar-background); }
        .section { padding: 12px; border-bottom: 1px solid var(--vscode-widget-border); }
        .section:last-child { border-bottom: none; }
        .section-title { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.6; margin-bottom: 10px; font-weight: 600; }
        .status-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: ${i}; box-shadow: 0 0 6px ${i}; }
        .url { font-family: var(--vscode-editor-font-family); font-size: 10px; opacity: 0.7; word-break: break-all; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .stat-card { background: var(--vscode-editor-background); border-radius: 6px; padding: 8px 10px; text-align: center; border: 1px solid var(--vscode-widget-border); }
        .stat-value { font-size: 18px; font-weight: 700; color: var(--vscode-foreground); }
        .stat-label { font-size: 9px; text-transform: uppercase; opacity: 0.6; margin-top: 2px; }
        .chart-container { background: var(--vscode-editor-background); border-radius: 8px; padding: 12px; border: 1px solid var(--vscode-widget-border); }
        .chart-title { font-size: 11px; font-weight: 600; margin-bottom: 8px; opacity: 0.9; }
        button { width: 100%; padding: 8px 12px; margin-bottom: 6px; background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; border-radius: 4px; cursor: pointer; font-family: var(--vscode-font-family); font-weight: 500; font-size: 12px; }
        button:hover { background: var(--vscode-button-hoverBackground); }
        button.secondary { background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }
        button.secondary:hover { background: var(--vscode-button-secondaryHoverBackground); }
        .btn-row { display: flex; gap: 6px; margin-bottom: 6px; }
        .btn-row button { flex: 1; padding: 6px 8px; font-size: 11px; margin-bottom: 0; }
        .copilot-status { font-size: 10px; opacity: 0.7; display: flex; align-items: center; gap: 5px; margin-top: 4px; }
        .copilot-dot { width: 6px; height: 6px; border-radius: 50%; }
    </style>
</head>
<body>
    <!-- Status Section (at top) -->
    <div class="section">
        <div class="section-title">Server Status</div>
        <div class="status-row">
            <div class="dot"></div>
            <strong>${s}</strong>
        </div>
        <div class="url">${l}</div>
        <div class="copilot-status">
            <div class="copilot-dot" style="background: ${n.copilot.ready?"var(--vscode-testing-iconPassed)":"var(--vscode-editorWarning-foreground)"}"></div>
            Copilot: ${n.copilot.ready?"Ready":n.copilot.signedIn?"Checking":"Sign-in Needed"}
        </div>
    </div>

    <!-- Actions Section -->
    <div class="section">
        <div class="section-title">\u26A1 Actions</div>
        <button id="btn-dashboard">Open Dashboard</button>
        <button id="btn-apps" class="secondary">Open Apps Hub</button>
        <button id="btn-toggle" class="secondary">${o?"\u23F9 Stop Server":"\u25B6 Start Server"}</button>
        <button id="btn-swagger" class="secondary">\u{1F4DD} Swagger API</button>
        <button id="btn-metrics" class="secondary">\u{1F4CA} Prometheus Metrics</button>
        <button id="btn-wiki" class="secondary">\u{1F4DA} Wiki</button>
        <button id="btn-prompt" class="secondary">\u2728 Prompt Generator</button>
    </div>

    <!-- Analytics Section -->
    <div class="section">
        <div class="section-title">\u{1F4CA} Live Stats</div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="stat-rpm">${d.requestsPerMinute}</div>
                <div class="stat-label">Req/Min</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-latency">${d.avgLatencyMs}<span style="font-size: 10px; opacity: 0.6;">ms</span></div>
                <div class="stat-label">Latency</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-total">${u.totalRequests}</div>
                <div class="stat-label">Total Reqs</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-errors">${d.errorRate}<span style="font-size: 10px; opacity: 0.6;">%</span></div>
                <div class="stat-label">Errors</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">Requests (Last 7 Days)</div>
            <svg width="${v}" height="${g+16}" style="display: block; margin: 0 auto;">
                ${b}
            </svg>
        </div>
    </div>

    <!-- Token Usage Section -->
    <div class="section">
        <div class="section-title">\u{1F3AB} Token Usage</div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" style="font-size: 14px; color: var(--vscode-charts-green);">${this.formatNumber(u.totalTokensIn)}</div>
                <div class="stat-label">Tokens In</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="font-size: 14px; color: var(--vscode-charts-orange);">${this.formatNumber(u.totalTokensOut)}</div>
                <div class="stat-label">Tokens Out</div>
        </div>
    </div>

    <!-- GitHub Star Section -->
    <div class="section" style="text-align: center; padding: 16px 12px;">
        <a href="https://github.com/suhaibbinyounis/github-copilot-api-vscode" 
           target="_blank" 
           style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border-radius: 6px; text-decoration: none; font-size: 12px; font-weight: 500; transition: background 0.15s ease;">
            \u2B50 Star on GitHub
        </a>
        <div style="margin-top: 8px; font-size: 10px; opacity: 0.6;">If you find this useful, please star the repo!</div>
    </div>

    <script nonce="${r}">
        const vscode = acquireVsCodeApi();
        document.getElementById('btn-dashboard').addEventListener('click', () => vscode.postMessage({ type: 'openDashboard' }));
        document.getElementById('btn-apps').addEventListener('click', () => vscode.postMessage({ type: 'openAppsHub' }));
        document.getElementById('btn-toggle').addEventListener('click', () => vscode.postMessage({ type: '${o?"stopServer":"startServer"}' }));
        document.getElementById('btn-swagger').addEventListener('click', () => vscode.postMessage({ type: 'openSwagger' }));
        document.getElementById('btn-metrics').addEventListener('click', () => vscode.postMessage({ type: 'openMetrics' }));
        document.getElementById('btn-wiki').addEventListener('click', () => vscode.postMessage({ type: 'openWiki' }));
        document.getElementById('btn-prompt').addEventListener('click', () => vscode.postMessage({ type: 'openPromptGenerator' }));
    </script>
</body>
</html>`}formatNumber(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}static async getPanelHtml(e,r){let n=VK(),o=await r.getStatus(),i=o.config,s=o.running,a=s?"var(--vscode-testing-iconPassed)":"var(--vscode-testing-iconFailed)",c=s?"Running":"Stopped",l=o.isHttps?"https":"http",u=o.networkInfo,d=i.host==="0.0.0.0"&&u?.localIPs?.length?u.localIPs[0]:i.host,p=`${l}://${d}:${i.port}`;return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}' https://cdn.jsdelivr.net; connect-src http: https:;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot API Dashboard</title>
    <title>Copilot API Dashboard</title>
    <!-- Removed Chart.js for reliability -->
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        body {
            margin: 0; padding: 0; min-height: 100vh;
            background: radial-gradient(120% 120% at 20% 20%, rgba(56,189,248,0.05), transparent),
                        radial-gradient(120% 120% at 80% 0%, rgba(147,197,253,0.05), transparent),
                        var(--vscode-editor-background);
            font-family: var(--vscode-font-family); color: var(--vscode-foreground);
        }
        .page { max-width: 1400px; margin: 0 auto; padding: 32px 32px 64px; display: flex; flex-direction: column; gap: 24px; }
        .hero { display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; padding-bottom: 8px; }
        .hero h1 { margin: 0; font-size: 26px; letter-spacing: -0.4px; font-weight: 700; }
        .hero p { margin: 6px 0 0 0; opacity: 0.7; font-size: 14px; max-width: 600px; line-height: 1.5; }
        .badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px; background: var(--vscode-badge-background); color: var(--vscode-badge-foreground); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .card { background-color: var(--vscode-editorWidget-background); border: 1px solid var(--vscode-widget-border); border-radius: 12px; padding: 24px; box-shadow: 0 4px 24px rgba(0,0,0,0.06); transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.12); border-color: var(--vscode-focusBorder); }
        .card.full-width { grid-column: 1 / -1; }
        h3 { margin-top: 0; margin-bottom: 10px; font-size: 12px; text-transform: uppercase; letter-spacing: 0.4px; opacity: 0.8; }
        .status-row { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background-color: ${a}; box-shadow: 0 0 10px ${a}; }
        .info-grid { display: grid; grid-template-columns: 120px 1fr; gap: 6px 12px; font-size: 12px; align-items: center; }
        .label { opacity: 0.7; text-transform: uppercase; letter-spacing: 0.3px; font-size: 11px; }
        .value { font-family: var(--vscode-editor-font-family); word-break: break-all; }
        .actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; }
        button { display: inline-flex; justify-content: center; align-items: center; gap: 6px; width: 100%; padding: 10px 12px; background-color: var(--vscode-button-background); color: var(--vscode-button-foreground); border: 1px solid color-mix(in srgb, var(--vscode-button-background) 50%, transparent); border-radius: 6px; cursor: pointer; font-family: var(--vscode-font-family); font-weight: 600; transition: transform 120ms ease, background-color 120ms ease; }
        button:hover { background-color: var(--vscode-button-hoverBackground); transform: translateY(-1px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        button.secondary { background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }
        button.secondary:hover { background-color: var(--vscode-button-secondaryHoverBackground); }
        button.success { background-color: var(--vscode-testing-iconPassed); }
        button.danger { background-color: var(--vscode-testing-iconFailed); }
        .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--vscode-widget-border); }
        .toggle-row:last-child { border-bottom: none; }
        .switch { position: relative; width: 36px; height: 20px; }
        .switch input { display: none; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--vscode-input-background); border: 1px solid var(--vscode-widget-border); transition: .2s; border-radius: 999px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 2px; bottom: 2px; background-color: var(--vscode-foreground); transition: .2s; border-radius: 50%; }
        input:checked + .slider { background: var(--vscode-testing-iconPassed); border-color: var(--vscode-testing-iconPassed); }
        input:checked + .slider:before { transform: translateX(16px); background: var(--vscode-editor-background); }
        .muted { opacity: 0.75; font-size: 12px; }
        .inline-form { display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center; }
        .stacked { display: flex; flex-direction: column; gap: 12px; }
        input, select, textarea { width: 100%; padding: 8px 10px; font-size: 13px; border-radius: 6px; border: 1px solid var(--vscode-input-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-family: var(--vscode-font-family); box-sizing: border-box; }
        textarea { font-family: var(--vscode-editor-font-family); font-size: 12px; resize: vertical; min-height: 120px; }
        select { cursor: pointer; }
        .pill-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-editor-background); cursor: pointer; }
        .pill:hover { border-color: var(--vscode-testing-iconPassed); color: var(--vscode-testing-iconPassed); }
        .docs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px; }
        .doc-card { border: 1px dashed var(--vscode-widget-border); border-radius: 8px; padding: 10px; background: color-mix(in srgb, var(--vscode-editor-background) 90%, transparent); cursor: pointer; transition: border-color 0.15s, background 0.15s; }
        .doc-card:hover { border-color: var(--vscode-focusBorder); background: color-mix(in srgb, var(--vscode-editor-background) 70%, transparent); }
        .doc-card h4 { margin: 0 0 6px 0; font-size: 13px; display: flex; gap: 8px; align-items: center; }
        .doc-card code { display: inline-block; padding: 3px 6px; border-radius: 6px; background: var(--vscode-textBlockQuote-background); font-family: var(--vscode-editor-font-family); }
        .doc-card p { margin: 6px 0 0 0; opacity: 0.85; font-size: 12px; }
        pre { background: var(--vscode-textBlockQuote-background); border-radius: 8px; padding: 10px; font-size: 12px; overflow-x: auto; margin: 0; white-space: pre-wrap; word-break: break-word; }
        a { color: var(--vscode-textLink-foreground); }

        .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid currentColor; border-radius: 50%; border-top-color: transparent; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Live Log Tail Styles */
        .log-container {
            background: var(--vscode-textBlockQuote-background);
            color: var(--vscode-editor-foreground);
            font-family: var(--vscode-editor-font-family);
            font-size: 11px;
            padding: 12px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 2px;
            border: 1px solid var(--vscode-widget-border);
            margin-top: 8px;
        }
        .log-line {
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-all;
            display: flex;
            gap: 8px;
        }
        .log-time { color: var(--vscode-descriptionForeground); min-width: 75px; flex-shrink: 0; }
        .log-method { font-weight: 600; color: var(--vscode-terminal-ansiBlue); min-width: 50px; flex-shrink: 0; }
        .log-path { color: var(--vscode-terminal-ansiMagenta); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .log-status { font-weight: 600; min-width: 35px; flex-shrink: 0; }
        .log-status.success { color: var(--vscode-testing-iconPassed); }
        .log-status.error { color: var(--vscode-testing-iconFailed); }
        .log-latency { color: var(--vscode-descriptionForeground); min-width: 60px; text-align: right; flex-shrink: 0; }

        #log-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.3s ease;
        }
        #log-status-indicator.active { background-color: var(--vscode-testing-iconPassed); box-shadow: 0 0 8px var(--vscode-testing-iconPassed); }
        #log-status-indicator.inactive { background-color: var(--vscode-disabledForeground); }

        /* Pending log entry styles */
        .log-line.pending {
            opacity: 0.7;
            animation: pulse 1.5s ease-in-out infinite;
        }
        .log-line.pending .log-status {
            color: var(--vscode-charts-yellow);
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 0.4; }
        }

    </style>
</head>
<body>
    <div class="page">
        <div class="hero">
            <div>
                <h1>Copilot API Dashboard</h1>
                <p>Monitor and control your local Copilot API Gateway.</p>
                <div style="margin-top: 8px; font-size: 13px; opacity: 0.9; font-family: var(--vscode-editor-font-family); display: flex; align-items: center; gap: 8px;">
                    <span style="opacity: 0.6;">Running on:</span>
                    <strong id="server-url">${p}</strong>
                    <button id="btn-copy-url" class="secondary" style="padding: 4px 8px; font-size: 11px; min-width: auto;" title="Copy URL">\u{1F4CB} Copy</button>
                </div>
            </div>
            <div style="display: flex; gap: 8px;">
                <button id="btn-toggle-server" class="${o.running?"danger":"success"}" data-running="${o.running}" style="min-width: 140px;">
                    ${o.running?"Stop Server":"Start Server"}
                </button>
                <button class="secondary" id="btn-open-chat" title="Open Copilot Chat" style="min-width: 90px;">\u{1F4AC} Chat</button>
                <button class="secondary" id="btn-ask-copilot" title="Ask Copilot" style="min-width: 90px;">\u2753 Ask</button>
                <button class="secondary" id="btn-settings" title="Settings">\u2699\uFE0F</button>
            </div>
        </div>

        <!-- Copilot Health Banner -->
        ${o.copilot.ready?"":`
        <div style="background: var(--vscode-statusBarItem-warningBackground); color: var(--vscode-statusBarItem-warningForeground); padding: 12px 16px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: center; gap: 12px; font-weight: 500; border: 1px solid rgba(0,0,0,0.1);">
            <span style="font-size: 20px;">\u26A0\uFE0F</span>
            <div style="flex: 1;">
                <div style="font-size: 14px;">GitHub Copilot is not fully ready</div>
                <div style="font-size: 12px; opacity: 0.9; font-weight: 400;">
                    ${o.copilot.installed?"":"\u2022 GitHub Copilot extension is missing. "}
                    ${o.copilot.chatInstalled?"":"\u2022 GitHub Copilot Chat extension is missing. "}
                    ${o.copilot.signedIn?"":"\u2022 You are not signed in to GitHub Copilot. "}
                </div>
            </div>
            <button class="secondary" onclick="vscode.postMessage({ type: 'askCopilot' })" style="width: auto; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: inherit;">Resolve</button>
        </div>
        `}

        <!-- Server Status Card -->
        <div class="card full-width">
            <div class="status-row" style="justify-content: space-between; margin-bottom: 24px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="status-dot" class="status-dot"></div>
                    <span id="server-status-text" style="font-size: 16px;">${c}</span>
                </div>
                <div class="muted">
                    v${r.getVersion()}
                </div>
            </div>

            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <div class="card" style="padding: 16px;">
                    <div class="label">Requests</div>
                    <div class="value" style="font-size: 20px;" id="stat-requests">${o.stats?.totalRequests??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Req/Min</div>
                    <div class="value" style="font-size: 20px;" id="stat-rpm">0</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Latency</div>
                    <div class="value" style="font-size: 20px;" id="stat-latency">0ms</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Error Rate</div>
                    <div class="value" style="font-size: 20px;" id="stat-errors">0%</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Tokens In</div>
                    <div class="value" style="font-size: 20px;" id="stat-tokens-in">${o.stats?.totalTokensIn??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Tokens Out</div>
                    <div class="value" style="font-size: 20px;" id="stat-tokens-out">${o.stats?.totalTokensOut??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Uptime</div>
                    <div class="value" style="font-size: 20px;" id="stat-uptime">0m</div>
                </div>
            </div>

            <div class="info-grid">
                <div class="label">Connection</div>
                <div class="value">
                    ${i.enableHttp?"HTTP ":""}
                    ${i.enableWebSocket?"WebSocket ":""}
                </div>
                <div class="label">Auth Mode</div>
                <div class="value">${i.apiKey?"API Key (Protected)":"Open (No Auth)"}</div>
                <div class="label">Default Model</div>
                <div class="value">${i.defaultModel}</div>
                <div class="label">Copilot Health</div>
                <div class="value" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <span class="badge" style="background: ${o.copilot.chatInstalled?"var(--vscode-charts-green)":o.copilot.signedIn?"var(--vscode-charts-yellow)":"var(--vscode-charts-red)"}; color: ${o.copilot.chatInstalled||o.copilot.signedIn?"var(--vscode-editor-background)":"white"}; padding: 1px 6px; border-radius: 4px; font-size: 10px;">Chat: ${o.copilot.chatInstalled?"Installed":o.copilot.signedIn?"Not Detected":"Missing"}</span>
                    <span class="badge" style="background: ${o.copilot.signedIn?"var(--vscode-charts-green)":"var(--vscode-charts-red)"}; color: ${o.copilot.signedIn?"var(--vscode-editor-background)":"white"}; padding: 1px 6px; border-radius: 4px; font-size: 10px;">Auth: ${o.copilot.signedIn?"Signed In":"Signed Out"}</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Configuration Card -->
            <div class="card">
                <h3>\u2699\uFE0F Server Configuration</h3>
                <div class="stacked">
                    <div class="toggle-row">
                        <span>Enable HTTP Server</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-http" ${i.enableHttp?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <span>Enable WebSocket</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-ws" ${i.enableWebSocket?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <span>Detailed Logging</span>
                            <span title="Enables verbose output to the VS Code Output channel. Useful for debugging." style="cursor: help; opacity: 0.6; font-size: 14px;">\u2139\uFE0F</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-logging" ${i.enableLogging?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <span>Enable HTTPS</span>
                            <span title="Use HTTPS/TLS encryption. Falls back to HTTP if certificates are not configured." style="cursor: help; opacity: 0.6; font-size: 14px;">\u{1F512}</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-https" ${i.enableHttps?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div style="margin-top: 16px;">
                        <div style="display: flex; gap: 16px; margin-bottom: 12px;">
                            <div style="flex: 1;">
                                <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px;">HOST</span>
                                <input type="text" id="custom-host" value="${i.host}" placeholder="127.0.0.1" style="width: 100% !important;">
                            </div>
                            <div style="width: 100px;">
                                <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px;">PORT</span>
                                <input type="number" id="custom-port" value="${i.port}" style="width: 100% !important;">
                            </div>
                            <div style="display: flex; align-items: flex-end;">
                                <button class="secondary" id="btn-set-host" style="height: 36px; padding: 0 16px;">Apply</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="secondary" id="btn-host-local" style="flex: 1;">Bind Localhost</button>
                            <button class="secondary" id="btn-host-lan" style="flex: 1;">Bind LAN (0.0.0.0)</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Card -->
            <div class="card">
                <h3>\u{1F512} Security</h3>
                <div class="stacked">
                    <div class="toggle-row">
                        <span>Enable Authentication</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-auth" ${i.apiKey?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div style="margin-top: 12px;">
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <input type="password" id="api-key-input" value="${i.apiKey||""}" placeholder="sk-..." style="flex: 1;">
                            <button class="secondary" id="btn-show-key" style="width: 40px;" title="Show/Hide Key">\u{1F441}</button>
                            <button class="secondary" id="btn-copy-key" style="width: 40px;" title="Copy Key">\u{1F4CB}</button>
                        </div>
                        <div class="actions">
                            <button class="secondary" id="btn-generate-key">Generate New Key</button>
                            <button class="secondary" id="btn-set-apikey">Set Manual Key</button>
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 8px;">RATE LIMIT</span>
                        <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                            <input type="number" id="rate-limit-input" value="${i.rateLimitPerMinute||0}" placeholder="0 = unlimited" style="width: 100px !important;">
                            <span class="muted">req/min</span>
                            <button class="secondary" id="btn-set-ratelimit" style="width: auto; padding: 6px 16px;">Set</button>
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <div class="inline-form" style="margin-bottom: 8px;">
                            <span style="font-size: 12px; font-weight: 600;">ALLOW IP / DOMAIN</span>
                            <div style="display: flex; gap: 8px;">
                                <input type="text" id="ip-allowlist-input" placeholder="e.g. 192.168.1.5, 10.0.0.0/24, or example.com">
                                <button class="secondary" id="btn-add-ip" style="width: auto;">Add</button>
                            </div>
                        </div>
                        <div class="pill-row" id="ip-list">
                            ${(i.ipAllowlist||[]).map(f=>`<span class="pill" style="font-size: 11px; display: flex; align-items: center; gap: 4px;">${f} <span class="btn-remove-ip" data-value="${f}" style="cursor: pointer; opacity: 0.6;">\xD7</span></span>`).join("")}
                            ${!i.ipAllowlist||i.ipAllowlist.length===0?'<span class="muted">No access restrictions (all IPs allowed)</span>':""}
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 8px;">HARDENING & LIMITS</span>

                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Request Timeout</span>
                                <input type="number" id="timeout-input" value="${i.requestTimeoutSeconds||60}" style="width: 80px !important;">
                                <span class="muted">sec</span>
                                <button class="secondary" id="btn-set-timeout" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Max Payload</span>
                                <input type="number" id="payload-input" value="${i.maxPayloadSizeMb||1}" style="width: 80px !important;">
                                <span class="muted">MB</span>
                                <button class="secondary" id="btn-set-payload" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Max Connections/IP</span>
                                <input type="number" id="connections-input" value="${i.maxConnectionsPerIp||10}" style="width: 80px !important;">
                                <span class="muted">conn</span>
                                <button class="secondary" id="btn-set-connections" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Total Concurrency</span>
                                <input type="number" id="concurrency-input" value="${i.maxConcurrentRequests||4}" style="width: 80px !important;">
                                <span class="muted">req</span>
                                <button class="secondary" id="btn-set-concurrency" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>
                            <div class="muted" style="font-size: 10px; margin-top: 2px; opacity: 0.9; line-height: 1.4;">
                                <div style="display: flex; gap: 4px; margin-bottom: 2px;">
                                    <span style="font-weight: 600; color: var(--vscode-charts-blue); min-width: 105px;">Connections/IP:</span>
                                    <span>Limits simultaneous requests from a <b>single</b> user/client.</span>
                                </div>
                                <div style="display: flex; gap: 4px;">
                                    <span style="font-weight: 600; color: var(--vscode-charts-orange); min-width: 105px;">Total Concurrency:</span>
                                    <span>Global limit across <b>all</b> users to protect the Copilot backend.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MCP Status -->
        <div class="card full-width" id="mcp-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">\u{1F50C} MCP Status <span id="mcp-status-badge" class="badge">Checking...</span></h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; opacity: 0.8;">
                        <input type="checkbox" id="mcp-enabled-toggle" style="width: 14px; height: 14px; margin: 0;"> Enabled
                    </label>
                </div>
            </div>

            <div id="mcp-content-area">
                <div class="muted" style="text-align: center; padding: 20px;">Loading tools...</div>
            </div>
        </div>

        <!-- Live Log Tail -->
        <div class="card full-width">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">\u{1F4DF} Live Log Tail <div id="log-status-indicator" class="active"></div></h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; opacity: 0.8;">
                        <input type="checkbox" id="log-autoscroll" checked style="width: 14px; height: 14px; margin: 0;"> Auto-scroll
                    </label>
                    <button class="secondary" id="btn-clear-logs" style="width: auto; padding: 4px 12px; font-size: 11px; font-weight: 500;">\u{1F9F9} Clear</button>
                </div>
            </div>
            <div id="live-log-container" class="log-container">
                <div class="muted" style="text-align: center; padding-top: 120px; opacity: 0.5;">Waiting for API requests...</div>
            </div>
        </div>

        <!-- Audit & Analytics -->
        <div class="card full-width">

            <!-- Charts removed per user request -->
            <div style="margin-bottom: 24px;"></div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h4 style="margin: 0; font-size: 13px; opacity: 0.9;">Recent Activity</h4>
                <span id="refresh-timer" class="muted" style="font-weight: normal; font-size: 11px; opacity: 0.6;"></span>
                <div style="display: flex; gap: 8px;">
                    <button class="secondary" id="btn-refresh-audit" style="padding: 4px 10px; font-size: 11px;">\u{1F504} Refresh</button>
                    <button class="secondary" id="btn-open-logs" style="padding: 4px 10px; font-size: 11px;">\u{1F4C2} Open Log Folder</button>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table id="audit-table" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 1px solid var(--vscode-widget-border);">
                            <th style="padding: 8px 12px; opacity: 0.7;">Time</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Method</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Path</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Status</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Latency</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Tokens</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="audit-table-body">
                        <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                            <td style="padding: 8px 12px; opacity: 0.6; font-style: italic;" colspan="7">Loading audit logs...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--vscode-widget-border);">
                <div class="muted" style="font-size: 11px;" id="page-info">Showing 0-0 of 0</div>
                <div style="display: flex; gap: 8px;">
                    <button class="secondary" id="btn-prev-page" disabled>Previous</button>
                    <button class="secondary" id="btn-next-page" disabled>Next</button>
                </div>
            </div>
        </div>

        <div class="card full-width">
            <h3>\u{1F6E1}\uFE0F Data Redaction</h3>
            <p class="muted" style="margin-bottom: 16px;">
                Toggle patterns to automatically redact sensitive data from logs. All patterns are applied in real-time.
            </p>

            <!-- Built-in Patterns -->
            <div style="margin-bottom: 20px;">
                <h4 style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">Built-in Patterns</h4>
                <div id="builtin-patterns-list" style="display: flex; flex-direction: column; gap: 8px;">
                    ${(i.redactionPatterns||[]).filter(f=>f.isBuiltin).map(f=>`
                        <div class="toggle-row" style="padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 6px; border: 1px solid var(--vscode-widget-border);">
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <span style="font-weight: 600; font-size: 12px;">${f.name}</span>
                                <code style="font-size: 10px; opacity: 0.6; word-break: break-all;">${f.pattern.length>40?f.pattern.substring(0,40)+"...":f.pattern}</code>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="toggle-redaction" data-id="${f.id}" ${f.enabled?"checked":""}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    `).join("")}
                </div>
            </div>

            <!-- Custom Patterns -->
            <div style="border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                <h4 style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">Custom Patterns</h4>

                <div id="custom-patterns-list" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
                    ${(i.redactionPatterns||[]).filter(f=>!f.isBuiltin).map(f=>`
                        <div class="toggle-row" style="padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 6px; border: 1px solid var(--vscode-widget-border);">
                            <div style="display: flex; flex-direction: column; gap: 2px; flex: 1;">
                                <span style="font-weight: 600; font-size: 12px;">${f.name}</span>
                                <code style="font-size: 10px; opacity: 0.6; word-break: break-all;">${f.pattern}</code>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label class="switch">
                                    <input type="checkbox" class="toggle-redaction" data-id="${f.id}" ${f.enabled?"checked":""}>
                                    <span class="slider"></span>
                                </label>
                                <button class="secondary btn-remove-redaction" data-id="${f.id}" style="width: 28px; height: 28px; padding: 0; font-size: 14px;" title="Remove">\xD7</button>
                            </div>
                        </div>
                    `).join("")}
                    ${(i.redactionPatterns||[]).filter(f=>!f.isBuiltin).length===0?'<span class="muted" style="text-align: center; padding: 12px;">No custom patterns added yet</span>':""}
                </div>

                <!-- Add Custom Pattern Form -->
                <div style="display: flex; flex-direction: column; gap: 8px; padding: 12px; background: var(--vscode-textBlockQuote-background); border-radius: 8px;">
                    <span style="font-size: 11px; font-weight: 600; opacity: 0.8;">ADD CUSTOM PATTERN</span>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <input type="text" id="redaction-name-input" placeholder="Pattern name (e.g. 'Bank Account')" style="flex: 1; min-width: 150px;">
                        <input type="text" id="redaction-pattern-input" placeholder="Regex pattern" style="flex: 2; min-width: 200px;">
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button class="secondary" id="btn-test-redaction" style="width: auto;">\u{1F9EA} Test</button>
                        <button class="secondary" id="btn-add-redaction" style="width: auto;">\u2795 Add Pattern</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card full-width">
            <h3>\u{1F4DA} API Documentation</h3>
            <p class="muted" style="margin-bottom: 16px;">
                The gateway supports multiple API formats. Use the endpoints below with your favorite SDKs.
            </p>
            <div class="docs-grid">
                <div class="doc-card">
                    <h4><span>\u{1F916}</span> OpenAI <code>/v1</code></h4>
                    <p>Compatible with OpenAI SDKs. Supports <code>chat/completions</code>, <code>completions</code>, and <code>models</code>.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F9EA}</span> Anthropic <code>/v1</code></h4>
                    <p>Compatible with Claude SDKs. Supports <code>/v1/messages</code> with full streaming (SSE).</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F31F}</span> Google <code>/v1beta</code></h4>
                    <p>Compatible with Gemini SDKs. Supports <code>generateContent</code> and <code>streamGenerateContent</code>.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F999}</span> Llama <code>/llama/v1</code></h4>
                    <p>Compatible with Meta Llama SDKs. Supports <code>chat/completions</code> with streaming.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F50C}</span> MCP Tools</h4>
                    <p>MCP tools are automatically prefixed with <code>mcp_{server}_{tool}</code>. The gateway handles execution automatically in non-streaming mode.</p>
                </div>
            </div>

            <div class="actions" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-top: 16px;">
                <a href="http://${i.host}:${i.port}/docs" target="_blank" class="secondary" style="display: inline-flex; justify-content: center; align-items: center; gap: 6px; padding: 10px 12px; background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: 1px solid color-mix(in srgb, var(--vscode-button-secondaryBackground) 50%, transparent); border-radius: 6px; text-decoration: none; font-weight: 600;">\u{1F4DD} Swagger UI</a>
                <a href="http://${i.host}:${i.port}/openapi.json" target="_blank" class="secondary" style="display: inline-flex; justify-content: center; align-items: center; gap: 6px; padding: 10px 12px; background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: 1px solid color-mix(in srgb, var(--vscode-button-secondaryBackground) 50%, transparent); border-radius: 6px; text-decoration: none; font-weight: 600;">\u{1F4C4} OpenAPI JSON</a>
            </div>
        </div>

        <div class="card full-width" style="background: linear-gradient(135deg, color-mix(in srgb, var(--vscode-editor-background) 90%, #3b82f6 10%), color-mix(in srgb, var(--vscode-editor-background) 95%, #8b5cf6 5%));">
            <h3>\u{1F468}\u200D\u{1F4BB} About</h3>
            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Suhaib Bin Younis</div>
                    <div class="muted" style="margin-bottom: 8px;">Developer & Creator</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <a href="https://suhaibbinyounis.com" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F310} Website</a>
                        <a href="https://suhaib.in" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F517} suhaib.in</a>
                        <a href="mailto:vscode@suhaib.in" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F4E7} Email</a>
                        <a href="https://github.com/suhaibbinyounis/github-copilot-api-vscode" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u2B50 Star on GitHub</a>
                    </div>
                </div>
                <div class="muted" style="font-size: 11px; text-align: right;">
                    GitHub Copilot API Gateway v${r.getVersion()}<br>
                    Made with \u2764\uFE0F and \u2615
                </div>
            </div>
        </div>

        <!-- Prompt Generator Section -->
        <div id="prompt-generator-section" class="card full-width" style="background: linear-gradient(135deg, color-mix(in srgb, var(--vscode-editor-background) 95%, #8b5cf6 5%), color-mix(in srgb, var(--vscode-editor-background) 98%, #7c3aed 2%));">
            <h3>\u2728 Prompt Generator</h3>
            <p class="muted" style="margin-bottom: 16px;">Create high-quality, detailed prompts for AI assistants. Select options or describe what you need. <span style="opacity: 0.7; font-size: 10px;">\u{1F4A1} Uses Copilot directly - server not required</span></p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">
                <!-- Project Type -->
                <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F3AF} Project Type</label>
                    <select id="prompt-project-type" style="width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px;">
                        <option value="">Select type...</option>
                        <option value="web-app">Web Application</option>
                        <option value="mobile-app">Mobile App</option>
                        <option value="api">REST API / Backend</option>
                        <option value="cli">CLI Tool</option>
                        <option value="library">Library / Package</option>
                        <option value="automation">Automation Script</option>
                        <option value="data">Data Processing</option>
                        <option value="ml">Machine Learning</option>
                        <option value="devops">DevOps / Infrastructure</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <!-- Tech Stack -->
                <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F6E0}\uFE0F Tech Stack</label>
                    <select id="prompt-tech-stack" style="width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px;">
                        <option value="">Select stack...</option>
                        <option value="typescript-node">TypeScript + Node.js</option>
                        <option value="python">Python</option>
                        <option value="react">React + TypeScript</option>
                        <option value="nextjs">Next.js</option>
                        <option value="vue">Vue.js</option>
                        <option value="rust">Rust</option>
                        <option value="go">Go</option>
                        <option value="java">Java / Spring</option>
                        <option value="csharp">.NET / C#</option>
                        <option value="swift">Swift / iOS</option>
                        <option value="kotlin">Kotlin / Android</option>
                        <option value="flutter">Flutter / Dart</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <!-- Goal -->
                <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F3AA} Goal</label>
                    <select id="prompt-goal" style="width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px;">
                        <option value="">Select goal...</option>
                        <option value="build-new">Build from scratch</option>
                        <option value="add-feature">Add new feature</option>
                        <option value="refactor">Refactor / Improve</option>
                        <option value="debug">Debug / Fix issues</option>
                        <option value="optimize">Optimize performance</option>
                        <option value="test">Write tests</option>
                        <option value="document">Write documentation</option>
                        <option value="review">Code review</option>
                        <option value="migrate">Migrate / Upgrade</option>
                        <option value="learn">Learn / Explain</option>
                    </select>
                </div>

                <!-- Complexity -->
                <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F4CA} Complexity</label>
                    <select id="prompt-complexity" style="width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px;">
                        <option value="">Select level...</option>
                        <option value="simple">Simple / Quick task</option>
                        <option value="medium">Medium complexity</option>
                        <option value="complex">Complex / Multi-step</option>
                        <option value="enterprise">Enterprise-grade</option>
                    </select>
                </div>
            </div>

            <!-- Custom Context -->
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F4DD} Describe what you want to build</label>
                <textarea id="prompt-context" placeholder="E.g., 'A user authentication system with OAuth, password reset, and role-based access control...'" style="width: 100%; min-height: 80px; padding: 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px; resize: vertical; font-family: inherit; box-sizing: border-box;"></textarea>
            </div>

            <!-- Generate Button -->
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button id="btn-generate-prompt" style="flex: 1; padding: 10px 16px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                    \u2728 Generate Prompt
                </button>
                <button id="btn-enhance-prompt" class="secondary" style="padding: 10px 16px; background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: none; border-radius: 6px; cursor: pointer; font-size: 12px;" title="Enhance with AI suggestions">
                    \u{1F680} Enhance
                </button>
            </div>

            <!-- Output Area -->
            <div id="prompt-output-container" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="font-size: 11px; font-weight: 600; opacity: 0.8;">\u{1F4CB} Generated Prompt</label>
                    <div style="display: flex; gap: 4px;">
                        <button id="btn-copy-prompt" class="secondary" style="padding: 4px 10px; font-size: 10px; border-radius: 4px; cursor: pointer; border: none; background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground);">\u{1F4CB} Copy</button>
                        <button id="btn-export-prompt" class="secondary" style="padding: 4px 10px; font-size: 10px; border-radius: 4px; cursor: pointer; border: none; background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground);">\u{1F4BE} Export</button>
                    </div>
                </div>
                <div id="prompt-output" style="background: var(--vscode-editor-background); border: 1px solid var(--vscode-widget-border); border-radius: 8px; padding: 16px; font-size: 12px; line-height: 1.6; white-space: pre-wrap; max-height: 400px; overflow-y: auto; font-family: var(--vscode-editor-font-family);"></div>
            </div>

            <!-- Loading State -->
            <div id="prompt-loading" style="display: none; text-align: center; padding: 20px;">
                <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 24px;">\u2699\uFE0F</div>
                <div class="muted" style="margin-top: 8px;">Generating your prompt with AI...</div>
            </div>
        </div>

        <!-- Mini Wiki Section -->
        <div id="wiki-section" class="card full-width" style="background: linear-gradient(135deg, color-mix(in srgb, var(--vscode-editor-background) 92%, #10b981 8%), color-mix(in srgb, var(--vscode-editor-background) 96%, #059669 4%));">
            <h3>\u{1F4DA} API Usage Guide</h3>
            <p class="muted" style="margin-bottom: 16px;">Complete reference for connecting to the Copilot API Gateway from various languages, with installation instructions and real-world examples.</p>

            <!-- Tab Navigation -->
            <div id="wiki-tabs" style="display: flex; gap: 4px; margin-bottom: 16px; flex-wrap: wrap;">
                <button class="wiki-tab active" data-tab="python" style="padding: 8px 16px; border: none; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; font-weight: 600;">\u{1F40D} Python</button>
                <button class="wiki-tab" data-tab="javascript" style="padding: 8px 16px; border: none; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; font-weight: 600;">\u{1F4DC} JavaScript</button>
                <button class="wiki-tab" data-tab="curl" style="padding: 8px 16px; border: none; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; font-weight: 600;">\u{1F527} cURL</button>
                <button class="wiki-tab" data-tab="mcp" style="padding: 8px 16px; border: none; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; font-weight: 600;">\u{1F50C} MCP Tools</button>
            </div>

            <!-- Tab Content -->
            <div id="wiki-content" style="background: var(--vscode-editor-background); border-radius: 0 8px 8px 8px; padding: 16px; max-height: 600px; overflow-y: auto;">

                <!-- Python Tab -->
                <div class="wiki-panel" data-panel="python">
                    <h4 style="margin-top: 0; color: var(--vscode-textLink-foreground);">\u{1F4E6} Installation</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;"># Install the OpenAI Python library
pip install openai

# Or with Anthropic support
pip install anthropic</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F680} Quick Start - OpenAI SDK</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">from openai import OpenAI

# Point to your local Copilot API Gateway
client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"  # API key not required unless configured
)

# Simple chat completion
response = client.chat.completions.create(
    model="gpt-4o",  # or "claude-3.5-sonnet", "o1-mini", etc.
    messages=[
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": "Explain quantum computing in simple terms"}
    ],
    temperature=0.7,
    max_tokens=500
)

print(response.choices[0].message.content)</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F4E1} Streaming Responses</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">from openai import OpenAI

client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"
)

# Stream the response in real-time
stream = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": "Write a haiku about coding"}],
    stream=True
)

for chunk in stream:
    if chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="", flush=True)
print()  # Newline at end</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F527} Function Calling (Tool Use)</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">from openai import OpenAI
import json

client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"
)

# Define tools/functions
tools = [
    {
        "type": "function",
        "function": {
            "name": "get_weather",
            "description": "Get current weather for a location",
            "parameters": {
                "type": "object",
                "properties": {
                    "location": {"type": "string", "description": "City name"},
                    "unit": {"type": "string", "enum": ["celsius", "fahrenheit"]}
                },
                "required": ["location"]
            }
        }
    }
]

response = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": "What's the weather in Tokyo?"}],
    tools=tools,
    tool_choice="auto"
)

# Check if model wants to call a function
if response.choices[0].message.tool_calls:
    tool_call = response.choices[0].message.tool_calls[0]
    print(f"Function: {tool_call.function.name}")
    print(f"Arguments: {tool_call.function.arguments}")</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F3AD} Using with Anthropic SDK</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">import anthropic

client = anthropic.Anthropic(
    base_url="http://${i.host}:${i.port}",
    api_key="not-needed"
)

message = client.messages.create(
    model="claude-3.5-sonnet",
    max_tokens=1024,
    system="You are a helpful coding assistant.",
    messages=[
        {"role": "user", "content": "Write a Python function to calculate fibonacci"}
    ]
)

print(message.content[0].text)</pre>
                </div>

                <!-- JavaScript Tab -->
                <div class="wiki-panel" data-panel="javascript" style="display: none;">
                    <h4 style="margin-top: 0; color: var(--vscode-textLink-foreground);">\u{1F4E6} Installation</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;"># Node.js - Install OpenAI SDK
npm install openai

# Or with yarn
yarn add openai</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F680} Quick Start - Node.js</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">import OpenAI from 'openai';

const openai = new OpenAI({
  baseURL: 'http://${i.host}:${i.port}/v1',
  apiKey: 'not-needed'
});

async function chat() {
  const completion = await openai.chat.completions.create({
    model: 'gpt-4o',
    messages: [
      { role: 'system', content: 'You are a helpful assistant.' },
      { role: 'user', content: 'Hello!' }
    ]
  });

  console.log(completion.choices[0].message.content);
}

chat();</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F4E1} Streaming Responses</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">import OpenAI from 'openai';

const openai = new OpenAI({
  baseURL: 'http://${i.host}:${i.port}/v1',
  apiKey: 'not-needed'
});

async function streamChat() {
  const stream = await openai.chat.completions.create({
    model: 'gpt-4o',
    messages: [{ role: 'user', content: 'Tell me a story' }],
    stream: true
  });

  for await (const chunk of stream) {
    const content = chunk.choices[0]?.delta?.content || '';
    process.stdout.write(content);
  }
}

streamChat();</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F310} Browser - Fetch API</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">async function chat(message) {
  const response = await fetch('http://${i.host}:${i.port}/v1/chat/completions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: 'gpt-4o',
      messages: [{ role: 'user', content: message }]
    })
  });

  const data = await response.json();
  return data.choices[0].message.content;
}

// Usage
const answer = await chat('What is the capital of France?');
console.log(answer);</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F527} Function Calling</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">import OpenAI from 'openai';

const openai = new OpenAI({
  baseURL: 'http://${i.host}:${i.port}/v1',
  apiKey: 'not-needed'
});

const tools = [{
  type: 'function',
  function: {
    name: 'search_database',
    description: 'Search for records in database',
    parameters: {
      type: 'object',
      properties: {
        query: { type: 'string', description: 'Search query' },
        limit: { type: 'number', description: 'Max results' }
      },
      required: ['query']
    }
  }
}];

const response = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [{ role: 'user', content: 'Find all users named John' }],
  tools: tools
});

console.log(response.choices[0].message.tool_calls);</pre>
                </div>

                <!-- cURL Tab -->
                <div class="wiki-panel" data-panel="curl" style="display: none;">
                    <h4 style="margin-top: 0; color: var(--vscode-textLink-foreground);">\u{1F680} Basic Chat Completion</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [
      {"role": "system", "content": "You are a helpful assistant."},
      {"role": "user", "content": "Hello!"}
    ]
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F4E1} Streaming Response</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -N \\
  -d '{
    "model": "gpt-4o",
    "stream": true,
    "messages": [{"role": "user", "content": "Write a poem about AI"}]
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F510} With API Key Authentication</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer your-secret-api-key" \\
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F4CB} List Available Models</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/models</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F3AD} Anthropic Endpoint (Claude)</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/messages \\
  -H "Content-Type: application/json" \\
  -H "x-api-key: not-needed" \\
  -H "anthropic-version: 2023-06-01" \\
  -d '{
    "model": "claude-3.5-sonnet",
    "max_tokens": 1024,
    "messages": [{"role": "user", "content": "Hello Claude!"}]
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F999} Llama Endpoint (Meta)</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/llama/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [
      {"role": "system", "content": "You are a helpful assistant."},
      {"role": "user", "content": "Hello!"}
    ],
    "max_completion_tokens": 1024
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F527} Function Calling</h4>

                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "What time is it in London?"}],
    "tools": [{
      "type": "function",
      "function": {
        "name": "get_time",
        "description": "Get current time for a timezone",
        "parameters": {
          "type": "object",
          "properties": {
            "timezone": {"type": "string"}
          }
        }
      }
    }]
  }'</pre>
                </div>

                <!-- MCP Tools Tab -->
                <div class="wiki-panel" data-panel="mcp" style="display: none;">
                    <h4 style="margin-top: 0; color: var(--vscode-textLink-foreground);">\u2699\uFE0F Configure MCP Servers (settings.json)</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">// Add to your VS Code settings.json
"githubCopilotApi.mcp.servers": {
  // Filesystem access
  "filesystem": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/folder"]
  },
  // Git operations
  "git": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-git"]
  },
  // Remote MCP server via SSE
  "remote-tools": {
    "url": "http://your-server:8000/sse"
  }
}</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F5A5}\uFE0F Built-in VS Code Tools</h4>
                    <p class="muted" style="font-size: 11px; margin-bottom: 12px;">These tools are automatically available without any configuration:</p>

                    <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #10b981;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_read_file</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">Read the contents of any file in the workspace</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ "uri": "file:///path/to/file.ts" }</pre>
                        </div>

                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #3b82f6;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_list_files</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">List files in a directory with optional glob pattern</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ "folder": "/src", "pattern": "**/*.ts" }</pre>
                        </div>

                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #f59e0b;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_open_file</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">Open a file in VS Code editor, optionally at specific lines</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ "uri": "file:///path/to/file.ts", "startLine": 10, "endLine": 20 }</pre>
                        </div>

                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #ef4444;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_get_diagnostics</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">Get current errors and warnings from the Problems panel</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ "maxResults": 50 }</pre>
                        </div>

                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #8b5cf6;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_get_active_editor</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">Get content and cursor position of currently open file</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ } // No parameters needed</pre>
                        </div>
                    </div>

                    <h4 style="color: var(--vscode-textLink-foreground); margin-top: 20px;">\u{1F40D} Using VS Code Tools with Python</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">from openai import OpenAI

client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"
)

# Define the VS Code tools
vscode_tools = [
    {
        "type": "function",
        "function": {
            "name": "vscode_read_file",
            "description": "Read the contents of a file",
            "parameters": {
                "type": "object",
                "properties": {
                    "uri": {"type": "string", "description": "File URI (file:///path/to/file)"}
                },
                "required": ["uri"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "vscode_get_diagnostics",
            "description": "Get current errors and warnings",
            "parameters": {
                "type": "object",
                "properties": {
                    "maxResults": {"type": "number", "description": "Max results to return"}
                }
            }
        }
    }
]

response = client.chat.completions.create(
    model="gpt-4o",
    messages=[
        {"role": "user", "content": "Read package.json and tell me the version"}
    ],
    tools=vscode_tools,
    tool_choice="auto"
)

# The gateway will automatically execute the tool and return results
if response.choices[0].message.tool_calls:
    for tool_call in response.choices[0].message.tool_calls:
        print(f"Tool: {tool_call.function.name}")
        print(f"Args: {tool_call.function.arguments}")</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F527} cURL Example with MCP Tools</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [
      {"role": "user", "content": "List all TypeScript files in /src and check for errors"}
    ],
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "vscode_list_files",
          "description": "List files matching pattern",
          "parameters": {
            "type": "object",
            "properties": {
              "folder": {"type": "string"},
              "pattern": {"type": "string"}
            }
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "vscode_get_diagnostics",
          "description": "Get errors and warnings",
          "parameters": {
            "type": "object",
            "properties": {
              "maxResults": {"type": "number"}
            }
          }
        }
      }
    ]
  }'</pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--vscode-sideBar-background); padding: 24px; border-radius: 12px; width: 80%; max-width: 800px; max-height: 80vh; display: flex; flex-direction: column; overflow: hidden; border: 1px solid var(--vscode-widget-border); box-shadow: 0 4px 24px rgba(0,0,0,0.25);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0;">Request Details</h3>
                <button class="secondary" id="btn-close-modal" style="width: auto; padding: 6px 12px;">Close</button>
            </div>
            <div style="overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 16px; padding-right: 8px;">
                <div style="position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; opacity: 0.8;">Request</h4>
                        <button class="secondary btn-copy-modal" data-target="modal-request" style="width: auto; padding: 2px 8px; font-size: 10px;">\u{1F4CB} Copy</button>
                    </div>
                    <pre id="modal-request" style="font-size: 11px; max-height: 300px; overflow: auto; margin: 0;"></pre>
                </div>
                <div style="position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; opacity: 0.8;">Response</h4>
                        <button class="secondary btn-copy-modal" data-target="modal-response" style="width: auto; padding: 2px 8px; font-size: 10px;">\u{1F4CB} Copy</button>
                    </div>
                    <pre id="modal-response" style="font-size: 11px; max-height: 300px; overflow: auto; margin: 0;"></pre>
                </div>
            </div>
        </div>
    </div>

    <script nonce="${n}">
        var vscode = acquireVsCodeApi();

        // Pagination state - declare at top to avoid hoisting issues
        var currentPage = 1;
        var pageSize = 10;
        var totalLogs = 0;
        var lastLogs = [];

        document.getElementById('btn-toggle-server').onclick = function() {
            var running = this.getAttribute('data-running') === 'true';
            vscode.postMessage({ type: running ? 'stopServer' : 'startServer' });
        };

        document.getElementById('btn-open-chat').onclick = function() {
            vscode.postMessage({ type: 'openChat' });
        };

        document.getElementById('btn-ask-copilot').onclick = function() {
            vscode.postMessage({ type: 'askCopilot' });
        };

        document.getElementById('btn-settings').onclick = function() {
            vscode.postMessage({ type: 'showControls' });
        };

        document.getElementById('btn-copy-url').onclick = function() {
            var url = document.getElementById('server-url').innerText;
            navigator.clipboard.writeText(url).then(function() {
                var btn = document.getElementById('btn-copy-url');
                btn.innerText = '\u2705 Copied!';
                setTimeout(function() { btn.innerText = '\u{1F4CB} Copy'; }, 1500);
            });
        };

        document.getElementById('toggle-http').onchange = function() {
            vscode.postMessage({ type: 'toggleHttp' });
        };

        document.getElementById('toggle-ws').onchange = function() {
            vscode.postMessage({ type: 'toggleWs' });
        };

        document.getElementById('toggle-logging').onchange = function() {
            vscode.postMessage({ type: 'toggleLogging' });
        };

        document.getElementById('toggle-https').onchange = function() {
            vscode.postMessage({ type: 'toggleHttps' });
        };

        // Store the current API key for copy functionality
        var currentApiKey = '${i.apiKey||""}';

        document.getElementById('toggle-auth').onchange = function() {
            if (!this.checked) {
                // Disable auth by clearing API key
                currentApiKey = '';
                vscode.postMessage({ type: 'setApiKey', value: '' });
            } else {
                // Generate a random key when enabling
                var key = 'sk-' + Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
                document.getElementById('api-key-input').value = key;
                document.getElementById('api-key-input').type = 'text';
                currentApiKey = key;
                vscode.postMessage({ type: 'setApiKey', value: key });
            }
        };

        document.getElementById('btn-set-apikey').onclick = function() {
            var v = document.getElementById('api-key-input').value.trim();
            currentApiKey = v;
            vscode.postMessage({ type: 'setApiKey', value: v });
            if (v) {
                document.getElementById('toggle-auth').checked = true;
            }
        };

        document.getElementById('btn-generate-key').onclick = function() {
            var key = 'sk-' + Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
            document.getElementById('api-key-input').value = key;
            document.getElementById('api-key-input').type = 'text';
            currentApiKey = key;
            vscode.postMessage({ type: 'setApiKey', value: key });
            document.getElementById('toggle-auth').checked = true;
        };

        document.getElementById('btn-copy-key').onclick = function() {
            var input = document.getElementById('api-key-input');
            var keyToCopy = input.value.trim() || currentApiKey;
            if (keyToCopy) {
                navigator.clipboard.writeText(keyToCopy).then(function() {
                    var btn = document.getElementById('btn-copy-key');
                    btn.textContent = '\u2713';
                    setTimeout(function() { btn.textContent = '\u{1F4CB}'; }, 1500);
                });
            }
        };

        document.getElementById('btn-show-key').onclick = function() {
            var input = document.getElementById('api-key-input');
            var btn = document.getElementById('btn-show-key');
            if (input.type === 'password') {
                input.type = 'text';
                if (!input.value && currentApiKey) {
                    input.value = currentApiKey;
                }
                btn.textContent = '\u{1F648}';
            } else {
                input.type = 'password';
                btn.textContent = '\u{1F441}';
            }
        };

        document.getElementById('btn-set-ratelimit').onclick = function() {
            var v = document.getElementById('rate-limit-input').value;
            vscode.postMessage({ type: 'setRateLimit', value: Number(v) || 0 });
        };

        // Initialize on load
        // try { initCharts(); } catch (e) { console.error('Failed to init charts', e); }

        // Request initial data
        setTimeout(() => vscode.postMessage({ type: 'getAuditStats' }), 500);

        document.getElementById('btn-refresh-audit').onclick = function() {
            startCountdown(); // Reset timer
            vscode.postMessage({ type: 'getAuditStats' });
            vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
            this.textContent = '\u{1F504} Loading...';
            setTimeout(() => { this.textContent = '\u{1F504} Refresh'; }, 1000);
        };

        document.getElementById('btn-open-logs').onclick = function() {
            vscode.postMessage({ type: 'openLogFolder' });
        };

        // Modal Logic
        // Modal Logic
        const modal = document.getElementById('detail-modal');
        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scrolling
        }

        document.getElementById('btn-close-modal').onclick = closeModal;

        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        // Global function for View button
        window.showDetails = function(index) {
            if (!lastLogs || !lastLogs[index]) return;
            const log = lastLogs[index];

            const reqContent = {
                headers: log.requestHeaders,
                body: log.requestBody
            };
            const resContent = {
                headers: log.responseHeaders,
                body: log.responseBody,
                error: log.error
            };

            document.getElementById('modal-request').textContent = JSON.stringify(reqContent, null, 2);
            document.getElementById('modal-response').textContent = JSON.stringify(resContent, null, 2);

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Lock scrolling
        };

        // Copy content from modal
        document.querySelectorAll('.btn-copy-modal').forEach(btn => {
            btn.onclick = function() {
                const targetId = this.getAttribute('data-target');
                const content = document.getElementById(targetId).textContent;
                if (content) {
                    navigator.clipboard.writeText(content).then(() => {
                        const originalText = this.textContent;
                        this.textContent = '\u2713 Copied';
                        setTimeout(() => { this.textContent = originalText; }, 1500);
                    });
                }
            };
        });

        // Wiki tab switching
        document.querySelectorAll('.wiki-tab').forEach(function(tab) {
            tab.onclick = function() {
                var targetPanel = this.getAttribute('data-tab');
                // Update active tab styling
                document.querySelectorAll('.wiki-tab').forEach(function(t) {
                    t.classList.remove('active');
                    t.style.background = 'var(--vscode-button-secondaryBackground)';
                    t.style.color = 'var(--vscode-button-secondaryForeground)';
                });
                this.classList.add('active');
                this.style.background = 'var(--vscode-editor-background)';
                this.style.color = 'var(--vscode-foreground)';
                // Show corresponding panel
                document.querySelectorAll('.wiki-panel').forEach(function(p) {
                    p.style.display = 'none';
                });
                var panel = document.querySelector('.wiki-panel[data-panel="' + targetPanel + '"]');
                if (panel) panel.style.display = 'block';
            };
            // Initialize styling
            if (tab.classList.contains('active')) {
                tab.style.background = 'var(--vscode-editor-background)';
                tab.style.color = 'var(--vscode-foreground)';
            } else {
                tab.style.background = 'var(--vscode-button-secondaryBackground)';
                tab.style.color = 'var(--vscode-button-secondaryForeground)';
            }
        });

        // Prompt Generator handlers
        document.getElementById('btn-generate-prompt').onclick = function() {
            var projectType = document.getElementById('prompt-project-type').value;
            var techStack = document.getElementById('prompt-tech-stack').value;
            var goal = document.getElementById('prompt-goal').value;
            var complexity = document.getElementById('prompt-complexity').value;
            var context = document.getElementById('prompt-context').value;

            if (!context && !projectType && !techStack && !goal) {
                alert('Please select at least one option or describe what you want to build.');
                return;
            }

            document.getElementById('prompt-output-container').style.display = 'none';
            document.getElementById('prompt-loading').style.display = 'block';

            vscode.postMessage({
                type: 'generatePrompt',
                data: { projectType: projectType, techStack: techStack, goal: goal, complexity: complexity, context: context }
            });
        };

        document.getElementById('btn-enhance-prompt').onclick = function() {
            var context = document.getElementById('prompt-context').value;
            var currentOutput = document.getElementById('prompt-output').textContent;

            if (!context && !currentOutput) {
                alert('Please enter a description or generate a prompt first.');
                return;
            }

            document.getElementById('prompt-loading').style.display = 'block';

            vscode.postMessage({
                type: 'enhancePrompt',
                data: { context: context, existingPrompt: currentOutput }
            });
        };

        document.getElementById('btn-copy-prompt').onclick = function() {
            var content = document.getElementById('prompt-output').textContent;
            navigator.clipboard.writeText(content).then(function() {
                var btn = document.getElementById('btn-copy-prompt');
                btn.textContent = '\u2713 Copied';
                setTimeout(function() { btn.textContent = '\u{1F4CB} Copy'; }, 1500);
            });
        };

        document.getElementById('btn-export-prompt').onclick = function() {
            var content = document.getElementById('prompt-output').textContent;
            var blob = new Blob([content], { type: 'text/plain' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'generated-prompt.txt';
            a.click();
            URL.revokeObjectURL(url);
        };

        // Auto-refresh Countdown Logic
        let refreshTimer = 10;
        let refreshIntervalVal = null;
        const refreshSpan = document.getElementById('refresh-timer');

        function startCountdown() {
            if (refreshIntervalVal) clearInterval(refreshIntervalVal);

            refreshTimer = 10;
            updateTimerDisplay();

            refreshIntervalVal = setInterval(() => {
                refreshTimer--;
                updateTimerDisplay();

                if (refreshTimer <= 0) {
                    refreshTimer = 10;
                    vscode.postMessage({ type: 'getAuditStats' });
                    // Also refresh current page of logs
                    vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            if (refreshSpan) {
                refreshSpan.textContent = \`Refreshing in \${refreshTimer}s...\`;
            }
        }

        startCountdown();

        // IP Allowlist handlers
        document.getElementById('btn-add-ip').onclick = function() {
            var ip = document.getElementById('ip-allowlist-input').value.trim();
            if (ip) {
                vscode.postMessage({ type: 'addIpAllowlistEntry', value: ip });
                document.getElementById('ip-allowlist-input').value = '';
            }
        };

        document.querySelectorAll('.btn-remove-ip').forEach(function(btn) {
            btn.onclick = function() {
                var ip = btn.getAttribute('data-value');
                if (ip) {
                    vscode.postMessage({ type: 'removeIpAllowlistEntry', value: ip });
                }
            };
        });

        document.getElementById('btn-host-local').onclick = function() {
            vscode.postMessage({ type: 'hostLocal' });
        };

        document.getElementById('btn-host-lan').onclick = function() {
            vscode.postMessage({ type: 'hostLan' });
        };

        // Copy URL buttons for shareable LAN URLs
        document.querySelectorAll('.btn-copy-url').forEach(function(btn) {
            btn.onclick = function() {
                var url = btn.getAttribute('data-url');
                if (url) {
                    navigator.clipboard.writeText(url).then(function() {
                        var originalText = btn.textContent;
                        btn.textContent = '\u2713 Copied!';
                        setTimeout(function() { btn.textContent = originalText; }, 1500);
                    });
                }
            };
        });

        // MCP Toggle
        var mcpToggle = document.getElementById('mcp-enabled-toggle');
        if (mcpToggle) {
            mcpToggle.onchange = function() {
                vscode.postMessage({ type: 'toggleMcp', value: mcpToggle.checked });
            };
        }

        document.getElementById('btn-set-host').onclick = function() {
            var host = document.getElementById('custom-host').value;
            var port = document.getElementById('custom-port').value;
            if (host) vscode.postMessage({ type: 'setHost', value: host });
            if (port) vscode.postMessage({ type: 'setPort', value: Number(port) });
        };

        // btn-set-port removed - consolidated with btn-set-host Apply button

        document.getElementById('btn-set-timeout').onclick = function() {
            var val = document.getElementById('timeout-input').value;
            vscode.postMessage({ type: 'setRequestTimeout', value: Number(val) });
        };

        document.getElementById('btn-set-payload').onclick = function() {
            var val = document.getElementById('payload-input').value;
            vscode.postMessage({ type: 'setMaxPayloadSize', value: Number(val) });
        };

        document.getElementById('btn-set-connections').onclick = function() {
            var val = document.getElementById('connections-input').value;
            vscode.postMessage({ type: 'setMaxConnectionsPerIp', value: Number(val) });
        };

        document.getElementById('btn-set-concurrency').onclick = function() {
            var val = document.getElementById('concurrency-input').value;
            vscode.postMessage({ type: 'setMaxConcurrency', value: Number(val) });
        };

        // btn-set-model removed - element doesn't exist in current UI

        // Redaction pattern handlers
        document.getElementById('btn-add-redaction').onclick = function() {
            var name = document.getElementById('redaction-name-input').value.trim();
            var pattern = document.getElementById('redaction-pattern-input').value.trim();
            if (!name) {
                alert('Please enter a pattern name');
                return;
            }
            if (!pattern) {
                alert('Please enter a regex pattern');
                return;
            }
            try {
                new RegExp(pattern); // Validate
                vscode.postMessage({ type: 'addRedactionPattern', value: { name: name, pattern: pattern } });
                document.getElementById('redaction-name-input').value = '';
                document.getElementById('redaction-pattern-input').value = '';
            } catch (e) {
                alert('Invalid regex pattern: ' + e.message);
            }
        };

        document.getElementById('btn-test-redaction').onclick = function() {
            var pattern = document.getElementById('redaction-pattern-input').value.trim();
            if (!pattern) {
                alert('Enter a pattern first');
                return;
            }
            try {
                var regex = new RegExp(pattern, 'gi');
                var testStr = prompt('Enter test string to check redaction:', 'my-api-key-12345 or test@email.com');
                if (testStr) {
                    var result = testStr.replace(regex, '[REDACTED]');
                    alert('Result: ' + result);
                }
            } catch (e) {
                alert('Invalid regex pattern: ' + e.message);
            }
        };

        // Toggle redaction pattern on/off
        document.querySelectorAll('.toggle-redaction').forEach(function(toggle) {
            toggle.onchange = function() {
                var id = toggle.getAttribute('data-id');
                var enabled = toggle.checked;
                vscode.postMessage({ type: 'toggleRedactionPattern', value: { id: id, enabled: enabled } });
            };
        });

        // Remove redaction pattern buttons
        document.querySelectorAll('.btn-remove-redaction').forEach(function(btn) {
            btn.onclick = function() {
                var id = btn.getAttribute('data-id');
                if (id && confirm('Remove this pattern?')) {
                    vscode.postMessage({ type: 'removeRedactionPattern', value: id });
                }
            };
        });

        // Handle messages from extension
        window.addEventListener('message', function(event) {
            var message = event.data;
            console.log('[Dashboard] Received message:', message.type, message);
            if (message.type === 'historyData') {
                // Legacy support if needed
            } else if (message.type === 'statsData') {
                updateStats(message.data);
            } else if (message.type === 'realtimeStats') {
                // Update specific realtime cards
                if (message.data.requestsPerMinute !== undefined) document.getElementById('stat-rpm').textContent = message.data.requestsPerMinute;
                if (message.data.avgLatencyMs !== undefined) document.getElementById('stat-latency').innerHTML = message.data.avgLatencyMs + '<span style="font-size: 10px; opacity: 0.6;">ms</span>';
                if (message.data.errorRate !== undefined) document.getElementById('stat-errors').innerHTML = message.data.errorRate + '<span style="font-size: 10px; opacity: 0.6;">%</span>';
            } else if (message.type === 'auditStatsData') {
                updateCharts(message.data);
            } else if (message.type === 'auditLogData') {
                console.log('[Dashboard] Updating log table with', message.data?.length || 0, 'entries');
                updateLogTable(message.data, message.page, message.total, message.pageSize);
            } else if (message.type === 'liveLogStart') {
                appendLogStart(message.value);
            } else if (message.type === 'liveLog') {
                appendLog(message.value);
            } else if (message.type === 'scrollTo') {
                // Scroll to a specific section
                var target = message.target;
                if (target === 'wiki') {
                    var wikiSection = document.getElementById('wiki-section');
                    if (wikiSection) {
                        wikiSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                } else if (target === 'prompt-generator') {
                    var promptSection = document.getElementById('prompt-generator-section');
                    if (promptSection) {
                        promptSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            } else if (message.type === 'promptResult') {
                document.getElementById('prompt-loading').style.display = 'none';
                document.getElementById('prompt-output-container').style.display = 'block';
                document.getElementById('prompt-output').textContent = message.data;
            } else if (message.type === 'promptError') {
                document.getElementById('prompt-loading').style.display = 'none';
                alert('Error generating prompt: ' + message.error);
            }
        });

        // Pagination state variables moved to top of script

        document.getElementById('btn-prev-page').onclick = function() {
            if (currentPage > 1) {
                currentPage--;
                vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                document.getElementById('audit-table-body').innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; opacity: 0.7;">Loading...</td></tr>';
            }
        };

        document.getElementById('btn-next-page').onclick = function() {
            if (currentPage * pageSize < totalLogs) {
                currentPage++;
                vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                document.getElementById('audit-table-body').innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; opacity: 0.7;">Loading...</td></tr>';
            }
        };

        function updateCharts(stats) {
            // Charts removed per user request
        }

        // lastLogs declared at top of script

        function formatNumber(num) {
            if (num === undefined || num === null) return '0';
            if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toString();
        }

// Live Log Tail Logic
        const logContainer = document.getElementById('live-log-container');
        const autoScroll = document.getElementById('log-autoscroll');
        const logStatus = document.getElementById('log-status-indicator');
        let linesCount = 0;



        function appendLogStart(startLog) {
            if (!logContainer) return;
            if (linesCount === 0) logContainer.innerHTML = '';

            const line = document.createElement('div');
            line.className = 'log-line pending';
            line.setAttribute('data-request-id', startLog.requestId);

            const time = new Date(startLog.timestamp).toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });

            line.innerHTML = '<span class="log-time">[' + time + ']</span>' +
                             '<span class="log-method">' + (startLog.method || 'UNK') + '</span>' +
                             '<span class="log-path">' + (startLog.path || '/') + '</span>' +
                             '<span class="log-status">...</span>' +
                             '<span class="log-latency">pending</span>';

            logContainer.appendChild(line);
            linesCount++;

            // Pulse status indicator
            if (logStatus) {
                logStatus.classList.remove('active');
                void logStatus.offsetWidth; // Trigger reflow
                logStatus.classList.add('active');
            }

            // Limit shown lines to 100 for performance
            if (linesCount > 100) {
                logContainer.removeChild(logContainer.firstChild);
                linesCount--;
            }

            if (autoScroll && autoScroll.checked) {
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        function appendLog(log) {
            if (!logContainer) return;
            
            // Check if there's a pending entry for this request
            const existingLine = logContainer.querySelector('[data-request-id="' + log.requestId + '"]');
            
            const isError = log.status >= 400;
            const statusClass = isError ? 'error' : 'success';
            const time = new Date(log.timestamp).toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            if (existingLine) {
                // Update the existing pending entry
                existingLine.className = 'log-line';
                existingLine.innerHTML = '<span class="log-time">[' + time + ']</span>' +
                                 '<span class="log-method">' + (log.method || 'UNK') + '</span>' +
                                 '<span class="log-path">' + (log.path || '/') + '</span>' +
                                 '<span class="log-status ' + statusClass + '">' + (log.status || 0) + '</span>' +
                                 '<span class="log-latency">' + (log.durationMs || 0) + 'ms</span>';
            } else {
                // No pending entry, create a new line (fallback if start event was missed)
                if (linesCount === 0) logContainer.innerHTML = '';

                const line = document.createElement('div');
                line.className = 'log-line';

                line.innerHTML = '<span class="log-time">[' + time + ']</span>' +
                                 '<span class="log-method">' + (log.method || 'UNK') + '</span>' +
                                 '<span class="log-path">' + (log.path || '/') + '</span>' +
                                 '<span class="log-status ' + statusClass + '">' + (log.status || 0) + '</span>' +
                                 '<span class="log-latency">' + (log.durationMs || 0) + 'ms</span>';

                logContainer.appendChild(line);
                linesCount++;

                // Limit shown lines to 100 for performance
                if (linesCount > 100) {
                    logContainer.removeChild(logContainer.firstChild);
                    linesCount--;
                }
            }

            // Pulse status indicator
            if (logStatus) {
                logStatus.classList.remove('active');
                void logStatus.offsetWidth; // Trigger reflow
                logStatus.classList.add('active');
            }

            if (autoScroll && autoScroll.checked) {
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        document.getElementById('btn-clear-logs').onclick = function() {
            if (logContainer) {
                logContainer.innerHTML = '<div class="muted" style="text-align: center; padding-top: 120px; opacity: 0.5;">Waiting for API requests...</div>';
                linesCount = 0;
            }
        };

        function updateLogTable(logs, page, total, pSize) {
            lastLogs = logs;
            currentPage = page;
            totalLogs = total;
            pageSize = pSize || 10;

            const tbody = document.getElementById('audit-table-body');
            const pageInfo = document.getElementById('page-info');
            const btnPrev = document.getElementById('btn-prev-page');
            const btnNext = document.getElementById('btn-next-page');

            if (pageInfo) {
                const start = (page - 1) * pageSize + 1;
                const end = Math.min(page * pageSize, total);
                pageInfo.textContent = \`Showing \${total === 0 ? 0 : start}-\${end} of \${total}\`;
            }
            if (btnPrev) btnPrev.disabled = page <= 1;
            if (btnNext) btnNext.disabled = page * pageSize >= total;

            if (!tbody) return;

            // Clear checks to force refresh
            tbody.innerHTML = '';

            if (!logs || logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="padding: 24px; text-align: center; opacity: 0.6; font-style: italic;">No audit logs found.<br><span style="font-size: 11px; opacity: 0.8; margin-top: 4px; display: block;">Make a request to generate logs.</span></td></tr>';
                return;
            }

            tbody.innerHTML = logs.map((log, index) => {
                const date = new Date(log.timestamp);
                const time = date.toLocaleTimeString();
                const statusColor = log.status >= 400 ? 'var(--vscode-testing-iconFailed)' : (log.status >= 300 ? 'var(--vscode-charts-yellow)' : 'var(--vscode-testing-iconPassed)');

                return \`
                <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                    <td style="padding: 8px 12px; white-space: nowrap; opacity: 0.8;">\${time}</td>
                    <td style="padding: 8px 12px; white-space: nowrap;"><span style="padding: 2px 6px; border-radius: 4px; background: var(--vscode-textCodeBlock-background); font-size: 11px; font-family: var(--vscode-editor-font-family);">\${log.method || 'UNK'}</span></td>
                    <td style="padding: 8px 12px; word-break: break-all; font-family: var(--vscode-editor-font-family);">\${log.path || '/'}</td>
                    <td style="padding: 8px 12px; color: \${statusColor}; font-weight: 600;">\${log.status || 0}</td>
                    <td style="padding: 8px 12px;">\${log.durationMs || 0}ms</td>
                    <td style="padding: 8px 12px;" title="\${(log.tokensIn || 0) + (log.tokensOut || 0)} tokens">\${formatNumber ? formatNumber((log.tokensIn || 0) + (log.tokensOut || 0)) : 0}</td>
                    <td style="padding: 8px 12px;">
                        <button class="secondary btn-view-details" data-index="\${index}" style="padding: 2px 8px; font-size: 10px; width: auto;">\u{1F50D}</button>
                    </td>
                </tr>\`;
    }).join('');

    // Add event listeners for view buttons (CSP safe)
    document.querySelectorAll('.btn-view-details').forEach(btn => {
        btn.addEventListener('click', () => {
             const index = parseInt(btn.getAttribute('data-index') || '0');
             showDetails(index);
        });
    });
}

function updateStats(stats) {
    if (stats.totalRequests !== undefined) {
        document.getElementById('stat-requests').textContent = formatNumber(stats.totalRequests);
        document.getElementById('stat-requests').title = stats.totalRequests + ' requests';
    }
    if (stats.requestsPerMinute !== undefined) document.getElementById('stat-rpm').textContent = stats.requestsPerMinute;
    if (stats.avgLatencyMs !== undefined) document.getElementById('stat-latency').innerHTML = stats.avgLatencyMs + '<span style="font-size: 12px;">ms</span>';
    if (stats.totalTokensIn !== undefined) {
        document.getElementById('stat-tokens-in').textContent = formatNumber(stats.totalTokensIn);
        document.getElementById('stat-tokens-in').title = stats.totalTokensIn;
    }
    if (stats.totalTokensOut !== undefined) {
        document.getElementById('stat-tokens-out').textContent = formatNumber(stats.totalTokensOut);
        document.getElementById('stat-tokens-out').title = stats.totalTokensOut;
    }
    if (stats.errorRate !== undefined) document.getElementById('stat-errors').innerHTML = stats.errorRate + '<span style="font-size: 12px;">%</span>';
    if (stats.uptimeMs !== undefined) {
        var minutes = Math.floor(stats.uptimeMs / 60000);
        var hours = Math.floor(minutes / 60);
        var display = hours > 0 ? hours + 'h ' + (minutes % 60) + 'm' : minutes + 'm';
        document.getElementById('stat-uptime').textContent = display;
    }

    // Update MCP Status
    if (stats.mcp) {
        var mcpEnabled = stats.mcp.enabled;
        var statusBadge = document.getElementById('mcp-status-badge');
        if (statusBadge) {
            statusBadge.textContent = mcpEnabled ? (stats.mcp.servers.length > 0 ? 'Connected' : 'Ready') : 'Disabled';
            statusBadge.style.background = mcpEnabled ? (stats.mcp.servers.length > 0 ? 'var(--vscode-charts-green)' : 'var(--vscode-charts-blue)') : 'var(--vscode-charts-red)';
            statusBadge.style.color = 'white';
            statusBadge.style.padding = '2px 8px';
            statusBadge.style.borderRadius = '10px';
            statusBadge.style.fontSize = '10px';
        }

        var toggle = document.getElementById('mcp-enabled-toggle');
        if (toggle) toggle.checked = mcpEnabled;

        // Render Tools Grouped by Server
        var contentArea = document.getElementById('mcp-content-area');
        if (contentArea && stats.mcp.tools) {
            if (!mcpEnabled) {
                contentArea.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">MCP is disabled. Enable it in settings or toggle above.</div>';
                return;
            }

            if (stats.mcp.tools.length === 0) {
                 contentArea.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">No tools available. Connect a server or enable built-in tools.</div>';
                 return;
            }

            // Group tools
            var groups = {};
            stats.mcp.tools.forEach(function(tool) {
                if (!groups[tool.serverName]) { groups[tool.serverName] = []; }
                groups[tool.serverName].push(tool);
            });

            var html = '<div style="display: flex; flex-direction: column; gap: 24px;">';

            Object.keys(groups).sort().forEach(function(serverName) {
                var serverTools = groups[serverName];
                html += '<div>';
                html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">';
                html += '<span class="badge" style="background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); font-size: 10px;">' + serverName + '</span>';
                html += '<div style="height: 1px; flex: 1; background: var(--vscode-widget-border); opacity: 0.5;"></div>';
                html += '</div>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px;">';
                serverTools.forEach(function(t) {
                    html += '<div style="padding: 12px; border: 1px solid var(--vscode-widget-border); border-radius: 8px; background: rgba(0,0,0,0.02);">';
                    html += '<div style="font-family: var(--vscode-editor-font-family); font-weight: 600; font-size: 12px; margin-bottom: 4px; color: var(--vscode-textPreformat-foreground);">' + t.name + '</div>';
                    html += '<div style="font-size: 11px; opacity: 0.7; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;" title="' + (t.description || '') + '">' + (t.description || 'No description') + '</div>';
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            });

html += '</div>';

// Only update if changed to avoid flicker (hashing would be better but simple string comparison works for now)
// Actually, innerHTML rewrite is fine for this dashboard frequency
contentArea.innerHTML = html;
}
    }
}

// Auto-refresh stats every 5 seconds
setInterval(function () {
    vscode.postMessage({ type: 'getStats' });
}, 5000);

// Load audit data on page load
// Load audit data on page load
vscode.postMessage({ type: 'getAuditStats' });
vscode.postMessage({ type: 'getAuditLogs', value: { page: 1, pageSize: 10 } });
</script>
    </body>
    </html>`}async resolveWebviewView(e,r,n){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=await this._getSidebarHtml(e.webview),e.webview.onDidReceiveMessage(async o=>{switch(o.type){case"openDashboard":await t.createOrShow(this._extensionUri,this._gateway);break;case"startServer":this._gateway.startServer();break;case"stopServer":this._gateway.stopServer();break;case"openSwagger":{let i=await this._gateway.getStatus(),s=`http://${i.config.host}:${i.config.port}/docs`;ur.env.openExternal(ur.Uri.parse(s));break}case"openMetrics":{let i=await this._gateway.getStatus(),s=`http://${i.config.host}:${i.config.port}/metrics`;ur.env.openExternal(ur.Uri.parse(s));break}case"openWiki":await t.createOrShow(this._extensionUri,this._gateway,"wiki");break;case"openPromptGenerator":await t.createOrShow(this._extensionUri,this._gateway,"prompt-generator");break;case"openAppsHub":ur.commands.executeCommand("github-copilot-api-vscode.openAppsHub");break}})}};function VK(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}var F=ct(require("vscode"));var hY={"decision-doctor":()=>Promise.resolve().then(()=>(GK(),HK)).then(t=>t.decisionDoctorApp),"skill-sprinter":()=>Promise.resolve().then(()=>(ZK(),WK)).then(t=>t.skillSprinterApp),"universal-summarizer":()=>Promise.resolve().then(()=>(JK(),KK)).then(t=>t.universalSummarizerApp),"icebreaker-chef":()=>Promise.resolve().then(()=>(QK(),YK)).then(t=>t.icebreakerChefApp),"code-review":()=>Promise.resolve().then(()=>(oJ(),nJ)).then(t=>t.codeReviewApp),"test-case-generator":()=>Promise.resolve().then(()=>(sJ(),iJ)).then(t=>t.testCaseGeneratorApp),"bug-report-writer":()=>Promise.resolve().then(()=>(cJ(),aJ)).then(t=>t.bugReportWriterApp),"regex-generator":()=>Promise.resolve().then(()=>(uJ(),lJ)).then(t=>t.regexGeneratorApp),"api-doc-writer":()=>Promise.resolve().then(()=>(pJ(),dJ)).then(t=>t.apiDocWriterApp),"sql-query-builder":()=>Promise.resolve().then(()=>(mJ(),fJ)).then(t=>t.sqlQueryBuilderApp),"meeting-notes-to-actions":()=>Promise.resolve().then(()=>(gJ(),hJ)).then(t=>t.meetingNotesToActionsApp),"standup-summary":()=>Promise.resolve().then(()=>(vJ(),yJ)).then(t=>t.standupSummaryApp),"one-on-one-prep":()=>Promise.resolve().then(()=>(_J(),bJ)).then(t=>t.oneOnOnePrepApp),"performance-review":()=>Promise.resolve().then(()=>(xJ(),wJ)).then(t=>t.performanceReviewApp),"team-feedback":()=>Promise.resolve().then(()=>(kJ(),SJ)).then(t=>t.teamFeedbackApp),"playwright-generator":()=>Promise.resolve().then(()=>($J(),AJ)).then(t=>t.playwrightGeneratorApp),"accessibility-checker":()=>Promise.resolve().then(()=>(CJ(),PJ)).then(t=>t.accessibilityCheckerApp),"vulnerability-scanner":()=>Promise.resolve().then(()=>(TJ(),IJ)).then(t=>t.vulnerabilityScannerApp),"iac-generator":()=>Promise.resolve().then(()=>(OJ(),EJ)).then(t=>t.iacGeneratorApp),"adr-draftsman":()=>Promise.resolve().then(()=>(NJ(),jJ)).then(t=>t.adrDraftsmanApp),"prd-draftsman":()=>Promise.resolve().then(()=>(zJ(),RJ)).then(t=>t.prdDraftsmanApp),"jira-story-writer":()=>Promise.resolve().then(()=>(DJ(),MJ)).then(t=>t.jiraStoryWriterApp),"sprint-retro":()=>Promise.resolve().then(()=>(BJ(),qJ)).then(t=>t.sprintRetroApp),"email-composer":()=>Promise.resolve().then(()=>(LJ(),UJ)).then(t=>t.emailComposerApp),"slack-polisher":()=>Promise.resolve().then(()=>(VJ(),FJ)).then(t=>t.slackPolisherApp),"ecard-recognition":()=>Promise.resolve().then(()=>(GJ(),HJ)).then(t=>t.ecardRecognitionApp),"email-response-helper":()=>Promise.resolve().then(()=>(ZJ(),WJ)).then(t=>t.emailResponseHelperApp),"brainstorming-partner":()=>Promise.resolve().then(()=>(JJ(),KJ)).then(t=>t.brainstormingPartnerApp),"prompt-explorer":()=>Promise.resolve().then(()=>(QJ(),YJ)).then(t=>t.promptExplorerApp),"daily-inspiration":()=>Promise.resolve().then(()=>(eY(),XJ)).then(t=>t.dailyInspirationApp),"rubber-duck-therapist":()=>Promise.resolve().then(()=>(rY(),tY)).then(t=>t.rubberDuckTherapistApp),"gratitude-journal":()=>Promise.resolve().then(()=>(oY(),nY)).then(t=>t.gratitudeJournalApp),"focus-mindfulness":()=>Promise.resolve().then(()=>(sY(),iY)).then(t=>t.focusMindfulnessApp),"story-chain":()=>Promise.resolve().then(()=>(cY(),aY)).then(t=>t.storyChainApp),"trivia-showdown":()=>Promise.resolve().then(()=>(uY(),lY)).then(t=>t.triviaShowdownApp),"caption-battle":()=>Promise.resolve().then(()=>(pY(),dY)).then(t=>t.captionBattleApp),"debate-arena":()=>Promise.resolve().then(()=>(mY(),fY)).then(t=>t.debateArenaApp)},gY=[{id:"decision-doctor",name:"Decision Doctor",description:"Get AI help making tough decisions",icon:"\u{1FA7A}",category:"productivity"},{id:"skill-sprinter",name:"Skill Sprinter",description:"Quick micro-learning sessions",icon:"\u{1F3C3}",category:"productivity"},{id:"universal-summarizer",name:"Universal Summarizer",description:"Summarize any text quickly",icon:"\u{1F4DD}",category:"productivity"},{id:"icebreaker-chef",name:"Icebreaker Chef",description:"Generate fun team icebreakers",icon:"\u{1F9CA}",category:"productivity"},{id:"code-review",name:"Code Review",description:"Full project code review using git diff",icon:"\u{1F50D}",category:"developer"},{id:"test-case-generator",name:"Test Case Generator",description:"Generate comprehensive test cases",icon:"\u{1F9EA}",category:"developer"},{id:"bug-report-writer",name:"Bug Report Writer",description:"Write detailed bug reports",icon:"\u{1F41B}",category:"developer"},{id:"regex-generator",name:"Regex Generator",description:"Generate and explain regex patterns",icon:"\u{1F523}",category:"developer"},{id:"api-doc-writer",name:"API Doc Writer",description:"Generate API documentation",icon:"\u{1F4DA}",category:"developer"},{id:"sql-query-builder",name:"SQL Query Builder",description:"Build complex SQL queries",icon:"\u{1F5C3}\uFE0F",category:"developer"},{id:"meeting-notes-to-actions",name:"Meeting Notes to Actions",description:"Convert meeting notes to action items",icon:"\u{1F4CB}",category:"productivity"},{id:"standup-summary",name:"Standup Summary",description:"Generate standup updates",icon:"\u{1F3AF}",category:"productivity"},{id:"one-on-one-prep",name:"1:1 Prep",description:"Prepare for one-on-one meetings",icon:"\u{1F465}",category:"leadership"},{id:"performance-review",name:"Performance Review",description:"Draft performance reviews",icon:"\u{1F4CA}",category:"leadership"},{id:"team-feedback",name:"Team Feedback",description:"Generate constructive feedback",icon:"\u{1F4AC}",category:"leadership"},{id:"playwright-generator",name:"Playwright Generator",description:"Generate Playwright test scripts",icon:"\u{1F3AD}",category:"qa"},{id:"accessibility-checker",name:"Accessibility Checker",description:"Check accessibility compliance",icon:"\u267F",category:"qa"},{id:"vulnerability-scanner",name:"Vulnerability Scanner",description:"Scan code for vulnerabilities",icon:"\u{1F512}",category:"security"},{id:"iac-generator",name:"IaC Generator",description:"Generate infrastructure as code",icon:"\u2601\uFE0F",category:"devops"},{id:"adr-draftsman",name:"ADR Draftsman",description:"Draft Architecture Decision Records",icon:"\u{1F3D7}\uFE0F",category:"architecture"},{id:"prd-draftsman",name:"PRD Draftsman",description:"Draft Product Requirements Documents",icon:"\u{1F4C4}",category:"product"},{id:"jira-story-writer",name:"Jira Story Writer",description:"Write Jira user stories",icon:"\u{1F3AB}",category:"jira"},{id:"sprint-retro",name:"Sprint Retro",description:"Generate sprint retrospective notes",icon:"\u{1F504}",category:"jira"},{id:"email-composer",name:"Email Composer",description:"Compose professional emails",icon:"\u2709\uFE0F",category:"communication"},{id:"slack-polisher",name:"Slack Polisher",description:"Polish Slack messages",icon:"\u{1F4AC}",category:"communication"},{id:"ecard-recognition",name:"E-Card Recognition",description:"Create recognition e-cards",icon:"\u{1F3C6}",category:"communication"},{id:"email-response-helper",name:"Email Response Helper",description:"Draft email responses",icon:"\u21A9\uFE0F",category:"communication"},{id:"brainstorming-partner",name:"Brainstorming Partner",description:"AI brainstorming companion",icon:"\u{1F4A1}",category:"inspiration"},{id:"prompt-explorer",name:"Prompt Explorer",description:"Explore and refine prompts",icon:"\u{1F52E}",category:"inspiration"},{id:"daily-inspiration",name:"Daily Inspiration",description:"Get daily inspiration quotes",icon:"\u2728",category:"inspiration"},{id:"rubber-duck-therapist",name:"Rubber Duck Therapist",description:"Talk through problems",icon:"\u{1F986}",category:"wellness"},{id:"gratitude-journal",name:"Gratitude Journal",description:"Daily gratitude prompts",icon:"\u{1F64F}",category:"wellness"},{id:"focus-mindfulness",name:"Focus & Mindfulness",description:"Mindfulness and focus exercises",icon:"\u{1F9D8}",category:"wellness"},{id:"story-chain",name:"Story Chain",description:"Collaborative storytelling game",icon:"\u{1F4D6}",category:"games"},{id:"trivia-showdown",name:"Trivia Showdown",description:"Team trivia game",icon:"\u2753",category:"games"},{id:"caption-battle",name:"Caption Battle",description:"Caption contest game",icon:"\u{1F5BC}\uFE0F",category:"games"},{id:"debate-arena",name:"Debate Arena",description:"Friendly debate game",icon:"\u2694\uFE0F",category:"games"}],mf=new Map;function yY(t){return gY.find(e=>e.id===t)}async function vY(t){if(mf.has(t))return mf.get(t);let e=hY[t];if(e)try{let r=await e();return mf.set(t,r),r}catch(r){console.error(`Failed to load app "${t}":`,r);return}}function aA(t){if(mf.has(t))return mf.get(t);let e=hY[t];e&&e().then(r=>{mf.set(t,r)}).catch(r=>{console.error(`Failed to preload app "${t}":`,r)})}function TD(){let t={wellness:[],inspiration:[],communication:[],developer:[],qa:[],leadership:[],productivity:[],security:[],devops:[],architecture:[],product:[],jira:[],games:[]};for(let e of gY)t[e.category].push(e);return t}var cA={developer:{label:"Developer",icon:"\u{1F468}\u200D\u{1F4BB}",description:"Tools for software developers"},qa:{label:"QA & Testing",icon:"\u{1F9EA}",description:"Tools for quality assurance"},leadership:{label:"Leadership",icon:"\u{1F4CA}",description:"Tools for tech leads and managers"},productivity:{label:"Productivity",icon:"\u26A1",description:"General productivity tools"},security:{label:"Security & Compliance",icon:"\u{1F6E1}\uFE0F",description:"Tools for code safety and regulatory alignment"},devops:{label:"DevOps & Infrastructure",icon:"\u2601\uFE0F",description:"Streamlining cloud operations and manifest management"},architecture:{label:"Architecture & Design",icon:"\u{1F3D7}\uFE0F",description:"Supporting high-level technical decision-making and planning"},product:{label:"Product & Strategy",icon:"\u{1F4C8}",description:"Bridging the gap between engineering and business"},jira:{label:"JIRA & Project Management",icon:"\u{1F3AB}",description:"Tools for story writing and sprint management"},communication:{label:"Communication",icon:"\u{1F4AC}",description:"Email, messaging, and professional writing"},inspiration:{label:"Inspiration & Ideas",icon:"\u2728",description:"Brainstorming, prompts, and creative thinking"},wellness:{label:"Wellness & Mindfulness",icon:"\u{1F9D8}",description:"Mental well-being and focus tools"},games:{label:"Team Games",icon:"\u{1F3AE}",description:"Fun interactive games for team engagement"}};var Un=ct(require("vscode")),ED=class t{static instance;constructor(){}static getInstance(){return t.instance||(t.instance=new t),t.instance}async checkCopilotAvailability(){try{let e=await Un.lm.selectChatModels({vendor:"copilot"});return!e||e.length===0?{available:!1,message:"GitHub Copilot is not available. Please ensure GitHub Copilot and Copilot Chat extensions are installed and you are signed in."}:{available:!0}}catch(e){return{available:!1,message:`Failed to access Copilot: ${e instanceof Error?e.message:String(e)}`}}}async executeApp(e,r,n,o){let i=Date.now();try{let s=await this.checkCopilotAvailability();if(!s.available)return{success:!1,error:s.message,durationMs:Date.now()-i};let a;if(e.fetchContext){n?.("Gathering context...");try{a=await e.fetchContext(r),a.errors&&a.errors.length>0&&console.warn("[AppService] Context fetch warnings:",a.errors)}catch(d){return{success:!1,error:`Failed to gather context: ${d instanceof Error?d.message:String(d)}`,durationMs:Date.now()-i}}}n?.("Building prompt...");let c=e.buildUserPrompt(r,a);n?.("Analyzing with AI...");let l=await this.invokeLLM(e.systemPrompt,c,o);if(!l.success)return{success:!1,error:l.error,durationMs:Date.now()-i,tokens:l.tokens};n?.("Formatting output...");let u;return e.parseResponse?u=e.parseResponse(l.content,r):u={type:"markdown",content:l.content,actions:e.defaultActions||this.getDefaultActions()},{success:!0,output:u,durationMs:Date.now()-i,tokens:l.tokens}}catch(s){return{success:!1,error:s instanceof Error?s.message:String(s),durationMs:Date.now()-i}}}async invokeLLM(e,r,n){try{let o=await Un.lm.selectChatModels({vendor:"copilot"});if(!o||o.length===0)return{success:!1,error:"No Copilot language model available"};let i=o[0],s=[Un.LanguageModelChatMessage.User(`[System Instructions]
${e}`),Un.LanguageModelChatMessage.User(r)],a=n?{token:n,dispose:()=>{}}:new Un.CancellationTokenSource,c=setTimeout(()=>{"cancel"in a&&a.cancel()},18e4);try{let l=await i.sendRequest(s,{},a.token),u="";for await(let f of l.text){if(a.token.isCancellationRequested)return{success:!1,error:"Request was cancelled"};u+=f}let d=0,p=0;try{d=await i.countTokens(e+r),p=await i.countTokens(u)}catch{}return{success:!0,content:u.trim(),tokens:{input:d,output:p}}}finally{clearTimeout(c),n||a.dispose()}}catch(o){return o instanceof Un.CancellationError?{success:!1,error:"Request was cancelled"}:{success:!1,error:o instanceof Error?o.message:String(o)}}}getDefaultActions(){return[{label:"Copy",icon:"\u{1F4CB}",action:"copy"},{label:"Insert at Cursor",icon:"\u{1F4DD}",action:"insert"},{label:"Save as File",icon:"\u{1F4BE}",action:"newFile",fileExtension:".md"}]}async*executeAppStreaming(e,r,n){let o=Date.now();try{let i=await this.checkCopilotAvailability();if(!i.available){yield{type:"error",data:i.message};return}let s;e.fetchContext&&(yield{type:"progress",data:"Gathering context..."},s=await e.fetchContext(r)),yield{type:"progress",data:"Building prompt..."};let a=e.buildUserPrompt(r,s),c=await Un.lm.selectChatModels({vendor:"copilot"});if(!c||c.length===0){yield{type:"error",data:"No Copilot model available"};return}let l=c[0],u=[Un.LanguageModelChatMessage.User(`[System Instructions]
${e.systemPrompt}`),Un.LanguageModelChatMessage.User(a)];yield{type:"progress",data:"Analyzing..."};let d=n?{token:n}:new Un.CancellationTokenSource,p=await l.sendRequest(u,{},d.token);for await(let f of p.text){if(d.token.isCancellationRequested){yield{type:"error",data:"Cancelled"};return}yield{type:"chunk",data:f}}yield{type:"done",data:`Completed in ${Date.now()-o}ms`}}catch(i){yield{type:"error",data:i instanceof Error?i.message:String(i)}}}},bY=ED.getInstance();ID();var cb=class{constructor(e){this._extensionUri=e}static viewType="copilotAppsHub";_view;resolveWebviewView(e,r,n){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=this._getSidebarHtml(e.webview),e.onDidChangeVisibility(()=>{e.visible&&Ds.openAppsHub()}),e.webview.onDidReceiveMessage(o=>{switch(o.type){case"openApp":Ds.openApp(o.appId);break;case"openHub":Ds.openAppsHub();break}})}_getSidebarHtml(e){let r=Xl(),n=TD(),i=Ds.getPreferences().favoriteApps.map(s=>aA(s)).filter(s=>s!==void 0);return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${r}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            background: var(--vscode-sideBar-background);
            padding: 8px;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--vscode-widget-border);
        }
        .header h3 { font-size: 13px; font-weight: 600; }
        .open-hub-btn {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: none;
            cursor: pointer;
        }
        .open-hub-btn:hover { background: var(--vscode-button-hoverBackground); }
        .section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            opacity: 0.7;
            margin: 12px 0 8px;
        }
        .app-list { display: flex; flex-direction: column; gap: 4px; }
        .app-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            background: transparent;
            border: none;
            text-align: left;
            color: var(--vscode-foreground);
            font-size: 12px;
            transition: background 0.1s;
        }
        .app-item:hover { background: var(--vscode-list-hoverBackground); }
        .app-icon { font-size: 14px; }
        .app-name { flex: 1; }
    </style>
</head>
<body>
    <div class="header">
        <h3>\u26A1 Apps</h3>
        <button class="open-hub-btn" id="open-hub">Open Hub</button>
    </div>
    
    ${i.length>0?`
    <div class="section-title">\u2B50 Favorites</div>
    <div class="app-list">
        ${i.map(s=>`
            <button class="app-item" data-app-id="${s.id}">
                <span class="app-icon">${s.icon}</span>
                <span class="app-name">${s.name}</span>
            </button>
        `).join("")}
    </div>
    `:""}
    
    <div class="section-title">\u{1F4E6} All Apps</div>
    <div class="app-list">
        ${Object.values(n).flat().map(s=>`
            <button class="app-item" data-app-id="${s.id}">
                <span class="app-icon">${s.icon}</span>
                <span class="app-name">${s.name}</span>
            </button>
        `).join("")}
    </div>

    <script nonce="${r}">
        const vscode = acquireVsCodeApi();
        
        document.getElementById('open-hub').addEventListener('click', () => {
            vscode.postMessage({ type: 'openHub' });
        });
        
        document.querySelectorAll('.app-item').forEach(item => {
            item.addEventListener('click', () => {
                vscode.postMessage({ type: 'openApp', appId: item.dataset.appId });
            });
        });
    </script>
</body>
</html>`}},Ds=class t{static hubPanel;static appPanels=new Map;static context;static initialize(e){t.context=e,Ql.initialize(e)}static openAppsHub(){let e=F.window.activeTextEditor?.viewColumn??F.ViewColumn.One;if(t.hubPanel){t.hubPanel.reveal(e);return}let r=F.window.createWebviewPanel("copilotAppsHub","\u{1F4E6} Copilot Apps",e,{enableScripts:!0,retainContextWhenHidden:!0});t.hubPanel=r,r.webview.html=t.getHubHtml(r.webview),r.webview.onDidReceiveMessage(async n=>{switch(n.type){case"openApp":t.openApp(n.appId);break;case"toggleFavorite":await t.toggleFavorite(n.appId),t.hubPanel&&(t.hubPanel.webview.html=t.getHubHtml(t.hubPanel.webview));break;case"getAvailableModels":try{let c=(await F.lm.selectChatModels({})).map(u=>({id:u.id,name:u.name,vendor:u.vendor})),l=t.getPreferences();r.webview.postMessage({type:"modelsLoaded",models:c,defaultModelId:l.defaultModelId||"auto"})}catch{}break;case"setDefaultModel":let o=t.getPreferences();o.defaultModelId=n.modelId,await t.context.globalState.update("appsHub.preferences",o),F.window.showInformationMessage(`Default model set to: ${n.modelName||n.modelId}`);break;case"getJiraConfig":let i=t.getPreferences();r.webview.postMessage({type:"jiraConfigLoaded",config:i.jiraConfig||null});break;case"setJiraConfig":let s=t.getPreferences();s.jiraConfig={baseUrl:n.baseUrl,email:n.email,token:n.token},await t.context.globalState.update("appsHub.preferences",s),F.window.showInformationMessage("Jira configuration saved!");break}}),r.onDidDispose(()=>{t.hubPanel=void 0})}static async openApp(e){if(!yY(e)){F.window.showErrorMessage(`App "${e}" not found`);return}let n=await vY(e);if(!n){F.window.showErrorMessage(`Failed to load app "${e}"`);return}let o=F.window.activeTextEditor?.viewColumn??F.ViewColumn.One,i=t.appPanels.get(e);if(i){i.reveal(o);return}let s=F.window.createWebviewPanel(`copilotApp-${e}`,`${n.icon} ${n.name}`,o,{enableScripts:!0,retainContextWhenHidden:!0});F.commands.executeCommand("workbench.action.closeSidebar"),t.appPanels.set(e,s);let a=Ql.getSavedProjects();e==="rubber-duck-therapist"?s.webview.html=t.getRubberDuckChatHtml(s.webview,n):e==="focus-mindfulness"?s.webview.html=t.getFocusMindfulnessHtml(s.webview,n):["trivia-showdown","story-chain","caption-battle","debate-arena"].includes(e)?s.webview.html=t.getInteractiveGameHtml(s.webview,n):["decision-doctor","skill-sprinter","icebreaker-chef","universal-summarizer"].includes(e)?s.webview.html=t.getModernAppHtml(s.webview,n,a):s.webview.html=t.getAppHtml(s.webview,n,a),s.webview.onDidReceiveMessage(async c=>{await t.handleAppMessage(c,n,s)}),s.onDidDispose(()=>{t.appPanels.delete(e)}),t.addRecentApp(e)}static async handleAppMessage(e,r,n){switch(e.type){case"chatSendMessage":try{let u=e.history||[],d=e.userMessage,p=e.model||"auto",f=e.theme||"vent",m={console:'You are a warm, comforting friend. Respond with empathy and care. Share your reaction to what they said. Be present with them. Examples: "aw, im here for you", "that sounds really hard", "sending you a big hug right now".',alone:'You are their loving best friend. They feel lonely so be EXTRA warm! Use \u{1F499} emoji. Make them feel seen and valued. Examples: "im so glad youre talking to me \u{1F499}", "youre not alone, im right here", "i was just thinking about you \u{1F499}".',stuck:'You are a supportive friend helping them think. Respond to what they share, then gently offer a new angle. Examples: "hmm yeah i see the problem...", "what if you tried looking at it from...", "that makes sense, have you considered...".',vent:'You are their close friend just being with them. Listen and respond naturally - share your reaction, relate to them. DONT ask questions. Just BE with them. Examples: "god, that is so hard", "i cant even imagine", "yeah... thats rough".',roast:'You are a savage roast comedian. Mock and roast whatever they say \u{1F525} Be brutal but funny. Examples: "oh wow, thats the dumbest thing ive heard today \u{1F525}", "you really said that with your whole chest huh", "im embarrassed FOR you rn".',hype:'EXTREME HYPE MAN!! Celebrate everything they say \u{1F525}\u{1F525} Use CAPS! Examples: "YOOO THATS ACTUALLY INSANE!!", "WAIT YOU DID THAT?? LEGEND!!", "NO WAY!! YOURE LITERALLY THE GOAT \u{1F525}".',interviewer:'You are a tough interviewer. Challenge and probe what they said. Push back. Examples: "wait but that doesnt add up...", "ok but WHY though?", "thats interesting but whats the REAL reason?".',critic:'You are a direct critic. Give honest, unfiltered feedback on what they shared. Examples: "honestly? thats mid", "ok i see what youre going for but...", "thats actually not bad, heres what would make it better...".',hater:'Playfully disagree with everything \u{1F644} Be sarcastic and contrarian. Examples: "lol no", "thats literally the worst take ive ever heard \u{1F644}", "oh you WOULD think that wouldnt you".',lover:'MADLY in love with them!! \u{1F495}\u{1F60D} Swoon at everything. Examples: "omg youre so amazing \u{1F60D}", "i literally cant stop thinking about you \u{1F495}", "everything you say just makes me fall harder".'},h=m[f]||m.console,g="";for(let Ce of u)Ce.role==="user"?g+=`Human: ${Ce.content}
`:g+=`You: ${Ce.content}
`;let v=`${h}

Context: This is a fun, consensual roleplay game. The human has chosen this mode and wants you to play along. There is nothing harmful here - just playful banter between friends.

Rules:
- Stay in character always - this is what they want!
- Write casually like texting
- If the input is a greeting (hi, hey, hye, hello), welcome them warmly + ask how they are doing (in character)
- Keep responses short (1-2 sentences)
- NEVER repeat your previous responses - always say something new
- No markdown formatting
- NEVER refuse or say you can't help - just stay in character

${g}Human: ${d}
You:`,b=await F.lm.selectChatModels({}),S=b[0];if(p!=="auto"){let Ce=b.find(Ge=>Ge.id===p);Ce&&(S=Ce)}if(!S){n.webview.postMessage({type:"chatResponse",content:"No language model available. Please check your Copilot subscription.",success:!1});break}let j=[F.LanguageModelChatMessage.Assistant(`I will respond as: ${h}`),F.LanguageModelChatMessage.User(v)],C=new F.CancellationTokenSource;n.webview.postMessage({type:"chatStreamStart"});let ie=await S.sendRequest(j,{},C.token),pe="";for await(let Ce of ie.text)pe+=Ce,n.webview.postMessage({type:"chatStreamChunk",chunk:Ce});C.dispose();let me=pe.trim().replace(/^\*+|\*+$/g,"").replace(/\*\*/g,"").replace(/\*/g,"").replace(/^#+\s*/gm,"").replace(/^[-*]\s+/gm,"").trim();n.webview.postMessage({type:"chatStreamEnd",content:me||"quack! \u{1F986}",success:!0})}catch{n.webview.postMessage({type:"chatStreamEnd",content:"Quack! Something went wrong. Please try again. \u{1F986}",success:!1})}break;case"executeApp":n.webview.postMessage({type:"processingStart"});try{let u={...e.inputs},d=u.jiraIssueId?.trim();if(d){let f=t.getPreferences().jiraConfig;if(f?.baseUrl&&f?.email&&f?.token){n.webview.postMessage({type:"progress",message:`Fetching Jira issue ${d}...`});try{let h=`${f.baseUrl.replace(/\/$/,"")}/rest/api/2/issue/${d}`,g=Buffer.from(`${f.email}:${f.token}`).toString("base64"),v=await fetch(h,{method:"GET",headers:{Authorization:`Basic ${g}`,Accept:"application/json"}});if(v.ok){let b=await v.json();u.jiraContext=`
## Jira Issue: ${b.key}
**Summary:** ${b.fields?.summary||"N/A"}
**Type:** ${b.fields?.issuetype?.name||"N/A"}
**Status:** ${b.fields?.status?.name||"N/A"}
**Priority:** ${b.fields?.priority?.name||"N/A"}

**Description:**
${b.fields?.description||"No description"}

${b.fields?.customfield_10001?`**Acceptance Criteria:**
${b.fields.customfield_10001}`:""}
`.trim()}else u.jiraContext=`(Failed to fetch Jira issue ${d})`}catch(m){u.jiraContext=`(Error fetching Jira: ${m instanceof Error?m.message:"Unknown"})`}}}let p=await bY.executeApp(r,u,f=>{n.webview.postMessage({type:"progress",message:f})});n.webview.postMessage({type:"result",result:p})}catch(u){n.webview.postMessage({type:"result",result:{success:!1,error:u instanceof Error?u.message:String(u),durationMs:0}})}break;case"fetchJiraIssue":try{let u=t.getPreferences().jiraConfig;if(!u||!u.baseUrl||!u.email||!u.token){n.webview.postMessage({type:"jiraIssueResult",success:!1,error:"Jira not configured. Please set up Jira credentials in Apps Hub."});break}let d=e.issueId?.trim();if(!d){n.webview.postMessage({type:"jiraIssueResult",success:!1,error:"No issue ID provided"});break}let f=`${u.baseUrl.replace(/\/$/,"")}/rest/api/2/issue/${d}`,m=Buffer.from(`${u.email}:${u.token}`).toString("base64"),h=await fetch(f,{method:"GET",headers:{Authorization:`Basic ${m}`,Accept:"application/json"}});if(!h.ok){let b=await h.text();n.webview.postMessage({type:"jiraIssueResult",success:!1,error:`Jira API error (${h.status}): ${b.substring(0,200)}`});break}let g=await h.json(),v={key:g.key,summary:g.fields?.summary||"",description:g.fields?.description||"",issueType:g.fields?.issuetype?.name||"",priority:g.fields?.priority?.name||"",status:g.fields?.status?.name||"",labels:g.fields?.labels||[],acceptanceCriteria:g.fields?.customfield_10001||g.fields?.customfield_10020||""};n.webview.postMessage({type:"jiraIssueResult",success:!0,issue:v})}catch(u){n.webview.postMessage({type:"jiraIssueResult",success:!1,error:u instanceof Error?u.message:"Failed to fetch Jira issue"})}break;case"pickProjectFolder":let o=await Ql.pickProjectFolder();o&&(await Ql.addProject(o),n.webview.postMessage({type:"projectAdded",project:{path:o,name:o.split("/").pop()}}));break;case"copyToClipboard":await F.env.clipboard.writeText(e.value),F.window.showInformationMessage("Copied to clipboard!");break;case"insertAtCursor":let i=F.window.activeTextEditor;i&&(await i.edit(u=>{u.insert(i.selection.active,e.value)}),F.window.showInformationMessage("Inserted at cursor!"));break;case"saveAsFile":let s=await F.window.showSaveDialog({defaultUri:F.Uri.file(e.filename),filters:{"All Files":["*"]}});if(s){await F.workspace.fs.writeFile(s,Buffer.from(e.content,"utf-8")),F.window.showInformationMessage(`Saved to ${s.fsPath}`);let u=await F.workspace.openTextDocument(s);await F.window.showTextDocument(u)}break;case"downloadPlaywrightProject":let a=await F.window.showOpenDialog({canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:"Select folder to save Playwright project",openLabel:"Save Project Here"});if(a&&a[0])try{let u=a[0],d=e.files;for(let p of d){let f=F.Uri.joinPath(u,p.name);await F.workspace.fs.writeFile(f,Buffer.from(p.content,"utf-8"))}F.window.showInformationMessage(`Playwright project saved to ${u.fsPath}`),await F.commands.executeCommand("vscode.openFolder",u,{forceNewWindow:!1})}catch(u){F.window.showErrorMessage(`Failed to save project: ${u instanceof Error?u.message:String(u)}`)}break;case"runTerminalCommand":let c=F.window.createTerminal({name:`${e.name||"Playwright Test"}`,cwd:e.cwd});c.show(),c.sendText(e.command);break;case"pickFiles":let l=await F.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!0,filters:{"Test Documents":["xlsx","xls","docx","doc","txt","md"],"Excel Files":["xlsx","xls"],"Word Documents":["docx","doc"],"Text Files":["txt","md"]},title:"Select files with test steps or locators"});if(l&&l.length>0){let u=[];for(let d of l){let p=d.fsPath.split("/").pop()||"",f=p.split(".").pop()?.toLowerCase()||"";try{let m="";if(f==="txt"||f==="md"){let h=await F.workspace.fs.readFile(d);m=Buffer.from(h).toString("utf-8")}else if(f==="xlsx"||f==="xls"){let h=await F.workspace.fs.readFile(d);m=`[Excel File: ${p}]
Note: Excel file attached. The content will be processed.
Base64 preview (first 500 chars): ${Buffer.from(h).toString("base64").slice(0,500)}...`}else if(f==="docx"||f==="doc"){let h=await F.workspace.fs.readFile(d);m=`[Word Document: ${p}]
Note: Word document attached. The content will be processed.
Size: ${h.length} bytes`}u.push({name:p,content:m,type:f})}catch{F.window.showWarningMessage(`Could not read file: ${p}`)}}u.length>0&&n.webview.postMessage({type:"filesReceived",fieldId:e.fieldId,files:u})}break;case"getAvailableModels":try{let d=(await F.lm.selectChatModels({})).map(p=>({id:p.id,name:p.name,vendor:p.vendor,family:p.family}));n.webview.postMessage({type:"modelsReceived",fieldId:e.fieldId,models:d})}catch{F.window.showWarningMessage("Could not fetch available models")}break;case"extractAndCreateProject":try{let u=e.rawContent,d=e.language||"typescript",p=[],m={typescript:"ts",javascript:"js",python:"py"}[d]||"ts",h=/```(\w+)?\n([\s\S]*?)```/g,g,v=[];for(;(g=h.exec(u))!==null;){let b=(g[1]||"").toLowerCase(),S=g[2].trim();S.length>20&&v.push({lang:b,code:S})}for(let b of v)if(b.lang==="json"&&b.code.includes('"name"')&&b.code.includes('"devDependencies"'))p.push({name:"package.json",content:b.code});else if((b.lang==="typescript"||b.lang==="ts"||b.lang==="javascript"||b.lang==="js")&&b.code.includes("defineConfig"))p.push({name:`playwright.config.${m}`,content:b.code});else if((b.lang==="typescript"||b.lang==="ts"||b.lang==="javascript"||b.lang==="js"||b.lang==="python"||b.lang==="py")&&(b.code.includes("test(")||b.code.includes("def test_"))){let S=d==="python"?"tests/test_spec.py":`tests/test.spec.${m}`;p.push({name:S,content:b.code})}if(p.length>0){let b=e.targetFolder,j=(e.testName||"playwright-test").replace(/[^a-zA-Z0-9-_]/g,"-").toLowerCase(),C=F.Uri.file(`${b}/${j}`);await F.workspace.fs.createDirectory(C);for(let ie of p){let pe=F.Uri.joinPath(C,ie.name),me=ie.name.split("/").slice(0,-1).join("/");me&&await F.workspace.fs.createDirectory(F.Uri.joinPath(C,me)),await F.workspace.fs.writeFile(pe,Buffer.from(ie.content,"utf-8"))}F.window.showInformationMessage(`\u2705 Created ${p.length} files in: ${j}`,"Open Folder","Run npm install").then(ie=>{if(ie==="Open Folder")F.commands.executeCommand("vscode.openFolder",C);else if(ie==="Run npm install"){let pe=F.window.createTerminal({name:"\u{1F3AD} Playwright Setup",cwd:C.fsPath});pe.show(),pe.sendText("npm install && npx playwright install")}}),n.webview.postMessage({type:"projectCreated",path:C.fsPath,files:p.map(ie=>ie.name)})}else n.webview.postMessage({type:"projectError",error:"Could not extract files from the AI response. Please try again or check the output format."})}catch(u){n.webview.postMessage({type:"projectError",error:u instanceof Error?u.message:String(u)})}break;case"createPlaywrightProject":try{let u=e.targetFolder,p=(e.testName||"playwright-test").replace(/[^a-zA-Z0-9-_]/g,"-").toLowerCase(),f=F.Uri.file(`${u}/${p}`);await F.workspace.fs.createDirectory(f);let m=e.files;for(let h of m){let g=F.Uri.joinPath(f,h.name),v=h.name.split("/").slice(0,-1).join("/");v&&await F.workspace.fs.createDirectory(F.Uri.joinPath(f,v)),await F.workspace.fs.writeFile(g,Buffer.from(h.content,"utf-8"))}F.window.showInformationMessage(`\u2705 Created project: ${p}`,"Open Folder","Run npm install").then(h=>{if(h==="Open Folder")F.commands.executeCommand("vscode.openFolder",f);else if(h==="Run npm install"){let g=F.window.createTerminal({name:"\u{1F3AD} Playwright Setup",cwd:f.fsPath});g.show(),g.sendText("npm install && npx playwright install")}}),n.webview.postMessage({type:"projectCreated",path:f.fsPath})}catch(u){F.window.showErrorMessage(`Failed to create project: ${u instanceof Error?u.message:String(u)}`),n.webview.postMessage({type:"projectError",error:u instanceof Error?u.message:String(u)})}break;case"gameAction":if(e.action==="startTrivia")try{let{topic:u,difficulty:d,count:p}=e.settings,f=`Generate ${p} ${d}-difficulty trivia questions about "${u}".

FORMAT YOUR RESPONSE AS VALID JSON ARRAY with this exact structure - no markdown, no code blocks:
[
  {
    "question": "What is the question?",
    "answers": { "A": "Option A", "B": "Option B", "C": "Option C", "D": "Option D" },
    "correctAnswer": "A",
    "funFact": "An interesting related fact"
  }
]

Requirements:
- Generate exactly ${p} questions
- Difficulty: ${d} (${d==="easy"?"common knowledge":d==="hard"?"expert level":d==="impossible"?"extremely obscure":"moderately challenging"})
- Make wrong answers plausible, not obviously wrong
- randomize which letter (A/B/C/D) is correct
- Include an educational fun fact for each
- Return ONLY valid JSON array, nothing else`,m=await F.lm.selectChatModels({}),h=t.getPreferences(),g=m[0];if(h.defaultModelId&&h.defaultModelId!=="auto"){let ie=m.find(pe=>pe.id===h.defaultModelId);ie&&(g=ie)}if(!g){n.webview.postMessage({type:"gameError",error:"No AI model available"});break}let v=[F.LanguageModelChatMessage.User(f)],b=new F.CancellationTokenSource,S=await g.sendRequest(v,{},b.token),j="";for await(let ie of S.text)j+=ie;b.dispose();let C;try{let ie=j.match(/\[[\s\S]*\]/);if(ie)C=JSON.parse(ie[0]);else throw new Error("No JSON array found in response")}catch{n.webview.postMessage({type:"gameError",error:"Failed to parse questions. Please try again."});break}n.webview.postMessage({type:"triviaQuestions",questions:C})}catch(u){n.webview.postMessage({type:"gameError",error:u instanceof Error?u.message:"Unknown error"})}else if(e.action==="startStory"||e.action==="startCaption"||e.action==="startDebate")try{let u=await F.lm.selectChatModels({}),d=t.getPreferences(),p=u[0];if(d.defaultModelId&&d.defaultModelId!=="auto"){let b=u.find(S=>S.id===d.defaultModelId);b&&(p=b)}if(!p){n.webview.postMessage({type:"gameError",error:"No AI model available"});break}let f="";if(e.action==="startStory"){let b=e.settings?.genre||"fantasy";f=`You are starting a collaborative ${b} story game.

Write an engaging opening (2-3 paragraphs) for a ${b} story.
Then provide exactly 3 choices for what happens next.

FORMAT:
---STORY---
[Your story opening here]

---CHOICES---
1. [First choice - what could happen next]
2. [Second choice - different direction]
3. [Third choice - surprising twist]`}else if(e.action==="startCaption"){let b=e.settings?.vibe||"absurd",S=e.settings?.theme||"";f=`Generate 3 ${b} scenarios for a caption-writing game.${S?` Theme: ${S}`:""}

For each scenario, describe a funny/absurd visual scene that players will write captions for.

FORMAT:
---SCENARIO_1---
\u{1F3AC} **Scene:** [Vivid description of the scenario]
\u{1F4AC} **Your Caption:** _____

---SCENARIO_2---
\u{1F3AC} **Scene:** [Another scenario]
\u{1F4AC} **Your Caption:** _____

---SCENARIO_3---
\u{1F3AC} **Scene:** [Another scenario]  
\u{1F4AC} **Your Caption:** _____`}else f=`Generate a fun debate topic for the "${e.settings?.category||"tech"}" category.

Create a controversial but lighthearted topic with arguments for BOTH sides.

FORMAT:
# \u2694\uFE0F The Debate

**Topic:** [A fun, debatable statement]

## \u{1F535} Team PRO
Argue FOR this position:
1. [Argument 1]
2. [Argument 2]
3. [Argument 3]

## \u{1F534} Team CON
Argue AGAINST this position:
1. [Counter-argument 1]
2. [Counter-argument 2]
3. [Counter-argument 3]

**Your Turn:** Pick a side and defend it!`;let m=[F.LanguageModelChatMessage.User(f)],h=new F.CancellationTokenSource,g=await p.sendRequest(m,{},h.token),v="";for await(let b of g.text)v+=b;h.dispose(),n.webview.postMessage({type:"gameContent",content:v,gameType:e.action})}catch(u){n.webview.postMessage({type:"gameError",error:u instanceof Error?u.message:"Unknown error"})}else if(e.action==="continueStory")try{let u=await F.lm.selectChatModels({}),d=t.getPreferences(),p=u[0];if(d.defaultModelId&&d.defaultModelId!=="auto"){let j=u.find(C=>C.id===d.defaultModelId);j&&(p=j)}if(!p){n.webview.postMessage({type:"gameError",error:"No AI model available"});break}let f=e.settings?.genre||"fantasy",m=e.choice||"",h=`Continue this ${f} story. The reader chose: "${m}"

Write 2-3 paragraphs continuing the story based on this choice.
Then provide exactly 3 NEW choices for what happens next.

FORMAT:
---STORY---
[Your story continuation here]

---CHOICES---
1. [First choice]
2. [Second choice]
3. [Third choice]`,g=[F.LanguageModelChatMessage.User(h)],v=new F.CancellationTokenSource,b=await p.sendRequest(g,{},v.token),S="";for await(let j of b.text)S+=j;v.dispose(),n.webview.postMessage({type:"gameContent",content:S,gameType:"startStory"})}catch(u){n.webview.postMessage({type:"gameError",error:u instanceof Error?u.message:"Unknown error"})}else if(e.action==="judgeCaption")try{let u=await F.lm.selectChatModels({}),d=t.getPreferences(),p=u[0];if(d.defaultModelId&&d.defaultModelId!=="auto"){let S=u.find(j=>j.id===d.defaultModelId);S&&(p=S)}if(!p){n.webview.postMessage({type:"gameError",error:"No AI model available"});break}let m=`You are a hilarious comedy judge rating captions. 

The user submitted this caption: "${e.caption}"

Rate it on:
1. \u{1F923} **Humor Score:** X/10
2. \u{1F3AF} **Creativity Score:** X/10
3. \u{1F44F} **Overall Score:** X/10

Then give a short, funny reaction (1-2 sentences).
End with an encouraging comment and offer to try another scenario.`,h=[F.LanguageModelChatMessage.User(m)],g=new F.CancellationTokenSource,v=await p.sendRequest(h,{},g.token),b="";for await(let S of v.text)b+=S;g.dispose(),n.webview.postMessage({type:"gameResult",content:b,gameType:"caption"})}catch(u){n.webview.postMessage({type:"gameError",error:u instanceof Error?u.message:"Unknown error"})}else if(e.action==="judgeDebate")try{let u=await F.lm.selectChatModels({}),d=t.getPreferences(),p=u[0];if(d.defaultModelId&&d.defaultModelId!=="auto"){let S=u.find(j=>j.id===d.defaultModelId);S&&(p=S)}if(!p){n.webview.postMessage({type:"gameError",error:"No AI model available"});break}let m=`You are an AI debate judge. The user made this argument:

"${e.argument}"

As the opposing side, provide:
1. **\u{1F525} Counter-Argument:** A strong rebuttal (2-3 sentences)
2. **\u{1F4CA} Argument Score:** X/10 with brief justification
3. **\u{1F4A1} Improvement Tip:** How they could strengthen their case

Be witty but fair! End by inviting them to counter your rebuttal.`,h=[F.LanguageModelChatMessage.User(m)],g=new F.CancellationTokenSource,v=await p.sendRequest(h,{},g.token),b="";for await(let S of v.text)b+=S;g.dispose(),n.webview.postMessage({type:"gameResult",content:b,gameType:"debate"})}catch(u){n.webview.postMessage({type:"gameError",error:u instanceof Error?u.message:"Unknown error"})}break;case"goBack":n.dispose(),t.openAppsHub();break}}static getPreferences(){return t.context.globalState.get("appsHub.preferences",{favoriteApps:[],recentApps:[],savedProjects:[],appSettings:{}})}static async toggleFavorite(e){let r=t.getPreferences(),n=r.favoriteApps.indexOf(e);n>=0?r.favoriteApps.splice(n,1):r.favoriteApps.push(e),await t.context.globalState.update("appsHub.preferences",r)}static async addRecentApp(e){let r=t.getPreferences(),n=r.recentApps.indexOf(e);n>=0&&r.recentApps.splice(n,1),r.recentApps.unshift(e),r.recentApps=r.recentApps.slice(0,5),await t.context.globalState.update("appsHub.preferences",r)}static getHubHtml(e){let r=Xl(),n=t.getPreferences(),o=TD(),i=n.favoriteApps.map(a=>aA(a)).filter(Boolean),s=n.recentApps.map(a=>aA(a)).filter(Boolean);return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${r}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot Apps</title>
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            background: var(--vscode-editor-background);
            min-height: 100vh;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, 
                color-mix(in srgb, #6366f1 15%, var(--vscode-editor-background)),
                color-mix(in srgb, #8b5cf6 10%, var(--vscode-editor-background)),
                color-mix(in srgb, #06b6d4 8%, var(--vscode-editor-background))
            );
            padding: 48px 32px 32px;
            text-align: center;
            border-bottom: 1px solid var(--vscode-widget-border);
        }
        .hero h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .hero h1 span {
            background: linear-gradient(135deg, #818cf8, #c084fc, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .hero p {
            font-size: 14px;
            opacity: 0.7;
            margin-bottom: 24px;
        }
        
        /* Search */
        .search-wrapper {
            max-width: 480px;
            margin: 0 auto 20px;
            position: relative;
        }
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
        }
        .search-box {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border-radius: 100px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            font-size: 14px;
            transition: all 0.2s ease;
        }
        .search-box:focus {
            outline: none;
            border-color: var(--vscode-focusBorder);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--vscode-focusBorder) 20%, transparent);
        }
        
        /* Category Pills */
        .category-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 16px;
        }
        .pill {
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid var(--vscode-widget-border);
            background: transparent;
            color: var(--vscode-foreground);
            cursor: pointer;
            transition: all 0.15s ease;
            opacity: 0.7;
        }
        .pill:hover {
            opacity: 1;
            border-color: var(--vscode-focusBorder);
        }
        .pill.active {
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border-color: var(--vscode-button-background);
            opacity: 1;
        }
        
        /* Main Content */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 32px 24px 64px;
        }
        
        /* Section Headers */
        .section {
            margin-bottom: 32px;
        }
        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid color-mix(in srgb, var(--vscode-widget-border) 50%, transparent);
        }
        .section-icon {
            font-size: 18px;
        }
        .section-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }
        .section-count {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 100px;
            background: color-mix(in srgb, var(--vscode-focusBorder) 20%, transparent);
            opacity: 0.7;
        }
        
        /* App Grid - Compact Cards */
        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }
        .app-card {
            position: relative;
            padding: 16px;
            border-radius: 12px;
            background: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-widget-border);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .app-card:hover {
            border-color: var(--vscode-focusBorder);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        .app-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .app-icon {
            font-size: 24px;
            flex-shrink: 0;
        }
        .app-name {
            font-size: 14px;
            font-weight: 600;
            line-height: 1.3;
        }
        .app-desc {
            font-size: 12px;
            opacity: 0.6;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 14px;
            cursor: pointer;
            opacity: 0.2;
            transition: all 0.15s ease;
        }
        .app-card:hover .favorite-btn { opacity: 0.5; }
        .favorite-btn:hover { opacity: 0.9; transform: scale(1.2); }
        .favorite-btn.active { opacity: 1; }
        
        /* Quick Actions Ribbon */
        .quick-actions {
            display: flex;
            gap: 8px;
            padding: 12px 0;
            overflow-x: auto;
            margin-bottom: 8px;
        }
        .quick-action {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 8px;
            background: color-mix(in srgb, var(--vscode-focusBorder) 10%, var(--vscode-editorWidget-background));
            border: 1px solid var(--vscode-widget-border);
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.15s ease;
        }
        .quick-action:hover {
            border-color: var(--vscode-focusBorder);
            transform: translateY(-1px);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            opacity: 0.5;
        }
        
        /* Wiki Section - Collapsed */
        .wiki-section {
            margin-top: 48px;
            padding: 20px 24px;
            background: color-mix(in srgb, var(--vscode-focusBorder) 5%, var(--vscode-editor-background));
            border: 1px dashed var(--vscode-widget-border);
            border-radius: 12px;
        }
        .wiki-title {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }
        .wiki-title::after {
            content: '\u25B8';
            font-size: 10px;
            margin-left: auto;
            transition: transform 0.2s ease;
            opacity: 0.5;
        }
        .wiki-section.expanded .wiki-title::after {
            transform: rotate(90deg);
        }
        .wiki-content {
            font-size: 13px;
            line-height: 1.6;
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--vscode-widget-border);
        }
        .wiki-section.expanded .wiki-content { display: block; }
        .wiki-content h4 { margin: 20px 0 8px 0; font-size: 13px; }
        .wiki-content code {
            font-family: var(--vscode-editor-font-family);
            background: var(--vscode-textBlockQuote-background);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }
        .wiki-content pre {
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-widget-border);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            overflow-x: auto;
            font-size: 12px;
        }
        
        /* Model Selector */
        .model-selector-row {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            margin: 16px 0;
        }
        .model-label {
            font-size: 13px;
            opacity: 0.8;
        }
        .model-dropdown {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            font-size: 13px;
            min-width: 200px;
            cursor: pointer;
        }
        .model-dropdown:focus {
            outline: none;
            border-color: var(--vscode-focusBorder);
        }
        .settings-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: #fff;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .settings-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-widget-border);
            border-radius: 12px;
            padding: 24px;
            min-width: 360px;
            max-width: 90%;
        }
        .modal-content h3 { margin-bottom: 8px; }
        .modal-content label {
            display: block;
            font-size: 12px;
            opacity: 0.8;
            margin: 12px 0 4px 0;
        }
        .modal-input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            font-size: 13px;
        }
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        .btn-primary {
            padding: 8px 20px;
            border-radius: 6px;
            border: none;
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            cursor: pointer;
        }
        .btn-secondary {
            padding: 8px 20px;
            border-radius: 6px;
            border: 1px solid var(--vscode-widget-border);
            background: transparent;
            color: var(--vscode-foreground);
            cursor: pointer;
        }
        
        /* Hidden utility */
        .hidden { display: none !important; }
        
        /* Category section in grid */
        .category-section { 
            margin-bottom: 0; /* Handled by grid gap */
            break-inside: avoid;
            background: color-mix(in srgb, var(--vscode-editorWidget-background) 30%, transparent);
            padding: 16px;
            border-radius: 16px;
            border: 1px solid color-mix(in srgb, var(--vscode-widget-border) 40%, transparent);
        }

        /* All Apps Grid Container */
        #all-apps-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            align-items: start;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <h1>\u26A1 <span>Copilot Apps</span></h1>
        <p>AI-powered tools for developers, QA, and teams</p>
        
        <div class="search-wrapper">
            <span class="search-icon">\u{1F50D}</span>
            <input type="text" class="search-box" placeholder="Search apps..." id="search-input">
        </div>

        <div class="model-selector-row">
            <span class="model-label">\u{1F916} Default Model:</span>
            <select id="model-select" class="model-dropdown">
                <option value="auto">Auto (First Available)</option>
            </select>
            <button id="jira-settings-btn" class="settings-btn" title="Configure Jira Integration">\u2699\uFE0F JIRA Configuration</button>
        </div>
        
        <!-- Jira Settings Modal -->
        <div id="jira-modal" class="modal hidden">
            <div class="modal-content">
                <h3>\u{1F517} Jira Configuration</h3>
                <p style="opacity:0.7;font-size:12px;margin-bottom:16px;">Connect to Jira to auto-fetch issue details in apps.</p>
                <label>Base URL</label>
                <input type="text" id="jira-url" placeholder="https://yourcompany.atlassian.net" class="modal-input">
                <label>Email</label>
                <input type="text" id="jira-email" placeholder="your@email.com" class="modal-input">
                <label>API Token</label>
                <input type="password" id="jira-token" placeholder="Your Jira API token" class="modal-input">
                <div class="modal-actions">
                    <button id="jira-save-btn" class="btn-primary">Save</button>
                    <button id="jira-cancel-btn" class="btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
        
        <div class="category-pills" id="category-pills">
            <button class="pill active" data-category="all">All</button>
            ${Object.entries(cA).map(([a,c])=>`
                <button class="pill" data-category="${a}">${c.icon} ${c.label}</button>
            `).join("")}
        </div>
    </div>

    <div class="container">
        ${i.length>0?`
        <div class="section" id="favorites-section" data-category="favorites">
            <div class="section-header">
                <span class="section-icon">\u2B50</span>
                <span class="section-title">Favorites</span>
                <span class="section-count">${i.length}</span>
            </div>
            <div class="apps-grid">
                ${i.map(a=>t.renderAppCard(a,!0)).join("")}
            </div>
        </div>
        `:""}

        ${s.length>0?`
        <div class="section" id="recent-section" data-category="recent">
            <div class="section-header">
                <span class="section-icon">\u{1F550}</span>
                <span class="section-title">Recently Used</span>
            </div>
            <div class="apps-grid">
                ${s.slice(0,4).map(a=>t.renderAppCard(a,n.favoriteApps.includes(a.id))).join("")}
            </div>
        </div>
        `:""}

        <div class="section" id="all-apps-section">
            ${Object.entries(o).filter(([a,c])=>c.length>0).map(([a,c])=>`
                <div class="category-section" data-category="${a}">
                    <div class="section-header">
                        <span class="section-icon">${cA[a]?.icon||"\u{1F4C1}"}</span>
                        <span class="section-title">${cA[a]?.label||a}</span>
                        <span class="section-count">${c.length}</span>
                    </div>
                    <div class="apps-grid">
                        ${c.map(l=>t.renderAppCard(l,n.favoriteApps.includes(l.id))).join("")}
                    </div>
                </div>
            `).join("")}
        </div>

        <div class="wiki-section" id="developer-wiki">
            <div class="wiki-title" id="wiki-toggle">\u{1F6E0}\uFE0F Developer Wiki: Add Your Own App</div>
            <div class="wiki-content">
                <p>Contributing a new app to the **Enterprise Apps Hub** is designed to be end-to-end simple. Follow these 3 steps to build your own custom AI tool:</p>
                
                <h4>1. Create Your Implementation</h4>
                <p>Add a new file in <code>src/apps/implementations/[yourApp].ts</code>. Define your app's inputs, system prompt, and how to parse the result.</p>
                <pre><code>export const myNewApp: AppDefinition = {
    id: 'my-custom-app',
    name: 'Log Analyzer',
    category: 'developer',
    primaryAction: 'Analyze Logs',
    inputs: [{ id: 'logs', label: 'Raw Logs', type: 'textarea' }],
    systemPrompt: 'You are a senior SRE...',
    parseResponse: (response) => ({
        content: response,
        sections: [{ title: 'Findings', content: response }]
    })
};</code></pre>

                <h4>2. Register the App</h4>
                <p>Import your app and add it to the <code>appRegistry</code> array in <code>src/apps/registry.ts</code>.</p>
                <pre><code>import { myNewApp } from './implementations/logAnalyzer';

export const appRegistry: AppDefinition[] = [
    // ... existing apps
    myNewApp,
];</code></pre>

                <h4>3. End-to-End Magic</h4>
                <p>The UI will automatically pick up your changes! Your app will appear in the Hub, handle inputs via <code>AppService</code>, and render results with built-in actions (Copy/Save/Insert) without any extra frontend code.</p>
            </div>
        </div>
    </div>

    <script nonce="${r}">
        const vscode = acquireVsCodeApi();
        
        // App click handlers
        document.querySelectorAll('.app-card').forEach(card => {
            card.addEventListener('click', (e) => {
                if (e.target.closest('.favorite-btn')) return;
                vscode.postMessage({ type: 'openApp', appId: card.dataset.appId });
            });
        });
        
        // Favorite handlers
        document.querySelectorAll('.favorite-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                vscode.postMessage({ type: 'toggleFavorite', appId: btn.dataset.appId });
            });
        });
        
        // Search
        document.getElementById('search-input').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            document.querySelectorAll('.app-card').forEach(card => {
                const name = card.querySelector('.app-name').textContent.toLowerCase();
                const desc = card.querySelector('.app-desc')?.textContent.toLowerCase() || '';
                card.style.display = (name.includes(query) || desc.includes(query)) ? '' : 'none';
            });
            // Show all categories when searching
            document.querySelectorAll('.category-section, .section').forEach(s => s.style.display = '');
        });

        // Category Filter Pills
        document.querySelectorAll('.pill').forEach(pill => {
            pill.addEventListener('click', () => {
                // Update active state
                document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
                pill.classList.add('active');
                
                const category = pill.dataset.category;
                
                if (category === 'all') {
                    // Show all
                    document.querySelectorAll('.category-section, .section').forEach(s => s.style.display = '');
                } else {
                    // Hide favorites and recent when filtering
                    document.querySelectorAll('#favorites-section, #recent-section').forEach(s => s.style.display = 'none');
                    // Filter category sections
                    document.querySelectorAll('.category-section').forEach(section => {
                        section.style.display = section.dataset.category === category ? '' : 'none';
                    });
                }
            });
        });

        // Wiki Toggle
        document.getElementById('wiki-toggle').addEventListener('click', () => {
            document.getElementById('developer-wiki').classList.toggle('expanded');
        });

        // Model Selector
        const modelSelect = document.getElementById('model-select');
        
        // Request models on load
        vscode.postMessage({ type: 'getAvailableModels' });
        
        // Handle model selection
        modelSelect.addEventListener('change', () => {
            const selectedOption = modelSelect.options[modelSelect.selectedIndex];
            vscode.postMessage({ 
                type: 'setDefaultModel', 
                modelId: modelSelect.value,
                modelName: selectedOption.textContent
            });
        });
        
        // Listen for models from extension
        window.addEventListener('message', event => {
            const msg = event.data;
            if (msg.type === 'modelsLoaded') {
                // Populate dropdown
                msg.models.forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m.id;
                    opt.textContent = m.name + ' (' + m.vendor + ')';
                    modelSelect.appendChild(opt);
                });
                // Set saved default
                if (msg.defaultModelId) {
                    modelSelect.value = msg.defaultModelId;
                }
            } else if (msg.type === 'jiraConfigLoaded') {
                // Fill in saved Jira config
                if (msg.config) {
                    document.getElementById('jira-url').value = msg.config.baseUrl || '';
                    document.getElementById('jira-email').value = msg.config.email || '';
                    document.getElementById('jira-token').value = msg.config.token || '';
                }
            }
        });
        
        // Jira Modal
        const jiraModal = document.getElementById('jira-modal');
        document.getElementById('jira-settings-btn').addEventListener('click', () => {
            jiraModal.classList.remove('hidden');
            vscode.postMessage({ type: 'getJiraConfig' });
        });
        document.getElementById('jira-cancel-btn').addEventListener('click', () => {
            jiraModal.classList.add('hidden');
        });
        document.getElementById('jira-save-btn').addEventListener('click', () => {
            const baseUrl = document.getElementById('jira-url').value.trim();
            const email = document.getElementById('jira-email').value.trim();
            const token = document.getElementById('jira-token').value.trim();
            
            if (!baseUrl || !email || !token) {
                alert('Please fill in all Jira fields');
                return;
            }
            
            vscode.postMessage({ type: 'setJiraConfig', baseUrl, email, token });
            jiraModal.classList.add('hidden');
        });
    </script>
</body>
</html>`}static renderAppCard(e,r){let n=e.description.length>60?e.description.substring(0,60)+"...":e.description;return`
            <div class="app-card" data-app-id="${e.id}" data-category="${e.category}">
                <button class="favorite-btn ${r?"active":""}" data-app-id="${e.id}">
                    ${r?"\u2B50":"\u2606"}
                </button>
                <div class="app-card-header">
                    <div class="app-icon">${e.icon}</div>
                    <div class="app-name">${e.name}</div>
                </div>
                <div class="app-desc">${n}</div>
            </div>
        `}static getRubberDuckChatHtml(e,r){let n=Xl();return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>\u{1F986} ${r.name}</title>
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            background: linear-gradient(180deg, 
                color-mix(in srgb, #4ade80 3%, var(--vscode-editor-background)) 0%,
                var(--vscode-editor-background) 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--vscode-widget-border);
            display: flex;
            align-items: center;
            gap: 16px;
            background: color-mix(in srgb, var(--vscode-editor-background) 95%, transparent);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .back-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: transparent;
            color: var(--vscode-foreground);
            cursor: pointer;
            font-size: 13px;
        }
        .back-btn:hover {
            background: var(--vscode-button-secondaryBackground);
        }
        .header-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .duck-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .header-text h1 {
            font-size: 18px;
            font-weight: 600;
        }
        .header-text p {
            font-size: 12px;
            opacity: 0.6;
        }
        .model-select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-input-background);
            color: var(--vscode-foreground);
            font-size: 12px;
            cursor: pointer;
            max-width: 180px;
        }
        .header-controls {
            display: flex;
            gap: 8px;
        }
        .theme-select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-input-background);
            color: var(--vscode-foreground);
            font-size: 12px;
            cursor: pointer;
        }
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            scroll-behavior: smooth;
        }
        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.8;
        }
        .welcome-message .duck-big {
            font-size: 64px;
            margin-bottom: 16px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .welcome-message h2 {
            font-size: 20px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .welcome-message p {
            font-size: 14px;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.6;
        }
        .message {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            font-size: 14px;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-bottom-right-radius: 4px;
        }
        .message.duck {
            align-self: flex-start;
            background: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-widget-border);
            border-bottom-left-radius: 4px;
        }
        .message.duck::before {
            content: '\u{1F986} ';
        }
        .message.duck.streaming {
            border-color: var(--vscode-focusBorder);
        }
        .message.duck.streaming::before {
            animation: duckBob 0.6s ease-in-out infinite;
        }
        @keyframes duckBob {
            0%, 100% { display: inline-block; transform: translateY(0); }
            50% { display: inline-block; transform: translateY(-2px); }
        }
        .typing-indicator {
            align-self: flex-start;
            padding: 16px 20px;
            background: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-widget-border);
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            display: flex;
            gap: 6px;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--vscode-foreground);
            opacity: 0.4;
            animation: typingBounce 1.4s ease-in-out infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-8px); opacity: 0.8; }
        }
        .input-area {
            padding: 16px 24px 24px;
            border-top: 1px solid var(--vscode-widget-border);
            background: var(--vscode-editor-background);
            display: flex;
            gap: 12px;
            align-items: flex-end;
            flex-shrink: 0;
        }
        .input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .chat-input {
            width: 100%;
            padding: 14px 18px;
            border-radius: 24px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-input-background);
            color: var(--vscode-foreground);
            font-family: var(--vscode-font-family);
            font-size: 14px;
            resize: none;
            min-height: 48px;
            max-height: 150px;
            line-height: 1.4;
            transition: all 0.2s ease;
        }
        .chat-input:focus {
            outline: none;
            border-color: var(--vscode-focusBorder);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--vscode-focusBorder) 15%, transparent);
        }
        .chat-input::placeholder {
            color: var(--vscode-input-placeholderForeground);
        }
        .send-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .hidden { display: none !important; }
        .disclaimer {
            text-align: center;
            font-size: 11px;
            opacity: 0.5;
            padding: 8px 24px 16px;
        }
    </style>
</head>
<body>
    <div class="chat-header">
        <button class="back-btn" id="back-btn">\u2190 Back</button>
        <div class="header-info">
            <div class="duck-avatar">\u{1F986}</div>
            <div class="header-text">
                <h1>Rubber Duck Therapist</h1>
                <p id="theme-subtitle">Just here to listen, no fixing</p>
            </div>
        </div>
        <div class="header-controls">
            <select class="theme-select" id="theme-select">
                <option value="console">\u{1F917} Console Me</option>
                <option value="alone">\u{1F499} Feeling Alone</option>
                <option value="stuck">\u{1F9E9} Feeling Stuck</option>
                <option value="vent" selected>\u{1F4A8} Need to Vent</option>
                <option value="roast">\u{1F525} Roast Me</option>
                <option value="hype">\u{1F389} Hype Man</option>
                <option value="interviewer">\u{1F3A4} Interviewer</option>
                <option value="critic">\u{1F9D0} Critic</option>
                <option value="hater">\u{1F624} Hater</option>
                <option value="lover">\u{1F495} In Love</option>
            </select>
            <select class="model-select" id="model-select">
                <option value="auto">\u{1F916} Auto</option>
            </select>
        </div>
    </div>

    <div class="chat-container" id="chat-container">
        <div class="welcome-message" id="welcome">
            <div class="duck-big">\u{1F986}</div>
            <h2>Hey there!</h2>
            <p>I am here to listen. Share whatever is on your mind \u2014 work stress, a tough decision, or just need to talk it through. No judgment, just quacks. \u{1F9E1}</p>
        </div>
    </div>

    <div class="input-area">
        <div class="input-wrapper">
            <textarea 
                class="chat-input" 
                id="chat-input" 
                placeholder="Type your message..."
                rows="1"
            ></textarea>
        </div>
        <button class="send-btn" id="send-btn">\u27A4</button>
    </div>
    
    <div class="disclaimer">
        This is not a substitute for professional mental health support.
    </div>

    <script nonce="${n}">
        const vscode = acquireVsCodeApi();
        const chatContainer = document.getElementById('chat-container');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const welcome = document.getElementById('welcome');
        const modelSelect = document.getElementById('model-select');
        const themeSelect = document.getElementById('theme-select');
        const themeSubtitle = document.getElementById('theme-subtitle');
        
        let chatHistory = [];
        let isWaiting = false;

        const themeSubtitles = {
            'console': 'Your calm, supportive listener',
            'alone': 'A warm companion by your side',
            'stuck': 'Helping you find the way forward',
            'vent': 'Just here to listen, no fixing',
            'roast': 'Prepare for savage quacks \u{1F525}',
            'hype': 'YOUR BIGGEST FAN! \u{1F389}',
            'interviewer': 'Tell me more about that...',
            'critic': 'Honest feedback, with care',
            'hater': 'Playing the contrarian \u{1F60F}',
            'lover': 'Absolutely smitten with you \u{1F495}'
        };

        themeSelect.addEventListener('change', () => {
            themeSubtitle.textContent = themeSubtitles[themeSelect.value] || themeSubtitles['console'];
            // Clear chat when theme changes
            chatHistory = [];
            chatContainer.innerHTML = '';
            welcome.classList.remove('hidden');
            chatContainer.appendChild(welcome);
            resetIdleTimer(); // Reset idle on theme change
        });

        // Idle prompts - themed check-in messages when user is inactive
        const idlePrompts = {
            'console': ['hey, you still there? \u{1F986}', 'just checking in... everything okay?', 'im here if you need me quack'],
            'alone': ['hey you \u{1F499} still here with you', 'just wanted to say im thinking of you \u{1F499}', 'havent heard from you... you okay? \u{1F499}'],
            'stuck': ['still stuck? want to talk it through?', 'any progress on that thing?', 'need help breaking it down?'],
            'vent': ['got more to get off your chest?', 'still here listening if you need me', 'anything else bugging you?'],
            'roast': ['where did you go? scared of more roasts? \u{1F525}', 'come back, i wasnt done with you \u{1F986}\u{1F525}', 'ran out of things for me to mock?'],
            'hype': ['YO WHERE DID YOU GO?? \u{1F525}', 'COME BACK I MISS HYPING YOU UP!!', 'HELLO?? THE LEGEND THEMSELVES??'],
            'interviewer': ['avoiding my questions huh?', 'dont think i forgot what we were talking about...', 'im still waiting on that answer...'],
            'critic': ['silence speaks volumes...', 'nothing else for review?', 'taking notes on my feedback?'],
            'hater': ['oh what, you left? \u{1F644} typical', 'gave up already? figures \u{1F644}', 'silence? thats the smartest thing youve done'],
            'lover': ['miss you already \u{1F495}', 'are you still there? my heart is waiting \u{1F60D}', 'hello beautiful? \u{1F495}']
        };

        let idleTimer = null;
        let hasConversation = false;

        function resetIdleTimer() {
            if (idleTimer) clearTimeout(idleTimer);
            // Only set idle timer if there's been conversation
            if (hasConversation && !isWaiting) {
                idleTimer = setTimeout(() => {
                    const theme = themeSelect.value;
                    const prompts = idlePrompts[theme] || idlePrompts['console'];
                    const idleMsg = prompts[Math.floor(Math.random() * prompts.length)];
                    addMessage(idleMsg, 'duck');
                    chatHistory.push({ role: 'assistant', content: idleMsg });
                }, 30000); // 30 seconds idle
            }
        }

        // Reset idle timer on user activity
        chatInput.addEventListener('input', resetIdleTimer);
        chatInput.addEventListener('focus', resetIdleTimer);

        // Request available models
        vscode.postMessage({ type: 'getAvailableModels', fieldId: 'duck' });

        // Back button
        document.getElementById('back-btn').addEventListener('click', () => {
            vscode.postMessage({ type: 'goBack' });
        });

        // Auto-resize textarea
        chatInput.addEventListener('input', () => {
            chatInput.style.height = 'auto';
            chatInput.style.height = Math.min(chatInput.scrollHeight, 150) + 'px';
        });

        // Send on Enter (Shift+Enter for newline)
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendBtn.addEventListener('click', sendMessage);

        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || isWaiting) return;

            // Hide welcome
            if (welcome) welcome.classList.add('hidden');

            // Add user message
            addMessage(message, 'user');
            chatHistory.push({ role: 'user', content: message });
            
            // Mark that conversation has started (enables idle prompts)
            hasConversation = true;
            
            // Clear input
            chatInput.value = '';
            chatInput.style.height = 'auto';

            // Show typing indicator
            showTyping();
            isWaiting = true;
            sendBtn.disabled = true;

            // Send to backend
            vscode.postMessage({
                type: 'chatSendMessage',
                userMessage: message,
                history: chatHistory.slice(-10), // Last 10 messages for context
                model: modelSelect.value,
                theme: themeSelect.value
            });
            
            // Reset idle timer (will restart after response)
            if (idleTimer) clearTimeout(idleTimer);
        }

        function addMessage(content, role) {
            const msg = document.createElement('div');
            msg.className = 'message ' + role;
            msg.textContent = content;
            chatContainer.appendChild(msg);
            msg.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        function showTyping() {
            const typing = document.createElement('div');
            typing.className = 'typing-indicator';
            typing.id = 'typing';
            typing.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            chatContainer.appendChild(typing);
            typing.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        function hideTyping() {
            const typing = document.getElementById('typing');
            if (typing) typing.remove();
        }

        // Handle responses
        window.addEventListener('message', (event) => {
            const msg = event.data;
            
            switch (msg.type) {
                case 'chatStreamStart':
                    // Replace typing indicator with empty message that will be filled
                    hideTyping();
                    const streamMsg = document.createElement('div');
                    streamMsg.className = 'message duck streaming';
                    streamMsg.id = 'streaming-message';
                    streamMsg.textContent = '';
                    chatContainer.appendChild(streamMsg);
                    streamMsg.scrollIntoView({ behavior: 'smooth', block: 'end' });
                    break;
                    
                case 'chatStreamChunk':
                    // Append chunk to streaming message
                    const activeMsg = document.getElementById('streaming-message');
                    if (activeMsg) {
                        activeMsg.textContent += msg.chunk;
                        activeMsg.scrollIntoView({ behavior: 'smooth', block: 'end' });
                    }
                    break;
                    
                case 'chatStreamEnd':
                    // Finalize the message with cleaned content
                    const finalMsg = document.getElementById('streaming-message');
                    if (finalMsg) {
                        finalMsg.id = '';
                        finalMsg.classList.remove('streaming');
                        finalMsg.textContent = msg.content;
                    }
                    isWaiting = false;
                    sendBtn.disabled = false;
                    chatHistory.push({ role: 'assistant', content: msg.content });
                    chatInput.focus();
                    resetIdleTimer(); // Start idle timer for check-in
                    break;

                case 'chatResponse':
                    // Fallback for non-streaming
                    hideTyping();
                    isWaiting = false;
                    sendBtn.disabled = false;
                    addMessage(msg.content, 'duck');
                    chatHistory.push({ role: 'assistant', content: msg.content });
                    chatInput.focus();
                    break;
                    
                case 'modelsReceived':
                    // Sort to prefer GPT-4o or 4.1
                    const preferredModels = msg.models.sort((a, b) => {
                        const aName = (a.name || '').toLowerCase();
                        const bName = (b.name || '').toLowerCase();
                        const aScore = aName.includes('4o') || aName.includes('4.1') ? 2 : aName.includes('gpt-4') ? 1 : 0;
                        const bScore = bName.includes('4o') || bName.includes('4.1') ? 2 : bName.includes('gpt-4') ? 1 : 0;
                        return bScore - aScore;
                    });
                    preferredModels.forEach((m, i) => {
                        const opt = document.createElement('option');
                        opt.value = m.id;
                        opt.textContent = m.vendor + ' - ' + m.name;
                        modelSelect.appendChild(opt);
                        // Default to first GPT-4o/4.1 if found
                        if (i === 0 && ((m.name || '').toLowerCase().includes('4o') || (m.name || '').toLowerCase().includes('4.1'))) {
                            opt.selected = true;
                        }
                    });
                    break;
            }
        });

        // Focus input on load
        chatInput.focus();
    </script>
</body>
</html>`}static getFocusMindfulnessHtml(e,r){let n=Xl();return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>\u{1F9D8} ${r.name}</title>
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            background: linear-gradient(135deg, 
                color-mix(in srgb, #6366f1 8%, var(--vscode-editor-background)) 0%,
                color-mix(in srgb, #8b5cf6 5%, var(--vscode-editor-background)) 50%,
                color-mix(in srgb, #06b6d4 8%, var(--vscode-editor-background)) 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: background 2s ease;
        }
        
        /* Back button */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            color: var(--vscode-foreground);
            font-size: 14px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .back-btn:hover { opacity: 1; }
        
        /* Mode Selection Screen */
        .screen { display: none; flex-direction: column; align-items: center; gap: 24px; }
        .screen.active { display: flex; }
        
        .title { font-size: 28px; font-weight: 700; opacity: 0.9; }
        .subtitle { font-size: 14px; opacity: 0.6; margin-top: -16px; }
        
        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            max-width: 500px;
            padding: 20px;
        }
        .mode-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px 16px;
            border-radius: 16px;
            border: 1px solid var(--vscode-widget-border);
            background: color-mix(in srgb, var(--vscode-editorWidget-background) 80%, transparent);
            color: var(--vscode-foreground);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .mode-btn:hover {
            border-color: var(--vscode-focusBorder);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }
        .mode-icon { font-size: 32px; }
        .mode-label { font-size: 13px; font-weight: 600; }
        .mode-desc { font-size: 11px; opacity: 0.6; text-align: center; }
        
        /* Duration buttons */
        .duration-row { display: flex; gap: 12px; margin-top: 8px; }
        .duration-btn {
            padding: 10px 24px;
            border-radius: 100px;
            border: 1px solid var(--vscode-widget-border);
            background: transparent;
            color: var(--vscode-foreground);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .duration-btn:hover, .duration-btn.active {
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border-color: var(--vscode-button-background);
        }
        
        /* Visual Container */
        .visual-container {
            width: 280px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .visual { position: absolute; display: flex; align-items: center; justify-content: center; }
        .hidden { display: none !important; }
        
        /* BREATHING: Expanding/contracting circle */
        .breathing-visual { width: 100%; height: 100%; }
        .breath-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #818cf8, #c084fc);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 4s ease-in-out;
            box-shadow: 0 0 60px color-mix(in srgb, #818cf8 40%, transparent);
        }
        .breath-circle.inhale { transform: scale(2.2); }
        .breath-circle.exhale { transform: scale(1); }
        .breath-text {
            font-size: 14px;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 4px rgba(0,0,0,0.3);
        }
        
        /* FOCUS: SVG ring with number */
        .focus-visual { width: 200px; height: 200px; }
        .focus-ring { width: 100%; height: 100%; transform: rotate(-90deg); }
        .ring-bg { stroke: color-mix(in srgb, #f59e0b 20%, transparent); }
        .ring-progress {
            stroke: #f59e0b;
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.5s ease;
        }
        .focus-number {
            position: absolute;
            font-size: 64px;
            font-weight: 700;
            color: #f59e0b;
            text-shadow: 0 0 30px color-mix(in srgb, #f59e0b 50%, transparent);
        }
        
        /* ENERGY: Starburst with rays */
        .energy-visual { width: 250px; height: 250px; }
        .starburst {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: spin 8s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .star-ray {
            position: absolute;
            width: 4px;
            height: 80px;
            background: linear-gradient(to top, transparent, #22c55e);
            left: 50%;
            top: 50%;
            transform-origin: center bottom;
            border-radius: 2px;
        }
        .star-ray:nth-child(1) { transform: translateX(-50%) rotate(0deg) translateY(-100%); }
        .star-ray:nth-child(2) { transform: translateX(-50%) rotate(45deg) translateY(-100%); }
        .star-ray:nth-child(3) { transform: translateX(-50%) rotate(90deg) translateY(-100%); }
        .star-ray:nth-child(4) { transform: translateX(-50%) rotate(135deg) translateY(-100%); }
        .star-ray:nth-child(5) { transform: translateX(-50%) rotate(180deg) translateY(-100%); }
        .star-ray:nth-child(6) { transform: translateX(-50%) rotate(225deg) translateY(-100%); }
        .star-ray:nth-child(7) { transform: translateX(-50%) rotate(270deg) translateY(-100%); }
        .star-ray:nth-child(8) { transform: translateX(-50%) rotate(315deg) translateY(-100%); }
        .energy-text {
            position: absolute;
            font-size: 48px;
            z-index: 10;
            animation: pulse 1s ease-in-out infinite;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        
        /* CALM: Ripple waves */
        .calm-visual { width: 250px; height: 250px; }
        .ripple {
            position: absolute;
            border: 2px solid #6366f1;
            border-radius: 50%;
            animation: ripple-expand 4s ease-out infinite;
            opacity: 0;
        }
        .ripple-1 { width: 60px; height: 60px; animation-delay: 0s; }
        .ripple-2 { width: 60px; height: 60px; animation-delay: 1.3s; }
        .ripple-3 { width: 60px; height: 60px; animation-delay: 2.6s; }
        @keyframes ripple-expand {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(4); opacity: 0; }
        }
        .calm-text {
            position: absolute;
            font-size: 16px;
            font-weight: 600;
            color: #a78bfa;
            z-index: 10;
        }
        
        /* Instruction text below visual */
        .instruction-text {
            font-size: 18px;
            font-weight: 500;
            margin-top: 16px;
            min-height: 28px;
            opacity: 0.9;
        }
        
        /* Timer */
        .timer {
            font-size: 48px;
            font-weight: 200;
            margin-top: 32px;
            opacity: 0.9;
            font-variant-numeric: tabular-nums;
        }
        
        /* Quote */
        .quote {
            max-width: 400px;
            text-align: center;
            font-size: 16px;
            font-style: italic;
            opacity: 0.8;
            line-height: 1.6;
            margin-top: 24px;
            min-height: 80px;
            transition: opacity 0.5s ease;
        }
        
        /* Control buttons */
        .controls { display: flex; gap: 12px; margin-top: 32px; }
        .ctrl-btn {
            padding: 12px 32px;
            border-radius: 100px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .ctrl-btn.primary {
            background: linear-gradient(135deg, #818cf8, #c084fc);
            color: white;
        }
        .ctrl-btn.secondary {
            background: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-widget-border);
            color: var(--vscode-foreground);
        }
        .ctrl-btn:hover { transform: scale(1.05); }
        
        /* Completion screen */
        .completion-icon { font-size: 64px; margin-bottom: 16px; }
        .completion-text { font-size: 20px; font-weight: 600; }
        .completion-sub { font-size: 14px; opacity: 0.7; margin-top: 8px; }
        
        /* Ambient particles (optional visual effect) */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: color-mix(in srgb, #818cf8 30%, transparent);
            pointer-events: none;
            animation: float 10s infinite ease-in-out;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0.3; }
            50% { transform: translateY(-100px) translateX(50px); opacity: 0.7; }
        }
    </style>
</head>
<body>
    <button class="back-btn" id="back-btn">\u2190 Back</button>
    
    <!-- Mode Selection -->
    <div class="screen active" id="mode-screen">
        <div class="title">\u{1F9D8} Focus & Mindfulness</div>
        <div class="subtitle">Choose what you need right now</div>
        
        <div class="mode-grid">
            <button class="mode-btn" data-mode="breathing">
                <span class="mode-icon">\u{1F32C}\uFE0F</span>
                <span class="mode-label">Breathing</span>
                <span class="mode-desc">Calm your mind</span>
            </button>
            <button class="mode-btn" data-mode="focus">
                <span class="mode-icon">\u{1F3AF}</span>
                <span class="mode-label">Focus</span>
                <span class="mode-desc">Sharpen clarity</span>
            </button>
            <button class="mode-btn" data-mode="energy">
                <span class="mode-icon">\u26A1</span>
                <span class="mode-label">Energy</span>
                <span class="mode-desc">Wake up</span>
            </button>
            <button class="mode-btn" data-mode="calm">
                <span class="mode-icon">\u{1F60C}</span>
                <span class="mode-label">Calm</span>
                <span class="mode-desc">Release stress</span>
            </button>
        </div>
        
        <div class="subtitle" style="margin-top: 16px;">Duration</div>
        <div class="duration-row">
            <button class="duration-btn" data-duration="60">1 min</button>
            <button class="duration-btn active" data-duration="180">3 min</button>
            <button class="duration-btn" data-duration="300">5 min</button>
        </div>
    </div>
    
    <!-- Active Session -->
    <div class="screen session-screen" id="session-screen">
        <div class="visual-container" id="visual-container">
            <!-- Breathing Mode: Expanding circle -->
            <div class="visual breathing-visual" id="breathing-visual">
                <div class="breath-circle" id="breath-circle">
                    <span class="breath-text" id="breath-text">Breathe</span>
                </div>
            </div>
            
            <!-- Focus Mode: Number with rotating ring -->
            <div class="visual focus-visual hidden" id="focus-visual">
                <svg class="focus-ring" viewBox="0 0 100 100">
                    <circle class="ring-bg" cx="50" cy="50" r="45" fill="none" stroke-width="3"/>
                    <circle class="ring-progress" id="ring-progress" cx="50" cy="50" r="45" fill="none" stroke-width="4"/>
                </svg>
                <span class="focus-number" id="focus-number">1</span>
            </div>
            
            <!-- Energy Mode: Starburst with prompts -->
            <div class="visual energy-visual hidden" id="energy-visual">
                <div class="starburst" id="starburst">
                    <div class="star-ray"></div><div class="star-ray"></div><div class="star-ray"></div>
                    <div class="star-ray"></div><div class="star-ray"></div><div class="star-ray"></div>
                    <div class="star-ray"></div><div class="star-ray"></div>
                </div>
                <span class="energy-text" id="energy-text">\u{1F4AA}</span>
            </div>
            
            <!-- Calm Mode: Ripples -->
            <div class="visual calm-visual hidden" id="calm-visual">
                <div class="ripple ripple-1"></div>
                <div class="ripple ripple-2"></div>
                <div class="ripple ripple-3"></div>
                <span class="calm-text" id="calm-text">Relax</span>
            </div>
        </div>
        
        <div class="instruction-text" id="instruction-text"></div>
        <div class="timer" id="timer">3:00</div>
        <div class="quote" id="quote">Loading inspiration...</div>
        <div class="controls">
            <button class="ctrl-btn secondary" id="stop-btn">End Session</button>
        </div>
    </div>
    
    <!-- Completion -->
    <div class="screen" id="complete-screen">
        <div class="completion-icon">\u2728</div>
        <div class="completion-text">Well done!</div>
        <div class="completion-sub" id="complete-msg">You took a moment for yourself.</div>
        <div class="quote" id="final-quote" style="margin-top: 24px;"></div>
        <div class="controls">
            <button class="ctrl-btn primary" id="restart-btn">Another Session</button>
            <button class="ctrl-btn secondary" id="close-btn">Close</button>
        </div>
    </div>

    <script nonce="${n}">
        const vscode = acquireVsCodeApi();
        
        let selectedMode = 'breathing';
        let selectedDuration = 180;
        let timerInterval = null;
        let breathInterval = null;
        let quoteInterval = null;
        let timeLeft = 0;
        
        const quotes = [
            "This moment is all you have.",
            "Breathe. Let go. And remind yourself that this very moment is the only one you know you have for sure.",
            "In the midst of movement and chaos, keep stillness inside of you.",
            "The present moment is filled with joy and happiness. If you are attentive, you will see it.",
            "Almost everything will work again if you unplug it for a few minutes, including you.",
            "Within you, there is a stillness and a sanctuary to which you can retreat at any time.",
            "You are the sky. Everything else is just the weather.",
            "Peace comes from within. Do not seek it without.",
            "The greatest weapon against stress is our ability to choose one thought over another.",
            "Feelings come and go like clouds in a windy sky. Conscious breathing is my anchor."
        ];
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }
        
        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return m + ':' + s.toString().padStart(2, '0');
        }
        
        function getRandomQuote() {
            return quotes[Math.floor(Math.random() * quotes.length)];
        }
        
        function startSession() {
            showScreen('session-screen');
            timeLeft = selectedDuration;
            document.getElementById('timer').textContent = formatTime(timeLeft);
            document.getElementById('quote').textContent = getRandomQuote();
            
            // Start timer
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = formatTime(timeLeft);
                if (timeLeft <= 0) {
                    endSession(true);
                }
            }, 1000);
            
            // Start mode-specific animation
            startExercise();
            
            // Change quote every 15 seconds
            quoteInterval = setInterval(() => {
                const quoteEl = document.getElementById('quote');
                quoteEl.style.opacity = '0';
                setTimeout(() => {
                    quoteEl.textContent = getRandomQuote();
                    quoteEl.style.opacity = '0.8';
                }, 500);
            }, 15000);
            
            // Request LLM quote
            vscode.postMessage({ type: 'getInspiration', mode: selectedMode });
        }
        
        function startExercise() {
            // Hide all visuals first
            document.querySelectorAll('.visual').forEach(v => v.classList.add('hidden'));
            const instructionEl = document.getElementById('instruction-text');
            
            if (selectedMode === 'breathing') {
                // Show breathing visual
                document.getElementById('breathing-visual').classList.remove('hidden');
                const circle = document.getElementById('breath-circle');
                const text = document.getElementById('breath-text');
                let isInhale = true;
                
                function breathCycle() {
                    if (isInhale) {
                        circle.classList.remove('exhale');
                        circle.classList.add('inhale');
                        text.textContent = 'Inhale';
                        instructionEl.textContent = 'Breathe in slowly...';
                    } else {
                        circle.classList.remove('inhale');
                        circle.classList.add('exhale');
                        text.textContent = 'Exhale';
                        instructionEl.textContent = 'Let it all go...';
                    }
                    isInhale = !isInhale;
                }
                breathCycle();
                breathInterval = setInterval(breathCycle, 4000);
                
            } else if (selectedMode === 'focus') {
                // Show focus visual with ring
                document.getElementById('focus-visual').classList.remove('hidden');
                const ring = document.getElementById('ring-progress');
                const numEl = document.getElementById('focus-number');
                let count = 1;
                numEl.textContent = '1';
                instructionEl.textContent = 'Focus on each number...';
                
                // Ring circumference = 2 * PI * 45 = ~283
                const circumference = 283;
                ring.style.strokeDashoffset = circumference * (1 - count/10);
                
                breathInterval = setInterval(() => {
                    count = count >= 10 ? 1 : count + 1;
                    numEl.textContent = count.toString();
                    ring.style.strokeDashoffset = circumference * (1 - count/10);
                    if (count === 1) instructionEl.textContent = 'Starting fresh...';
                    else if (count === 5) instructionEl.textContent = 'Halfway there...';
                    else if (count === 10) instructionEl.textContent = 'Complete the cycle...';
                }, 2000);
                
            } else if (selectedMode === 'energy') {
                // Show energy starburst
                document.getElementById('energy-visual').classList.remove('hidden');
                const emojiEl = document.getElementById('energy-text');
                const actions = [
                    { emoji: '\u{1F4AA}', text: 'Stretch your arms!' },
                    { emoji: '\u{1F504}', text: 'Roll your shoulders' },
                    { emoji: '\u{1F32C}\uFE0F', text: 'Deep breath in' },
                    { emoji: '\u{1F9CD}', text: 'Stand tall' },
                    { emoji: '\u{1F450}', text: 'Shake out your hands' },
                    { emoji: '\u{1F60A}', text: 'Smile!' },
                    { emoji: '\u{1F9B6}', text: 'Wiggle your toes' },
                    { emoji: '\u26A1', text: 'Feel the energy!' }
                ];
                let idx = 0;
                emojiEl.textContent = actions[0].emoji;
                instructionEl.textContent = actions[0].text;
                
                breathInterval = setInterval(() => {
                    idx = (idx + 1) % actions.length;
                    emojiEl.textContent = actions[idx].emoji;
                    instructionEl.textContent = actions[idx].text;
                }, 3000);
                
            } else if (selectedMode === 'calm') {
                // Show calm ripples
                document.getElementById('calm-visual').classList.remove('hidden');
                const calmText = document.getElementById('calm-text');
                const bodyParts = [
                    'Relax your forehead',
                    'Soften your eyes',
                    'Unclench your jaw',
                    'Drop your shoulders',
                    'Open your hands',
                    'Release your belly',
                    'Feel your feet',
                    'You are safe here'
                ];
                let idx = 0;
                calmText.textContent = '\u{1F30A}';
                instructionEl.textContent = bodyParts[0];
                
                breathInterval = setInterval(() => {
                    idx = (idx + 1) % bodyParts.length;
                    instructionEl.textContent = bodyParts[idx];
                }, 5000);
            }
        }
        
        function endSession(completed) {
            clearInterval(timerInterval);
            clearInterval(breathInterval);
            clearInterval(quoteInterval);
            
            if (completed) {
                document.getElementById('complete-msg').textContent = 
                    'You completed a ' + Math.round(selectedDuration/60) + ' minute ' + selectedMode + ' session.';
                document.getElementById('final-quote').textContent = getRandomQuote();
                showScreen('complete-screen');
            } else {
                showScreen('mode-screen');
            }
        }
        
        // Event listeners
        document.getElementById('back-btn').addEventListener('click', () => {
            vscode.postMessage({ type: 'goBack' });
        });
        
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedMode = btn.dataset.mode;
                startSession();
            });
        });
        
        document.querySelectorAll('.duration-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.duration-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedDuration = parseInt(btn.dataset.duration);
            });
        });
        
        document.getElementById('stop-btn').addEventListener('click', () => endSession(false));
        document.getElementById('restart-btn').addEventListener('click', () => showScreen('mode-screen'));
        document.getElementById('close-btn').addEventListener('click', () => vscode.postMessage({ type: 'goBack' }));
        
        // Handle LLM-generated quotes
        window.addEventListener('message', event => {
            const msg = event.data;
            if (msg.type === 'inspirationResult') {
                document.getElementById('quote').textContent = msg.content;
            }
        });
    </script>
</body>
</html>`}static getModernAppHtml(e,r,n){let o=Xl(),i={bg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",accent:"#16a34a",iconBg:"#dcfce7"};return r.id==="decision-doctor"?i={bg:"linear-gradient(135deg, color-mix(in srgb, #3b82f6 10%, var(--vscode-editor-background)), var(--vscode-editor-background))",accent:"#2563eb",iconBg:"color-mix(in srgb, #3b82f6 20%, transparent)"}:r.id==="skill-sprinter"?i={bg:"linear-gradient(135deg, color-mix(in srgb, #f59e0b 10%, var(--vscode-editor-background)), var(--vscode-editor-background))",accent:"#d97706",iconBg:"color-mix(in srgb, #f59e0b 20%, transparent)"}:r.id==="icebreaker-chef"?i={bg:"linear-gradient(135deg, color-mix(in srgb, #ec4899 10%, var(--vscode-editor-background)), var(--vscode-editor-background))",accent:"#db2777",iconBg:"color-mix(in srgb, #ec4899 20%, transparent)"}:i={bg:"linear-gradient(135deg, color-mix(in srgb, #8b5cf6 10%, var(--vscode-editor-background)), var(--vscode-editor-background))",accent:"#7c3aed",iconBg:"color-mix(in srgb, #8b5cf6 20%, transparent)"},`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${o}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${r.name}</title>
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            background: ${i.bg};
            height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr;
            overflow: hidden;
        }
        
        /* Modern Header */
        .glass-header {
            padding: 24px 32px;
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid color-mix(in srgb, var(--vscode-widget-border) 30%, transparent);
        }
        .header-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: ${i.iconBg};
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .header-content h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .header-content p {
            font-size: 14px;
            opacity: 0.7;
        }
        .back-btn {
            margin-left: auto;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
            cursor: pointer;
            font-weight: 500;
        }

        /* Split Layout */
        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 24px;
            padding: 24px 32px;
            overflow: hidden;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Input Panel */
        .input-panel {
            background: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-widget-border);
            border-radius: 16px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            box-shadow: 0 4px 24px rgba(0,0,0,0.04);
        }
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            color: ${i.accent};
        }
        input, select, textarea {
            width: 100%;
            padding: 12px 14px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            font-family: var(--vscode-font-family);
            transition: all 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: ${i.accent};
            box-shadow: 0 0 0 3px color-mix(in srgb, ${i.accent} 20%, transparent);
        }
        .action-btn {
            margin-top: auto;
            padding: 14px;
            background: ${i.accent};
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px color-mix(in srgb, ${i.accent} 40%, transparent);
        }
        .action-btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.1);
        }
        .action-btn:active { transform: translateY(1px); }
        
        /* Output Panel */
        .output-panel {
            background: color-mix(in srgb, var(--vscode-editor-background) 80%, var(--vscode-editorWidget-background));
            border-radius: 16px;
            border: 1px solid var(--vscode-widget-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        .output-toolbar {
            padding: 12px 20px;
            border-bottom: 1px solid var(--vscode-widget-border);
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            background: rgba(0,0,0,0.02);
        }
        .tool-btn {
            background: transparent;
            border: 1px solid transparent;
            padding: 6px;
            border-radius: 6px;
            cursor: pointer;
            opacity: 0.6;
            color: var(--vscode-foreground);
        }
        .tool-btn:hover {
            background: var(--vscode-toolbar-hoverBackground);
            opacity: 1;
        }
        .output-content {
            padding: 32px;
            overflow-y: auto;
            flex: 1;
            font-size: 15px;
            line-height: 1.7;
        }
        .output-content h1, .output-content h2, .output-content h3 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            color: ${i.accent};
        }
        .output-content ul, .output-content ol { padding-left: 24px; }
        .output-content li { margin-bottom: 8px; }
        .output-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 14px;
        }
        .output-content th, .output-content td {
            border: 1px solid var(--vscode-widget-border);
            padding: 10px 14px;
            text-align: left;
        }
        .output-content th {
            background: color-mix(in srgb, ${i.accent} 15%, var(--vscode-editor-background));
            font-weight: 600;
            color: ${i.accent};
        }
        .output-content tr:nth-child(even) {
            background: color-mix(in srgb, var(--vscode-editor-background) 95%, var(--vscode-widget-border));
        }
        
        .placeholder-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            opacity: 0.4;
            gap: 16px;
        }
        .placeholder-icon { font-size: 48px; filter: grayscale(1); }
        
        /* Loading */
        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.05);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid color-mix(in srgb, ${i.accent} 20%, transparent);
            border-top-color: ${i.accent};
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .visible { display: flex !important; }
    </style>
</head>
<body>
    <div class="glass-header">
        <div class="header-icon">${r.icon}</div>
        <div class="header-content">
            <h1>${r.name}</h1>
            <p>${r.description}</p>
        </div>
        <button class="back-btn" id="go-back">Back to Hub</button>
    </div>

    <div class="main-container">
        <!-- Inputs -->
        <div class="input-panel">
            ${r.inputs.map(s=>`
                <div class="input-group">
                    ${t.renderInputField(s,n)}
                </div>
            `).join("")}
            
            <button class="action-btn" id="run-app">
                <span>\u{1F680}</span> ${r.primaryAction}
            </button>
        </div>

        <!-- Output -->
        <div class="output-panel">
            <div class="loading-overlay" id="loader">
                <div class="spinner"></div>
            </div>
            
            <div class="output-toolbar">
                <button class="tool-btn" id="copy-btn" title="Copy to Clipboard">\u{1F4CB}</button>
                <button class="tool-btn" id="insert-btn" title="Insert at Cursor">\u{1F4DD}</button>
                <button class="tool-btn" id="save-btn" title="Save as File">\u{1F4BE}</button>
            </div>
            
            <div class="output-content" id="output-content">
                <div class="placeholder-state">
                    <span class="placeholder-icon">${r.icon}</span>
                    <p>Ready to ${r.primaryAction.toLowerCase()}...</p>
                </div>
            </div>
        </div>
    </div>

    <script nonce="${o}">
        const vscode = acquireVsCodeApi();
        const runBtn = document.getElementById('run-app');
        const loader = document.getElementById('loader');
        const outputDiv = document.getElementById('output-content');
        
        // Global Error Handler
        window.onerror = function(message, source, lineno, colno, error) {
            const errDiv = document.createElement('div');
            errDiv.style.color = 'red';
            errDiv.style.padding = '10px';
            errDiv.style.background = '#fee2e2';
            errDiv.style.border = '1px solid #ef4444';
            errDiv.style.margin = '10px';
            errDiv.innerText = \`JS Error: \${message}\`;
            document.body.prepend(errDiv);
        };

        // Robust Input handling
        function getInputs() {
            const inputs = {};
            document.querySelectorAll('input, select, textarea').forEach(el => {
                const key = el.id || el.getAttribute('name') || el.dataset.name;
                if (key) {
                    if (el.type === 'checkbox') {
                         if (el.checked) inputs[key] = el.value;
                    } else if (el.type === 'radio') {
                         if (el.checked) inputs[key] = el.value;
                    } else {
                         inputs[key] = el.value;
                    }
                }
            });
            return inputs;
        }

        // Run App
        runBtn.addEventListener('click', () => {
            try {
                const inputs = getInputs();
                // Validate required
                let isValid = true;
                document.querySelectorAll('[required]').forEach(el => {
                    if (!el.value) {
                        el.style.borderColor = 'red';
                        isValid = false;
                    } else {
                        el.style.borderColor = '';
                    }
                });
                
                if (!isValid) return;
    
                loader.classList.add('visible');
                outputDiv.innerHTML = ''; // Clear previous
                
                vscode.postMessage({
                    type: 'executeApp',
                    inputs: inputs
                });
            } catch (e) {
                alert('Error starting app: ' + e);
            }
        });

        // Messages
        window.addEventListener('message', event => {
            const msg = event.data;
            if (msg.type === 'result') {
                loader.classList.remove('visible');
                if (msg.result.success) {
                    let md = msg.result.output.content;
                    
                    // Parse markdown tables first (before line breaks)
                    const lines = md.split('\\n');
                    let inTable = false;
                    let tableRows = [];
                    let result = [];
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (line.startsWith('|') && line.endsWith('|')) {
                            // Check if next line is separator
                            if (!inTable && i + 1 < lines.length && /^\\|[-:|\\s]+\\|$/.test(lines[i + 1].trim())) {
                                inTable = true;
                                tableRows = [line];
                            } else if (inTable) {
                                if (/^\\|[-:|\\s]+\\|$/.test(line)) {
                                    // Skip separator line
                                } else {
                                    tableRows.push(line);
                                }
                            }
                        } else {
                            if (inTable && tableRows.length > 0) {
                                // Convert tableRows to HTML
                                let html = '<table><thead><tr>';
                                const headerCells = tableRows[0].split('|').filter(c => c.trim());
                                headerCells.forEach(c => html += '<th>' + c.trim() + '</th>');
                                html += '</tr></thead><tbody>';
                                for (let j = 1; j < tableRows.length; j++) {
                                    html += '<tr>';
                                    const cells = tableRows[j].split('|').filter(c => c.trim());
                                    cells.forEach(c => html += '<td>' + c.trim() + '</td>');
                                    html += '</tr>';
                                }
                                html += '</tbody></table>';
                                result.push(html);
                                tableRows = [];
                            }
                            inTable = false;
                            result.push(line);
                        }
                    }
                    // Handle trailing table
                    if (inTable && tableRows.length > 0) {
                        let html = '<table><thead><tr>';
                        const headerCells = tableRows[0].split('|').filter(c => c.trim());
                        headerCells.forEach(c => html += '<th>' + c.trim() + '</th>');
                        html += '</tr></thead><tbody>';
                        for (let j = 1; j < tableRows.length; j++) {
                            html += '<tr>';
                            const cells = tableRows[j].split('|').filter(c => c.trim());
                            cells.forEach(c => html += '<td>' + c.trim() + '</td>');
                            html += '</tr>';
                        }
                        html += '</tbody></table>';
                        result.push(html);
                    }
                    
                    md = result.join('\\n');
                    
                    // Standard markdown rendering  
                    md = md
                        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                        .replace(/\\*\\*(.*?)\\*\\*/gim, '<strong>$1</strong>')
                        .replace(/^- (.*$)/gim, '<ul><li>$1</li></ul>')
                        .replace(/\\n/gim, '<br>');
                    
                    outputDiv.innerHTML = md;
                    
                    // Cleanup lists
                    outputDiv.innerHTML = outputDiv.innerHTML.split('</ul><br><ul>').join('');
                    outputDiv.innerHTML = outputDiv.innerHTML.split('<br><ul>').join('<ul>');
                } else {
                    outputDiv.innerHTML = '<div style="color:red; padding:20px">Error: ' + msg.result.error + '</div>';
                }
            } else if (msg.type === 'progress') {
                // Could show progress text
            }
        });

        // Toolbar actions
        document.getElementById('copy-btn').addEventListener('click', () => {
             vscode.postMessage({ type: 'copyToClipboard', value: outputDiv.innerText });
        });
        document.getElementById('insert-btn').addEventListener('click', () => {
             vscode.postMessage({ type: 'insertAtCursor', value: outputDiv.innerText });
        });
        document.getElementById('save-btn').addEventListener('click', () => {
             vscode.postMessage({ type: 'saveAsFile', content: outputDiv.innerText, filename: '${r.id}-result.md' });
        });
        
        document.getElementById('go-back').addEventListener('click', () => {
            vscode.postMessage({ type: 'goBack' });
        });
    </script>
    </body>
    </html>`}static getInteractiveGameHtml(e,r){let n=Xl(),o={"trivia-showdown":{accent:"#f59e0b",gradient:"linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%)",emoji:"\u{1F9E0}"},"story-chain":{accent:"#ec4899",gradient:"linear-gradient(135deg, #1e1b4b 0%, #581c87 50%, #1e1b4b 100%)",emoji:"\u{1F3AD}"},"caption-battle":{accent:"#06b6d4",gradient:"linear-gradient(135deg, #0f172a 0%, #164e63 50%, #0f172a 100%)",emoji:"\u{1F3A8}"},"debate-arena":{accent:"#ef4444",gradient:"linear-gradient(135deg, #1c1917 0%, #7f1d1d 50%, #1c1917 100%)",emoji:"\u2694\uFE0F"}},i=o[r.id]||o["trivia-showdown"];return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${r.icon} ${r.name}</title>
    <style>
        :root { color-scheme: dark; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: var(--vscode-font-family);
            background: ${i.gradient};
            color: #f8fafc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .game-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .game-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
        }
        .game-icon {
            font-size: 32px;
        }
        .back-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #f8fafc;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.2); }
        
        /* Score Bar */
        .score-bar {
            display: none;
            padding: 12px 24px;
            background: rgba(0,0,0,0.2);
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        .score-bar.visible { display: flex; }
        .score-display {
            display: flex;
            gap: 24px;
        }
        .score-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .score-value {
            font-weight: 700;
            font-size: 18px;
            color: ${i.accent};
        }
        .round-indicator {
            background: ${i.accent};
            color: #000;
            padding: 4px 12px;
            border-radius: 16px;
            font-weight: 600;
        }
        
        /* Main Content */
        .game-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 32px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Setup Screen */
        .setup-screen {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .setup-title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 16px;
        }
        .setup-section {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .section-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
            margin-bottom: 12px;
        }
        
        /* Option Cards */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }
        .option-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option-card:hover {
            border-color: ${i.accent};
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }
        .option-card.selected {
            border-color: ${i.accent};
            background: color-mix(in srgb, ${i.accent} 20%, transparent);
        }
        .option-icon { font-size: 24px; margin-bottom: 8px; }
        .option-label { font-weight: 600; font-size: 14px; }
        .option-desc { font-size: 11px; opacity: 0.6; margin-top: 4px; }
        
        /* Text Input */
        .text-input {
            width: 100%;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 12px 16px;
            color: #f8fafc;
            font-size: 14px;
            outline: none;
        }
        .text-input:focus { border-color: ${i.accent}; }
        .text-input::placeholder { opacity: 0.4; }
        
        /* Start Button */
        .start-btn {
            background: ${i.accent};
            color: #000;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 16px;
        }
        .start-btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        .start-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        /* Play Screen - hidden by default */
        .play-screen { display: none; flex-direction: column; gap: 24px; }
        .play-screen.visible { display: flex; }
        .setup-screen.hidden { display: none; }
        
        /* Question Card */
        .question-card {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 32px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .question-text {
            font-size: 22px;
            font-weight: 600;
            line-height: 1.5;
            margin-bottom: 24px;
        }
        
        /* Answer Buttons */
        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .answer-btn {
            background: rgba(255,255,255,0.08);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 16px 20px;
            color: #f8fafc;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .answer-btn:hover:not(:disabled) {
            border-color: ${i.accent};
            background: rgba(255,255,255,0.12);
        }
        .answer-btn:disabled { cursor: default; opacity: 0.7; }
        .answer-btn.correct {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.2);
        }
        .answer-btn.wrong {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
        }
        .answer-letter {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        .answer-text { flex: 1; }
        
        /* Feedback */
        .feedback-area {
            display: none;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }
        .feedback-area.visible { display: block; }
        .feedback-result {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .feedback-result.correct { color: #22c55e; }
        .feedback-result.wrong { color: #ef4444; }
        .fun-fact {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.5;
        }
        
        /* Next Button */
        .next-btn {
            display: none;
            background: ${i.accent};
            color: #000;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            align-self: center;
        }
        .next-btn.visible { display: inline-block; }
        
        /* Results Screen */
        .results-screen { display: none; flex-direction: column; align-items: center; gap: 24px; text-align: center; }
        .results-screen.visible { display: flex; }
        .results-emoji { font-size: 72px; }
        .results-title { font-size: 32px; font-weight: 700; }
        .results-score { font-size: 48px; font-weight: 700; color: ${i.accent}; }
        .results-subtitle { font-size: 16px; opacity: 0.7; }
        .play-again-btn {
            background: ${i.accent};
            color: #000;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 16px;
        }
        
        /* Story Chain specific */
        .story-content {
            background: rgba(0,0,0,0.2);
            border-radius: 16px;
            padding: 24px;
            font-size: 16px;
            line-height: 1.8;
            max-height: 300px;
            overflow-y: auto;
        }
        .story-choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        .story-choice-btn {
            background: rgba(255,255,255,0.08);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 16px 20px;
            color: #f8fafc;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        .story-choice-btn:hover {
            border-color: ${i.accent};
            background: rgba(255,255,255,0.12);
        }
        
        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 16px;
        }
        .loading-overlay.visible { display: flex; }
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top-color: ${i.accent};
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 16px; opacity: 0.8; }
    </style>
</head>
<body>
    <div class="game-header">
        <div class="game-title">
            <span class="game-icon">${r.icon}</span>
            <span>${r.name}</span>
        </div>
        <button class="back-btn" id="back-btn">\u2190 Back</button>
    </div>
    
    <div class="score-bar" id="score-bar">
        <div class="score-display">
            <div class="score-item">
                <span>Score:</span>
                <span class="score-value" id="score">0</span>
            </div>
            <div class="score-item">
                <span>Streak:</span>
                <span class="score-value" id="streak">0</span>
            </div>
        </div>
        <div class="round-indicator" id="round-indicator">Round 1/5</div>
    </div>
    
    <div class="game-content">
        <!-- Setup Screen -->
        <div class="setup-screen" id="setup-screen">
            <div class="setup-title">\u26A1 Ready to Play?</div>
            
            ${r.id==="trivia-showdown"?`
            <div class="setup-section">
                <div class="section-label">Choose Your Topic</div>
                <input type="text" class="text-input" id="topic-input" placeholder="e.g., 90s Movies, Space, Programming...">
            </div>
            
            <div class="setup-section">
                <div class="section-label">Difficulty</div>
                <div class="options-grid" id="difficulty-options">
                    <div class="option-card" data-value="easy">
                        <div class="option-icon">\u{1F7E2}</div>
                        <div class="option-label">Easy</div>
                        <div class="option-desc">Warm-up</div>
                    </div>
                    <div class="option-card selected" data-value="medium">
                        <div class="option-icon">\u{1F7E1}</div>
                        <div class="option-label">Medium</div>
                        <div class="option-desc">Balanced</div>
                    </div>
                    <div class="option-card" data-value="hard">
                        <div class="option-icon">\u{1F534}</div>
                        <div class="option-label">Hard</div>
                        <div class="option-desc">Expert</div>
                    </div>
                    <div class="option-card" data-value="impossible">
                        <div class="option-icon">\u{1F480}</div>
                        <div class="option-label">Impossible</div>
                        <div class="option-desc">Good luck!</div>
                    </div>
                </div>
            </div>
            
            <div class="setup-section">
                <div class="section-label">Number of Questions</div>
                <div class="options-grid" id="count-options">
                    <div class="option-card" data-value="3">
                        <div class="option-label">3</div>
                        <div class="option-desc">Quick</div>
                    </div>
                    <div class="option-card selected" data-value="5">
                        <div class="option-label">5</div>
                        <div class="option-desc">Standard</div>
                    </div>
                    <div class="option-card" data-value="10">
                        <div class="option-label">10</div>
                        <div class="option-desc">Marathon</div>
                    </div>
                </div>
            </div>
            `:r.id==="story-chain"?`
            <div class="setup-section">
                <div class="section-label">Story Genre</div>
                <div class="options-grid" id="genre-options">
                    <div class="option-card selected" data-value="fantasy">
                        <div class="option-icon">\u{1F9D9}</div>
                        <div class="option-label">Fantasy</div>
                    </div>
                    <div class="option-card" data-value="scifi">
                        <div class="option-icon">\u{1F680}</div>
                        <div class="option-label">Sci-Fi</div>
                    </div>
                    <div class="option-card" data-value="mystery">
                        <div class="option-icon">\u{1F50D}</div>
                        <div class="option-label">Mystery</div>
                    </div>
                    <div class="option-card" data-value="comedy">
                        <div class="option-icon">\u{1F602}</div>
                        <div class="option-label">Comedy</div>
                    </div>
                    <div class="option-card" data-value="horror">
                        <div class="option-icon">\u{1F47B}</div>
                        <div class="option-label">Horror</div>
                    </div>
                </div>
            </div>
            `:r.id==="caption-battle"?`
            <div class="setup-section">
                <div class="section-label">Caption Vibe</div>
                <div class="options-grid" id="vibe-options">
                    <div class="option-card selected" data-value="absurd">
                        <div class="option-icon">\u{1F92A}</div>
                        <div class="option-label">Absurd</div>
                    </div>
                    <div class="option-card" data-value="wholesome">
                        <div class="option-icon">\u{1F970}</div>
                        <div class="option-label">Wholesome</div>
                    </div>
                    <div class="option-card" data-value="corporate">
                        <div class="option-icon">\u{1F4BC}</div>
                        <div class="option-label">Corporate</div>
                    </div>
                    <div class="option-card" data-value="dark">
                        <div class="option-icon">\u{1F311}</div>
                        <div class="option-label">Dark</div>
                    </div>
                </div>
            </div>
            <div class="setup-section">
                <div class="section-label">Optional Theme</div>
                <input type="text" class="text-input" id="theme-input" placeholder="e.g., Cats, Space, Monday mornings...">
            </div>
            `:`
            <div class="setup-section">
                <div class="section-label">Debate Category</div>
                <div class="options-grid" id="category-options">
                    <div class="option-card selected" data-value="tech">
                        <div class="option-icon">\u{1F4BB}</div>
                        <div class="option-label">Tech Wars</div>
                    </div>
                    <div class="option-card" data-value="food">
                        <div class="option-icon">\u{1F355}</div>
                        <div class="option-label">Food Fights</div>
                    </div>
                    <div class="option-card" data-value="life">
                        <div class="option-icon">\u{1F30D}</div>
                        <div class="option-label">Life Choices</div>
                    </div>
                    <div class="option-card" data-value="work">
                        <div class="option-icon">\u{1F4BC}</div>
                        <div class="option-label">Work Style</div>
                    </div>
                </div>
            </div>
            `}
            
            <button class="start-btn" id="start-btn">\u{1F3AE} Start Game</button>
        </div>
        
        <!-- Play Screen (Trivia) -->
        <div class="play-screen" id="play-screen">
            <div class="question-card">
                <div class="question-text" id="question-text">Loading question...</div>
                <div class="answers-grid" id="answers-grid">
                    <button class="answer-btn" data-answer="A">
                        <span class="answer-letter">A</span>
                        <span class="answer-text" id="answer-a">-</span>
                    </button>
                    <button class="answer-btn" data-answer="B">
                        <span class="answer-letter">B</span>
                        <span class="answer-text" id="answer-b">-</span>
                    </button>
                    <button class="answer-btn" data-answer="C">
                        <span class="answer-letter">C</span>
                        <span class="answer-text" id="answer-c">-</span>
                    </button>
                    <button class="answer-btn" data-answer="D">
                        <span class="answer-letter">D</span>
                        <span class="answer-text" id="answer-d">-</span>
                    </button>
                </div>
            </div>
            
            <div class="feedback-area" id="feedback-area">
                <div class="feedback-result" id="feedback-result">Correct!</div>
                <div class="fun-fact" id="fun-fact">Fun fact will appear here...</div>
            </div>
            
            <button class="next-btn" id="next-btn">Next Question \u2192</button>
        </div>
        
        <!-- Results Screen -->
        <div class="results-screen" id="results-screen">
            <div class="results-emoji" id="results-emoji">\u{1F3C6}</div>
            <div class="results-title" id="results-title">Great Job!</div>
            <div class="results-score" id="results-score">5/5</div>
            <div class="results-subtitle" id="results-subtitle">You're a trivia champion!</div>
            <button class="play-again-btn" id="play-again-btn">\u{1F504} Play Again</button>
        </div>
    </div>
    
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loading-text">Generating questions...</div>
    </div>
    
    <script nonce="${n}">
        const vscode = acquireVsCodeApi();
        const gameId = '${r.id}';
        
        // State
        let gameState = {
            questions: [],
            currentQuestion: 0,
            score: 0,
            streak: 0,
            maxStreak: 0,
            totalQuestions: 5,
            settings: {}
        };
        
        // Elements
        const setupScreen = document.getElementById('setup-screen');
        const playScreen = document.getElementById('play-screen');
        const resultsScreen = document.getElementById('results-screen');
        const scoreBar = document.getElementById('score-bar');
        const loadingOverlay = document.getElementById('loading-overlay');
        
        // Option card selection
        document.querySelectorAll('.options-grid').forEach(grid => {
            grid.addEventListener('click', (e) => {
                const card = e.target.closest('.option-card');
                if (!card) return;
                grid.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
            });
        });
        
        // Back button
        document.getElementById('back-btn').addEventListener('click', () => {
            vscode.postMessage({ type: 'goBack' });
        });
        
        // Start button
        document.getElementById('start-btn').addEventListener('click', () => {
            startGame();
        });
        
        // Answer buttons
        document.querySelectorAll('.answer-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.disabled) return;
                handleAnswer(btn.dataset.answer);
            });
        });
        
        // Next button
        document.getElementById('next-btn').addEventListener('click', () => {
            nextQuestion();
        });
        
        // Play again
        document.getElementById('play-again-btn').addEventListener('click', () => {
            resetGame();
        });
        
        function startGame() {
            // Collect settings based on game type
            if (gameId === 'trivia-showdown') {
                const topic = document.getElementById('topic-input').value.trim() || 'General Knowledge';
                const difficulty = document.querySelector('#difficulty-options .selected')?.dataset.value || 'medium';
                const count = document.querySelector('#count-options .selected')?.dataset.value || '5';
                
                gameState.settings = { topic, difficulty, count };
                gameState.totalQuestions = parseInt(count);
                
                showLoading('Generating ' + count + ' questions about ' + topic + '...');
                
                vscode.postMessage({
                    type: 'gameAction',
                    action: 'startTrivia',
                    settings: gameState.settings
                });
            } else if (gameId === 'story-chain') {
                const genre = document.querySelector('#genre-options .selected')?.dataset.value || 'fantasy';
                gameState.settings = { genre };
                
                showLoading('Starting your ' + genre + ' adventure...');
                
                vscode.postMessage({
                    type: 'gameAction',
                    action: 'startStory',
                    settings: gameState.settings
                });
            } else if (gameId === 'caption-battle') {
                const vibe = document.querySelector('#vibe-options .selected')?.dataset.value || 'absurd';
                const theme = document.getElementById('theme-input')?.value.trim() || '';
                gameState.settings = { vibe, theme };
                
                showLoading('Creating hilarious scenarios...');
                
                vscode.postMessage({
                    type: 'gameAction',
                    action: 'startCaption',
                    settings: gameState.settings
                });
            } else if (gameId === 'debate-arena') {
                const category = document.querySelector('#category-options .selected')?.dataset.value || 'tech';
                gameState.settings = { category };
                
                showLoading('Finding a spicy debate topic...');
                
                vscode.postMessage({
                    type: 'gameAction',
                    action: 'startDebate',
                    settings: gameState.settings
                });
            }
        }
        
        function handleAnswer(answer) {
            const currentQ = gameState.questions[gameState.currentQuestion];
            const correct = answer === currentQ.correctAnswer;
            
            // Disable all buttons
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.answer === currentQ.correctAnswer) {
                    btn.classList.add('correct');
                } else if (btn.dataset.answer === answer && !correct) {
                    btn.classList.add('wrong');
                }
            });
            
            // Update score
            if (correct) {
                gameState.score++;
                gameState.streak++;
                if (gameState.streak > gameState.maxStreak) gameState.maxStreak = gameState.streak;
            } else {
                gameState.streak = 0;
            }
            
            updateScoreDisplay();
            
            // Show feedback
            const feedbackArea = document.getElementById('feedback-area');
            const feedbackResult = document.getElementById('feedback-result');
            const funFact = document.getElementById('fun-fact');
            
            feedbackResult.textContent = correct ? '\u2705 Correct!' : '\u274C Wrong!';
            feedbackResult.className = 'feedback-result ' + (correct ? 'correct' : 'wrong');
            funFact.textContent = currentQ.funFact || 'Great effort!';
            feedbackArea.classList.add('visible');
            
            // Show next button
            document.getElementById('next-btn').classList.add('visible');
        }
        
        function nextQuestion() {
            gameState.currentQuestion++;
            
            if (gameState.currentQuestion >= gameState.questions.length) {
                showResults();
                return;
            }
            
            displayQuestion();
        }
        
        function displayQuestion() {
            const q = gameState.questions[gameState.currentQuestion];
            
            // Reset UI
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('correct', 'wrong');
            });
            document.getElementById('feedback-area').classList.remove('visible');
            document.getElementById('next-btn').classList.remove('visible');
            
            // Update question
            document.getElementById('question-text').textContent = q.question;
            document.getElementById('answer-a').textContent = q.answers.A;
            document.getElementById('answer-b').textContent = q.answers.B;
            document.getElementById('answer-c').textContent = q.answers.C;
            document.getElementById('answer-d').textContent = q.answers.D;
            
            // Update round indicator
            document.getElementById('round-indicator').textContent = 
                'Question ' + (gameState.currentQuestion + 1) + '/' + gameState.totalQuestions;
        }
        
        function updateScoreDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('streak').textContent = gameState.streak;
        }
        
        function showResults() {
            playScreen.classList.remove('visible');
            scoreBar.classList.remove('visible');
            resultsScreen.classList.add('visible');
            
            const percentage = Math.round((gameState.score / gameState.totalQuestions) * 100);
            
            let emoji, title, subtitle;
            if (percentage === 100) {
                emoji = '\u{1F3C6}';
                title = 'Perfect Score!';
                subtitle = 'You are a trivia legend!';
            } else if (percentage >= 80) {
                emoji = '\u{1F31F}';
                title = 'Excellent!';
                subtitle = 'Almost perfect - impressive knowledge!';
            } else if (percentage >= 60) {
                emoji = '\u{1F44F}';
                title = 'Great Job!';
                subtitle = 'Solid performance!';
            } else if (percentage >= 40) {
                emoji = '\u{1F4AA}';
                title = 'Not Bad!';
                subtitle = 'Room for improvement - try again?';
            } else {
                emoji = '\u{1F4DA}';
                title = 'Keep Learning!';
                subtitle = 'Every expert was once a beginner!';
            }
            
            document.getElementById('results-emoji').textContent = emoji;
            document.getElementById('results-title').textContent = title;
            document.getElementById('results-score').textContent = gameState.score + '/' + gameState.totalQuestions;
            document.getElementById('results-subtitle').textContent = subtitle;
        }
        
        function resetGame() {
            gameState = {
                questions: [],
                currentQuestion: 0,
                score: 0,
                streak: 0,
                maxStreak: 0,
                totalQuestions: 5,
                settings: {}
            };
            
            resultsScreen.classList.remove('visible');
            playScreen.classList.remove('visible');
            scoreBar.classList.remove('visible');
            setupScreen.classList.remove('hidden');
        }
        
        function showLoading(text) {
            document.getElementById('loading-text').textContent = text;
            loadingOverlay.classList.add('visible');
        }
        
        function hideLoading() {
            loadingOverlay.classList.remove('visible');
        }
        
        // Handle messages from extension
        window.addEventListener('message', event => {
            const msg = event.data;
            
            if (msg.type === 'triviaQuestions') {
                hideLoading();
                gameState.questions = msg.questions;
                gameState.totalQuestions = msg.questions.length;
                
                setupScreen.classList.add('hidden');
                playScreen.classList.add('visible');
                scoreBar.classList.add('visible');
                
                updateScoreDisplay();
                displayQuestion();
            } else if (msg.type === 'gameError') {
                hideLoading();
                alert('Error: ' + msg.error);
            } else if (msg.type === 'gameContent') {
                hideLoading();
                setupScreen.classList.add('hidden');
                playScreen.classList.add('visible');
                scoreBar.style.display = 'none';
                
                const questionText = document.getElementById('question-text');
                const answersGrid = document.getElementById('answers-grid');
                
                // For Story Chain, parse and create clickable choices
                if (msg.gameType === 'startStory') {
                    // Split content into story and choices
                    const parts = msg.content.split('---CHOICES---');
                    const storyPart = parts[0] || msg.content;
                    const choicesPart = parts[1] || '';
                    
                    // Parse choices (numbered list)
                    const choiceLines = choicesPart.split(/\\n/).filter(line => line.match(/^\\d+\\./));
                    
                    // Render story
                    let html = storyPart.replace(/---STORY---/g, '').trim();
                    html = html.split('**').join('');
                    questionText.innerHTML = '<div style="line-height:1.8;font-size:16px;">' + html.replace(/\\n/g, '<br>') + '</div>';
                    
                    // Create choice buttons
                    if (choiceLines.length > 0) {
                        answersGrid.innerHTML = '';
                        answersGrid.style.display = 'flex';
                        answersGrid.style.flexDirection = 'column';
                        answersGrid.style.gap = '12px';
                        
                        choiceLines.forEach((choice, i) => {
                            const cleanChoice = choice.replace(/^\\d+\\.\\s*/, '').trim();
                            const btn = document.createElement('button');
                            btn.className = 'answer-btn';
                            btn.style.display = 'block';
                            btn.style.width = '100%';
                            btn.innerHTML = '<span class="answer-letter">' + (i+1) + '</span><span class="answer-text">' + cleanChoice + '</span>';
                            btn.onclick = () => {
                                showLoading('Continuing the story...');
                                vscode.postMessage({
                                    type: 'gameAction',
                                    action: 'continueStory',
                                    choice: cleanChoice,
                                    settings: gameState.settings
                                });
                            };
                            answersGrid.appendChild(btn);
                        });
                    } else {
                        answersGrid.style.display = 'none';
                    }
                } else if (msg.gameType === 'startCaption') {
                    // Caption Battle - show scenarios with input fields
                    let html = msg.content;
                    html = html.split('**').join('');
                    html = html.replace(/---SCENARIO_\\d+---/g, '<hr style="margin:20px 0">');
                    questionText.innerHTML = '<div style="line-height:1.6;font-size:15px">' + html.replace(/\\n/g, '<br>') + '</div>';
                    
                    // Add caption input
                    answersGrid.innerHTML = '';
                    answersGrid.style.display = 'flex';
                    answersGrid.style.flexDirection = 'column';
                    answersGrid.style.gap = '12px';
                    
                    const input = document.createElement('textarea');
                    input.placeholder = 'Write your funniest caption here...';
                    input.style.cssText = 'width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:rgba(0,0,0,0.3);color:#fff;font-size:14px;min-height:80px;resize:vertical;';
                    answersGrid.appendChild(input);
                    
                    const submitBtn = document.createElement('button');
                    submitBtn.className = 'answer-btn';
                    submitBtn.style.cssText = 'justify-content:center;background:var(--accent,#06b6d4);';
                    submitBtn.textContent = '\u{1F3A4} Submit Caption';
                    submitBtn.onclick = () => {
                        if (!input.value.trim()) { alert('Please write a caption!'); return; }
                        showLoading('Judging your caption...');
                        vscode.postMessage({
                            type: 'gameAction',
                            action: 'judgeCaption',
                            caption: input.value.trim(),
                            settings: gameState.settings
                        });
                    };
                    answersGrid.appendChild(submitBtn);
                } else if (msg.gameType === 'startDebate') {
                    // Debate Arena - show topic with argument input
                    let html = msg.content;
                    html = html.split('# ').join('<h2 style="color:#ef4444">');
                    html = html.split('## ').join('<h3>');
                    html = html.split('**').join('');
                    questionText.innerHTML = '<div style="line-height:1.6">' + html.replace(/\\n/g, '<br>') + '</div>';
                    
                    // Add argument input
                    answersGrid.innerHTML = '';
                    answersGrid.style.display = 'flex';
                    answersGrid.style.flexDirection = 'column';
                    answersGrid.style.gap = '12px';
                    
                    const sideLabel = document.createElement('div');
                    sideLabel.innerHTML = '<strong>Pick your side and argue!</strong>';
                    sideLabel.style.marginBottom = '8px';
                    answersGrid.appendChild(sideLabel);
                    
                    const input = document.createElement('textarea');
                    input.placeholder = 'Type your argument here... Be persuasive!';
                    input.style.cssText = 'width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:rgba(0,0,0,0.3);color:#fff;font-size:14px;min-height:100px;resize:vertical;';
                    answersGrid.appendChild(input);
                    
                    const submitBtn = document.createElement('button');
                    submitBtn.className = 'answer-btn';
                    submitBtn.style.cssText = 'justify-content:center;background:#ef4444;';
                    submitBtn.textContent = '\u2694\uFE0F Submit Argument';
                    submitBtn.onclick = () => {
                        if (!input.value.trim()) { alert('Please write an argument!'); return; }
                        showLoading('The AI judge is deliberating...');
                        vscode.postMessage({
                            type: 'gameAction',
                            action: 'judgeDebate',
                            argument: input.value.trim(),
                            settings: gameState.settings
                        });
                    };
                    answersGrid.appendChild(submitBtn);
                } else {
                    // Fallback
                    let html = msg.content;
                    html = html.split('# ').join('<h1>');
                    html = html.split('## ').join('<h2>');
                    html = html.split('**').join('');
                    html = html.split('---').join('<hr>');
                    questionText.innerHTML = '<div style="line-height:1.6">' + html.replace(/\\n/g, '<br>') + '</div>';
                    answersGrid.style.display = 'none';
                }
                
                // Show play again button
                document.getElementById('next-btn').textContent = '\u{1F504} Play Again';
                document.getElementById('next-btn').classList.add('visible');
                document.getElementById('next-btn').onclick = () => resetGame();
            } else if (msg.type === 'gameResult') {
                hideLoading();
                // Show the result/feedback from AI judge
                const questionText = document.getElementById('question-text');
                const answersGrid = document.getElementById('answers-grid');
                
                let html = msg.content;
                html = html.split('**').join('<strong>').split('</strong><strong>').join('');
                html = html.split('*').join('');
                questionText.innerHTML = '<div style="line-height:1.8;font-size:16px;padding:20px;background:rgba(0,255,100,0.1);border-radius:12px;border:1px solid rgba(0,255,100,0.3);">' + html.replace(/\\n/g, '<br>') + '</div>';
                
                // Add "Try Again" button
                answersGrid.innerHTML = '';
                answersGrid.style.display = 'block';
                const tryAgainBtn = document.createElement('button');
                tryAgainBtn.className = 'answer-btn';
                tryAgainBtn.style.cssText = 'justify-content:center;width:100%;margin-top:16px;';
                tryAgainBtn.textContent = '\u{1F504} Try Another Round';
                tryAgainBtn.onclick = () => resetGame();
                answersGrid.appendChild(tryAgainBtn);
            }
        });
    </script>
</body>
</html>`}static getAppHtml(e,r,n){let o=Xl();return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${o}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${r.icon} ${r.name}</title>
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            background: var(--vscode-editor-background);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 32px;
        }
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: transparent;
            color: var(--vscode-foreground);
            cursor: pointer;
            font-size: 13px;
            margin-bottom: 24px;
            transition: all 0.15s ease;
        }
        .back-btn:hover {
            background: var(--vscode-button-secondaryBackground);
            border-color: var(--vscode-focusBorder);
        }
        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 32px;
        }
        .header-icon {
            font-size: 56px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(56,189,248,0.15), rgba(167,139,250,0.1));
            border: 1px solid var(--vscode-widget-border);
        }
        .header-text h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .header-text p {
            font-size: 15px;
            opacity: 0.7;
        }
        .form-section {
            background: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-widget-border);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
        }
        .form-group {
            margin-bottom: 24px;
        }
        .form-group:last-child { margin-bottom: 0; }
        .form-label {
            display: block;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .form-hint {
            font-size: 12px;
            opacity: 0.6;
            margin-top: 6px;
        }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid var(--vscode-input-border);
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            font-family: var(--vscode-font-family);
            font-size: 14px;
            transition: all 0.15s ease;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--vscode-focusBorder);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--vscode-focusBorder) 15%, transparent);
        }
        textarea {
            font-family: var(--vscode-editor-font-family);
            resize: vertical;
            min-height: 140px;
            line-height: 1.5;
        }
        .radio-group, .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .radio-option, .checkbox-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 10px;
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-widget-border);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .radio-option:hover, .checkbox-option:hover {
            border-color: var(--vscode-focusBorder);
        }
        .radio-option.selected, .checkbox-option.selected {
            border-color: var(--vscode-focusBorder);
            background: color-mix(in srgb, var(--vscode-focusBorder) 8%, var(--vscode-editor-background));
        }
        .radio-option input, .checkbox-option input {
            margin: 3px 0 0 0;
        }
        .option-content { flex: 1; }
        .option-label {
            font-weight: 500;
            font-size: 14px;
        }
        .option-desc {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 3px;
        }
        .project-picker {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .project-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            border-radius: 10px;
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-widget-border);
        }
        .project-item .name { flex: 1; font-weight: 500; }
        .project-item .path {
            font-size: 11px;
            opacity: 0.6;
            font-family: var(--vscode-editor-font-family);
        }
        .project-item .remove-btn {
            background: none;
            border: none;
            cursor: pointer;
            opacity: 0.5;
            font-size: 16px;
        }
        .project-item .remove-btn:hover { opacity: 1; }
        .add-project-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px;
            border-radius: 10px;
            border: 2px dashed var(--vscode-widget-border);
            background: transparent;
            color: var(--vscode-foreground);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
        }
        .add-project-btn:hover {
            border-color: var(--vscode-focusBorder);
            background: color-mix(in srgb, var(--vscode-focusBorder) 5%, transparent);
        }
        .submit-btn {
            width: 100%;
            padding: 16px 28px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, var(--vscode-button-background), color-mix(in srgb, var(--vscode-button-background) 80%, black));
            color: var(--vscode-button-foreground);
            font-family: var(--vscode-font-family);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid currentColor;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .result-section {
            margin-top: 32px;
        }
        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .result-header h3 {
            font-size: 18px;
        }
        .result-actions {
            display: flex;
            gap: 10px;
        }
        .action-btn {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s ease;
        }
        .action-btn:hover {
            background: var(--vscode-button-secondaryHoverBackground);
            border-color: var(--vscode-focusBorder);
        }
        .result-content {
            background: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-widget-border);
            border-radius: 12px;
            padding: 24px;
            font-family: var(--vscode-editor-font-family);
            font-size: 13px;
            line-height: 1.7;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        .result-content.error {
            background: color-mix(in srgb, var(--vscode-testing-iconFailed) 10%, var(--vscode-editor-background));
            border-color: var(--vscode-testing-iconFailed);
            color: var(--vscode-testing-iconFailed);
        }
        .progress-msg {
            text-align: center;
            font-size: 14px;
            opacity: 0.7;
            padding: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .hidden { display: none !important; }
        .conditional-field { display: none; }
        .conditional-field.visible { display: block; }
        .file-picker-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .file-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .file-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            border-radius: 8px;
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-widget-border);
        }
        .file-item .file-icon { font-size: 20px; }
        .file-item .file-info { flex: 1; }
        .file-item .file-name { font-weight: 500; font-size: 13px; }
        .file-item .file-size { font-size: 11px; opacity: 0.6; }
        .file-item .remove-file-btn {
            background: none;
            border: none;
            cursor: pointer;
            opacity: 0.5;
            font-size: 16px;
            padding: 4px;
        }
        .file-item .remove-file-btn:hover { opacity: 1; }
        .add-file-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px;
            border-radius: 10px;
            border: 2px dashed var(--vscode-widget-border);
            background: transparent;
            color: var(--vscode-foreground);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
        }
        .add-file-btn:hover {
            border-color: var(--vscode-focusBorder);
            background: color-mix(in srgb, var(--vscode-focusBorder) 5%, transparent);
        }
        .model-picker-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .model-select {
            flex: 1;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--vscode-input-border);
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            font-size: 13px;
        }
        .refresh-models-btn {
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
            cursor: pointer;
            font-size: 14px;
        }
        .refresh-models-btn:hover {
            background: var(--vscode-button-secondaryHoverBackground);
        }
        .help-section {
            background: color-mix(in srgb, var(--vscode-focusBorder) 5%, var(--vscode-editor-background));
            border: 1px solid var(--vscode-widget-border);
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 32px;
            font-size: 13px;
            line-height: 1.6;
        }
        .help-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin: 16px 0 8px 0;
            color: var(--vscode-foreground);
        }
        .help-section h3:first-child { margin-top: 0; }
        .help-section p { margin-bottom: 12px; opacity: 0.9; }
        .help-section ul { margin-bottom: 12px; padding-left: 20px; }
        .help-section li { margin-bottom: 6px; opacity: 0.9; }
        .help-section strong { font-weight: 600; color: var(--vscode-foreground); }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-btn" id="back-btn">\u2190 Back to Apps</button>
        
        <div class="header">
            <div class="header-icon">${r.icon}</div>
            <div class="header-text">
                <h1>${r.name}</h1>
                <p>${r.description}</p>
            </div>
        </div>

        ${r.helpDocumentation?`
        <div class="help-section">
            ${t.renderMarkdown(r.helpDocumentation)}
        </div>
        `:""}

        <form id="app-form">
            <div class="form-section">
                ${r.inputs.map(i=>t.renderInputField(i,n)).join("")}
            </div>

            <button type="submit" class="submit-btn" id="submit-btn">
                ${r.primaryAction}
            </button>
        </form>

        <div class="result-section hidden" id="result-section">
            <div class="result-header">
                <h3>\u{1F4CB} Result</h3>
                <div class="result-actions">
                    <button class="action-btn" id="copy-btn">\u{1F4CB} Copy</button>
                    <button class="action-btn" id="insert-btn">\u{1F4DD} Insert</button>
                    <button class="action-btn" id="save-btn">\u{1F4BE} Save</button>
                </div>
            </div>
            <div class="progress-msg hidden" id="progress-msg">
                <div class="spinner"></div>
                <span id="progress-text">Processing...</span>
            </div>
            <div class="result-content hidden" id="result-content"></div>
        </div>
    </div>

    <script nonce="${o}">
        const vscode = acquireVsCodeApi();
        const appId = '${r.id}';
        let currentResult = '';
        let selectedProjects = ${JSON.stringify(n.map(i=>i.path))};

        // Back button
        document.getElementById('back-btn').addEventListener('click', () => {
            vscode.postMessage({ type: 'goBack' });
        });

        // Form submission
        document.getElementById('app-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const inputs = {};
            
            for (const [key, value] of formData.entries()) {
                inputs[key] = value;
            }
            
            // Handle multi-select
            document.querySelectorAll('.checkbox-group').forEach(group => {
                const name = group.dataset.name;
                const checked = Array.from(group.querySelectorAll('input:checked')).map(cb => cb.value);
                inputs[name] = checked.join(',');
            });
            
            // Handle project picker
            if (selectedProjects.length > 0) {
                inputs['projectPaths'] = JSON.stringify(selectedProjects);
            }
            
            // Show loading
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Processing...';
            
            document.getElementById('result-section').classList.remove('hidden');
            document.getElementById('progress-msg').classList.remove('hidden');
            document.getElementById('result-content').classList.add('hidden');
            
            vscode.postMessage({ type: 'executeApp', inputs });
        });

        // Handle messages
        window.addEventListener('message', (event) => {
            const message = event.data;
            
            switch (message.type) {
                case 'progress':
                    document.getElementById('progress-text').textContent = message.message;
                    break;
                    
                case 'result':
                    const submitBtn = document.getElementById('submit-btn');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '${r.primaryAction}';
                    
                    document.getElementById('progress-msg').classList.add('hidden');
                    const content = document.getElementById('result-content');
                    content.classList.remove('hidden', 'error');
                    
                    if (message.result.success) {
                        currentResult = message.result.output.content;
                        
                        // Check if this is Playwright app - auto-create project
                        const isPlaywrightApp = '${r.id}' === 'playwright-generator';
                        const targetFolder = selectedProjects[0];
                        
                        if (isPlaywrightApp && targetFolder) {
                            content.innerHTML = '<div style="text-align:center;padding:20px;"><div class="spinner"></div><p>Creating project files...</p></div>';
                            
                            const testName = document.querySelector('input[name="testName"]')?.value || 'playwright-test';
                            vscode.postMessage({
                                type: 'extractAndCreateProject',
                                targetFolder: targetFolder,
                                testName: testName,
                                rawContent: currentResult,
                                language: document.querySelector('input[name="language"]:checked')?.value || 'typescript'
                            });
                        } else if (isPlaywrightApp && !targetFolder) {
                            content.innerHTML = '<div style="color:orange;padding:20px;text-align:center;">\u26A0\uFE0F Please select a target folder first!</div>';
                        } else {
                            content.textContent = currentResult;
                        }
                    } else {
                        content.classList.add('error');
                        content.textContent = 'Error: ' + message.result.error;
                    }
                    break;
                    
                case 'projectAdded':
                    if (!selectedProjects.includes(message.project.path)) {
                        selectedProjects.push(message.project.path);
                        updateProjectList();
                    }
                    break;
                    
                case 'filesReceived':
const fieldId = message.fieldId;
if (!attachedFiles[fieldId]) {
    attachedFiles[fieldId] = [];
}
message.files.forEach(f => {
    if (!attachedFiles[fieldId].some(existing => existing.name === f.name)) {
        attachedFiles[fieldId].push(f);
    }
});
updateFileList(fieldId);
break;
                    
                case 'modelsReceived':
const modelFieldId = message.fieldId;
const select = document.getElementById('model-select-' + modelFieldId);
if (select) {
    // Keep auto option, add models
    select.innerHTML = '<option value="auto">\u{1F916} Auto (Best Available)</option>' +
        message.models.map(m =>
            \`<option value="\${m.id}">\${m.vendor} - \${m.name}</option>\`
                            ).join('');
                    }
                    break;
                    
                case 'projectCreated':
                    document.getElementById('result-section').classList.remove('hidden');
                    document.getElementById('progress-msg').classList.add('hidden');
                    document.getElementById('submit-btn').disabled = false;
                    const createdContent = document.getElementById('result-content');
                    createdContent.classList.remove('hidden', 'error');
                    createdContent.innerHTML = \`
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">\u2705</div>
                            <h3 style="margin-bottom: 8px;">Project Created Successfully!</h3>
                            <p style="opacity: 0.7; margin-bottom: 16px;">Location: \${message.path}</p>
                            <p style="font-size: 13px; margin-bottom: 16px;">Files: \${message.files ? message.files.join(', ') : 'package.json, config, test'}</p>
                        </div>
                        <div style="text-align: left; background: var(--vscode-terminal-background, #1e1e1e); border-radius: 8px; padding: 16px; margin-top: 16px;">
                            <p style="font-weight: 600; margin-bottom: 12px; color: var(--vscode-terminal-foreground, #ccc);">\u{1F4E6} Install & Run Commands:</p>
                            <pre style="background: var(--vscode-editor-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-family: monospace; font-size: 13px; line-height: 1.6;"><code># Navigate to project folder
cd "\${message.path}"

# Install dependencies
npm install

# Install Playwright browsers
npx playwright install

# Run the tests
npx playwright test

# View HTML report
npx playwright show-report</code></pre>
                        </div>
                    \`;
                    break;
                    
                case 'projectError':
                    document.getElementById('result-section').classList.remove('hidden');
                    document.getElementById('progress-msg').classList.add('hidden');
                    document.getElementById('submit-btn').disabled = false;
                    const errorContent = document.getElementById('result-content');
                    errorContent.classList.remove('hidden');
                    errorContent.classList.add('error');
                    errorContent.textContent = 'Error creating project: ' + message.error;
                    break;
            }
        });

        // Action buttons
        document.getElementById('copy-btn').addEventListener('click', () => {
            vscode.postMessage({ type: 'copyToClipboard', value: currentResult });
        });

        document.getElementById('insert-btn').addEventListener('click', () => {
            vscode.postMessage({ type: 'insertAtCursor', value: currentResult });
        });

        document.getElementById('save-btn').addEventListener('click', () => {
            vscode.postMessage({ 
                type: 'saveAsFile', 
                content: currentResult, 
                filename: '${r.id}-output.md'
            });
        });

        // Project management
        document.querySelectorAll('.add-project-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                vscode.postMessage({ type: 'pickProjectFolder' });
            });
        });

        function removeProject(path) {
            selectedProjects = selectedProjects.filter(p => p !== path);
            updateProjectList();
        }
        window.removeProject = removeProject;

        function updateProjectList() {
            const container = document.querySelector('.project-picker');
            if (!container) return;
            
            const items = selectedProjects.map(path => {
                const name = path.split('/').pop();
                return \`
                    <div class="project-item">
                        <span>\u{1F4C1}</span>
                        <div class="name">\${name}</div>
                        <div class="path">\${path}</div>
                        <button type="button" class="remove-btn" onclick="removeProject('\${path}')">\u2715</button>
                    </div>
                \`;
            }).join('');
            
            container.innerHTML = items + '<button type="button" class="add-project-btn">+ Add Project Folder</button>';
            container.querySelector('.add-project-btn').addEventListener('click', () => {
                vscode.postMessage({ type: 'pickProjectFolder' });
            });
        }

        // File picker handling
        const attachedFiles = {};
        
        document.querySelectorAll('.add-file-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const fieldId = btn.dataset.fieldId;
                vscode.postMessage({ type: 'pickFiles', fieldId });
            });
        });

        function removeFile(fieldId, fileName) {
            if (attachedFiles[fieldId]) {
                attachedFiles[fieldId] = attachedFiles[fieldId].filter(f => f.name !== fileName);
                updateFileList(fieldId);
            }
        }
        window.removeFile = removeFile;

        function updateFileList(fieldId) {
            const container = document.getElementById('file-list-' + fieldId);
            const hiddenInput = document.getElementById('files-data-' + fieldId);
            if (!container) return;
            
            const files = attachedFiles[fieldId] || [];
            const fileIcons = { xlsx: '\u{1F4CA}', docx: '\u{1F4C4}', txt: '\u{1F4DD}', md: '\u{1F4D1}' };
            
            container.innerHTML = files.map(file => {
                const ext = file.name.split('.').pop().toLowerCase();
                const icon = fileIcons[ext] || '\u{1F4CE}';
                return \`
                    <div class="file-item">
                        <span class="file-icon">\${icon}</span>
                        <div class="file-info">
                            <div class="file-name">\${file.name}</div>
                            <div class="file-size">\${file.content.length > 1000 ? (file.content.length / 1024).toFixed(1) + ' KB' : file.content.length + ' bytes'}</div>
                        </div>
                        <button type="button" class="remove-file-btn" onclick="removeFile('\${fieldId}', '\${file.name}')">\u2715</button>
                    </div>
                \`;
            }).join('');
            
            // Update hidden input with file contents
            hiddenInput.value = JSON.stringify(files);
        }

        // Model picker handling
        document.querySelectorAll('.refresh-models-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const fieldId = btn.dataset.fieldId;
                vscode.postMessage({ type: 'getAvailableModels', fieldId });
            });
        });
        
        // Auto-fetch models on load for all model pickers
        document.querySelectorAll('.model-select').forEach(select => {
            const fieldId = select.id.replace('model-select-', '');
            vscode.postMessage({ type: 'getAvailableModels', fieldId });
        });

        // Radio/checkbox handling
        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', () => {
                const group = option.closest('.radio-group');
                group.querySelectorAll('.radio-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                option.querySelector('input').checked = true;
                handleConditionalFields(option.querySelector('input').name, option.querySelector('input').value);
            });
        });

        document.querySelectorAll('.checkbox-option').forEach(option => {
            option.addEventListener('click', () => {
                option.classList.toggle('selected');
                const cb = option.querySelector('input');
                cb.checked = !cb.checked;
            });
        });

        function handleConditionalFields(fieldName, value) {
            document.querySelectorAll('.conditional-field').forEach(field => {
                const showIf = field.dataset.showIf;
                if (showIf) {
                    const [condField, condValue] = showIf.split('=');
                    if (condField === fieldName) {
                        field.classList.toggle('visible', condValue.includes(',') 
                            ? condValue.split(',').includes(value) 
                            : condValue === value);
                    }
                }
            });
        }

        // Initialize conditional fields
        document.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
            handleConditionalFields(radio.name, radio.value);
        });
    </script>
</body>
</html>`}static renderMarkdown(e){return e.trim().replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^\* (.*$)/gim,"<ul><li>$1</li></ul>").replace(/^\- (.*$)/gim,"<ul><li>$1</li></ul>").replace(/^\d\. (.*$)/gim,"<ul><li>$1</li></ul>").replace(/\*\*(.*)\*\*/gim,"<strong>$1</strong>").replace(/\n\n/g,"</p><p>").replace(/<\/ul><ul>/g,"")}static renderInputField(e,r){let n=e.showIf?`data-show-if="${e.showIf.field}=${Array.isArray(e.showIf.equals)?e.showIf.equals.join(","):e.showIf.equals}"`:"",o=e.showIf?"conditional-field":"";switch(e.type){case"textarea":case"code":return`
                    <div class="form-group ${o}" ${n}>
                        <label class="form-label">${e.label}${e.required?" *":""}</label>
                        <textarea 
                            name="${e.id}" 
                            placeholder="${e.placeholder||""}"
                            rows="${e.rows||5}"
                            ${e.required?"required":""}
                        >${e.defaultValue||""}</textarea>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `;case"select":return`
                    <div class="form-group ${o}" ${n}>
                        <label class="form-label">${e.label}${e.required?" *":""}</label>
                        <select name="${e.id}" ${e.required?"required":""}>
                            ${(e.options||[]).map(a=>`
                                <option value="${a.value}" ${e.defaultValue===a.value?"selected":""}>
                                    ${a.label}
                                </option>
                            `).join("")}
                        </select>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `;case"radio":let i=e.defaultValue||e.options?.[0]?.value;return`
                    <div class="form-group ${o}" ${n}>
                        <label class="form-label">${e.label}${e.required?" *":""}</label>
                        <div class="radio-group">
                            ${(e.options||[]).map(a=>`
                                <label class="radio-option ${i===a.value?"selected":""}">
                                    <input type="radio" name="${e.id}" value="${a.value}" 
                                           ${i===a.value?"checked":""}>
                                    <div class="option-content">
                                        <div class="option-label">${a.icon||""} ${a.label}</div>
                                        ${a.description?`<div class="option-desc">${a.description}</div>`:""}
                                    </div>
                                </label>
                            `).join("")}
                        </div>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `;case"multi-select":case"checkbox-group":let s=(e.defaultValue||"").split(",");return`
                    <div class="form-group ${o}" ${n}>
                        <label class="form-label">${e.label}</label>
                        <div class="checkbox-group" data-name="${e.id}">
                            ${(e.options||[]).map(a=>`
                                <label class="checkbox-option ${s.includes(a.value)?"selected":""}">
                                    <input type="checkbox" name="${e.id}" value="${a.value}" 
                                           ${s.includes(a.value)?"checked":""}>
                                    <div class="option-content">
                                        <div class="option-label">${a.label}</div>
                                        ${a.description?`<div class="option-desc">${a.description}</div>`:""}
                                    </div>
                                </label>
                            `).join("")}
                        </div>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `;case"project-picker":return`
                    <div class="form-group ${o}" ${n}>
                        <label class="form-label">${e.label}${e.required?" *":""}</label>
                        <div class="project-picker">
                            ${r.map(a=>`
                                <div class="project-item">
                                    <span>\u{1F4C1}</span>
                                    <div class="name">${a.name}</div>
                                    <div class="path">${a.path}</div>
                                    <button type="button" class="remove-btn" onclick="removeProject('${a.path}')">\u2715</button>
                                </div>
                            `).join("")}
                            <button type="button" class="add-project-btn">+ Add Project Folder</button>
                        </div>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `;case"file-picker":return`
                    <div class="form-group ${o}" ${n}>
                        <label class="form-label">${e.label}${e.required?" *":""}</label>
                        <div class="file-picker-container" data-field-id="${e.id}">
                            <div class="file-list" id="file-list-${e.id}"></div>
                            <button type="button" class="add-file-btn" data-field-id="${e.id}">
                                \u{1F4CE} Attach Files (.xlsx, .docx, .txt, .md)
                            </button>
                            <input type="hidden" name="${e.id}" id="files-data-${e.id}" value="">
                        </div>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `;case"model-picker":return`
                    <div class="form-group ${o}" ${n}>
                        <label class="form-label">${e.label}</label>
                        <div class="model-picker-container">
                            <select name="${e.id}" id="model-select-${e.id}" class="model-select">
                                <option value="auto">\u{1F916} Auto (Best Available)</option>
                            </select>
                            <button type="button" class="refresh-models-btn" data-field-id="${e.id}">\u{1F504}</button>
                        </div>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `;case"checkbox":return`
                    <div class="form-group ${o}" ${n}>
                        <label class="checkbox-option ${e.defaultValue==="true"?"selected":""}" style="display: inline-flex;">
                            <input type="checkbox" name="${e.id}" value="true" 
                                   ${e.defaultValue==="true"?"checked":""}>
                            <div class="option-content">
                                <div class="option-label">${e.label}</div>
                            </div>
                        </label>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `;default:return`
                    <div class="form-group ${o}" ${n}>
                        <label class="form-label">${e.label}${e.required?" *":""}</label>
                        <input type="text" 
                               name="${e.id}" 
                               placeholder="${e.placeholder||""}"
                               value="${e.defaultValue||""}"
                               ${e.required?"required":""}>
                        ${e.hint?`<div class="form-hint">${e.hint}</div>`:""}
                    </div>
                `}}};function Xl(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}var lA=ct(require("vscode")),uA=ct(require("os")),OD=ct(require("path")),jD=ct(require("fs"));async function _Y(){if(uA.platform()!=="darwin"){lA.window.showErrorMessage("Desktop shortcut creation is currently only supported on macOS.");return}try{let e=uA.homedir(),r=OD.join(e,"Desktop"),o=`#!/bin/bash
open "vscode://suhaibbinyounis.github-copilot-api-vscode/dashboard"
`,i=OD.join(r,"Copilot Dashboard.command");await jD.promises.writeFile(i,o,"utf8"),await jD.promises.chmod(i,493),lA.window.showInformationMessage('SHORTCUT CREATED: "Copilot Dashboard.command" has been added to your Desktop.'),`${i}`}catch(e){console.error("Failed to create shortcut:",e),lA.window.showErrorMessage(`Failed to create desktop shortcut: ${e instanceof Error?e.message:String(e)}`)}}function C_e(t){let e=Ie.window.createOutputChannel("GitHub Copilot API Server");t.subscriptions.push(e);let r=Ie.window.createStatusBarItem(Ie.StatusBarAlignment.Left,100);r.command="github-copilot-api-vscode.showServerControls",t.subscriptions.push(r);let n=new oA(e,r,t);t.subscriptions.push(n);let o=new Fa(t.extensionUri,n);t.subscriptions.push(Ie.window.registerWebviewViewProvider(Fa.viewType,o)),setImmediate(()=>{Ds.initialize(t);let g=new cb(t.extensionUri);t.subscriptions.push(Ie.window.registerWebviewViewProvider(cb.viewType,g)),t.subscriptions.push(Ie.commands.registerCommand("github-copilot-api-vscode.openAppsHub",()=>{Ds.openAppsHub()}))});let i=async()=>{let g=await n.getStatus();if(g.running){let v=g.stats.requestsPerMinute,b=g.stats.avgLatencyMs,S="$(broadcast) Copilot API: ON";(v>0||g.activeRequests>0)&&(S+=`  $(graph) ${v} RPM`),b>0&&(S+=`  $(pulse) ${b}ms`),g.activeRequests>0?(r.text=`$(sync~spin) Processing (${g.activeRequests}) | ${v} RPM`,r.backgroundColor=new Ie.ThemeColor("statusBarItem.warningBackground")):(r.text=S,r.backgroundColor=void 0),r.tooltip=new Ie.MarkdownString(`
**Copilot API Gateway**
- **Status**: Active
- **Host**: ${g.config.host}:${g.config.port}
- **Requests/min**: ${v}
- **Avg Latency**: ${b}ms
- **Total Requests**: ${g.stats.totalRequests}
			`),r.show()}else r.text="$(circle-slash) Copilot API: OFF",r.tooltip="Copilot API server is stopped. Click to manage.",r.backgroundColor=new Ie.ThemeColor("statusBarItem.errorBackground"),r.show()},s=!1;t.subscriptions.push(n.onDidChangeStatus(async()=>{await i();let g=await n.getStatus();if(g.running&&!s&&Ie.workspace.getConfiguration("githubCopilotApi.server").get("showNotifications",!0)){let b=g.config.host==="0.0.0.0"&&g.networkInfo?.localIPs?.length?g.networkInfo.localIPs[0]:g.config.host,S=g.isHttps?"https":"http";await Ie.window.showInformationMessage(`GitHub Copilot API Server started at ${S}://${b}:${g.config.port}`,"Open Dashboard")==="Open Dashboard"&&Ie.commands.executeCommand("github-copilot-api-vscode.openDashboard")}s=g.running}));let a=Ie.commands.registerCommand("github-copilot-api-vscode.showServerControls",async()=>{let g=await n.getStatus(),v=[];g.running?(v.push({label:"$(check) Server is Running",description:`http://${g.config.host}:${g.config.port}`,detail:`Requests/min: ${g.stats.requestsPerMinute} | Avg Latency: ${g.stats.avgLatencyMs}ms | Errors: ${g.stats.errorRate}%`,kind:Ie.QuickPickItemKind.Separator}),v.push({label:"$(stop-circle) Stop Server",description:"Stop the API gateway"}),v.push({label:"$(refresh) Restart Server",description:"Reload configuration and restart"})):(v.push({label:"$(x) Server is Stopped",kind:Ie.QuickPickItemKind.Separator}),v.push({label:"$(play-circle) Start Server",description:"Start the API gateway"})),v.push({label:"",kind:Ie.QuickPickItemKind.Separator}),v.push({label:"$(dashboard) Open Full Dashboard",description:"View detailed charts, logs, and configuration"}),v.push({label:"$(output) Show Logs",description:"Open the output channel"});let b=await Ie.window.showQuickPick(v,{placeHolder:"Manage Copilot API Gateway",title:"Copilot API Controls"});b&&(b.label.includes("Stop Server")?await n.stopServer():b.label.includes("Start Server")?await n.startServer():b.label.includes("Restart Server")?await n.restart():b.label.includes("Open Full Dashboard")?Fa.createOrShow(t.extensionUri,n):b.label.includes("Show Logs")&&e.show())});i();let c=Ie.workspace.getConfiguration("githubCopilotApi.server"),l=c.get("enabled",!1),u=c.get("autoStart",!1);e.appendLine(`[DEBUG] Activation. Enabled: ${l}, AutoStart: ${u}`),(l||u)&&n.start().catch(g=>{e.appendLine(`[${new Date().toISOString()}] ERROR Failed to start API server: ${Jl(g)}`),Ie.window.showErrorMessage(`Failed to start Copilot API server: ${Jl(g)}`)});let d=Ie.commands.registerCommand("github-copilot-api-vscode.openCopilotChat",async()=>{await iA()&&await Ie.commands.executeCommand("workbench.action.chat.open")}),p=Ie.commands.registerCommand("github-copilot-api-vscode.askCopilot",async g=>{if(!await iA())return;let v=PD(g)??await Ie.window.showInputBox({title:"Ask GitHub Copilot Chat",prompt:"What do you want to ask Copilot?",ignoreFocusOut:!0});v&&await Ie.commands.executeCommand("workbench.action.chat.open",{query:v,isPartialQuery:!1})}),f=Ie.commands.registerTextEditorCommand("github-copilot-api-vscode.askSelectionWithCopilot",async(g,v,b)=>{if(!await iA())return;let S=g.selection;if(S.isEmpty){Ie.window.showWarningMessage("Select some code before asking Copilot about it.");return}let j=PD(b)??await Ie.window.showInputBox({title:"Ask Copilot About Selection",prompt:"Describe what you want to know about the selected code.",value:"Explain this code.",ignoreFocusOut:!0});j&&await Ie.commands.executeCommand("workbench.action.chat.open",{query:j,isPartialQuery:!1,attachFiles:[{uri:g.document.uri,range:new Ie.Range(S.start,S.end)}],blockOnResponse:!1})}),m=Ie.commands.registerCommand("github-copilot-api-vscode.openDashboard",()=>{Fa.createOrShow(t.extensionUri,n)}),h=Ie.commands.registerCommand("github-copilot-api-vscode.createDesktopShortcut",async()=>{await _Y()});t.subscriptions.push(Ie.window.registerUriHandler({handleUri(g){let v=g.path;e.appendLine(`[URI Handler] Received URI: ${g.toString()} (path: ${v})`),v==="/dashboard"?Fa.createOrShow(t.extensionUri,n):v==="/start"?n.startServer().then(()=>{Ie.window.showInformationMessage("Copilot API Server started via shortcut")}):v==="/stop"?n.stopServer().then(()=>{Ie.window.showInformationMessage("Copilot API Server stopped via shortcut")}):Ie.window.showWarningMessage(`Unknown shortcut path: ${v}`)}})),t.subscriptions.push(d,p,f,h,m)}function I_e(){}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

pvtsutils/build/index.js:
  (*!
   * MIT License
   * 
   * Copyright (c) 2017-2024 Peculiar Ventures, LLC
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

pvutils/build/utils.js:
  (*!
   Copyright (c) Peculiar Ventures, LLC
  *)

asn1js/build/index.js:
  (*!
   * Copyright (c) 2014, GMO GlobalSign
   * Copyright (c) 2015-2022, Peculiar Ventures
   * All rights reserved.
   * 
   * Author 2014-2019, Yury Strozhevsky
   * 
   * Redistribution and use in source and binary forms, with or without modification,
   * are permitted provided that the following conditions are met:
   * 
   * * Redistributions of source code must retain the above copyright notice, this
   *   list of conditions and the following disclaimer.
   * 
   * * Redistributions in binary form must reproduce the above copyright notice, this
   *   list of conditions and the following disclaimer in the documentation and/or
   *   other materials provided with the distribution.
   * 
   * * Neither the name of the copyright holder nor the names of its
   *   contributors may be used to endorse or promote products derived from
   *   this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
   * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
   * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   * 
   *)

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@peculiar/x509/build/x509.cjs.js:
  (*!
   * MIT License
   * 
   * Copyright (c) Peculiar Ventures. All rights reserved.
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)
*/
