"use strict";var Qz=Object.create;var jc=Object.defineProperty;var e1=Object.getOwnPropertyDescriptor;var t1=Object.getOwnPropertyNames;var r1=Object.getPrototypeOf,n1=Object.prototype.hasOwnProperty;var b=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),An=(t,e)=>{for(var r in e)jc(t,r,{get:e[r],enumerable:!0})},vb=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of t1(e))!n1.call(t,o)&&o!==r&&jc(t,o,{get:()=>e[o],enumerable:!(n=e1(e,o))||n.enumerable});return t};var Le=(t,e,r)=>(r=t!=null?Qz(r1(t)):{},vb(e||!t||!t.__esModule?jc(r,"default",{value:t,enumerable:!0}):r,t)),o1=t=>vb(jc({},"__esModule",{value:!0}),t);var aa=b(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.regexpCode=he.getEsmExportName=he.getProperty=he.safeStringify=he.stringify=he.strConcat=he.addCodeArg=he.str=he._=he.nil=he._Code=he.Name=he.IDENTIFIER=he._CodeOrName=void 0;var ia=class{};he._CodeOrName=ia;he.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Wn=class extends ia{constructor(e){if(super(),!he.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};he.Name=Wn;var Jt=class extends ia{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof Wn&&(r[n.str]=(r[n.str]||0)+1),r),{})}};he._Code=Jt;he.nil=new Jt("");function Nw(t,...e){let r=[t[0]],n=0;for(;n<e.length;)Xh(r,e[n]),r.push(t[++n]);return new Jt(r)}he._=Nw;var Kh=new Jt("+");function Rw(t,...e){let r=[sa(t[0])],n=0;for(;n<e.length;)r.push(Kh),Xh(r,e[n]),r.push(Kh,sa(t[++n]));return Zj(r),new Jt(r)}he.str=Rw;function Xh(t,e){e instanceof Jt?t.push(...e._items):e instanceof Wn?t.push(e):t.push(Bj(e))}he.addCodeArg=Xh;function Zj(t){let e=1;for(;e<t.length-1;){if(t[e]===Kh){let r=Fj(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function Fj(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof Wn||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof Wn))return`"${t}${e.slice(1)}`}function Vj(t,e){return e.emptyStr()?t:t.emptyStr()?e:Rw`${t}${e}`}he.strConcat=Vj;function Bj(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:sa(Array.isArray(t)?t.join(","):t)}function Hj(t){return new Jt(sa(t))}he.stringify=Hj;function sa(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}he.safeStringify=sa;function Gj(t){return typeof t=="string"&&he.IDENTIFIER.test(t)?new Jt(`.${t}`):Nw`[${t}]`}he.getProperty=Gj;function Wj(t){if(typeof t=="string"&&he.IDENTIFIER.test(t))return new Jt(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}he.getEsmExportName=Wj;function Jj(t){return new Jt(t.toString())}he.regexpCode=Jj});var eg=b(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.ValueScope=It.ValueScopeName=It.Scope=It.varKinds=It.UsedValueState=void 0;var Pt=aa(),Yh=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Qu;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Qu||(It.UsedValueState=Qu={}));It.varKinds={const:new Pt.Name("const"),let:new Pt.Name("let"),var:new Pt.Name("var")};var el=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Pt.Name?e:this.name(e)}name(e){return new Pt.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};It.Scope=el;var tl=class extends Pt.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Pt._)`.${new Pt.Name(r)}[${n}]`}};It.ValueScopeName=tl;var Kj=(0,Pt._)`\n`,Qh=class extends el{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?Kj:Pt.nil}}get(){return this._scope}name(e){return new tl(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:i}=o,s=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let l=a.get(s);if(l)return l}else a=this._values[i]=new Map;a.set(s,o);let c=this._scope[i]||(this._scope[i]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:i,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Pt._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let i=Pt.nil;for(let s in e){let a=e[s];if(!a)continue;let c=n[s]=n[s]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,Qu.Started);let l=r(u);if(l){let d=this.opts.es5?It.varKinds.var:It.varKinds.const;i=(0,Pt._)`${i}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))i=(0,Pt._)`${i}${l}${this.opts._n}`;else throw new Yh(u);c.set(u,Qu.Completed)})}return i}};It.ValueScope=Qh});var re=b(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.or=ee.and=ee.not=ee.CodeGen=ee.operators=ee.varKinds=ee.ValueScopeName=ee.ValueScope=ee.Scope=ee.Name=ee.regexpCode=ee.stringify=ee.getProperty=ee.nil=ee.strConcat=ee.str=ee._=void 0;var le=aa(),lr=eg(),vn=aa();Object.defineProperty(ee,"_",{enumerable:!0,get:function(){return vn._}});Object.defineProperty(ee,"str",{enumerable:!0,get:function(){return vn.str}});Object.defineProperty(ee,"strConcat",{enumerable:!0,get:function(){return vn.strConcat}});Object.defineProperty(ee,"nil",{enumerable:!0,get:function(){return vn.nil}});Object.defineProperty(ee,"getProperty",{enumerable:!0,get:function(){return vn.getProperty}});Object.defineProperty(ee,"stringify",{enumerable:!0,get:function(){return vn.stringify}});Object.defineProperty(ee,"regexpCode",{enumerable:!0,get:function(){return vn.regexpCode}});Object.defineProperty(ee,"Name",{enumerable:!0,get:function(){return vn.Name}});var il=eg();Object.defineProperty(ee,"Scope",{enumerable:!0,get:function(){return il.Scope}});Object.defineProperty(ee,"ValueScope",{enumerable:!0,get:function(){return il.ValueScope}});Object.defineProperty(ee,"ValueScopeName",{enumerable:!0,get:function(){return il.ValueScopeName}});Object.defineProperty(ee,"varKinds",{enumerable:!0,get:function(){return il.varKinds}});ee.operators={GT:new le._Code(">"),GTE:new le._Code(">="),LT:new le._Code("<"),LTE:new le._Code("<="),EQ:new le._Code("==="),NEQ:new le._Code("!=="),NOT:new le._Code("!"),OR:new le._Code("||"),AND:new le._Code("&&"),ADD:new le._Code("+")};var Fr=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},tg=class extends Fr{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?lr.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=ri(this.rhs,e,r)),this}get names(){return this.rhs instanceof le._CodeOrName?this.rhs.names:{}}},rl=class extends Fr{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof le.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=ri(this.rhs,e,r),this}get names(){let e=this.lhs instanceof le.Name?{}:{...this.lhs.names};return ol(e,this.rhs)}},rg=class extends rl{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},ng=class extends Fr{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},og=class extends Fr{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},ig=class extends Fr{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},sg=class extends Fr{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=ri(this.code,e,r),this}get names(){return this.code instanceof le._CodeOrName?this.code.names:{}}},ca=class extends Fr{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let i=n[o];i.optimizeNames(e,r)||(Xj(e,i.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>Xn(e,r.names),{})}},Vr=class extends ca{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},ag=class extends ca{},ti=class extends Vr{};ti.kind="else";var Jn=class t extends Vr{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new ti(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(Aw(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=ri(this.condition,e,r),this}get names(){let e=super.names;return ol(e,this.condition),this.else&&Xn(e,this.else.names),e}};Jn.kind="if";var Kn=class extends Vr{};Kn.kind="for";var cg=class extends Kn{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=ri(this.iteration,e,r),this}get names(){return Xn(super.names,this.iteration.names)}},ug=class extends Kn{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?lr.varKinds.var:this.varKind,{name:n,from:o,to:i}=this;return`for(${r} ${n}=${o}; ${n}<${i}; ${n}++)`+super.render(e)}get names(){let e=ol(super.names,this.from);return ol(e,this.to)}},nl=class extends Kn{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=ri(this.iterable,e,r),this}get names(){return Xn(super.names,this.iterable.names)}},ua=class extends Vr{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};ua.kind="func";var la=class extends ca{render(e){return"return "+super.render(e)}};la.kind="return";var lg=class extends Vr{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&Xn(e,this.catch.names),this.finally&&Xn(e,this.finally.names),e}},da=class extends Vr{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};da.kind="catch";var pa=class extends Vr{render(e){return"finally"+super.render(e)}};pa.kind="finally";var dg=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new lr.Scope({parent:e}),this._nodes=[new ag]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let i=this._scope.toName(r);return n!==void 0&&o&&(this._constants[i.str]=n),this._leafNode(new tg(e,i,n)),i}const(e,r,n){return this._def(lr.varKinds.const,e,r,n)}let(e,r,n){return this._def(lr.varKinds.let,e,r,n)}var(e,r,n){return this._def(lr.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new rl(e,r,n))}add(e,r){return this._leafNode(new rg(e,ee.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==le.nil&&this._leafNode(new sg(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,le.addCodeArg)(r,o));return r.push("}"),new le._Code(r)}if(e,r,n){if(this._blockNode(new Jn(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new Jn(e))}else(){return this._elseNode(new ti)}endIf(){return this._endBlockNode(Jn,ti)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new cg(e),r)}forRange(e,r,n,o,i=this.opts.es5?lr.varKinds.var:lr.varKinds.let){let s=this._scope.toName(e);return this._for(new ug(i,s,r,n),()=>o(s))}forOf(e,r,n,o=lr.varKinds.const){let i=this._scope.toName(e);if(this.opts.es5){let s=r instanceof le.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,le._)`${s}.length`,a=>{this.var(i,(0,le._)`${s}[${a}]`),n(i)})}return this._for(new nl("of",o,i,r),()=>n(i))}forIn(e,r,n,o=this.opts.es5?lr.varKinds.var:lr.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,le._)`Object.keys(${r})`,n);let i=this._scope.toName(e);return this._for(new nl("in",o,i,r),()=>n(i))}endFor(){return this._endBlockNode(Kn)}label(e){return this._leafNode(new ng(e))}break(e){return this._leafNode(new og(e))}return(e){let r=new la;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(la)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new lg;if(this._blockNode(o),this.code(e),r){let i=this.name("e");this._currNode=o.catch=new da(i),r(i)}return n&&(this._currNode=o.finally=new pa,this.code(n)),this._endBlockNode(da,pa)}throw(e){return this._leafNode(new ig(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=le.nil,n,o){return this._blockNode(new ua(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(ua)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof Jn))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};ee.CodeGen=dg;function Xn(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function ol(t,e){return e instanceof le._CodeOrName?Xn(t,e.names):t}function ri(t,e,r){if(t instanceof le.Name)return n(t);if(!o(t))return t;return new le._Code(t._items.reduce((i,s)=>(s instanceof le.Name&&(s=n(s)),s instanceof le._Code?i.push(...s._items):i.push(s),i),[]));function n(i){let s=r[i.str];return s===void 0||e[i.str]!==1?i:(delete e[i.str],s)}function o(i){return i instanceof le._Code&&i._items.some(s=>s instanceof le.Name&&e[s.str]===1&&r[s.str]!==void 0)}}function Xj(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function Aw(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,le._)`!${pg(t)}`}ee.not=Aw;var Yj=Mw(ee.operators.AND);function Qj(...t){return t.reduce(Yj)}ee.and=Qj;var eN=Mw(ee.operators.OR);function tN(...t){return t.reduce(eN)}ee.or=tN;function Mw(t){return(e,r)=>e===le.nil?r:r===le.nil?e:(0,le._)`${pg(e)} ${t} ${pg(r)}`}function pg(t){return t instanceof le.Name?t:(0,le._)`(${t})`}});var ge=b(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.checkStrictMode=ne.getErrorPath=ne.Type=ne.useFunc=ne.setEvaluated=ne.evaluatedPropsToName=ne.mergeEvaluated=ne.eachItem=ne.unescapeJsonPointer=ne.escapeJsonPointer=ne.escapeFragment=ne.unescapeFragment=ne.schemaRefOrVal=ne.schemaHasRulesButRef=ne.schemaHasRules=ne.checkUnknownRules=ne.alwaysValidSchema=ne.toHash=void 0;var ze=re(),rN=aa();function nN(t){let e={};for(let r of t)e[r]=!0;return e}ne.toHash=nN;function oN(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(qw(t,e),!Lw(e,t.self.RULES.all))}ne.alwaysValidSchema=oN;function qw(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let i in e)o[i]||Vw(t,`unknown keyword: "${i}"`)}ne.checkUnknownRules=qw;function Lw(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}ne.schemaHasRules=Lw;function iN(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}ne.schemaHasRulesButRef=iN;function sN({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,ze._)`${r}`}return(0,ze._)`${t}${e}${(0,ze.getProperty)(n)}`}ne.schemaRefOrVal=sN;function aN(t){return Zw(decodeURIComponent(t))}ne.unescapeFragment=aN;function cN(t){return encodeURIComponent(mg(t))}ne.escapeFragment=cN;function mg(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}ne.escapeJsonPointer=mg;function Zw(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}ne.unescapeJsonPointer=Zw;function uN(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}ne.eachItem=uN;function Dw({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,i,s,a)=>{let c=s===void 0?i:s instanceof ze.Name?(i instanceof ze.Name?t(o,i,s):e(o,i,s),s):i instanceof ze.Name?(e(o,s,i),i):r(i,s);return a===ze.Name&&!(c instanceof ze.Name)?n(o,c):c}}ne.mergeEvaluated={props:Dw({mergeNames:(t,e,r)=>t.if((0,ze._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,ze._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,ze._)`${r} || {}`).code((0,ze._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,ze._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,ze._)`${r} || {}`),hg(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:Fw}),items:Dw({mergeNames:(t,e,r)=>t.if((0,ze._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,ze._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,ze._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,ze._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function Fw(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,ze._)`{}`);return e!==void 0&&hg(t,r,e),r}ne.evaluatedPropsToName=Fw;function hg(t,e,r){Object.keys(r).forEach(n=>t.assign((0,ze._)`${e}${(0,ze.getProperty)(n)}`,!0))}ne.setEvaluated=hg;var Uw={};function lN(t,e){return t.scopeValue("func",{ref:e,code:Uw[e.code]||(Uw[e.code]=new rN._Code(e.code))})}ne.useFunc=lN;var fg;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(fg||(ne.Type=fg={}));function dN(t,e,r){if(t instanceof ze.Name){let n=e===fg.Num;return r?n?(0,ze._)`"[" + ${t} + "]"`:(0,ze._)`"['" + ${t} + "']"`:n?(0,ze._)`"/" + ${t}`:(0,ze._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,ze.getProperty)(t).toString():"/"+mg(t)}ne.getErrorPath=dN;function Vw(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}ne.checkStrictMode=Vw});var Br=b(gg=>{"use strict";Object.defineProperty(gg,"__esModule",{value:!0});var ct=re(),pN={data:new ct.Name("data"),valCxt:new ct.Name("valCxt"),instancePath:new ct.Name("instancePath"),parentData:new ct.Name("parentData"),parentDataProperty:new ct.Name("parentDataProperty"),rootData:new ct.Name("rootData"),dynamicAnchors:new ct.Name("dynamicAnchors"),vErrors:new ct.Name("vErrors"),errors:new ct.Name("errors"),this:new ct.Name("this"),self:new ct.Name("self"),scope:new ct.Name("scope"),json:new ct.Name("json"),jsonPos:new ct.Name("jsonPos"),jsonLen:new ct.Name("jsonLen"),jsonPart:new ct.Name("jsonPart")};gg.default=pN});var fa=b(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.extendErrors=ut.resetErrorsCount=ut.reportExtraError=ut.reportError=ut.keyword$DataError=ut.keywordError=void 0;var fe=re(),sl=ge(),_t=Br();ut.keywordError={message:({keyword:t})=>(0,fe.str)`must pass "${t}" keyword validation`};ut.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,fe.str)`"${t}" keyword must be ${e} ($data)`:(0,fe.str)`"${t}" keyword is invalid ($data)`};function fN(t,e=ut.keywordError,r,n){let{it:o}=t,{gen:i,compositeRule:s,allErrors:a}=o,c=Gw(t,e,r);n??(s||a)?Bw(i,c):Hw(o,(0,fe._)`[${c}]`)}ut.reportError=fN;function mN(t,e=ut.keywordError,r){let{it:n}=t,{gen:o,compositeRule:i,allErrors:s}=n,a=Gw(t,e,r);Bw(o,a),i||s||Hw(n,_t.default.vErrors)}ut.reportExtraError=mN;function hN(t,e){t.assign(_t.default.errors,e),t.if((0,fe._)`${_t.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,fe._)`${_t.default.vErrors}.length`,e),()=>t.assign(_t.default.vErrors,null)))}ut.resetErrorsCount=hN;function gN({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:i}){if(o===void 0)throw new Error("ajv implementation error");let s=t.name("err");t.forRange("i",o,_t.default.errors,a=>{t.const(s,(0,fe._)`${_t.default.vErrors}[${a}]`),t.if((0,fe._)`${s}.instancePath === undefined`,()=>t.assign((0,fe._)`${s}.instancePath`,(0,fe.strConcat)(_t.default.instancePath,i.errorPath))),t.assign((0,fe._)`${s}.schemaPath`,(0,fe.str)`${i.errSchemaPath}/${e}`),i.opts.verbose&&(t.assign((0,fe._)`${s}.schema`,r),t.assign((0,fe._)`${s}.data`,n))})}ut.extendErrors=gN;function Bw(t,e){let r=t.const("err",e);t.if((0,fe._)`${_t.default.vErrors} === null`,()=>t.assign(_t.default.vErrors,(0,fe._)`[${r}]`),(0,fe._)`${_t.default.vErrors}.push(${r})`),t.code((0,fe._)`${_t.default.errors}++`)}function Hw(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,fe._)`new ${t.ValidationError}(${e})`):(r.assign((0,fe._)`${n}.errors`,e),r.return(!1))}var Yn={keyword:new fe.Name("keyword"),schemaPath:new fe.Name("schemaPath"),params:new fe.Name("params"),propertyName:new fe.Name("propertyName"),message:new fe.Name("message"),schema:new fe.Name("schema"),parentSchema:new fe.Name("parentSchema")};function Gw(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,fe._)`{}`:vN(t,e,r)}function vN(t,e,r={}){let{gen:n,it:o}=t,i=[yN(o,r),_N(t,r)];return bN(t,e,i),n.object(...i)}function yN({errorPath:t},{instancePath:e}){let r=e?(0,fe.str)`${t}${(0,sl.getErrorPath)(e,sl.Type.Str)}`:t;return[_t.default.instancePath,(0,fe.strConcat)(_t.default.instancePath,r)]}function _N({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,fe.str)`${e}/${t}`;return r&&(o=(0,fe.str)`${o}${(0,sl.getErrorPath)(r,sl.Type.Str)}`),[Yn.schemaPath,o]}function bN(t,{params:e,message:r},n){let{keyword:o,data:i,schemaValue:s,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([Yn.keyword,o],[Yn.params,typeof e=="function"?e(t):e||(0,fe._)`{}`]),c.messages&&n.push([Yn.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([Yn.schema,s],[Yn.parentSchema,(0,fe._)`${l}${d}`],[_t.default.data,i]),u&&n.push([Yn.propertyName,u])}});var Jw=b(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.boolOrEmptySchema=ni.topBoolOrEmptySchema=void 0;var xN=fa(),$N=re(),wN=Br(),kN={message:"boolean schema is false"};function SN(t){let{gen:e,schema:r,validateName:n}=t;r===!1?Ww(t,!1):typeof r=="object"&&r.$async===!0?e.return(wN.default.data):(e.assign((0,$N._)`${n}.errors`,null),e.return(!0))}ni.topBoolOrEmptySchema=SN;function PN(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),Ww(t)):r.var(e,!0)}ni.boolOrEmptySchema=PN;function Ww(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,xN.reportError)(o,kN,void 0,e)}});var vg=b(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.getRules=oi.isJSONType=void 0;var IN=["string","number","integer","boolean","null","object","array"],EN=new Set(IN);function zN(t){return typeof t=="string"&&EN.has(t)}oi.isJSONType=zN;function TN(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}oi.getRules=TN});var yg=b(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.shouldUseRule=yn.shouldUseGroup=yn.schemaHasRulesForType=void 0;function CN({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&Kw(t,n)}yn.schemaHasRulesForType=CN;function Kw(t,e){return e.rules.some(r=>Xw(t,r))}yn.shouldUseGroup=Kw;function Xw(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}yn.shouldUseRule=Xw});var ma=b(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.reportTypeError=lt.checkDataTypes=lt.checkDataType=lt.coerceAndCheckDataType=lt.getJSONTypes=lt.getSchemaTypes=lt.DataType=void 0;var ON=vg(),jN=yg(),NN=fa(),W=re(),Yw=ge(),ii;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(ii||(lt.DataType=ii={}));function RN(t){let e=Qw(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}lt.getSchemaTypes=RN;function Qw(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(ON.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}lt.getJSONTypes=Qw;function AN(t,e){let{gen:r,data:n,opts:o}=t,i=MN(e,o.coerceTypes),s=e.length>0&&!(i.length===0&&e.length===1&&(0,jN.schemaHasRulesForType)(t,e[0]));if(s){let a=bg(e,n,o.strictNumbers,ii.Wrong);r.if(a,()=>{i.length?DN(t,e,i):xg(t)})}return s}lt.coerceAndCheckDataType=AN;var e0=new Set(["string","number","integer","boolean","null"]);function MN(t,e){return e?t.filter(r=>e0.has(r)||e==="array"&&r==="array"):[]}function DN(t,e,r){let{gen:n,data:o,opts:i}=t,s=n.let("dataType",(0,W._)`typeof ${o}`),a=n.let("coerced",(0,W._)`undefined`);i.coerceTypes==="array"&&n.if((0,W._)`${s} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,W._)`${o}[0]`).assign(s,(0,W._)`typeof ${o}`).if(bg(e,o,i.strictNumbers),()=>n.assign(a,o))),n.if((0,W._)`${a} !== undefined`);for(let u of r)(e0.has(u)||u==="array"&&i.coerceTypes==="array")&&c(u);n.else(),xg(t),n.endIf(),n.if((0,W._)`${a} !== undefined`,()=>{n.assign(o,a),UN(t,a)});function c(u){switch(u){case"string":n.elseIf((0,W._)`${s} == "number" || ${s} == "boolean"`).assign(a,(0,W._)`"" + ${o}`).elseIf((0,W._)`${o} === null`).assign(a,(0,W._)`""`);return;case"number":n.elseIf((0,W._)`${s} == "boolean" || ${o} === null
              || (${s} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,W._)`+${o}`);return;case"integer":n.elseIf((0,W._)`${s} === "boolean" || ${o} === null
              || (${s} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,W._)`+${o}`);return;case"boolean":n.elseIf((0,W._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,W._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,W._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,W._)`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${o} === null`).assign(a,(0,W._)`[${o}]`)}}}function UN({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,W._)`${e} !== undefined`,()=>t.assign((0,W._)`${e}[${r}]`,n))}function _g(t,e,r,n=ii.Correct){let o=n===ii.Correct?W.operators.EQ:W.operators.NEQ,i;switch(t){case"null":return(0,W._)`${e} ${o} null`;case"array":i=(0,W._)`Array.isArray(${e})`;break;case"object":i=(0,W._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":i=s((0,W._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":i=s();break;default:return(0,W._)`typeof ${e} ${o} ${t}`}return n===ii.Correct?i:(0,W.not)(i);function s(a=W.nil){return(0,W.and)((0,W._)`typeof ${e} == "number"`,a,r?(0,W._)`isFinite(${e})`:W.nil)}}lt.checkDataType=_g;function bg(t,e,r,n){if(t.length===1)return _g(t[0],e,r,n);let o,i=(0,Yw.toHash)(t);if(i.array&&i.object){let s=(0,W._)`typeof ${e} != "object"`;o=i.null?s:(0,W._)`!${e} || ${s}`,delete i.null,delete i.array,delete i.object}else o=W.nil;i.number&&delete i.integer;for(let s in i)o=(0,W.and)(o,_g(s,e,r,n));return o}lt.checkDataTypes=bg;var qN={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,W._)`{type: ${t}}`:(0,W._)`{type: ${e}}`};function xg(t){let e=LN(t);(0,NN.reportError)(e,qN)}lt.reportTypeError=xg;function LN(t){let{gen:e,data:r,schema:n}=t,o=(0,Yw.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var r0=b(al=>{"use strict";Object.defineProperty(al,"__esModule",{value:!0});al.assignDefaults=void 0;var si=re(),ZN=ge();function FN(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)t0(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,i)=>t0(t,i,o.default))}al.assignDefaults=FN;function t0(t,e,r){let{gen:n,compositeRule:o,data:i,opts:s}=t;if(r===void 0)return;let a=(0,si._)`${i}${(0,si.getProperty)(e)}`;if(o){(0,ZN.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,si._)`${a} === undefined`;s.useDefaults==="empty"&&(c=(0,si._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,si._)`${a} = ${(0,si.stringify)(r)}`)}});var Kt=b(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.validateUnion=we.validateArray=we.usePattern=we.callValidateCode=we.schemaProperties=we.allSchemaProperties=we.noPropertyInData=we.propertyInData=we.isOwnProperty=we.hasPropFunc=we.reportMissingProp=we.checkMissingProp=we.checkReportMissingProp=void 0;var Re=re(),$g=ge(),_n=Br(),VN=ge();function BN(t,e){let{gen:r,data:n,it:o}=t;r.if(kg(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,Re._)`${e}`},!0),t.error()})}we.checkReportMissingProp=BN;function HN({gen:t,data:e,it:{opts:r}},n,o){return(0,Re.or)(...n.map(i=>(0,Re.and)(kg(t,e,i,r.ownProperties),(0,Re._)`${o} = ${i}`)))}we.checkMissingProp=HN;function GN(t,e){t.setParams({missingProperty:e},!0),t.error()}we.reportMissingProp=GN;function n0(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,Re._)`Object.prototype.hasOwnProperty`})}we.hasPropFunc=n0;function wg(t,e,r){return(0,Re._)`${n0(t)}.call(${e}, ${r})`}we.isOwnProperty=wg;function WN(t,e,r,n){let o=(0,Re._)`${e}${(0,Re.getProperty)(r)} !== undefined`;return n?(0,Re._)`${o} && ${wg(t,e,r)}`:o}we.propertyInData=WN;function kg(t,e,r,n){let o=(0,Re._)`${e}${(0,Re.getProperty)(r)} === undefined`;return n?(0,Re.or)(o,(0,Re.not)(wg(t,e,r))):o}we.noPropertyInData=kg;function o0(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}we.allSchemaProperties=o0;function JN(t,e){return o0(e).filter(r=>!(0,$g.alwaysValidSchema)(t,e[r]))}we.schemaProperties=JN;function KN({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:i},it:s},a,c,u){let l=u?(0,Re._)`${t}, ${e}, ${n}${o}`:e,d=[[_n.default.instancePath,(0,Re.strConcat)(_n.default.instancePath,i)],[_n.default.parentData,s.parentData],[_n.default.parentDataProperty,s.parentDataProperty],[_n.default.rootData,_n.default.rootData]];s.opts.dynamicRef&&d.push([_n.default.dynamicAnchors,_n.default.dynamicAnchors]);let p=(0,Re._)`${l}, ${r.object(...d)}`;return c!==Re.nil?(0,Re._)`${a}.call(${c}, ${p})`:(0,Re._)`${a}(${p})`}we.callValidateCode=KN;var XN=(0,Re._)`new RegExp`;function YN({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,i=o(r,n);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,Re._)`${o.code==="new RegExp"?XN:(0,VN.useFunc)(t,o)}(${r}, ${n})`})}we.usePattern=YN;function QN(t){let{gen:e,data:r,keyword:n,it:o}=t,i=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(i,!0),s(()=>e.break()),i;function s(a){let c=e.const("len",(0,Re._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:$g.Type.Num},i),e.if((0,Re.not)(i),a)})}}we.validateArray=QN;function eR(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,$g.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let s=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(s,(0,Re._)`${s} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,Re.not)(s))})),t.result(s,()=>t.reset(),()=>t.error(!0))}we.validateUnion=eR});var a0=b(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.validateKeywordUsage=Sr.validSchemaType=Sr.funcKeywordCode=Sr.macroKeywordCode=void 0;var bt=re(),Qn=Br(),tR=Kt(),rR=fa();function nR(t,e){let{gen:r,keyword:n,schema:o,parentSchema:i,it:s}=t,a=e.macro.call(s.self,o,i,s),c=s0(r,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:bt.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}Sr.macroKeywordCode=nR;function oR(t,e){var r;let{gen:n,keyword:o,schema:i,parentSchema:s,$data:a,it:c}=t;sR(c,e);let u=!a&&e.compile?e.compile.call(c.self,i,s,c):e.validate,l=s0(n,o,u),d=n.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)m(),e.modifying&&i0(t),g(()=>t.error());else{let v=e.async?f():h();e.modifying&&i0(t),g(()=>iR(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>m((0,bt._)`await `),x=>n.assign(d,!1).if((0,bt._)`${x} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,bt._)`${x}.errors`),()=>n.throw(x))),v}function h(){let v=(0,bt._)`${l}.errors`;return n.assign(v,null),m(bt.nil),v}function m(v=e.async?(0,bt._)`await `:bt.nil){let x=c.opts.passContext?Qn.default.this:Qn.default.self,w=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,bt._)`${v}${(0,tR.callValidateCode)(t,l,x,w)}`,e.modifying)}function g(v){var x;n.if((0,bt.not)((x=e.valid)!==null&&x!==void 0?x:d),v)}}Sr.funcKeywordCode=oR;function i0(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,bt._)`${n.parentData}[${n.parentDataProperty}]`))}function iR(t,e){let{gen:r}=t;r.if((0,bt._)`Array.isArray(${e})`,()=>{r.assign(Qn.default.vErrors,(0,bt._)`${Qn.default.vErrors} === null ? ${e} : ${Qn.default.vErrors}.concat(${e})`).assign(Qn.default.errors,(0,bt._)`${Qn.default.vErrors}.length`),(0,rR.extendErrors)(t)},()=>t.error())}function sR({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function s0(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,bt.stringify)(r)})}function aR(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}Sr.validSchemaType=aR;function cR({schema:t,opts:e,self:r,errSchemaPath:n},o,i){if(Array.isArray(o.keyword)?!o.keyword.includes(i):o.keyword!==i)throw new Error("ajv implementation error");let s=o.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${i}: ${s.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[i])){let c=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}Sr.validateKeywordUsage=cR});var u0=b(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.extendSubschemaMode=bn.extendSubschemaData=bn.getSubschema=void 0;var Pr=re(),c0=ge();function uR(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:i,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,Pr._)`${t.schemaPath}${(0,Pr.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,Pr._)`${t.schemaPath}${(0,Pr.getProperty)(e)}${(0,Pr.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,c0.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||i===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:s,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}bn.getSubschema=uR;function lR(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:i,propertyName:s}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,p=a.let("data",(0,Pr._)`${e.data}${(0,Pr.getProperty)(r)}`,!0);c(p),t.errorPath=(0,Pr.str)`${u}${(0,c0.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,Pr._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof Pr.Name?o:a.let("data",o,!0);c(u),s!==void 0&&(t.propertyName=s)}i&&(t.dataTypes=i);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}bn.extendSubschemaData=lR;function dR(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:i}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),i!==void 0&&(t.allErrors=i),t.jtdDiscriminator=e,t.jtdMetadata=r}bn.extendSubschemaMode=dR});var ha=b((NK,l0)=>{"use strict";l0.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,i;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,i[o]))return!1;for(o=n;o--!==0;){var s=i[o];if(!t(e[s],r[s]))return!1}return!0}return e!==e&&r!==r}});var p0=b((RK,d0)=>{"use strict";var xn=d0.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};cl(e,n,o,t,"",t)};xn.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};xn.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};xn.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};xn.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function cl(t,e,r,n,o,i,s,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,i,s,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in xn.arrayKeywords)for(var p=0;p<d.length;p++)cl(t,e,r,d[p],o+"/"+l+"/"+p,i,o,l,n,p)}else if(l in xn.propsKeywords){if(d&&typeof d=="object")for(var f in d)cl(t,e,r,d[f],o+"/"+l+"/"+pR(f),i,o,l,n,f)}else(l in xn.keywords||t.allKeys&&!(l in xn.skipKeywords))&&cl(t,e,r,d,o+"/"+l,i,o,l,n)}r(n,o,i,s,a,c,u)}}function pR(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var ga=b(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.getSchemaRefs=Et.resolveUrl=Et.normalizeId=Et._getFullPath=Et.getFullPath=Et.inlineRef=void 0;var fR=ge(),mR=ha(),hR=p0(),gR=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function vR(t,e=!0){return typeof t=="boolean"?!0:e===!0?!Sg(t):e?f0(t)<=e:!1}Et.inlineRef=vR;var yR=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Sg(t){for(let e in t){if(yR.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(Sg)||typeof r=="object"&&Sg(r))return!0}return!1}function f0(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!gR.has(r)&&(typeof t[r]=="object"&&(0,fR.eachItem)(t[r],n=>e+=f0(n)),e===1/0))return 1/0}return e}function m0(t,e="",r){r!==!1&&(e=ai(e));let n=t.parse(e);return h0(t,n)}Et.getFullPath=m0;function h0(t,e){return t.serialize(e).split("#")[0]+"#"}Et._getFullPath=h0;var _R=/#\/?$/;function ai(t){return t?t.replace(_R,""):""}Et.normalizeId=ai;function bR(t,e,r){return r=ai(r),t.resolve(e,r)}Et.resolveUrl=bR;var xR=/^[a-z_][-a-z0-9._]*$/i;function $R(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=ai(t[r]||e),i={"":o},s=m0(n,o,!1),a={},c=new Set;return hR(t,{allKeys:!0},(d,p,f,h)=>{if(h===void 0)return;let m=s+p,g=i[h];typeof d[r]=="string"&&(g=v.call(this,d[r])),x.call(this,d.$anchor),x.call(this,d.$dynamicAnchor),i[p]=g;function v(w){let I=this.opts.uriResolver.resolve;if(w=ai(g?I(g,w):w),c.has(w))throw l(w);c.add(w);let k=this.refs[w];return typeof k=="string"&&(k=this.refs[k]),typeof k=="object"?u(d,k.schema,w):w!==ai(m)&&(w[0]==="#"?(u(d,a[w],w),a[w]=d):this.refs[w]=m),w}function x(w){if(typeof w=="string"){if(!xR.test(w))throw new Error(`invalid anchor "${w}"`);v.call(this,`#${w}`)}}}),a;function u(d,p,f){if(p!==void 0&&!mR(d,p))throw l(f)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}Et.getSchemaRefs=$R});var _a=b($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.getData=$n.KeywordCxt=$n.validateFunctionCode=void 0;var b0=Jw(),g0=ma(),Ig=yg(),ul=ma(),wR=r0(),ya=a0(),Pg=u0(),R=re(),V=Br(),kR=ga(),Hr=ge(),va=fa();function SR(t){if(w0(t)&&(k0(t),$0(t))){ER(t);return}x0(t,()=>(0,b0.topBoolOrEmptySchema)(t))}$n.validateFunctionCode=SR;function x0({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},i){o.code.es5?t.func(e,(0,R._)`${V.default.data}, ${V.default.valCxt}`,n.$async,()=>{t.code((0,R._)`"use strict"; ${v0(r,o)}`),IR(t,o),t.code(i)}):t.func(e,(0,R._)`${V.default.data}, ${PR(o)}`,n.$async,()=>t.code(v0(r,o)).code(i))}function PR(t){return(0,R._)`{${V.default.instancePath}="", ${V.default.parentData}, ${V.default.parentDataProperty}, ${V.default.rootData}=${V.default.data}${t.dynamicRef?(0,R._)`, ${V.default.dynamicAnchors}={}`:R.nil}}={}`}function IR(t,e){t.if(V.default.valCxt,()=>{t.var(V.default.instancePath,(0,R._)`${V.default.valCxt}.${V.default.instancePath}`),t.var(V.default.parentData,(0,R._)`${V.default.valCxt}.${V.default.parentData}`),t.var(V.default.parentDataProperty,(0,R._)`${V.default.valCxt}.${V.default.parentDataProperty}`),t.var(V.default.rootData,(0,R._)`${V.default.valCxt}.${V.default.rootData}`),e.dynamicRef&&t.var(V.default.dynamicAnchors,(0,R._)`${V.default.valCxt}.${V.default.dynamicAnchors}`)},()=>{t.var(V.default.instancePath,(0,R._)`""`),t.var(V.default.parentData,(0,R._)`undefined`),t.var(V.default.parentDataProperty,(0,R._)`undefined`),t.var(V.default.rootData,V.default.data),e.dynamicRef&&t.var(V.default.dynamicAnchors,(0,R._)`{}`)})}function ER(t){let{schema:e,opts:r,gen:n}=t;x0(t,()=>{r.$comment&&e.$comment&&P0(t),jR(t),n.let(V.default.vErrors,null),n.let(V.default.errors,0),r.unevaluated&&zR(t),S0(t),AR(t)})}function zR(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,R._)`${r}.evaluated`),e.if((0,R._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,R._)`${t.evaluated}.props`,(0,R._)`undefined`)),e.if((0,R._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,R._)`${t.evaluated}.items`,(0,R._)`undefined`))}function v0(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,R._)`/*# sourceURL=${r} */`:R.nil}function TR(t,e){if(w0(t)&&(k0(t),$0(t))){CR(t,e);return}(0,b0.boolOrEmptySchema)(t,e)}function $0({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function w0(t){return typeof t.schema!="boolean"}function CR(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&P0(t),NR(t),RR(t);let i=n.const("_errs",V.default.errors);S0(t,i),n.var(e,(0,R._)`${i} === ${V.default.errors}`)}function k0(t){(0,Hr.checkUnknownRules)(t),OR(t)}function S0(t,e){if(t.opts.jtd)return y0(t,[],!1,e);let r=(0,g0.getSchemaTypes)(t.schema),n=(0,g0.coerceAndCheckDataType)(t,r);y0(t,r,!n,e)}function OR(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Hr.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function jR(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Hr.checkStrictMode)(t,"default is ignored in the schema root")}function NR(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,kR.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function RR(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function P0({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let i=r.$comment;if(o.$comment===!0)t.code((0,R._)`${V.default.self}.logger.log(${i})`);else if(typeof o.$comment=="function"){let s=(0,R.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,R._)`${V.default.self}.opts.$comment(${i}, ${s}, ${a}.schema)`)}}function AR(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:i}=t;r.$async?e.if((0,R._)`${V.default.errors} === 0`,()=>e.return(V.default.data),()=>e.throw((0,R._)`new ${o}(${V.default.vErrors})`)):(e.assign((0,R._)`${n}.errors`,V.default.vErrors),i.unevaluated&&MR(t),e.return((0,R._)`${V.default.errors} === 0`))}function MR({gen:t,evaluated:e,props:r,items:n}){r instanceof R.Name&&t.assign((0,R._)`${e}.props`,r),n instanceof R.Name&&t.assign((0,R._)`${e}.items`,n)}function y0(t,e,r,n){let{gen:o,schema:i,data:s,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(i.$ref&&(c.ignoreKeywordsWithRef||!(0,Hr.schemaHasRulesButRef)(i,l))){o.block(()=>E0(t,"$ref",l.all.$ref.definition));return}c.jtd||DR(t,e),o.block(()=>{for(let p of l.rules)d(p);d(l.post)});function d(p){(0,Ig.shouldUseGroup)(i,p)&&(p.type?(o.if((0,ul.checkDataType)(p.type,s,c.strictNumbers)),_0(t,p),e.length===1&&e[0]===p.type&&r&&(o.else(),(0,ul.reportTypeError)(t)),o.endIf()):_0(t,p),a||o.if((0,R._)`${V.default.errors} === ${n||0}`))}}function _0(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,wR.assignDefaults)(t,e.type),r.block(()=>{for(let i of e.rules)(0,Ig.shouldUseRule)(n,i)&&E0(t,i.keyword,i.definition,e.type)})}function DR(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(UR(t,e),t.opts.allowUnionTypes||qR(t,e),LR(t,t.dataTypes))}function UR(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{I0(t.dataTypes,r)||Eg(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),FR(t,e)}}function qR(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&Eg(t,"use allowUnionTypes to allow union type keyword")}function LR(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,Ig.shouldUseRule)(t.schema,o)){let{type:i}=o.definition;i.length&&!i.some(s=>ZR(e,s))&&Eg(t,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function ZR(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function I0(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function FR(t,e){let r=[];for(let n of t.dataTypes)I0(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function Eg(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Hr.checkStrictMode)(t,e,t.opts.strictTypes)}var ll=class{constructor(e,r,n){if((0,ya.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Hr.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",z0(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,ya.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",V.default.errors))}result(e,r,n){this.failResult((0,R.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,R.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,R._)`${r} !== undefined && (${(0,R.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?va.reportExtraError:va.reportError)(this,this.def.error,r)}$dataError(){(0,va.reportError)(this,this.def.$dataError||va.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,va.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=R.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=R.nil,r=R.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:i,def:s}=this;n.if((0,R.or)((0,R._)`${o} === undefined`,r)),e!==R.nil&&n.assign(e,!0),(i.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==R.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:i}=this;return(0,R.or)(s(),a());function s(){if(n.length){if(!(r instanceof R.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,R._)`${(0,ul.checkDataTypes)(c,r,i.opts.strictNumbers,ul.DataType.Wrong)}`}return R.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,R._)`!${c}(${r})`}return R.nil}}subschema(e,r){let n=(0,Pg.getSubschema)(this.it,e);(0,Pg.extendSubschemaData)(n,this.it,e),(0,Pg.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return TR(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Hr.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Hr.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,R.Name)),!0}};$n.KeywordCxt=ll;function E0(t,e,r,n){let o=new ll(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,ya.funcKeywordCode)(o,r):"macro"in r?(0,ya.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,ya.funcKeywordCode)(o,r)}var VR=/^\/(?:[^~]|~0|~1)*$/,BR=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function z0(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,i;if(t==="")return V.default.rootData;if(t[0]==="/"){if(!VR.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,i=V.default.rootData}else{let u=BR.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(i=r[e-l],!o)return i}let s=i,a=o.split("/");for(let u of a)u&&(i=(0,R._)`${i}${(0,R.getProperty)((0,Hr.unescapeJsonPointer)(u))}`,s=(0,R._)`${s} && ${i}`);return s;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}$n.getData=z0});var dl=b(Tg=>{"use strict";Object.defineProperty(Tg,"__esModule",{value:!0});var zg=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};Tg.default=zg});var ba=b(jg=>{"use strict";Object.defineProperty(jg,"__esModule",{value:!0});var Cg=ga(),Og=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,Cg.resolveUrl)(e,r,n),this.missingSchema=(0,Cg.normalizeId)((0,Cg.getFullPath)(e,this.missingRef))}};jg.default=Og});var fl=b(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.resolveSchema=Xt.getCompilingSchema=Xt.resolveRef=Xt.compileSchema=Xt.SchemaEnv=void 0;var dr=re(),HR=dl(),eo=Br(),pr=ga(),T0=ge(),GR=_a(),ci=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,pr.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};Xt.SchemaEnv=ci;function Rg(t){let e=C0.call(this,t);if(e)return e;let r=(0,pr.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:i}=this.opts,s=new dr.CodeGen(this.scope,{es5:n,lines:o,ownProperties:i}),a;t.$async&&(a=s.scopeValue("Error",{ref:HR.default,code:(0,dr._)`require("ajv/dist/runtime/validation_error").default`}));let c=s.scopeName("validate");t.validateName=c;let u={gen:s,allErrors:this.opts.allErrors,data:eo.default.data,parentData:eo.default.parentData,parentDataProperty:eo.default.parentDataProperty,dataNames:[eo.default.data],dataPathArr:[dr.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,dr.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:dr.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,dr._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,GR.validateFunctionCode)(u),s.optimize(this.opts.code.optimize);let d=s.toString();l=`${s.scopeRefs(eo.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let f=new Function(`${eo.default.self}`,`${eo.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:s._values}),this.opts.unevaluated){let{props:h,items:m}=u;f.evaluated={props:h instanceof dr.Name?void 0:h,items:m instanceof dr.Name?void 0:m,dynamicProps:h instanceof dr.Name,dynamicItems:m instanceof dr.Name},f.source&&(f.source.evaluated=(0,dr.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}Xt.compileSchema=Rg;function WR(t,e,r){var n;r=(0,pr.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let i=XR.call(this,t,r);if(i===void 0){let s=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;s&&(i=new ci({schema:s,schemaId:a,root:t,baseId:e}))}if(i!==void 0)return t.refs[r]=JR.call(this,i)}Xt.resolveRef=WR;function JR(t){return(0,pr.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:Rg.call(this,t)}function C0(t){for(let e of this._compilations)if(KR(e,t))return e}Xt.getCompilingSchema=C0;function KR(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function XR(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||pl.call(this,t,e)}function pl(t,e){let r=this.opts.uriResolver.parse(e),n=(0,pr._getFullPath)(this.opts.uriResolver,r),o=(0,pr.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return Ng.call(this,r,t);let i=(0,pr.normalizeId)(n),s=this.refs[i]||this.schemas[i];if(typeof s=="string"){let a=pl.call(this,t,s);return typeof a?.schema!="object"?void 0:Ng.call(this,r,a)}if(typeof s?.schema=="object"){if(s.validate||Rg.call(this,s),i===(0,pr.normalizeId)(e)){let{schema:a}=s,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,pr.resolveUrl)(this.opts.uriResolver,o,u)),new ci({schema:a,schemaId:c,root:t,baseId:o})}return Ng.call(this,r,s)}}Xt.resolveSchema=pl;var YR=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Ng(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,T0.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!YR.has(a)&&u&&(e=(0,pr.resolveUrl)(this.opts.uriResolver,e,u))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,T0.schemaHasRulesButRef)(r,this.RULES)){let a=(0,pr.resolveUrl)(this.opts.uriResolver,e,r.$ref);i=pl.call(this,n,a)}let{schemaId:s}=this.opts;if(i=i||new ci({schema:r,schemaId:s,root:n,baseId:e}),i.schema!==i.root.schema)return i}});var O0=b((LK,QR)=>{QR.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var Mg=b((ZK,A0)=>{"use strict";var eA=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),N0=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function Ag(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var tA=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function j0(t){return t.length=0,!0}function rA(t,e,r){if(t.length){let n=Ag(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function nA(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],i=!1,s=!1,a=rA;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(i===!0&&(s=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(i=!0),n.push(":");continue}else if(u==="%"){if(!a(o,n,r))break;a=j0}else{o.push(u);continue}}return o.length&&(a===j0?r.zone=o.join(""):s?n.push(o.join("")):n.push(Ag(o))),r.address=n.join(""),r}function R0(t){if(oA(t,":")<2)return{host:t,isIPV6:!1};let e=nA(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function oA(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function iA(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function sA(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function aA(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!N0(r)){let n=R0(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}A0.exports={nonSimpleDomain:tA,recomposeAuthority:aA,normalizeComponentEncoding:sA,removeDotSegments:iA,isIPv4:N0,isUUID:eA,normalizeIPv6:R0,stringArrayToHexStripped:Ag}});var L0=b((FK,q0)=>{"use strict";var{isUUID:cA}=Mg(),uA=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,lA=["http","https","ws","wss","urn","urn:uuid"];function dA(t){return lA.indexOf(t)!==-1}function Dg(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function M0(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function D0(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function pA(t){return t.secure=Dg(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function fA(t){if((t.port===(Dg(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function mA(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(uA);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,i=Ug(o);t.path=void 0,i&&(t=i.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function hA(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,i=Ug(o);i&&(t=i.serialize(t,e));let s=t,a=t.nss;return s.path=`${n||e.nid}:${a}`,e.skipEscape=!0,s}function gA(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!cA(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function vA(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var U0={scheme:"http",domainHost:!0,parse:M0,serialize:D0},yA={scheme:"https",domainHost:U0.domainHost,parse:M0,serialize:D0},ml={scheme:"ws",domainHost:!0,parse:pA,serialize:fA},_A={scheme:"wss",domainHost:ml.domainHost,parse:ml.parse,serialize:ml.serialize},bA={scheme:"urn",parse:mA,serialize:hA,skipNormalize:!0},xA={scheme:"urn:uuid",parse:gA,serialize:vA,skipNormalize:!0},hl={http:U0,https:yA,ws:ml,wss:_A,urn:bA,"urn:uuid":xA};Object.setPrototypeOf(hl,null);function Ug(t){return t&&(hl[t]||hl[t.toLowerCase()])||void 0}q0.exports={wsIsSecure:Dg,SCHEMES:hl,isValidSchemeName:dA,getSchemeHandler:Ug}});var Lg=b((VK,vl)=>{"use strict";var{normalizeIPv6:$A,removeDotSegments:xa,recomposeAuthority:wA,normalizeComponentEncoding:gl,isIPv4:kA,nonSimpleDomain:SA}=Mg(),{SCHEMES:PA,getSchemeHandler:Z0}=L0();function IA(t,e){return typeof t=="string"?t=Ir(Gr(t,e),e):typeof t=="object"&&(t=Gr(Ir(t,e),e)),t}function EA(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=F0(Gr(t,n),Gr(e,n),n,!0);return n.skipEscape=!0,Ir(o,n)}function F0(t,e,r,n){let o={};return n||(t=Gr(Ir(t,r),r),e=Gr(Ir(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=xa(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=xa(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=xa(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=xa(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function zA(t,e,r){return typeof t=="string"?(t=unescape(t),t=Ir(gl(Gr(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=Ir(gl(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=Ir(gl(Gr(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=Ir(gl(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function Ir(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],i=Z0(n.scheme||r.scheme);i&&i.serialize&&i.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let s=wA(r);if(s!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(s),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!i||!i.absolutePath)&&(a=xa(a)),s===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var TA=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Gr(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let i=t.match(TA);if(i){if(n.scheme=i[1],n.userinfo=i[3],n.host=i[4],n.port=parseInt(i[5],10),n.path=i[6]||"",n.query=i[7],n.fragment=i[8],isNaN(n.port)&&(n.port=i[5]),n.host)if(kA(n.host)===!1){let c=$A(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let s=Z0(r.scheme||n.scheme);if(!r.unicodeSupport&&(!s||!s.unicodeSupport)&&n.host&&(r.domainHost||s&&s.domainHost)&&o===!1&&SA(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!s||s&&!s.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),s&&s.parse&&s.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var qg={SCHEMES:PA,normalize:IA,resolve:EA,resolveComponent:F0,equal:zA,serialize:Ir,parse:Gr};vl.exports=qg;vl.exports.default=qg;vl.exports.fastUri=qg});var B0=b(Zg=>{"use strict";Object.defineProperty(Zg,"__esModule",{value:!0});var V0=Lg();V0.code='require("ajv/dist/runtime/uri").default';Zg.default=V0});var Q0=b(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.CodeGen=tt.Name=tt.nil=tt.stringify=tt.str=tt._=tt.KeywordCxt=void 0;var CA=_a();Object.defineProperty(tt,"KeywordCxt",{enumerable:!0,get:function(){return CA.KeywordCxt}});var ui=re();Object.defineProperty(tt,"_",{enumerable:!0,get:function(){return ui._}});Object.defineProperty(tt,"str",{enumerable:!0,get:function(){return ui.str}});Object.defineProperty(tt,"stringify",{enumerable:!0,get:function(){return ui.stringify}});Object.defineProperty(tt,"nil",{enumerable:!0,get:function(){return ui.nil}});Object.defineProperty(tt,"Name",{enumerable:!0,get:function(){return ui.Name}});Object.defineProperty(tt,"CodeGen",{enumerable:!0,get:function(){return ui.CodeGen}});var OA=dl(),K0=ba(),jA=vg(),$a=fl(),NA=re(),wa=ga(),yl=ma(),Vg=ge(),H0=O0(),RA=B0(),X0=(t,e)=>new RegExp(t,e);X0.code="new RegExp";var AA=["removeAdditional","useDefaults","coerceTypes"],MA=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),DA={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},UA={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},G0=200;function qA(t){var e,r,n,o,i,s,a,c,u,l,d,p,f,h,m,g,v,x,w,I,k,ie,se,Y,be;let We=t.strict,ir=(e=t.code)===null||e===void 0?void 0:e.optimize,xr=ir===!0||ir===void 0?1:ir||0,Hi=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:X0,Vd=(o=t.uriResolver)!==null&&o!==void 0?o:RA.default;return{strictSchema:(s=(i=t.strictSchema)!==null&&i!==void 0?i:We)!==null&&s!==void 0?s:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:We)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:We)!==null&&l!==void 0?l:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:We)!==null&&p!==void 0?p:"log",strictRequired:(h=(f=t.strictRequired)!==null&&f!==void 0?f:We)!==null&&h!==void 0?h:!1,code:t.code?{...t.code,optimize:xr,regExp:Hi}:{optimize:xr,regExp:Hi},loopRequired:(m=t.loopRequired)!==null&&m!==void 0?m:G0,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:G0,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:(x=t.messages)!==null&&x!==void 0?x:!0,inlineRefs:(w=t.inlineRefs)!==null&&w!==void 0?w:!0,schemaId:(I=t.schemaId)!==null&&I!==void 0?I:"$id",addUsedSchema:(k=t.addUsedSchema)!==null&&k!==void 0?k:!0,validateSchema:(ie=t.validateSchema)!==null&&ie!==void 0?ie:!0,validateFormats:(se=t.validateFormats)!==null&&se!==void 0?se:!0,unicodeRegExp:(Y=t.unicodeRegExp)!==null&&Y!==void 0?Y:!0,int32range:(be=t.int32range)!==null&&be!==void 0?be:!0,uriResolver:Vd}}var ka=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...qA(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new NA.ValueScope({scope:{},prefixes:MA,es5:r,lines:n}),this.logger=HA(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,jA.getRules)(),W0.call(this,DA,e,"NOT SUPPORTED"),W0.call(this,UA,e,"DEPRECATED","warn"),this._metaOpts=VA.call(this),e.formats&&ZA.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&FA.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),LA.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=H0;n==="id"&&(o={...H0},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await i.call(this,l.$schema);let p=this._addSchema(l,d);return p.validate||s.call(this,p)}async function i(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function s(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof K0.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),s.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await i.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let s of e)this.addSchema(s,void 0,n,o);return this}let i;if(typeof e=="object"){let{schemaId:s}=this.opts;if(i=e[s],i!==void 0&&typeof i!="string")throw new Error(`schema ${s} must be string`)}return r=(0,wa.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return o}getSchema(e){let r;for(;typeof(r=J0.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new $a.SchemaEnv({schema:{},schemaId:n});if(r=$a.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=J0.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,wa.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(WA.call(this,n,r),!r)return(0,Vg.eachItem)(n,i=>Fg.call(this,i)),this;KA.call(this,r);let o={...r,type:(0,yl.getJSONTypes)(r.type),schemaType:(0,yl.getJSONTypes)(r.schemaType)};return(0,Vg.eachItem)(n,o.type.length===0?i=>Fg.call(this,i,o):i=>o.type.forEach(s=>Fg.call(this,i,o,s))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(i=>i.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,i)=>o+r+i)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let i=o.split("/").slice(1),s=e;for(let a of i)s=s[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=s[a];u&&l&&(s[a]=Y0(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,i=this.opts.addUsedSchema){let s,{schemaId:a}=this.opts;if(typeof e=="object")s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,wa.normalizeId)(s||n);let u=wa.getSchemaRefs.call(this,e,n);return c=new $a.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):$a.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{$a.compileSchema.call(this,e)}finally{this.opts=r}}};ka.ValidationError=OA.default;ka.MissingRefError=K0.default;tt.default=ka;function W0(t,e,r,n="error"){for(let o in t){let i=o;i in e&&this.logger[n](`${r}: option ${o}. ${t[i]}`)}}function J0(t){return t=(0,wa.normalizeId)(t),this.schemas[t]||this.refs[t]}function LA(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function ZA(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function FA(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function VA(){let t={...this.opts};for(let e of AA)delete t[e];return t}var BA={log(){},warn(){},error(){}};function HA(t){if(t===!1)return BA;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var GA=/^[a-z_$][a-z0-9_$:-]*$/i;function WA(t,e){let{RULES:r}=this;if((0,Vg.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!GA.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function Fg(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,s=o?i.post:i.rules.find(({type:c})=>c===r);if(s||(s={type:r,rules:[]},i.rules.push(s)),i.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,yl.getJSONTypes)(e.type),schemaType:(0,yl.getJSONTypes)(e.schemaType)}};e.before?JA.call(this,s,a,e.before):s.rules.push(a),i.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function JA(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function KA(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=Y0(e)),t.validateSchema=this.compile(e,!0))}var XA={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Y0(t){return{anyOf:[t,XA]}}});var ek=b(Bg=>{"use strict";Object.defineProperty(Bg,"__esModule",{value:!0});var YA={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Bg.default=YA});var ok=b(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.callRef=to.getValidate=void 0;var QA=ba(),tk=Kt(),zt=re(),li=Br(),rk=fl(),_l=ge(),eM={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:i,validateName:s,opts:a,self:c}=n,{root:u}=i;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=rk.resolveRef.call(c,u,o,r);if(l===void 0)throw new QA.default(n.opts.uriResolver,o,r);if(l instanceof rk.SchemaEnv)return p(l);return f(l);function d(){if(i===u)return bl(t,s,i,i.$async);let h=e.scopeValue("root",{ref:u});return bl(t,(0,zt._)`${h}.validate`,u,u.$async)}function p(h){let m=nk(t,h);bl(t,m,h,h.$async)}function f(h){let m=e.scopeValue("schema",a.code.source===!0?{ref:h,code:(0,zt.stringify)(h)}:{ref:h}),g=e.name("valid"),v=t.subschema({schema:h,dataTypes:[],schemaPath:zt.nil,topSchemaRef:m,errSchemaPath:r},g);t.mergeEvaluated(v),t.ok(g)}}};function nk(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,zt._)`${r.scopeValue("wrapper",{ref:e})}.validate`}to.getValidate=nk;function bl(t,e,r,n){let{gen:o,it:i}=t,{allErrors:s,schemaEnv:a,opts:c}=i,u=c.passContext?li.default.this:zt.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let h=o.let("valid");o.try(()=>{o.code((0,zt._)`await ${(0,tk.callValidateCode)(t,e,u)}`),f(e),s||o.assign(h,!0)},m=>{o.if((0,zt._)`!(${m} instanceof ${i.ValidationError})`,()=>o.throw(m)),p(m),s||o.assign(h,!1)}),t.ok(h)}function d(){t.result((0,tk.callValidateCode)(t,e,u),()=>f(e),()=>p(e))}function p(h){let m=(0,zt._)`${h}.errors`;o.assign(li.default.vErrors,(0,zt._)`${li.default.vErrors} === null ? ${m} : ${li.default.vErrors}.concat(${m})`),o.assign(li.default.errors,(0,zt._)`${li.default.vErrors}.length`)}function f(h){var m;if(!i.opts.unevaluated)return;let g=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(i.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(i.props=_l.mergeEvaluated.props(o,g.props,i.props));else{let v=o.var("props",(0,zt._)`${h}.evaluated.props`);i.props=_l.mergeEvaluated.props(o,v,i.props,zt.Name)}if(i.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(i.items=_l.mergeEvaluated.items(o,g.items,i.items));else{let v=o.var("items",(0,zt._)`${h}.evaluated.items`);i.items=_l.mergeEvaluated.items(o,v,i.items,zt.Name)}}}to.callRef=bl;to.default=eM});var ik=b(Hg=>{"use strict";Object.defineProperty(Hg,"__esModule",{value:!0});var tM=ek(),rM=ok(),nM=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",tM.default,rM.default];Hg.default=nM});var sk=b(Gg=>{"use strict";Object.defineProperty(Gg,"__esModule",{value:!0});var xl=re(),wn=xl.operators,$l={maximum:{okStr:"<=",ok:wn.LTE,fail:wn.GT},minimum:{okStr:">=",ok:wn.GTE,fail:wn.LT},exclusiveMaximum:{okStr:"<",ok:wn.LT,fail:wn.GTE},exclusiveMinimum:{okStr:">",ok:wn.GT,fail:wn.LTE}},oM={message:({keyword:t,schemaCode:e})=>(0,xl.str)`must be ${$l[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,xl._)`{comparison: ${$l[t].okStr}, limit: ${e}}`},iM={keyword:Object.keys($l),type:"number",schemaType:"number",$data:!0,error:oM,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,xl._)`${r} ${$l[e].fail} ${n} || isNaN(${r})`)}};Gg.default=iM});var ak=b(Wg=>{"use strict";Object.defineProperty(Wg,"__esModule",{value:!0});var Sa=re(),sM={message:({schemaCode:t})=>(0,Sa.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,Sa._)`{multipleOf: ${t}}`},aM={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:sM,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,i=o.opts.multipleOfPrecision,s=e.let("res"),a=i?(0,Sa._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${i}`:(0,Sa._)`${s} !== parseInt(${s})`;t.fail$data((0,Sa._)`(${n} === 0 || (${s} = ${r}/${n}, ${a}))`)}};Wg.default=aM});var uk=b(Jg=>{"use strict";Object.defineProperty(Jg,"__esModule",{value:!0});function ck(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}Jg.default=ck;ck.code='require("ajv/dist/runtime/ucs2length").default'});var lk=b(Kg=>{"use strict";Object.defineProperty(Kg,"__esModule",{value:!0});var ro=re(),cM=ge(),uM=uk(),lM={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,ro.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,ro._)`{limit: ${t}}`},dM={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:lM,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,i=e==="maxLength"?ro.operators.GT:ro.operators.LT,s=o.opts.unicode===!1?(0,ro._)`${r}.length`:(0,ro._)`${(0,cM.useFunc)(t.gen,uM.default)}(${r})`;t.fail$data((0,ro._)`${s} ${i} ${n}`)}};Kg.default=dM});var dk=b(Xg=>{"use strict";Object.defineProperty(Xg,"__esModule",{value:!0});var pM=Kt(),wl=re(),fM={message:({schemaCode:t})=>(0,wl.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,wl._)`{pattern: ${t}}`},mM={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:fM,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:i}=t,s=i.opts.unicodeRegExp?"u":"",a=r?(0,wl._)`(new RegExp(${o}, ${s}))`:(0,pM.usePattern)(t,n);t.fail$data((0,wl._)`!${a}.test(${e})`)}};Xg.default=mM});var pk=b(Yg=>{"use strict";Object.defineProperty(Yg,"__esModule",{value:!0});var Pa=re(),hM={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,Pa.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Pa._)`{limit: ${t}}`},gM={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:hM,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?Pa.operators.GT:Pa.operators.LT;t.fail$data((0,Pa._)`Object.keys(${r}).length ${o} ${n}`)}};Yg.default=gM});var fk=b(Qg=>{"use strict";Object.defineProperty(Qg,"__esModule",{value:!0});var Ia=Kt(),Ea=re(),vM=ge(),yM={message:({params:{missingProperty:t}})=>(0,Ea.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,Ea._)`{missingProperty: ${t}}`},_M={keyword:"required",type:"object",schemaType:"array",$data:!0,error:yM,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:i,it:s}=t,{opts:a}=s;if(!i&&r.length===0)return;let c=r.length>=a.loopRequired;if(s.allErrors?u():l(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:h}=t.it;for(let m of r)if(f?.[m]===void 0&&!h.has(m)){let g=s.schemaEnv.baseId+s.errSchemaPath,v=`required property "${m}" is not defined at "${g}" (strictRequired)`;(0,vM.checkStrictMode)(s,v,s.opts.strictRequired)}}function u(){if(c||i)t.block$data(Ea.nil,d);else for(let f of r)(0,Ia.checkReportMissingProp)(t,f)}function l(){let f=e.let("missing");if(c||i){let h=e.let("valid",!0);t.block$data(h,()=>p(f,h)),t.ok(h)}else e.if((0,Ia.checkMissingProp)(t,r,f)),(0,Ia.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,Ia.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function p(f,h){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(h,(0,Ia.propertyInData)(e,o,f,a.ownProperties)),e.if((0,Ea.not)(h),()=>{t.error(),e.break()})},Ea.nil)}}};Qg.default=_M});var mk=b(ev=>{"use strict";Object.defineProperty(ev,"__esModule",{value:!0});var za=re(),bM={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,za.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,za._)`{limit: ${t}}`},xM={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:bM,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?za.operators.GT:za.operators.LT;t.fail$data((0,za._)`${r}.length ${o} ${n}`)}};ev.default=xM});var kl=b(tv=>{"use strict";Object.defineProperty(tv,"__esModule",{value:!0});var hk=ha();hk.code='require("ajv/dist/runtime/equal").default';tv.default=hk});var gk=b(nv=>{"use strict";Object.defineProperty(nv,"__esModule",{value:!0});var rv=ma(),rt=re(),$M=ge(),wM=kl(),kM={message:({params:{i:t,j:e}})=>(0,rt.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,rt._)`{i: ${t}, j: ${e}}`},SM={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:kM,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:i,schemaCode:s,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=i.items?(0,rv.getSchemaTypes)(i.items):[];t.block$data(c,l,(0,rt._)`${s} === false`),t.ok(c);function l(){let h=e.let("i",(0,rt._)`${r}.length`),m=e.let("j");t.setParams({i:h,j:m}),e.assign(c,!0),e.if((0,rt._)`${h} > 1`,()=>(d()?p:f)(h,m))}function d(){return u.length>0&&!u.some(h=>h==="object"||h==="array")}function p(h,m){let g=e.name("item"),v=(0,rv.checkDataTypes)(u,g,a.opts.strictNumbers,rv.DataType.Wrong),x=e.const("indices",(0,rt._)`{}`);e.for((0,rt._)`;${h}--;`,()=>{e.let(g,(0,rt._)`${r}[${h}]`),e.if(v,(0,rt._)`continue`),u.length>1&&e.if((0,rt._)`typeof ${g} == "string"`,(0,rt._)`${g} += "_"`),e.if((0,rt._)`typeof ${x}[${g}] == "number"`,()=>{e.assign(m,(0,rt._)`${x}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,rt._)`${x}[${g}] = ${h}`)})}function f(h,m){let g=(0,$M.useFunc)(e,wM.default),v=e.name("outer");e.label(v).for((0,rt._)`;${h}--;`,()=>e.for((0,rt._)`${m} = ${h}; ${m}--;`,()=>e.if((0,rt._)`${g}(${r}[${h}], ${r}[${m}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};nv.default=SM});var vk=b(iv=>{"use strict";Object.defineProperty(iv,"__esModule",{value:!0});var ov=re(),PM=ge(),IM=kl(),EM={message:"must be equal to constant",params:({schemaCode:t})=>(0,ov._)`{allowedValue: ${t}}`},zM={keyword:"const",$data:!0,error:EM,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:i}=t;n||i&&typeof i=="object"?t.fail$data((0,ov._)`!${(0,PM.useFunc)(e,IM.default)}(${r}, ${o})`):t.fail((0,ov._)`${i} !== ${r}`)}};iv.default=zM});var yk=b(sv=>{"use strict";Object.defineProperty(sv,"__esModule",{value:!0});var Ta=re(),TM=ge(),CM=kl(),OM={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,Ta._)`{allowedValues: ${t}}`},jM={keyword:"enum",schemaType:"array",$data:!0,error:OM,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:i,it:s}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=s.opts.loopEnum,c,u=()=>c??(c=(0,TM.useFunc)(e,CM.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",i);l=(0,Ta.or)(...o.map((h,m)=>p(f,m)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",i,f=>e.if((0,Ta._)`${u()}(${r}, ${f})`,()=>e.assign(l,!0).break()))}function p(f,h){let m=o[h];return typeof m=="object"&&m!==null?(0,Ta._)`${u()}(${r}, ${f}[${h}])`:(0,Ta._)`${r} === ${m}`}}};sv.default=jM});var _k=b(av=>{"use strict";Object.defineProperty(av,"__esModule",{value:!0});var NM=sk(),RM=ak(),AM=lk(),MM=dk(),DM=pk(),UM=fk(),qM=mk(),LM=gk(),ZM=vk(),FM=yk(),VM=[NM.default,RM.default,AM.default,MM.default,DM.default,UM.default,qM.default,LM.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},ZM.default,FM.default];av.default=VM});var uv=b(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.validateAdditionalItems=void 0;var no=re(),cv=ge(),BM={message:({params:{len:t}})=>(0,no.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,no._)`{limit: ${t}}`},HM={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:BM,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,cv.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}bk(t,n)}};function bk(t,e){let{gen:r,schema:n,data:o,keyword:i,it:s}=t;s.items=!0;let a=r.const("len",(0,no._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,no._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,cv.alwaysValidSchema)(s,n)){let u=r.var("valid",(0,no._)`${a} <= ${e.length}`);r.if((0,no.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:i,dataProp:l,dataPropType:cv.Type.Num},u),s.allErrors||r.if((0,no.not)(u),()=>r.break())})}}Ca.validateAdditionalItems=bk;Ca.default=HM});var lv=b(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.validateTuple=void 0;var xk=re(),Sl=ge(),GM=Kt(),WM={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return $k(t,"additionalItems",e);r.items=!0,!(0,Sl.alwaysValidSchema)(r,e)&&t.ok((0,GM.validateArray)(t))}};function $k(t,e,r=t.schema){let{gen:n,parentSchema:o,data:i,keyword:s,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=Sl.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,xk._)`${i}.length`);r.forEach((d,p)=>{(0,Sl.alwaysValidSchema)(a,d)||(n.if((0,xk._)`${u} > ${p}`,()=>t.subschema({keyword:s,schemaProp:p,dataProp:p},c)),t.ok(c))});function l(d){let{opts:p,errSchemaPath:f}=a,h=r.length,m=h===d.minItems&&(h===d.maxItems||d[e]===!1);if(p.strictTuples&&!m){let g=`"${s}" is ${h}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,Sl.checkStrictMode)(a,g,p.strictTuples)}}}Oa.validateTuple=$k;Oa.default=WM});var wk=b(dv=>{"use strict";Object.defineProperty(dv,"__esModule",{value:!0});var JM=lv(),KM={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,JM.validateTuple)(t,"items")};dv.default=KM});var Sk=b(pv=>{"use strict";Object.defineProperty(pv,"__esModule",{value:!0});var kk=re(),XM=ge(),YM=Kt(),QM=uv(),e4={message:({params:{len:t}})=>(0,kk.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,kk._)`{limit: ${t}}`},t4={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:e4,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,XM.alwaysValidSchema)(n,e)&&(o?(0,QM.validateAdditionalItems)(t,o):t.ok((0,YM.validateArray)(t)))}};pv.default=t4});var Pk=b(fv=>{"use strict";Object.defineProperty(fv,"__esModule",{value:!0});var Yt=re(),Pl=ge(),r4={message:({params:{min:t,max:e}})=>e===void 0?(0,Yt.str)`must contain at least ${t} valid item(s)`:(0,Yt.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,Yt._)`{minContains: ${t}}`:(0,Yt._)`{minContains: ${t}, maxContains: ${e}}`},n4={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:r4,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t,s,a,{minContains:c,maxContains:u}=n;i.opts.next?(s=c===void 0?1:c,a=u):s=1;let l=e.const("len",(0,Yt._)`${o}.length`);if(t.setParams({min:s,max:a}),a===void 0&&s===0){(0,Pl.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,Pl.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,Pl.alwaysValidSchema)(i,r)){let m=(0,Yt._)`${l} >= ${s}`;a!==void 0&&(m=(0,Yt._)`${m} && ${l} <= ${a}`),t.pass(m);return}i.items=!0;let d=e.name("valid");a===void 0&&s===1?f(d,()=>e.if(d,()=>e.break())):s===0?(e.let(d,!0),a!==void 0&&e.if((0,Yt._)`${o}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let m=e.name("_valid"),g=e.let("count",0);f(m,()=>e.if(m,()=>h(g)))}function f(m,g){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:Pl.Type.Num,compositeRule:!0},m),g()})}function h(m){e.code((0,Yt._)`${m}++`),a===void 0?e.if((0,Yt._)`${m} >= ${s}`,()=>e.assign(d,!0).break()):(e.if((0,Yt._)`${m} > ${a}`,()=>e.assign(d,!1).break()),s===1?e.assign(d,!0):e.if((0,Yt._)`${m} >= ${s}`,()=>e.assign(d,!0)))}}};fv.default=n4});var zk=b(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.validateSchemaDeps=Er.validatePropertyDeps=Er.error=void 0;var mv=re(),o4=ge(),ja=Kt();Er.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,mv.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,mv._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var i4={keyword:"dependencies",type:"object",schemaType:"object",error:Er.error,code(t){let[e,r]=s4(t);Ik(t,e),Ek(t,r)}};function s4({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function Ik(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let i=r.let("missing");for(let s in e){let a=e[s];if(a.length===0)continue;let c=(0,ja.propertyInData)(r,n,s,o.opts.ownProperties);t.setParams({property:s,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,ja.checkReportMissingProp)(t,u)}):(r.if((0,mv._)`${c} && (${(0,ja.checkMissingProp)(t,a,i)})`),(0,ja.reportMissingProp)(t,i),r.else())}}Er.validatePropertyDeps=Ik;function Ek(t,e=t.schema){let{gen:r,data:n,keyword:o,it:i}=t,s=r.name("valid");for(let a in e)(0,o4.alwaysValidSchema)(i,e[a])||(r.if((0,ja.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},s);t.mergeValidEvaluated(c,s)},()=>r.var(s,!0)),t.ok(s))}Er.validateSchemaDeps=Ek;Er.default=i4});var Ck=b(hv=>{"use strict";Object.defineProperty(hv,"__esModule",{value:!0});var Tk=re(),a4=ge(),c4={message:"property name must be valid",params:({params:t})=>(0,Tk._)`{propertyName: ${t.propertyName}}`},u4={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:c4,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,a4.alwaysValidSchema)(o,r))return;let i=e.name("valid");e.forIn("key",n,s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},i),e.if((0,Tk.not)(i),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(i)}};hv.default=u4});var vv=b(gv=>{"use strict";Object.defineProperty(gv,"__esModule",{value:!0});var Il=Kt(),fr=re(),l4=Br(),El=ge(),d4={message:"must NOT have additional properties",params:({params:t})=>(0,fr._)`{additionalProperty: ${t.additionalProperty}}`},p4={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:d4,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:i,it:s}=t;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=s;if(s.props=!0,c.removeAdditional!=="all"&&(0,El.alwaysValidSchema)(s,r))return;let u=(0,Il.allSchemaProperties)(n.properties),l=(0,Il.allSchemaProperties)(n.patternProperties);d(),t.ok((0,fr._)`${i} === ${l4.default.errors}`);function d(){e.forIn("key",o,g=>{!u.length&&!l.length?h(g):e.if(p(g),()=>h(g))})}function p(g){let v;if(u.length>8){let x=(0,El.schemaRefOrVal)(s,n.properties,"properties");v=(0,Il.isOwnProperty)(e,x,g)}else u.length?v=(0,fr.or)(...u.map(x=>(0,fr._)`${g} === ${x}`)):v=fr.nil;return l.length&&(v=(0,fr.or)(v,...l.map(x=>(0,fr._)`${(0,Il.usePattern)(t,x)}.test(${g})`))),(0,fr.not)(v)}function f(g){e.code((0,fr._)`delete ${o}[${g}]`)}function h(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,El.alwaysValidSchema)(s,r)){let v=e.name("valid");c.removeAdditional==="failing"?(m(g,v,!1),e.if((0,fr.not)(v),()=>{t.reset(),f(g)})):(m(g,v),a||e.if((0,fr.not)(v),()=>e.break()))}}function m(g,v,x){let w={keyword:"additionalProperties",dataProp:g,dataPropType:El.Type.Str};x===!1&&Object.assign(w,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(w,v)}}};gv.default=p4});var Nk=b(_v=>{"use strict";Object.defineProperty(_v,"__esModule",{value:!0});var f4=_a(),Ok=Kt(),yv=ge(),jk=vv(),m4={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&jk.default.code(new f4.KeywordCxt(i,jk.default,"additionalProperties"));let s=(0,Ok.allSchemaProperties)(r);for(let d of s)i.definedProperties.add(d);i.opts.unevaluated&&s.length&&i.props!==!0&&(i.props=yv.mergeEvaluated.props(e,(0,yv.toHash)(s),i.props));let a=s.filter(d=>!(0,yv.alwaysValidSchema)(i,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,Ok.propertyInData)(e,o,d,i.opts.ownProperties)),l(d),i.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return i.opts.useDefaults&&!i.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};_v.default=m4});var Dk=b(bv=>{"use strict";Object.defineProperty(bv,"__esModule",{value:!0});var Rk=Kt(),zl=re(),Ak=ge(),Mk=ge(),h4={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:i}=t,{opts:s}=i,a=(0,Rk.allSchemaProperties)(r),c=a.filter(m=>(0,Ak.alwaysValidSchema)(i,r[m]));if(a.length===0||c.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let u=s.strictSchema&&!s.allowMatchingProperties&&o.properties,l=e.name("valid");i.props!==!0&&!(i.props instanceof zl.Name)&&(i.props=(0,Mk.evaluatedPropsToName)(e,i.props));let{props:d}=i;p();function p(){for(let m of a)u&&f(m),i.allErrors?h(m):(e.var(l,!0),h(m),e.if(l))}function f(m){for(let g in u)new RegExp(m).test(g)&&(0,Ak.checkStrictMode)(i,`property ${g} matches pattern ${m} (use allowMatchingProperties)`)}function h(m){e.forIn("key",n,g=>{e.if((0,zl._)`${(0,Rk.usePattern)(t,m)}.test(${g})`,()=>{let v=c.includes(m);v||t.subschema({keyword:"patternProperties",schemaProp:m,dataProp:g,dataPropType:Mk.Type.Str},l),i.opts.unevaluated&&d!==!0?e.assign((0,zl._)`${d}[${g}]`,!0):!v&&!i.allErrors&&e.if((0,zl.not)(l),()=>e.break())})})}}};bv.default=h4});var Uk=b(xv=>{"use strict";Object.defineProperty(xv,"__esModule",{value:!0});var g4=ge(),v4={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,g4.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};xv.default=v4});var qk=b($v=>{"use strict";Object.defineProperty($v,"__esModule",{value:!0});var y4=Kt(),_4={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:y4.validateUnion,error:{message:"must match a schema in anyOf"}};$v.default=_4});var Lk=b(wv=>{"use strict";Object.defineProperty(wv,"__esModule",{value:!0});var Tl=re(),b4=ge(),x4={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,Tl._)`{passingSchemas: ${t.passing}}`},$4={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:x4,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let i=r,s=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(s,()=>t.reset(),()=>t.error(!0));function u(){i.forEach((l,d)=>{let p;(0,b4.alwaysValidSchema)(o,l)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,Tl._)`${c} && ${s}`).assign(s,!1).assign(a,(0,Tl._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(s,!0),e.assign(a,d),p&&t.mergeEvaluated(p,Tl.Name)})})}}};wv.default=$4});var Zk=b(kv=>{"use strict";Object.defineProperty(kv,"__esModule",{value:!0});var w4=ge(),k4={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((i,s)=>{if((0,w4.alwaysValidSchema)(n,i))return;let a=t.subschema({keyword:"allOf",schemaProp:s},o);t.ok(o),t.mergeEvaluated(a)})}};kv.default=k4});var Bk=b(Sv=>{"use strict";Object.defineProperty(Sv,"__esModule",{value:!0});var Cl=re(),Vk=ge(),S4={message:({params:t})=>(0,Cl.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,Cl._)`{failingKeyword: ${t.ifClause}}`},P4={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:S4,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,Vk.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=Fk(n,"then"),i=Fk(n,"else");if(!o&&!i)return;let s=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&i){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,Cl.not)(a),u("else"));t.pass(s,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let p=t.subschema({keyword:l},a);e.assign(s,a),t.mergeValidEvaluated(p,s),d?e.assign(d,(0,Cl._)`${l}`):t.setParams({ifClause:l})}}}};function Fk(t,e){let r=t.schema[e];return r!==void 0&&!(0,Vk.alwaysValidSchema)(t,r)}Sv.default=P4});var Hk=b(Pv=>{"use strict";Object.defineProperty(Pv,"__esModule",{value:!0});var I4=ge(),E4={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,I4.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};Pv.default=E4});var Gk=b(Iv=>{"use strict";Object.defineProperty(Iv,"__esModule",{value:!0});var z4=uv(),T4=wk(),C4=lv(),O4=Sk(),j4=Pk(),N4=zk(),R4=Ck(),A4=vv(),M4=Nk(),D4=Dk(),U4=Uk(),q4=qk(),L4=Lk(),Z4=Zk(),F4=Bk(),V4=Hk();function B4(t=!1){let e=[U4.default,q4.default,L4.default,Z4.default,F4.default,V4.default,R4.default,A4.default,N4.default,M4.default,D4.default];return t?e.push(T4.default,O4.default):e.push(z4.default,C4.default),e.push(j4.default),e}Iv.default=B4});var Wk=b(Ev=>{"use strict";Object.defineProperty(Ev,"__esModule",{value:!0});var Ze=re(),H4={message:({schemaCode:t})=>(0,Ze.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,Ze._)`{format: ${t}}`},G4={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:H4,code(t,e){let{gen:r,data:n,$data:o,schema:i,schemaCode:s,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?p():f();function p(){let h=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),m=r.const("fDef",(0,Ze._)`${h}[${s}]`),g=r.let("fType"),v=r.let("format");r.if((0,Ze._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(g,(0,Ze._)`${m}.type || "string"`).assign(v,(0,Ze._)`${m}.validate`),()=>r.assign(g,(0,Ze._)`"string"`).assign(v,m)),t.fail$data((0,Ze.or)(x(),w()));function x(){return c.strictSchema===!1?Ze.nil:(0,Ze._)`${s} && !${v}`}function w(){let I=l.$async?(0,Ze._)`(${m}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,Ze._)`${v}(${n})`,k=(0,Ze._)`(typeof ${v} == "function" ? ${I} : ${v}.test(${n}))`;return(0,Ze._)`${v} && ${v} !== true && ${g} === ${e} && !${k}`}}function f(){let h=d.formats[i];if(!h){x();return}if(h===!0)return;let[m,g,v]=w(h);m===e&&t.pass(I());function x(){if(c.strictSchema===!1){d.logger.warn(k());return}throw new Error(k());function k(){return`unknown format "${i}" ignored in schema at path "${u}"`}}function w(k){let ie=k instanceof RegExp?(0,Ze.regexpCode)(k):c.code.formats?(0,Ze._)`${c.code.formats}${(0,Ze.getProperty)(i)}`:void 0,se=r.scopeValue("formats",{key:i,ref:k,code:ie});return typeof k=="object"&&!(k instanceof RegExp)?[k.type||"string",k.validate,(0,Ze._)`${se}.validate`]:["string",k,se]}function I(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!l.$async)throw new Error("async format in sync schema");return(0,Ze._)`await ${v}(${n})`}return typeof g=="function"?(0,Ze._)`${v}(${n})`:(0,Ze._)`${v}.test(${n})`}}}};Ev.default=G4});var Jk=b(zv=>{"use strict";Object.defineProperty(zv,"__esModule",{value:!0});var W4=Wk(),J4=[W4.default];zv.default=J4});var Kk=b(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.contentVocabulary=di.metadataVocabulary=void 0;di.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];di.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var Yk=b(Tv=>{"use strict";Object.defineProperty(Tv,"__esModule",{value:!0});var K4=ik(),X4=_k(),Y4=Gk(),Q4=Jk(),Xk=Kk(),eD=[K4.default,X4.default,(0,Y4.default)(),Q4.default,Xk.metadataVocabulary,Xk.contentVocabulary];Tv.default=eD});var eS=b(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});Ol.DiscrError=void 0;var Qk;(function(t){t.Tag="tag",t.Mapping="mapping"})(Qk||(Ol.DiscrError=Qk={}))});var rS=b(Ov=>{"use strict";Object.defineProperty(Ov,"__esModule",{value:!0});var pi=re(),Cv=eS(),tS=fl(),tD=ba(),rD=ge(),nD={message:({params:{discrError:t,tagName:e}})=>t===Cv.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,pi._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},oD={keyword:"discriminator",type:"object",schemaType:"object",error:nD,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:i}=t,{oneOf:s}=o;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,pi._)`${r}${(0,pi.getProperty)(a)}`);e.if((0,pi._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:Cv.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let f=p();e.if(!1);for(let h in f)e.elseIf((0,pi._)`${u} === ${h}`),e.assign(c,d(f[h]));e.else(),t.error(!1,{discrError:Cv.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(f){let h=e.name("valid"),m=t.subschema({keyword:"oneOf",schemaProp:f},h);return t.mergeEvaluated(m,pi.Name),h}function p(){var f;let h={},m=v(o),g=!0;for(let I=0;I<s.length;I++){let k=s[I];if(k?.$ref&&!(0,rD.schemaHasRulesButRef)(k,i.self.RULES)){let se=k.$ref;if(k=tS.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,se),k instanceof tS.SchemaEnv&&(k=k.schema),k===void 0)throw new tD.default(i.opts.uriResolver,i.baseId,se)}let ie=(f=k?.properties)===null||f===void 0?void 0:f[a];if(typeof ie!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(m||v(k)),x(ie,I)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return h;function v({required:I}){return Array.isArray(I)&&I.includes(a)}function x(I,k){if(I.const)w(I.const,k);else if(I.enum)for(let ie of I.enum)w(ie,k);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function w(I,k){if(typeof I!="string"||I in h)throw new Error(`discriminator: "${a}" values must be unique strings`);h[I]=k}}}};Ov.default=oD});var nS=b((O8,iD)=>{iD.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var iS=b((Ae,jv)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.MissingRefError=Ae.ValidationError=Ae.CodeGen=Ae.Name=Ae.nil=Ae.stringify=Ae.str=Ae._=Ae.KeywordCxt=Ae.Ajv=void 0;var sD=Q0(),aD=Yk(),cD=rS(),oS=nS(),uD=["/properties"],jl="http://json-schema.org/draft-07/schema",fi=class extends sD.default{_addVocabularies(){super._addVocabularies(),aD.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(cD.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(oS,uD):oS;this.addMetaSchema(e,jl,!1),this.refs["http://json-schema.org/schema"]=jl}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(jl)?jl:void 0)}};Ae.Ajv=fi;jv.exports=Ae=fi;jv.exports.Ajv=fi;Object.defineProperty(Ae,"__esModule",{value:!0});Ae.default=fi;var lD=_a();Object.defineProperty(Ae,"KeywordCxt",{enumerable:!0,get:function(){return lD.KeywordCxt}});var mi=re();Object.defineProperty(Ae,"_",{enumerable:!0,get:function(){return mi._}});Object.defineProperty(Ae,"str",{enumerable:!0,get:function(){return mi.str}});Object.defineProperty(Ae,"stringify",{enumerable:!0,get:function(){return mi.stringify}});Object.defineProperty(Ae,"nil",{enumerable:!0,get:function(){return mi.nil}});Object.defineProperty(Ae,"Name",{enumerable:!0,get:function(){return mi.Name}});Object.defineProperty(Ae,"CodeGen",{enumerable:!0,get:function(){return mi.CodeGen}});var dD=dl();Object.defineProperty(Ae,"ValidationError",{enumerable:!0,get:function(){return dD.default}});var pD=ba();Object.defineProperty(Ae,"MissingRefError",{enumerable:!0,get:function(){return pD.default}})});var fS=b(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.formatNames=Tr.fastFormats=Tr.fullFormats=void 0;function zr(t,e){return{validate:t,compare:e}}Tr.fullFormats={date:zr(uS,Mv),time:zr(Rv(!0),Dv),"date-time":zr(sS(!0),dS),"iso-time":zr(Rv(),lS),"iso-date-time":zr(sS(),pS),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:yD,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:SD,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:_D,int32:{type:"number",validate:$D},int64:{type:"number",validate:wD},float:{type:"number",validate:cS},double:{type:"number",validate:cS},password:!0,binary:!0};Tr.fastFormats={...Tr.fullFormats,date:zr(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Mv),time:zr(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Dv),"date-time":zr(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,dS),"iso-time":zr(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,lS),"iso-date-time":zr(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,pS),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};Tr.formatNames=Object.keys(Tr.fullFormats);function fD(t){return t%4===0&&(t%100!==0||t%400===0)}var mD=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,hD=[0,31,28,31,30,31,30,31,31,30,31,30,31];function uS(t){let e=mD.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&fD(r)?29:hD[n])}function Mv(t,e){if(t&&e)return t>e?1:t<e?-1:0}var Nv=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function Rv(t){return function(r){let n=Nv.exec(r);if(!n)return!1;let o=+n[1],i=+n[2],s=+n[3],a=n[4],c=n[5]==="-"?-1:1,u=+(n[6]||0),l=+(n[7]||0);if(u>23||l>59||t&&!a)return!1;if(o<=23&&i<=59&&s<60)return!0;let d=i-l*c,p=o-u*c-(d<0?1:0);return(p===23||p===-1)&&(d===59||d===-1)&&s<61}}function Dv(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function lS(t,e){if(!(t&&e))return;let r=Nv.exec(t),n=Nv.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var Av=/t|\s/i;function sS(t){let e=Rv(t);return function(n){let o=n.split(Av);return o.length===2&&uS(o[0])&&e(o[1])}}function dS(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function pS(t,e){if(!(t&&e))return;let[r,n]=t.split(Av),[o,i]=e.split(Av),s=Mv(r,o);if(s!==void 0)return s||Dv(n,i)}var gD=/\/|:/,vD=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function yD(t){return gD.test(t)&&vD.test(t)}var aS=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function _D(t){return aS.lastIndex=0,aS.test(t)}var bD=-(2**31),xD=2**31-1;function $D(t){return Number.isInteger(t)&&t<=xD&&t>=bD}function wD(t){return Number.isInteger(t)}function cS(){return!0}var kD=/[^\\]\\Z/;function SD(t){if(kD.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var Aa=b(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.regexpCode=ve.getEsmExportName=ve.getProperty=ve.safeStringify=ve.stringify=ve.strConcat=ve.addCodeArg=ve.str=ve._=ve.nil=ve._Code=ve.Name=ve.IDENTIFIER=ve._CodeOrName=void 0;var Na=class{};ve._CodeOrName=Na;ve.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var oo=class extends Na{constructor(e){if(super(),!ve.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};ve.Name=oo;var Qt=class extends Na{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof oo&&(r[n.str]=(r[n.str]||0)+1),r),{})}};ve._Code=Qt;ve.nil=new Qt("");function mS(t,...e){let r=[t[0]],n=0;for(;n<e.length;)qv(r,e[n]),r.push(t[++n]);return new Qt(r)}ve._=mS;var Uv=new Qt("+");function hS(t,...e){let r=[Ra(t[0])],n=0;for(;n<e.length;)r.push(Uv),qv(r,e[n]),r.push(Uv,Ra(t[++n]));return PD(r),new Qt(r)}ve.str=hS;function qv(t,e){e instanceof Qt?t.push(...e._items):e instanceof oo?t.push(e):t.push(zD(e))}ve.addCodeArg=qv;function PD(t){let e=1;for(;e<t.length-1;){if(t[e]===Uv){let r=ID(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function ID(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof oo||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof oo))return`"${t}${e.slice(1)}`}function ED(t,e){return e.emptyStr()?t:t.emptyStr()?e:hS`${t}${e}`}ve.strConcat=ED;function zD(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:Ra(Array.isArray(t)?t.join(","):t)}function TD(t){return new Qt(Ra(t))}ve.stringify=TD;function Ra(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}ve.safeStringify=Ra;function CD(t){return typeof t=="string"&&ve.IDENTIFIER.test(t)?new Qt(`.${t}`):mS`[${t}]`}ve.getProperty=CD;function OD(t){if(typeof t=="string"&&ve.IDENTIFIER.test(t))return new Qt(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}ve.getEsmExportName=OD;function jD(t){return new Qt(t.toString())}ve.regexpCode=jD});var Fv=b(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.ValueScope=Ct.ValueScopeName=Ct.Scope=Ct.varKinds=Ct.UsedValueState=void 0;var Tt=Aa(),Lv=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Nl;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Nl||(Ct.UsedValueState=Nl={}));Ct.varKinds={const:new Tt.Name("const"),let:new Tt.Name("let"),var:new Tt.Name("var")};var Rl=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Tt.Name?e:this.name(e)}name(e){return new Tt.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};Ct.Scope=Rl;var Al=class extends Tt.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Tt._)`.${new Tt.Name(r)}[${n}]`}};Ct.ValueScopeName=Al;var ND=(0,Tt._)`\n`,Zv=class extends Rl{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?ND:Tt.nil}}get(){return this._scope}name(e){return new Al(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:i}=o,s=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let l=a.get(s);if(l)return l}else a=this._values[i]=new Map;a.set(s,o);let c=this._scope[i]||(this._scope[i]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:i,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Tt._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let i=Tt.nil;for(let s in e){let a=e[s];if(!a)continue;let c=n[s]=n[s]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,Nl.Started);let l=r(u);if(l){let d=this.opts.es5?Ct.varKinds.var:Ct.varKinds.const;i=(0,Tt._)`${i}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))i=(0,Tt._)`${i}${l}${this.opts._n}`;else throw new Lv(u);c.set(u,Nl.Completed)})}return i}};Ct.ValueScope=Zv});var X=b(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.or=te.and=te.not=te.CodeGen=te.operators=te.varKinds=te.ValueScopeName=te.ValueScope=te.Scope=te.Name=te.regexpCode=te.stringify=te.getProperty=te.nil=te.strConcat=te.str=te._=void 0;var de=Aa(),mr=Fv(),kn=Aa();Object.defineProperty(te,"_",{enumerable:!0,get:function(){return kn._}});Object.defineProperty(te,"str",{enumerable:!0,get:function(){return kn.str}});Object.defineProperty(te,"strConcat",{enumerable:!0,get:function(){return kn.strConcat}});Object.defineProperty(te,"nil",{enumerable:!0,get:function(){return kn.nil}});Object.defineProperty(te,"getProperty",{enumerable:!0,get:function(){return kn.getProperty}});Object.defineProperty(te,"stringify",{enumerable:!0,get:function(){return kn.stringify}});Object.defineProperty(te,"regexpCode",{enumerable:!0,get:function(){return kn.regexpCode}});Object.defineProperty(te,"Name",{enumerable:!0,get:function(){return kn.Name}});var ql=Fv();Object.defineProperty(te,"Scope",{enumerable:!0,get:function(){return ql.Scope}});Object.defineProperty(te,"ValueScope",{enumerable:!0,get:function(){return ql.ValueScope}});Object.defineProperty(te,"ValueScopeName",{enumerable:!0,get:function(){return ql.ValueScopeName}});Object.defineProperty(te,"varKinds",{enumerable:!0,get:function(){return ql.varKinds}});te.operators={GT:new de._Code(">"),GTE:new de._Code(">="),LT:new de._Code("<"),LTE:new de._Code("<="),EQ:new de._Code("==="),NEQ:new de._Code("!=="),NOT:new de._Code("!"),OR:new de._Code("||"),AND:new de._Code("&&"),ADD:new de._Code("+")};var Wr=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},Vv=class extends Wr{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?mr.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=gi(this.rhs,e,r)),this}get names(){return this.rhs instanceof de._CodeOrName?this.rhs.names:{}}},Ml=class extends Wr{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof de.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=gi(this.rhs,e,r),this}get names(){let e=this.lhs instanceof de.Name?{}:{...this.lhs.names};return Ul(e,this.rhs)}},Bv=class extends Ml{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},Hv=class extends Wr{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},Gv=class extends Wr{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},Wv=class extends Wr{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},Jv=class extends Wr{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=gi(this.code,e,r),this}get names(){return this.code instanceof de._CodeOrName?this.code.names:{}}},Ma=class extends Wr{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let i=n[o];i.optimizeNames(e,r)||(RD(e,i.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>ao(e,r.names),{})}},Jr=class extends Ma{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},Kv=class extends Ma{},hi=class extends Jr{};hi.kind="else";var io=class t extends Jr{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new hi(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(gS(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=gi(this.condition,e,r),this}get names(){let e=super.names;return Ul(e,this.condition),this.else&&ao(e,this.else.names),e}};io.kind="if";var so=class extends Jr{};so.kind="for";var Xv=class extends so{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=gi(this.iteration,e,r),this}get names(){return ao(super.names,this.iteration.names)}},Yv=class extends so{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?mr.varKinds.var:this.varKind,{name:n,from:o,to:i}=this;return`for(${r} ${n}=${o}; ${n}<${i}; ${n}++)`+super.render(e)}get names(){let e=Ul(super.names,this.from);return Ul(e,this.to)}},Dl=class extends so{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=gi(this.iterable,e,r),this}get names(){return ao(super.names,this.iterable.names)}},Da=class extends Jr{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};Da.kind="func";var Ua=class extends Ma{render(e){return"return "+super.render(e)}};Ua.kind="return";var Qv=class extends Jr{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&ao(e,this.catch.names),this.finally&&ao(e,this.finally.names),e}},qa=class extends Jr{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};qa.kind="catch";var La=class extends Jr{render(e){return"finally"+super.render(e)}};La.kind="finally";var ey=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new mr.Scope({parent:e}),this._nodes=[new Kv]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let i=this._scope.toName(r);return n!==void 0&&o&&(this._constants[i.str]=n),this._leafNode(new Vv(e,i,n)),i}const(e,r,n){return this._def(mr.varKinds.const,e,r,n)}let(e,r,n){return this._def(mr.varKinds.let,e,r,n)}var(e,r,n){return this._def(mr.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Ml(e,r,n))}add(e,r){return this._leafNode(new Bv(e,te.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==de.nil&&this._leafNode(new Jv(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,de.addCodeArg)(r,o));return r.push("}"),new de._Code(r)}if(e,r,n){if(this._blockNode(new io(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new io(e))}else(){return this._elseNode(new hi)}endIf(){return this._endBlockNode(io,hi)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new Xv(e),r)}forRange(e,r,n,o,i=this.opts.es5?mr.varKinds.var:mr.varKinds.let){let s=this._scope.toName(e);return this._for(new Yv(i,s,r,n),()=>o(s))}forOf(e,r,n,o=mr.varKinds.const){let i=this._scope.toName(e);if(this.opts.es5){let s=r instanceof de.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,de._)`${s}.length`,a=>{this.var(i,(0,de._)`${s}[${a}]`),n(i)})}return this._for(new Dl("of",o,i,r),()=>n(i))}forIn(e,r,n,o=this.opts.es5?mr.varKinds.var:mr.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,de._)`Object.keys(${r})`,n);let i=this._scope.toName(e);return this._for(new Dl("in",o,i,r),()=>n(i))}endFor(){return this._endBlockNode(so)}label(e){return this._leafNode(new Hv(e))}break(e){return this._leafNode(new Gv(e))}return(e){let r=new Ua;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(Ua)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new Qv;if(this._blockNode(o),this.code(e),r){let i=this.name("e");this._currNode=o.catch=new qa(i),r(i)}return n&&(this._currNode=o.finally=new La,this.code(n)),this._endBlockNode(qa,La)}throw(e){return this._leafNode(new Wv(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=de.nil,n,o){return this._blockNode(new Da(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(Da)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof io))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};te.CodeGen=ey;function ao(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function Ul(t,e){return e instanceof de._CodeOrName?ao(t,e.names):t}function gi(t,e,r){if(t instanceof de.Name)return n(t);if(!o(t))return t;return new de._Code(t._items.reduce((i,s)=>(s instanceof de.Name&&(s=n(s)),s instanceof de._Code?i.push(...s._items):i.push(s),i),[]));function n(i){let s=r[i.str];return s===void 0||e[i.str]!==1?i:(delete e[i.str],s)}function o(i){return i instanceof de._Code&&i._items.some(s=>s instanceof de.Name&&e[s.str]===1&&r[s.str]!==void 0)}}function RD(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function gS(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,de._)`!${ty(t)}`}te.not=gS;var AD=vS(te.operators.AND);function MD(...t){return t.reduce(AD)}te.and=MD;var DD=vS(te.operators.OR);function UD(...t){return t.reduce(DD)}te.or=UD;function vS(t){return(e,r)=>e===de.nil?r:r===de.nil?e:(0,de._)`${ty(e)} ${t} ${ty(r)}`}function ty(t){return t instanceof de.Name?t:(0,de._)`(${t})`}});var ye=b(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.checkStrictMode=oe.getErrorPath=oe.Type=oe.useFunc=oe.setEvaluated=oe.evaluatedPropsToName=oe.mergeEvaluated=oe.eachItem=oe.unescapeJsonPointer=oe.escapeJsonPointer=oe.escapeFragment=oe.unescapeFragment=oe.schemaRefOrVal=oe.schemaHasRulesButRef=oe.schemaHasRules=oe.checkUnknownRules=oe.alwaysValidSchema=oe.toHash=void 0;var Te=X(),qD=Aa();function LD(t){let e={};for(let r of t)e[r]=!0;return e}oe.toHash=LD;function ZD(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(bS(t,e),!xS(e,t.self.RULES.all))}oe.alwaysValidSchema=ZD;function bS(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let i in e)o[i]||kS(t,`unknown keyword: "${i}"`)}oe.checkUnknownRules=bS;function xS(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}oe.schemaHasRules=xS;function FD(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}oe.schemaHasRulesButRef=FD;function VD({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,Te._)`${r}`}return(0,Te._)`${t}${e}${(0,Te.getProperty)(n)}`}oe.schemaRefOrVal=VD;function BD(t){return $S(decodeURIComponent(t))}oe.unescapeFragment=BD;function HD(t){return encodeURIComponent(ny(t))}oe.escapeFragment=HD;function ny(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}oe.escapeJsonPointer=ny;function $S(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}oe.unescapeJsonPointer=$S;function GD(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}oe.eachItem=GD;function yS({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,i,s,a)=>{let c=s===void 0?i:s instanceof Te.Name?(i instanceof Te.Name?t(o,i,s):e(o,i,s),s):i instanceof Te.Name?(e(o,s,i),i):r(i,s);return a===Te.Name&&!(c instanceof Te.Name)?n(o,c):c}}oe.mergeEvaluated={props:yS({mergeNames:(t,e,r)=>t.if((0,Te._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,Te._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,Te._)`${r} || {}`).code((0,Te._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,Te._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,Te._)`${r} || {}`),oy(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:wS}),items:yS({mergeNames:(t,e,r)=>t.if((0,Te._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,Te._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,Te._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,Te._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function wS(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,Te._)`{}`);return e!==void 0&&oy(t,r,e),r}oe.evaluatedPropsToName=wS;function oy(t,e,r){Object.keys(r).forEach(n=>t.assign((0,Te._)`${e}${(0,Te.getProperty)(n)}`,!0))}oe.setEvaluated=oy;var _S={};function WD(t,e){return t.scopeValue("func",{ref:e,code:_S[e.code]||(_S[e.code]=new qD._Code(e.code))})}oe.useFunc=WD;var ry;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(ry||(oe.Type=ry={}));function JD(t,e,r){if(t instanceof Te.Name){let n=e===ry.Num;return r?n?(0,Te._)`"[" + ${t} + "]"`:(0,Te._)`"['" + ${t} + "']"`:n?(0,Te._)`"/" + ${t}`:(0,Te._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,Te.getProperty)(t).toString():"/"+ny(t)}oe.getErrorPath=JD;function kS(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}oe.checkStrictMode=kS});var Kr=b(iy=>{"use strict";Object.defineProperty(iy,"__esModule",{value:!0});var dt=X(),KD={data:new dt.Name("data"),valCxt:new dt.Name("valCxt"),instancePath:new dt.Name("instancePath"),parentData:new dt.Name("parentData"),parentDataProperty:new dt.Name("parentDataProperty"),rootData:new dt.Name("rootData"),dynamicAnchors:new dt.Name("dynamicAnchors"),vErrors:new dt.Name("vErrors"),errors:new dt.Name("errors"),this:new dt.Name("this"),self:new dt.Name("self"),scope:new dt.Name("scope"),json:new dt.Name("json"),jsonPos:new dt.Name("jsonPos"),jsonLen:new dt.Name("jsonLen"),jsonPart:new dt.Name("jsonPart")};iy.default=KD});var Za=b(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.extendErrors=pt.resetErrorsCount=pt.reportExtraError=pt.reportError=pt.keyword$DataError=pt.keywordError=void 0;var me=X(),Ll=ye(),xt=Kr();pt.keywordError={message:({keyword:t})=>(0,me.str)`must pass "${t}" keyword validation`};pt.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,me.str)`"${t}" keyword must be ${e} ($data)`:(0,me.str)`"${t}" keyword is invalid ($data)`};function XD(t,e=pt.keywordError,r,n){let{it:o}=t,{gen:i,compositeRule:s,allErrors:a}=o,c=IS(t,e,r);n??(s||a)?SS(i,c):PS(o,(0,me._)`[${c}]`)}pt.reportError=XD;function YD(t,e=pt.keywordError,r){let{it:n}=t,{gen:o,compositeRule:i,allErrors:s}=n,a=IS(t,e,r);SS(o,a),i||s||PS(n,xt.default.vErrors)}pt.reportExtraError=YD;function QD(t,e){t.assign(xt.default.errors,e),t.if((0,me._)`${xt.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,me._)`${xt.default.vErrors}.length`,e),()=>t.assign(xt.default.vErrors,null)))}pt.resetErrorsCount=QD;function eU({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:i}){if(o===void 0)throw new Error("ajv implementation error");let s=t.name("err");t.forRange("i",o,xt.default.errors,a=>{t.const(s,(0,me._)`${xt.default.vErrors}[${a}]`),t.if((0,me._)`${s}.instancePath === undefined`,()=>t.assign((0,me._)`${s}.instancePath`,(0,me.strConcat)(xt.default.instancePath,i.errorPath))),t.assign((0,me._)`${s}.schemaPath`,(0,me.str)`${i.errSchemaPath}/${e}`),i.opts.verbose&&(t.assign((0,me._)`${s}.schema`,r),t.assign((0,me._)`${s}.data`,n))})}pt.extendErrors=eU;function SS(t,e){let r=t.const("err",e);t.if((0,me._)`${xt.default.vErrors} === null`,()=>t.assign(xt.default.vErrors,(0,me._)`[${r}]`),(0,me._)`${xt.default.vErrors}.push(${r})`),t.code((0,me._)`${xt.default.errors}++`)}function PS(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,me._)`new ${t.ValidationError}(${e})`):(r.assign((0,me._)`${n}.errors`,e),r.return(!1))}var co={keyword:new me.Name("keyword"),schemaPath:new me.Name("schemaPath"),params:new me.Name("params"),propertyName:new me.Name("propertyName"),message:new me.Name("message"),schema:new me.Name("schema"),parentSchema:new me.Name("parentSchema")};function IS(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,me._)`{}`:tU(t,e,r)}function tU(t,e,r={}){let{gen:n,it:o}=t,i=[rU(o,r),nU(t,r)];return oU(t,e,i),n.object(...i)}function rU({errorPath:t},{instancePath:e}){let r=e?(0,me.str)`${t}${(0,Ll.getErrorPath)(e,Ll.Type.Str)}`:t;return[xt.default.instancePath,(0,me.strConcat)(xt.default.instancePath,r)]}function nU({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,me.str)`${e}/${t}`;return r&&(o=(0,me.str)`${o}${(0,Ll.getErrorPath)(r,Ll.Type.Str)}`),[co.schemaPath,o]}function oU(t,{params:e,message:r},n){let{keyword:o,data:i,schemaValue:s,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([co.keyword,o],[co.params,typeof e=="function"?e(t):e||(0,me._)`{}`]),c.messages&&n.push([co.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([co.schema,s],[co.parentSchema,(0,me._)`${l}${d}`],[xt.default.data,i]),u&&n.push([co.propertyName,u])}});var zS=b(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.boolOrEmptySchema=vi.topBoolOrEmptySchema=void 0;var iU=Za(),sU=X(),aU=Kr(),cU={message:"boolean schema is false"};function uU(t){let{gen:e,schema:r,validateName:n}=t;r===!1?ES(t,!1):typeof r=="object"&&r.$async===!0?e.return(aU.default.data):(e.assign((0,sU._)`${n}.errors`,null),e.return(!0))}vi.topBoolOrEmptySchema=uU;function lU(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),ES(t)):r.var(e,!0)}vi.boolOrEmptySchema=lU;function ES(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,iU.reportError)(o,cU,void 0,e)}});var sy=b(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.getRules=yi.isJSONType=void 0;var dU=["string","number","integer","boolean","null","object","array"],pU=new Set(dU);function fU(t){return typeof t=="string"&&pU.has(t)}yi.isJSONType=fU;function mU(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}yi.getRules=mU});var ay=b(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.shouldUseRule=Sn.shouldUseGroup=Sn.schemaHasRulesForType=void 0;function hU({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&TS(t,n)}Sn.schemaHasRulesForType=hU;function TS(t,e){return e.rules.some(r=>CS(t,r))}Sn.shouldUseGroup=TS;function CS(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}Sn.shouldUseRule=CS});var Fa=b(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.reportTypeError=ft.checkDataTypes=ft.checkDataType=ft.coerceAndCheckDataType=ft.getJSONTypes=ft.getSchemaTypes=ft.DataType=void 0;var gU=sy(),vU=ay(),yU=Za(),J=X(),OS=ye(),_i;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(_i||(ft.DataType=_i={}));function _U(t){let e=jS(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}ft.getSchemaTypes=_U;function jS(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(gU.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}ft.getJSONTypes=jS;function bU(t,e){let{gen:r,data:n,opts:o}=t,i=xU(e,o.coerceTypes),s=e.length>0&&!(i.length===0&&e.length===1&&(0,vU.schemaHasRulesForType)(t,e[0]));if(s){let a=uy(e,n,o.strictNumbers,_i.Wrong);r.if(a,()=>{i.length?$U(t,e,i):ly(t)})}return s}ft.coerceAndCheckDataType=bU;var NS=new Set(["string","number","integer","boolean","null"]);function xU(t,e){return e?t.filter(r=>NS.has(r)||e==="array"&&r==="array"):[]}function $U(t,e,r){let{gen:n,data:o,opts:i}=t,s=n.let("dataType",(0,J._)`typeof ${o}`),a=n.let("coerced",(0,J._)`undefined`);i.coerceTypes==="array"&&n.if((0,J._)`${s} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,J._)`${o}[0]`).assign(s,(0,J._)`typeof ${o}`).if(uy(e,o,i.strictNumbers),()=>n.assign(a,o))),n.if((0,J._)`${a} !== undefined`);for(let u of r)(NS.has(u)||u==="array"&&i.coerceTypes==="array")&&c(u);n.else(),ly(t),n.endIf(),n.if((0,J._)`${a} !== undefined`,()=>{n.assign(o,a),wU(t,a)});function c(u){switch(u){case"string":n.elseIf((0,J._)`${s} == "number" || ${s} == "boolean"`).assign(a,(0,J._)`"" + ${o}`).elseIf((0,J._)`${o} === null`).assign(a,(0,J._)`""`);return;case"number":n.elseIf((0,J._)`${s} == "boolean" || ${o} === null
              || (${s} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,J._)`+${o}`);return;case"integer":n.elseIf((0,J._)`${s} === "boolean" || ${o} === null
              || (${s} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,J._)`+${o}`);return;case"boolean":n.elseIf((0,J._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,J._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,J._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,J._)`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${o} === null`).assign(a,(0,J._)`[${o}]`)}}}function wU({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,J._)`${e} !== undefined`,()=>t.assign((0,J._)`${e}[${r}]`,n))}function cy(t,e,r,n=_i.Correct){let o=n===_i.Correct?J.operators.EQ:J.operators.NEQ,i;switch(t){case"null":return(0,J._)`${e} ${o} null`;case"array":i=(0,J._)`Array.isArray(${e})`;break;case"object":i=(0,J._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":i=s((0,J._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":i=s();break;default:return(0,J._)`typeof ${e} ${o} ${t}`}return n===_i.Correct?i:(0,J.not)(i);function s(a=J.nil){return(0,J.and)((0,J._)`typeof ${e} == "number"`,a,r?(0,J._)`isFinite(${e})`:J.nil)}}ft.checkDataType=cy;function uy(t,e,r,n){if(t.length===1)return cy(t[0],e,r,n);let o,i=(0,OS.toHash)(t);if(i.array&&i.object){let s=(0,J._)`typeof ${e} != "object"`;o=i.null?s:(0,J._)`!${e} || ${s}`,delete i.null,delete i.array,delete i.object}else o=J.nil;i.number&&delete i.integer;for(let s in i)o=(0,J.and)(o,cy(s,e,r,n));return o}ft.checkDataTypes=uy;var kU={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,J._)`{type: ${t}}`:(0,J._)`{type: ${e}}`};function ly(t){let e=SU(t);(0,yU.reportError)(e,kU)}ft.reportTypeError=ly;function SU(t){let{gen:e,data:r,schema:n}=t,o=(0,OS.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var AS=b(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.assignDefaults=void 0;var bi=X(),PU=ye();function IU(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)RS(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,i)=>RS(t,i,o.default))}Zl.assignDefaults=IU;function RS(t,e,r){let{gen:n,compositeRule:o,data:i,opts:s}=t;if(r===void 0)return;let a=(0,bi._)`${i}${(0,bi.getProperty)(e)}`;if(o){(0,PU.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,bi._)`${a} === undefined`;s.useDefaults==="empty"&&(c=(0,bi._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,bi._)`${a} = ${(0,bi.stringify)(r)}`)}});var er=b(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.validateUnion=ke.validateArray=ke.usePattern=ke.callValidateCode=ke.schemaProperties=ke.allSchemaProperties=ke.noPropertyInData=ke.propertyInData=ke.isOwnProperty=ke.hasPropFunc=ke.reportMissingProp=ke.checkMissingProp=ke.checkReportMissingProp=void 0;var Me=X(),dy=ye(),Pn=Kr(),EU=ye();function zU(t,e){let{gen:r,data:n,it:o}=t;r.if(fy(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,Me._)`${e}`},!0),t.error()})}ke.checkReportMissingProp=zU;function TU({gen:t,data:e,it:{opts:r}},n,o){return(0,Me.or)(...n.map(i=>(0,Me.and)(fy(t,e,i,r.ownProperties),(0,Me._)`${o} = ${i}`)))}ke.checkMissingProp=TU;function CU(t,e){t.setParams({missingProperty:e},!0),t.error()}ke.reportMissingProp=CU;function MS(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,Me._)`Object.prototype.hasOwnProperty`})}ke.hasPropFunc=MS;function py(t,e,r){return(0,Me._)`${MS(t)}.call(${e}, ${r})`}ke.isOwnProperty=py;function OU(t,e,r,n){let o=(0,Me._)`${e}${(0,Me.getProperty)(r)} !== undefined`;return n?(0,Me._)`${o} && ${py(t,e,r)}`:o}ke.propertyInData=OU;function fy(t,e,r,n){let o=(0,Me._)`${e}${(0,Me.getProperty)(r)} === undefined`;return n?(0,Me.or)(o,(0,Me.not)(py(t,e,r))):o}ke.noPropertyInData=fy;function DS(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}ke.allSchemaProperties=DS;function jU(t,e){return DS(e).filter(r=>!(0,dy.alwaysValidSchema)(t,e[r]))}ke.schemaProperties=jU;function NU({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:i},it:s},a,c,u){let l=u?(0,Me._)`${t}, ${e}, ${n}${o}`:e,d=[[Pn.default.instancePath,(0,Me.strConcat)(Pn.default.instancePath,i)],[Pn.default.parentData,s.parentData],[Pn.default.parentDataProperty,s.parentDataProperty],[Pn.default.rootData,Pn.default.rootData]];s.opts.dynamicRef&&d.push([Pn.default.dynamicAnchors,Pn.default.dynamicAnchors]);let p=(0,Me._)`${l}, ${r.object(...d)}`;return c!==Me.nil?(0,Me._)`${a}.call(${c}, ${p})`:(0,Me._)`${a}(${p})`}ke.callValidateCode=NU;var RU=(0,Me._)`new RegExp`;function AU({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,i=o(r,n);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,Me._)`${o.code==="new RegExp"?RU:(0,EU.useFunc)(t,o)}(${r}, ${n})`})}ke.usePattern=AU;function MU(t){let{gen:e,data:r,keyword:n,it:o}=t,i=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(i,!0),s(()=>e.break()),i;function s(a){let c=e.const("len",(0,Me._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:dy.Type.Num},i),e.if((0,Me.not)(i),a)})}}ke.validateArray=MU;function DU(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,dy.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let s=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(s,(0,Me._)`${s} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,Me.not)(s))})),t.result(s,()=>t.reset(),()=>t.error(!0))}ke.validateUnion=DU});var LS=b(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.validateKeywordUsage=Cr.validSchemaType=Cr.funcKeywordCode=Cr.macroKeywordCode=void 0;var $t=X(),uo=Kr(),UU=er(),qU=Za();function LU(t,e){let{gen:r,keyword:n,schema:o,parentSchema:i,it:s}=t,a=e.macro.call(s.self,o,i,s),c=qS(r,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:$t.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}Cr.macroKeywordCode=LU;function ZU(t,e){var r;let{gen:n,keyword:o,schema:i,parentSchema:s,$data:a,it:c}=t;VU(c,e);let u=!a&&e.compile?e.compile.call(c.self,i,s,c):e.validate,l=qS(n,o,u),d=n.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)m(),e.modifying&&US(t),g(()=>t.error());else{let v=e.async?f():h();e.modifying&&US(t),g(()=>FU(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>m((0,$t._)`await `),x=>n.assign(d,!1).if((0,$t._)`${x} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,$t._)`${x}.errors`),()=>n.throw(x))),v}function h(){let v=(0,$t._)`${l}.errors`;return n.assign(v,null),m($t.nil),v}function m(v=e.async?(0,$t._)`await `:$t.nil){let x=c.opts.passContext?uo.default.this:uo.default.self,w=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,$t._)`${v}${(0,UU.callValidateCode)(t,l,x,w)}`,e.modifying)}function g(v){var x;n.if((0,$t.not)((x=e.valid)!==null&&x!==void 0?x:d),v)}}Cr.funcKeywordCode=ZU;function US(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,$t._)`${n.parentData}[${n.parentDataProperty}]`))}function FU(t,e){let{gen:r}=t;r.if((0,$t._)`Array.isArray(${e})`,()=>{r.assign(uo.default.vErrors,(0,$t._)`${uo.default.vErrors} === null ? ${e} : ${uo.default.vErrors}.concat(${e})`).assign(uo.default.errors,(0,$t._)`${uo.default.vErrors}.length`),(0,qU.extendErrors)(t)},()=>t.error())}function VU({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function qS(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,$t.stringify)(r)})}function BU(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}Cr.validSchemaType=BU;function HU({schema:t,opts:e,self:r,errSchemaPath:n},o,i){if(Array.isArray(o.keyword)?!o.keyword.includes(i):o.keyword!==i)throw new Error("ajv implementation error");let s=o.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${i}: ${s.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[i])){let c=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}Cr.validateKeywordUsage=HU});var FS=b(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.extendSubschemaMode=In.extendSubschemaData=In.getSubschema=void 0;var Or=X(),ZS=ye();function GU(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:i,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,Or._)`${t.schemaPath}${(0,Or.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,Or._)`${t.schemaPath}${(0,Or.getProperty)(e)}${(0,Or.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,ZS.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||i===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:s,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}In.getSubschema=GU;function WU(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:i,propertyName:s}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,p=a.let("data",(0,Or._)`${e.data}${(0,Or.getProperty)(r)}`,!0);c(p),t.errorPath=(0,Or.str)`${u}${(0,ZS.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,Or._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof Or.Name?o:a.let("data",o,!0);c(u),s!==void 0&&(t.propertyName=s)}i&&(t.dataTypes=i);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}In.extendSubschemaData=WU;function JU(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:i}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),i!==void 0&&(t.allErrors=i),t.jtdDiscriminator=e,t.jtdMetadata=r}In.extendSubschemaMode=JU});var BS=b((W8,VS)=>{"use strict";var En=VS.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};Fl(e,n,o,t,"",t)};En.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};En.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};En.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};En.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Fl(t,e,r,n,o,i,s,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,i,s,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in En.arrayKeywords)for(var p=0;p<d.length;p++)Fl(t,e,r,d[p],o+"/"+l+"/"+p,i,o,l,n,p)}else if(l in En.propsKeywords){if(d&&typeof d=="object")for(var f in d)Fl(t,e,r,d[f],o+"/"+l+"/"+KU(f),i,o,l,n,f)}else(l in En.keywords||t.allKeys&&!(l in En.skipKeywords))&&Fl(t,e,r,d,o+"/"+l,i,o,l,n)}r(n,o,i,s,a,c,u)}}function KU(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var Va=b(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.getSchemaRefs=Ot.resolveUrl=Ot.normalizeId=Ot._getFullPath=Ot.getFullPath=Ot.inlineRef=void 0;var XU=ye(),YU=ha(),QU=BS(),eq=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function tq(t,e=!0){return typeof t=="boolean"?!0:e===!0?!my(t):e?HS(t)<=e:!1}Ot.inlineRef=tq;var rq=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function my(t){for(let e in t){if(rq.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(my)||typeof r=="object"&&my(r))return!0}return!1}function HS(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!eq.has(r)&&(typeof t[r]=="object"&&(0,XU.eachItem)(t[r],n=>e+=HS(n)),e===1/0))return 1/0}return e}function GS(t,e="",r){r!==!1&&(e=xi(e));let n=t.parse(e);return WS(t,n)}Ot.getFullPath=GS;function WS(t,e){return t.serialize(e).split("#")[0]+"#"}Ot._getFullPath=WS;var nq=/#\/?$/;function xi(t){return t?t.replace(nq,""):""}Ot.normalizeId=xi;function oq(t,e,r){return r=xi(r),t.resolve(e,r)}Ot.resolveUrl=oq;var iq=/^[a-z_][-a-z0-9._]*$/i;function sq(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=xi(t[r]||e),i={"":o},s=GS(n,o,!1),a={},c=new Set;return QU(t,{allKeys:!0},(d,p,f,h)=>{if(h===void 0)return;let m=s+p,g=i[h];typeof d[r]=="string"&&(g=v.call(this,d[r])),x.call(this,d.$anchor),x.call(this,d.$dynamicAnchor),i[p]=g;function v(w){let I=this.opts.uriResolver.resolve;if(w=xi(g?I(g,w):w),c.has(w))throw l(w);c.add(w);let k=this.refs[w];return typeof k=="string"&&(k=this.refs[k]),typeof k=="object"?u(d,k.schema,w):w!==xi(m)&&(w[0]==="#"?(u(d,a[w],w),a[w]=d):this.refs[w]=m),w}function x(w){if(typeof w=="string"){if(!iq.test(w))throw new Error(`invalid anchor "${w}"`);v.call(this,`#${w}`)}}}),a;function u(d,p,f){if(p!==void 0&&!YU(d,p))throw l(f)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}Ot.getSchemaRefs=sq});var Ga=b(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.getData=zn.KeywordCxt=zn.validateFunctionCode=void 0;var QS=zS(),JS=Fa(),gy=ay(),Vl=Fa(),aq=AS(),Ha=LS(),hy=FS(),A=X(),B=Kr(),cq=Va(),Xr=ye(),Ba=Za();function uq(t){if(rP(t)&&(nP(t),tP(t))){pq(t);return}eP(t,()=>(0,QS.topBoolOrEmptySchema)(t))}zn.validateFunctionCode=uq;function eP({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},i){o.code.es5?t.func(e,(0,A._)`${B.default.data}, ${B.default.valCxt}`,n.$async,()=>{t.code((0,A._)`"use strict"; ${KS(r,o)}`),dq(t,o),t.code(i)}):t.func(e,(0,A._)`${B.default.data}, ${lq(o)}`,n.$async,()=>t.code(KS(r,o)).code(i))}function lq(t){return(0,A._)`{${B.default.instancePath}="", ${B.default.parentData}, ${B.default.parentDataProperty}, ${B.default.rootData}=${B.default.data}${t.dynamicRef?(0,A._)`, ${B.default.dynamicAnchors}={}`:A.nil}}={}`}function dq(t,e){t.if(B.default.valCxt,()=>{t.var(B.default.instancePath,(0,A._)`${B.default.valCxt}.${B.default.instancePath}`),t.var(B.default.parentData,(0,A._)`${B.default.valCxt}.${B.default.parentData}`),t.var(B.default.parentDataProperty,(0,A._)`${B.default.valCxt}.${B.default.parentDataProperty}`),t.var(B.default.rootData,(0,A._)`${B.default.valCxt}.${B.default.rootData}`),e.dynamicRef&&t.var(B.default.dynamicAnchors,(0,A._)`${B.default.valCxt}.${B.default.dynamicAnchors}`)},()=>{t.var(B.default.instancePath,(0,A._)`""`),t.var(B.default.parentData,(0,A._)`undefined`),t.var(B.default.parentDataProperty,(0,A._)`undefined`),t.var(B.default.rootData,B.default.data),e.dynamicRef&&t.var(B.default.dynamicAnchors,(0,A._)`{}`)})}function pq(t){let{schema:e,opts:r,gen:n}=t;eP(t,()=>{r.$comment&&e.$comment&&iP(t),vq(t),n.let(B.default.vErrors,null),n.let(B.default.errors,0),r.unevaluated&&fq(t),oP(t),bq(t)})}function fq(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,A._)`${r}.evaluated`),e.if((0,A._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,A._)`${t.evaluated}.props`,(0,A._)`undefined`)),e.if((0,A._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,A._)`${t.evaluated}.items`,(0,A._)`undefined`))}function KS(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,A._)`/*# sourceURL=${r} */`:A.nil}function mq(t,e){if(rP(t)&&(nP(t),tP(t))){hq(t,e);return}(0,QS.boolOrEmptySchema)(t,e)}function tP({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function rP(t){return typeof t.schema!="boolean"}function hq(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&iP(t),yq(t),_q(t);let i=n.const("_errs",B.default.errors);oP(t,i),n.var(e,(0,A._)`${i} === ${B.default.errors}`)}function nP(t){(0,Xr.checkUnknownRules)(t),gq(t)}function oP(t,e){if(t.opts.jtd)return XS(t,[],!1,e);let r=(0,JS.getSchemaTypes)(t.schema),n=(0,JS.coerceAndCheckDataType)(t,r);XS(t,r,!n,e)}function gq(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Xr.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function vq(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Xr.checkStrictMode)(t,"default is ignored in the schema root")}function yq(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,cq.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function _q(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function iP({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let i=r.$comment;if(o.$comment===!0)t.code((0,A._)`${B.default.self}.logger.log(${i})`);else if(typeof o.$comment=="function"){let s=(0,A.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,A._)`${B.default.self}.opts.$comment(${i}, ${s}, ${a}.schema)`)}}function bq(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:i}=t;r.$async?e.if((0,A._)`${B.default.errors} === 0`,()=>e.return(B.default.data),()=>e.throw((0,A._)`new ${o}(${B.default.vErrors})`)):(e.assign((0,A._)`${n}.errors`,B.default.vErrors),i.unevaluated&&xq(t),e.return((0,A._)`${B.default.errors} === 0`))}function xq({gen:t,evaluated:e,props:r,items:n}){r instanceof A.Name&&t.assign((0,A._)`${e}.props`,r),n instanceof A.Name&&t.assign((0,A._)`${e}.items`,n)}function XS(t,e,r,n){let{gen:o,schema:i,data:s,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(i.$ref&&(c.ignoreKeywordsWithRef||!(0,Xr.schemaHasRulesButRef)(i,l))){o.block(()=>aP(t,"$ref",l.all.$ref.definition));return}c.jtd||$q(t,e),o.block(()=>{for(let p of l.rules)d(p);d(l.post)});function d(p){(0,gy.shouldUseGroup)(i,p)&&(p.type?(o.if((0,Vl.checkDataType)(p.type,s,c.strictNumbers)),YS(t,p),e.length===1&&e[0]===p.type&&r&&(o.else(),(0,Vl.reportTypeError)(t)),o.endIf()):YS(t,p),a||o.if((0,A._)`${B.default.errors} === ${n||0}`))}}function YS(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,aq.assignDefaults)(t,e.type),r.block(()=>{for(let i of e.rules)(0,gy.shouldUseRule)(n,i)&&aP(t,i.keyword,i.definition,e.type)})}function $q(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(wq(t,e),t.opts.allowUnionTypes||kq(t,e),Sq(t,t.dataTypes))}function wq(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{sP(t.dataTypes,r)||vy(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),Iq(t,e)}}function kq(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&vy(t,"use allowUnionTypes to allow union type keyword")}function Sq(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,gy.shouldUseRule)(t.schema,o)){let{type:i}=o.definition;i.length&&!i.some(s=>Pq(e,s))&&vy(t,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function Pq(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function sP(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function Iq(t,e){let r=[];for(let n of t.dataTypes)sP(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function vy(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Xr.checkStrictMode)(t,e,t.opts.strictTypes)}var Bl=class{constructor(e,r,n){if((0,Ha.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Xr.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",cP(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,Ha.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",B.default.errors))}result(e,r,n){this.failResult((0,A.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,A.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,A._)`${r} !== undefined && (${(0,A.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?Ba.reportExtraError:Ba.reportError)(this,this.def.error,r)}$dataError(){(0,Ba.reportError)(this,this.def.$dataError||Ba.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Ba.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=A.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=A.nil,r=A.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:i,def:s}=this;n.if((0,A.or)((0,A._)`${o} === undefined`,r)),e!==A.nil&&n.assign(e,!0),(i.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==A.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:i}=this;return(0,A.or)(s(),a());function s(){if(n.length){if(!(r instanceof A.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,A._)`${(0,Vl.checkDataTypes)(c,r,i.opts.strictNumbers,Vl.DataType.Wrong)}`}return A.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,A._)`!${c}(${r})`}return A.nil}}subschema(e,r){let n=(0,hy.getSubschema)(this.it,e);(0,hy.extendSubschemaData)(n,this.it,e),(0,hy.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return mq(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Xr.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Xr.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,A.Name)),!0}};zn.KeywordCxt=Bl;function aP(t,e,r,n){let o=new Bl(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,Ha.funcKeywordCode)(o,r):"macro"in r?(0,Ha.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,Ha.funcKeywordCode)(o,r)}var Eq=/^\/(?:[^~]|~0|~1)*$/,zq=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function cP(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,i;if(t==="")return B.default.rootData;if(t[0]==="/"){if(!Eq.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,i=B.default.rootData}else{let u=zq.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(i=r[e-l],!o)return i}let s=i,a=o.split("/");for(let u of a)u&&(i=(0,A._)`${i}${(0,A.getProperty)((0,Xr.unescapeJsonPointer)(u))}`,s=(0,A._)`${s} && ${i}`);return s;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}zn.getData=cP});var Hl=b(_y=>{"use strict";Object.defineProperty(_y,"__esModule",{value:!0});var yy=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};_y.default=yy});var Wa=b($y=>{"use strict";Object.defineProperty($y,"__esModule",{value:!0});var by=Va(),xy=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,by.resolveUrl)(e,r,n),this.missingSchema=(0,by.normalizeId)((0,by.getFullPath)(e,this.missingRef))}};$y.default=xy});var Wl=b(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.resolveSchema=tr.getCompilingSchema=tr.resolveRef=tr.compileSchema=tr.SchemaEnv=void 0;var hr=X(),Tq=Hl(),lo=Kr(),gr=Va(),uP=ye(),Cq=Ga(),$i=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,gr.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};tr.SchemaEnv=$i;function ky(t){let e=lP.call(this,t);if(e)return e;let r=(0,gr.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:i}=this.opts,s=new hr.CodeGen(this.scope,{es5:n,lines:o,ownProperties:i}),a;t.$async&&(a=s.scopeValue("Error",{ref:Tq.default,code:(0,hr._)`require("ajv/dist/runtime/validation_error").default`}));let c=s.scopeName("validate");t.validateName=c;let u={gen:s,allErrors:this.opts.allErrors,data:lo.default.data,parentData:lo.default.parentData,parentDataProperty:lo.default.parentDataProperty,dataNames:[lo.default.data],dataPathArr:[hr.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,hr.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:hr.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,hr._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,Cq.validateFunctionCode)(u),s.optimize(this.opts.code.optimize);let d=s.toString();l=`${s.scopeRefs(lo.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let f=new Function(`${lo.default.self}`,`${lo.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:s._values}),this.opts.unevaluated){let{props:h,items:m}=u;f.evaluated={props:h instanceof hr.Name?void 0:h,items:m instanceof hr.Name?void 0:m,dynamicProps:h instanceof hr.Name,dynamicItems:m instanceof hr.Name},f.source&&(f.source.evaluated=(0,hr.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}tr.compileSchema=ky;function Oq(t,e,r){var n;r=(0,gr.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let i=Rq.call(this,t,r);if(i===void 0){let s=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;s&&(i=new $i({schema:s,schemaId:a,root:t,baseId:e}))}if(i!==void 0)return t.refs[r]=jq.call(this,i)}tr.resolveRef=Oq;function jq(t){return(0,gr.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:ky.call(this,t)}function lP(t){for(let e of this._compilations)if(Nq(e,t))return e}tr.getCompilingSchema=lP;function Nq(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function Rq(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||Gl.call(this,t,e)}function Gl(t,e){let r=this.opts.uriResolver.parse(e),n=(0,gr._getFullPath)(this.opts.uriResolver,r),o=(0,gr.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return wy.call(this,r,t);let i=(0,gr.normalizeId)(n),s=this.refs[i]||this.schemas[i];if(typeof s=="string"){let a=Gl.call(this,t,s);return typeof a?.schema!="object"?void 0:wy.call(this,r,a)}if(typeof s?.schema=="object"){if(s.validate||ky.call(this,s),i===(0,gr.normalizeId)(e)){let{schema:a}=s,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,gr.resolveUrl)(this.opts.uriResolver,o,u)),new $i({schema:a,schemaId:c,root:t,baseId:o})}return wy.call(this,r,s)}}tr.resolveSchema=Gl;var Aq=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function wy(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,uP.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!Aq.has(a)&&u&&(e=(0,gr.resolveUrl)(this.opts.uriResolver,e,u))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,uP.schemaHasRulesButRef)(r,this.RULES)){let a=(0,gr.resolveUrl)(this.opts.uriResolver,e,r.$ref);i=Gl.call(this,n,a)}let{schemaId:s}=this.opts;if(i=i||new $i({schema:r,schemaId:s,root:n,baseId:e}),i.schema!==i.root.schema)return i}});var dP=b((e7,Mq)=>{Mq.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var fP=b(Sy=>{"use strict";Object.defineProperty(Sy,"__esModule",{value:!0});var pP=Lg();pP.code='require("ajv/dist/runtime/uri").default';Sy.default=pP});var xP=b(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.CodeGen=nt.Name=nt.nil=nt.stringify=nt.str=nt._=nt.KeywordCxt=void 0;var Dq=Ga();Object.defineProperty(nt,"KeywordCxt",{enumerable:!0,get:function(){return Dq.KeywordCxt}});var wi=X();Object.defineProperty(nt,"_",{enumerable:!0,get:function(){return wi._}});Object.defineProperty(nt,"str",{enumerable:!0,get:function(){return wi.str}});Object.defineProperty(nt,"stringify",{enumerable:!0,get:function(){return wi.stringify}});Object.defineProperty(nt,"nil",{enumerable:!0,get:function(){return wi.nil}});Object.defineProperty(nt,"Name",{enumerable:!0,get:function(){return wi.Name}});Object.defineProperty(nt,"CodeGen",{enumerable:!0,get:function(){return wi.CodeGen}});var Uq=Hl(),yP=Wa(),qq=sy(),Ja=Wl(),Lq=X(),Ka=Va(),Jl=Fa(),Iy=ye(),mP=dP(),Zq=fP(),_P=(t,e)=>new RegExp(t,e);_P.code="new RegExp";var Fq=["removeAdditional","useDefaults","coerceTypes"],Vq=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),Bq={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Hq={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},hP=200;function Gq(t){var e,r,n,o,i,s,a,c,u,l,d,p,f,h,m,g,v,x,w,I,k,ie,se,Y,be;let We=t.strict,ir=(e=t.code)===null||e===void 0?void 0:e.optimize,xr=ir===!0||ir===void 0?1:ir||0,Hi=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:_P,Vd=(o=t.uriResolver)!==null&&o!==void 0?o:Zq.default;return{strictSchema:(s=(i=t.strictSchema)!==null&&i!==void 0?i:We)!==null&&s!==void 0?s:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:We)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:We)!==null&&l!==void 0?l:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:We)!==null&&p!==void 0?p:"log",strictRequired:(h=(f=t.strictRequired)!==null&&f!==void 0?f:We)!==null&&h!==void 0?h:!1,code:t.code?{...t.code,optimize:xr,regExp:Hi}:{optimize:xr,regExp:Hi},loopRequired:(m=t.loopRequired)!==null&&m!==void 0?m:hP,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:hP,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:(x=t.messages)!==null&&x!==void 0?x:!0,inlineRefs:(w=t.inlineRefs)!==null&&w!==void 0?w:!0,schemaId:(I=t.schemaId)!==null&&I!==void 0?I:"$id",addUsedSchema:(k=t.addUsedSchema)!==null&&k!==void 0?k:!0,validateSchema:(ie=t.validateSchema)!==null&&ie!==void 0?ie:!0,validateFormats:(se=t.validateFormats)!==null&&se!==void 0?se:!0,unicodeRegExp:(Y=t.unicodeRegExp)!==null&&Y!==void 0?Y:!0,int32range:(be=t.int32range)!==null&&be!==void 0?be:!0,uriResolver:Vd}}var Xa=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...Gq(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new Lq.ValueScope({scope:{},prefixes:Vq,es5:r,lines:n}),this.logger=Qq(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,qq.getRules)(),gP.call(this,Bq,e,"NOT SUPPORTED"),gP.call(this,Hq,e,"DEPRECATED","warn"),this._metaOpts=Xq.call(this),e.formats&&Jq.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&Kq.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),Wq.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=mP;n==="id"&&(o={...mP},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await i.call(this,l.$schema);let p=this._addSchema(l,d);return p.validate||s.call(this,p)}async function i(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function s(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof yP.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),s.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await i.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let s of e)this.addSchema(s,void 0,n,o);return this}let i;if(typeof e=="object"){let{schemaId:s}=this.opts;if(i=e[s],i!==void 0&&typeof i!="string")throw new Error(`schema ${s} must be string`)}return r=(0,Ka.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return o}getSchema(e){let r;for(;typeof(r=vP.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new Ja.SchemaEnv({schema:{},schemaId:n});if(r=Ja.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=vP.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,Ka.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(tL.call(this,n,r),!r)return(0,Iy.eachItem)(n,i=>Py.call(this,i)),this;nL.call(this,r);let o={...r,type:(0,Jl.getJSONTypes)(r.type),schemaType:(0,Jl.getJSONTypes)(r.schemaType)};return(0,Iy.eachItem)(n,o.type.length===0?i=>Py.call(this,i,o):i=>o.type.forEach(s=>Py.call(this,i,o,s))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(i=>i.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,i)=>o+r+i)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let i=o.split("/").slice(1),s=e;for(let a of i)s=s[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=s[a];u&&l&&(s[a]=bP(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,i=this.opts.addUsedSchema){let s,{schemaId:a}=this.opts;if(typeof e=="object")s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,Ka.normalizeId)(s||n);let u=Ka.getSchemaRefs.call(this,e,n);return c=new Ja.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):Ja.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{Ja.compileSchema.call(this,e)}finally{this.opts=r}}};Xa.ValidationError=Uq.default;Xa.MissingRefError=yP.default;nt.default=Xa;function gP(t,e,r,n="error"){for(let o in t){let i=o;i in e&&this.logger[n](`${r}: option ${o}. ${t[i]}`)}}function vP(t){return t=(0,Ka.normalizeId)(t),this.schemas[t]||this.refs[t]}function Wq(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function Jq(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function Kq(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function Xq(){let t={...this.opts};for(let e of Fq)delete t[e];return t}var Yq={log(){},warn(){},error(){}};function Qq(t){if(t===!1)return Yq;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var eL=/^[a-z_$][a-z0-9_$:-]*$/i;function tL(t,e){let{RULES:r}=this;if((0,Iy.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!eL.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function Py(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,s=o?i.post:i.rules.find(({type:c})=>c===r);if(s||(s={type:r,rules:[]},i.rules.push(s)),i.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,Jl.getJSONTypes)(e.type),schemaType:(0,Jl.getJSONTypes)(e.schemaType)}};e.before?rL.call(this,s,a,e.before):s.rules.push(a),i.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function rL(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function nL(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=bP(e)),t.validateSchema=this.compile(e,!0))}var oL={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function bP(t){return{anyOf:[t,oL]}}});var $P=b(Ey=>{"use strict";Object.defineProperty(Ey,"__esModule",{value:!0});var iL={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Ey.default=iL});var PP=b(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.callRef=po.getValidate=void 0;var sL=Wa(),wP=er(),jt=X(),ki=Kr(),kP=Wl(),Kl=ye(),aL={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:i,validateName:s,opts:a,self:c}=n,{root:u}=i;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=kP.resolveRef.call(c,u,o,r);if(l===void 0)throw new sL.default(n.opts.uriResolver,o,r);if(l instanceof kP.SchemaEnv)return p(l);return f(l);function d(){if(i===u)return Xl(t,s,i,i.$async);let h=e.scopeValue("root",{ref:u});return Xl(t,(0,jt._)`${h}.validate`,u,u.$async)}function p(h){let m=SP(t,h);Xl(t,m,h,h.$async)}function f(h){let m=e.scopeValue("schema",a.code.source===!0?{ref:h,code:(0,jt.stringify)(h)}:{ref:h}),g=e.name("valid"),v=t.subschema({schema:h,dataTypes:[],schemaPath:jt.nil,topSchemaRef:m,errSchemaPath:r},g);t.mergeEvaluated(v),t.ok(g)}}};function SP(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,jt._)`${r.scopeValue("wrapper",{ref:e})}.validate`}po.getValidate=SP;function Xl(t,e,r,n){let{gen:o,it:i}=t,{allErrors:s,schemaEnv:a,opts:c}=i,u=c.passContext?ki.default.this:jt.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let h=o.let("valid");o.try(()=>{o.code((0,jt._)`await ${(0,wP.callValidateCode)(t,e,u)}`),f(e),s||o.assign(h,!0)},m=>{o.if((0,jt._)`!(${m} instanceof ${i.ValidationError})`,()=>o.throw(m)),p(m),s||o.assign(h,!1)}),t.ok(h)}function d(){t.result((0,wP.callValidateCode)(t,e,u),()=>f(e),()=>p(e))}function p(h){let m=(0,jt._)`${h}.errors`;o.assign(ki.default.vErrors,(0,jt._)`${ki.default.vErrors} === null ? ${m} : ${ki.default.vErrors}.concat(${m})`),o.assign(ki.default.errors,(0,jt._)`${ki.default.vErrors}.length`)}function f(h){var m;if(!i.opts.unevaluated)return;let g=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(i.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(i.props=Kl.mergeEvaluated.props(o,g.props,i.props));else{let v=o.var("props",(0,jt._)`${h}.evaluated.props`);i.props=Kl.mergeEvaluated.props(o,v,i.props,jt.Name)}if(i.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(i.items=Kl.mergeEvaluated.items(o,g.items,i.items));else{let v=o.var("items",(0,jt._)`${h}.evaluated.items`);i.items=Kl.mergeEvaluated.items(o,v,i.items,jt.Name)}}}po.callRef=Xl;po.default=aL});var IP=b(zy=>{"use strict";Object.defineProperty(zy,"__esModule",{value:!0});var cL=$P(),uL=PP(),lL=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",cL.default,uL.default];zy.default=lL});var EP=b(Ty=>{"use strict";Object.defineProperty(Ty,"__esModule",{value:!0});var Yl=X(),Tn=Yl.operators,Ql={maximum:{okStr:"<=",ok:Tn.LTE,fail:Tn.GT},minimum:{okStr:">=",ok:Tn.GTE,fail:Tn.LT},exclusiveMaximum:{okStr:"<",ok:Tn.LT,fail:Tn.GTE},exclusiveMinimum:{okStr:">",ok:Tn.GT,fail:Tn.LTE}},dL={message:({keyword:t,schemaCode:e})=>(0,Yl.str)`must be ${Ql[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Yl._)`{comparison: ${Ql[t].okStr}, limit: ${e}}`},pL={keyword:Object.keys(Ql),type:"number",schemaType:"number",$data:!0,error:dL,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,Yl._)`${r} ${Ql[e].fail} ${n} || isNaN(${r})`)}};Ty.default=pL});var zP=b(Cy=>{"use strict";Object.defineProperty(Cy,"__esModule",{value:!0});var Ya=X(),fL={message:({schemaCode:t})=>(0,Ya.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,Ya._)`{multipleOf: ${t}}`},mL={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:fL,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,i=o.opts.multipleOfPrecision,s=e.let("res"),a=i?(0,Ya._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${i}`:(0,Ya._)`${s} !== parseInt(${s})`;t.fail$data((0,Ya._)`(${n} === 0 || (${s} = ${r}/${n}, ${a}))`)}};Cy.default=mL});var CP=b(Oy=>{"use strict";Object.defineProperty(Oy,"__esModule",{value:!0});function TP(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}Oy.default=TP;TP.code='require("ajv/dist/runtime/ucs2length").default'});var OP=b(jy=>{"use strict";Object.defineProperty(jy,"__esModule",{value:!0});var fo=X(),hL=ye(),gL=CP(),vL={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,fo.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,fo._)`{limit: ${t}}`},yL={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:vL,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,i=e==="maxLength"?fo.operators.GT:fo.operators.LT,s=o.opts.unicode===!1?(0,fo._)`${r}.length`:(0,fo._)`${(0,hL.useFunc)(t.gen,gL.default)}(${r})`;t.fail$data((0,fo._)`${s} ${i} ${n}`)}};jy.default=yL});var jP=b(Ny=>{"use strict";Object.defineProperty(Ny,"__esModule",{value:!0});var _L=er(),ed=X(),bL={message:({schemaCode:t})=>(0,ed.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,ed._)`{pattern: ${t}}`},xL={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:bL,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:i}=t,s=i.opts.unicodeRegExp?"u":"",a=r?(0,ed._)`(new RegExp(${o}, ${s}))`:(0,_L.usePattern)(t,n);t.fail$data((0,ed._)`!${a}.test(${e})`)}};Ny.default=xL});var NP=b(Ry=>{"use strict";Object.defineProperty(Ry,"__esModule",{value:!0});var Qa=X(),$L={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,Qa.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Qa._)`{limit: ${t}}`},wL={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:$L,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?Qa.operators.GT:Qa.operators.LT;t.fail$data((0,Qa._)`Object.keys(${r}).length ${o} ${n}`)}};Ry.default=wL});var RP=b(Ay=>{"use strict";Object.defineProperty(Ay,"__esModule",{value:!0});var ec=er(),tc=X(),kL=ye(),SL={message:({params:{missingProperty:t}})=>(0,tc.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,tc._)`{missingProperty: ${t}}`},PL={keyword:"required",type:"object",schemaType:"array",$data:!0,error:SL,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:i,it:s}=t,{opts:a}=s;if(!i&&r.length===0)return;let c=r.length>=a.loopRequired;if(s.allErrors?u():l(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:h}=t.it;for(let m of r)if(f?.[m]===void 0&&!h.has(m)){let g=s.schemaEnv.baseId+s.errSchemaPath,v=`required property "${m}" is not defined at "${g}" (strictRequired)`;(0,kL.checkStrictMode)(s,v,s.opts.strictRequired)}}function u(){if(c||i)t.block$data(tc.nil,d);else for(let f of r)(0,ec.checkReportMissingProp)(t,f)}function l(){let f=e.let("missing");if(c||i){let h=e.let("valid",!0);t.block$data(h,()=>p(f,h)),t.ok(h)}else e.if((0,ec.checkMissingProp)(t,r,f)),(0,ec.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,ec.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function p(f,h){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(h,(0,ec.propertyInData)(e,o,f,a.ownProperties)),e.if((0,tc.not)(h),()=>{t.error(),e.break()})},tc.nil)}}};Ay.default=PL});var AP=b(My=>{"use strict";Object.defineProperty(My,"__esModule",{value:!0});var rc=X(),IL={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,rc.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,rc._)`{limit: ${t}}`},EL={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:IL,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?rc.operators.GT:rc.operators.LT;t.fail$data((0,rc._)`${r}.length ${o} ${n}`)}};My.default=EL});var td=b(Dy=>{"use strict";Object.defineProperty(Dy,"__esModule",{value:!0});var MP=ha();MP.code='require("ajv/dist/runtime/equal").default';Dy.default=MP});var DP=b(qy=>{"use strict";Object.defineProperty(qy,"__esModule",{value:!0});var Uy=Fa(),ot=X(),zL=ye(),TL=td(),CL={message:({params:{i:t,j:e}})=>(0,ot.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,ot._)`{i: ${t}, j: ${e}}`},OL={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:CL,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:i,schemaCode:s,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=i.items?(0,Uy.getSchemaTypes)(i.items):[];t.block$data(c,l,(0,ot._)`${s} === false`),t.ok(c);function l(){let h=e.let("i",(0,ot._)`${r}.length`),m=e.let("j");t.setParams({i:h,j:m}),e.assign(c,!0),e.if((0,ot._)`${h} > 1`,()=>(d()?p:f)(h,m))}function d(){return u.length>0&&!u.some(h=>h==="object"||h==="array")}function p(h,m){let g=e.name("item"),v=(0,Uy.checkDataTypes)(u,g,a.opts.strictNumbers,Uy.DataType.Wrong),x=e.const("indices",(0,ot._)`{}`);e.for((0,ot._)`;${h}--;`,()=>{e.let(g,(0,ot._)`${r}[${h}]`),e.if(v,(0,ot._)`continue`),u.length>1&&e.if((0,ot._)`typeof ${g} == "string"`,(0,ot._)`${g} += "_"`),e.if((0,ot._)`typeof ${x}[${g}] == "number"`,()=>{e.assign(m,(0,ot._)`${x}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,ot._)`${x}[${g}] = ${h}`)})}function f(h,m){let g=(0,zL.useFunc)(e,TL.default),v=e.name("outer");e.label(v).for((0,ot._)`;${h}--;`,()=>e.for((0,ot._)`${m} = ${h}; ${m}--;`,()=>e.if((0,ot._)`${g}(${r}[${h}], ${r}[${m}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};qy.default=OL});var UP=b(Zy=>{"use strict";Object.defineProperty(Zy,"__esModule",{value:!0});var Ly=X(),jL=ye(),NL=td(),RL={message:"must be equal to constant",params:({schemaCode:t})=>(0,Ly._)`{allowedValue: ${t}}`},AL={keyword:"const",$data:!0,error:RL,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:i}=t;n||i&&typeof i=="object"?t.fail$data((0,Ly._)`!${(0,jL.useFunc)(e,NL.default)}(${r}, ${o})`):t.fail((0,Ly._)`${i} !== ${r}`)}};Zy.default=AL});var qP=b(Fy=>{"use strict";Object.defineProperty(Fy,"__esModule",{value:!0});var nc=X(),ML=ye(),DL=td(),UL={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,nc._)`{allowedValues: ${t}}`},qL={keyword:"enum",schemaType:"array",$data:!0,error:UL,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:i,it:s}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=s.opts.loopEnum,c,u=()=>c??(c=(0,ML.useFunc)(e,DL.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",i);l=(0,nc.or)(...o.map((h,m)=>p(f,m)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",i,f=>e.if((0,nc._)`${u()}(${r}, ${f})`,()=>e.assign(l,!0).break()))}function p(f,h){let m=o[h];return typeof m=="object"&&m!==null?(0,nc._)`${u()}(${r}, ${f}[${h}])`:(0,nc._)`${r} === ${m}`}}};Fy.default=qL});var LP=b(Vy=>{"use strict";Object.defineProperty(Vy,"__esModule",{value:!0});var LL=EP(),ZL=zP(),FL=OP(),VL=jP(),BL=NP(),HL=RP(),GL=AP(),WL=DP(),JL=UP(),KL=qP(),XL=[LL.default,ZL.default,FL.default,VL.default,BL.default,HL.default,GL.default,WL.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},JL.default,KL.default];Vy.default=XL});var Hy=b(oc=>{"use strict";Object.defineProperty(oc,"__esModule",{value:!0});oc.validateAdditionalItems=void 0;var mo=X(),By=ye(),YL={message:({params:{len:t}})=>(0,mo.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,mo._)`{limit: ${t}}`},QL={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:YL,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,By.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}ZP(t,n)}};function ZP(t,e){let{gen:r,schema:n,data:o,keyword:i,it:s}=t;s.items=!0;let a=r.const("len",(0,mo._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,mo._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,By.alwaysValidSchema)(s,n)){let u=r.var("valid",(0,mo._)`${a} <= ${e.length}`);r.if((0,mo.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:i,dataProp:l,dataPropType:By.Type.Num},u),s.allErrors||r.if((0,mo.not)(u),()=>r.break())})}}oc.validateAdditionalItems=ZP;oc.default=QL});var Gy=b(ic=>{"use strict";Object.defineProperty(ic,"__esModule",{value:!0});ic.validateTuple=void 0;var FP=X(),rd=ye(),e6=er(),t6={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return VP(t,"additionalItems",e);r.items=!0,!(0,rd.alwaysValidSchema)(r,e)&&t.ok((0,e6.validateArray)(t))}};function VP(t,e,r=t.schema){let{gen:n,parentSchema:o,data:i,keyword:s,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=rd.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,FP._)`${i}.length`);r.forEach((d,p)=>{(0,rd.alwaysValidSchema)(a,d)||(n.if((0,FP._)`${u} > ${p}`,()=>t.subschema({keyword:s,schemaProp:p,dataProp:p},c)),t.ok(c))});function l(d){let{opts:p,errSchemaPath:f}=a,h=r.length,m=h===d.minItems&&(h===d.maxItems||d[e]===!1);if(p.strictTuples&&!m){let g=`"${s}" is ${h}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,rd.checkStrictMode)(a,g,p.strictTuples)}}}ic.validateTuple=VP;ic.default=t6});var BP=b(Wy=>{"use strict";Object.defineProperty(Wy,"__esModule",{value:!0});var r6=Gy(),n6={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,r6.validateTuple)(t,"items")};Wy.default=n6});var GP=b(Jy=>{"use strict";Object.defineProperty(Jy,"__esModule",{value:!0});var HP=X(),o6=ye(),i6=er(),s6=Hy(),a6={message:({params:{len:t}})=>(0,HP.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,HP._)`{limit: ${t}}`},c6={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:a6,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,o6.alwaysValidSchema)(n,e)&&(o?(0,s6.validateAdditionalItems)(t,o):t.ok((0,i6.validateArray)(t)))}};Jy.default=c6});var WP=b(Ky=>{"use strict";Object.defineProperty(Ky,"__esModule",{value:!0});var rr=X(),nd=ye(),u6={message:({params:{min:t,max:e}})=>e===void 0?(0,rr.str)`must contain at least ${t} valid item(s)`:(0,rr.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,rr._)`{minContains: ${t}}`:(0,rr._)`{minContains: ${t}, maxContains: ${e}}`},l6={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:u6,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t,s,a,{minContains:c,maxContains:u}=n;i.opts.next?(s=c===void 0?1:c,a=u):s=1;let l=e.const("len",(0,rr._)`${o}.length`);if(t.setParams({min:s,max:a}),a===void 0&&s===0){(0,nd.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,nd.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,nd.alwaysValidSchema)(i,r)){let m=(0,rr._)`${l} >= ${s}`;a!==void 0&&(m=(0,rr._)`${m} && ${l} <= ${a}`),t.pass(m);return}i.items=!0;let d=e.name("valid");a===void 0&&s===1?f(d,()=>e.if(d,()=>e.break())):s===0?(e.let(d,!0),a!==void 0&&e.if((0,rr._)`${o}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let m=e.name("_valid"),g=e.let("count",0);f(m,()=>e.if(m,()=>h(g)))}function f(m,g){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:nd.Type.Num,compositeRule:!0},m),g()})}function h(m){e.code((0,rr._)`${m}++`),a===void 0?e.if((0,rr._)`${m} >= ${s}`,()=>e.assign(d,!0).break()):(e.if((0,rr._)`${m} > ${a}`,()=>e.assign(d,!1).break()),s===1?e.assign(d,!0):e.if((0,rr._)`${m} >= ${s}`,()=>e.assign(d,!0)))}}};Ky.default=l6});var XP=b(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.validateSchemaDeps=jr.validatePropertyDeps=jr.error=void 0;var Xy=X(),d6=ye(),sc=er();jr.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,Xy.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,Xy._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var p6={keyword:"dependencies",type:"object",schemaType:"object",error:jr.error,code(t){let[e,r]=f6(t);JP(t,e),KP(t,r)}};function f6({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function JP(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let i=r.let("missing");for(let s in e){let a=e[s];if(a.length===0)continue;let c=(0,sc.propertyInData)(r,n,s,o.opts.ownProperties);t.setParams({property:s,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,sc.checkReportMissingProp)(t,u)}):(r.if((0,Xy._)`${c} && (${(0,sc.checkMissingProp)(t,a,i)})`),(0,sc.reportMissingProp)(t,i),r.else())}}jr.validatePropertyDeps=JP;function KP(t,e=t.schema){let{gen:r,data:n,keyword:o,it:i}=t,s=r.name("valid");for(let a in e)(0,d6.alwaysValidSchema)(i,e[a])||(r.if((0,sc.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},s);t.mergeValidEvaluated(c,s)},()=>r.var(s,!0)),t.ok(s))}jr.validateSchemaDeps=KP;jr.default=p6});var QP=b(Yy=>{"use strict";Object.defineProperty(Yy,"__esModule",{value:!0});var YP=X(),m6=ye(),h6={message:"property name must be valid",params:({params:t})=>(0,YP._)`{propertyName: ${t.propertyName}}`},g6={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:h6,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,m6.alwaysValidSchema)(o,r))return;let i=e.name("valid");e.forIn("key",n,s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},i),e.if((0,YP.not)(i),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(i)}};Yy.default=g6});var e_=b(Qy=>{"use strict";Object.defineProperty(Qy,"__esModule",{value:!0});var od=er(),vr=X(),v6=Kr(),id=ye(),y6={message:"must NOT have additional properties",params:({params:t})=>(0,vr._)`{additionalProperty: ${t.additionalProperty}}`},_6={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:y6,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:i,it:s}=t;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=s;if(s.props=!0,c.removeAdditional!=="all"&&(0,id.alwaysValidSchema)(s,r))return;let u=(0,od.allSchemaProperties)(n.properties),l=(0,od.allSchemaProperties)(n.patternProperties);d(),t.ok((0,vr._)`${i} === ${v6.default.errors}`);function d(){e.forIn("key",o,g=>{!u.length&&!l.length?h(g):e.if(p(g),()=>h(g))})}function p(g){let v;if(u.length>8){let x=(0,id.schemaRefOrVal)(s,n.properties,"properties");v=(0,od.isOwnProperty)(e,x,g)}else u.length?v=(0,vr.or)(...u.map(x=>(0,vr._)`${g} === ${x}`)):v=vr.nil;return l.length&&(v=(0,vr.or)(v,...l.map(x=>(0,vr._)`${(0,od.usePattern)(t,x)}.test(${g})`))),(0,vr.not)(v)}function f(g){e.code((0,vr._)`delete ${o}[${g}]`)}function h(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,id.alwaysValidSchema)(s,r)){let v=e.name("valid");c.removeAdditional==="failing"?(m(g,v,!1),e.if((0,vr.not)(v),()=>{t.reset(),f(g)})):(m(g,v),a||e.if((0,vr.not)(v),()=>e.break()))}}function m(g,v,x){let w={keyword:"additionalProperties",dataProp:g,dataPropType:id.Type.Str};x===!1&&Object.assign(w,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(w,v)}}};Qy.default=_6});var rI=b(r_=>{"use strict";Object.defineProperty(r_,"__esModule",{value:!0});var b6=Ga(),eI=er(),t_=ye(),tI=e_(),x6={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&tI.default.code(new b6.KeywordCxt(i,tI.default,"additionalProperties"));let s=(0,eI.allSchemaProperties)(r);for(let d of s)i.definedProperties.add(d);i.opts.unevaluated&&s.length&&i.props!==!0&&(i.props=t_.mergeEvaluated.props(e,(0,t_.toHash)(s),i.props));let a=s.filter(d=>!(0,t_.alwaysValidSchema)(i,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,eI.propertyInData)(e,o,d,i.opts.ownProperties)),l(d),i.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return i.opts.useDefaults&&!i.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};r_.default=x6});var sI=b(n_=>{"use strict";Object.defineProperty(n_,"__esModule",{value:!0});var nI=er(),sd=X(),oI=ye(),iI=ye(),$6={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:i}=t,{opts:s}=i,a=(0,nI.allSchemaProperties)(r),c=a.filter(m=>(0,oI.alwaysValidSchema)(i,r[m]));if(a.length===0||c.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let u=s.strictSchema&&!s.allowMatchingProperties&&o.properties,l=e.name("valid");i.props!==!0&&!(i.props instanceof sd.Name)&&(i.props=(0,iI.evaluatedPropsToName)(e,i.props));let{props:d}=i;p();function p(){for(let m of a)u&&f(m),i.allErrors?h(m):(e.var(l,!0),h(m),e.if(l))}function f(m){for(let g in u)new RegExp(m).test(g)&&(0,oI.checkStrictMode)(i,`property ${g} matches pattern ${m} (use allowMatchingProperties)`)}function h(m){e.forIn("key",n,g=>{e.if((0,sd._)`${(0,nI.usePattern)(t,m)}.test(${g})`,()=>{let v=c.includes(m);v||t.subschema({keyword:"patternProperties",schemaProp:m,dataProp:g,dataPropType:iI.Type.Str},l),i.opts.unevaluated&&d!==!0?e.assign((0,sd._)`${d}[${g}]`,!0):!v&&!i.allErrors&&e.if((0,sd.not)(l),()=>e.break())})})}}};n_.default=$6});var aI=b(o_=>{"use strict";Object.defineProperty(o_,"__esModule",{value:!0});var w6=ye(),k6={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,w6.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};o_.default=k6});var cI=b(i_=>{"use strict";Object.defineProperty(i_,"__esModule",{value:!0});var S6=er(),P6={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:S6.validateUnion,error:{message:"must match a schema in anyOf"}};i_.default=P6});var uI=b(s_=>{"use strict";Object.defineProperty(s_,"__esModule",{value:!0});var ad=X(),I6=ye(),E6={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,ad._)`{passingSchemas: ${t.passing}}`},z6={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:E6,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let i=r,s=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(s,()=>t.reset(),()=>t.error(!0));function u(){i.forEach((l,d)=>{let p;(0,I6.alwaysValidSchema)(o,l)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,ad._)`${c} && ${s}`).assign(s,!1).assign(a,(0,ad._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(s,!0),e.assign(a,d),p&&t.mergeEvaluated(p,ad.Name)})})}}};s_.default=z6});var lI=b(a_=>{"use strict";Object.defineProperty(a_,"__esModule",{value:!0});var T6=ye(),C6={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((i,s)=>{if((0,T6.alwaysValidSchema)(n,i))return;let a=t.subschema({keyword:"allOf",schemaProp:s},o);t.ok(o),t.mergeEvaluated(a)})}};a_.default=C6});var fI=b(c_=>{"use strict";Object.defineProperty(c_,"__esModule",{value:!0});var cd=X(),pI=ye(),O6={message:({params:t})=>(0,cd.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,cd._)`{failingKeyword: ${t.ifClause}}`},j6={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:O6,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,pI.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=dI(n,"then"),i=dI(n,"else");if(!o&&!i)return;let s=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&i){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,cd.not)(a),u("else"));t.pass(s,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let p=t.subschema({keyword:l},a);e.assign(s,a),t.mergeValidEvaluated(p,s),d?e.assign(d,(0,cd._)`${l}`):t.setParams({ifClause:l})}}}};function dI(t,e){let r=t.schema[e];return r!==void 0&&!(0,pI.alwaysValidSchema)(t,r)}c_.default=j6});var mI=b(u_=>{"use strict";Object.defineProperty(u_,"__esModule",{value:!0});var N6=ye(),R6={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,N6.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};u_.default=R6});var hI=b(l_=>{"use strict";Object.defineProperty(l_,"__esModule",{value:!0});var A6=Hy(),M6=BP(),D6=Gy(),U6=GP(),q6=WP(),L6=XP(),Z6=QP(),F6=e_(),V6=rI(),B6=sI(),H6=aI(),G6=cI(),W6=uI(),J6=lI(),K6=fI(),X6=mI();function Y6(t=!1){let e=[H6.default,G6.default,W6.default,J6.default,K6.default,X6.default,Z6.default,F6.default,L6.default,V6.default,B6.default];return t?e.push(M6.default,U6.default):e.push(A6.default,D6.default),e.push(q6.default),e}l_.default=Y6});var gI=b(d_=>{"use strict";Object.defineProperty(d_,"__esModule",{value:!0});var Fe=X(),Q6={message:({schemaCode:t})=>(0,Fe.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,Fe._)`{format: ${t}}`},e2={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:Q6,code(t,e){let{gen:r,data:n,$data:o,schema:i,schemaCode:s,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?p():f();function p(){let h=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),m=r.const("fDef",(0,Fe._)`${h}[${s}]`),g=r.let("fType"),v=r.let("format");r.if((0,Fe._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(g,(0,Fe._)`${m}.type || "string"`).assign(v,(0,Fe._)`${m}.validate`),()=>r.assign(g,(0,Fe._)`"string"`).assign(v,m)),t.fail$data((0,Fe.or)(x(),w()));function x(){return c.strictSchema===!1?Fe.nil:(0,Fe._)`${s} && !${v}`}function w(){let I=l.$async?(0,Fe._)`(${m}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,Fe._)`${v}(${n})`,k=(0,Fe._)`(typeof ${v} == "function" ? ${I} : ${v}.test(${n}))`;return(0,Fe._)`${v} && ${v} !== true && ${g} === ${e} && !${k}`}}function f(){let h=d.formats[i];if(!h){x();return}if(h===!0)return;let[m,g,v]=w(h);m===e&&t.pass(I());function x(){if(c.strictSchema===!1){d.logger.warn(k());return}throw new Error(k());function k(){return`unknown format "${i}" ignored in schema at path "${u}"`}}function w(k){let ie=k instanceof RegExp?(0,Fe.regexpCode)(k):c.code.formats?(0,Fe._)`${c.code.formats}${(0,Fe.getProperty)(i)}`:void 0,se=r.scopeValue("formats",{key:i,ref:k,code:ie});return typeof k=="object"&&!(k instanceof RegExp)?[k.type||"string",k.validate,(0,Fe._)`${se}.validate`]:["string",k,se]}function I(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!l.$async)throw new Error("async format in sync schema");return(0,Fe._)`await ${v}(${n})`}return typeof g=="function"?(0,Fe._)`${v}(${n})`:(0,Fe._)`${v}.test(${n})`}}}};d_.default=e2});var vI=b(p_=>{"use strict";Object.defineProperty(p_,"__esModule",{value:!0});var t2=gI(),r2=[t2.default];p_.default=r2});var yI=b(Si=>{"use strict";Object.defineProperty(Si,"__esModule",{value:!0});Si.contentVocabulary=Si.metadataVocabulary=void 0;Si.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];Si.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var bI=b(f_=>{"use strict";Object.defineProperty(f_,"__esModule",{value:!0});var n2=IP(),o2=LP(),i2=hI(),s2=vI(),_I=yI(),a2=[n2.default,o2.default,(0,i2.default)(),s2.default,_I.metadataVocabulary,_I.contentVocabulary];f_.default=a2});var $I=b(ud=>{"use strict";Object.defineProperty(ud,"__esModule",{value:!0});ud.DiscrError=void 0;var xI;(function(t){t.Tag="tag",t.Mapping="mapping"})(xI||(ud.DiscrError=xI={}))});var kI=b(h_=>{"use strict";Object.defineProperty(h_,"__esModule",{value:!0});var Pi=X(),m_=$I(),wI=Wl(),c2=Wa(),u2=ye(),l2={message:({params:{discrError:t,tagName:e}})=>t===m_.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,Pi._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},d2={keyword:"discriminator",type:"object",schemaType:"object",error:l2,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:i}=t,{oneOf:s}=o;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,Pi._)`${r}${(0,Pi.getProperty)(a)}`);e.if((0,Pi._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:m_.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let f=p();e.if(!1);for(let h in f)e.elseIf((0,Pi._)`${u} === ${h}`),e.assign(c,d(f[h]));e.else(),t.error(!1,{discrError:m_.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(f){let h=e.name("valid"),m=t.subschema({keyword:"oneOf",schemaProp:f},h);return t.mergeEvaluated(m,Pi.Name),h}function p(){var f;let h={},m=v(o),g=!0;for(let I=0;I<s.length;I++){let k=s[I];if(k?.$ref&&!(0,u2.schemaHasRulesButRef)(k,i.self.RULES)){let se=k.$ref;if(k=wI.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,se),k instanceof wI.SchemaEnv&&(k=k.schema),k===void 0)throw new c2.default(i.opts.uriResolver,i.baseId,se)}let ie=(f=k?.properties)===null||f===void 0?void 0:f[a];if(typeof ie!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(m||v(k)),x(ie,I)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return h;function v({required:I}){return Array.isArray(I)&&I.includes(a)}function x(I,k){if(I.const)w(I.const,k);else if(I.enum)for(let ie of I.enum)w(ie,k);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function w(I,k){if(typeof I!="string"||I in h)throw new Error(`discriminator: "${a}" values must be unique strings`);h[I]=k}}}};h_.default=d2});var SI=b((Z7,p2)=>{p2.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var II=b((De,g_)=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.MissingRefError=De.ValidationError=De.CodeGen=De.Name=De.nil=De.stringify=De.str=De._=De.KeywordCxt=De.Ajv=void 0;var f2=xP(),m2=bI(),h2=kI(),PI=SI(),g2=["/properties"],ld="http://json-schema.org/draft-07/schema",Ii=class extends f2.default{_addVocabularies(){super._addVocabularies(),m2.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(h2.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(PI,g2):PI;this.addMetaSchema(e,ld,!1),this.refs["http://json-schema.org/schema"]=ld}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(ld)?ld:void 0)}};De.Ajv=Ii;g_.exports=De=Ii;g_.exports.Ajv=Ii;Object.defineProperty(De,"__esModule",{value:!0});De.default=Ii;var v2=Ga();Object.defineProperty(De,"KeywordCxt",{enumerable:!0,get:function(){return v2.KeywordCxt}});var Ei=X();Object.defineProperty(De,"_",{enumerable:!0,get:function(){return Ei._}});Object.defineProperty(De,"str",{enumerable:!0,get:function(){return Ei.str}});Object.defineProperty(De,"stringify",{enumerable:!0,get:function(){return Ei.stringify}});Object.defineProperty(De,"nil",{enumerable:!0,get:function(){return Ei.nil}});Object.defineProperty(De,"Name",{enumerable:!0,get:function(){return Ei.Name}});Object.defineProperty(De,"CodeGen",{enumerable:!0,get:function(){return Ei.CodeGen}});var y2=Hl();Object.defineProperty(De,"ValidationError",{enumerable:!0,get:function(){return y2.default}});var _2=Wa();Object.defineProperty(De,"MissingRefError",{enumerable:!0,get:function(){return _2.default}})});var EI=b(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});zi.formatLimitDefinition=void 0;var b2=II(),yr=X(),Cn=yr.operators,dd={formatMaximum:{okStr:"<=",ok:Cn.LTE,fail:Cn.GT},formatMinimum:{okStr:">=",ok:Cn.GTE,fail:Cn.LT},formatExclusiveMaximum:{okStr:"<",ok:Cn.LT,fail:Cn.GTE},formatExclusiveMinimum:{okStr:">",ok:Cn.GT,fail:Cn.LTE}},x2={message:({keyword:t,schemaCode:e})=>(0,yr.str)`should be ${dd[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,yr._)`{comparison: ${dd[t].okStr}, limit: ${e}}`};zi.formatLimitDefinition={keyword:Object.keys(dd),type:"string",schemaType:"string",$data:!0,error:x2,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:i}=t,{opts:s,self:a}=i;if(!s.validateFormats)return;let c=new b2.KeywordCxt(i,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let p=e.scopeValue("formats",{ref:a.formats,code:s.code.formats}),f=e.const("fmt",(0,yr._)`${p}[${c.schemaCode}]`);t.fail$data((0,yr.or)((0,yr._)`typeof ${f} != "object"`,(0,yr._)`${f} instanceof RegExp`,(0,yr._)`typeof ${f}.compare != "function"`,d(f)))}function l(){let p=c.schema,f=a.formats[p];if(!f||f===!0)return;if(typeof f!="object"||f instanceof RegExp||typeof f.compare!="function")throw new Error(`"${o}": format "${p}" does not define "compare" function`);let h=e.scopeValue("formats",{key:p,ref:f,code:s.code.formats?(0,yr._)`${s.code.formats}${(0,yr.getProperty)(p)}`:void 0});t.fail$data(d(h))}function d(p){return(0,yr._)`${p}.compare(${r}, ${n}) ${dd[o].fail} 0`}},dependencies:["format"]};var $2=t=>(t.addKeyword(zi.formatLimitDefinition),t);zi.default=$2});var OI=b((ac,CI)=>{"use strict";Object.defineProperty(ac,"__esModule",{value:!0});var Ti=fS(),w2=EI(),v_=X(),zI=new v_.Name("fullFormats"),k2=new v_.Name("fastFormats"),y_=(t,e={keywords:!0})=>{if(Array.isArray(e))return TI(t,e,Ti.fullFormats,zI),t;let[r,n]=e.mode==="fast"?[Ti.fastFormats,k2]:[Ti.fullFormats,zI],o=e.formats||Ti.formatNames;return TI(t,o,r,n),e.keywords&&(0,w2.default)(t),t};y_.get=(t,e="full")=>{let n=(e==="fast"?Ti.fastFormats:Ti.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function TI(t,e,r,n){var o,i;(o=(i=t.opts.code).formats)!==null&&o!==void 0||(i.formats=(0,v_._)`require("ajv-formats/dist/formats").${n}`);for(let s of e)t.addFormat(s,r[s])}CI.exports=ac=y_;Object.defineProperty(ac,"__esModule",{value:!0});ac.default=y_});var LI=b((tX,qI)=>{qI.exports=UI;UI.sync=E2;var MI=require("fs");function I2(t,e){var r=e.pathExt!==void 0?e.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var n=0;n<r.length;n++){var o=r[n].toLowerCase();if(o&&t.substr(-o.length).toLowerCase()===o)return!0}return!1}function DI(t,e,r){return!t.isSymbolicLink()&&!t.isFile()?!1:I2(e,r)}function UI(t,e,r){MI.stat(t,function(n,o){r(n,n?!1:DI(o,t,e))})}function E2(t,e){return DI(MI.statSync(t),t,e)}});var HI=b((rX,BI)=>{BI.exports=FI;FI.sync=z2;var ZI=require("fs");function FI(t,e,r){ZI.stat(t,function(n,o){r(n,n?!1:VI(o,e))})}function z2(t,e){return VI(ZI.statSync(t),e)}function VI(t,e){return t.isFile()&&T2(t,e)}function T2(t,e){var r=t.mode,n=t.uid,o=t.gid,i=e.uid!==void 0?e.uid:process.getuid&&process.getuid(),s=e.gid!==void 0?e.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),u=parseInt("001",8),l=a|c,d=r&u||r&c&&o===s||r&a&&n===i||r&l&&i===0;return d}});var WI=b((oX,GI)=>{var nX=require("fs"),gd;process.platform==="win32"||global.TESTING_WINDOWS?gd=LI():gd=HI();GI.exports=__;__.sync=C2;function __(t,e,r){if(typeof e=="function"&&(r=e,e={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(n,o){__(t,e||{},function(i,s){i?o(i):n(s)})})}gd(t,e||{},function(n,o){n&&(n.code==="EACCES"||e&&e.ignoreErrors)&&(n=null,o=!1),r(n,o)})}function C2(t,e){try{return gd.sync(t,e||{})}catch(r){if(e&&e.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var tE=b((iX,eE)=>{var Ci=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",JI=require("path"),O2=Ci?";":":",KI=WI(),XI=t=>Object.assign(new Error(`not found: ${t}`),{code:"ENOENT"}),YI=(t,e)=>{let r=e.colon||O2,n=t.match(/\//)||Ci&&t.match(/\\/)?[""]:[...Ci?[process.cwd()]:[],...(e.path||process.env.PATH||"").split(r)],o=Ci?e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",i=Ci?o.split(r):[""];return Ci&&t.indexOf(".")!==-1&&i[0]!==""&&i.unshift(""),{pathEnv:n,pathExt:i,pathExtExe:o}},QI=(t,e,r)=>{typeof e=="function"&&(r=e,e={}),e||(e={});let{pathEnv:n,pathExt:o,pathExtExe:i}=YI(t,e),s=[],a=u=>new Promise((l,d)=>{if(u===n.length)return e.all&&s.length?l(s):d(XI(t));let p=n[u],f=/^".*"$/.test(p)?p.slice(1,-1):p,h=JI.join(f,t),m=!f&&/^\.[\\\/]/.test(t)?t.slice(0,2)+h:h;l(c(m,u,0))}),c=(u,l,d)=>new Promise((p,f)=>{if(d===o.length)return p(a(l+1));let h=o[d];KI(u+h,{pathExt:i},(m,g)=>{if(!m&&g)if(e.all)s.push(u+h);else return p(u+h);return p(c(u,l,d+1))})});return r?a(0).then(u=>r(null,u),r):a(0)},j2=(t,e)=>{e=e||{};let{pathEnv:r,pathExt:n,pathExtExe:o}=YI(t,e),i=[];for(let s=0;s<r.length;s++){let a=r[s],c=/^".*"$/.test(a)?a.slice(1,-1):a,u=JI.join(c,t),l=!c&&/^\.[\\\/]/.test(t)?t.slice(0,2)+u:u;for(let d=0;d<n.length;d++){let p=l+n[d];try{if(KI.sync(p,{pathExt:o}))if(e.all)i.push(p);else return p}catch{}}}if(e.all&&i.length)return i;if(e.nothrow)return null;throw XI(t)};eE.exports=QI;QI.sync=j2});var nE=b((sX,b_)=>{"use strict";var rE=(t={})=>{let e=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(e).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};b_.exports=rE;b_.exports.default=rE});var aE=b((aX,sE)=>{"use strict";var oE=require("path"),N2=tE(),R2=nE();function iE(t,e){let r=t.options.env||process.env,n=process.cwd(),o=t.options.cwd!=null,i=o&&process.chdir!==void 0&&!process.chdir.disabled;if(i)try{process.chdir(t.options.cwd)}catch{}let s;try{s=N2.sync(t.command,{path:r[R2({env:r})],pathExt:e?oE.delimiter:void 0})}catch{}finally{i&&process.chdir(n)}return s&&(s=oE.resolve(o?t.options.cwd:"",s)),s}function A2(t){return iE(t)||iE(t,!0)}sE.exports=A2});var cE=b((cX,$_)=>{"use strict";var x_=/([()\][%!^"`<>&|;, *?])/g;function M2(t){return t=t.replace(x_,"^$1"),t}function D2(t,e){return t=`${t}`,t=t.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),t=t.replace(/(?=(\\+?)?)\1$/,"$1$1"),t=`"${t}"`,t=t.replace(x_,"^$1"),e&&(t=t.replace(x_,"^$1")),t}$_.exports.command=M2;$_.exports.argument=D2});var lE=b((uX,uE)=>{"use strict";uE.exports=/^#!(.*)/});var pE=b((lX,dE)=>{"use strict";var U2=lE();dE.exports=(t="")=>{let e=t.match(U2);if(!e)return null;let[r,n]=e[0].replace(/#! ?/,"").split(" "),o=r.split("/").pop();return o==="env"?n:n?`${o} ${n}`:o}});var mE=b((dX,fE)=>{"use strict";var w_=require("fs"),q2=pE();function L2(t){let r=Buffer.alloc(150),n;try{n=w_.openSync(t,"r"),w_.readSync(n,r,0,150,0),w_.closeSync(n)}catch{}return q2(r.toString())}fE.exports=L2});var yE=b((pX,vE)=>{"use strict";var Z2=require("path"),hE=aE(),gE=cE(),F2=mE(),V2=process.platform==="win32",B2=/\.(?:com|exe)$/i,H2=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function G2(t){t.file=hE(t);let e=t.file&&F2(t.file);return e?(t.args.unshift(t.file),t.command=e,hE(t)):t.file}function W2(t){if(!V2)return t;let e=G2(t),r=!B2.test(e);if(t.options.forceShell||r){let n=H2.test(e);t.command=Z2.normalize(t.command),t.command=gE.command(t.command),t.args=t.args.map(i=>gE.argument(i,n));let o=[t.command].concat(t.args).join(" ");t.args=["/d","/s","/c",`"${o}"`],t.command=process.env.comspec||"cmd.exe",t.options.windowsVerbatimArguments=!0}return t}function J2(t,e,r){e&&!Array.isArray(e)&&(r=e,e=null),e=e?e.slice(0):[],r=Object.assign({},r);let n={command:t,args:e,options:r,file:void 0,original:{command:t,args:e}};return r.shell?n:W2(n)}vE.exports=J2});var xE=b((fX,bE)=>{"use strict";var k_=process.platform==="win32";function S_(t,e){return Object.assign(new Error(`${e} ${t.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${e} ${t.command}`,path:t.command,spawnargs:t.args})}function K2(t,e){if(!k_)return;let r=t.emit;t.emit=function(n,o){if(n==="exit"){let i=_E(o,e);if(i)return r.call(t,"error",i)}return r.apply(t,arguments)}}function _E(t,e){return k_&&t===1&&!e.file?S_(e.original,"spawn"):null}function X2(t,e){return k_&&t===1&&!e.file?S_(e.original,"spawnSync"):null}bE.exports={hookChildProcess:K2,verifyENOENT:_E,verifyENOENTSync:X2,notFoundError:S_}});var kE=b((mX,Oi)=>{"use strict";var $E=require("child_process"),P_=yE(),I_=xE();function wE(t,e,r){let n=P_(t,e,r),o=$E.spawn(n.command,n.args,n.options);return I_.hookChildProcess(o,n),o}function Y2(t,e,r){let n=P_(t,e,r),o=$E.spawnSync(n.command,n.args,n.options);return o.error=o.error||I_.verifyENOENTSync(o.status,n),o}Oi.exports=wE;Oi.exports.spawn=wE;Oi.exports.sync=Y2;Oi.exports._parse=P_;Oi.exports._enoent=I_});var en=b((JX,WE)=>{"use strict";var HE=["nodebuffer","arraybuffer","fragments"],GE=typeof Blob<"u";GE&&HE.push("blob");WE.exports={BINARY_TYPES:HE,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:GE,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Sc=b((KX,Ed)=>{"use strict";var{EMPTY_BUFFER:OZ}=en(),W_=Buffer[Symbol.species];function jZ(t,e){if(t.length===0)return OZ;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let o=0;o<t.length;o++){let i=t[o];r.set(i,n),n+=i.length}return n<e?new W_(r.buffer,r.byteOffset,n):r}function JE(t,e,r,n,o){for(let i=0;i<o;i++)r[n+i]=t[i]^e[i&3]}function KE(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function NZ(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function J_(t){if(J_.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new W_(t):ArrayBuffer.isView(t)?e=new W_(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),J_.readOnly=!1),e}Ed.exports={concat:jZ,mask:JE,toArrayBuffer:NZ,toBuffer:J_,unmask:KE};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");Ed.exports.mask=function(e,r,n,o,i){i<48?JE(e,r,n,o,i):t.mask(e,r,n,o,i)},Ed.exports.unmask=function(e,r){e.length<32?KE(e,r):t.unmask(e,r)}}catch{}});var QE=b((XX,YE)=>{"use strict";var XE=Symbol("kDone"),K_=Symbol("kRun"),X_=class{constructor(e){this[XE]=()=>{this.pending--,this[K_]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[K_]()}[K_](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[XE])}}};YE.exports=X_});var Ic=b((YX,nz)=>{"use strict";var Pc=require("zlib"),ez=Sc(),RZ=QE(),{kStatusCode:tz}=en(),AZ=Buffer[Symbol.species],MZ=Buffer.from([0,0,255,255]),Td=Symbol("permessage-deflate"),tn=Symbol("total-length"),Di=Symbol("callback"),Nn=Symbol("buffers"),Ui=Symbol("error"),zd,Y_=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!zd){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;zd=new RZ(o)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Di];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(o=>!(r.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>o.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let o=r[n];if(o.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(o=o[0],n==="client_max_window_bits"){if(o!==!0){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else if(n==="server_max_window_bits"){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=i}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=o})}),e}decompress(e,r,n){zd.add(o=>{this._decompress(e,r,(i,s)=>{o(),n(i,s)})})}compress(e,r,n){zd.add(o=>{this._compress(e,r,(i,s)=>{o(),n(i,s)})})}_decompress(e,r,n){let o=this._isServer?"client":"server";if(!this._inflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?Pc.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=Pc.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[Td]=this,this._inflate[tn]=0,this._inflate[Nn]=[],this._inflate.on("error",UZ),this._inflate.on("data",rz)}this._inflate[Di]=n,this._inflate.write(e),r&&this._inflate.write(MZ),this._inflate.flush(()=>{let i=this._inflate[Ui];if(i){this._inflate.close(),this._inflate=null,n(i);return}let s=ez.concat(this._inflate[Nn],this._inflate[tn]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[tn]=0,this._inflate[Nn]=[],r&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),n(null,s)})}_compress(e,r,n){let o=this._isServer?"server":"client";if(!this._deflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?Pc.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=Pc.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[tn]=0,this._deflate[Nn]=[],this._deflate.on("data",DZ)}this._deflate[Di]=n,this._deflate.write(e),this._deflate.flush(Pc.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=ez.concat(this._deflate[Nn],this._deflate[tn]);r&&(i=new AZ(i.buffer,i.byteOffset,i.length-4)),this._deflate[Di]=null,this._deflate[tn]=0,this._deflate[Nn]=[],r&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),n(null,i)})}};nz.exports=Y_;function DZ(t){this[Nn].push(t),this[tn]+=t.length}function rz(t){if(this[tn]+=t.length,this[Td]._maxPayload<1||this[tn]<=this[Td]._maxPayload){this[Nn].push(t);return}this[Ui]=new RangeError("Max payload size exceeded"),this[Ui].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Ui][tz]=1009,this.removeListener("data",rz),this.reset()}function UZ(t){if(this[Td]._inflate=null,this[Ui]){this[Di](this[Ui]);return}t[tz]=1007,this[Di](t)}});var qi=b((QX,Cd)=>{"use strict";var{isUtf8:oz}=require("buffer"),{hasBlob:qZ}=en(),LZ=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function ZZ(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function Q_(t){let e=t.length,r=0;for(;r<e;)if((t[r]&128)===0)r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function FZ(t){return qZ&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}Cd.exports={isBlob:FZ,isValidStatusCode:ZZ,isValidUTF8:Q_,tokenChars:LZ};if(oz)Cd.exports.isValidUTF8=function(t){return t.length<24?Q_(t):oz(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");Cd.exports.isValidUTF8=function(e){return e.length<32?Q_(e):t(e)}}catch{}});var ob=b((eY,dz)=>{"use strict";var{Writable:VZ}=require("stream"),iz=Ic(),{BINARY_TYPES:BZ,EMPTY_BUFFER:sz,kStatusCode:HZ,kWebSocket:GZ}=en(),{concat:eb,toArrayBuffer:WZ,unmask:JZ}=Sc(),{isValidStatusCode:KZ,isValidUTF8:az}=qi(),Od=Buffer[Symbol.species],nr=0,cz=1,uz=2,lz=3,tb=4,rb=5,jd=6,nb=class extends VZ{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||BZ[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[GZ]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=nr}_write(e,r,n){if(this._opcode===8&&this._state==nr)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Od(n.buffer,n.byteOffset+e,n.length-e),new Od(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],o=r.length-e;e>=n.length?r.set(this._buffers.shift(),o):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),o),this._buffers[0]=new Od(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case nr:this.getInfo(e);break;case cz:this.getPayloadLength16(e);break;case uz:this.getPayloadLength64(e);break;case lz:this.getMask();break;case tb:this.getData(e);break;case rb:case jd:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if((r[0]&48)!==0){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(o);return}let n=(r[0]&64)===64;if(n&&!this._extensions[iz.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(o);return}if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(o);return}this._payloadLength===126?this._state=cz:this._payloadLength===127?this._state=uz:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(o);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=lz:this._state=tb}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=tb}getData(e){let r=sz;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&JZ(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=rb,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[iz.extensionName].decompress(e,this._fin,(o,i)=>{if(o)return r(o);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(s);return}this._fragments.push(i)}this.dataMessage(r),this._state===nr&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=nr;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=eb(n,r):this._binaryType==="arraybuffer"?o=WZ(eb(n,r)):this._binaryType==="blob"?o=new Blob(n):o=n,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=nr):(this._state=jd,setImmediate(()=>{this.emit("message",o,!0),this._state=nr,this.startLoop(e)}))}else{let o=eb(n,r);if(!this._skipUTF8Validation&&!az(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===rb||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=nr):(this._state=jd,setImmediate(()=>{this.emit("message",o,!1),this._state=nr,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,sz),this.end();else{let n=e.readUInt16BE(0);if(!KZ(n)){let i=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(i);return}let o=new Od(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!az(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(i);return}this._loop=!1,this.emit("conclude",n,o),this.end()}this._state=nr;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=nr):(this._state=jd,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=nr,this.startLoop(r)}))}createError(e,r,n,o,i){this._loop=!1,this._errored=!0;let s=new e(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(s,this.createError),s.code=i,s[HZ]=o,s}};dz.exports=nb});var ab=b((rY,mz)=>{"use strict";var{Duplex:tY}=require("stream"),{randomFillSync:XZ}=require("crypto"),pz=Ic(),{EMPTY_BUFFER:YZ,kWebSocket:QZ,NOOP:eF}=en(),{isBlob:Li,isValidStatusCode:tF}=qi(),{mask:fz,toBuffer:xo}=Sc(),or=Symbol("kByteLength"),rF=Buffer.alloc(4),Nd=8*1024,$o,Zi=Nd,br=0,nF=1,oF=2,ib=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=br,this.onerror=eF,this[QZ]=void 0}static frame(e,r){let n,o=!1,i=2,s=!1;r.mask&&(n=r.maskBuffer||rF,r.generateMask?r.generateMask(n):(Zi===Nd&&($o===void 0&&($o=Buffer.alloc(Nd)),XZ($o,0,Nd),Zi=0),n[0]=$o[Zi++],n[1]=$o[Zi++],n[2]=$o[Zi++],n[3]=$o[Zi++]),s=(n[0]|n[1]|n[2]|n[3])===0,i=6);let a;typeof e=="string"?(!r.mask||s)&&r[or]!==void 0?a=r[or]:(e=Buffer.from(e),a=e.length):(a=e.length,o=r.mask&&r.readOnly&&!s);let c=a;a>=65536?(i+=8,c=127):a>125&&(i+=2,c=126);let u=Buffer.allocUnsafe(o?a+i:i);return u[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(u[0]|=64),u[1]=c,c===126?u.writeUInt16BE(a,2):c===127&&(u[2]=u[3]=0,u.writeUIntBE(a,4,6)),r.mask?(u[1]|=128,u[i-4]=n[0],u[i-3]=n[1],u[i-2]=n[2],u[i-1]=n[3],s?[u,e]:o?(fz(e,n,u,i,a),[u]):(fz(e,n,e,0,a),[u,e])):[u,e]}close(e,r,n,o){let i;if(e===void 0)i=YZ;else{if(typeof e!="number"||!tF(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof r=="string"?i.write(r,2):i.set(r,2)}}let s={[or]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==br?this.enqueue([this.dispatch,i,!1,s,o]):this.sendFrame(t.frame(i,s),o)}ping(e,r,n){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):Li(e)?(o=e.size,i=!1):(e=xo(e),o=e.length,i=xo.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[or]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};Li(e)?this._state!==br?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):this._state!==br?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}pong(e,r,n){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):Li(e)?(o=e.size,i=!1):(e=xo(e),o=e.length,i=xo.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[or]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};Li(e)?this._state!==br?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):this._state!==br?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}send(e,r,n){let o=this._extensions[pz.extensionName],i=r.binary?2:1,s=r.compress,a,c;typeof e=="string"?(a=Buffer.byteLength(e),c=!1):Li(e)?(a=e.size,c=!1):(e=xo(e),a=e.length,c=xo.readOnly),this._firstFragment?(this._firstFragment=!1,s&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=a>=o._threshold),this._compress=s):(s=!1,i=0),r.fin&&(this._firstFragment=!0);let u={[or]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:s};Li(e)?this._state!==br?this.enqueue([this.getBlobData,e,this._compress,u,n]):this.getBlobData(e,this._compress,u,n):this._state!==br?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}getBlobData(e,r,n,o){this._bufferedBytes+=n[or],this._state=oF,e.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(sb,this,a,o);return}this._bufferedBytes-=n[or];let s=xo(i);r?this.dispatch(s,r,n,o):(this._state=br,this.sendFrame(t.frame(s,n),o),this.dequeue())}).catch(i=>{process.nextTick(iF,this,i,o)})}dispatch(e,r,n,o){if(!r){this.sendFrame(t.frame(e,n),o);return}let i=this._extensions[pz.extensionName];this._bufferedBytes+=n[or],this._state=nF,i.compress(e,n.fin,(s,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");sb(this,c,o);return}this._bufferedBytes-=n[or],this._state=br,n.readOnly=!1,this.sendFrame(t.frame(a,n),o),this.dequeue()})}dequeue(){for(;this._state===br&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][or],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][or],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};mz.exports=ib;function sb(t,e,r){typeof r=="function"&&r(e);for(let n=0;n<t._queue.length;n++){let o=t._queue[n],i=o[o.length-1];typeof i=="function"&&i(e)}}function iF(t,e,r){sb(t,e,r),t.onerror(e)}});var wz=b((nY,$z)=>{"use strict";var{kForOnEventAttribute:Ec,kListener:cb}=en(),hz=Symbol("kCode"),gz=Symbol("kData"),vz=Symbol("kError"),yz=Symbol("kMessage"),_z=Symbol("kReason"),Fi=Symbol("kTarget"),bz=Symbol("kType"),xz=Symbol("kWasClean"),rn=class{constructor(e){this[Fi]=null,this[bz]=e}get target(){return this[Fi]}get type(){return this[bz]}};Object.defineProperty(rn.prototype,"target",{enumerable:!0});Object.defineProperty(rn.prototype,"type",{enumerable:!0});var wo=class extends rn{constructor(e,r={}){super(e),this[hz]=r.code===void 0?0:r.code,this[_z]=r.reason===void 0?"":r.reason,this[xz]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[hz]}get reason(){return this[_z]}get wasClean(){return this[xz]}};Object.defineProperty(wo.prototype,"code",{enumerable:!0});Object.defineProperty(wo.prototype,"reason",{enumerable:!0});Object.defineProperty(wo.prototype,"wasClean",{enumerable:!0});var Vi=class extends rn{constructor(e,r={}){super(e),this[vz]=r.error===void 0?null:r.error,this[yz]=r.message===void 0?"":r.message}get error(){return this[vz]}get message(){return this[yz]}};Object.defineProperty(Vi.prototype,"error",{enumerable:!0});Object.defineProperty(Vi.prototype,"message",{enumerable:!0});var zc=class extends rn{constructor(e,r={}){super(e),this[gz]=r.data===void 0?null:r.data}get data(){return this[gz]}};Object.defineProperty(zc.prototype,"data",{enumerable:!0});var sF={addEventListener(t,e,r={}){for(let o of this.listeners(t))if(!r[Ec]&&o[cb]===e&&!o[Ec])return;let n;if(t==="message")n=function(i,s){let a=new zc("message",{data:s?i:i.toString()});a[Fi]=this,Rd(e,this,a)};else if(t==="close")n=function(i,s){let a=new wo("close",{code:i,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Fi]=this,Rd(e,this,a)};else if(t==="error")n=function(i){let s=new Vi("error",{error:i,message:i.message});s[Fi]=this,Rd(e,this,s)};else if(t==="open")n=function(){let i=new rn("open");i[Fi]=this,Rd(e,this,i)};else return;n[Ec]=!!r[Ec],n[cb]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[cb]===e&&!r[Ec]){this.removeListener(t,r);break}}};$z.exports={CloseEvent:wo,ErrorEvent:Vi,Event:rn,EventTarget:sF,MessageEvent:zc};function Rd(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var ub=b((oY,kz)=>{"use strict";var{tokenChars:Tc}=qi();function Nr(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function aF(t){let e=Object.create(null),r=Object.create(null),n=!1,o=!1,i=!1,s,a,c=-1,u=-1,l=-1,d=0;for(;d<t.length;d++)if(u=t.charCodeAt(d),s===void 0)if(l===-1&&Tc[u]===1)c===-1&&(c=d);else if(d!==0&&(u===32||u===9))l===-1&&c!==-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d);let f=t.slice(c,l);u===44?(Nr(e,f,r),r=Object.create(null)):s=f,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);else if(a===void 0)if(l===-1&&Tc[u]===1)c===-1&&(c=d);else if(u===32||u===9)l===-1&&c!==-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d),Nr(r,t.slice(c,l),!0),u===44&&(Nr(e,s,r),r=Object.create(null),s=void 0),c=l=-1}else if(u===61&&c!==-1&&l===-1)a=t.slice(c,d),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(o){if(Tc[u]!==1)throw new SyntaxError(`Unexpected character at index ${d}`);c===-1?c=d:n||(n=!0),o=!1}else if(i)if(Tc[u]===1)c===-1&&(c=d);else if(u===34&&c!==-1)i=!1,l=d;else if(u===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(u===34&&t.charCodeAt(d-1)===61)i=!0;else if(l===-1&&Tc[u]===1)c===-1&&(c=d);else if(c!==-1&&(u===32||u===9))l===-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d);let f=t.slice(c,l);n&&(f=f.replace(/\\/g,""),n=!1),Nr(r,a,f),u===44&&(Nr(e,s,r),r=Object.create(null),s=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);if(c===-1||i||u===32||u===9)throw new SyntaxError("Unexpected end of input");l===-1&&(l=d);let p=t.slice(c,l);return s===void 0?Nr(e,p,r):(a===void 0?Nr(r,p,!0):n?Nr(r,a,p.replace(/\\/g,"")):Nr(r,a,p),Nr(e,s,r)),e}function cF(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(o=>{let i=n[o];return Array.isArray(i)||(i=[i]),i.map(s=>s===!0?o:`${o}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}kz.exports={format:cF,parse:aF}});var Ud=b((aY,Az)=>{"use strict";var uF=require("events"),lF=require("https"),dF=require("http"),Iz=require("net"),pF=require("tls"),{randomBytes:fF,createHash:mF}=require("crypto"),{Duplex:iY,Readable:sY}=require("stream"),{URL:lb}=require("url"),Rn=Ic(),hF=ob(),gF=ab(),{isBlob:vF}=qi(),{BINARY_TYPES:Sz,EMPTY_BUFFER:Ad,GUID:yF,kForOnEventAttribute:db,kListener:_F,kStatusCode:bF,kWebSocket:Je,NOOP:Ez}=en(),{EventTarget:{addEventListener:xF,removeEventListener:$F}}=wz(),{format:wF,parse:kF}=ub(),{toBuffer:SF}=Sc(),PF=30*1e3,zz=Symbol("kAborted"),pb=[8,13],nn=["CONNECTING","OPEN","CLOSING","CLOSED"],IF=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,qe=class t extends uF{constructor(e,r,n){super(),this._binaryType=Sz[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Ad,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),Tz(this,e,r,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){Sz.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let o=new hF({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new gF(e,this._extensions,n.generateMask);this._receiver=o,this._sender=i,this._socket=e,o[Je]=this,i[Je]=this,e[Je]=this,o.on("conclude",TF),o.on("drain",CF),o.on("error",OF),o.on("message",jF),o.on("ping",NF),o.on("pong",RF),i.onerror=AF,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",jz),e.on("data",Dd),e.on("end",Nz),e.on("error",Rz),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Rn.extensionName]&&this._extensions[Rn.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Ft(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Oz(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){fb(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Ad,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){fb(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Ad,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){fb(this,e,n);return}let o={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[Rn.extensionName]||(o.compress=!1),this._sender.send(e||Ad,o,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Ft(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(qe,"CONNECTING",{enumerable:!0,value:nn.indexOf("CONNECTING")});Object.defineProperty(qe.prototype,"CONNECTING",{enumerable:!0,value:nn.indexOf("CONNECTING")});Object.defineProperty(qe,"OPEN",{enumerable:!0,value:nn.indexOf("OPEN")});Object.defineProperty(qe.prototype,"OPEN",{enumerable:!0,value:nn.indexOf("OPEN")});Object.defineProperty(qe,"CLOSING",{enumerable:!0,value:nn.indexOf("CLOSING")});Object.defineProperty(qe.prototype,"CLOSING",{enumerable:!0,value:nn.indexOf("CLOSING")});Object.defineProperty(qe,"CLOSED",{enumerable:!0,value:nn.indexOf("CLOSED")});Object.defineProperty(qe.prototype,"CLOSED",{enumerable:!0,value:nn.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(qe.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(qe.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[db])return e[_F];return null},set(e){for(let r of this.listeners(t))if(r[db]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[db]:!0})}})});qe.prototype.addEventListener=xF;qe.prototype.removeEventListener=$F;Az.exports=qe;function Tz(t,e,r,n){let o={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:pb[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=o.autoPong,!pb.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${pb.join(", ")})`);let i;if(e instanceof lb)i=e;else try{i=new lb(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),t._url=i.href;let s=i.protocol==="wss:",a=i.protocol==="ws+unix:",c;if(i.protocol!=="ws:"&&!s&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"),c){let m=new SyntaxError(c);if(t._redirects===0)throw m;Md(t,m);return}let u=s?443:80,l=fF(16).toString("base64"),d=s?lF.request:dF.request,p=new Set,f;if(o.createConnection=o.createConnection||(s?zF:EF),o.defaultPort=o.defaultPort||u,o.port=i.port||u,o.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},o.path=i.pathname+i.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(f=new Rn(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=wF({[Rn.extensionName]:f.offer()})),r.length){for(let m of r){if(typeof m!="string"||!IF.test(m)||p.has(m))throw new SyntaxError("An invalid or duplicated subprotocol was specified");p.add(m)}o.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(i.username||i.password)&&(o.auth=`${i.username}:${i.password}`),a){let m=o.path.split(":");o.socketPath=m[0],o.path=m[1]}let h;if(o.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=s,t._originalHostOrSocketPath=a?o.socketPath:i.host;let m=n&&n.headers;if(n={...n,headers:{}},m)for(let[g,v]of Object.entries(m))n.headers[g.toLowerCase()]=v}else if(t.listenerCount("redirect")===0){let m=a?t._originalIpc?o.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:i.host===t._originalHostOrSocketPath;(!m||t._originalSecure&&!s)&&(delete o.headers.authorization,delete o.headers.cookie,m||delete o.headers.host,o.auth=void 0)}o.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),h=t._req=d(o),t._redirects&&t.emit("redirect",t.url,h)}else h=t._req=d(o);o.timeout&&h.on("timeout",()=>{Ft(t,h,"Opening handshake has timed out")}),h.on("error",m=>{h===null||h[zz]||(h=t._req=null,Md(t,m))}),h.on("response",m=>{let g=m.headers.location,v=m.statusCode;if(g&&o.followRedirects&&v>=300&&v<400){if(++t._redirects>o.maxRedirects){Ft(t,h,"Maximum redirects exceeded");return}h.abort();let x;try{x=new lb(g,e)}catch{let I=new SyntaxError(`Invalid URL: ${g}`);Md(t,I);return}Tz(t,x,r,n)}else t.emit("unexpected-response",h,m)||Ft(t,h,`Unexpected server response: ${m.statusCode}`)}),h.on("upgrade",(m,g,v)=>{if(t.emit("upgrade",m),t.readyState!==qe.CONNECTING)return;h=t._req=null;let x=m.headers.upgrade;if(x===void 0||x.toLowerCase()!=="websocket"){Ft(t,g,"Invalid Upgrade header");return}let w=mF("sha1").update(l+yF).digest("base64");if(m.headers["sec-websocket-accept"]!==w){Ft(t,g,"Invalid Sec-WebSocket-Accept header");return}let I=m.headers["sec-websocket-protocol"],k;if(I!==void 0?p.size?p.has(I)||(k="Server sent an invalid subprotocol"):k="Server sent a subprotocol but none was requested":p.size&&(k="Server sent no subprotocol"),k){Ft(t,g,k);return}I&&(t._protocol=I);let ie=m.headers["sec-websocket-extensions"];if(ie!==void 0){if(!f){Ft(t,g,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let se;try{se=kF(ie)}catch{Ft(t,g,"Invalid Sec-WebSocket-Extensions header");return}let Y=Object.keys(se);if(Y.length!==1||Y[0]!==Rn.extensionName){Ft(t,g,"Server indicated an extension that was not requested");return}try{f.accept(se[Rn.extensionName])}catch{Ft(t,g,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[Rn.extensionName]=f}t.setSocket(g,v,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(h,t):h.end()}function Md(t,e){t._readyState=qe.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function EF(t){return t.path=t.socketPath,Iz.connect(t)}function zF(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=Iz.isIP(t.host)?"":t.host),pF.connect(t)}function Ft(t,e,r){t._readyState=qe.CLOSING;let n=new Error(r);Error.captureStackTrace(n,Ft),e.setHeader?(e[zz]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Md,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function fb(t,e,r){if(e){let n=vF(e)?e.size:SF(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${nn[t.readyState]})`);process.nextTick(r,n)}}function TF(t,e){let r=this[Je];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[Je]!==void 0&&(r._socket.removeListener("data",Dd),process.nextTick(Cz,r._socket),t===1005?r.close():r.close(t,e))}function CF(){let t=this[Je];t.isPaused||t._socket.resume()}function OF(t){let e=this[Je];e._socket[Je]!==void 0&&(e._socket.removeListener("data",Dd),process.nextTick(Cz,e._socket),e.close(t[bF])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function Pz(){this[Je].emitClose()}function jF(t,e){this[Je].emit("message",t,e)}function NF(t){let e=this[Je];e._autoPong&&e.pong(t,!this._isServer,Ez),e.emit("ping",t)}function RF(t){this[Je].emit("pong",t)}function Cz(t){t.resume()}function AF(t){let e=this[Je];e.readyState!==qe.CLOSED&&(e.readyState===qe.OPEN&&(e._readyState=qe.CLOSING,Oz(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function Oz(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),PF)}function jz(){let t=this[Je];this.removeListener("close",jz),this.removeListener("data",Dd),this.removeListener("end",Nz),t._readyState=qe.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[Je]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",Pz),t._receiver.on("finish",Pz))}function Dd(t){this[Je]._receiver.write(t)||this.pause()}function Nz(){let t=this[Je];t._readyState=qe.CLOSING,t._receiver.end(),this.end()}function Rz(){let t=this[Je];this.removeListener("error",Rz),this.on("error",Ez),t&&(t._readyState=qe.CLOSING,this.destroy())}});var qz=b((uY,Uz)=>{"use strict";var cY=Ud(),{Duplex:MF}=require("stream");function Mz(t){t.emit("close")}function DF(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Dz(t){this.removeListener("error",Dz),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function UF(t,e){let r=!0,n=new MF({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(i,s){let a=!s&&n._readableState.objectMode?i.toString():i;n.push(a)||t.pause()}),t.once("error",function(i){n.destroyed||(r=!1,n.destroy(i))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(o,i){if(t.readyState===t.CLOSED){i(o),process.nextTick(Mz,n);return}let s=!1;t.once("error",function(c){s=!0,i(c)}),t.once("close",function(){s||i(o),process.nextTick(Mz,n)}),r&&t.terminate()},n._final=function(o){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(o)});return}t._socket!==null&&(t._socket._writableState.finished?(o(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){o()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(o,i,s){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(o,i,s)});return}t.send(o,s)},n.on("end",DF),n.on("error",Dz),n}Uz.exports=UF});var Zz=b((lY,Lz)=>{"use strict";var{tokenChars:qF}=qi();function LF(t){let e=new Set,r=-1,n=-1,o=0;for(o;o<t.length;o++){let s=t.charCodeAt(o);if(n===-1&&qF[s]===1)r===-1&&(r=o);else if(o!==0&&(s===32||s===9))n===-1&&r!==-1&&(n=o);else if(s===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${o}`);n===-1&&(n=o);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let i=t.slice(r,o);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}Lz.exports={parse:LF}});var Jz=b((pY,Wz)=>{"use strict";var ZF=require("events"),qd=require("http"),{Duplex:dY}=require("stream"),{createHash:FF}=require("crypto"),Fz=ub(),ko=Ic(),VF=Zz(),BF=Ud(),{GUID:HF,kWebSocket:GF}=en(),WF=/^[+/0-9A-Za-z]{22}==$/,Vz=0,Bz=1,Gz=2,mb=class extends ZF{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:BF,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=qd.createServer((n,o)=>{let i=qd.STATUS_CODES[426];o.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),o.end(i)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=JF(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,i,s)=>{this.handleUpgrade(o,i,s,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Vz}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Gz){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Cc,this);return}if(e&&this.once("close",e),this._state!==Bz)if(this._state=Bz,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Cc,this):process.nextTick(Cc,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Cc(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,o){r.on("error",Hz);let i=e.headers["sec-websocket-key"],s=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){So(this,e,r,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){So(this,e,r,400,"Invalid Upgrade header");return}if(i===void 0||!WF.test(i)){So(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){So(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){Oc(r,400);return}let c=e.headers["sec-websocket-protocol"],u=new Set;if(c!==void 0)try{u=VF.parse(c)}catch{So(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let l=e.headers["sec-websocket-extensions"],d={};if(this.options.perMessageDeflate&&l!==void 0){let p=new ko(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let f=Fz.parse(l);f[ko.extensionName]&&(p.accept(f[ko.extensionName]),d[ko.extensionName]=p)}catch{So(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let p={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(p,(f,h,m,g)=>{if(!f)return Oc(r,h||401,m,g);this.completeUpgrade(d,i,u,e,r,n,o)});return}if(!this.options.verifyClient(p))return Oc(r,401)}this.completeUpgrade(d,i,u,e,r,n,o)}completeUpgrade(e,r,n,o,i,s,a){if(!i.readable||!i.writable)return i.destroy();if(i[GF])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Vz)return Oc(i,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${FF("sha1").update(r+HF).digest("base64")}`],l=new this.options.WebSocket(null,void 0,this.options);if(n.size){let d=this.options.handleProtocols?this.options.handleProtocols(n,o):n.values().next().value;d&&(u.push(`Sec-WebSocket-Protocol: ${d}`),l._protocol=d)}if(e[ko.extensionName]){let d=e[ko.extensionName].params,p=Fz.format({[ko.extensionName]:[d]});u.push(`Sec-WebSocket-Extensions: ${p}`),l._extensions=e}this.emit("headers",u,o),i.write(u.concat(`\r
`).join(`\r
`)),i.removeListener("error",Hz),l.setSocket(i,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(l),l.on("close",()=>{this.clients.delete(l),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Cc,this)})),a(l,o)}};Wz.exports=mb;function JF(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function Cc(t){t._state=Gz,t.emit("close")}function Hz(){this.destroy()}function Oc(t,e,r,n){r=r||qd.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${qd.STATUS_CODES[e]}\r
`+Object.keys(n).map(o=>`${o}: ${n[o]}`).join(`\r
`)+`\r
\r
`+r)}function So(t,e,r,n,o,i){if(t.listenerCount("wsClientError")){let s=new Error(o);Error.captureStackTrace(s,So),t.emit("wsClientError",s,r,e)}else Oc(r,n,o,i)}});var sV={};An(sV,{activate:()=>oV,deactivate:()=>iV});module.exports=o1(sV);var Se=Le(require("vscode"));var mt=require("crypto"),Xz=require("http"),Zd=Le(require("os")),$=Le(require("vscode")),Rt=Le(require("fs")),wt=Le(require("path"));var At=Le(require("fs")),Io=Le(require("path")),yb=Le(require("vscode")),Nc=class{storageDir;writeQueue=[];flushInterval;FLUSH_MS=2e3;constructor(e){this.storageDir=Io.join(e.globalStorageUri.fsPath,"audit_logs"),this.ensureStorageDir(),this.startPeriodicFlush(),this.cleanupOldLogs().catch(r=>console.error("Failed to cleanup old logs:",r))}async cleanupOldLogs(){let r=yb.workspace.getConfiguration("githubCopilotApi.audit").get("retentionDays",30);if(!(r<=0))try{let n=await At.promises.readdir(this.storageDir),o=Date.now(),i=r*24*60*60*1e3;for(let s of n){if(!s.startsWith("audit-")||!s.endsWith(".jsonl"))continue;let a=s.slice(6,-6),c=new Date(a).getTime();if(!isNaN(c)&&o-c>i){let u=Io.join(this.storageDir,s);await At.promises.unlink(u)}}}catch(n){console.error("Error cleaning up old audit logs:",n)}}ensureStorageDir(){At.existsSync(this.storageDir)||At.mkdirSync(this.storageDir,{recursive:!0})}async logRequest(e){this.writeQueue.push(e)}startPeriodicFlush(){this.flushInterval&&clearInterval(this.flushInterval),this.flushInterval=setInterval(()=>this.flush(),this.FLUSH_MS)}async flush(){if(this.writeQueue.length===0)return;let e=[...this.writeQueue];this.writeQueue=[];let r=new Map;for(let n of e){let o=n.timestamp.split("T")[0];r.has(o)||r.set(o,[]),r.get(o).push(n)}for(let[n,o]of r){let i=Io.join(this.storageDir,`audit-${n}.jsonl`),s=o.map(a=>JSON.stringify(a)).join(`
`)+`
`;try{await At.promises.appendFile(i,s,"utf8")}catch(a){console.error(`Failed to write audit logs for ${n}:`,a)}}}async getDailyStats(e=30){let r=[],n=new Date;for(let o=0;o<e;o++){let i=new Date(n);i.setDate(i.getDate()-o);let s=i.toISOString().split("T")[0],a=Io.join(this.storageDir,`audit-${s}.jsonl`);if(At.existsSync(a))try{let u=(await At.promises.readFile(a,"utf8")).trim().split(`
`),l=0,d=0,p=0,f=0,h=0,m=new Set;for(let g of u)if(g)try{let v=JSON.parse(g);l++,d+=v.durationMs,v.tokensIn&&(p+=v.tokensIn),v.tokensOut&&(f+=v.tokensOut),v.status>=400&&h++,v.ip&&m.add(v.ip)}catch{}r.push({date:s,totalRequests:l,avgLatency:l>0?Math.round(d/l):0,tokensIn:p,tokensOut:f,totalTokens:p+f,errorCount:h,uniqueIps:m.size})}catch(c){console.error(`Error reading log ${a}`,c)}else r.push({date:s,totalRequests:0,avgLatency:0,tokensIn:0,tokensOut:0,totalTokens:0,errorCount:0,uniqueIps:0})}return r.sort((o,i)=>o.date.localeCompare(i.date))}async getLogEntries(e=1,r=10){try{if(!At.existsSync(this.storageDir))return{total:0,entries:[]};let o=(await At.promises.readdir(this.storageDir)).filter(u=>u.startsWith("audit-")&&u.endsWith(".jsonl")).sort().reverse(),i=[];for(let u of o.slice(0,14))try{let l=await At.promises.readFile(Io.join(this.storageDir,u),"utf8"),d=[];l.split(`
`).forEach(p=>{if(p.trim())try{let f=JSON.parse(p);f&&f.timestamp&&d.push(f)}catch{}}),i=i.concat(d.reverse())}catch(l){console.error(`[AuditService] Error reading ${u}`,l)}i.sort((u,l)=>new Date(l.timestamp).getTime()-new Date(u.timestamp).getTime());let s=i.length,a=(e-1)*r,c=a+r;return{total:s,entries:i.slice(a,c)}}catch(n){return console.error("[AuditService] Failed to get logs:",n),{total:0,entries:[]}}}getLogFolderPath(){return this.storageDir}async getLifetimeStats(){return(await this.getDailyStats(365)).reduce((r,n)=>({totalRequests:r.totalRequests+n.totalRequests,totalTokensIn:r.totalTokensIn+n.tokensIn,totalTokensOut:r.totalTokensOut+n.tokensOut}),{totalRequests:0,totalTokensIn:0,totalTokensOut:0})}dispose(){this.flushInterval&&(clearInterval(this.flushInterval),this.flush())}};var BE=Le(require("vscode"));var ue;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let i={};for(let s of o)i[s]=s;return i},t.getValidEnumValues=o=>{let i=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),s={};for(let a of i)s[a]=o[a];return t.objectValues(s)},t.objectValues=o=>t.objectKeys(o).map(function(i){return o[i]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let i=[];for(let s in o)Object.prototype.hasOwnProperty.call(o,s)&&i.push(s);return i},t.find=(o,i)=>{for(let s of o)if(i(s))return s},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,i=" | "){return o.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}t.joinValues=n,t.jsonStringifyReplacer=(o,i)=>typeof i=="bigint"?i.toString():i})(ue||(ue={}));var _b;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(_b||(_b={}));var O=ue.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rr=t=>{switch(typeof t){case"undefined":return O.undefined;case"string":return O.string;case"number":return Number.isNaN(t)?O.nan:O.number;case"boolean":return O.boolean;case"function":return O.function;case"bigint":return O.bigint;case"symbol":return O.symbol;case"object":return Array.isArray(t)?O.array:t===null?O.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?O.promise:typeof Map<"u"&&t instanceof Map?O.map:typeof Set<"u"&&t instanceof Set?O.set:typeof Date<"u"&&t instanceof Date?O.date:O.object;default:return O.unknown}};var S=ue.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var Mt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(i){return i.message},n={_errors:[]},o=i=>{for(let s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(o);else if(s.code==="invalid_return_type")o(s.returnTypeError);else if(s.code==="invalid_arguments")o(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let a=n,c=0;for(;c<s.path.length;){let u=s.path[c];c===s.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(s))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ue.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r=Object.create(null),n=[];for(let o of this.issues)if(o.path.length>0){let i=o.path[0];r[i]=r[i]||[],r[i].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Mt.create=t=>new Mt(t);var i1=(t,e)=>{let r;switch(t.code){case S.invalid_type:t.received===O.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ue.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:r=`Unrecognized key(s) in object: ${ue.joinValues(t.keys,", ")}`;break;case S.invalid_union:r="Invalid input";break;case S.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ue.joinValues(t.options)}`;break;case S.invalid_enum_value:r=`Invalid enum value. Expected ${ue.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:r="Invalid function arguments";break;case S.invalid_return_type:r="Invalid function return type";break;case S.invalid_date:r="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ue.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case S.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case S.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case S.custom:r="Invalid input";break;case S.invalid_intersection_types:r="Intersection results could not be merged";break;case S.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:r="Number must be finite";break;default:r=e.defaultError,ue.assertNever(t)}return{message:r}},on=i1;var s1=on;function Gi(){return s1}var Rc=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,i=[...r,...o.path||[]],s={...o,path:i};if(o.message!==void 0)return{...o,path:i,message:o.message};let a="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)a=u(s,{data:e,defaultError:a}).message;return{...o,path:i,message:a}};function C(t,e){let r=Gi(),n=Rc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===on?void 0:on].filter(o=>!!o)});t.common.issues.push(n)}var st=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return q;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let i=await o.key,s=await o.value;n.push({key:i,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:i,value:s}=o;if(i.status==="aborted"||s.status==="aborted")return q;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||o.alwaysSet)&&(n[i.value]=s.value)}return{status:e.value,value:n}}},q=Object.freeze({status:"aborted"}),Eo=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),Bd=t=>t.status==="aborted",Hd=t=>t.status==="dirty",Mn=t=>t.status==="valid",Wi=t=>typeof Promise<"u"&&t instanceof Promise;var j;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(j||(j={}));var Vt=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},bb=(t,e)=>{if(Mn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Mt(t.common.issues);return this._error=r,this._error}}};function G(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(s,a)=>{let{message:c}=t;return s.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:s.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var Q=class{get description(){return this._def.description}_getType(e){return Rr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new st,ctx:{common:e.parent.common,data:e.data,parsedType:Rr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(Wi(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rr(e)},o=this._parseSync({data:e,path:n.path,parent:n});return bb(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rr(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Mn(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Mn(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rr(e)},o=this._parse({data:e,path:n.path,parent:n}),i=await(Wi(o)?o:Promise.resolve(o));return bb(n,i)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,i)=>{let s=e(o),a=()=>i.addIssue({code:S.custom,...n(o)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(a(),!1)):s?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new ar({schema:this,typeName:D.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return sr.create(this,this._def)}nullable(){return Dr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return an.create(this)}promise(){return Dn.create(this,this._def)}or(e){return jo.create([this,e],this._def)}and(e){return No.create(this,e,this._def)}transform(e){return new ar({...G(this._def),schema:this,typeName:D.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Uo({...G(this._def),innerType:this,defaultValue:r,typeName:D.ZodDefault})}brand(){return new Ac({typeName:D.ZodBranded,type:this,...G(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new qo({...G(this._def),innerType:this,catchValue:r,typeName:D.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Mc.create(this,e)}readonly(){return Lo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},a1=/^c[^\s-]{8,}$/i,c1=/^[0-9a-z]+$/,u1=/^[0-9A-HJKMNP-TV-Z]{26}$/i,l1=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,d1=/^[a-z0-9_-]{21}$/i,p1=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,f1=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,m1=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,h1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Gd,g1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,v1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,y1=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,_1=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,b1=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,x1=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xb="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",$1=new RegExp(`^${xb}$`);function $b(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function w1(t){return new RegExp(`^${$b(t)}$`)}function k1(t){let e=`${xb}T${$b(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function S1(t,e){return!!((e==="v4"||!e)&&g1.test(t)||(e==="v6"||!e)&&y1.test(t))}function P1(t,e){if(!p1.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function I1(t,e){return!!((e==="v4"||!e)&&v1.test(t)||(e==="v6"||!e)&&_1.test(t))}var To=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==O.string){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:O.string,received:i.parsedType}),q}let n=new st,o;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(o=this._getOrReturnCtx(e,o),C(o,{code:S.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(o=this._getOrReturnCtx(e,o),C(o,{code:S.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let s=e.data.length>i.value,a=e.data.length<i.value;(s||a)&&(o=this._getOrReturnCtx(e,o),s?C(o,{code:S.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&C(o,{code:S.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")m1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"email",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Gd||(Gd=new RegExp(h1,"u")),Gd.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"emoji",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")l1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"uuid",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")d1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"nanoid",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")a1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"cuid",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")c1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"cuid2",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")u1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"ulid",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),C(o,{validation:"url",code:S.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"regex",code:S.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(o=this._getOrReturnCtx(e,o),C(o,{code:S.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(o=this._getOrReturnCtx(e,o),C(o,{code:S.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(o=this._getOrReturnCtx(e,o),C(o,{code:S.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?k1(i).test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{code:S.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?$1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{code:S.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?w1(i).test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{code:S.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?f1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"duration",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?S1(e.data,i.version)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"ip",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?P1(e.data,i.alg)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"jwt",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?I1(e.data,i.version)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"cidr",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?b1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"base64",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?x1.test(e.data)||(o=this._getOrReturnCtx(e,o),C(o,{validation:"base64url",code:S.invalid_string,message:i.message}),n.dirty()):ue.assertNever(i);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:S.invalid_string,...j.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...j.errToObj(e)})}url(e){return this._addCheck({kind:"url",...j.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...j.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...j.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...j.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...j.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...j.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...j.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...j.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...j.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...j.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...j.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...j.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...j.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...j.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...j.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...j.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...j.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...j.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...j.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...j.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...j.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...j.errToObj(r)})}nonempty(e){return this.min(1,j.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};To.create=t=>new To({checks:[],typeName:D.ZodString,coerce:t?.coerce??!1,...G(t)});function E1(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,i=Number.parseInt(t.toFixed(o).replace(".","")),s=Number.parseInt(e.toFixed(o).replace(".",""));return i%s/10**o}var Ji=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==O.number){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:O.number,received:i.parsedType}),q}let n,o=new st;for(let i of this._def.checks)i.kind==="int"?ue.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_type,expected:"integer",received:"float",message:i.message}),o.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="multipleOf"?E1(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.not_finite,message:i.message}),o.dirty()):ue.assertNever(i);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,j.toString(r))}gt(e,r){return this.setLimit("min",e,!1,j.toString(r))}lte(e,r){return this.setLimit("max",e,!0,j.toString(r))}lt(e,r){return this.setLimit("max",e,!1,j.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:j.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:j.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:j.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:j.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:j.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:j.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ue.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Ji.create=t=>new Ji({checks:[],typeName:D.ZodNumber,coerce:t?.coerce||!1,...G(t)});var Ki=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==O.bigint)return this._getInvalidInput(e);let n,o=new st;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):ue.assertNever(i);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return C(r,{code:S.invalid_type,expected:O.bigint,received:r.parsedType}),q}gte(e,r){return this.setLimit("min",e,!0,j.toString(r))}gt(e,r){return this.setLimit("min",e,!1,j.toString(r))}lte(e,r){return this.setLimit("max",e,!0,j.toString(r))}lt(e,r){return this.setLimit("max",e,!1,j.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:j.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:j.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Ki.create=t=>new Ki({checks:[],typeName:D.ZodBigInt,coerce:t?.coerce??!1,...G(t)});var Xi=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==O.boolean){let n=this._getOrReturnCtx(e);return C(n,{code:S.invalid_type,expected:O.boolean,received:n.parsedType}),q}return ht(e.data)}};Xi.create=t=>new Xi({typeName:D.ZodBoolean,coerce:t?.coerce||!1,...G(t)});var Yi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==O.date){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:O.date,received:i.parsedType}),q}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_date}),q}let n=new st,o;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(o=this._getOrReturnCtx(e,o),C(o,{code:S.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(o=this._getOrReturnCtx(e,o),C(o,{code:S.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):ue.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:j.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:j.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Yi.create=t=>new Yi({checks:[],coerce:t?.coerce||!1,typeName:D.ZodDate,...G(t)});var Qi=class extends Q{_parse(e){if(this._getType(e)!==O.symbol){let n=this._getOrReturnCtx(e);return C(n,{code:S.invalid_type,expected:O.symbol,received:n.parsedType}),q}return ht(e.data)}};Qi.create=t=>new Qi({typeName:D.ZodSymbol,...G(t)});var Co=class extends Q{_parse(e){if(this._getType(e)!==O.undefined){let n=this._getOrReturnCtx(e);return C(n,{code:S.invalid_type,expected:O.undefined,received:n.parsedType}),q}return ht(e.data)}};Co.create=t=>new Co({typeName:D.ZodUndefined,...G(t)});var Oo=class extends Q{_parse(e){if(this._getType(e)!==O.null){let n=this._getOrReturnCtx(e);return C(n,{code:S.invalid_type,expected:O.null,received:n.parsedType}),q}return ht(e.data)}};Oo.create=t=>new Oo({typeName:D.ZodNull,...G(t)});var es=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};es.create=t=>new es({typeName:D.ZodAny,...G(t)});var sn=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};sn.create=t=>new sn({typeName:D.ZodUnknown,...G(t)});var $r=class extends Q{_parse(e){let r=this._getOrReturnCtx(e);return C(r,{code:S.invalid_type,expected:O.never,received:r.parsedType}),q}};$r.create=t=>new $r({typeName:D.ZodNever,...G(t)});var ts=class extends Q{_parse(e){if(this._getType(e)!==O.undefined){let n=this._getOrReturnCtx(e);return C(n,{code:S.invalid_type,expected:O.void,received:n.parsedType}),q}return ht(e.data)}};ts.create=t=>new ts({typeName:D.ZodVoid,...G(t)});var an=class t extends Q{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==O.array)return C(r,{code:S.invalid_type,expected:O.array,received:r.parsedType}),q;if(o.exactLength!==null){let s=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(s||a)&&(C(r,{code:s?S.too_big:S.too_small,minimum:a?o.exactLength.value:void 0,maximum:s?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(C(r,{code:S.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(C(r,{code:S.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,a)=>o.type._parseAsync(new Vt(r,s,r.path,a)))).then(s=>st.mergeArray(n,s));let i=[...r.data].map((s,a)=>o.type._parseSync(new Vt(r,s,r.path,a)));return st.mergeArray(n,i)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:j.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:j.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:j.toString(r)}})}nonempty(e){return this.min(1,e)}};an.create=(t,e)=>new an({type:t,minLength:null,maxLength:null,exactLength:null,typeName:D.ZodArray,...G(e)});function zo(t){if(t instanceof Dt){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=sr.create(zo(n))}return new Dt({...t._def,shape:()=>e})}else return t instanceof an?new an({...t._def,type:zo(t.element)}):t instanceof sr?sr.create(zo(t.unwrap())):t instanceof Dr?Dr.create(zo(t.unwrap())):t instanceof Mr?Mr.create(t.items.map(e=>zo(e))):t}var Dt=class t extends Q{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=ue.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==O.object){let u=this._getOrReturnCtx(e);return C(u,{code:S.invalid_type,expected:O.object,received:u.parsedType}),q}let{status:n,ctx:o}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof $r&&this._def.unknownKeys==="strip"))for(let u in o.data)s.includes(u)||a.push(u);let c=[];for(let u of s){let l=i[u],d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Vt(o,d,o.path,u)),alwaysSet:u in o.data})}if(this._def.catchall instanceof $r){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:o.data[l]}});else if(u==="strict")a.length>0&&(C(o,{code:S.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Vt(o,d,o.path,l)),alwaysSet:l in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,p=await l.value;u.push({key:d,value:p,alwaysSet:l.alwaysSet})}return u}).then(u=>st.mergeObjectSync(n,u)):st.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return j.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:j.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:D.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of ue.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of ue.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return zo(this)}partial(e){let r={};for(let n of ue.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of ue.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof sr;)i=i._def.innerType;r[n]=i}return new t({...this._def,shape:()=>r})}keyof(){return wb(ue.objectKeys(this.shape))}};Dt.create=(t,e)=>new Dt({shape:()=>t,unknownKeys:"strip",catchall:$r.create(),typeName:D.ZodObject,...G(e)});Dt.strictCreate=(t,e)=>new Dt({shape:()=>t,unknownKeys:"strict",catchall:$r.create(),typeName:D.ZodObject,...G(e)});Dt.lazycreate=(t,e)=>new Dt({shape:t,unknownKeys:"strip",catchall:$r.create(),typeName:D.ZodObject,...G(e)});var jo=class extends Q{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let s=i.map(a=>new Mt(a.ctx.common.issues));return C(r,{code:S.invalid_union,unionErrors:s}),q}if(r.common.async)return Promise.all(n.map(async i=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(o);{let i,s=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:u}),u.common.issues.length&&s.push(u.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;let a=s.map(c=>new Mt(c));return C(r,{code:S.invalid_union,unionErrors:a}),q}}get options(){return this._def.options}};jo.create=(t,e)=>new jo({options:t,typeName:D.ZodUnion,...G(e)});var Ar=t=>t instanceof Ro?Ar(t.schema):t instanceof ar?Ar(t.innerType()):t instanceof Ao?[t.value]:t instanceof Mo?t.options:t instanceof Do?ue.objectValues(t.enum):t instanceof Uo?Ar(t._def.innerType):t instanceof Co?[void 0]:t instanceof Oo?[null]:t instanceof sr?[void 0,...Ar(t.unwrap())]:t instanceof Dr?[null,...Ar(t.unwrap())]:t instanceof Ac||t instanceof Lo?Ar(t.unwrap()):t instanceof qo?Ar(t._def.innerType):[],Wd=class t extends Q{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==O.object)return C(r,{code:S.invalid_type,expected:O.object,received:r.parsedType}),q;let n=this.discriminator,o=r.data[n],i=this.optionsMap.get(o);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(C(r,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let i of r){let s=Ar(i.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of s){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,i)}}return new t({typeName:D.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...G(n)})}};function Jd(t,e){let r=Rr(t),n=Rr(e);if(t===e)return{valid:!0,data:t};if(r===O.object&&n===O.object){let o=ue.objectKeys(e),i=ue.objectKeys(t).filter(a=>o.indexOf(a)!==-1),s={...t,...e};for(let a of i){let c=Jd(t[a],e[a]);if(!c.valid)return{valid:!1};s[a]=c.data}return{valid:!0,data:s}}else if(r===O.array&&n===O.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let i=0;i<t.length;i++){let s=t[i],a=e[i],c=Jd(s,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===O.date&&n===O.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var No=class extends Q{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(i,s)=>{if(Bd(i)||Bd(s))return q;let a=Jd(i.value,s.value);return a.valid?((Hd(i)||Hd(s))&&r.dirty(),{status:r.value,value:a.data}):(C(n,{code:S.invalid_intersection_types}),q)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,s])=>o(i,s)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};No.create=(t,e,r)=>new No({left:t,right:e,typeName:D.ZodIntersection,...G(r)});var Mr=class t extends Q{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==O.array)return C(n,{code:S.invalid_type,expected:O.array,received:n.parsedType}),q;if(n.data.length<this._def.items.length)return C(n,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),q;!this._def.rest&&n.data.length>this._def.items.length&&(C(n,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let i=[...n.data].map((s,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Vt(n,s,n.path,a)):null}).filter(s=>!!s);return n.common.async?Promise.all(i).then(s=>st.mergeArray(r,s)):st.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Mr.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Mr({items:t,typeName:D.ZodTuple,rest:null,...G(e)})};var Kd=class t extends Q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==O.object)return C(n,{code:S.invalid_type,expected:O.object,received:n.parsedType}),q;let o=[],i=this._def.keyType,s=this._def.valueType;for(let a in n.data)o.push({key:i._parse(new Vt(n,a,n.path,a)),value:s._parse(new Vt(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?st.mergeObjectAsync(r,o):st.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof Q?new t({keyType:e,valueType:r,typeName:D.ZodRecord,...G(n)}):new t({keyType:To.create(),valueType:e,typeName:D.ZodRecord,...G(r)})}},rs=class extends Q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==O.map)return C(n,{code:S.invalid_type,expected:O.map,received:n.parsedType}),q;let o=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map(([a,c],u)=>({key:o._parse(new Vt(n,a,n.path,[u,"key"])),value:i._parse(new Vt(n,c,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of s){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return q;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of s){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return q;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};rs.create=(t,e,r)=>new rs({valueType:e,keyType:t,typeName:D.ZodMap,...G(r)});var ns=class t extends Q{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==O.set)return C(n,{code:S.invalid_type,expected:O.set,received:n.parsedType}),q;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(C(n,{code:S.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(C(n,{code:S.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let i=this._def.valueType;function s(c){let u=new Set;for(let l of c){if(l.status==="aborted")return q;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((c,u)=>i._parse(new Vt(n,c,n.path,u)));return n.common.async?Promise.all(a).then(c=>s(c)):s(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:j.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:j.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};ns.create=(t,e)=>new ns({valueType:t,minSize:null,maxSize:null,typeName:D.ZodSet,...G(e)});var Xd=class t extends Q{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==O.function)return C(r,{code:S.invalid_type,expected:O.function,received:r.parsedType}),q;function n(a,c){return Rc({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Gi(),on].filter(u=>!!u),issueData:{code:S.invalid_arguments,argumentsError:c}})}function o(a,c){return Rc({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Gi(),on].filter(u=>!!u),issueData:{code:S.invalid_return_type,returnTypeError:c}})}let i={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof Dn){let a=this;return ht(async function(...c){let u=new Mt([]),l=await a._def.args.parseAsync(c,i).catch(f=>{throw u.addIssue(n(c,f)),u}),d=await Reflect.apply(s,this,l);return await a._def.returns._def.type.parseAsync(d,i).catch(f=>{throw u.addIssue(o(d,f)),u})})}else{let a=this;return ht(function(...c){let u=a._def.args.safeParse(c,i);if(!u.success)throw new Mt([n(c,u.error)]);let l=Reflect.apply(s,this,u.data),d=a._def.returns.safeParse(l,i);if(!d.success)throw new Mt([o(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Mr.create(e).rest(sn.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Mr.create([]).rest(sn.create()),returns:r||sn.create(),typeName:D.ZodFunction,...G(n)})}},Ro=class extends Q{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Ro.create=(t,e)=>new Ro({getter:t,typeName:D.ZodLazy,...G(e)});var Ao=class extends Q{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return C(r,{received:r.data,code:S.invalid_literal,expected:this._def.value}),q}return{status:"valid",value:e.data}}get value(){return this._def.value}};Ao.create=(t,e)=>new Ao({value:t,typeName:D.ZodLiteral,...G(e)});function wb(t,e){return new Mo({values:t,typeName:D.ZodEnum,...G(e)})}var Mo=class t extends Q{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return C(r,{expected:ue.joinValues(n),received:r.parsedType,code:S.invalid_type}),q}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return C(r,{received:r.data,code:S.invalid_enum_value,options:n}),q}return ht(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};Mo.create=wb;var Do=class extends Q{_parse(e){let r=ue.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==O.string&&n.parsedType!==O.number){let o=ue.objectValues(r);return C(n,{expected:ue.joinValues(o),received:n.parsedType,code:S.invalid_type}),q}if(this._cache||(this._cache=new Set(ue.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=ue.objectValues(r);return C(n,{received:n.data,code:S.invalid_enum_value,options:o}),q}return ht(e.data)}get enum(){return this._def.values}};Do.create=(t,e)=>new Do({values:t,typeName:D.ZodNativeEnum,...G(e)});var Dn=class extends Q{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==O.promise&&r.common.async===!1)return C(r,{code:S.invalid_type,expected:O.promise,received:r.parsedType}),q;let n=r.parsedType===O.promise?r.data:Promise.resolve(r.data);return ht(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Dn.create=(t,e)=>new Dn({type:t,typeName:D.ZodPromise,...G(e)});var ar=class extends Q{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===D.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,i={addIssue:s=>{C(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),o.type==="preprocess"){let s=o.transform(n.data,i);if(n.common.async)return Promise.resolve(s).then(async a=>{if(r.value==="aborted")return q;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?q:c.status==="dirty"?Eo(c.value):r.value==="dirty"?Eo(c.value):c});{if(r.value==="aborted")return q;let a=this._def.schema._parseSync({data:s,path:n.path,parent:n});return a.status==="aborted"?q:a.status==="dirty"?Eo(a.value):r.value==="dirty"?Eo(a.value):a}}if(o.type==="refinement"){let s=a=>{let c=o.refinement(a,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?q:(a.status==="dirty"&&r.dirty(),s(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?q:(a.status==="dirty"&&r.dirty(),s(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Mn(s))return q;let a=o.transform(s.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>Mn(s)?Promise.resolve(o.transform(s.value,i)).then(a=>({status:r.value,value:a})):q);ue.assertNever(o)}};ar.create=(t,e,r)=>new ar({schema:t,typeName:D.ZodEffects,effect:e,...G(r)});ar.createWithPreprocess=(t,e,r)=>new ar({schema:e,effect:{type:"preprocess",transform:t},typeName:D.ZodEffects,...G(r)});var sr=class extends Q{_parse(e){return this._getType(e)===O.undefined?ht(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};sr.create=(t,e)=>new sr({innerType:t,typeName:D.ZodOptional,...G(e)});var Dr=class extends Q{_parse(e){return this._getType(e)===O.null?ht(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Dr.create=(t,e)=>new Dr({innerType:t,typeName:D.ZodNullable,...G(e)});var Uo=class extends Q{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===O.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Uo.create=(t,e)=>new Uo({innerType:t,typeName:D.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...G(e)});var qo=class extends Q{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Wi(o)?o.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Mt(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Mt(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};qo.create=(t,e)=>new qo({innerType:t,typeName:D.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...G(e)});var os=class extends Q{_parse(e){if(this._getType(e)!==O.nan){let n=this._getOrReturnCtx(e);return C(n,{code:S.invalid_type,expected:O.nan,received:n.parsedType}),q}return{status:"valid",value:e.data}}};os.create=t=>new os({typeName:D.ZodNaN,...G(t)});var Ac=class extends Q{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Mc=class t extends Q{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?q:i.status==="dirty"?(r.dirty(),Eo(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?q:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:D.ZodPipeline})}},Lo=class extends Q{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Mn(o)&&(o.value=Object.freeze(o.value)),o);return Wi(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};Lo.create=(t,e)=>new Lo({innerType:t,typeName:D.ZodReadonly,...G(e)});var PV={object:Dt.lazycreate},D;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(D||(D={}));var IV=To.create,EV=Ji.create,zV=os.create,TV=Ki.create,CV=Xi.create,OV=Yi.create,jV=Qi.create,NV=Co.create,RV=Oo.create,AV=es.create,MV=sn.create,DV=$r.create,UV=ts.create,qV=an.create,z1=Dt.create,LV=Dt.strictCreate,ZV=jo.create,FV=Wd.create,VV=No.create,BV=Mr.create,HV=Kd.create,GV=rs.create,WV=ns.create,JV=Xd.create,KV=Ro.create,XV=Ao.create,YV=Mo.create,QV=Do.create,e9=Dn.create,t9=ar.create,r9=sr.create,n9=Dr.create,o9=ar.createWithPreprocess,i9=Mc.create;var Uc=Object.freeze({status:"aborted"});function _(t,e,r){function n(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(t))return;a._zod.traits.add(t),e(a,c);let u=s.prototype,l=Object.keys(u);for(let d=0;d<l.length;d++){let p=l[d];p in a||(a[p]=u[p].bind(a))}}let o=r?.Parent??Object;class i extends o{}Object.defineProperty(i,"name",{value:t});function s(a){var c;let u=r?.Parent?new i:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(s,"name",{value:t}),s}var wr=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Un=class extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}},Dc={};function He(t){return t&&Object.assign(Dc,t),Dc}var P={};An(P,{BIGINT_FORMAT_RANGES:()=>sp,Class:()=>Qd,NUMBER_FORMAT_RANGES:()=>ip,aborted:()=>pn,allowsEval:()=>rp,assert:()=>A1,assertEqual:()=>O1,assertIs:()=>N1,assertNever:()=>R1,assertNotEqual:()=>j1,assignProp:()=>un,base64ToUint8Array:()=>Pb,base64urlToUint8Array:()=>Q1,cached:()=>Fo,captureStackTrace:()=>Lc,cleanEnum:()=>Y1,cleanRegex:()=>as,clone:()=>gt,cloneDef:()=>D1,createTransparentProxy:()=>V1,defineLazy:()=>ae,esc:()=>qc,escapeRegex:()=>Bt,extend:()=>G1,finalizeIssue:()=>kt,floatSafeRemainder:()=>ep,getElementAtPath:()=>U1,getEnumValues:()=>ss,getLengthableOrigin:()=>ls,getParsedType:()=>F1,getSizableOrigin:()=>us,hexToUint8Array:()=>tT,isObject:()=>qn,isPlainObject:()=>dn,issue:()=>Vo,joinValues:()=>L,jsonStringifyReplacer:()=>Zo,merge:()=>J1,mergeDefs:()=>ln,normalizeParams:()=>z,nullish:()=>cn,numKeys:()=>Z1,objectClone:()=>M1,omit:()=>H1,optionalKeys:()=>op,partial:()=>K1,pick:()=>B1,prefixIssues:()=>Ut,primitiveTypes:()=>np,promiseAllObject:()=>q1,propertyKeyTypes:()=>cs,randomString:()=>L1,required:()=>X1,safeExtend:()=>W1,shallowClone:()=>Sb,slugify:()=>tp,stringifyPrimitive:()=>Z,uint8ArrayToBase64:()=>Ib,uint8ArrayToBase64url:()=>eT,uint8ArrayToHex:()=>rT,unwrapMessage:()=>is});function O1(t){return t}function j1(t){return t}function N1(t){}function R1(t){throw new Error("Unexpected value in exhaustive check")}function A1(t){}function ss(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function L(t,e="|"){return t.map(r=>Z(r)).join(e)}function Zo(t,e){return typeof e=="bigint"?e.toString():e}function Fo(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function cn(t){return t==null}function as(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function ep(t,e){let r=(t.toString().split(".")[1]||"").length,n=e.toString(),o=(n.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(n)){let c=n.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}let i=r>o?r:o,s=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}var kb=Symbol("evaluating");function ae(t,e,r){let n;Object.defineProperty(t,e,{get(){if(n!==kb)return n===void 0&&(n=kb,n=r()),n},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function M1(t){return Object.create(Object.getPrototypeOf(t),Object.getOwnPropertyDescriptors(t))}function un(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function ln(...t){let e={};for(let r of t){let n=Object.getOwnPropertyDescriptors(r);Object.assign(e,n)}return Object.defineProperties({},e)}function D1(t){return ln(t._zod.def)}function U1(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function q1(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let i=0;i<e.length;i++)o[e[i]]=n[i];return o})}function L1(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function qc(t){return JSON.stringify(t)}function tp(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}var Lc="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function qn(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var rp=Fo(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function dn(t){if(qn(t)===!1)return!1;let e=t.constructor;if(e===void 0||typeof e!="function")return!0;let r=e.prototype;return!(qn(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function Sb(t){return dn(t)?{...t}:Array.isArray(t)?[...t]:t}function Z1(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var F1=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},cs=new Set(["string","number","symbol"]),np=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Bt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function gt(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function z(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function V1(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,i){return e??(e=t()),Reflect.set(e,n,o,i)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function Z(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function op(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var ip={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},sp={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function B1(t,e){let r=t._zod.def,n=ln(t._zod.def,{get shape(){let o={};for(let i in e){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&(o[i]=r.shape[i])}return un(this,"shape",o),o},checks:[]});return gt(t,n)}function H1(t,e){let r=t._zod.def,n=ln(t._zod.def,{get shape(){let o={...t._zod.def.shape};for(let i in e){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&delete o[i]}return un(this,"shape",o),o},checks:[]});return gt(t,n)}function G1(t,e){if(!dn(e))throw new Error("Invalid input to extend: expected a plain object");let r=t._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let o=ln(t._zod.def,{get shape(){let i={...t._zod.def.shape,...e};return un(this,"shape",i),i},checks:[]});return gt(t,o)}function W1(t,e){if(!dn(e))throw new Error("Invalid input to safeExtend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return un(this,"shape",n),n},checks:t._zod.def.checks};return gt(t,r)}function J1(t,e){let r=ln(t._zod.def,{get shape(){let n={...t._zod.def.shape,...e._zod.def.shape};return un(this,"shape",n),n},get catchall(){return e._zod.def.catchall},checks:[]});return gt(t,r)}function K1(t,e,r){let n=ln(e._zod.def,{get shape(){let o=e._zod.def.shape,i={...o};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(i[s]=t?new t({type:"optional",innerType:o[s]}):o[s])}else for(let s in o)i[s]=t?new t({type:"optional",innerType:o[s]}):o[s];return un(this,"shape",i),i},checks:[]});return gt(e,n)}function X1(t,e,r){let n=ln(e._zod.def,{get shape(){let o=e._zod.def.shape,i={...o};if(r)for(let s in r){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(i[s]=new t({type:"nonoptional",innerType:o[s]}))}else for(let s in o)i[s]=new t({type:"nonoptional",innerType:o[s]});return un(this,"shape",i),i},checks:[]});return gt(e,n)}function pn(t,e=0){if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function Ut(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function is(t){return typeof t=="string"?t:t?.message}function kt(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=is(t.inst?._zod.def?.error?.(t))??is(e?.error?.(t))??is(r.customError?.(t))??is(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function us(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function ls(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Vo(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function Y1(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function Pb(t){let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function Ib(t){let e="";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function Q1(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-e.length%4)%4);return Pb(e+r)}function eT(t){return Ib(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function tT(t){let e=t.replace(/^0x/,"");if(e.length%2!==0)throw new Error("Invalid hex string length");let r=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)r[n/2]=Number.parseInt(e.slice(n,n+2),16);return r}function rT(t){return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}var Qd=class{constructor(...e){}};var Eb=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,Zo,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Zc=_("$ZodError",Eb),ds=_("$ZodError",Eb,{Parent:Error});function Fc(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function Vc(t,e=r=>r.message){let r={_errors:[]},n=o=>{for(let i of o.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(s=>n({issues:s}));else if(i.code==="invalid_key")n({issues:i.issues});else if(i.code==="invalid_element")n({issues:i.issues});else if(i.path.length===0)r._errors.push(e(i));else{let s=r,a=0;for(;a<i.path.length;){let c=i.path[a];a===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(e(i))):s[c]=s[c]||{_errors:[]},s=s[c],a++}}};return n(t),r}var ps=t=>(e,r,n,o)=>{let i=n?Object.assign(n,{async:!1}):{async:!1},s=e._zod.run({value:r,issues:[]},i);if(s instanceof Promise)throw new wr;if(s.issues.length){let a=new(o?.Err??t)(s.issues.map(c=>kt(c,i,He())));throw Lc(a,o?.callee),a}return s.value},fs=ps(ds),ms=t=>async(e,r,n,o)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){let a=new(o?.Err??t)(s.issues.map(c=>kt(c,i,He())));throw Lc(a,o?.callee),a}return s.value},hs=ms(ds),gs=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new wr;return i.issues.length?{success:!1,error:new(t??Zc)(i.issues.map(s=>kt(s,o,He())))}:{success:!0,data:i.value}},Bo=gs(ds),vs=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new t(i.issues.map(s=>kt(s,o,He())))}:{success:!0,data:i.value}},ys=vs(ds),zb=t=>(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return ps(t)(e,r,o)};var Tb=t=>(e,r,n)=>ps(t)(e,r,n);var Cb=t=>async(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return ms(t)(e,r,o)};var Ob=t=>async(e,r,n)=>ms(t)(e,r,n);var jb=t=>(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return gs(t)(e,r,o)};var Nb=t=>(e,r,n)=>gs(t)(e,r,n);var Rb=t=>async(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return vs(t)(e,r,o)};var Ab=t=>async(e,r,n)=>vs(t)(e,r,n);var Ht={};An(Ht,{base64:()=>$p,base64url:()=>Bc,bigint:()=>Ep,boolean:()=>Cp,browserEmail:()=>dT,cidrv4:()=>bp,cidrv6:()=>xp,cuid:()=>ap,cuid2:()=>cp,date:()=>kp,datetime:()=>Pp,domain:()=>mT,duration:()=>fp,e164:()=>wp,email:()=>hp,emoji:()=>gp,extendedDuration:()=>oT,guid:()=>mp,hex:()=>hT,hostname:()=>fT,html5Email:()=>cT,idnEmail:()=>lT,integer:()=>zp,ipv4:()=>vp,ipv6:()=>yp,ksuid:()=>dp,lowercase:()=>Np,mac:()=>_p,md5_base64:()=>vT,md5_base64url:()=>yT,md5_hex:()=>gT,nanoid:()=>pp,null:()=>Op,number:()=>Tp,rfc5322Email:()=>uT,sha1_base64:()=>bT,sha1_base64url:()=>xT,sha1_hex:()=>_T,sha256_base64:()=>wT,sha256_base64url:()=>kT,sha256_hex:()=>$T,sha384_base64:()=>PT,sha384_base64url:()=>IT,sha384_hex:()=>ST,sha512_base64:()=>zT,sha512_base64url:()=>TT,sha512_hex:()=>ET,string:()=>Ip,time:()=>Sp,ulid:()=>up,undefined:()=>jp,unicodeEmail:()=>Mb,uppercase:()=>Rp,uuid:()=>Ln,uuid4:()=>iT,uuid6:()=>sT,uuid7:()=>aT,xid:()=>lp});var ap=/^[cC][^\s-]{8,}$/,cp=/^[0-9a-z]+$/,up=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,lp=/^[0-9a-vA-V]{20}$/,dp=/^[A-Za-z0-9]{27}$/,pp=/^[a-zA-Z0-9_-]{21}$/,fp=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,oT=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,mp=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Ln=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,iT=Ln(4),sT=Ln(6),aT=Ln(7),hp=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,cT=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,uT=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Mb=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,lT=Mb,dT=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,pT="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function gp(){return new RegExp(pT,"u")}var vp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,yp=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,_p=t=>{let e=Bt(t??":");return new RegExp(`^(?:[0-9A-F]{2}${e}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${e}){5}[0-9a-f]{2}$`)},bp=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,xp=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,$p=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Bc=/^[A-Za-z0-9_-]*$/,fT=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,mT=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,wp=/^\+(?:[0-9]){6,14}[0-9]$/,Db="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",kp=new RegExp(`^${Db}$`);function Ub(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Sp(t){return new RegExp(`^${Ub(t)}$`)}function Pp(t){let e=Ub({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${Db}T(?:${n})$`)}var Ip=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},Ep=/^-?\d+n?$/,zp=/^-?\d+$/,Tp=/^-?\d+(?:\.\d+)?/,Cp=/^(?:true|false)$/i,Op=/^null$/i;var jp=/^undefined$/i;var Np=/^[^A-Z]*$/,Rp=/^[^a-z]*$/,hT=/^[0-9a-fA-F]*$/;function _s(t,e){return new RegExp(`^[A-Za-z0-9+/]{${t}}${e}$`)}function bs(t){return new RegExp(`^[A-Za-z0-9_-]{${t}}$`)}var gT=/^[0-9a-fA-F]{32}$/,vT=_s(22,"=="),yT=bs(22),_T=/^[0-9a-fA-F]{40}$/,bT=_s(27,"="),xT=bs(27),$T=/^[0-9a-fA-F]{64}$/,wT=_s(43,"="),kT=bs(43),ST=/^[0-9a-fA-F]{96}$/,PT=_s(64,""),IT=bs(64),ET=/^[0-9a-fA-F]{128}$/,zT=_s(86,"=="),TT=bs(86);var Pe=_("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),Lb={number:"number",bigint:"bigint",object:"date"},Ap=_("$ZodCheckLessThan",(t,e)=>{Pe.init(t,e);let r=Lb[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,i=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<i&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Mp=_("$ZodCheckGreaterThan",(t,e)=>{Pe.init(t,e);let r=Lb[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,i=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>i&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Zb=_("$ZodCheckMultipleOf",(t,e)=>{Pe.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):ep(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),Fb=_("$ZodCheckNumberFormat",(t,e)=>{Pe.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,i]=ip[e.format];t._zod.onattach.push(s=>{let a=s._zod.bag;a.format=e.format,a.minimum=o,a.maximum=i,r&&(a.pattern=zp)}),t._zod.check=s=>{let a=s.value;if(r){if(!Number.isInteger(a)){s.issues.push({expected:n,format:e.format,code:"invalid_type",continue:!1,input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?s.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):s.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&s.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>i&&s.issues.push({origin:"number",input:a,code:"too_big",maximum:i,inst:t})}}),Vb=_("$ZodCheckBigIntFormat",(t,e)=>{Pe.init(t,e);let[r,n]=sp[e.format];t._zod.onattach.push(o=>{let i=o._zod.bag;i.format=e.format,i.minimum=r,i.maximum=n}),t._zod.check=o=>{let i=o.value;i<r&&o.issues.push({origin:"bigint",input:i,code:"too_small",minimum:r,inclusive:!0,inst:t,continue:!e.abort}),i>n&&o.issues.push({origin:"bigint",input:i,code:"too_big",maximum:n,inst:t})}}),Bb=_("$ZodCheckMaxSize",(t,e)=>{var r;Pe.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!cn(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;o.size<=e.maximum||n.issues.push({origin:us(o),code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Hb=_("$ZodCheckMinSize",(t,e)=>{var r;Pe.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!cn(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;o.size>=e.minimum||n.issues.push({origin:us(o),code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Gb=_("$ZodCheckSizeEquals",(t,e)=>{var r;Pe.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!cn(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.size,o.maximum=e.size,o.size=e.size}),t._zod.check=n=>{let o=n.value,i=o.size;if(i===e.size)return;let s=i>e.size;n.issues.push({origin:us(o),...s?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Wb=_("$ZodCheckMaxLength",(t,e)=>{var r;Pe.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!cn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let s=ls(o);n.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Jb=_("$ZodCheckMinLength",(t,e)=>{var r;Pe.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!cn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let s=ls(o);n.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Kb=_("$ZodCheckLengthEquals",(t,e)=>{var r;Pe.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!cn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,i=o.length;if(i===e.length)return;let s=ls(o),a=i>e.length;n.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),xs=_("$ZodCheckStringFormat",(t,e)=>{var r,n;Pe.init(t,e),t._zod.onattach.push(o=>{let i=o._zod.bag;i.format=e.format,e.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),Xb=_("$ZodCheckRegex",(t,e)=>{xs.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),Yb=_("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=Np),xs.init(t,e)}),Qb=_("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=Rp),xs.init(t,e)}),ex=_("$ZodCheckIncludes",(t,e)=>{Pe.init(t,e);let r=Bt(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),tx=_("$ZodCheckStartsWith",(t,e)=>{Pe.init(t,e);let r=new RegExp(`^${Bt(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),rx=_("$ZodCheckEndsWith",(t,e)=>{Pe.init(t,e);let r=new RegExp(`.*${Bt(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});function qb(t,e,r){t.issues.length&&e.issues.push(...Ut(r,t.issues))}var nx=_("$ZodCheckProperty",(t,e)=>{Pe.init(t,e),t._zod.check=r=>{let n=e.schema._zod.run({value:r.value[e.property],issues:[]},{});if(n instanceof Promise)return n.then(o=>qb(o,r,e.property));qb(n,r,e.property)}}),ox=_("$ZodCheckMimeType",(t,e)=>{Pe.init(t,e);let r=new Set(e.mime);t._zod.onattach.push(n=>{n._zod.bag.mime=e.mime}),t._zod.check=n=>{r.has(n.value.type)||n.issues.push({code:"invalid_value",values:e.mime,input:n.value.type,inst:t,continue:!e.abort})}}),ix=_("$ZodCheckOverwrite",(t,e)=>{Pe.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var Hc=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(s=>s),o=Math.min(...n.map(s=>s.length-s.trimStart().length)),i=n.map(s=>s.slice(o)).map(s=>" ".repeat(this.indent*2)+s);for(let s of i)this.content.push(s)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(i=>`  ${i}`)];return new e(...r,o.join(`
`))}};var ax={major:4,minor:2,patch:1};var H=_("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=ax;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let i of o._zod.onattach)i(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,a,c)=>{let u=pn(s),l;for(let d of a){if(d._zod.def.when){if(!d._zod.def.when(s))continue}else if(u)continue;let p=s.issues.length,f=d._zod.check(s);if(f instanceof Promise&&c?.async===!1)throw new wr;if(l||f instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await f,s.issues.length!==p&&(u||(u=pn(s,p)))});else{if(s.issues.length===p)continue;u||(u=pn(s,p))}}return l?l.then(()=>s):s},i=(s,a,c)=>{if(pn(s))return s.aborted=!0,s;let u=o(a,n,c);if(u instanceof Promise){if(c.async===!1)throw new wr;return u.then(l=>t._zod.parse(l,c))}return t._zod.parse(u,c)};t._zod.run=(s,a)=>{if(a.skipChecks)return t._zod.parse(s,a);if(a.direction==="backward"){let u=t._zod.parse({value:s.value,issues:[]},{...a,skipChecks:!0});return u instanceof Promise?u.then(l=>i(l,s,a)):i(u,s,a)}let c=t._zod.parse(s,a);if(c instanceof Promise){if(a.async===!1)throw new wr;return c.then(u=>o(u,n,a))}return o(c,n,a)}}t["~standard"]={validate:o=>{try{let i=Bo(t,o);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return ys(t,o).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}}),Zn=_("$ZodString",(t,e)=>{H.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??Ip(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),xe=_("$ZodStringFormat",(t,e)=>{xs.init(t,e),Zn.init(t,e)}),Up=_("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=mp),xe.init(t,e)}),qp=_("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Ln(n))}else e.pattern??(e.pattern=Ln());xe.init(t,e)}),Lp=_("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=hp),xe.init(t,e)}),Zp=_("$ZodURL",(t,e)=>{xe.init(t,e),t._zod.check=r=>{try{let n=r.value.trim(),o=new URL(n);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),e.normalize?r.value=o.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),Fp=_("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=gp()),xe.init(t,e)}),Vp=_("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=pp),xe.init(t,e)}),Bp=_("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=ap),xe.init(t,e)}),Hp=_("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=cp),xe.init(t,e)}),Gp=_("$ZodULID",(t,e)=>{e.pattern??(e.pattern=up),xe.init(t,e)}),Wp=_("$ZodXID",(t,e)=>{e.pattern??(e.pattern=lp),xe.init(t,e)}),Jp=_("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=dp),xe.init(t,e)}),Kp=_("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=Pp(e)),xe.init(t,e)}),Xp=_("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=kp),xe.init(t,e)}),Yp=_("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=Sp(e)),xe.init(t,e)}),Qp=_("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=fp),xe.init(t,e)}),ef=_("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=vp),xe.init(t,e),t._zod.bag.format="ipv4"}),tf=_("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=yp),xe.init(t,e),t._zod.bag.format="ipv6",t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),rf=_("$ZodMAC",(t,e)=>{e.pattern??(e.pattern=_p(e.delimiter)),xe.init(t,e),t._zod.bag.format="mac"}),nf=_("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=bp),xe.init(t,e)}),of=_("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=xp),xe.init(t,e),t._zod.check=r=>{let n=r.value.split("/");try{if(n.length!==2)throw new Error;let[o,i]=n;if(!i)throw new Error;let s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${o}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function _x(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var sf=_("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=$p),xe.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=r=>{_x(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function CT(t){if(!Bc.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return _x(r)}var af=_("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=Bc),xe.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=r=>{CT(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),cf=_("$ZodE164",(t,e)=>{e.pattern??(e.pattern=wp),xe.init(t,e)});function OT(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}var uf=_("$ZodJWT",(t,e)=>{xe.init(t,e),t._zod.check=r=>{OT(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}}),lf=_("$ZodCustomStringFormat",(t,e)=>{xe.init(t,e),t._zod.check=r=>{e.fn(r.value)||r.issues.push({code:"invalid_format",format:e.format,input:r.value,inst:t,continue:!e.abort})}}),Yc=_("$ZodNumber",(t,e)=>{H.init(t,e),t._zod.pattern=t._zod.bag.pattern??Tp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...i?{received:i}:{}}),r}}),df=_("$ZodNumberFormat",(t,e)=>{Fb.init(t,e),Yc.init(t,e)}),$s=_("$ZodBoolean",(t,e)=>{H.init(t,e),t._zod.pattern=Cp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}}),Qc=_("$ZodBigInt",(t,e)=>{H.init(t,e),t._zod.pattern=Ep,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=BigInt(r.value)}catch{}return typeof r.value=="bigint"||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:t}),r}}),pf=_("$ZodBigIntFormat",(t,e)=>{Vb.init(t,e),Qc.init(t,e)}),ff=_("$ZodSymbol",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return typeof o=="symbol"||r.issues.push({expected:"symbol",code:"invalid_type",input:o,inst:t}),r}}),mf=_("$ZodUndefined",(t,e)=>{H.init(t,e),t._zod.pattern=jp,t._zod.values=new Set([void 0]),t._zod.optin="optional",t._zod.optout="optional",t._zod.parse=(r,n)=>{let o=r.value;return typeof o>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:o,inst:t}),r}}),hf=_("$ZodNull",(t,e)=>{H.init(t,e),t._zod.pattern=Op,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}}),gf=_("$ZodAny",(t,e)=>{H.init(t,e),t._zod.parse=r=>r}),vf=_("$ZodUnknown",(t,e)=>{H.init(t,e),t._zod.parse=r=>r}),yf=_("$ZodNever",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)}),_f=_("$ZodVoid",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return typeof o>"u"||r.issues.push({expected:"void",code:"invalid_type",input:o,inst:t}),r}}),bf=_("$ZodDate",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=new Date(r.value)}catch{}let o=r.value,i=o instanceof Date;return i&&!Number.isNaN(o.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:o,...i?{received:"Invalid Date"}:{},inst:t}),r}});function cx(t,e,r){t.issues.length&&e.issues.push(...Ut(r,t.issues)),e.value[r]=t.value}var xf=_("$ZodArray",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let i=[];for(let s=0;s<o.length;s++){let a=o[s],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?i.push(c.then(u=>cx(u,r,s))):cx(c,r,s)}return i.length?Promise.all(i).then(()=>r):r}});function Xc(t,e,r,n){t.issues.length&&e.issues.push(...Ut(r,t.issues)),t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}function bx(t){let e=Object.keys(t.shape);for(let n of e)if(!t.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);let r=op(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}}function xx(t,e,r,n,o,i){let s=[],a=o.keySet,c=o.catchall._zod,u=c.def.type;for(let l in e){if(a.has(l))continue;if(u==="never"){s.push(l);continue}let d=c.run({value:e[l],issues:[]},n);d instanceof Promise?t.push(d.then(p=>Xc(p,r,l,e))):Xc(d,r,l,e)}return s.length&&r.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:i}),t.length?Promise.all(t).then(()=>r):r}var $x=_("$ZodObject",(t,e)=>{if(H.init(t,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){let a=e.shape;Object.defineProperty(e,"shape",{get:()=>{let c={...a};return Object.defineProperty(e,"shape",{value:c}),c}})}let n=Fo(()=>bx(e));ae(t._zod,"propValues",()=>{let a=e.shape,c={};for(let u in a){let l=a[u]._zod;if(l.values){c[u]??(c[u]=new Set);for(let d of l.values)c[u].add(d)}}return c});let o=qn,i=e.catchall,s;t._zod.parse=(a,c)=>{s??(s=n.value);let u=a.value;if(!o(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:t}),a;a.value={};let l=[],d=s.shape;for(let p of s.keys){let h=d[p]._zod.run({value:u[p],issues:[]},c);h instanceof Promise?l.push(h.then(m=>Xc(m,a,p,u))):Xc(h,a,p,u)}return i?xx(l,u,a,c,n.value,t):l.length?Promise.all(l).then(()=>a):a}}),wx=_("$ZodObjectJIT",(t,e)=>{$x.init(t,e);let r=t._zod.parse,n=Fo(()=>bx(e)),o=p=>{let f=new Hc(["shape","payload","ctx"]),h=n.value,m=w=>{let I=qc(w);return`shape[${I}]._zod.run({ value: input[${I}], issues: [] }, ctx)`};f.write("const input = payload.value;");let g=Object.create(null),v=0;for(let w of h.keys)g[w]=`key_${v++}`;f.write("const newResult = {};");for(let w of h.keys){let I=g[w],k=qc(w);f.write(`const ${I} = ${m(w)};`),f.write(`
        if (${I}.issues.length) {
          payload.issues = payload.issues.concat(${I}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${k}, ...iss.path] : [${k}]
          })));
        }
        
        
        if (${I}.value === undefined) {
          if (${k} in input) {
            newResult[${k}] = undefined;
          }
        } else {
          newResult[${k}] = ${I}.value;
        }
        
      `)}f.write("payload.value = newResult;"),f.write("return payload;");let x=f.compile();return(w,I)=>x(p,w,I)},i,s=qn,a=!Dc.jitless,u=a&&rp.value,l=e.catchall,d;t._zod.parse=(p,f)=>{d??(d=n.value);let h=p.value;return s(h)?a&&u&&f?.async===!1&&f.jitless!==!0?(i||(i=o(e.shape)),p=i(p,f),l?xx([],h,p,f,d,t):p):r(p,f):(p.issues.push({expected:"object",code:"invalid_type",input:h,inst:t}),p)}});function ux(t,e,r,n){for(let i of t)if(i.issues.length===0)return e.value=i.value,e;let o=t.filter(i=>!pn(i));return o.length===1?(e.value=o[0].value,o[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(i=>i.issues.map(s=>kt(s,n,He())))}),e)}var ws=_("$ZodUnion",(t,e)=>{H.init(t,e),ae(t._zod,"optin",()=>e.options.some(o=>o._zod.optin==="optional")?"optional":void 0),ae(t._zod,"optout",()=>e.options.some(o=>o._zod.optout==="optional")?"optional":void 0),ae(t._zod,"values",()=>{if(e.options.every(o=>o._zod.values))return new Set(e.options.flatMap(o=>Array.from(o._zod.values)))}),ae(t._zod,"pattern",()=>{if(e.options.every(o=>o._zod.pattern)){let o=e.options.map(i=>i._zod.pattern);return new RegExp(`^(${o.map(i=>as(i.source)).join("|")})$`)}});let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let c of e.options){let u=c._zod.run({value:o.value,issues:[]},i);if(u instanceof Promise)a.push(u),s=!0;else{if(u.issues.length===0)return u;a.push(u)}}return s?Promise.all(a).then(c=>ux(c,o,t,i)):ux(a,o,t,i)}});function lx(t,e,r,n){let o=t.filter(i=>i.issues.length===0);return o.length===1?(e.value=o[0].value,e):(o.length===0?e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(i=>i.issues.map(s=>kt(s,n,He())))}):e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:[],inclusive:!1}),e)}var $f=_("$ZodXor",(t,e)=>{ws.init(t,e),e.inclusive=!1;let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let c of e.options){let u=c._zod.run({value:o.value,issues:[]},i);u instanceof Promise?(a.push(u),s=!0):a.push(u)}return s?Promise.all(a).then(c=>lx(c,o,t,i)):lx(a,o,t,i)}}),wf=_("$ZodDiscriminatedUnion",(t,e)=>{e.inclusive=!1,ws.init(t,e);let r=t._zod.parse;ae(t._zod,"propValues",()=>{let o={};for(let i of e.options){let s=i._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let[a,c]of Object.entries(s)){o[a]||(o[a]=new Set);for(let u of c)o[a].add(u)}}return o});let n=Fo(()=>{let o=e.options,i=new Map;for(let s of o){let a=s._zod.propValues?.[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let c of a){if(i.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);i.set(c,s)}}return i});t._zod.parse=(o,i)=>{let s=o.value;if(!qn(s))return o.issues.push({code:"invalid_type",expected:"object",input:s,inst:t}),o;let a=n.value.get(s?.[e.discriminator]);return a?a._zod.run(o,i):e.unionFallback?r(o,i):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:s,path:[e.discriminator],inst:t}),o)}}),kf=_("$ZodIntersection",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,i=e.left._zod.run({value:o,issues:[]},n),s=e.right._zod.run({value:o,issues:[]},n);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([c,u])=>dx(r,c,u)):dx(r,i,s)}});function Dp(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(dn(t)&&dn(e)){let r=Object.keys(e),n=Object.keys(t).filter(i=>r.indexOf(i)!==-1),o={...t,...e};for(let i of n){let s=Dp(t[i],e[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};o[i]=s.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],i=e[n],s=Dp(o,i);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function dx(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),pn(t))return t;let n=Dp(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}var eu=_("$ZodTuple",(t,e)=>{H.init(t,e);let r=e.items;t._zod.parse=(n,o)=>{let i=n.value;if(!Array.isArray(i))return n.issues.push({input:i,inst:t,expected:"tuple",code:"invalid_type"}),n;n.value=[];let s=[],a=[...r].reverse().findIndex(l=>l._zod.optin!=="optional"),c=a===-1?0:r.length-a;if(!e.rest){let l=i.length>r.length,d=i.length<c-1;if(l||d)return n.issues.push({...l?{code:"too_big",maximum:r.length}:{code:"too_small",minimum:r.length},input:i,inst:t,origin:"array"}),n}let u=-1;for(let l of r){if(u++,u>=i.length&&u>=c)continue;let d=l._zod.run({value:i[u],issues:[]},o);d instanceof Promise?s.push(d.then(p=>Gc(p,n,u))):Gc(d,n,u)}if(e.rest){let l=i.slice(r.length);for(let d of l){u++;let p=e.rest._zod.run({value:d,issues:[]},o);p instanceof Promise?s.push(p.then(f=>Gc(f,n,u))):Gc(p,n,u)}}return s.length?Promise.all(s).then(()=>n):n}});function Gc(t,e,r){t.issues.length&&e.issues.push(...Ut(r,t.issues)),e.value[r]=t.value}var Sf=_("$ZodRecord",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!dn(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let i=[],s=e.keyType._zod.values;if(s){r.value={};let a=new Set;for(let u of s)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){a.add(typeof u=="number"?u.toString():u);let l=e.valueType._zod.run({value:o[u],issues:[]},n);l instanceof Promise?i.push(l.then(d=>{d.issues.length&&r.issues.push(...Ut(u,d.issues)),r.value[u]=d.value})):(l.issues.length&&r.issues.push(...Ut(u,l.issues)),r.value[u]=l.value)}let c;for(let u in o)a.has(u)||(c=c??[],c.push(u));c&&c.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:c})}else{r.value={};for(let a of Reflect.ownKeys(o)){if(a==="__proto__")continue;let c=e.keyType._zod.run({value:a,issues:[]},n);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(c.issues.length){e.mode==="loose"?r.value[a]=o[a]:r.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(l=>kt(l,n,He())),input:a,path:[a],inst:t});continue}let u=e.valueType._zod.run({value:o[a],issues:[]},n);u instanceof Promise?i.push(u.then(l=>{l.issues.length&&r.issues.push(...Ut(a,l.issues)),r.value[c.value]=l.value})):(u.issues.length&&r.issues.push(...Ut(a,u.issues)),r.value[c.value]=u.value)}}return i.length?Promise.all(i).then(()=>r):r}}),Pf=_("$ZodMap",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!(o instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:o,inst:t}),r;let i=[];r.value=new Map;for(let[s,a]of o){let c=e.keyType._zod.run({value:s,issues:[]},n),u=e.valueType._zod.run({value:a,issues:[]},n);c instanceof Promise||u instanceof Promise?i.push(Promise.all([c,u]).then(([l,d])=>{px(l,d,r,s,o,t,n)})):px(c,u,r,s,o,t,n)}return i.length?Promise.all(i).then(()=>r):r}});function px(t,e,r,n,o,i,s){t.issues.length&&(cs.has(typeof n)?r.issues.push(...Ut(n,t.issues)):r.issues.push({code:"invalid_key",origin:"map",input:o,inst:i,issues:t.issues.map(a=>kt(a,s,He()))})),e.issues.length&&(cs.has(typeof n)?r.issues.push(...Ut(n,e.issues)):r.issues.push({origin:"map",code:"invalid_element",input:o,inst:i,key:n,issues:e.issues.map(a=>kt(a,s,He()))})),r.value.set(t.value,e.value)}var If=_("$ZodSet",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!(o instanceof Set))return r.issues.push({input:o,inst:t,expected:"set",code:"invalid_type"}),r;let i=[];r.value=new Set;for(let s of o){let a=e.valueType._zod.run({value:s,issues:[]},n);a instanceof Promise?i.push(a.then(c=>fx(c,r))):fx(a,r)}return i.length?Promise.all(i).then(()=>r):r}});function fx(t,e){t.issues.length&&e.issues.push(...t.issues),e.value.add(t.value)}var Ef=_("$ZodEnum",(t,e)=>{H.init(t,e);let r=ss(e.entries),n=new Set(r);t._zod.values=n,t._zod.pattern=new RegExp(`^(${r.filter(o=>cs.has(typeof o)).map(o=>typeof o=="string"?Bt(o):o.toString()).join("|")})$`),t._zod.parse=(o,i)=>{let s=o.value;return n.has(s)||o.issues.push({code:"invalid_value",values:r,input:s,inst:t}),o}}),zf=_("$ZodLiteral",(t,e)=>{if(H.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");let r=new Set(e.values);t._zod.values=r,t._zod.pattern=new RegExp(`^(${e.values.map(n=>typeof n=="string"?Bt(n):n?Bt(n.toString()):String(n)).join("|")})$`),t._zod.parse=(n,o)=>{let i=n.value;return r.has(i)||n.issues.push({code:"invalid_value",values:e.values,input:i,inst:t}),n}}),Tf=_("$ZodFile",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return o instanceof File||r.issues.push({expected:"file",code:"invalid_type",input:o,inst:t}),r}}),Cf=_("$ZodTransform",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Un(t.constructor.name);let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(s=>(r.value=s,r));if(o instanceof Promise)throw new wr;return r.value=o,r}});function mx(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}var Of=_("$ZodOptional",(t,e)=>{H.init(t,e),t._zod.optin="optional",t._zod.optout="optional",ae(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ae(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${as(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>{if(e.innerType._zod.optin==="optional"){let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>mx(i,r.value)):mx(o,r.value)}return r.value===void 0?r:e.innerType._zod.run(r,n)}}),jf=_("$ZodNullable",(t,e)=>{H.init(t,e),ae(t._zod,"optin",()=>e.innerType._zod.optin),ae(t._zod,"optout",()=>e.innerType._zod.optout),ae(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${as(r.source)}|null)$`):void 0}),ae(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),Nf=_("$ZodDefault",(t,e)=>{H.init(t,e),t._zod.optin="optional",ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>hx(i,e)):hx(o,e)}});function hx(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var Rf=_("$ZodPrefault",(t,e)=>{H.init(t,e),t._zod.optin="optional",ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),Af=_("$ZodNonOptional",(t,e)=>{H.init(t,e),ae(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>gx(i,t)):gx(o,t)}});function gx(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var Mf=_("$ZodSuccess",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Un("ZodSuccess");let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>(r.value=i.issues.length===0,r)):(r.value=o.issues.length===0,r)}}),Df=_("$ZodCatch",(t,e)=>{H.init(t,e),ae(t._zod,"optin",()=>e.innerType._zod.optin),ae(t._zod,"optout",()=>e.innerType._zod.optout),ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>(r.value=i.value,i.issues.length&&(r.value=e.catchValue({...r,error:{issues:i.issues.map(s=>kt(s,n,He()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(i=>kt(i,n,He()))},input:r.value}),r.issues=[]),r)}}),Uf=_("$ZodNaN",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>((typeof r.value!="number"||!Number.isNaN(r.value))&&r.issues.push({input:r.value,inst:t,expected:"nan",code:"invalid_type"}),r)}),qf=_("$ZodPipe",(t,e)=>{H.init(t,e),ae(t._zod,"values",()=>e.in._zod.values),ae(t._zod,"optin",()=>e.in._zod.optin),ae(t._zod,"optout",()=>e.out._zod.optout),ae(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if(n.direction==="backward"){let i=e.out._zod.run(r,n);return i instanceof Promise?i.then(s=>Wc(s,e.in,n)):Wc(i,e.in,n)}let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(i=>Wc(i,e.out,n)):Wc(o,e.out,n)}});function Wc(t,e,r){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},r)}var ks=_("$ZodCodec",(t,e)=>{H.init(t,e),ae(t._zod,"values",()=>e.in._zod.values),ae(t._zod,"optin",()=>e.in._zod.optin),ae(t._zod,"optout",()=>e.out._zod.optout),ae(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if((n.direction||"forward")==="forward"){let i=e.in._zod.run(r,n);return i instanceof Promise?i.then(s=>Jc(s,e,n)):Jc(i,e,n)}else{let i=e.out._zod.run(r,n);return i instanceof Promise?i.then(s=>Jc(s,e,n)):Jc(i,e,n)}}});function Jc(t,e,r){if(t.issues.length)return t.aborted=!0,t;if((r.direction||"forward")==="forward"){let o=e.transform(t.value,t);return o instanceof Promise?o.then(i=>Kc(t,i,e.out,r)):Kc(t,o,e.out,r)}else{let o=e.reverseTransform(t.value,t);return o instanceof Promise?o.then(i=>Kc(t,i,e.in,r)):Kc(t,o,e.in,r)}}function Kc(t,e,r,n){return t.issues.length?(t.aborted=!0,t):r._zod.run({value:e,issues:t.issues},n)}var Lf=_("$ZodReadonly",(t,e)=>{H.init(t,e),ae(t._zod,"propValues",()=>e.innerType._zod.propValues),ae(t._zod,"values",()=>e.innerType._zod.values),ae(t._zod,"optin",()=>e.innerType?._zod?.optin),ae(t._zod,"optout",()=>e.innerType?._zod?.optout),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(vx):vx(o)}});function vx(t){return t.value=Object.freeze(t.value),t}var Zf=_("$ZodTemplateLiteral",(t,e)=>{H.init(t,e);let r=[];for(let n of e.parts)if(typeof n=="object"&&n!==null){if(!n._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...n._zod.traits].shift()}`);let o=n._zod.pattern instanceof RegExp?n._zod.pattern.source:n._zod.pattern;if(!o)throw new Error(`Invalid template literal part: ${n._zod.traits}`);let i=o.startsWith("^")?1:0,s=o.endsWith("$")?o.length-1:o.length;r.push(o.slice(i,s))}else if(n===null||np.has(typeof n))r.push(Bt(`${n}`));else throw new Error(`Invalid template literal part: ${n}`);t._zod.pattern=new RegExp(`^${r.join("")}$`),t._zod.parse=(n,o)=>typeof n.value!="string"?(n.issues.push({input:n.value,inst:t,expected:"template_literal",code:"invalid_type"}),n):(t._zod.pattern.lastIndex=0,t._zod.pattern.test(n.value)||n.issues.push({input:n.value,inst:t,code:"invalid_format",format:e.format??"template_literal",pattern:t._zod.pattern.source}),n)}),Ff=_("$ZodFunction",(t,e)=>(H.init(t,e),t._def=e,t._zod.def=e,t.implement=r=>{if(typeof r!="function")throw new Error("implement() must be called with a function");return function(...n){let o=t._def.input?fs(t._def.input,n):n,i=Reflect.apply(r,this,o);return t._def.output?fs(t._def.output,i):i}},t.implementAsync=r=>{if(typeof r!="function")throw new Error("implementAsync() must be called with a function");return async function(...n){let o=t._def.input?await hs(t._def.input,n):n,i=await Reflect.apply(r,this,o);return t._def.output?await hs(t._def.output,i):i}},t._zod.parse=(r,n)=>typeof r.value!="function"?(r.issues.push({code:"invalid_type",expected:"function",input:r.value,inst:t}),r):(t._def.output&&t._def.output._zod.def.type==="promise"?r.value=t.implementAsync(r.value):r.value=t.implement(r.value),r),t.input=(...r)=>{let n=t.constructor;return Array.isArray(r[0])?new n({type:"function",input:new eu({type:"tuple",items:r[0],rest:r[1]}),output:t._def.output}):new n({type:"function",input:r[0],output:t._def.output})},t.output=r=>{let n=t.constructor;return new n({type:"function",input:t._def.input,output:r})},t)),Vf=_("$ZodPromise",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>Promise.resolve(r.value).then(o=>e.innerType._zod.run({value:o,issues:[]},n))}),Bf=_("$ZodLazy",(t,e)=>{H.init(t,e),ae(t._zod,"innerType",()=>e.getter()),ae(t._zod,"pattern",()=>t._zod.innerType?._zod?.pattern),ae(t._zod,"propValues",()=>t._zod.innerType?._zod?.propValues),ae(t._zod,"optin",()=>t._zod.innerType?._zod?.optin??void 0),ae(t._zod,"optout",()=>t._zod.innerType?._zod?.optout??void 0),t._zod.parse=(r,n)=>t._zod.innerType._zod.run(r,n)}),Hf=_("$ZodCustom",(t,e)=>{Pe.init(t,e),H.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(i=>yx(i,r,n,t));yx(o,r,n,t)}});function yx(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(Vo(o))}}var NT=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},RT=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${NT(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${Z(n.values[0])}`:`Invalid option: expected one of ${L(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",i=e(n.origin);return i?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${i.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",i=e(n.origin);return i?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${i.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${L(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}};function Gf(){return{localeError:RT()}}var kx;var Jf=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};delete n.id;let o={...n,...this._map.get(e)};return Object.keys(o).length?o:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};function Kf(){return new Jf}(kx=globalThis).__zod_globalRegistry??(kx.__zod_globalRegistry=Kf());var St=globalThis.__zod_globalRegistry;function Xf(t,e){return new t({type:"string",...z(e)})}function Yf(t,e){return new t({type:"string",coerce:!0,...z(e)})}function tu(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...z(e)})}function Ss(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...z(e)})}function ru(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...z(e)})}function nu(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...z(e)})}function ou(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...z(e)})}function iu(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...z(e)})}function Ps(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...z(e)})}function su(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...z(e)})}function au(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...z(e)})}function cu(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...z(e)})}function uu(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...z(e)})}function lu(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...z(e)})}function du(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...z(e)})}function pu(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...z(e)})}function fu(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...z(e)})}function mu(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...z(e)})}function Qf(t,e){return new t({type:"string",format:"mac",check:"string_format",abort:!1,...z(e)})}function hu(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...z(e)})}function gu(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...z(e)})}function vu(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...z(e)})}function yu(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...z(e)})}function _u(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...z(e)})}function bu(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...z(e)})}function em(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...z(e)})}function tm(t,e){return new t({type:"string",format:"date",check:"string_format",...z(e)})}function rm(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...z(e)})}function nm(t,e){return new t({type:"string",format:"duration",check:"string_format",...z(e)})}function om(t,e){return new t({type:"number",checks:[],...z(e)})}function im(t,e){return new t({type:"number",coerce:!0,checks:[],...z(e)})}function sm(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...z(e)})}function am(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float32",...z(e)})}function cm(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float64",...z(e)})}function um(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"int32",...z(e)})}function lm(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"uint32",...z(e)})}function dm(t,e){return new t({type:"boolean",...z(e)})}function pm(t,e){return new t({type:"boolean",coerce:!0,...z(e)})}function fm(t,e){return new t({type:"bigint",...z(e)})}function mm(t,e){return new t({type:"bigint",coerce:!0,...z(e)})}function hm(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...z(e)})}function gm(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...z(e)})}function vm(t,e){return new t({type:"symbol",...z(e)})}function ym(t,e){return new t({type:"undefined",...z(e)})}function _m(t,e){return new t({type:"null",...z(e)})}function bm(t){return new t({type:"any"})}function xm(t){return new t({type:"unknown"})}function $m(t,e){return new t({type:"never",...z(e)})}function wm(t,e){return new t({type:"void",...z(e)})}function km(t,e){return new t({type:"date",...z(e)})}function Sm(t,e){return new t({type:"date",coerce:!0,...z(e)})}function Pm(t,e){return new t({type:"nan",...z(e)})}function Ur(t,e){return new Ap({check:"less_than",...z(e),value:t,inclusive:!1})}function qt(t,e){return new Ap({check:"less_than",...z(e),value:t,inclusive:!0})}function qr(t,e){return new Mp({check:"greater_than",...z(e),value:t,inclusive:!1})}function vt(t,e){return new Mp({check:"greater_than",...z(e),value:t,inclusive:!0})}function Im(t){return qr(0,t)}function Em(t){return Ur(0,t)}function zm(t){return qt(0,t)}function Tm(t){return vt(0,t)}function Fn(t,e){return new Zb({check:"multiple_of",...z(e),value:t})}function Ho(t,e){return new Bb({check:"max_size",...z(e),maximum:t})}function Vn(t,e){return new Hb({check:"min_size",...z(e),minimum:t})}function Is(t,e){return new Gb({check:"size_equals",...z(e),size:t})}function Go(t,e){return new Wb({check:"max_length",...z(e),maximum:t})}function fn(t,e){return new Jb({check:"min_length",...z(e),minimum:t})}function Wo(t,e){return new Kb({check:"length_equals",...z(e),length:t})}function Es(t,e){return new Xb({check:"string_format",format:"regex",...z(e),pattern:t})}function zs(t){return new Yb({check:"string_format",format:"lowercase",...z(t)})}function Ts(t){return new Qb({check:"string_format",format:"uppercase",...z(t)})}function Cs(t,e){return new ex({check:"string_format",format:"includes",...z(e),includes:t})}function Os(t,e){return new tx({check:"string_format",format:"starts_with",...z(e),prefix:t})}function js(t,e){return new rx({check:"string_format",format:"ends_with",...z(e),suffix:t})}function Cm(t,e,r){return new nx({check:"property",property:t,schema:e,...z(r)})}function Ns(t,e){return new ox({check:"mime_type",mime:t,...z(e)})}function kr(t){return new ix({check:"overwrite",tx:t})}function Rs(t){return kr(e=>e.normalize(t))}function As(){return kr(t=>t.trim())}function Ms(){return kr(t=>t.toLowerCase())}function Ds(){return kr(t=>t.toUpperCase())}function xu(){return kr(t=>tp(t))}function Sx(t,e,r){return new t({type:"array",element:e,...z(r)})}function Om(t,e){return new t({type:"file",...z(e)})}function jm(t,e,r){let n=z(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function Nm(t,e,r){return new t({type:"custom",check:"custom",fn:e,...z(r)})}function Rm(t){let e=UT(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(Vo(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(Vo(o))}},t(r.value,r)));return e}function UT(t,e){let r=new Pe({check:"custom",...z(e)});return r._zod.check=t,r}function Am(t){let e=new Pe({check:"describe"});return e._zod.onattach=[r=>{let n=St.get(r)??{};St.add(r,{...n,description:t})}],e._zod.check=()=>{},e}function Mm(t){let e=new Pe({check:"meta"});return e._zod.onattach=[r=>{let n=St.get(r)??{};St.add(r,{...n,...t})}],e._zod.check=()=>{},e}function Dm(t,e){let r=z(e),n=r.truthy??["true","1","yes","on","y","enabled"],o=r.falsy??["false","0","no","off","n","disabled"];r.case!=="sensitive"&&(n=n.map(f=>typeof f=="string"?f.toLowerCase():f),o=o.map(f=>typeof f=="string"?f.toLowerCase():f));let i=new Set(n),s=new Set(o),a=t.Codec??ks,c=t.Boolean??$s,u=t.String??Zn,l=new u({type:"string",error:r.error}),d=new c({type:"boolean",error:r.error}),p=new a({type:"pipe",in:l,out:d,transform:((f,h)=>{let m=f;return r.case!=="sensitive"&&(m=m.toLowerCase()),i.has(m)?!0:s.has(m)?!1:(h.issues.push({code:"invalid_value",expected:"stringbool",values:[...i,...s],input:h.value,inst:p,continue:!1}),{})}),reverseTransform:((f,h)=>f===!0?n[0]||"true":o[0]||"false"),error:r.error});return p}function Jo(t,e,r,n={}){let o=z(n),i={...z(n),check:"string_format",type:"string",format:e,fn:typeof r=="function"?r:a=>r.test(a),...o};return r instanceof RegExp&&(i.pattern=r),new t(i)}function $u(t){let e=t?.target??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:t?.metadata??St,target:e,unrepresentable:t?.unrepresentable??"throw",override:t?.override??(()=>{}),io:t?.io??"output",counter:0,seen:new Map,cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0}}function je(t,e,r={path:[],schemaPath:[]}){var n;let o=t._zod.def,i=e.seen.get(t);if(i)return i.count++,r.schemaPath.includes(t)&&(i.cycle=r.path),i.schema;let s={schema:{},count:1,cycle:void 0,path:r.path};e.seen.set(t,s);let a=t._zod.toJSONSchema?.();if(a)s.schema=a;else{let l={...r,schemaPath:[...r.schemaPath,t],path:r.path},d=t._zod.parent;if(d)s.ref=d,je(d,e,l),e.seen.get(d).isParent=!0;else if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,s.schema,l);else{let p=s.schema,f=e.processors[o.type];if(!f)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${o.type}`);f(t,e,p,l)}}let c=e.metadataRegistry.get(t);return c&&Object.assign(s.schema,c),e.io==="input"&&yt(t)&&(delete s.schema.examples,delete s.schema.default),e.io==="input"&&s.schema._prefault&&((n=s.schema).default??(n.default=s.schema._prefault)),delete s.schema._prefault,e.seen.get(t).schema}function wu(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=i=>{let s=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){let l=t.external.registry.get(i[0])?.id,d=t.external.uri??(f=>f);if(l)return{ref:d(l)};let p=i[1].defId??i[1].schema.id??`schema${t.counter++}`;return i[1].defId=p,{defId:p,ref:`${d("__shared")}#/${s}/${p}`}}if(i[1]===r)return{ref:"#"};let c=`#/${s}/`,u=i[1].schema.id??`__schema${t.counter++}`;return{defId:u,ref:c+u}},o=i=>{if(i[1].schema.$ref)return;let s=i[1],{ref:a,defId:c}=n(i);s.def={...s.schema},c&&(s.defId=c);let u=s.schema;for(let l in u)delete u[l];u.$ref=a};if(t.cycles==="throw")for(let i of t.seen.entries()){let s=i[1];if(s.cycle)throw new Error(`Cycle detected: #/${s.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let i of t.seen.entries()){let s=i[1];if(e===i[0]){o(i);continue}if(t.external){let c=t.external.registry.get(i[0])?.id;if(e!==i[0]&&c){o(i);continue}}if(t.metadataRegistry.get(i[0])?.id){o(i);continue}if(s.cycle){o(i);continue}if(s.count>1&&t.reused==="ref"){o(i);continue}}}function ku(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=s=>{let a=t.seen.get(s),c=a.def??a.schema,u={...c};if(a.ref===null)return;let l=a.ref;if(a.ref=null,l){n(l);let d=t.seen.get(l).schema;d.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(d)):(Object.assign(c,d),Object.assign(c,u))}a.isParent||t.override({zodSchema:s,jsonSchema:c,path:a.path??[]})};for(let s of[...t.seen.entries()].reverse())n(s[0]);let o={};if(t.target==="draft-2020-12"?o.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?o.$schema="http://json-schema.org/draft-04/schema#":t.target,t.external?.uri){let s=t.external.registry.get(e)?.id;if(!s)throw new Error("Schema is missing an `id` property");o.$id=t.external.uri(s)}Object.assign(o,r.def??r.schema);let i=t.external?.defs??{};for(let s of t.seen.entries()){let a=s[1];a.def&&a.defId&&(i[a.defId]=a.def)}t.external||Object.keys(i).length>0&&(t.target==="draft-2020-12"?o.$defs=i:o.definitions=i);try{let s=JSON.parse(JSON.stringify(o));return Object.defineProperty(s,"~standard",{value:{...e["~standard"],jsonSchema:{input:Us(e,"input"),output:Us(e,"output")}},enumerable:!1,writable:!1}),s}catch{throw new Error("Error converting schema to JSON.")}}function yt(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let n=t._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return yt(n.element,r);if(n.type==="set")return yt(n.valueType,r);if(n.type==="lazy")return yt(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return yt(n.innerType,r);if(n.type==="intersection")return yt(n.left,r)||yt(n.right,r);if(n.type==="record"||n.type==="map")return yt(n.keyType,r)||yt(n.valueType,r);if(n.type==="pipe")return yt(n.in,r)||yt(n.out,r);if(n.type==="object"){for(let o in n.shape)if(yt(n.shape[o],r))return!0;return!1}if(n.type==="union"){for(let o of n.options)if(yt(o,r))return!0;return!1}if(n.type==="tuple"){for(let o of n.items)if(yt(o,r))return!0;return!!(n.rest&&yt(n.rest,r))}return!1}var Px=(t,e={})=>r=>{let n=$u({...r,processors:e});return je(t,n),wu(n,t),ku(n,t)},Us=(t,e)=>r=>{let{libraryOptions:n,target:o}=r??{},i=$u({...n??{},target:o,io:e,processors:{}});return je(t,i),wu(i,t),ku(i,t)};var qT={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},Ix=(t,e,r,n)=>{let o=r;o.type="string";let{minimum:i,maximum:s,format:a,patterns:c,contentEncoding:u}=t._zod.bag;if(typeof i=="number"&&(o.minLength=i),typeof s=="number"&&(o.maxLength=s),a&&(o.format=qT[a]??a,o.format===""&&delete o.format),u&&(o.contentEncoding=u),c&&c.size>0){let l=[...c];l.length===1?o.pattern=l[0].source:l.length>1&&(o.allOf=[...l.map(d=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:d.source}))])}},Ex=(t,e,r,n)=>{let o=r,{minimum:i,maximum:s,format:a,multipleOf:c,exclusiveMaximum:u,exclusiveMinimum:l}=t._zod.bag;typeof a=="string"&&a.includes("int")?o.type="integer":o.type="number",typeof l=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.minimum=l,o.exclusiveMinimum=!0):o.exclusiveMinimum=l),typeof i=="number"&&(o.minimum=i,typeof l=="number"&&e.target!=="draft-04"&&(l>=i?delete o.minimum:delete o.exclusiveMinimum)),typeof u=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.maximum=u,o.exclusiveMaximum=!0):o.exclusiveMaximum=u),typeof s=="number"&&(o.maximum=s,typeof u=="number"&&e.target!=="draft-04"&&(u<=s?delete o.maximum:delete o.exclusiveMaximum)),typeof c=="number"&&(o.multipleOf=c)},zx=(t,e,r,n)=>{r.type="boolean"},Tx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},Cx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},Ox=(t,e,r,n)=>{e.target==="openapi-3.0"?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"},jx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},Nx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},Rx=(t,e,r,n)=>{r.not={}},Ax=(t,e,r,n)=>{},Mx=(t,e,r,n)=>{},Dx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},Ux=(t,e,r,n)=>{let o=t._zod.def,i=ss(o.entries);i.every(s=>typeof s=="number")&&(r.type="number"),i.every(s=>typeof s=="string")&&(r.type="string"),r.enum=i},qx=(t,e,r,n)=>{let o=t._zod.def,i=[];for(let s of o.values)if(s===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof s=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");i.push(Number(s))}else i.push(s);if(i.length!==0)if(i.length===1){let s=i[0];r.type=s===null?"null":typeof s,e.target==="draft-04"||e.target==="openapi-3.0"?r.enum=[s]:r.const=s}else i.every(s=>typeof s=="number")&&(r.type="number"),i.every(s=>typeof s=="string")&&(r.type="string"),i.every(s=>typeof s=="boolean")&&(r.type="boolean"),i.every(s=>s===null)&&(r.type="null"),r.enum=i},Lx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},Zx=(t,e,r,n)=>{let o=r,i=t._zod.pattern;if(!i)throw new Error("Pattern not found in template literal");o.type="string",o.pattern=i.source},Fx=(t,e,r,n)=>{let o=r,i={type:"string",format:"binary",contentEncoding:"binary"},{minimum:s,maximum:a,mime:c}=t._zod.bag;s!==void 0&&(i.minLength=s),a!==void 0&&(i.maxLength=a),c?c.length===1?(i.contentMediaType=c[0],Object.assign(o,i)):o.anyOf=c.map(u=>({...i,contentMediaType:u})):Object.assign(o,i)},Vx=(t,e,r,n)=>{r.type="boolean"},Bx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},Hx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},Gx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},Wx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},Jx=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},Kx=(t,e,r,n)=>{let o=r,i=t._zod.def,{minimum:s,maximum:a}=t._zod.bag;typeof s=="number"&&(o.minItems=s),typeof a=="number"&&(o.maxItems=a),o.type="array",o.items=je(i.element,e,{...n,path:[...n.path,"items"]})},Xx=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="object",o.properties={};let s=i.shape;for(let u in s)o.properties[u]=je(s[u],e,{...n,path:[...n.path,"properties",u]});let a=new Set(Object.keys(s)),c=new Set([...a].filter(u=>{let l=i.shape[u]._zod;return e.io==="input"?l.optin===void 0:l.optout===void 0}));c.size>0&&(o.required=Array.from(c)),i.catchall?._zod.def.type==="never"?o.additionalProperties=!1:i.catchall?i.catchall&&(o.additionalProperties=je(i.catchall,e,{...n,path:[...n.path,"additionalProperties"]})):e.io==="output"&&(o.additionalProperties=!1)},Um=(t,e,r,n)=>{let o=t._zod.def,i=o.inclusive===!1,s=o.options.map((a,c)=>je(a,e,{...n,path:[...n.path,i?"oneOf":"anyOf",c]}));i?r.oneOf=s:r.anyOf=s},Yx=(t,e,r,n)=>{let o=t._zod.def,i=je(o.left,e,{...n,path:[...n.path,"allOf",0]}),s=je(o.right,e,{...n,path:[...n.path,"allOf",1]}),a=u=>"allOf"in u&&Object.keys(u).length===1,c=[...a(i)?i.allOf:[i],...a(s)?s.allOf:[s]];r.allOf=c},Qx=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="array";let s=e.target==="draft-2020-12"?"prefixItems":"items",a=e.target==="draft-2020-12"||e.target==="openapi-3.0"?"items":"additionalItems",c=i.items.map((p,f)=>je(p,e,{...n,path:[...n.path,s,f]})),u=i.rest?je(i.rest,e,{...n,path:[...n.path,a,...e.target==="openapi-3.0"?[i.items.length]:[]]}):null;e.target==="draft-2020-12"?(o.prefixItems=c,u&&(o.items=u)):e.target==="openapi-3.0"?(o.items={anyOf:c},u&&o.items.anyOf.push(u),o.minItems=c.length,u||(o.maxItems=c.length)):(o.items=c,u&&(o.additionalItems=u));let{minimum:l,maximum:d}=t._zod.bag;typeof l=="number"&&(o.minItems=l),typeof d=="number"&&(o.maxItems=d)},e$=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="object",(e.target==="draft-07"||e.target==="draft-2020-12")&&(o.propertyNames=je(i.keyType,e,{...n,path:[...n.path,"propertyNames"]})),o.additionalProperties=je(i.valueType,e,{...n,path:[...n.path,"additionalProperties"]})},t$=(t,e,r,n)=>{let o=t._zod.def,i=je(o.innerType,e,n),s=e.seen.get(t);e.target==="openapi-3.0"?(s.ref=o.innerType,r.nullable=!0):r.anyOf=[i,{type:"null"}]},r$=(t,e,r,n)=>{let o=t._zod.def;je(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},n$=(t,e,r,n)=>{let o=t._zod.def;je(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,r.default=JSON.parse(JSON.stringify(o.defaultValue))},o$=(t,e,r,n)=>{let o=t._zod.def;je(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,e.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(o.defaultValue)))},i$=(t,e,r,n)=>{let o=t._zod.def;je(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType;let s;try{s=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=s},s$=(t,e,r,n)=>{let o=t._zod.def,i=e.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;je(i,e,n);let s=e.seen.get(t);s.ref=i},a$=(t,e,r,n)=>{let o=t._zod.def;je(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,r.readOnly=!0},c$=(t,e,r,n)=>{let o=t._zod.def;je(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},u$=(t,e,r,n)=>{let o=t._zod.def;je(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},l$=(t,e,r,n)=>{let o=t._zod.innerType;je(o,e,n);let i=e.seen.get(t);i.ref=o};function Ko(t){return!!t._zod}function ur(t,e){return Ko(t)?Bo(t,e):t.safeParse(e)}function Su(t){if(!t)return;let e;if(Ko(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function m$(t){if(Ko(t)){let i=t._zod?.def;if(i){if(i.value!==void 0)return i.value;if(Array.isArray(i.values)&&i.values.length>0)return i.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var qs={};An(qs,{ZodAny:()=>O$,ZodArray:()=>A$,ZodBase64:()=>lh,ZodBase64URL:()=>dh,ZodBigInt:()=>Hs,ZodBigIntFormat:()=>mh,ZodBoolean:()=>Bs,ZodCIDRv4:()=>ch,ZodCIDRv6:()=>uh,ZodCUID:()=>th,ZodCUID2:()=>rh,ZodCatch:()=>ew,ZodCodec:()=>xh,ZodCustom:()=>Au,ZodCustomStringFormat:()=>Fs,ZodDate:()=>Cu,ZodDefault:()=>W$,ZodDiscriminatedUnion:()=>D$,ZodE164:()=>ph,ZodEmail:()=>Xm,ZodEmoji:()=>Qm,ZodEnum:()=>Ls,ZodFile:()=>B$,ZodFunction:()=>uw,ZodGUID:()=>Iu,ZodIPv4:()=>sh,ZodIPv6:()=>ah,ZodIntersection:()=>U$,ZodJWT:()=>fh,ZodKSUID:()=>ih,ZodLazy:()=>sw,ZodLiteral:()=>V$,ZodMAC:()=>E$,ZodMap:()=>Z$,ZodNaN:()=>rw,ZodNanoID:()=>eh,ZodNever:()=>N$,ZodNonOptional:()=>_h,ZodNull:()=>C$,ZodNullable:()=>G$,ZodNumber:()=>Vs,ZodNumberFormat:()=>Xo,ZodObject:()=>Ou,ZodOptional:()=>yh,ZodPipe:()=>bh,ZodPrefault:()=>K$,ZodPromise:()=>cw,ZodReadonly:()=>nw,ZodRecord:()=>Ru,ZodSet:()=>F$,ZodString:()=>Zs,ZodStringFormat:()=>Ie,ZodSuccess:()=>Q$,ZodSymbol:()=>z$,ZodTemplateLiteral:()=>iw,ZodTransform:()=>H$,ZodTuple:()=>q$,ZodType:()=>K,ZodULID:()=>nh,ZodURL:()=>Tu,ZodUUID:()=>Lr,ZodUndefined:()=>T$,ZodUnion:()=>ju,ZodUnknown:()=>j$,ZodVoid:()=>R$,ZodXID:()=>oh,ZodXor:()=>M$,_ZodString:()=>Km,_default:()=>J$,_function:()=>XC,any:()=>hh,array:()=>E,base64:()=>vC,base64url:()=>yC,bigint:()=>zC,boolean:()=>_e,catch:()=>tw,check:()=>YC,cidrv4:()=>hC,cidrv6:()=>gC,codec:()=>WC,cuid:()=>aC,cuid2:()=>cC,custom:()=>$h,date:()=>RC,describe:()=>QC,discriminatedUnion:()=>Nu,e164:()=>_C,email:()=>YT,emoji:()=>iC,enum:()=>at,file:()=>VC,float32:()=>SC,float64:()=>PC,function:()=>XC,guid:()=>QT,hash:()=>kC,hex:()=>wC,hostname:()=>$C,httpUrl:()=>oC,instanceof:()=>tO,int:()=>Jm,int32:()=>IC,int64:()=>TC,intersection:()=>Ws,ipv4:()=>pC,ipv6:()=>mC,json:()=>nO,jwt:()=>bC,keyof:()=>AC,ksuid:()=>dC,lazy:()=>aw,literal:()=>N,looseObject:()=>Be,looseRecord:()=>qC,mac:()=>fC,map:()=>LC,meta:()=>eO,nan:()=>GC,nanoid:()=>sC,nativeEnum:()=>FC,never:()=>gh,nonoptional:()=>Y$,null:()=>Gs,nullable:()=>Eu,nullish:()=>BC,number:()=>pe,object:()=>T,optional:()=>Ne,partialRecord:()=>UC,pipe:()=>zu,prefault:()=>X$,preprocess:()=>Mu,promise:()=>KC,readonly:()=>ow,record:()=>Oe,refine:()=>lw,set:()=>ZC,strictObject:()=>MC,string:()=>y,stringFormat:()=>xC,stringbool:()=>rO,success:()=>HC,superRefine:()=>dw,symbol:()=>OC,templateLiteral:()=>JC,transform:()=>vh,tuple:()=>L$,uint32:()=>EC,uint64:()=>CC,ulid:()=>uC,undefined:()=>jC,union:()=>$e,unknown:()=>Ee,url:()=>Ym,uuid:()=>eC,uuidv4:()=>tC,uuidv6:()=>rC,uuidv7:()=>nC,void:()=>NC,xid:()=>lC,xor:()=>DC});var Pu={};An(Pu,{endsWith:()=>js,gt:()=>qr,gte:()=>vt,includes:()=>Cs,length:()=>Wo,lowercase:()=>zs,lt:()=>Ur,lte:()=>qt,maxLength:()=>Go,maxSize:()=>Ho,mime:()=>Ns,minLength:()=>fn,minSize:()=>Vn,multipleOf:()=>Fn,negative:()=>Em,nonnegative:()=>Tm,nonpositive:()=>zm,normalize:()=>Rs,overwrite:()=>kr,positive:()=>Im,property:()=>Cm,regex:()=>Es,size:()=>Is,slugify:()=>xu,startsWith:()=>Os,toLowerCase:()=>Ms,toUpperCase:()=>Ds,trim:()=>As,uppercase:()=>Ts});var Bn={};An(Bn,{ZodISODate:()=>Fm,ZodISODateTime:()=>Lm,ZodISODuration:()=>Gm,ZodISOTime:()=>Bm,date:()=>Vm,datetime:()=>Zm,duration:()=>Wm,time:()=>Hm});var Lm=_("ZodISODateTime",(t,e)=>{Kp.init(t,e),Ie.init(t,e)});function Zm(t){return em(Lm,t)}var Fm=_("ZodISODate",(t,e)=>{Xp.init(t,e),Ie.init(t,e)});function Vm(t){return tm(Fm,t)}var Bm=_("ZodISOTime",(t,e)=>{Yp.init(t,e),Ie.init(t,e)});function Hm(t){return rm(Bm,t)}var Gm=_("ZodISODuration",(t,e)=>{Qp.init(t,e),Ie.init(t,e)});function Wm(t){return nm(Gm,t)}var h$=(t,e)=>{Zc.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>Vc(t,r)},flatten:{value:r=>Fc(t,r)},addIssue:{value:r=>{t.issues.push(r),t.message=JSON.stringify(t.issues,Zo,2)}},addIssues:{value:r=>{t.issues.push(...r),t.message=JSON.stringify(t.issues,Zo,2)}},isEmpty:{get(){return t.issues.length===0}}})},oW=_("ZodError",h$),Lt=_("ZodError",h$,{Parent:Error});var g$=ps(Lt),v$=ms(Lt),y$=gs(Lt),_$=vs(Lt),b$=zb(Lt),x$=Tb(Lt),$$=Cb(Lt),w$=Ob(Lt),k$=jb(Lt),S$=Nb(Lt),P$=Rb(Lt),I$=Ab(Lt);var K=_("ZodType",(t,e)=>(H.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:Us(t,"input"),output:Us(t,"output")}}),t.toJSONSchema=Px(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone(P.mergeDefs(e,{checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),t.clone=(r,n)=>gt(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t)),t.parse=(r,n)=>g$(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>y$(t,r,n),t.parseAsync=async(r,n)=>v$(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>_$(t,r,n),t.spa=t.safeParseAsync,t.encode=(r,n)=>b$(t,r,n),t.decode=(r,n)=>x$(t,r,n),t.encodeAsync=async(r,n)=>$$(t,r,n),t.decodeAsync=async(r,n)=>w$(t,r,n),t.safeEncode=(r,n)=>k$(t,r,n),t.safeDecode=(r,n)=>S$(t,r,n),t.safeEncodeAsync=async(r,n)=>P$(t,r,n),t.safeDecodeAsync=async(r,n)=>I$(t,r,n),t.refine=(r,n)=>t.check(lw(r,n)),t.superRefine=r=>t.check(dw(r)),t.overwrite=r=>t.check(kr(r)),t.optional=()=>Ne(t),t.nullable=()=>Eu(t),t.nullish=()=>Ne(Eu(t)),t.nonoptional=r=>Y$(t,r),t.array=()=>E(t),t.or=r=>$e([t,r]),t.and=r=>Ws(t,r),t.transform=r=>zu(t,vh(r)),t.default=r=>J$(t,r),t.prefault=r=>X$(t,r),t.catch=r=>tw(t,r),t.pipe=r=>zu(t,r),t.readonly=()=>ow(t),t.describe=r=>{let n=t.clone();return St.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return St.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return St.get(t);let n=t.clone();return St.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),Km=_("_ZodString",(t,e)=>{Zn.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>Ix(t,n,o,i);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(Es(...n)),t.includes=(...n)=>t.check(Cs(...n)),t.startsWith=(...n)=>t.check(Os(...n)),t.endsWith=(...n)=>t.check(js(...n)),t.min=(...n)=>t.check(fn(...n)),t.max=(...n)=>t.check(Go(...n)),t.length=(...n)=>t.check(Wo(...n)),t.nonempty=(...n)=>t.check(fn(1,...n)),t.lowercase=n=>t.check(zs(n)),t.uppercase=n=>t.check(Ts(n)),t.trim=()=>t.check(As()),t.normalize=(...n)=>t.check(Rs(...n)),t.toLowerCase=()=>t.check(Ms()),t.toUpperCase=()=>t.check(Ds()),t.slugify=()=>t.check(xu())}),Zs=_("ZodString",(t,e)=>{Zn.init(t,e),Km.init(t,e),t.email=r=>t.check(tu(Xm,r)),t.url=r=>t.check(Ps(Tu,r)),t.jwt=r=>t.check(bu(fh,r)),t.emoji=r=>t.check(su(Qm,r)),t.guid=r=>t.check(Ss(Iu,r)),t.uuid=r=>t.check(ru(Lr,r)),t.uuidv4=r=>t.check(nu(Lr,r)),t.uuidv6=r=>t.check(ou(Lr,r)),t.uuidv7=r=>t.check(iu(Lr,r)),t.nanoid=r=>t.check(au(eh,r)),t.guid=r=>t.check(Ss(Iu,r)),t.cuid=r=>t.check(cu(th,r)),t.cuid2=r=>t.check(uu(rh,r)),t.ulid=r=>t.check(lu(nh,r)),t.base64=r=>t.check(vu(lh,r)),t.base64url=r=>t.check(yu(dh,r)),t.xid=r=>t.check(du(oh,r)),t.ksuid=r=>t.check(pu(ih,r)),t.ipv4=r=>t.check(fu(sh,r)),t.ipv6=r=>t.check(mu(ah,r)),t.cidrv4=r=>t.check(hu(ch,r)),t.cidrv6=r=>t.check(gu(uh,r)),t.e164=r=>t.check(_u(ph,r)),t.datetime=r=>t.check(Zm(r)),t.date=r=>t.check(Vm(r)),t.time=r=>t.check(Hm(r)),t.duration=r=>t.check(Wm(r))});function y(t){return Xf(Zs,t)}var Ie=_("ZodStringFormat",(t,e)=>{xe.init(t,e),Km.init(t,e)}),Xm=_("ZodEmail",(t,e)=>{Lp.init(t,e),Ie.init(t,e)});function YT(t){return tu(Xm,t)}var Iu=_("ZodGUID",(t,e)=>{Up.init(t,e),Ie.init(t,e)});function QT(t){return Ss(Iu,t)}var Lr=_("ZodUUID",(t,e)=>{qp.init(t,e),Ie.init(t,e)});function eC(t){return ru(Lr,t)}function tC(t){return nu(Lr,t)}function rC(t){return ou(Lr,t)}function nC(t){return iu(Lr,t)}var Tu=_("ZodURL",(t,e)=>{Zp.init(t,e),Ie.init(t,e)});function Ym(t){return Ps(Tu,t)}function oC(t){return Ps(Tu,{protocol:/^https?$/,hostname:Ht.domain,...P.normalizeParams(t)})}var Qm=_("ZodEmoji",(t,e)=>{Fp.init(t,e),Ie.init(t,e)});function iC(t){return su(Qm,t)}var eh=_("ZodNanoID",(t,e)=>{Vp.init(t,e),Ie.init(t,e)});function sC(t){return au(eh,t)}var th=_("ZodCUID",(t,e)=>{Bp.init(t,e),Ie.init(t,e)});function aC(t){return cu(th,t)}var rh=_("ZodCUID2",(t,e)=>{Hp.init(t,e),Ie.init(t,e)});function cC(t){return uu(rh,t)}var nh=_("ZodULID",(t,e)=>{Gp.init(t,e),Ie.init(t,e)});function uC(t){return lu(nh,t)}var oh=_("ZodXID",(t,e)=>{Wp.init(t,e),Ie.init(t,e)});function lC(t){return du(oh,t)}var ih=_("ZodKSUID",(t,e)=>{Jp.init(t,e),Ie.init(t,e)});function dC(t){return pu(ih,t)}var sh=_("ZodIPv4",(t,e)=>{ef.init(t,e),Ie.init(t,e)});function pC(t){return fu(sh,t)}var E$=_("ZodMAC",(t,e)=>{rf.init(t,e),Ie.init(t,e)});function fC(t){return Qf(E$,t)}var ah=_("ZodIPv6",(t,e)=>{tf.init(t,e),Ie.init(t,e)});function mC(t){return mu(ah,t)}var ch=_("ZodCIDRv4",(t,e)=>{nf.init(t,e),Ie.init(t,e)});function hC(t){return hu(ch,t)}var uh=_("ZodCIDRv6",(t,e)=>{of.init(t,e),Ie.init(t,e)});function gC(t){return gu(uh,t)}var lh=_("ZodBase64",(t,e)=>{sf.init(t,e),Ie.init(t,e)});function vC(t){return vu(lh,t)}var dh=_("ZodBase64URL",(t,e)=>{af.init(t,e),Ie.init(t,e)});function yC(t){return yu(dh,t)}var ph=_("ZodE164",(t,e)=>{cf.init(t,e),Ie.init(t,e)});function _C(t){return _u(ph,t)}var fh=_("ZodJWT",(t,e)=>{uf.init(t,e),Ie.init(t,e)});function bC(t){return bu(fh,t)}var Fs=_("ZodCustomStringFormat",(t,e)=>{lf.init(t,e),Ie.init(t,e)});function xC(t,e,r={}){return Jo(Fs,t,e,r)}function $C(t){return Jo(Fs,"hostname",Ht.hostname,t)}function wC(t){return Jo(Fs,"hex",Ht.hex,t)}function kC(t,e){let r=e?.enc??"hex",n=`${t}_${r}`,o=Ht[n];if(!o)throw new Error(`Unrecognized hash format: ${n}`);return Jo(Fs,n,o,e)}var Vs=_("ZodNumber",(t,e)=>{Yc.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>Ex(t,n,o,i),t.gt=(n,o)=>t.check(qr(n,o)),t.gte=(n,o)=>t.check(vt(n,o)),t.min=(n,o)=>t.check(vt(n,o)),t.lt=(n,o)=>t.check(Ur(n,o)),t.lte=(n,o)=>t.check(qt(n,o)),t.max=(n,o)=>t.check(qt(n,o)),t.int=n=>t.check(Jm(n)),t.safe=n=>t.check(Jm(n)),t.positive=n=>t.check(qr(0,n)),t.nonnegative=n=>t.check(vt(0,n)),t.negative=n=>t.check(Ur(0,n)),t.nonpositive=n=>t.check(qt(0,n)),t.multipleOf=(n,o)=>t.check(Fn(n,o)),t.step=(n,o)=>t.check(Fn(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function pe(t){return om(Vs,t)}var Xo=_("ZodNumberFormat",(t,e)=>{df.init(t,e),Vs.init(t,e)});function Jm(t){return sm(Xo,t)}function SC(t){return am(Xo,t)}function PC(t){return cm(Xo,t)}function IC(t){return um(Xo,t)}function EC(t){return lm(Xo,t)}var Bs=_("ZodBoolean",(t,e)=>{$s.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>zx(t,r,n,o)});function _e(t){return dm(Bs,t)}var Hs=_("ZodBigInt",(t,e)=>{Qc.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>Tx(t,n,o,i),t.gte=(n,o)=>t.check(vt(n,o)),t.min=(n,o)=>t.check(vt(n,o)),t.gt=(n,o)=>t.check(qr(n,o)),t.gte=(n,o)=>t.check(vt(n,o)),t.min=(n,o)=>t.check(vt(n,o)),t.lt=(n,o)=>t.check(Ur(n,o)),t.lte=(n,o)=>t.check(qt(n,o)),t.max=(n,o)=>t.check(qt(n,o)),t.positive=n=>t.check(qr(BigInt(0),n)),t.negative=n=>t.check(Ur(BigInt(0),n)),t.nonpositive=n=>t.check(qt(BigInt(0),n)),t.nonnegative=n=>t.check(vt(BigInt(0),n)),t.multipleOf=(n,o)=>t.check(Fn(n,o));let r=t._zod.bag;t.minValue=r.minimum??null,t.maxValue=r.maximum??null,t.format=r.format??null});function zC(t){return fm(Hs,t)}var mh=_("ZodBigIntFormat",(t,e)=>{pf.init(t,e),Hs.init(t,e)});function TC(t){return hm(mh,t)}function CC(t){return gm(mh,t)}var z$=_("ZodSymbol",(t,e)=>{ff.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Cx(t,r,n,o)});function OC(t){return vm(z$,t)}var T$=_("ZodUndefined",(t,e)=>{mf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>jx(t,r,n,o)});function jC(t){return ym(T$,t)}var C$=_("ZodNull",(t,e)=>{hf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Ox(t,r,n,o)});function Gs(t){return _m(C$,t)}var O$=_("ZodAny",(t,e)=>{gf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Ax(t,r,n,o)});function hh(){return bm(O$)}var j$=_("ZodUnknown",(t,e)=>{vf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Mx(t,r,n,o)});function Ee(){return xm(j$)}var N$=_("ZodNever",(t,e)=>{yf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Rx(t,r,n,o)});function gh(t){return $m(N$,t)}var R$=_("ZodVoid",(t,e)=>{_f.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Nx(t,r,n,o)});function NC(t){return wm(R$,t)}var Cu=_("ZodDate",(t,e)=>{bf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>Dx(t,n,o,i),t.min=(n,o)=>t.check(vt(n,o)),t.max=(n,o)=>t.check(qt(n,o));let r=t._zod.bag;t.minDate=r.minimum?new Date(r.minimum):null,t.maxDate=r.maximum?new Date(r.maximum):null});function RC(t){return km(Cu,t)}var A$=_("ZodArray",(t,e)=>{xf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Kx(t,r,n,o),t.element=e.element,t.min=(r,n)=>t.check(fn(r,n)),t.nonempty=r=>t.check(fn(1,r)),t.max=(r,n)=>t.check(Go(r,n)),t.length=(r,n)=>t.check(Wo(r,n)),t.unwrap=()=>t.element});function E(t,e){return Sx(A$,t,e)}function AC(t){let e=t._zod.def.shape;return at(Object.keys(e))}var Ou=_("ZodObject",(t,e)=>{wx.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Xx(t,r,n,o),P.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>at(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Ee()}),t.loose=()=>t.clone({...t._zod.def,catchall:Ee()}),t.strict=()=>t.clone({...t._zod.def,catchall:gh()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>P.extend(t,r),t.safeExtend=r=>P.safeExtend(t,r),t.merge=r=>P.merge(t,r),t.pick=r=>P.pick(t,r),t.omit=r=>P.omit(t,r),t.partial=(...r)=>P.partial(yh,t,r[0]),t.required=(...r)=>P.required(_h,t,r[0])});function T(t,e){let r={type:"object",shape:t??{},...P.normalizeParams(e)};return new Ou(r)}function MC(t,e){return new Ou({type:"object",shape:t,catchall:gh(),...P.normalizeParams(e)})}function Be(t,e){return new Ou({type:"object",shape:t,catchall:Ee(),...P.normalizeParams(e)})}var ju=_("ZodUnion",(t,e)=>{ws.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Um(t,r,n,o),t.options=e.options});function $e(t,e){return new ju({type:"union",options:t,...P.normalizeParams(e)})}var M$=_("ZodXor",(t,e)=>{ju.init(t,e),$f.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Um(t,r,n,o),t.options=e.options});function DC(t,e){return new M$({type:"union",options:t,inclusive:!1,...P.normalizeParams(e)})}var D$=_("ZodDiscriminatedUnion",(t,e)=>{ju.init(t,e),wf.init(t,e)});function Nu(t,e,r){return new D$({type:"union",options:e,discriminator:t,...P.normalizeParams(r)})}var U$=_("ZodIntersection",(t,e)=>{kf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Yx(t,r,n,o)});function Ws(t,e){return new U$({type:"intersection",left:t,right:e})}var q$=_("ZodTuple",(t,e)=>{eu.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Qx(t,r,n,o),t.rest=r=>t.clone({...t._zod.def,rest:r})});function L$(t,e,r){let n=e instanceof H,o=n?r:e,i=n?e:null;return new q$({type:"tuple",items:t,rest:i,...P.normalizeParams(o)})}var Ru=_("ZodRecord",(t,e)=>{Sf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>e$(t,r,n,o),t.keyType=e.keyType,t.valueType=e.valueType});function Oe(t,e,r){return new Ru({type:"record",keyType:t,valueType:e,...P.normalizeParams(r)})}function UC(t,e,r){let n=gt(t);return n._zod.values=void 0,new Ru({type:"record",keyType:n,valueType:e,...P.normalizeParams(r)})}function qC(t,e,r){return new Ru({type:"record",keyType:t,valueType:e,mode:"loose",...P.normalizeParams(r)})}var Z$=_("ZodMap",(t,e)=>{Pf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Wx(t,r,n,o),t.keyType=e.keyType,t.valueType=e.valueType});function LC(t,e,r){return new Z$({type:"map",keyType:t,valueType:e,...P.normalizeParams(r)})}var F$=_("ZodSet",(t,e)=>{If.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Jx(t,r,n,o),t.min=(...r)=>t.check(Vn(...r)),t.nonempty=r=>t.check(Vn(1,r)),t.max=(...r)=>t.check(Ho(...r)),t.size=(...r)=>t.check(Is(...r))});function ZC(t,e){return new F$({type:"set",valueType:t,...P.normalizeParams(e)})}var Ls=_("ZodEnum",(t,e)=>{Ef.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>Ux(t,n,o,i),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let i={};for(let s of n)if(r.has(s))i[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new Ls({...e,checks:[],...P.normalizeParams(o),entries:i})},t.exclude=(n,o)=>{let i={...e.entries};for(let s of n)if(r.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new Ls({...e,checks:[],...P.normalizeParams(o),entries:i})}});function at(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new Ls({type:"enum",entries:r,...P.normalizeParams(e)})}function FC(t,e){return new Ls({type:"enum",entries:t,...P.normalizeParams(e)})}var V$=_("ZodLiteral",(t,e)=>{zf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>qx(t,r,n,o),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function N(t,e){return new V$({type:"literal",values:Array.isArray(t)?t:[t],...P.normalizeParams(e)})}var B$=_("ZodFile",(t,e)=>{Tf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Fx(t,r,n,o),t.min=(r,n)=>t.check(Vn(r,n)),t.max=(r,n)=>t.check(Ho(r,n)),t.mime=(r,n)=>t.check(Ns(Array.isArray(r)?r:[r],n))});function VC(t){return Om(B$,t)}var H$=_("ZodTransform",(t,e)=>{Cf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Gx(t,r,n,o),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Un(t.constructor.name);r.addIssue=i=>{if(typeof i=="string")r.issues.push(P.issue(i,r.value,e));else{let s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),r.issues.push(P.issue(s))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(i=>(r.value=i,r)):(r.value=o,r)}});function vh(t){return new H$({type:"transform",transform:t})}var yh=_("ZodOptional",(t,e)=>{Of.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>u$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function Ne(t){return new yh({type:"optional",innerType:t})}var G$=_("ZodNullable",(t,e)=>{jf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>t$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function Eu(t){return new G$({type:"nullable",innerType:t})}function BC(t){return Ne(Eu(t))}var W$=_("ZodDefault",(t,e)=>{Nf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>n$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function J$(t,e){return new W$({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():P.shallowClone(e)}})}var K$=_("ZodPrefault",(t,e)=>{Rf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>o$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function X$(t,e){return new K$({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():P.shallowClone(e)}})}var _h=_("ZodNonOptional",(t,e)=>{Af.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>r$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function Y$(t,e){return new _h({type:"nonoptional",innerType:t,...P.normalizeParams(e)})}var Q$=_("ZodSuccess",(t,e)=>{Mf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Vx(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function HC(t){return new Q$({type:"success",innerType:t})}var ew=_("ZodCatch",(t,e)=>{Df.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>i$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function tw(t,e){return new ew({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var rw=_("ZodNaN",(t,e)=>{Uf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Lx(t,r,n,o)});function GC(t){return Pm(rw,t)}var bh=_("ZodPipe",(t,e)=>{qf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>s$(t,r,n,o),t.in=e.in,t.out=e.out});function zu(t,e){return new bh({type:"pipe",in:t,out:e})}var xh=_("ZodCodec",(t,e)=>{bh.init(t,e),ks.init(t,e)});function WC(t,e,r){return new xh({type:"pipe",in:t,out:e,transform:r.decode,reverseTransform:r.encode})}var nw=_("ZodReadonly",(t,e)=>{Lf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>a$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function ow(t){return new nw({type:"readonly",innerType:t})}var iw=_("ZodTemplateLiteral",(t,e)=>{Zf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Zx(t,r,n,o)});function JC(t,e){return new iw({type:"template_literal",parts:t,...P.normalizeParams(e)})}var sw=_("ZodLazy",(t,e)=>{Bf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>l$(t,r,n,o),t.unwrap=()=>t._zod.def.getter()});function aw(t){return new sw({type:"lazy",getter:t})}var cw=_("ZodPromise",(t,e)=>{Vf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>c$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function KC(t){return new cw({type:"promise",innerType:t})}var uw=_("ZodFunction",(t,e)=>{Ff.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Hx(t,r,n,o)});function XC(t){return new uw({type:"function",input:Array.isArray(t?.input)?L$(t?.input):t?.input??E(Ee()),output:t?.output??Ee()})}var Au=_("ZodCustom",(t,e)=>{Hf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Bx(t,r,n,o)});function YC(t){let e=new Pe({check:"custom"});return e._zod.check=t,e}function $h(t,e){return jm(Au,t??(()=>!0),e)}function lw(t,e={}){return Nm(Au,t,e)}function dw(t){return Rm(t)}var QC=Am,eO=Mm;function tO(t,e={error:`Input not instance of ${t.name}`}){let r=new Au({type:"custom",check:"custom",fn:n=>n instanceof t,abort:!0,...P.normalizeParams(e)});return r._zod.bag.Class=t,r}var rO=(...t)=>Dm({Codec:xh,Boolean:Bs,String:Zs},...t);function nO(t){let e=aw(()=>$e([y(t),pe(),_e(),Gs(),E(e),Oe(y(),e)]));return e}function Mu(t,e){return zu(vh(t),e)}var fw={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};var pw;pw||(pw={});var dW={...qs,...Pu,iso:Bn};var Du={};An(Du,{bigint:()=>aO,boolean:()=>sO,date:()=>cO,number:()=>iO,string:()=>oO});function oO(t){return Yf(Zs,t)}function iO(t){return im(Vs,t)}function sO(t){return pm(Bs,t)}function aO(t){return mm(Hs,t)}function cO(t){return Sm(Cu,t)}He(Gf());var Qo="2025-11-25";var hw=[Qo,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],mn="io.modelcontextprotocol/related-task",qu="2.0",Xe=$h(t=>t!==null&&(typeof t=="object"||typeof t=="function")),gw=$e([y(),pe().int()]),vw=y(),TW=Be({ttl:$e([pe(),Gs()]).optional(),pollInterval:pe().optional()}),lO=T({ttl:pe().optional()}),dO=T({taskId:y()}),kh=Be({progressToken:gw.optional(),[mn]:dO.optional()}),Zt=T({_meta:kh.optional()}),Js=Zt.extend({task:lO.optional()}),yw=t=>Js.safeParse(t).success,Ye=T({method:y(),params:Zt.loose().optional()}),Gt=T({_meta:kh.optional()}),Wt=T({method:y(),params:Gt.loose().optional()}),Qe=Be({_meta:kh.optional()}),Lu=$e([y(),pe().int()]),_w=T({jsonrpc:N(qu),id:Lu,...Ye.shape}).strict(),Sh=t=>_w.safeParse(t).success,bw=T({jsonrpc:N(qu),...Wt.shape}).strict(),xw=t=>bw.safeParse(t).success,Ph=T({jsonrpc:N(qu),id:Lu,result:Qe}).strict(),Ks=t=>Ph.safeParse(t).success;var F;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(F||(F={}));var Ih=T({jsonrpc:N(qu),id:Lu.optional(),error:T({code:pe().int(),message:y(),data:Ee().optional()})}).strict();var $w=t=>Ih.safeParse(t).success;var Zu=$e([_w,bw,Ph,Ih]),CW=$e([Ph,Ih]),Hn=Qe.strict(),pO=Gt.extend({requestId:Lu.optional(),reason:y().optional()}),Fu=Wt.extend({method:N("notifications/cancelled"),params:pO}),fO=T({src:y(),mimeType:y().optional(),sizes:E(y()).optional(),theme:at(["light","dark"]).optional()}),Xs=T({icons:E(fO).optional()}),Yo=T({name:y(),title:y().optional()}),ww=Yo.extend({...Yo.shape,...Xs.shape,version:y(),websiteUrl:y().optional(),description:y().optional()}),mO=Ws(T({applyDefaults:_e().optional()}),Oe(y(),Ee())),hO=Mu(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,Ws(T({form:mO.optional(),url:Xe.optional()}),Oe(y(),Ee()).optional())),gO=Be({list:Xe.optional(),cancel:Xe.optional(),requests:Be({sampling:Be({createMessage:Xe.optional()}).optional(),elicitation:Be({create:Xe.optional()}).optional()}).optional()}),vO=Be({list:Xe.optional(),cancel:Xe.optional(),requests:Be({tools:Be({call:Xe.optional()}).optional()}).optional()}),yO=T({experimental:Oe(y(),Xe).optional(),sampling:T({context:Xe.optional(),tools:Xe.optional()}).optional(),elicitation:hO.optional(),roots:T({listChanged:_e().optional()}).optional(),tasks:gO.optional()}),_O=Zt.extend({protocolVersion:y(),capabilities:yO,clientInfo:ww}),bO=Ye.extend({method:N("initialize"),params:_O});var xO=T({experimental:Oe(y(),Xe).optional(),logging:Xe.optional(),completions:Xe.optional(),prompts:T({listChanged:_e().optional()}).optional(),resources:T({subscribe:_e().optional(),listChanged:_e().optional()}).optional(),tools:T({listChanged:_e().optional()}).optional(),tasks:vO.optional()}),Eh=Qe.extend({protocolVersion:y(),capabilities:xO,serverInfo:ww,instructions:y().optional()}),$O=Wt.extend({method:N("notifications/initialized"),params:Gt.optional()});var Vu=Ye.extend({method:N("ping"),params:Zt.optional()}),wO=T({progress:pe(),total:Ne(pe()),message:Ne(y())}),kO=T({...Gt.shape,...wO.shape,progressToken:gw}),Bu=Wt.extend({method:N("notifications/progress"),params:kO}),SO=Zt.extend({cursor:vw.optional()}),Ys=Ye.extend({params:SO.optional()}),Qs=Qe.extend({nextCursor:vw.optional()}),PO=at(["working","input_required","completed","failed","cancelled"]),ea=T({taskId:y(),status:PO,ttl:$e([pe(),Gs()]),createdAt:y(),lastUpdatedAt:y(),pollInterval:Ne(pe()),statusMessage:Ne(y())}),Gn=Qe.extend({task:ea}),IO=Gt.merge(ea),ta=Wt.extend({method:N("notifications/tasks/status"),params:IO}),Hu=Ye.extend({method:N("tasks/get"),params:Zt.extend({taskId:y()})}),Gu=Qe.merge(ea),Wu=Ye.extend({method:N("tasks/result"),params:Zt.extend({taskId:y()})}),OW=Qe.loose(),Ju=Ys.extend({method:N("tasks/list")}),Ku=Qs.extend({tasks:E(ea)}),Xu=Ye.extend({method:N("tasks/cancel"),params:Zt.extend({taskId:y()})}),kw=Qe.merge(ea),Sw=T({uri:y(),mimeType:Ne(y()),_meta:Oe(y(),Ee()).optional()}),Pw=Sw.extend({text:y()}),zh=y().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),Iw=Sw.extend({blob:zh}),ra=at(["user","assistant"]),ei=T({audience:E(ra).optional(),priority:pe().min(0).max(1).optional(),lastModified:Bn.datetime({offset:!0}).optional()}),Ew=T({...Yo.shape,...Xs.shape,uri:y(),description:Ne(y()),mimeType:Ne(y()),annotations:ei.optional(),_meta:Ne(Be({}))}),EO=T({...Yo.shape,...Xs.shape,uriTemplate:y(),description:Ne(y()),mimeType:Ne(y()),annotations:ei.optional(),_meta:Ne(Be({}))}),zO=Ys.extend({method:N("resources/list")}),Th=Qs.extend({resources:E(Ew)}),TO=Ys.extend({method:N("resources/templates/list")}),Ch=Qs.extend({resourceTemplates:E(EO)}),Oh=Zt.extend({uri:y()}),CO=Oh,OO=Ye.extend({method:N("resources/read"),params:CO}),jh=Qe.extend({contents:E($e([Pw,Iw]))}),Nh=Wt.extend({method:N("notifications/resources/list_changed"),params:Gt.optional()}),jO=Oh,NO=Ye.extend({method:N("resources/subscribe"),params:jO}),RO=Oh,AO=Ye.extend({method:N("resources/unsubscribe"),params:RO}),MO=Gt.extend({uri:y()}),DO=Wt.extend({method:N("notifications/resources/updated"),params:MO}),UO=T({name:y(),description:Ne(y()),required:Ne(_e())}),qO=T({...Yo.shape,...Xs.shape,description:Ne(y()),arguments:Ne(E(UO)),_meta:Ne(Be({}))}),LO=Ys.extend({method:N("prompts/list")}),Rh=Qs.extend({prompts:E(qO)}),ZO=Zt.extend({name:y(),arguments:Oe(y(),y()).optional()}),FO=Ye.extend({method:N("prompts/get"),params:ZO}),Ah=T({type:N("text"),text:y(),annotations:ei.optional(),_meta:Oe(y(),Ee()).optional()}),Mh=T({type:N("image"),data:zh,mimeType:y(),annotations:ei.optional(),_meta:Oe(y(),Ee()).optional()}),Dh=T({type:N("audio"),data:zh,mimeType:y(),annotations:ei.optional(),_meta:Oe(y(),Ee()).optional()}),VO=T({type:N("tool_use"),name:y(),id:y(),input:Oe(y(),Ee()),_meta:Oe(y(),Ee()).optional()}),BO=T({type:N("resource"),resource:$e([Pw,Iw]),annotations:ei.optional(),_meta:Oe(y(),Ee()).optional()}),HO=Ew.extend({type:N("resource_link")}),Uh=$e([Ah,Mh,Dh,HO,BO]),GO=T({role:ra,content:Uh}),qh=Qe.extend({description:y().optional(),messages:E(GO)}),Lh=Wt.extend({method:N("notifications/prompts/list_changed"),params:Gt.optional()}),WO=T({title:y().optional(),readOnlyHint:_e().optional(),destructiveHint:_e().optional(),idempotentHint:_e().optional(),openWorldHint:_e().optional()}),JO=T({taskSupport:at(["required","optional","forbidden"]).optional()}),zw=T({...Yo.shape,...Xs.shape,description:y().optional(),inputSchema:T({type:N("object"),properties:Oe(y(),Xe).optional(),required:E(y()).optional()}).catchall(Ee()),outputSchema:T({type:N("object"),properties:Oe(y(),Xe).optional(),required:E(y()).optional()}).catchall(Ee()).optional(),annotations:WO.optional(),execution:JO.optional(),_meta:Oe(y(),Ee()).optional()}),KO=Ys.extend({method:N("tools/list")}),na=Qs.extend({tools:E(zw)}),hn=Qe.extend({content:E(Uh).default([]),structuredContent:Oe(y(),Ee()).optional(),isError:_e().optional()}),jW=hn.or(Qe.extend({toolResult:Ee()})),XO=Js.extend({name:y(),arguments:Oe(y(),Ee()).optional()}),YO=Ye.extend({method:N("tools/call"),params:XO}),Zh=Wt.extend({method:N("notifications/tools/list_changed"),params:Gt.optional()}),Tw=T({autoRefresh:_e().default(!0),debounceMs:pe().int().nonnegative().default(300)}),Cw=at(["debug","info","notice","warning","error","critical","alert","emergency"]),QO=Zt.extend({level:Cw}),ej=Ye.extend({method:N("logging/setLevel"),params:QO}),tj=Gt.extend({level:Cw,logger:y().optional(),data:Ee()}),rj=Wt.extend({method:N("notifications/message"),params:tj}),nj=T({name:y().optional()}),oj=T({hints:E(nj).optional(),costPriority:pe().min(0).max(1).optional(),speedPriority:pe().min(0).max(1).optional(),intelligencePriority:pe().min(0).max(1).optional()}),ij=T({mode:at(["auto","required","none"]).optional()}),sj=T({type:N("tool_result"),toolUseId:y().describe("The unique identifier for the corresponding tool call."),content:E(Uh).default([]),structuredContent:T({}).loose().optional(),isError:_e().optional(),_meta:Oe(y(),Ee()).optional()}),aj=Nu("type",[Ah,Mh,Dh]),Uu=Nu("type",[Ah,Mh,Dh,VO,sj]),cj=T({role:ra,content:$e([Uu,E(Uu)]),_meta:Oe(y(),Ee()).optional()}),uj=Js.extend({messages:E(cj),modelPreferences:oj.optional(),systemPrompt:y().optional(),includeContext:at(["none","thisServer","allServers"]).optional(),temperature:pe().optional(),maxTokens:pe().int(),stopSequences:E(y()).optional(),metadata:Xe.optional(),tools:E(zw).optional(),toolChoice:ij.optional()}),Fh=Ye.extend({method:N("sampling/createMessage"),params:uj}),Vh=Qe.extend({model:y(),stopReason:Ne(at(["endTurn","stopSequence","maxTokens"]).or(y())),role:ra,content:aj}),lj=Qe.extend({model:y(),stopReason:Ne(at(["endTurn","stopSequence","maxTokens","toolUse"]).or(y())),role:ra,content:$e([Uu,E(Uu)])}),dj=T({type:N("boolean"),title:y().optional(),description:y().optional(),default:_e().optional()}),pj=T({type:N("string"),title:y().optional(),description:y().optional(),minLength:pe().optional(),maxLength:pe().optional(),format:at(["email","uri","date","date-time"]).optional(),default:y().optional()}),fj=T({type:at(["number","integer"]),title:y().optional(),description:y().optional(),minimum:pe().optional(),maximum:pe().optional(),default:pe().optional()}),mj=T({type:N("string"),title:y().optional(),description:y().optional(),enum:E(y()),default:y().optional()}),hj=T({type:N("string"),title:y().optional(),description:y().optional(),oneOf:E(T({const:y(),title:y()})),default:y().optional()}),gj=T({type:N("string"),title:y().optional(),description:y().optional(),enum:E(y()),enumNames:E(y()).optional(),default:y().optional()}),vj=$e([mj,hj]),yj=T({type:N("array"),title:y().optional(),description:y().optional(),minItems:pe().optional(),maxItems:pe().optional(),items:T({type:N("string"),enum:E(y())}),default:E(y()).optional()}),_j=T({type:N("array"),title:y().optional(),description:y().optional(),minItems:pe().optional(),maxItems:pe().optional(),items:T({anyOf:E(T({const:y(),title:y()}))}),default:E(y()).optional()}),bj=$e([yj,_j]),xj=$e([gj,vj,bj]),$j=$e([xj,dj,pj,fj]),wj=Js.extend({mode:N("form").optional(),message:y(),requestedSchema:T({type:N("object"),properties:Oe(y(),$j),required:E(y()).optional()})}),kj=Js.extend({mode:N("url"),message:y(),elicitationId:y(),url:y().url()}),Sj=$e([wj,kj]),Bh=Ye.extend({method:N("elicitation/create"),params:Sj}),Pj=Gt.extend({elicitationId:y()}),Ij=Wt.extend({method:N("notifications/elicitation/complete"),params:Pj}),Hh=Qe.extend({action:at(["accept","decline","cancel"]),content:Mu(t=>t===null?void 0:t,Oe(y(),$e([y(),pe(),_e(),E(y())])).optional())}),Ej=T({type:N("ref/resource"),uri:y()});var zj=T({type:N("ref/prompt"),name:y()}),Tj=Zt.extend({ref:$e([zj,Ej]),argument:T({name:y(),value:y()}),context:T({arguments:Oe(y(),y()).optional()}).optional()}),Cj=Ye.extend({method:N("completion/complete"),params:Tj});var Gh=Qe.extend({completion:Be({values:E(y()).max(100),total:Ne(pe().int()),hasMore:Ne(_e())})}),Oj=T({uri:y().startsWith("file://"),name:y().optional(),_meta:Oe(y(),Ee()).optional()}),jj=Ye.extend({method:N("roots/list"),params:Zt.optional()}),Nj=Qe.extend({roots:E(Oj)}),Rj=Wt.extend({method:N("notifications/roots/list_changed"),params:Gt.optional()}),NW=$e([Vu,bO,Cj,ej,FO,LO,zO,TO,OO,NO,AO,YO,KO,Hu,Wu,Ju,Xu]),RW=$e([Fu,Bu,$O,Rj,ta]),AW=$e([Hn,Vh,lj,Hh,Nj,Gu,Ku,Gn]),MW=$e([Vu,Fh,Bh,jj,Hu,Wu,Ju,Xu]),DW=$e([Fu,Bu,rj,DO,Nh,Zh,Lh,ta,Ij]),UW=$e([Hn,Eh,Gh,qh,Rh,Th,Ch,jh,hn,na,Gu,Ku,Gn]),M=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===F.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new wh(o.elicitations,r)}return new t(e,r,n)}},wh=class extends M{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(F.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}};function gn(t){return t==="completed"||t==="failed"||t==="cancelled"}var _3=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Wh(t){let r=Su(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=m$(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function Jh(t,e){let r=ur(t,e);if(!r.success)throw r.error;return r.data}var Lj=6e4,Yu=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(Fu,r=>{this._oncancel(r)}),this.setNotificationHandler(Bu,r=>{this._onprogress(r)}),this.setRequestHandler(Vu,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(Hu,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new M(F.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(Wu,async(r,n)=>{let o=async()=>{let i=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(i,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{let d=c,p=new M(d.error.code,d.error.message,d.error.data);l(p)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let s=await this._taskStore.getTask(i,n.sessionId);if(!s)throw new M(F.InvalidParams,`Task not found: ${i}`);if(!gn(s.status))return await this._waitForTaskUpdate(i,n.signal),await o();if(gn(s.status)){let a=await this._taskStore.getTaskResult(i,n.sessionId);return this._clearTaskQueue(i),{...a,_meta:{...a._meta,[mn]:{taskId:i}}}}return await o()};return await o()}),this.setRequestHandler(Ju,async(r,n)=>{try{let{tasks:o,nextCursor:i}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:i,_meta:{}}}catch(o){throw new M(F.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(Xu,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new M(F.InvalidParams,`Task not found: ${r.params.taskId}`);if(gn(o.status))throw new M(F.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let i=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!i)throw new M(F.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...i}}catch(o){throw o instanceof M?o:new M(F.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,i=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:i,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),M.fromError(F.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=i=>{n?.(i),this._onerror(i)};let o=this._transport?.onmessage;this._transport.onmessage=(i,s)=>{o?.(i,s),Ks(i)||$w(i)?this._onresponse(i):Sh(i)?this._onrequest(i,s):xw(i)?this._onnotification(i):this._onerror(new Error(`Unknown message type: ${JSON.stringify(i)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let r=M.fromError(F.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,i=e.params?._meta?.[mn]?.taskId;if(n===void 0){let l={jsonrpc:"2.0",id:e.id,error:{code:F.MethodNotFound,message:"Method not found"}};i&&this._taskMessageQueue?this._enqueueTaskMessage(i,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(l).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let s=new AbortController;this._requestHandlerAbortControllers.set(e.id,s);let a=yw(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,u={signal:s.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async l=>{let d={relatedRequestId:e.id};i&&(d.relatedTask={taskId:i}),await this.notification(l,d)},sendRequest:async(l,d,p)=>{let f={...p,relatedRequestId:e.id};i&&!f.relatedTask&&(f.relatedTask={taskId:i});let h=f.relatedTask?.taskId??i;return h&&c&&await c.updateTaskStatus(h,"input_required"),await this.request(l,d,f)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:i,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,u)).then(async l=>{if(s.signal.aborted)return;let d={result:l,jsonrpc:"2.0",id:e.id};i&&this._taskMessageQueue?await this._enqueueTaskMessage(i,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async l=>{if(s.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:F.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};i&&this._taskMessageQueue?await this._enqueueTaskMessage(i,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),i=this._progressHandlers.get(o);if(!i){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let s=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&s&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),s(c);return}i(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),Ks(e))n(e);else{let s=new M(e.error.code,e.error.message,e.error.data);n(s)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let i=!1;if(Ks(e)&&e.result&&typeof e.result=="object"){let s=e.result;if(s.task&&typeof s.task=="object"){let a=s.task;typeof a.taskId=="string"&&(i=!0,this._taskProgressTokens.set(a.taskId,r))}}if(i||this._progressHandlers.delete(r),Ks(e))o(e);else{let s=M.fromError(e.error.code,e.error.message,e.error.data);o(s)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(s){yield{type:"error",error:s instanceof M?s:new M(F.InternalError,String(s))}}return}let i;try{let s=await this.request(e,Gn,n);if(s.task)i=s.task.taskId,yield{type:"taskCreated",task:s.task};else throw new M(F.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:i},n);if(yield{type:"taskStatus",task:a},gn(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:i},r,n)}:a.status==="failed"?yield{type:"error",error:new M(F.InternalError,`Task ${i} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new M(F.InternalError,`Task ${i} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:i},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(s){yield{type:"error",error:s instanceof M?s:new M(F.InternalError,String(s))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{let d=x=>{l(x)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(x){d(x);return}n?.signal?.throwIfAborted();let p=this._requestMessageId++,f={...e,jsonrpc:"2.0",id:p};n?.onprogress&&(this._progressHandlers.set(p,n.onprogress),f.params={...e.params,_meta:{...e.params?._meta||{},progressToken:p}}),a&&(f.params={...f.params,task:a}),c&&(f.params={...f.params,_meta:{...f.params?._meta||{},[mn]:c}});let h=x=>{this._responseHandlers.delete(p),this._progressHandlers.delete(p),this._cleanupTimeout(p),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:p,reason:String(x)}},{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s}).catch(I=>this._onerror(new Error(`Failed to send cancellation: ${I}`)));let w=x instanceof M?x:new M(F.RequestTimeout,String(x));l(w)};this._responseHandlers.set(p,x=>{if(!n?.signal?.aborted){if(x instanceof Error)return l(x);try{let w=ur(r,x.result);w.success?u(w.data):l(w.error)}catch(w){l(w)}}}),n?.signal?.addEventListener("abort",()=>{h(n?.signal?.reason)});let m=n?.timeout??Lj,g=()=>h(M.fromError(F.RequestTimeout,"Request timed out",{timeout:m}));this._setupTimeout(p,m,n?.maxTotalTimeout,g,n?.resetTimeoutOnProgress??!1);let v=c?.taskId;if(v){let x=w=>{let I=this._responseHandlers.get(p);I?I(w):this._onerror(new Error(`Response handler missing for side-channeled request ${p}`))};this._requestResolvers.set(p,x),this._enqueueTaskMessage(v,{type:"request",message:f,timestamp:Date.now()}).catch(w=>{this._cleanupTimeout(p),l(w)})}else this._transport.send(f,{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s}).catch(x=>{this._cleanupTimeout(p),l(x)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},Gu,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},Ku,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},kw,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[mn]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[mn]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let s={...e,jsonrpc:"2.0"};r?.relatedTask&&(s={...s,params:{...s.params,_meta:{...s.params?._meta||{},[mn]:r.relatedTask}}}),await this._transport.send(s,r)}setRequestHandler(e,r){let n=Wh(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,i)=>{let s=Jh(e,o);return Promise.resolve(r(s,i))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=Wh(e);this._notificationHandlers.set(n,o=>{let i=Jh(e,o);return Promise.resolve(r(i))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&Sh(o.message)){let i=o.message.id,s=this._requestResolvers.get(i);s?(s(new M(F.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(i)):this._onerror(new Error(`Resolver missing for request ${i} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,i)=>{if(r.aborted){i(new M(F.InvalidRequest,"Request cancelled"));return}let s=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(s),i(new M(F.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let i=await n.getTask(o,r);if(!i)throw new M(F.InvalidParams,"Failed to retrieve task: Task not found");return i},storeTaskResult:async(o,i,s)=>{await n.storeTaskResult(o,i,s,r);let a=await n.getTask(o,r);if(a){let c=ta.parse({method:"notifications/tasks/status",params:a});await this.notification(c),gn(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,i,s)=>{let a=await n.getTask(o,r);if(!a)throw new M(F.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(gn(a.status))throw new M(F.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${i}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,i,s,r);let c=await n.getTask(o,r);if(c){let u=ta.parse({method:"notifications/tasks/status",params:c});await this.notification(u),gn(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}};function Ow(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function jw(t,e){let r={...t};for(let n in e){let o=n,i=e[o];if(i===void 0)continue;let s=r[o];Ow(s)&&Ow(i)?r[o]={...s,...i}:r[o]=i}return r}var jI=Le(iS(),1),NI=Le(OI(),1);function S2(){let t=new jI.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,NI.default)(t),t}var pd=class{constructor(e){this._ajv=e??S2()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}};var fd=class{constructor(e){this._client=e}async*callToolStream(e,r=hn,n){let o=this._client,i={...n,task:n?.task??(o.isToolTask(e.name)?{}:void 0)},s=o.requestStream({method:"tools/call",params:e},r,i),a=o.getToolOutputValidator(e.name);for await(let c of s){if(c.type==="result"&&a){let u=c.result;if(!u.structuredContent&&!u.isError){yield{type:"error",error:new M(F.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`)};return}if(u.structuredContent)try{let l=a(u.structuredContent);if(!l.valid){yield{type:"error",error:new M(F.InvalidParams,`Structured content does not match the tool's output schema: ${l.errorMessage}`)};return}}catch(l){if(l instanceof M){yield{type:"error",error:l};return}yield{type:"error",error:new M(F.InvalidParams,`Failed to validate structured content: ${l instanceof Error?l.message:String(l)}`)};return}}yield c}}async getTask(e,r){return this._client.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._client.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._client.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._client.cancelTask({taskId:e},r)}requestStream(e,r,n){return this._client.requestStream(e,r,n)}};function RI(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function AI(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}function md(t,e){if(!(!t||e===null||typeof e!="object")){if(t.type==="object"&&t.properties&&typeof t.properties=="object"){let r=e,n=t.properties;for(let o of Object.keys(n)){let i=n[o];r[o]===void 0&&Object.prototype.hasOwnProperty.call(i,"default")&&(r[o]=i.default),r[o]!==void 0&&md(i,r[o])}}if(Array.isArray(t.anyOf))for(let r of t.anyOf)typeof r!="boolean"&&md(r,e);if(Array.isArray(t.oneOf))for(let r of t.oneOf)typeof r!="boolean"&&md(r,e)}}function P2(t){if(!t)return{supportsFormMode:!1,supportsUrlMode:!1};let e=t.form!==void 0,r=t.url!==void 0;return{supportsFormMode:e||!e&&!r,supportsUrlMode:r}}var hd=class extends Yu{constructor(e,r){super(r),this._clientInfo=e,this._cachedToolOutputValidators=new Map,this._cachedKnownTaskTools=new Set,this._cachedRequiredTaskTools=new Set,this._listChangedDebounceTimers=new Map,this._capabilities=r?.capabilities??{},this._jsonSchemaValidator=r?.jsonSchemaValidator??new pd,r?.listChanged&&(this._pendingListChangedConfig=r.listChanged)}_setupListChangedHandlers(e){e.tools&&this._serverCapabilities?.tools?.listChanged&&this._setupListChangedHandler("tools",Zh,e.tools,async()=>(await this.listTools()).tools),e.prompts&&this._serverCapabilities?.prompts?.listChanged&&this._setupListChangedHandler("prompts",Lh,e.prompts,async()=>(await this.listPrompts()).prompts),e.resources&&this._serverCapabilities?.resources?.listChanged&&this._setupListChangedHandler("resources",Nh,e.resources,async()=>(await this.listResources()).resources)}get experimental(){return this._experimental||(this._experimental={tasks:new fd(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=jw(this._capabilities,e)}setRequestHandler(e,r){let o=Su(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let i;if(Ko(o)){let a=o;i=a._zod?.def?.value??a.value}else{let a=o;i=a._def?.value??a.value}if(typeof i!="string")throw new Error("Schema method literal must be a string");let s=i;if(s==="elicitation/create"){let a=async(c,u)=>{let l=ur(Bh,c);if(!l.success){let x=l.error instanceof Error?l.error.message:String(l.error);throw new M(F.InvalidParams,`Invalid elicitation request: ${x}`)}let{params:d}=l.data;d.mode=d.mode??"form";let{supportsFormMode:p,supportsUrlMode:f}=P2(this._capabilities.elicitation);if(d.mode==="form"&&!p)throw new M(F.InvalidParams,"Client does not support form-mode elicitation requests");if(d.mode==="url"&&!f)throw new M(F.InvalidParams,"Client does not support URL-mode elicitation requests");let h=await Promise.resolve(r(c,u));if(d.task){let x=ur(Gn,h);if(!x.success){let w=x.error instanceof Error?x.error.message:String(x.error);throw new M(F.InvalidParams,`Invalid task creation result: ${w}`)}return x.data}let m=ur(Hh,h);if(!m.success){let x=m.error instanceof Error?m.error.message:String(m.error);throw new M(F.InvalidParams,`Invalid elicitation result: ${x}`)}let g=m.data,v=d.mode==="form"?d.requestedSchema:void 0;if(d.mode==="form"&&g.action==="accept"&&g.content&&v&&this._capabilities.elicitation?.form?.applyDefaults)try{md(v,g.content)}catch{}return g};return super.setRequestHandler(e,a)}if(s==="sampling/createMessage"){let a=async(c,u)=>{let l=ur(Fh,c);if(!l.success){let h=l.error instanceof Error?l.error.message:String(l.error);throw new M(F.InvalidParams,`Invalid sampling request: ${h}`)}let{params:d}=l.data,p=await Promise.resolve(r(c,u));if(d.task){let h=ur(Gn,p);if(!h.success){let m=h.error instanceof Error?h.error.message:String(h.error);throw new M(F.InvalidParams,`Invalid task creation result: ${m}`)}return h.data}let f=ur(Vh,p);if(!f.success){let h=f.error instanceof Error?f.error.message:String(f.error);throw new M(F.InvalidParams,`Invalid sampling result: ${h}`)}return f.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapability(e,r){if(!this._serverCapabilities?.[e])throw new Error(`Server does not support ${e} (required for ${r})`)}async connect(e,r){if(await super.connect(e),e.sessionId===void 0)try{let n=await this.request({method:"initialize",params:{protocolVersion:Qo,capabilities:this._capabilities,clientInfo:this._clientInfo}},Eh,r);if(n===void 0)throw new Error(`Server sent invalid initialize result: ${n}`);if(!hw.includes(n.protocolVersion))throw new Error(`Server's protocol version is not supported: ${n.protocolVersion}`);this._serverCapabilities=n.capabilities,this._serverVersion=n.serverInfo,e.setProtocolVersion&&e.setProtocolVersion(n.protocolVersion),this._instructions=n.instructions,await this.notification({method:"notifications/initialized"}),this._pendingListChangedConfig&&(this._setupListChangedHandlers(this._pendingListChangedConfig),this._pendingListChangedConfig=void 0)}catch(n){throw this.close(),n}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){switch(e){case"logging/setLevel":if(!this._serverCapabilities?.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._serverCapabilities?.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!this._serverCapabilities?.resources)throw new Error(`Server does not support resources (required for ${e})`);if(e==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._serverCapabilities?.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!this._serverCapabilities?.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"initialize":break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/roots/list_changed":if(!this._capabilities.roots?.listChanged)throw new Error(`Client does not support roots list changed notifications (required for ${e})`);break;case"notifications/initialized":break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Client does not support tasks capability (required for ${e})`);break;case"ping":break}}assertTaskCapability(e){RI(this._serverCapabilities?.tasks?.requests,e,"Server")}assertTaskHandlerCapability(e){this._capabilities&&AI(this._capabilities.tasks?.requests,e,"Client")}async ping(e){return this.request({method:"ping"},Hn,e)}async complete(e,r){return this.request({method:"completion/complete",params:e},Gh,r)}async setLoggingLevel(e,r){return this.request({method:"logging/setLevel",params:{level:e}},Hn,r)}async getPrompt(e,r){return this.request({method:"prompts/get",params:e},qh,r)}async listPrompts(e,r){return this.request({method:"prompts/list",params:e},Rh,r)}async listResources(e,r){return this.request({method:"resources/list",params:e},Th,r)}async listResourceTemplates(e,r){return this.request({method:"resources/templates/list",params:e},Ch,r)}async readResource(e,r){return this.request({method:"resources/read",params:e},jh,r)}async subscribeResource(e,r){return this.request({method:"resources/subscribe",params:e},Hn,r)}async unsubscribeResource(e,r){return this.request({method:"resources/unsubscribe",params:e},Hn,r)}async callTool(e,r=hn,n){if(this.isToolTaskRequired(e.name))throw new M(F.InvalidRequest,`Tool "${e.name}" requires task-based execution. Use client.experimental.tasks.callToolStream() instead.`);let o=await this.request({method:"tools/call",params:e},r,n),i=this.getToolOutputValidator(e.name);if(i){if(!o.structuredContent&&!o.isError)throw new M(F.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`);if(o.structuredContent)try{let s=i(o.structuredContent);if(!s.valid)throw new M(F.InvalidParams,`Structured content does not match the tool's output schema: ${s.errorMessage}`)}catch(s){throw s instanceof M?s:new M(F.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return o}isToolTask(e){return this._serverCapabilities?.tasks?.requests?.tools?.call?this._cachedKnownTaskTools.has(e):!1}isToolTaskRequired(e){return this._cachedRequiredTaskTools.has(e)}cacheToolMetadata(e){this._cachedToolOutputValidators.clear(),this._cachedKnownTaskTools.clear(),this._cachedRequiredTaskTools.clear();for(let r of e){if(r.outputSchema){let o=this._jsonSchemaValidator.getValidator(r.outputSchema);this._cachedToolOutputValidators.set(r.name,o)}let n=r.execution?.taskSupport;(n==="required"||n==="optional")&&this._cachedKnownTaskTools.add(r.name),n==="required"&&this._cachedRequiredTaskTools.add(r.name)}}getToolOutputValidator(e){return this._cachedToolOutputValidators.get(e)}async listTools(e,r){let n=await this.request({method:"tools/list",params:e},na,r);return this.cacheToolMetadata(n.tools),n}_setupListChangedHandler(e,r,n,o){let i=Tw.safeParse(n);if(!i.success)throw new Error(`Invalid ${e} listChanged options: ${i.error.message}`);if(typeof n.onChanged!="function")throw new Error(`Invalid ${e} listChanged options: onChanged must be a function`);let{autoRefresh:s,debounceMs:a}=i.data,{onChanged:c}=n,u=async()=>{if(!s){c(null,null);return}try{let d=await o();c(null,d)}catch(d){let p=d instanceof Error?d:new Error(String(d));c(p,null)}},l=()=>{if(a){let d=this._listChangedDebounceTimers.get(e);d&&clearTimeout(d);let p=setTimeout(u,a);this._listChangedDebounceTimers.set(e,p)}else u()};this.setNotificationHandler(r,l)}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}};var PE=Le(kE(),1),cc=Le(require("node:process"),1),IE=require("node:stream");var vd=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),Q2(r)}clear(){this._buffer=void 0}};function Q2(t){return Zu.parse(JSON.parse(t))}function SE(t){return JSON.stringify(t)+`
`}var eZ=cc.default.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function tZ(){let t={};for(let e of eZ){let r=cc.default.env[e];r!==void 0&&(r.startsWith("()")||(t[e]=r))}return t}var yd=class{constructor(e){this._readBuffer=new vd,this._stderrStream=null,this._serverParams=e,(e.stderr==="pipe"||e.stderr==="overlapped")&&(this._stderrStream=new IE.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,r)=>{this._process=(0,PE.default)(this._serverParams.command,this._serverParams.args??[],{env:{...tZ(),...this._serverParams.env},stdio:["pipe","pipe",this._serverParams.stderr??"inherit"],shell:!1,windowsHide:cc.default.platform==="win32"&&rZ(),cwd:this._serverParams.cwd}),this._process.on("error",n=>{r(n),this.onerror?.(n)}),this._process.on("spawn",()=>{e()}),this._process.on("close",n=>{this._process=void 0,this.onclose?.()}),this._process.stdin?.on("error",n=>{this.onerror?.(n)}),this._process.stdout?.on("data",n=>{this._readBuffer.append(n),this.processReadBuffer()}),this._process.stdout?.on("error",n=>{this.onerror?.(n)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){return this._stderrStream?this._stderrStream:this._process?.stderr??null}get pid(){return this._process?.pid??null}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){if(this._process){let e=this._process;this._process=void 0;let r=new Promise(n=>{e.once("close",()=>{n()})});try{e.stdin?.end()}catch{}if(await Promise.race([r,new Promise(n=>setTimeout(n,2e3).unref())]),e.exitCode===null){try{e.kill("SIGTERM")}catch{}await Promise.race([r,new Promise(n=>setTimeout(n,2e3).unref())])}if(e.exitCode===null)try{e.kill("SIGKILL")}catch{}}this._readBuffer.clear()}send(e){return new Promise(r=>{if(!this._process?.stdin)throw new Error("Not connected");let n=SE(e);this._process.stdin.write(n)?r():this._process.stdin.once("drain",r)})}};function rZ(){return"type"in cc.default}var _d=class extends Error{constructor(e,r){super(e),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}};function E_(t){}function EE(t){if(typeof t=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=E_,onError:r=E_,onRetry:n=E_,onComment:o}=t,i="",s=!0,a,c="",u="";function l(m){let g=s?m.replace(/^\xEF\xBB\xBF/,""):m,[v,x]=nZ(`${i}${g}`);for(let w of v)d(w);i=x,s=!1}function d(m){if(m===""){f();return}if(m.startsWith(":")){o&&o(m.slice(m.startsWith(": ")?2:1));return}let g=m.indexOf(":");if(g!==-1){let v=m.slice(0,g),x=m[g+1]===" "?2:1,w=m.slice(g+x);p(v,w,m);return}p(m,"",m)}function p(m,g,v){switch(m){case"event":u=g;break;case"data":c=`${c}${g}
`;break;case"id":a=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?n(parseInt(g,10)):r(new _d(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:v}));break;default:r(new _d(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:g,line:v}));break}}function f(){c.length>0&&e({id:a,event:u||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),a=void 0,c="",u=""}function h(m={}){i&&m.consume&&d(i),s=!0,a=void 0,c="",u="",i=""}return{feed:l,reset:h}}function nZ(t){let e=[],r="",n=0;for(;n<t.length;){let o=t.indexOf("\r",n),i=t.indexOf(`
`,n),s=-1;if(o!==-1&&i!==-1?s=Math.min(o,i):o!==-1?o===t.length-1?s=-1:s=o:i!==-1&&(s=i),s===-1){r=t.slice(n);break}else{let a=t.slice(n,s);e.push(a),n=s+1,t[n-1]==="\r"&&t[n]===`
`&&n++}}return[e,r]}var xd=class extends Event{constructor(e,r){var n,o;super(e),this.code=(n=r?.code)!=null?n:void 0,this.message=(o=r?.message)!=null?o:void 0}[Symbol.for("nodejs.util.inspect.custom")](e,r,n){return n(zE(this),r)}[Symbol.for("Deno.customInspect")](e,r){return e(zE(this),r)}};function oZ(t){let e=globalThis.DOMException;return typeof e=="function"?new e(t,"SyntaxError"):new SyntaxError(t)}function z_(t){return t instanceof Error?"errors"in t&&Array.isArray(t.errors)?t.errors.map(z_).join(", "):"cause"in t&&t.cause instanceof Error?`${t}: ${z_(t.cause)}`:t.message:`${t}`}function zE(t){return{type:t.type,message:t.message,code:t.code,defaultPrevented:t.defaultPrevented,cancelable:t.cancelable,timeStamp:t.timeStamp}}var CE=t=>{throw TypeError(t)},M_=(t,e,r)=>e.has(t)||CE("Cannot "+r),ce=(t,e,r)=>(M_(t,e,"read from private field"),r?r.call(t):e.get(t)),Ge=(t,e,r)=>e.has(t)?CE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Ue=(t,e,r,n)=>(M_(t,e,"write to private field"),e.set(t,r),r),Yr=(t,e,r)=>(M_(t,e,"access private method"),r),Nt,ho,ji,bd,$d,dc,Ai,pc,On,Ni,Mi,Ri,uc,_r,T_,C_,O_,TE,j_,N_,lc,R_,A_,go=class extends EventTarget{constructor(e,r){var n,o;super(),Ge(this,_r),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,Ge(this,Nt),Ge(this,ho),Ge(this,ji),Ge(this,bd),Ge(this,$d),Ge(this,dc),Ge(this,Ai),Ge(this,pc,null),Ge(this,On),Ge(this,Ni),Ge(this,Mi,null),Ge(this,Ri,null),Ge(this,uc,null),Ge(this,C_,async i=>{var s;ce(this,Ni).reset();let{body:a,redirected:c,status:u,headers:l}=i;if(u===204){Yr(this,_r,lc).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(c?Ue(this,ji,new URL(i.url)):Ue(this,ji,void 0),u!==200){Yr(this,_r,lc).call(this,`Non-200 status code (${u})`,u);return}if(!(l.get("content-type")||"").startsWith("text/event-stream")){Yr(this,_r,lc).call(this,'Invalid content type, expected "text/event-stream"',u);return}if(ce(this,Nt)===this.CLOSED)return;Ue(this,Nt,this.OPEN);let d=new Event("open");if((s=ce(this,uc))==null||s.call(this,d),this.dispatchEvent(d),typeof a!="object"||!a||!("getReader"in a)){Yr(this,_r,lc).call(this,"Invalid response body, expected a web ReadableStream",u),this.close();return}let p=new TextDecoder,f=a.getReader(),h=!0;do{let{done:m,value:g}=await f.read();g&&ce(this,Ni).feed(p.decode(g,{stream:!m})),m&&(h=!1,ce(this,Ni).reset(),Yr(this,_r,R_).call(this))}while(h)}),Ge(this,O_,i=>{Ue(this,On,void 0),!(i.name==="AbortError"||i.type==="aborted")&&Yr(this,_r,R_).call(this,z_(i))}),Ge(this,j_,i=>{typeof i.id=="string"&&Ue(this,pc,i.id);let s=new MessageEvent(i.event||"message",{data:i.data,origin:ce(this,ji)?ce(this,ji).origin:ce(this,ho).origin,lastEventId:i.id||""});ce(this,Ri)&&(!i.event||i.event==="message")&&ce(this,Ri).call(this,s),this.dispatchEvent(s)}),Ge(this,N_,i=>{Ue(this,dc,i)}),Ge(this,A_,()=>{Ue(this,Ai,void 0),ce(this,Nt)===this.CONNECTING&&Yr(this,_r,T_).call(this)});try{if(e instanceof URL)Ue(this,ho,e);else if(typeof e=="string")Ue(this,ho,new URL(e,iZ()));else throw new Error("Invalid URL")}catch{throw oZ("An invalid or illegal string was specified")}Ue(this,Ni,EE({onEvent:ce(this,j_),onRetry:ce(this,N_)})),Ue(this,Nt,this.CONNECTING),Ue(this,dc,3e3),Ue(this,$d,(n=r?.fetch)!=null?n:globalThis.fetch),Ue(this,bd,(o=r?.withCredentials)!=null?o:!1),Yr(this,_r,T_).call(this)}get readyState(){return ce(this,Nt)}get url(){return ce(this,ho).href}get withCredentials(){return ce(this,bd)}get onerror(){return ce(this,Mi)}set onerror(e){Ue(this,Mi,e)}get onmessage(){return ce(this,Ri)}set onmessage(e){Ue(this,Ri,e)}get onopen(){return ce(this,uc)}set onopen(e){Ue(this,uc,e)}addEventListener(e,r,n){let o=r;super.addEventListener(e,o,n)}removeEventListener(e,r,n){let o=r;super.removeEventListener(e,o,n)}close(){ce(this,Ai)&&clearTimeout(ce(this,Ai)),ce(this,Nt)!==this.CLOSED&&(ce(this,On)&&ce(this,On).abort(),Ue(this,Nt,this.CLOSED),Ue(this,On,void 0))}};Nt=new WeakMap,ho=new WeakMap,ji=new WeakMap,bd=new WeakMap,$d=new WeakMap,dc=new WeakMap,Ai=new WeakMap,pc=new WeakMap,On=new WeakMap,Ni=new WeakMap,Mi=new WeakMap,Ri=new WeakMap,uc=new WeakMap,_r=new WeakSet,T_=function(){Ue(this,Nt,this.CONNECTING),Ue(this,On,new AbortController),ce(this,$d)(ce(this,ho),Yr(this,_r,TE).call(this)).then(ce(this,C_)).catch(ce(this,O_))},C_=new WeakMap,O_=new WeakMap,TE=function(){var t;let e={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...ce(this,pc)?{"Last-Event-ID":ce(this,pc)}:void 0},cache:"no-store",signal:(t=ce(this,On))==null?void 0:t.signal};return"window"in globalThis&&(e.credentials=this.withCredentials?"include":"same-origin"),e},j_=new WeakMap,N_=new WeakMap,lc=function(t,e){var r;ce(this,Nt)!==this.CLOSED&&Ue(this,Nt,this.CLOSED);let n=new xd("error",{code:e,message:t});(r=ce(this,Mi))==null||r.call(this,n),this.dispatchEvent(n)},R_=function(t,e){var r;if(ce(this,Nt)===this.CLOSED)return;Ue(this,Nt,this.CONNECTING);let n=new xd("error",{code:e,message:t});(r=ce(this,Mi))==null||r.call(this,n),this.dispatchEvent(n),Ue(this,Ai,setTimeout(ce(this,A_),ce(this,dc)))},A_=new WeakMap,go.CONNECTING=0,go.OPEN=1,go.CLOSED=2;function iZ(){let t="document"in globalThis?globalThis.document:void 0;return t&&typeof t=="object"&&"baseURI"in t&&typeof t.baseURI=="string"?t.baseURI:void 0}function wd(t){return t?t instanceof Headers?Object.fromEntries(t.entries()):Array.isArray(t)?Object.fromEntries(t):{...t}:{}}function OE(t=fetch,e){return e?async(r,n)=>{let o={...e,...n,headers:n?.headers?{...wd(e.headers),...wd(n.headers)}:e.headers};return t(r,o)}:t}var D_;D_=globalThis.crypto?.webcrypto??globalThis.crypto??import("node:crypto").then(t=>t.webcrypto);async function sZ(t){return(await D_).getRandomValues(new Uint8Array(t))}async function aZ(t){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~",r=Math.pow(2,8)-Math.pow(2,8)%e.length,n="";for(;n.length<t;){let o=await sZ(t-n.length);for(let i of o)i<r&&(n+=e[i%e.length])}return n}async function cZ(t){return await aZ(t)}async function uZ(t){let e=await(await D_).subtle.digest("SHA-256",new TextEncoder().encode(t));return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function U_(t){if(t||(t=43),t<43||t>128)throw`Expected a length between 43 and 128. Received ${t}.`;let e=await cZ(t),r=await uZ(e);return{code_verifier:e,code_challenge:r}}var it=Ym().superRefine((t,e)=>{if(!URL.canParse(t))return e.addIssue({code:fw.custom,message:"URL must be parseable",fatal:!0}),Uc}).refine(t=>{let e=new URL(t);return e.protocol!=="javascript:"&&e.protocol!=="data:"&&e.protocol!=="vbscript:"},{message:"URL cannot use javascript:, data:, or vbscript: scheme"}),NE=Be({resource:y().url(),authorization_servers:E(it).optional(),jwks_uri:y().url().optional(),scopes_supported:E(y()).optional(),bearer_methods_supported:E(y()).optional(),resource_signing_alg_values_supported:E(y()).optional(),resource_name:y().optional(),resource_documentation:y().optional(),resource_policy_uri:y().url().optional(),resource_tos_uri:y().url().optional(),tls_client_certificate_bound_access_tokens:_e().optional(),authorization_details_types_supported:E(y()).optional(),dpop_signing_alg_values_supported:E(y()).optional(),dpop_bound_access_tokens_required:_e().optional()}),q_=Be({issuer:y(),authorization_endpoint:it,token_endpoint:it,registration_endpoint:it.optional(),scopes_supported:E(y()).optional(),response_types_supported:E(y()),response_modes_supported:E(y()).optional(),grant_types_supported:E(y()).optional(),token_endpoint_auth_methods_supported:E(y()).optional(),token_endpoint_auth_signing_alg_values_supported:E(y()).optional(),service_documentation:it.optional(),revocation_endpoint:it.optional(),revocation_endpoint_auth_methods_supported:E(y()).optional(),revocation_endpoint_auth_signing_alg_values_supported:E(y()).optional(),introspection_endpoint:y().optional(),introspection_endpoint_auth_methods_supported:E(y()).optional(),introspection_endpoint_auth_signing_alg_values_supported:E(y()).optional(),code_challenge_methods_supported:E(y()).optional(),client_id_metadata_document_supported:_e().optional()}),lZ=Be({issuer:y(),authorization_endpoint:it,token_endpoint:it,userinfo_endpoint:it.optional(),jwks_uri:it,registration_endpoint:it.optional(),scopes_supported:E(y()).optional(),response_types_supported:E(y()),response_modes_supported:E(y()).optional(),grant_types_supported:E(y()).optional(),acr_values_supported:E(y()).optional(),subject_types_supported:E(y()),id_token_signing_alg_values_supported:E(y()),id_token_encryption_alg_values_supported:E(y()).optional(),id_token_encryption_enc_values_supported:E(y()).optional(),userinfo_signing_alg_values_supported:E(y()).optional(),userinfo_encryption_alg_values_supported:E(y()).optional(),userinfo_encryption_enc_values_supported:E(y()).optional(),request_object_signing_alg_values_supported:E(y()).optional(),request_object_encryption_alg_values_supported:E(y()).optional(),request_object_encryption_enc_values_supported:E(y()).optional(),token_endpoint_auth_methods_supported:E(y()).optional(),token_endpoint_auth_signing_alg_values_supported:E(y()).optional(),display_values_supported:E(y()).optional(),claim_types_supported:E(y()).optional(),claims_supported:E(y()).optional(),service_documentation:y().optional(),claims_locales_supported:E(y()).optional(),ui_locales_supported:E(y()).optional(),claims_parameter_supported:_e().optional(),request_parameter_supported:_e().optional(),request_uri_parameter_supported:_e().optional(),require_request_uri_registration:_e().optional(),op_policy_uri:it.optional(),op_tos_uri:it.optional(),client_id_metadata_document_supported:_e().optional()}),RE=T({...lZ.shape,...q_.pick({code_challenge_methods_supported:!0}).shape}),AE=T({access_token:y(),id_token:y().optional(),token_type:y(),expires_in:Du.number().optional(),scope:y().optional(),refresh_token:y().optional()}).strip(),ME=T({error:y(),error_description:y().optional(),error_uri:y().optional()}),jE=it.optional().or(N("").transform(()=>{})),dZ=T({redirect_uris:E(it),token_endpoint_auth_method:y().optional(),grant_types:E(y()).optional(),response_types:E(y()).optional(),client_name:y().optional(),client_uri:it.optional(),logo_uri:jE,scope:y().optional(),contacts:E(y()).optional(),tos_uri:jE,policy_uri:y().optional(),jwks_uri:it.optional(),jwks:hh().optional(),software_id:y().optional(),software_version:y().optional(),software_statement:y().optional()}).strip(),pZ=T({client_id:y(),client_secret:y().optional(),client_id_issued_at:pe().optional(),client_secret_expires_at:pe().optional()}).strip(),DE=dZ.merge(pZ),kX=T({error:y(),error_description:y().optional()}).strip(),SX=T({token:y(),token_type_hint:y().optional()}).strip();function UE(t){let e=typeof t=="string"?new URL(t):new URL(t.href);return e.hash="",e}function qE({requestedResource:t,configuredResource:e}){let r=typeof t=="string"?new URL(t):new URL(t.href),n=typeof e=="string"?new URL(e):new URL(e.href);if(r.origin!==n.origin||r.pathname.length<n.pathname.length)return!1;let o=r.pathname.endsWith("/")?r.pathname:r.pathname+"/",i=n.pathname.endsWith("/")?n.pathname:n.pathname+"/";return o.startsWith(i)}var Ve=class extends Error{constructor(e,r){super(e),this.errorUri=r,this.name=this.constructor.name}toResponseObject(){let e={error:this.errorCode,error_description:this.message};return this.errorUri&&(e.error_uri=this.errorUri),e}get errorCode(){return this.constructor.errorCode}},fc=class extends Ve{};fc.errorCode="invalid_request";var vo=class extends Ve{};vo.errorCode="invalid_client";var yo=class extends Ve{};yo.errorCode="invalid_grant";var _o=class extends Ve{};_o.errorCode="unauthorized_client";var mc=class extends Ve{};mc.errorCode="unsupported_grant_type";var hc=class extends Ve{};hc.errorCode="invalid_scope";var gc=class extends Ve{};gc.errorCode="access_denied";var Qr=class extends Ve{};Qr.errorCode="server_error";var vc=class extends Ve{};vc.errorCode="temporarily_unavailable";var yc=class extends Ve{};yc.errorCode="unsupported_response_type";var _c=class extends Ve{};_c.errorCode="unsupported_token_type";var bc=class extends Ve{};bc.errorCode="invalid_token";var xc=class extends Ve{};xc.errorCode="method_not_allowed";var $c=class extends Ve{};$c.errorCode="too_many_requests";var bo=class extends Ve{};bo.errorCode="invalid_client_metadata";var wc=class extends Ve{};wc.errorCode="insufficient_scope";var kc=class extends Ve{};kc.errorCode="invalid_target";var LE={[fc.errorCode]:fc,[vo.errorCode]:vo,[yo.errorCode]:yo,[_o.errorCode]:_o,[mc.errorCode]:mc,[hc.errorCode]:hc,[gc.errorCode]:gc,[Qr.errorCode]:Qr,[vc.errorCode]:vc,[yc.errorCode]:yc,[_c.errorCode]:_c,[bc.errorCode]:bc,[xc.errorCode]:xc,[$c.errorCode]:$c,[bo.errorCode]:bo,[wc.errorCode]:wc,[kc.errorCode]:kc};var jn=class extends Error{constructor(e){super(e??"Unauthorized")}};function fZ(t){return["client_secret_basic","client_secret_post","none"].includes(t)}var L_="code",Z_="S256";function mZ(t,e){let r=t.client_secret!==void 0;return e.length===0?r?"client_secret_post":"none":"token_endpoint_auth_method"in t&&t.token_endpoint_auth_method&&fZ(t.token_endpoint_auth_method)&&e.includes(t.token_endpoint_auth_method)?t.token_endpoint_auth_method:r&&e.includes("client_secret_basic")?"client_secret_basic":r&&e.includes("client_secret_post")?"client_secret_post":e.includes("none")?"none":r?"client_secret_post":"none"}function hZ(t,e,r,n){let{client_id:o,client_secret:i}=e;switch(t){case"client_secret_basic":gZ(o,i,r);return;case"client_secret_post":vZ(o,i,n);return;case"none":yZ(o,n);return;default:throw new Error(`Unsupported client authentication method: ${t}`)}}function gZ(t,e,r){if(!e)throw new Error("client_secret_basic authentication requires a client_secret");let n=btoa(`${t}:${e}`);r.set("Authorization",`Basic ${n}`)}function vZ(t,e,r){r.set("client_id",t),e&&r.set("client_secret",e)}function yZ(t,e){e.set("client_id",t)}async function FE(t){let e=t instanceof Response?t.status:void 0,r=t instanceof Response?await t.text():t;try{let n=ME.parse(JSON.parse(r)),{error:o,error_description:i,error_uri:s}=n,a=LE[o]||Qr;return new a(i||"",s)}catch(n){let o=`${e?`HTTP ${e}: `:""}Invalid OAuth error response: ${n}. Raw body: ${r}`;return new Qr(o)}}async function kd(t,e){try{return await F_(t,e)}catch(r){if(r instanceof vo||r instanceof _o)return await t.invalidateCredentials?.("all"),await F_(t,e);if(r instanceof yo)return await t.invalidateCredentials?.("tokens"),await F_(t,e);throw r}}async function F_(t,{serverUrl:e,authorizationCode:r,scope:n,resourceMetadataUrl:o,fetchFn:i}){let s,a;try{s=await xZ(e,{resourceMetadataUrl:o},i),s.authorization_servers&&s.authorization_servers.length>0&&(a=s.authorization_servers[0])}catch{}a||(a=new URL("/",e));let c=await bZ(e,t,s),u=await PZ(a,{fetchFn:i}),l=await Promise.resolve(t.clientInformation());if(!l){if(r!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");let g=u?.client_id_metadata_document_supported===!0,v=t.clientMetadataUrl;if(v&&!_Z(v))throw new bo(`clientMetadataUrl must be a valid HTTPS URL with a non-root pathname, got: ${v}`);if(g&&v)l={client_id:v},await t.saveClientInformation?.(l);else{if(!t.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");let w=await CZ(a,{metadata:u,clientMetadata:t.clientMetadata,fetchFn:i});await t.saveClientInformation(w),l=w}}let d=!t.redirectUrl;if(r!==void 0||d){let g=await TZ(t,a,{metadata:u,resource:c,authorizationCode:r,fetchFn:i});return await t.saveTokens(g),"AUTHORIZED"}let p=await t.tokens();if(p?.refresh_token)try{let g=await zZ(a,{metadata:u,clientInformation:l,refreshToken:p.refresh_token,resource:c,addClientAuthentication:t.addClientAuthentication,fetchFn:i});return await t.saveTokens(g),"AUTHORIZED"}catch(g){if(!(!(g instanceof Ve)||g instanceof Qr))throw g}let f=t.state?await t.state():void 0,{authorizationUrl:h,codeVerifier:m}=await IZ(a,{metadata:u,clientInformation:l,state:f,redirectUrl:t.redirectUrl,scope:n||s?.scopes_supported?.join(" ")||t.clientMetadata.scope,resource:c});return await t.saveCodeVerifier(m),await t.redirectToAuthorization(h),"REDIRECT"}function _Z(t){if(!t)return!1;try{let e=new URL(t);return e.protocol==="https:"&&e.pathname!=="/"}catch{return!1}}async function bZ(t,e,r){let n=UE(t);if(e.validateResourceURL)return await e.validateResourceURL(n,r?.resource);if(r){if(!qE({requestedResource:n,configuredResource:r.resource}))throw new Error(`Protected resource ${r.resource} does not match expected ${n} (or origin)`);return new URL(r.resource)}}function B_(t){let e=t.headers.get("WWW-Authenticate");if(!e)return{};let[r,n]=e.split(" ");if(r.toLowerCase()!=="bearer"||!n)return{};let o=V_(t,"resource_metadata")||void 0,i;if(o)try{i=new URL(o)}catch{}let s=V_(t,"scope")||void 0,a=V_(t,"error")||void 0;return{resourceMetadataUrl:i,scope:s,error:a}}function V_(t,e){let r=t.headers.get("WWW-Authenticate");if(!r)return null;let n=new RegExp(`${e}=(?:"([^"]+)"|([^\\s,]+))`),o=r.match(n);return o?o[1]||o[2]:null}async function xZ(t,e,r=fetch){let n=await kZ(t,"oauth-protected-resource",r,{protocolVersion:e?.protocolVersion,metadataUrl:e?.resourceMetadataUrl});if(!n||n.status===404)throw await n?.body?.cancel(),new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!n.ok)throw await n.body?.cancel(),new Error(`HTTP ${n.status} trying to load well-known OAuth protected resource metadata.`);return NE.parse(await n.json())}async function H_(t,e,r=fetch){try{return await r(t,{headers:e})}catch(n){if(n instanceof TypeError)return e?H_(t,void 0,r):void 0;throw n}}function $Z(t,e="",r={}){return e.endsWith("/")&&(e=e.slice(0,-1)),r.prependPathname?`${e}/.well-known/${t}`:`/.well-known/${t}${e}`}async function ZE(t,e,r=fetch){return await H_(t,{"MCP-Protocol-Version":e},r)}function wZ(t,e){return!t||t.status>=400&&t.status<500&&e!=="/"}async function kZ(t,e,r,n){let o=new URL(t),i=n?.protocolVersion??Qo,s;if(n?.metadataUrl)s=new URL(n.metadataUrl);else{let c=$Z(e,o.pathname);s=new URL(c,n?.metadataServerUrl??o),s.search=o.search}let a=await ZE(s,i,r);if(!n?.metadataUrl&&wZ(a,o.pathname)){let c=new URL(`/.well-known/${e}`,o);a=await ZE(c,i,r)}return a}function SZ(t){let e=typeof t=="string"?new URL(t):t,r=e.pathname!=="/",n=[];if(!r)return n.push({url:new URL("/.well-known/oauth-authorization-server",e.origin),type:"oauth"}),n.push({url:new URL("/.well-known/openid-configuration",e.origin),type:"oidc"}),n;let o=e.pathname;return o.endsWith("/")&&(o=o.slice(0,-1)),n.push({url:new URL(`/.well-known/oauth-authorization-server${o}`,e.origin),type:"oauth"}),n.push({url:new URL(`/.well-known/openid-configuration${o}`,e.origin),type:"oidc"}),n.push({url:new URL(`${o}/.well-known/openid-configuration`,e.origin),type:"oidc"}),n}async function PZ(t,{fetchFn:e=fetch,protocolVersion:r=Qo}={}){let n={"MCP-Protocol-Version":r,Accept:"application/json"},o=SZ(t);for(let{url:i,type:s}of o){let a=await H_(i,n,e);if(a){if(!a.ok){if(await a.body?.cancel(),a.status>=400&&a.status<500)continue;throw new Error(`HTTP ${a.status} trying to load ${s==="oauth"?"OAuth":"OpenID provider"} metadata from ${i}`)}return s==="oauth"?q_.parse(await a.json()):RE.parse(await a.json())}}}async function IZ(t,{metadata:e,clientInformation:r,redirectUrl:n,scope:o,state:i,resource:s}){let a;if(e){if(a=new URL(e.authorization_endpoint),!e.response_types_supported.includes(L_))throw new Error(`Incompatible auth server: does not support response type ${L_}`);if(e.code_challenge_methods_supported&&!e.code_challenge_methods_supported.includes(Z_))throw new Error(`Incompatible auth server: does not support code challenge method ${Z_}`)}else a=new URL("/authorize",t);let c=await U_(),u=c.code_verifier,l=c.code_challenge;return a.searchParams.set("response_type",L_),a.searchParams.set("client_id",r.client_id),a.searchParams.set("code_challenge",l),a.searchParams.set("code_challenge_method",Z_),a.searchParams.set("redirect_uri",String(n)),i&&a.searchParams.set("state",i),o&&a.searchParams.set("scope",o),o?.includes("offline_access")&&a.searchParams.append("prompt","consent"),s&&a.searchParams.set("resource",s.href),{authorizationUrl:a,codeVerifier:u}}function EZ(t,e,r){return new URLSearchParams({grant_type:"authorization_code",code:t,code_verifier:e,redirect_uri:String(r)})}async function VE(t,{metadata:e,tokenRequestParams:r,clientInformation:n,addClientAuthentication:o,resource:i,fetchFn:s}){let a=e?.token_endpoint?new URL(e.token_endpoint):new URL("/token",t),c=new Headers({"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"});if(i&&r.set("resource",i.href),o)await o(c,r,a,e);else if(n){let l=e?.token_endpoint_auth_methods_supported??[],d=mZ(n,l);hZ(d,n,c,r)}let u=await(s??fetch)(a,{method:"POST",headers:c,body:r});if(!u.ok)throw await FE(u);return AE.parse(await u.json())}async function zZ(t,{metadata:e,clientInformation:r,refreshToken:n,resource:o,addClientAuthentication:i,fetchFn:s}){let a=new URLSearchParams({grant_type:"refresh_token",refresh_token:n}),c=await VE(t,{metadata:e,tokenRequestParams:a,clientInformation:r,addClientAuthentication:i,resource:o,fetchFn:s});return{refresh_token:n,...c}}async function TZ(t,e,{metadata:r,resource:n,authorizationCode:o,fetchFn:i}={}){let s=t.clientMetadata.scope,a;if(t.prepareTokenRequest&&(a=await t.prepareTokenRequest(s)),!a){if(!o)throw new Error("Either provider.prepareTokenRequest() or authorizationCode is required");if(!t.redirectUrl)throw new Error("redirectUrl is required for authorization_code flow");let u=await t.codeVerifier();a=EZ(o,u,t.redirectUrl)}let c=await t.clientInformation();return VE(e,{metadata:r,tokenRequestParams:a,clientInformation:c??void 0,addClientAuthentication:t.addClientAuthentication,resource:n,fetchFn:i})}async function CZ(t,{metadata:e,clientMetadata:r,fetchFn:n}){let o;if(e){if(!e.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");o=new URL(e.registration_endpoint)}else o=new URL("/register",t);let i=await(n??fetch)(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok)throw await FE(i);return DE.parse(await i.json())}var G_=class extends Error{constructor(e,r,n){super(`SSE error: ${r}`),this.code=e,this.event=n}},Sd=class{constructor(e,r){this._url=e,this._resourceMetadataUrl=void 0,this._scope=void 0,this._eventSourceInit=r?.eventSourceInit,this._requestInit=r?.requestInit,this._authProvider=r?.authProvider,this._fetch=r?.fetch,this._fetchWithInit=OE(r?.fetch,r?.requestInit)}async _authThenStart(){if(!this._authProvider)throw new jn("No auth provider");let e;try{e=await kd(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})}catch(r){throw this.onerror?.(r),r}if(e!=="AUTHORIZED")throw new jn;return await this._startOrAuth()}async _commonHeaders(){let e={};if(this._authProvider){let n=await this._authProvider.tokens();n&&(e.Authorization=`Bearer ${n.access_token}`)}this._protocolVersion&&(e["mcp-protocol-version"]=this._protocolVersion);let r=wd(this._requestInit?.headers);return new Headers({...e,...r})}_startOrAuth(){let e=this?._eventSourceInit?.fetch??this._fetch??fetch;return new Promise((r,n)=>{this._eventSource=new go(this._url.href,{...this._eventSourceInit,fetch:async(o,i)=>{let s=await this._commonHeaders();s.set("Accept","text/event-stream");let a=await e(o,{...i,headers:s});if(a.status===401&&a.headers.has("www-authenticate")){let{resourceMetadataUrl:c,scope:u}=B_(a);this._resourceMetadataUrl=c,this._scope=u}return a}}),this._abortController=new AbortController,this._eventSource.onerror=o=>{if(o.code===401&&this._authProvider){this._authThenStart().then(r,n);return}let i=new G_(o.code,o.message,o);n(i),this.onerror?.(i)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",o=>{let i=o;try{if(this._endpoint=new URL(i.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(s){n(s),this.onerror?.(s),this.close();return}r()}),this._eventSource.onmessage=o=>{let i=o,s;try{s=Zu.parse(JSON.parse(i.data))}catch(a){this.onerror?.(a);return}this.onmessage?.(s)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(e){if(!this._authProvider)throw new jn("No auth provider");if(await kd(this._authProvider,{serverUrl:this._url,authorizationCode:e,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new jn("Failed to authorize")}async close(){this._abortController?.abort(),this._eventSource?.close(),this.onclose?.()}async send(e){if(!this._endpoint)throw new Error("Not connected");try{let r=await this._commonHeaders();r.set("content-type","application/json");let n={...this._requestInit,method:"POST",headers:r,body:JSON.stringify(e),signal:this._abortController?.signal},o=await(this._fetch??fetch)(this._endpoint,n);if(!o.ok){let i=await o.text().catch(()=>null);if(o.status===401&&this._authProvider){let{resourceMetadataUrl:s,scope:a}=B_(o);if(this._resourceMetadataUrl=s,this._scope=a,await kd(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new jn;return this.send(e)}throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${i}`)}await o.body?.cancel()}catch(r){throw this.onerror?.(r),r}}setProtocolVersion(e){this._protocolVersion=e}};var Ce=Le(require("vscode")),Pd=class{constructor(){}getTools(){return[{serverName:"vscode",name:"vscode_read_file",description:"Read the contents of a file in the workspace",inputSchema:{type:"object",properties:{uri:{type:"string",description:"The absolute path or URI of the file to read"}},required:["uri"]}},{serverName:"vscode",name:"vscode_list_files",description:"List files in a directory or search for files matching a pattern",inputSchema:{type:"object",properties:{folder:{type:"string",description:"The absolute path of the folder to list (optional)"},pattern:{type:"string",description:'Glob pattern to search for specific files (e.g. "**/*.ts")'}}}},{serverName:"vscode",name:"vscode_open_file",description:"Open a file in the editor",inputSchema:{type:"object",properties:{uri:{type:"string",description:"The absolute path or URI of the file to open"},range:{type:"array",items:{type:"number"},minItems:2,maxItems:2,description:"Line range to select [startLine, endLine] (0-indexed)"}},required:["uri"]}},{serverName:"vscode",name:"vscode_get_diagnostics",description:"Get validation errors, warnings, and information for files",inputSchema:{type:"object",properties:{max:{type:"number",description:"Maximum number of diagnostics to return (default: 50)"}}}},{serverName:"vscode",name:"vscode_get_active_editor",description:"Get information about the currently active text editor",inputSchema:{type:"object",properties:{}}}]}async callTool(e,r){switch(e){case"vscode_read_file":return this.readFile(r.uri);case"vscode_list_files":return this.listFiles(r.folder,r.pattern);case"vscode_open_file":return this.openFile(r.uri,r.range);case"vscode_get_diagnostics":return this.getDiagnostics(r.max);case"vscode_get_active_editor":return this.getActiveEditor();default:throw new Error(`Unknown tool: ${e}`)}}async readFile(e){let r=Ce.Uri.file(e),n=await Ce.workspace.openTextDocument(r);return{content:n.getText(),languageId:n.languageId,lineCount:n.lineCount}}async listFiles(e,r){if(r)return{files:(await Ce.workspace.findFiles(r,null,50)).map(o=>o.fsPath)};if(e){let n=Ce.Uri.file(e),o=await Ce.workspace.fs.readDirectory(n);return{folder:e,entries:o.map(([i,s])=>({name:i,type:s===Ce.FileType.Directory?"directory":"file"}))}}else return Ce.workspace.workspaceFolders?{workspaceFolders:Ce.workspace.workspaceFolders.map(n=>n.uri.fsPath)}:{error:"No workspace folders open"}}async openFile(e,r){let n=Ce.Uri.file(e),o=await Ce.workspace.openTextDocument(n),i=await Ce.window.showTextDocument(o);if(r&&r.length===2){let s=new Ce.Range(r[0],0,r[1],1e3);i.selection=new Ce.Selection(s.start,s.end),i.revealRange(s,Ce.TextEditorRevealType.InCenter)}return{success:!0,opened:e}}async getDiagnostics(e=50){let r=Ce.languages.getDiagnostics(),n=[],o=0;for(let[i,s]of r){if(s.length===0)continue;let a=s.map(c=>({severity:Ce.DiagnosticSeverity[c.severity],message:c.message,range:{startLine:c.range.start.line,endLine:c.range.end.line},source:c.source,code:c.code}));if(n.push({file:i.fsPath,diagnostics:a}),o+=a.length,o>=e)break}return{diagnostics:n}}async getActiveEditor(){let e=Ce.window.activeTextEditor;return e?{active:!0,file:e.document.uri.fsPath,languageId:e.document.languageId,cursor:{line:e.selection.active.line,character:e.selection.active.character},selection:e.document.getText(e.selection)||null,preview:e.document.getText(new Ce.Range(0,0,Math.min(20,e.document.lineCount),0))+`
...`}:{active:!1,reason:"No editor active"}}};var Id=class{constructor(e){this.output=e;this.vscodeTools=new Pd}clients=new Map;cachedTools=[];disposables=[];vscodeTools;async initialize(){await this.refreshServers()}async refreshServers(){for(let o of this.clients.values())await o.close();this.clients.clear();let e=BE.workspace.getConfiguration("githubCopilotApi.mcp");if(!e.get("enabled",!0)){this.output.appendLine("[MCP] Disabled in configuration.");return}let n=e.get("servers",{});for(let[o,i]of Object.entries(n))try{await this.connectToServer(o,i)}catch(s){this.output.appendLine(`[MCP] Failed to connect to server "${o}": ${s}`)}this.cachedTools=await this.getAllTools()}getTools(){return this.cachedTools.length===0?this.vscodeTools.getTools():this.cachedTools}getConnectedServers(){return Array.from(this.clients.keys())}async connectToServer(e,r){let n;if(r.url)n=new Sd(new URL(r.url));else if(r.command)n=new yd({command:r.command,args:r.args||[],env:this.getCleanEnv(r.env)});else throw new Error(`Invalid configuration for MCP server "${e}"`);let o=new hd({name:"github-copilot-api-gateway",version:"0.0.1"},{capabilities:{}});await o.connect(n),this.clients.set(e,o),this.output.appendLine(`[MCP] Connected to server "${e}"`)}async getAllTools(){let e=[];for(let[r,n]of this.clients.entries())try{let i=(await n.request({method:"tools/list"},na)).tools.map(s=>({serverName:r,name:s.name,description:s.description,inputSchema:s.inputSchema}));e.push(...i)}catch(o){this.output.appendLine(`[MCP] Failed to list tools for server "${r}": ${o}`)}return[...e,...this.vscodeTools.getTools()]}async callTool(e,r,n){if(e==="vscode")return this.vscodeTools.callTool(r,n);let o=this.clients.get(e);if(!o)throw new Error(`MCP server "${e}" not found or not connected`);return await o.request({method:"tools/call",params:{name:r,arguments:n}},hn)}getCleanEnv(e){let r={};for(let[n,o]of Object.entries(process.env))o!==void 0&&(r[n]=o);if(e)for(let[n,o]of Object.entries(e))o!==void 0&&(r[n]=o);return r}dispose(){for(let e of this.clients.values())e.close().catch(r=>console.error(`[MCP] Error closing client: ${r}`));this.clients.clear();for(let e of this.disposables)e.dispose()}};var KF=Le(qz(),1),XF=Le(ob(),1),YF=Le(ab(),1),QF=Le(Ud(),1),hb=Le(Jz(),1);var eV="GitHub.copilot-chat",tV="@id:GitHub.copilot-chat",U=class extends Error{constructor(r,n,o,i,s){super(n);this.status=r;this.type=o;this.code=i;this.details=s;this.name="ApiError"}},rV=[{id:"ssn",name:"US Social Security",pattern:"\\b\\d{3}-\\d{2}-\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"credit-card",name:"Credit/Debit Card",pattern:"\\b(?:\\d{4}[- ]?){3}\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"aadhaar",name:"Aadhaar Number",pattern:"\\b\\d{4}\\s?\\d{4}\\s?\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"passport-in",name:"Indian Passport",pattern:"\\b[A-Z]\\d{7}\\b",enabled:!0,isBuiltin:!0},{id:"passport-us",name:"US Passport",pattern:"\\b\\d{9}\\b",enabled:!0,isBuiltin:!0},{id:"email",name:"Email Address",pattern:"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}",enabled:!0,isBuiltin:!0},{id:"url",name:"URLs",pattern:"https?://[^\\s]+",enabled:!0,isBuiltin:!0},{id:"phone-us",name:"US Phone Number",pattern:"\\b\\d{3}[-.]?\\d{3}[-.]?\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"phone-in",name:"Indian Phone",pattern:"\\b[6-9]\\d{9}\\b",enabled:!0,isBuiltin:!0},{id:"api-key",name:"API Keys",pattern:"(sk-[a-zA-Z0-9]{20,})|(api[_-]?key[=:]\\s*[\\w-]+)",enabled:!0,isBuiltin:!0},{id:"password-json",name:"Passwords in JSON",pattern:'"password"\\s*:\\s*"[^"]*"',enabled:!0,isBuiltin:!0},{id:"bearer-token",name:"Bearer Tokens",pattern:"Bearer\\s+[A-Za-z0-9\\-._~+/]+=*",enabled:!0,isBuiltin:!0}],nV={"gpt-4":"gpt-4o-copilot","gpt-4-turbo":"gpt-4o-copilot","gpt-4-turbo-preview":"gpt-4o-copilot","gpt-4o":"gpt-4o-copilot","gpt-4o-mini":"gpt-4o-mini-copilot","gpt-3.5-turbo":"gpt-4o-mini-copilot","gpt-3.5-turbo-16k":"gpt-4o-mini-copilot","claude-3-opus":"claude-3.5-sonnet-copilot","claude-3-sonnet":"claude-3.5-sonnet-copilot","claude-3-haiku":"claude-3.5-sonnet-copilot","claude-3.5-sonnet":"claude-3.5-sonnet-copilot",o1:"o1-copilot","o1-mini":"o1-mini-copilot","gemini-1.5-pro":"gpt-4o-copilot","gemini-1.5-flash":"gpt-4o-mini-copilot","o1-preview":"o1-copilot","o3-mini":"o3-mini-copilot"},Ld=class{constructor(e,r,n){this.output=e;this.statusItem=r;this.context=n,this.auditService=new Nc(n),this.mcpService=new Id(e),this.mcpService.initialize().catch(i=>console.error("Failed to initialize MCP:",i)),this.loadHistory(),this.startStatsUpdater(),this.startDomainCacheRefresh();let o=$.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("githubCopilotApi.server")){if(this.suppressRestart)return;this.restart().catch(s=>{this.logError("Failed to restart API server after configuration change",s)})}});this.disposables.push(o),this.initializeStats().catch(i=>console.error("Failed to initialize stats:",i))}httpServer;wsServer;disposables=[];config=Kz();disposed=!1;activeRequests=0;suppressRestart=!1;_onDidChangeStatus=new $.EventEmitter;onDidChangeStatus=this._onDidChangeStatus.event;_onDidLogRequest=new $.EventEmitter;onDidLogRequest=this._onDidLogRequest.event;domainCache=new Map;domainRefreshInterval;usageStats={totalRequests:0,totalTokensIn:0,totalTokensOut:0,requestsByEndpoint:{},startTime:Date.now()};realtimeStats={requestsPerMinute:0,avgLatencyMs:0,latencyHistory:[],tokensPerMinute:0,errorRate:0,lastMinuteRequests:[],lastMinuteErrors:0};requestHistory=[];connections=new Set;isShuttingDown=!1;MAX_HISTORY_SIZE=100;context;rateLimitBucket=[];requestCache=new Map;CACHE_TTL_MS=5e3;statsInterval;activeConnectionsPerIp=new Map;auditService;mcpService;async initializeStats(){try{let e=await this.auditService.getLifetimeStats();this.usageStats.totalRequests=e.totalRequests,this.usageStats.totalTokensIn=e.totalTokensIn,this.usageStats.totalTokensOut=e.totalTokensOut}catch(e){console.error("Failed to load lifetime stats:",e)}}async getStatus(){return{running:!!this.httpServer,config:this.config,activeRequests:this.activeRequests,networkInfo:this.getNetworkInfo(),stats:this.getStats(),realtimeStats:this.realtimeStats,historyCount:this.requestHistory.length,mcp:this.getMcpStatus(),copilot:await this.getCopilotHealth()}}async getCopilotHealth(){let e=$.extensions.all,r=e.find(s=>s.id.toLowerCase()==="github.copilot"||s.id.toLowerCase()==="github.copilot-nightly"||s.packageJSON?.publisher==="GitHub"&&s.packageJSON?.name==="copilot"),n=e.find(s=>s.id.toLowerCase()==="github.copilot-chat"||s.packageJSON?.publisher==="GitHub"&&s.packageJSON?.name==="copilot-chat"),o=!1;try{let s=await $.lm.selectChatModels({vendor:"copilot"});o=s&&s.length>0}catch{o=!1}return{installed:!!r||o,chatInstalled:!!n||o,signedIn:o,ready:o||!!r&&!!n&&o}}getMcpStatus(){return{enabled:$.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0),servers:this.mcpService.getConnectedServers(),tools:this.mcpService.getTools()}}getStats(){return{...this.usageStats,uptimeMs:Date.now()-this.usageStats.startTime,avgLatencyMs:this.realtimeStats.avgLatencyMs,requestsPerMinute:this.realtimeStats.requestsPerMinute,errorRate:this.realtimeStats.errorRate,mcp:this.getMcpStatus()}}getHistory(e){let r=[...this.requestHistory].reverse();return e?r.slice(0,e):r}async getDailyStats(e){return this.auditService.getDailyStats(e)}async getAuditLogs(e,r){return this.auditService.getLogEntries(e,r)}getLogFolderPath(){return this.auditService.getLogFolderPath()}clearHistory(){this.requestHistory=[],this.saveHistory(),this._onDidChangeStatus.fire()}loadHistory(){if(!this.context)return;let e=this.context.globalState.get("requestHistory",[]);this.requestHistory=e.slice(-this.MAX_HISTORY_SIZE)}saveHistory(){this.context&&this.context.globalState.update("requestHistory",this.requestHistory.slice(-this.MAX_HISTORY_SIZE))}addHistoryEntry(e){let r=this.redactSensitiveData(e);this.requestHistory.push(r),this.requestHistory.length>this.MAX_HISTORY_SIZE&&(this.requestHistory=this.requestHistory.slice(-this.MAX_HISTORY_SIZE)),this.requestHistory.length%10===0&&this.saveHistory(),this._onDidChangeStatus.fire()}redactSensitiveData(e){let r=this.config.redactionPatterns.filter(i=>i.enabled);if(console.log(`[Redaction] ${this.config.redactionPatterns.length} total patterns, ${r.length} enabled`),!r.length)return e;let n=i=>{let s=i;for(let a of r)try{let c=new RegExp(a.pattern,"gi");s=s.replace(c,"[REDACTED]")}catch{}return s},o=i=>{if(typeof i=="string")return n(i);if(Array.isArray(i))return i.map(o);if(i&&typeof i=="object"){let s={};for(let[a,c]of Object.entries(i))s[a]=o(c);return s}return i};return o(e)}redactMessagesContent(e){let r=this.config.redactionPatterns.filter(o=>o.enabled);if(!r.length)return e;let n=o=>{let i=o;for(let s of r)try{let a=new RegExp(s.pattern,"gi");i=i.replace(a,"[REDACTED]")}catch{}return i};return e.map(o=>{let i=o.content;return typeof i=="string"?i=n(i):Array.isArray(i)&&(i=i.map(s=>typeof s=="string"?n(s):s&&typeof s=="object"&&typeof s.text=="string"?{...s,text:n(s.text)}:s)),{...o,content:i}})}redactPromptString(e){let r=this.config.redactionPatterns.filter(o=>o.enabled);if(!r.length)return e;let n=e;for(let o of r)try{let i=new RegExp(o.pattern,"gi");n=n.replace(i,"[REDACTED]")}catch{}return n}startStatsUpdater(){this.statsInterval=setInterval(()=>{this.updateRealtimeStats()},5e3)}startDomainCacheRefresh(){this.refreshDomainCache(),this.domainRefreshInterval=setInterval(()=>{this.refreshDomainCache()},300*1e3)}updateRealtimeStats(){let r=Date.now()-6e4;if(this.realtimeStats.latencyHistory=this.realtimeStats.latencyHistory.filter(n=>n.timestamp>r),this.realtimeStats.lastMinuteRequests=this.realtimeStats.lastMinuteRequests.filter(n=>n>r),this.realtimeStats.requestsPerMinute=this.realtimeStats.lastMinuteRequests.length,this.realtimeStats.latencyHistory.length>0){let n=this.realtimeStats.latencyHistory.reduce((o,i)=>o+i.latency,0);this.realtimeStats.avgLatencyMs=Math.round(n/this.realtimeStats.latencyHistory.length)}else this.realtimeStats.avgLatencyMs=0;this.realtimeStats.lastMinuteRequests.length>0?this.realtimeStats.errorRate=Math.round(this.realtimeStats.lastMinuteErrors/this.realtimeStats.lastMinuteRequests.length*100):this.realtimeStats.errorRate=0,this.realtimeStats.lastMinuteRequests.length===0&&(this.realtimeStats.lastMinuteErrors=0)}recordRequestStats(e,r,n,o){let i=Date.now();this.usageStats.totalRequests++,this.usageStats.totalTokensIn+=r,this.usageStats.totalTokensOut+=n,this.realtimeStats.lastMinuteRequests.push(i),this.realtimeStats.latencyHistory.push({timestamp:i,latency:e}),o&&this.realtimeStats.lastMinuteErrors++,this.realtimeStats.tokensPerMinute=Math.round((this.usageStats.totalTokensIn+this.usageStats.totalTokensOut)/Math.max(1,(i-this.usageStats.startTime)/6e4))}async addRedactionPattern(e,r){try{new RegExp(r);let n=this.config.redactionPatterns,i={id:`custom-${Date.now()}`,name:e,pattern:r,enabled:!0,isBuiltin:!1};return await this.updateServerConfig({redactionPatterns:[...n,i]}),!0}catch{return!1}}async removeRedactionPattern(e){let r=this.config.redactionPatterns.filter(n=>n.id!==e);await this.updateServerConfig({redactionPatterns:r})}async toggleRedactionPattern(e,r){let n=this.config.redactionPatterns.map(o=>o.id===e?{...o,enabled:r}:o);await this.updateServerConfig({redactionPatterns:n})}getRedactionPatterns(){return[...this.config.redactionPatterns]}async addIpAllowlistEntry(e){let r=e.trim();if(!r)return!1;let n=/^[\d\.\/]+$|^[\da-fA-F:\/]+$/.test(r),o=/^[a-zA-Z0-9]([a-zA-Z0-9\-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]*[a-zA-Z0-9])?)+$/.test(r);if(!n&&!o)return!1;let i=[...this.config.ipAllowlist,r];return await $.workspace.getConfiguration("githubCopilotApi").update("server.ipAllowlist",i,$.ConfigurationTarget.Global),!0}async removeIpAllowlistEntry(e){let r=this.config.ipAllowlist.filter(n=>n!==e);await this.updateServerConfig({ipAllowlist:r})}getNetworkInfo(){if(this.config.host!=="0.0.0.0")return null;let e=Zd.hostname(),r=[],n=Zd.networkInterfaces();for(let o of Object.keys(n)){let i=n[o];if(i)for(let s of i)!s.internal&&s.family==="IPv4"&&r.push(s.address)}return{hostname:e,localIPs:r}}async startServer(){await this.updateServerConfig({enabled:!0})}async stopServer(){await this.updateServerConfig({enabled:!1})}async toggleHttp(){await this.updateServerConfig({enableHttp:!this.config.enableHttp,enabled:!0})}async toggleWebSocket(){await this.updateServerConfig({enableWebSocket:!this.config.enableWebSocket,enabled:!0})}async toggleLogging(){await this.updateServerConfig({enableLogging:!this.config.enableLogging})}async setApiKey(e){let r=(e??"").trim();await this.updateServerConfig({apiKey:r})}async setRateLimit(e){let r=Number.isFinite(e)?Math.max(0,Math.floor(e)):60;await this.updateServerConfig({rateLimitPerMinute:r})}getVersion(){return this.context?.extension.packageJSON.version||"0.0.1"}async setHost(e){let r=(e??"").trim();r&&await this.updateServerConfig({host:r,enabled:!0})}async setPort(e){let r=Number.isFinite(e)?Math.max(1,Math.min(65535,Math.floor(e))):this.config.port;await this.updateServerConfig({port:r,enabled:!0})}async toggleMcp(e){this.suppressRestart=!0,await $.workspace.getConfiguration("githubCopilotApi.mcp").update("enabled",e,$.ConfigurationTarget.Global),await this.mcpService.refreshServers(),this.config.mcpEnabled=e,this.suppressRestart=!1}async setDefaultModel(e){let r=(e??"").trim();r&&await this.updateServerConfig({defaultModel:r,enabled:!0})}async setRequestTimeout(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):180;await this.updateServerConfig({requestTimeoutSeconds:r})}async setMaxPayloadSize(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):1;await this.updateServerConfig({maxPayloadSizeMb:r})}async setMaxConnectionsPerIp(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):10;await this.updateServerConfig({maxConnectionsPerIp:r})}async setMaxConcurrency(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):4;await this.updateServerConfig({maxConcurrentRequests:r})}async start(){if(this.disposed)return;if(await this.stop(),this.config=Kz(),!this.config.enabled){this.updateStatusBar("stopped","Server disabled in settings"),this._onDidChangeStatus.fire();return}this.updateStatusBar("starting"),this._onDidChangeStatus.fire(),this.httpServer=(0,Xz.createServer)((r,n)=>{this.connections.add(n),n.on("close",()=>this.connections.delete(n));let o=Date.now(),i=(0,mt.randomUUID)().slice(0,8);this.handleHttpRequest(r,n,i,o).catch(s=>{let a=Date.now()-o;s instanceof U?(this.logRequest(i,r.method||"UNKNOWN",r.url||"/",s.status,a,{error:s.message,requestHeaders:r.headers}),this.sendError(n,s)):(this.logRequest(i,r.method||"UNKNOWN",r.url||"/",500,a,{error:s instanceof Error?s.message:String(s),requestHeaders:r.headers}),this.logError("Unhandled error in HTTP request handler",s),this.sendError(n,new U(500,"An unexpected error occurred.","server_error")))}).finally(()=>{this.activeRequests--,this._onDidChangeStatus.fire()}),this.activeRequests++,this._onDidChangeStatus.fire()}),this.httpServer.on("error",r=>{this.logError("HTTP server error",r)}),this.wsServer=new hb.default({noServer:!0}),this.wsServer.on("connection",r=>this.handleWebSocketConnection(r)),this.wsServer.on("error",r=>{this.logError("WebSocket server error",r)}),this.httpServer.on("upgrade",(r,n,o)=>{if(!r.url){n.destroy();return}this.buildUrl(r.url).pathname==="/v1/realtime"&&this.config.enableWebSocket?this.wsServer?.handleUpgrade(r,n,o,s=>{this.wsServer?.emit("connection",s,r)}):n.destroy()}),await new Promise((r,n)=>{let o=i=>{this.httpServer?.off("error",o),n(i)};this.httpServer?.once("error",o),this.httpServer?.listen(this.config.port,this.config.host,()=>{this.httpServer?.off("error",o),r()})});let e=this.httpServer.address();if(e){let r=`http://${e.address}:${e.port}`;this.logInfo(`HTTP server listening on ${r}`),this.updateStatusBar("running",`HTTP${this.config.enableWebSocket?"+WS":""} on ${r}`),this._onDidChangeStatus.fire()}}async restart(){this.disposed||(this.logInfo("Restarting API server to apply configuration changes..."),await this.start())}async stop(){this.wsServer&&await new Promise(e=>{for(let r of this.wsServer?.clients??[])r.close(1001,"Server shutting down");this.wsServer?.close(()=>e())}),this.httpServer&&await new Promise((e,r)=>{this.httpServer?.close(n=>{n?r(n):e()})}),this.httpServer=void 0,this.wsServer=void 0,this.activeRequests=0,this.updateStatusBar("stopped"),this._onDidChangeStatus.fire()}async dispose(){if(this.disposed=!0,this.isShuttingDown=!0,this.logInfo("Shutting down API Gateway..."),this.statsInterval&&(clearInterval(this.statsInterval),this.statsInterval=void 0),this.domainRefreshInterval&&(clearInterval(this.domainRefreshInterval),this.domainRefreshInterval=void 0),this.saveHistory(),this.activeRequests>0){this.logInfo(`Waiting for ${this.activeRequests} active requests to complete...`);let e=0;for(;this.activeRequests>0&&e<3e3;)await new Promise(r=>setTimeout(r,100)),e+=100;this.activeRequests>0&&this.logInfo(`Forcing close of ${this.activeRequests} remaining requests.`)}for(let e of this.connections)e.writableEnded||(e.writeHead(503,{"Content-Type":"application/json"}),e.end(JSON.stringify({error:{message:"Server is shutting down",type:"service_unavailable"}})));this.connections.clear(),await this.stop().catch(e=>{this.logError("Failed to stop API server during dispose",e)});for(let e of this.disposables.splice(0))e.dispose();await this.mcpService.dispose(),this._onDidChangeStatus.dispose(),this.logInfo("API Gateway shut down successfully.")}async handleHttpRequest(e,r,n,o){if(this.isShuttingDown){r.writeHead(503,{"Content-Type":"application/json"}),r.end(JSON.stringify({error:{message:"Server is shutting down",type:"service_unavailable"}}));return}if(this.setCorsHeaders(r),r.setHeader("X-Request-ID",n),e.method==="OPTIONS"){r.writeHead(204),r.end();return}if(!this.config.enableHttp)throw new U(503,"HTTP API is disabled. Enable it from the Copilot API controls.","service_unavailable","http_disabled");let i=this.buildUrl(e.url),s=this.getClientIp(e),a=this.activeConnectionsPerIp.get(s)||0;if(a>=this.config.maxConnectionsPerIp)throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,429,Date.now()-o,{requestHeaders:e.headers}),new U(429,`Too many connections from your IP. Maximum ${this.config.maxConnectionsPerIp} concurrent connections allowed.`,"rate_limit_error","too_many_connections");if(this.activeConnectionsPerIp.set(s,a+1),r.on("close",()=>{let d=this.activeConnectionsPerIp.get(s)||1;d<=1?this.activeConnectionsPerIp.delete(s):this.activeConnectionsPerIp.set(s,d-1)}),this.config.apiKey&&i.pathname!=="/health"){let d=e.headers.authorization;if((d?.startsWith("Bearer ")?d.slice(7):null)!==this.config.apiKey)throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,401,Date.now()-o,{requestHeaders:e.headers}),new U(401,"Invalid or missing API key. Provide a valid Bearer token.","authentication_error","invalid_api_key")}if(!this.checkRateLimit())throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,429,Date.now()-o,{requestHeaders:e.headers}),new U(429,"Rate limit exceeded. Please try again later.","rate_limit_error","rate_limit_exceeded");if(!this.checkIpAllowlist(e))throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,403,Date.now()-o,{requestHeaders:e.headers}),new U(403,"Access denied. Your IP address is not allowed.","access_denied","ip_not_allowed");if(this.usageStats.totalRequests++,this.usageStats.requestsByEndpoint[i.pathname]=(this.usageStats.requestsByEndpoint[i.pathname]||0)+1,e.method==="GET"&&i.pathname==="/health"){try{let d=await $.lm.selectChatModels({vendor:"copilot"});d&&d.length>0?this.sendJson(r,200,{status:"ok",service:"github-copilot-api-vscode",copilot:"available",models:d.length}):this.sendJson(r,200,{status:"degraded",service:"github-copilot-api-vscode",copilot:"unavailable",message:"No Copilot models found. Check if GitHub Copilot is installed and signed in."})}catch{this.sendJson(r,200,{status:"degraded",service:"github-copilot-api-vscode",copilot:"error",message:"Failed to check Copilot availability."})}return}if(e.method==="GET"&&i.pathname==="/openapi.json"){this.sendJson(r,200,this.getOpenApiSpec());return}if(e.method==="GET"&&i.pathname==="/debug-paths"){this.sendDebugPaths(r);return}if(e.method==="GET"&&i.pathname==="/docs"){this.sendSwaggerUi(r);return}if(e.method==="GET"&&i.pathname.startsWith("/swagger-ui/")){this.serveStaticFile(e,r,i.pathname);return}if(e.method==="GET"&&i.pathname==="/v1/usage"){let d=Math.floor((Date.now()-this.usageStats.startTime)/1e3);this.sendJson(r,200,{object:"usage",total_requests:this.usageStats.totalRequests,total_tokens:{input:this.usageStats.totalTokensIn,output:this.usageStats.totalTokensOut,total:this.usageStats.totalTokensIn+this.usageStats.totalTokensOut},requests_by_endpoint:this.usageStats.requestsByEndpoint,uptime_seconds:d,active_requests:this.activeRequests});return}if(e.method==="GET"&&i.pathname==="/v1/models"){let d=await this.getAvailableModels();this.sendJson(r,200,{object:"list",data:d});return}let c=i.pathname.match(/^\/v1\/models\/(.+)$/);if(e.method==="GET"&&c){let d=decodeURIComponent(c[1]),f=(await this.getAvailableModels()).find(h=>h.id===d);if(!f)throw new U(404,`Model '${d}' not found`,"not_found","model_not_found");this.sendJson(r,200,f);return}if(e.method==="POST"&&i.pathname==="/v1/chat/completions"){let d=await this.readJsonBody(e);if(d?.stream===!0)await this.processStreamingChatCompletion(d,e,r,n,o);else{let p=await this.processChatCompletion(d,{source:"http",endpoint:"/v1/chat/completions"});this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,tokensIn:p?.usage?.prompt_tokens,tokensOut:p?.usage?.completion_tokens,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p)}return}if(e.method==="POST"&&i.pathname==="/v1/messages"){let d=await this.readJsonBody(e);if(d?.model&&!this.resolveModel(d.model))throw new U(400,`Model '${d.model}' is not supported.`,"invalid_request_error","model_not_found");if(d?.stream===!0)await this.processStreamingAnthropicMessages(d,e,r,n,o);else try{let p=await this.processAnthropicMessages(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,tokensIn:p?.usage?.input_tokens,tokensOut:p?.usage?.output_tokens,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p)}catch(p){let f=p instanceof U?p:new U(500,p.message||"Internal Server Error","api_error");this.sendJson(r,f.status,{type:"error",error:{type:f.code||"api_error",message:f.message}})}return}if(e.method==="POST"&&i.pathname==="/v1/completions"){let d=await this.readJsonBody(e),p=await this.processCompletion(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,tokensIn:p?.usage?.prompt_tokens,tokensOut:p?.usage?.completion_tokens,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p);return}if(e.method==="POST"&&i.pathname==="/v1/tokenize"){let d=await this.readJsonBody(e),p=await this.processTokenize(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p);return}if(e.method==="POST"&&i.pathname==="/v1/count_tokens"){let d=await this.readJsonBody(e),p=await this.processTokenize(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p);return}if(e.method==="POST"&&i.pathname==="/v1/responses"){let d=await this.readJsonBody(e),p=await this.processResponsesApi(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,tokensIn:p?.usage?.input_tokens,tokensOut:p?.usage?.output_tokens,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p);return}let u=i.pathname.match(/^\/v1beta\/models\/(.+):generateContent$/),l=i.pathname.match(/^\/v1beta\/models\/(.+):streamGenerateContent$/);if(e.method==="POST"&&(u||l)){let d=decodeURIComponent((u||l)[1]),p=await this.readJsonBody(e);if(d&&!this.resolveModel(d))throw new U(400,`Model '${d}' is not supported.`,"invalid_request_error","model_not_found");if(l)await this.processStreamingGoogleGenerateContent(d,p,e,r,n,o);else try{let f=await this.processGoogleGenerateContent(d,p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usageMetadata?.promptTokenCount,tokensOut:f?.usageMetadata?.candidatesTokenCount,model:d,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}catch(f){let h=f instanceof U?f:new U(500,f.message||"Internal Server Error","server_error");this.sendJson(r,h.status,{error:{code:h.status,message:h.message,status:h.code||"INTERNAL"}})}return}throw e.method==="POST"&&i.pathname==="/v1/embeddings"?new U(501,"Embeddings are not supported by Copilot.","not_implemented","embeddings_not_supported"):i.pathname.startsWith("/v1/images")?new U(501,"Image generation is not supported by Copilot.","not_implemented","images_not_supported"):i.pathname.startsWith("/v1/audio")?new U(501,"Audio processing is not supported by Copilot.","not_implemented","audio_not_supported"):new U(404,`No route for ${e.method??"UNKNOWN"} ${i.pathname}`,"not_found")}async processStreamingGoogleGenerateContent(e,r,n,o,i,s){let a=[];if(r.systemInstruction){let p=r.systemInstruction.parts.map(f=>f.text).join(" ");a.push($.LanguageModelChatMessage.User(this.redactPromptString(p)))}for(let p of r.contents){let f=p.role==="model"?$.LanguageModelChatMessageRole.Assistant:$.LanguageModelChatMessageRole.User,h=p.parts.map(g=>g.text).join(" "),m=this.redactPromptString(h);f===$.LanguageModelChatMessageRole.User?a.push($.LanguageModelChatMessage.User(m)):a.push($.LanguageModelChatMessage.Assistant(m))}let c=this.resolveModel(e),u=a.map(p=>typeof p.content=="string"?p.content:p.content.map(f=>"text"in f?f.text:"").join(" ")).join(`
`);o.writeHead(200,{"Content-Type":"application/json","X-HTTP-Content-Type-Options":"nosniff","Transfer-Encoding":"chunked"});let l="",d=new $.CancellationTokenSource;n.on("close",()=>{d.cancel(),console.log(`[Google] Client disconnected, cancelling request ${i||""}`)});try{let p=await $.lm.selectChatModels({vendor:"copilot"});if(!p||p.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let f=p[0],h=await f.sendRequest(a,{},d.token);o.write(`[
`);let m=!0;for await(let x of h.stream){if(d.token.isCancellationRequested)break;if(x instanceof $.LanguageModelTextPart){l+=x.value,m||o.write(`,
`);let w={candidates:[{content:{role:"model",parts:[{text:x.value}]},finishReason:"STOP",index:0}],usageMetadata:{promptTokenCount:0,candidatesTokenCount:0,totalTokenCount:0}};o.write(JSON.stringify(w)),m=!1}}d.token.isCancellationRequested||(o.write(`
]
`),o.end());let g=0,v=0;try{g=await f.countTokens(u,d.token),v=await f.countTokens(l,d.token)}catch{}i&&this.logRequest(i,"POST",`/v1beta/models/${e}:streamGenerateContent`,200,Date.now()-(s||0),{requestPayload:r,responsePayload:{candidates:[{content:{parts:[{text:l}]}}]},tokensIn:g,tokensOut:v,model:c})}catch(p){if(d.token.isCancellationRequested)return;console.error("Google streaming error:",p);let f=p instanceof U?p:new U(500,p.message||"Internal Server Error","server_error");o.write(JSON.stringify({error:{code:f.status,message:f.message,status:f.code}})),o.end()}finally{d.dispose()}}async processStreamingAnthropicMessages(e,r,n,o,i){let s=[];e.system&&s.push($.LanguageModelChatMessage.User(this.redactPromptString(e.system)));for(let f of e.messages){let h=f.role==="user"?$.LanguageModelChatMessageRole.User:$.LanguageModelChatMessageRole.Assistant,m=typeof f.content=="string"?f.content:f.content.map(v=>v.text).join(" "),g=this.redactPromptString(m);h===$.LanguageModelChatMessageRole.User?s.push($.LanguageModelChatMessage.User(g)):s.push($.LanguageModelChatMessage.Assistant(g))}let a=this.resolveModel(e.model),c=s.map(f=>typeof f.content=="string"?f.content:f.content.map(h=>"text"in h?h.text:"").join(" ")).join(`
`);n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});let u="ant-"+(0,mt.randomUUID)(),l="",d=new $.CancellationTokenSource;r.on("close",()=>{d.cancel(),console.log(`[Anthropic] Client disconnected, cancelling request ${o||""}`)});let p=setInterval(()=>{n.writableEnded||n.write(`: ping

`)},15e3);try{let f=await $.lm.selectChatModels({vendor:"copilot"});if(!f||f.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let h=f[0],m=await h.sendRequest(s,{},d.token);n.write(`event: message_start
data: ${JSON.stringify({type:"message_start",message:{id:u,type:"message",role:"assistant",content:[],model:a,stop_reason:null,stop_sequence:null,usage:{input_tokens:0,output_tokens:0}}})}

`),n.write(`event: content_block_start
data: ${JSON.stringify({type:"content_block_start",index:0,content_block:{type:"text",text:""}})}

`);for await(let x of m.stream){if(d.token.isCancellationRequested)break;x instanceof $.LanguageModelTextPart&&(l+=x.value,n.write(`event: content_block_delta
data: ${JSON.stringify({type:"content_block_delta",index:0,delta:{type:"text_delta",text:x.value}})}

`))}d.token.isCancellationRequested||(n.write(`event: content_block_stop
data: ${JSON.stringify({type:"content_block_stop",index:0})}

`),n.write(`event: message_delta
data: ${JSON.stringify({type:"message_delta",delta:{stop_reason:"end_turn",stop_sequence:null},usage:{output_tokens:0}})}

`),n.write(`event: message_stop
data: ${JSON.stringify({type:"message_stop"})}

`),n.end());let g=0,v=0;try{g=await h.countTokens(c,d.token),v=await h.countTokens(l,d.token)}catch{}o&&this.logRequest(o,"POST","/v1/messages",200,Date.now()-(i||0),{requestPayload:e,responsePayload:{id:u,type:"message",content:[{type:"text",text:l}]},tokensIn:g,tokensOut:v,model:a})}catch(f){if(d.token.isCancellationRequested)return;console.error("Anthropic streaming error:",f);let h=f instanceof U?f:new U(500,f.message||"Internal Server Error","server_error");n.write(`event: error
data: ${JSON.stringify({type:"error",error:{type:h.code||"api_error",message:h.message}})}

`),n.end()}finally{clearInterval(p),d.dispose()}}async getAvailableModels(){let e=Math.floor(Date.now()/1e3);return(await $.lm.selectChatModels({vendor:"copilot"})).map(o=>({id:o.id,object:"model",created:e,owned_by:o.vendor||"github-copilot",name:o.name,family:o.family,version:o.version,max_input_tokens:o.maxInputTokens,capabilities:{chat_completion:!0,text_completion:!0,streaming:!0,token_counting:!0}}))}async processStreamingChatCompletion(e,r,n,o,i){let s=this.normalizeChatMessages(e);s=this.redactMessagesContent(s);let a=this.resolveModel(e?.model),c=this.normalizeTools(e?.tools||e?.functions),u=e?.tool_choice||e?.function_call,l=`chatcmpl-${(0,mt.randomUUID)()}`,d=Math.floor(Date.now()/1e3),p="";n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});try{let f=await $.lm.selectChatModels({vendor:"copilot"});if(!f||f.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let h=f[0],m=[];for(let Y of s){let be=typeof Y.content=="string"?Y.content:JSON.stringify(Y.content);switch(Y.role){case"system":m.push($.LanguageModelChatMessage.User(`[System]: ${be}`));break;case"user":m.push($.LanguageModelChatMessage.User(be));break;case"assistant":if(Y.tool_calls&&Y.tool_calls.length>0){let ir=Y.tool_calls.map(xr=>`[Called function: ${xr.function?.name||xr.name}(${xr.function?.arguments||JSON.stringify(xr.arguments)})]`).join(`
`);m.push($.LanguageModelChatMessage.Assistant(ir))}else m.push($.LanguageModelChatMessage.Assistant(be));break;case"tool":let We=`[Tool result for ${Y.tool_call_id||"unknown"}]: ${be}`;m.push($.LanguageModelChatMessage.User(We));break;default:m.push($.LanguageModelChatMessage.User(be))}}let g={};c&&c.length>0&&(g.tools=c,u==="required"||u==="any"?g.toolMode=$.LanguageModelChatToolMode.Required:g.toolMode=$.LanguageModelChatToolMode.Auto);let v=await h.sendRequest(m,g,new $.CancellationTokenSource().token),x=[],w=0;for await(let Y of v.stream)if(Y instanceof $.LanguageModelTextPart){p+=Y.value;let be={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{content:Y.value},finish_reason:null}]};n.write(`data: ${JSON.stringify(be)}

`)}else if(Y instanceof $.LanguageModelToolCallPart){let be=`call_${(0,mt.randomUUID)().slice(0,24)}`,We=typeof Y.input=="string"?Y.input:JSON.stringify(Y.input);x.push({id:be,name:Y.name,arguments:We});let ir={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{tool_calls:[{index:w,id:be,type:"function",function:{name:Y.name,arguments:We}}]},finish_reason:null}]};n.write(`data: ${JSON.stringify(ir)}

`),w++}let I=x.length>0?"tool_calls":"stop",k={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{},finish_reason:I}]};n.write(`data: ${JSON.stringify(k)}

`),n.write(`data: [DONE]

`),n.end();let ie=0,se=0;try{let Y=m.map(be=>typeof be.content=="string"?be.content:JSON.stringify(be.content)).join(`
`);ie=await h.countTokens(Y,new $.CancellationTokenSource().token),se=await h.countTokens(p,new $.CancellationTokenSource().token)}catch(Y){console.error("Failed to count tokens:",Y)}o&&i&&this.logRequest(o,"POST","/v1/chat/completions",200,Date.now()-i,{requestPayload:e,responsePayload:{streamed:!0,content_preview:p.slice(0,500),tool_calls:x},model:e?.model,requestHeaders:r.headers,responseHeaders:n.getHeaders(),tokensIn:ie,tokensOut:se})}catch(f){let h={error:{message:f instanceof Error?f.message:"Unknown error",type:"server_error"}};n.write(`data: ${JSON.stringify(h)}

`),n.end(),o&&i&&this.logRequest(o,"POST","/v1/chat/completions",500,Date.now()-i,{requestPayload:e,error:f instanceof Error?f.message:String(f),model:e?.model,requestHeaders:r.headers})}}async processTokenize(e){let r=e?.text||e?.input||"",n=this.resolveModel(e?.model),o=await $.lm.selectChatModels({vendor:"copilot"});if(!o||o.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let s=await o[0].countTokens(r);return{object:"token_count",model:n,token_count:s,text_length:r.length}}async processResponsesApi(e){let r=e?.input,n=[];typeof r=="string"?n=[{role:"user",content:r}]:Array.isArray(r)&&(n=r.map(u=>typeof u=="string"?{role:"user",content:u}:{role:u.role||"user",content:typeof u.content=="string"?u.content:JSON.stringify(u.content)}));let o=this.composePrompt(n);o=this.redactPromptString(o);let i=this.resolveModel(e?.model),s=await this.runWithConcurrency(()=>this.invokeCopilot(o)),a=0,c=0;try{let u=await $.lm.selectChatModels({vendor:"copilot"});if(u&&u.length>0){let l=u[0];a=await l.countTokens(o),c=await l.countTokens(s||"")}}catch(u){console.error("Token counting failed:",u)}return{id:`resp-${(0,mt.randomUUID)()}`,object:"response",created_at:Math.floor(Date.now()/1e3),model:i,output:[{type:"message",id:`msg-${(0,mt.randomUUID)()}`,role:"assistant",content:[{type:"output_text",text:s}]}],usage:{prompt_tokens:a,completion_tokens:c,total_tokens:a+c}}}async processAnthropicMessages(e){let r=[];e.system&&r.push($.LanguageModelChatMessage.User(this.redactPromptString(e.system)));for(let c of e.messages){let u=c.role==="user"?$.LanguageModelChatMessageRole.User:$.LanguageModelChatMessageRole.Assistant,l=typeof c.content=="string"?c.content:c.content.map(p=>p.text).join(" "),d=this.redactPromptString(l);u===$.LanguageModelChatMessageRole.User?r.push($.LanguageModelChatMessage.User(d)):r.push($.LanguageModelChatMessage.Assistant(d))}let n=this.resolveModel(e.model),o=r.map(c=>typeof c.content=="string"?c.content:c.content.map(u=>"text"in u?u.text:"").join(" ")).join(`
`),i=await this.runWithConcurrency(()=>this.invokeCopilot(o)),s=0,a=0;try{let c=r.map(l=>l.content).join(" "),u=await $.lm.selectChatModels({vendor:"copilot"});if(u&&u.length>0){let l=u[0];s=await l.countTokens(c),a=await l.countTokens(i||"")}}catch(c){console.error("Anthropic token counting failed:",c)}return{id:"ant-"+(0,mt.randomUUID)(),type:"message",role:"assistant",content:[{type:"text",text:i||""}],model:n,stop_reason:"end_turn",stop_sequence:null,usage:{input_tokens:s,output_tokens:a}}}async processGoogleGenerateContent(e,r){let n=[];if(r.systemInstruction){let u=r.systemInstruction.parts.map(l=>l.text).join(" ");n.push($.LanguageModelChatMessage.User(this.redactPromptString(u)))}for(let u of r.contents){let l=u.role==="model"?$.LanguageModelChatMessageRole.Assistant:$.LanguageModelChatMessageRole.User,d=u.parts.map(f=>f.text).join(" "),p=this.redactPromptString(d);l===$.LanguageModelChatMessageRole.User?n.push($.LanguageModelChatMessage.User(p)):n.push($.LanguageModelChatMessage.Assistant(p))}let o=this.resolveModel(e),i=n.map(u=>typeof u.content=="string"?u.content:u.content.map(l=>"text"in l?l.text:"").join(" ")).join(`
`),s=await this.runWithConcurrency(()=>this.invokeCopilot(i)),a=0,c=0;try{let u=n.map(d=>d.content).join(" "),l=await $.lm.selectChatModels({vendor:"copilot"});if(l&&l.length>0){let d=l[0];a=await d.countTokens(u),c=await d.countTokens(s||"")}}catch(u){console.error("Google token counting failed:",u)}return{candidates:[{content:{role:"model",parts:[{text:s||""}]},finishReason:"STOP",index:0}],usageMetadata:{promptTokenCount:a,candidatesTokenCount:c,totalTokenCount:a+c}}}async processChatCompletion(e,r){let n=this.normalizeChatMessages(e);n=this.injectSystemPrompt(n),n=this.redactMessagesContent(n);let o=this.resolveModel(e?.model),i=this.normalizeTools(e?.tools||e?.functions)||[],a=(await this.mcpService.getAllTools()).map(v=>({name:`mcp_${v.serverName}_${v.name}`,description:v.description||`Tool from MCP server ${v.serverName}`,inputSchema:v.inputSchema})),c=[...i,...a],u=e?.tool_choice||e?.function_call;if(e?.response_format?.type==="json_object"){let v=n.map(x=>x.role).lastIndexOf("user");if(v>=0){let x=n[v].content;n[v]={...n[v],content:`${x}

IMPORTANT: You MUST respond with valid JSON only.No markdown, no explanation, just pure JSON.`}}}let d=0,p=5,f;for(;d<p;){if(f=await this.runWithConcurrency(()=>this.invokeCopilotWithTools(n,c,u)),f.toolCalls&&f.toolCalls.length>0){let v=f.toolCalls.filter(x=>x.name.startsWith("mcp_"));if(v.length>0){n.push({role:"assistant",content:f.content||null,tool_calls:f.toolCalls.map(x=>({id:`call_${(0,mt.randomUUID)().slice(0,24)}`,type:"function",function:{name:x.name,arguments:typeof x.arguments=="string"?x.arguments:JSON.stringify(x.arguments)}}))});for(let x of v){let w=x.name.split("_"),I=w[1],k=w.slice(2).join("_");try{let ie=await this.mcpService.callTool(I,k,x.arguments);n.push({role:"tool",tool_call_id:`call_${(0,mt.randomUUID)().slice(0,24)}`,content:JSON.stringify(ie)})}catch(ie){n.push({role:"tool",tool_call_id:`call_${(0,mt.randomUUID)().slice(0,24)}`,content:`Error executing MCP tool: ${ie.message}`})}}d++;continue}}break}let h=Math.floor(Date.now()/1e3),m=0,g=0;try{let v=await $.lm.selectChatModels({vendor:"copilot"});if(v&&v.length>0){let x=v[0],w=n.map(ie=>typeof ie.content=="string"?ie.content:JSON.stringify(ie.content)).join(`
`);m=await x.countTokens(w);let I=f.content||"",k=f.toolCalls?JSON.stringify(f.toolCalls):"";g=await x.countTokens(I+k)}}catch(v){console.error("Token counting failed:",v)}return f.toolCalls&&f.toolCalls.length>0?{id:`chatcmpl- ${(0,mt.randomUUID)()}`,object:"chat.completion",created:h,model:o,choices:[{index:0,message:{role:"assistant",content:f.content||null,tool_calls:f.toolCalls.map((v,x)=>({id:`call_${(0,mt.randomUUID)().slice(0,24)}`,type:"function",function:{name:v.name,arguments:typeof v.arguments=="string"?v.arguments:JSON.stringify(v.arguments)}}))},finish_reason:"tool_calls"}],usage:{prompt_tokens:m,completion_tokens:g,total_tokens:m+g},system_fingerprint:null}:{id:`chatcmpl - ${(0,mt.randomUUID)()}`,object:"chat.completion",created:h,model:o,choices:[{index:0,message:{role:"assistant",content:f.content},finish_reason:"stop"}],usage:{prompt_tokens:m,completion_tokens:g,total_tokens:m+g},system_fingerprint:null}}normalizeTools(e){if(!(!e||!Array.isArray(e)||e.length===0))return e.map(r=>{let n=r.type==="function"?r.function:r;return{name:n.name,description:n.description||"",inputSchema:n.parameters||n.inputSchema||void 0}})}async invokeCopilotWithTools(e,r,n){let o=await this.getCopilotHealth();if(!o.installed)throw new U(503,"GitHub Copilot extension is not installed.","service_unavailable","copilot_not_installed");if(!o.chatInstalled)throw new U(503,"GitHub Copilot Chat extension is not installed.","service_unavailable","copilot_chat_not_installed");if(!o.signedIn)throw new U(401,"Not signed in to GitHub Copilot. Please sign in in VS Code.","unauthorized","copilot_not_signed_in");let i=await $.lm.selectChatModels({vendor:"copilot"});if(!i||i.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let s=i[0],a=[];for(let d of e){let p=typeof d.content=="string"?d.content:JSON.stringify(d.content);switch(d.role){case"system":a.push($.LanguageModelChatMessage.User(`[System]: ${p}`));break;case"user":a.push($.LanguageModelChatMessage.User(p));break;case"assistant":if(d.tool_calls&&d.tool_calls.length>0){let h=d.tool_calls.map(m=>`[Called function: $ { tc.function?.name || tc.name }(${m.function?.arguments||JSON.stringify(m.arguments)})]`).join(`
`);a.push($.LanguageModelChatMessage.Assistant(h))}else a.push($.LanguageModelChatMessage.Assistant(p));break;case"tool":let f=`[Tool result for ${d.tool_call_id||"unknown"}]: ${p} `;a.push($.LanguageModelChatMessage.User(f));break;default:a.push($.LanguageModelChatMessage.User(p))}}let c={};r&&r.length>0&&(c.tools=r,n==="required"||n==="any"?c.toolMode=$.LanguageModelChatToolMode.Required:c.toolMode=$.LanguageModelChatToolMode.Auto);let u=new $.CancellationTokenSource,l=setTimeout(()=>u.cancel(),(this.config.requestTimeoutSeconds||180)*1e3);try{let d=await s.sendRequest(a,c,u.token),p="",f=[];for await(let h of d.stream){if(u.token.isCancellationRequested)throw new U(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout");h instanceof $.LanguageModelTextPart?p+=h.value:h instanceof $.LanguageModelToolCallPart&&f.push({name:h.name,arguments:h.input})}return{content:p.trim(),toolCalls:f.length>0?f:void 0}}catch(d){throw d instanceof U?d:u.token.isCancellationRequested?new U(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout"):new U(502,`Failed to retrieve Copilot response: ${Po(d)} `,"bad_gateway","command_failed",{cause:d})}finally{clearTimeout(l),u.dispose()}}async processCompletion(e){let r=this.normalizePromptInput(e?.prompt);if(!r)throw new U(400,"prompt is required","invalid_request_error","missing_prompt");r=this.redactPromptString(r);let n=this.resolveModel(e?.model),o=await this.runWithConcurrency(()=>this.invokeCopilot(r)),i=Math.floor(Date.now()/1e3),s=0,a=0;try{let c=await $.lm.selectChatModels({vendor:"copilot"});if(c&&c.length>0){let u=c[0],l=r;s=await u.countTokens(l);let d=o||"";a=await u.countTokens(d)}}catch(c){console.error("Token counting failed:",c)}return{id:`cmpl - ${(0,mt.randomUUID)()} `,object:"text_completion",created:i,model:n,choices:[{index:0,text:o,finish_reason:"stop",logprobs:null}],usage:{prompt_tokens:s,completion_tokens:a,total_tokens:s+a}}}async handleWebSocketMessage(e,r){let n=typeof r=="string"?r:r.toString("utf8"),o;try{o=JSON.parse(n)}catch{throw new U(400,"WebSocket payload must be valid JSON.","invalid_request_error","invalid_json")}let i=o?.type??o?.event??o?.action;if(i==="ping"){e.send(JSON.stringify({type:"pong",timestamp:Date.now()}));return}if(!i||i==="chat.completions.create"){let s=o?.data??o?.request??o,a=await this.processChatCompletion(s,{source:"websocket",endpoint:"/v1/chat/completions"});e.send(JSON.stringify({type:"chat.completion.result",data:a}));return}if(i==="completions.create"){let s=o?.data??o?.request??o,a=await this.processCompletion(s);e.send(JSON.stringify({type:"completion.result",data:a}));return}throw new U(400,`Unsupported message type: ${i} `,"invalid_request_error","unsupported_ws_message")}handleWebSocketConnection(e){e.send(JSON.stringify({type:"session.created",session:{id:(0,mt.randomUUID)(),model:this.config.defaultModel,created:Math.floor(Date.now()/1e3)}})),e.on("message",r=>{this.handleWebSocketMessage(e,r).catch(n=>{n instanceof U?this.sendWsError(e,n):(this.logError("Unhandled WebSocket error",n),this.sendWsError(e,new U(500,"An unexpected error occurred.","server_error")))})}),e.on("error",r=>{this.logError("WebSocket client error",r)})}async runWithConcurrency(e){if(this.activeRequests>=this.config.maxConcurrentRequests)throw new U(429,"Too many concurrent requests. Try again shortly.","rate_limit_exceeded","concurrency_limit");this.activeRequests+=1;try{return await e()}finally{this.activeRequests-=1}}async invokeCopilot(e){let r=await $.lm.selectChatModels({vendor:"copilot"});if(!r||r.length===0)throw new U(503,"No Copilot language model available. Make sure GitHub Copilot is installed and signed in.","service_unavailable","copilot_unavailable");let n=r[0],o=[$.LanguageModelChatMessage.User(e)],i=new $.CancellationTokenSource,s=setTimeout(()=>i.cancel(),(this.config.requestTimeoutSeconds||180)*1e3);try{let a=await n.sendRequest(o,{},i.token),c="";for await(let u of a.text){if(i.token.isCancellationRequested)throw new U(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout");c+=u}if(!c.trim())throw new U(502,"Copilot did not return any content.","bad_gateway","empty_response");return c.trim()}catch(a){throw a instanceof U?a:i.token.isCancellationRequested?new U(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout"):new U(502,`Failed to retrieve Copilot response: ${Po(a)} `,"bad_gateway","command_failed",{cause:a})}finally{clearTimeout(s),i.dispose()}}extractTextFromChatResult(e){if(e){if(typeof e=="string")return e.trim()||void 0;if(Array.isArray(e))return e.map(r=>typeof r=="string"?r:"").join(" ").trim()||void 0;if(typeof e=="object"){let r=e,n=r.response??r.result??r.body;if(typeof n=="string")return n.trim()||void 0;if(n&&typeof n=="object"){let o=n.text??n.message;if(typeof o=="string"&&o.trim())return o.trim();let i=n.responseContent;if(Array.isArray(i)){let s=i.map(a=>typeof a=="string"?a:a&&typeof a=="object"&&typeof a.text=="string"?String(a.text):"").join("").trim();if(s)return s}}if(Array.isArray(r.choices)&&r.choices.length>0){let o=r.choices[0];if(typeof o?.text=="string"&&o.text.trim())return o.text.trim();let i=o?.message;if(i&&typeof i.content=="string"&&i.content.trim())return i.content.trim()}}}}normalizeChatMessages(e){let r=e?.messages;if(Array.isArray(r)&&r.length>0)return r.map((o,i)=>({role:typeof o?.role=="string"?o.role:i===r.length-1?"user":"system",content:o?.content,tool_calls:o?.tool_calls,tool_call_id:o?.tool_call_id}));let n=this.normalizePromptInput(e?.prompt??e?.input);if(n)return[{role:"user",content:n}];throw new U(400,"messages must be a non-empty array or prompt must be provided.","invalid_request_error","missing_messages")}normalizePromptInput(e){if(typeof e=="string")return e.trim()||void 0;if(Array.isArray(e))return e.map(n=>typeof n=="string"?n:"").join(`
`).trim()||void 0}composePrompt(e){return e.map(({role:r,content:n})=>{let o=r||"user",i=this.flattenMessageContent(n);return`[${o}]
${i} `}).join(`

`)}flattenMessageContent(e){return typeof e=="string"?e:e==null?"":Array.isArray(e)?e.map(r=>typeof r=="string"?r:r&&typeof r=="object"&&typeof r.text=="string"?String(r.text):"").join(`
`):String(e)}resolveModel(e){if(typeof e=="string"&&e.trim()){let r=e.trim().toLowerCase(),n=nV[r];return n||e.trim()}return this.config.defaultModel}injectSystemPrompt(e){return!this.config.defaultSystemPrompt||e.some(n=>n.role==="system")?e:[{role:"system",content:this.config.defaultSystemPrompt},...e]}async readJsonBody(e){let r=[],n=0;if(await new Promise((i,s)=>{e.on("data",a=>{let c=typeof a=="string"?Buffer.from(a):a;n+=c.length;let u=(this.config.maxPayloadSizeMb||1)*1024*1024;if(n>u){e.destroy(),s(new U(413,`Request body too large.Maximum size is ${Math.round(u/1024)} KB.`,"invalid_request_error","payload_too_large"));return}r.push(c)}),e.on("end",()=>i()),e.on("error",a=>s(a))}),r.length===0)return{};let o=Buffer.concat(r).toString("utf8");if(!o.trim())return{};try{return JSON.parse(o)}catch(i){throw new U(400,"Request body must be valid JSON.","invalid_request_error","invalid_json",{cause:i})}}sendJson(e,r,n){e.headersSent||(e.statusCode=r,e.setHeader("Content-Type","application/json")),e.end(JSON.stringify(n))}sendSwaggerUi(e){let r=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot API - Swagger UI</title>
    <link rel="stylesheet" href="/swagger-ui/swagger-ui.css">
    <style>
        body { margin: 0; background: #fafafa; }
        .swagger-ui .topbar { display: none; }
        .swagger-ui .info { margin: 30px 0; }
        .swagger-ui .info .title { font-size: 2em; }
    </style>
</head>
<body>
    <div id="swagger-ui"></div>
    <script src="/swagger-ui/swagger-ui-bundle.js"></script>
    <script src="/swagger-ui/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function() {
            SwaggerUIBundle({
                url: '/openapi.json',
                dom_id: '#swagger-ui',
                presets: [SwaggerUIBundle.presets.apis, SwaggerUIBundle.SwaggerUIStandalonePreset],
                layout: 'BaseLayout',
                deepLinking: true,
                showExtensions: true,
                showCommonExtensions: true
            });
        };
    </script>
</body>
</html>`;e.statusCode=200,e.setHeader("Content-Type","text/html"),e.end(r)}serveStaticFile(e,r,n){let o=wt.basename(n),i=[];if(this.context)try{i.push(this.context.asAbsolutePath(wt.join("dist","swagger-ui",o)))}catch{}i.push(wt.join(__dirname,"swagger-ui",o),wt.join(__dirname,"..","swagger-ui",o),wt.join(__dirname,"dist","swagger-ui",o));let s="";for(let a of i)if(Rt.existsSync(a)){s=a;break}if(s){let a=Rt.statSync(s),c=wt.extname(s),u="text/plain";c===".css"?u="text/css":c===".js"&&(u="application/javascript"),r.writeHead(200,{"Content-Type":u,"Content-Length":a.size}),Rt.createReadStream(s).pipe(r)}else{let a=`[Static] File not found: ${o}. Checked: ${JSON.stringify(i)}`;if(console.error(a),this.output.appendLine(`[${new Date().toISOString()}] ERROR ${a}`),this.context)try{let c=this.context.asAbsolutePath(wt.join("dist","swagger-ui"));Rt.existsSync(c)?this.output.appendLine(`Contents of ${c}: ${Rt.readdirSync(c).join(", ")}`):this.output.appendLine(`Directory not found: ${c}`)}catch(c){this.output.appendLine(`Error listing directory: ${c}`)}r.statusCode=404,r.end("Not found")}}sendDebugPaths(e){let r={dirname:__dirname,cwd:process.cwd(),contextExtensionUri:this.context?.extensionUri.fsPath??"undefined",candidates_css:[],dist_swagger_contents:"N/A"},n="swagger-ui.css",o=[];if(this.context)try{let i=this.context.asAbsolutePath(wt.join("dist","swagger-ui",n)),s=wt.dirname(i),a="N/A";Rt.existsSync(s)&&(a=Rt.readdirSync(s).join(", ")),o.push({type:"context.asAbsolutePath",path:i,exists:Rt.existsSync(i),dir_exists:Rt.existsSync(s),dir_contents:a}),r.dist_swagger_contents=a}catch(i){o.push({error:String(i)})}o.push({type:"fallback_dirname",path:wt.join(__dirname,"swagger-ui",n),exists:Rt.existsSync(wt.join(__dirname,"swagger-ui",n))}),r.candidates_css=o,e.statusCode=200,e.setHeader("Content-Type","application/json"),e.end(JSON.stringify(r,null,2))}getOpenApiSpec(){let e=`http://${this.config.host}:${this.config.port}`;return{openapi:"3.1.0",info:{title:"Copilot API Gateway",description:"Local OpenAI-compatible API server powered by GitHub Copilot. Provides REST and WebSocket endpoints for chat completions, text completions, tokenization, and more.",version:"1.0.0",contact:{name:"GitHub Copilot API VS Code Extension"},license:{name:"MIT"}},servers:[{url:e,description:"Local Copilot API Server"}],tags:[{name:"Chat",description:"Chat completion endpoints"},{name:"Completions",description:"Text completion endpoints"},{name:"Anthropic",description:"Anthropic Messages API compatible endpoints"},{name:"Google",description:"Google Generative AI API compatible endpoints"},{name:"Models",description:"Model information"},{name:"Utilities",description:"Utility endpoints"}],paths:{"/v1/chat/completions":{post:{tags:["Chat"],summary:"Create chat completion",description:"Creates a chat completion for the given messages. Supports streaming, function calling (tools), JSON mode, and more.",operationId:"createChatCompletion",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ChatCompletionRequest"},examples:{basic:{summary:"Basic chat",value:{model:this.config.defaultModel,messages:[{role:"user",content:"Hello!"}]}},streaming:{summary:"Streaming response",value:{model:this.config.defaultModel,messages:[{role:"user",content:"Tell me a story"}],stream:!0}},tools:{summary:"With tools/functions",value:{model:this.config.defaultModel,messages:[{role:"user",content:"What is the weather?"}],tools:[{type:"function",function:{name:"get_weather",description:"Get weather for a location",parameters:{type:"object",properties:{location:{type:"string"}},required:["location"]}}}]}}}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/ChatCompletionResponse"}},"text/event-stream":{description:"Server-sent events for streaming responses"}}},400:{description:"Bad request",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},401:{description:"Unauthorized",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},429:{description:"Rate limited",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/completions":{post:{tags:["Completions"],summary:"Create text completion",description:"Creates a text completion for the given prompt.",operationId:"createCompletion",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/CompletionRequest"},example:{model:this.config.defaultModel,prompt:"Once upon a time",max_tokens:100}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/CompletionResponse"}}}},400:{description:"Bad request"},401:{description:"Unauthorized"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/responses":{post:{tags:["Chat"],summary:"Create response (simplified API)",description:"Simplified OpenAI Responses API format for easier integration.",operationId:"createResponse",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ResponsesRequest"},example:{model:this.config.defaultModel,input:"What is 2+2?"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/ResponsesResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/models":{get:{tags:["Models"],summary:"List models",description:"Lists all available models from GitHub Copilot.",operationId:"listModels",responses:{200:{description:"List of models",content:{"application/json":{schema:{$ref:"#/components/schemas/ModelList"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/models/{model_id}":{get:{tags:["Models"],summary:"Get model",description:"Retrieves details about a specific model.",operationId:"getModel",parameters:[{name:"model_id",in:"path",required:!0,schema:{type:"string"},description:"The ID of the model"}],responses:{200:{description:"Model details",content:{"application/json":{schema:{$ref:"#/components/schemas/Model"}}}},404:{description:"Model not found"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/tokenize":{post:{tags:["Utilities"],summary:"Count tokens",description:"Counts the number of tokens in the given text.",operationId:"tokenize",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/TokenizeRequest"},example:{model:this.config.defaultModel,text:"Hello, world!"}}}},responses:{200:{description:"Token count",content:{"application/json":{schema:{$ref:"#/components/schemas/TokenizeResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/usage":{get:{tags:["Utilities"],summary:"Get usage statistics",description:"Returns usage statistics including request counts, token usage, and uptime.",operationId:"getUsage",responses:{200:{description:"Usage statistics",content:{"application/json":{schema:{$ref:"#/components/schemas/UsageResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/messages":{post:{tags:["Anthropic"],summary:"Anthropic Messages API",description:"Create a message using the Anthropic-compatible API format.",operationId:"anthropicMessages",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/AnthropicMessageRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/AnthropicMessageResponse"}},"text/event-stream":{description:"Anthropic-style event stream"}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1beta/models/{model}:generateContent":{post:{tags:["Google"],summary:"Google Generative AI generateContent",description:"Generate content using the Google-compatible API format.",operationId:"googleGenerateContent",parameters:[{name:"model",in:"path",required:!0,schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1beta/models/{model}:streamGenerateContent":{post:{tags:["Google"],summary:"Google Generative AI streamGenerateContent",description:"Stream content generation using the Google-compatible API format.",operationId:"googleStreamGenerateContent",parameters:[{name:"model",in:"path",required:!0,schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/GoogleGenerateContentResponse"}}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/health":{get:{tags:["Utilities"],summary:"Health check",description:"Simple health check endpoint for monitoring.",operationId:"healthCheck",responses:{200:{description:"Service is healthy",content:{"application/json":{schema:{type:"object",properties:{status:{type:"string",example:"ok"},service:{type:"string",example:"github-copilot-api-vscode"}}}}}}}}}},components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer",description:"API key authentication (optional, configure in extension settings)"}},schemas:{ChatCompletionRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string",description:"Model ID to use",example:this.config.defaultModel},messages:{type:"array",items:{$ref:"#/components/schemas/Message"},description:"List of messages in the conversation"},stream:{type:"boolean",default:!1,description:"Enable streaming responses"},temperature:{type:"number",minimum:0,maximum:2,description:"Sampling temperature"},max_tokens:{type:"integer",description:"Maximum tokens to generate"},tools:{type:"array",items:{$ref:"#/components/schemas/Tool"},description:"List of tools/functions available"},tool_choice:{type:"string",description:"How to select tools: auto, none, or specific"},response_format:{type:"object",properties:{type:{type:"string",enum:["text","json_object"]}},description:"Response format (json_object for JSON mode)"}}},Message:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["system","user","assistant","tool"],description:"Role of the message sender"},content:{type:"string",description:"Message content"},name:{type:"string",description:"Name of the sender (optional)"},tool_calls:{type:"array",items:{$ref:"#/components/schemas/ToolCall"}},tool_call_id:{type:"string",description:"ID of tool call this message responds to"}}},Tool:{type:"object",required:["type","function"],properties:{type:{type:"string",enum:["function"]},function:{type:"object",required:["name"],properties:{name:{type:"string"},description:{type:"string"},parameters:{type:"object",description:"JSON Schema for function parameters"}}}}},ToolCall:{type:"object",properties:{id:{type:"string"},type:{type:"string",enum:["function"]},function:{type:"object",properties:{name:{type:"string"},arguments:{type:"string"}}}}},ChatCompletionResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"chat.completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{index:{type:"integer"},message:{$ref:"#/components/schemas/Message"},finish_reason:{type:"string",enum:["stop","length","tool_calls"]}}}},usage:{$ref:"#/components/schemas/Usage"}}},CompletionRequest:{type:"object",required:["model","prompt"],properties:{model:{type:"string"},prompt:{type:"string",description:"Text prompt to complete"},max_tokens:{type:"integer",default:100},temperature:{type:"number"}}},CompletionResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"text_completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{text:{type:"string"},index:{type:"integer"},finish_reason:{type:"string"}}}},usage:{$ref:"#/components/schemas/Usage"}}},ResponsesRequest:{type:"object",required:["input"],properties:{model:{type:"string"},input:{type:"string",description:"User input/question"},instructions:{type:"string",description:"System instructions"}}},ResponsesResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string"},created_at:{type:"integer"},output:{type:"array",items:{type:"object",properties:{type:{type:"string"},content:{type:"array",items:{type:"object",properties:{type:{type:"string"},text:{type:"string"}}}}}}},usage:{$ref:"#/components/schemas/Usage"}}},TokenizeRequest:{type:"object",required:["text"],properties:{model:{type:"string"},text:{type:"string",description:"Text to tokenize"}}},TokenizeResponse:{type:"object",properties:{model:{type:"string"},token_count:{type:"integer"}}},ModelList:{type:"object",properties:{object:{type:"string",example:"list"},data:{type:"array",items:{$ref:"#/components/schemas/Model"}}}},Model:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"model"},created:{type:"integer"},owned_by:{type:"string"}}},UsageResponse:{type:"object",properties:{object:{type:"string",example:"usage"},total_requests:{type:"integer"},total_tokens:{type:"object",properties:{input:{type:"integer"},output:{type:"integer"},total:{type:"integer"}}},uptime_seconds:{type:"integer"},active_requests:{type:"integer"}}},Usage:{type:"object",properties:{prompt_tokens:{type:"integer"},completion_tokens:{type:"integer"},total_tokens:{type:"integer"}}},Error:{type:"object",properties:{error:{type:"object",properties:{message:{type:"string"},type:{type:"string"},code:{type:"string"}}}}},AnthropicMessageRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string"},messages:{type:"array",items:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["user","assistant"]},content:{type:"string"}}}},system:{type:"string"},max_tokens:{type:"integer"},stream:{type:"boolean"}}},AnthropicMessageResponse:{type:"object",properties:{id:{type:"string"},type:{type:"string",example:"message"},role:{type:"string",example:"assistant"},content:{type:"array",items:{type:"object",properties:{type:{type:"string",example:"text"},text:{type:"string"}}}},model:{type:"string"},stop_reason:{type:"string"},usage:{type:"object",properties:{input_tokens:{type:"integer"},output_tokens:{type:"integer"}}}}},GoogleGenerateContentRequest:{type:"object",required:["contents"],properties:{contents:{type:"array",items:{type:"object",required:["parts"],properties:{role:{type:"string",enum:["user","model"]},parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}}},systemInstruction:{type:"object",properties:{parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}},generationConfig:{type:"object"}}},GoogleGenerateContentResponse:{type:"object",properties:{candidates:{type:"array",items:{type:"object",properties:{content:{type:"object",properties:{role:{type:"string"},parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}},finishReason:{type:"string"}}}},usageMetadata:{type:"object",properties:{promptTokenCount:{type:"integer"},candidatesTokenCount:{type:"integer"},totalTokenCount:{type:"integer"}}}}}}}}}sendError(e,r){let n=r.status??500,o={error:{message:r.message,type:r.type,code:r.code??null,param:null}};this.sendJson(e,n,o)}sendWsError(e,r){e.send(JSON.stringify({type:"error",error:{message:r.message,type:r.type,code:r.code??null}}))}setCorsHeaders(e){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Headers","authorization, content-type, x-requested-with"),e.setHeader("Access-Control-Allow-Methods","GET,POST,OPTIONS")}checkRateLimit(){if(this.config.rateLimitPerMinute<=0)return!0;let e=Date.now(),r=e-6e4;return this.rateLimitBucket=this.rateLimitBucket.filter(n=>n>r),this.rateLimitBucket.length>=this.config.rateLimitPerMinute?!1:(this.rateLimitBucket.push(e),!0)}getClientIp(e){let r=e.headers["x-forwarded-for"];if(r){let i=(typeof r=="string"?r:r[0])?.split(",")[0]?.trim();if(i)return i}let n=e.socket.remoteAddress||"unknown";return n.startsWith("::ffff:")?n.substring(7):n}checkIpAllowlist(e){let r=this.config.ipAllowlist;if(!r||r.length===0)return!0;let n=e.socket.remoteAddress;if(!n)return!1;let o=n.startsWith("::ffff:")?n.substring(7):n;for(let i of r)if(i.includes("/")){if(this.isIpInCidr(o,i))return!0}else if(/^[\d\.]+$|^[\da-fA-F:]+$/.test(i)){if(i===o)return!0}else{let s=this.domainCache.get(i);if(s&&s.includes(o))return!0}return!1}async refreshDomainCache(){let e=await import("dns").then(r=>r.promises);for(let r of this.config.ipAllowlist)if(/[a-zA-Z]/.test(r)&&!r.includes("/"))try{let n=await e.resolve4(r).catch(()=>[]),o=await e.resolve6(r).catch(()=>[]),i=[...n,...o];i.length>0&&this.domainCache.set(r,i)}catch{}}isIpInCidr(e,r){try{let[n,o]=r.split("/"),i=~(2**(32-parseInt(o,10))-1),s=e.split(".").map(Number),a=n.split(".").map(Number),c=s[0]<<24|s[1]<<16|s[2]<<8|s[3],u=a[0]<<24|a[1]<<16|a[2]<<8|a[3];return(c&i)===(u&i)}catch{return!1}}logRequest(e,r,n,o,i,s){let a=o>=400,c=s?.tokensIn??0,u=s?.tokensOut??0;this.recordRequestStats(i,c,u,a);let l={timestamp:new Date().toISOString(),requestId:e,method:r,path:n,status:o,durationMs:i,tokensIn:s?.tokensIn,tokensOut:s?.tokensOut,error:s?.error,model:s?.model,requestBody:s?.requestPayload,responseBody:s?.responsePayload,requestHeaders:s?.requestHeaders,responseHeaders:s?.responseHeaders},d=this.redactSensitiveData(l);if(this.auditService.logRequest(d),this._onDidLogRequest.fire(d),this.wsServer){let p=JSON.stringify({type:"log",data:d});this.wsServer.clients.forEach(f=>{f.readyState===1&&f.send(p)})}if(this.config.enableLogging){let p=a?"\u274C":o>=300?"\u26A0\uFE0F":"\u2705";this.output.appendLine(`[${new Date().toLocaleTimeString()}] ${p} ${r} ${n} ${o} (${i}ms)`),s?.error&&this.output.appendLine(`  Error: ${s.error}`)}}getCacheKey(e){return JSON.stringify({model:e?.model,messages:e?.messages,prompt:e?.prompt,tools:e?.tools,stream:e?.stream})}getFromCache(e){let r=this.requestCache.get(e);if(r&&Date.now()-r.timestamp<this.CACHE_TTL_MS)return r.response;this.requestCache.delete(e)}setCache(e,r){if(this.requestCache.size>100){let n=Date.now();for(let[o,i]of this.requestCache.entries())n-i.timestamp>this.CACHE_TTL_MS&&this.requestCache.delete(o)}this.requestCache.set(e,{response:r,timestamp:Date.now()})}buildUrl(e){let r=`http://${this.config.host}:${this.config.port}`;return new URL(e??"/",r)}async updateServerConfig(e){this.config={...this.config,...e},this._onDidChangeStatus.fire();let r=$.workspace.getConfiguration("githubCopilotApi"),n=[];e.enabled!==void 0&&n.push(Promise.resolve(r.update("server.enabled",e.enabled,$.ConfigurationTarget.Global))),e.enableHttp!==void 0&&n.push(Promise.resolve(r.update("server.enableHttp",e.enableHttp,$.ConfigurationTarget.Global))),e.enableWebSocket!==void 0&&n.push(Promise.resolve(r.update("server.enableWebSocket",e.enableWebSocket,$.ConfigurationTarget.Global))),e.host!==void 0&&n.push(Promise.resolve(r.update("server.host",e.host,$.ConfigurationTarget.Global))),e.port!==void 0&&n.push(Promise.resolve(r.update("server.port",e.port,$.ConfigurationTarget.Global))),e.maxConcurrentRequests!==void 0&&n.push(Promise.resolve(r.update("server.maxConcurrentRequests",e.maxConcurrentRequests,$.ConfigurationTarget.Global))),e.defaultModel!==void 0&&n.push(Promise.resolve(r.update("server.defaultModel",e.defaultModel,$.ConfigurationTarget.Global))),e.enableLogging!==void 0&&n.push(Promise.resolve(r.update("server.enableLogging",e.enableLogging,$.ConfigurationTarget.Global))),e.apiKey!==void 0&&n.push(Promise.resolve(r.update("server.apiKey",e.apiKey,$.ConfigurationTarget.Global))),e.rateLimitPerMinute!==void 0&&n.push(Promise.resolve(r.update("server.rateLimitPerMinute",e.rateLimitPerMinute,$.ConfigurationTarget.Global))),e.requestTimeoutSeconds!==void 0&&n.push(Promise.resolve(r.update("server.requestTimeoutSeconds",e.requestTimeoutSeconds,$.ConfigurationTarget.Global))),e.maxPayloadSizeMb!==void 0&&n.push(Promise.resolve(r.update("server.maxPayloadSizeMb",e.maxPayloadSizeMb,$.ConfigurationTarget.Global))),e.maxConnectionsPerIp!==void 0&&n.push(Promise.resolve(r.update("server.maxConnectionsPerIp",e.maxConnectionsPerIp,$.ConfigurationTarget.Global))),e.redactionPatterns!==void 0&&n.push(Promise.resolve(r.update("server.redactionPatterns",e.redactionPatterns,$.ConfigurationTarget.Global))),e.ipAllowlist!==void 0&&n.push(Promise.resolve(r.update("server.ipAllowlist",e.ipAllowlist,$.ConfigurationTarget.Global))),this.suppressRestart=!0;try{await Promise.all(n)}finally{this.suppressRestart=!1}await this.restart()}updateStatusBar(e,r){let n=`${this.config.enableHttp?"HTTP":""}${this.config.enableHttp&&this.config.enableWebSocket?"+":""}${this.config.enableWebSocket?"WS":""}`||"disabled";if(e==="starting"){this.statusItem.text="$(broadcast) Copilot API: Starting\u2026",this.statusItem.tooltip="Starting Copilot API gateway",this.statusItem.show();return}if(e==="running"){this.statusItem.text=`$(broadcast) Copilot API: On (${n})`;let o=`${this.config.host}:${this.config.port}`;this.statusItem.tooltip=r||`Copilot API is running on ${o}`,this.statusItem.show();return}this.statusItem.text="$(broadcast) Copilot API: Off",this.statusItem.tooltip=r??"Copilot API gateway is stopped",this.statusItem.hide()}async showControlPalette(){let e=$.workspace.getConfiguration("githubCopilotApi"),r=[{label:"$(check) Start HTTP + WebSocket",description:"Enable and start all endpoints"},{label:"$(primitive-square) Stop Server",description:"Disable all endpoints"},{label:`${this.config.enableHttp?"$(circle-slash)":"$(play)"} Toggle HTTP`,description:this.config.enableHttp?"Disable HTTP REST endpoints":"Enable HTTP REST endpoints"},{label:`${this.config.enableWebSocket?"$(circle-slash)":"$(play)"} Toggle WebSocket`,description:this.config.enableWebSocket?"Disable WebSocket realtime endpoint":"Enable WebSocket realtime endpoint"},{label:"$(globe) Listen on localhost",description:"Bind to 127.0.0.1"},{label:"$(rss) Listen on all interfaces",description:"Bind to 0.0.0.0 for LAN access"},{label:"$(plug) Change port",description:`Current: ${this.config.port}`},{label:"$(settings) Open settings",description:"Open Copilot API settings"}],n=await $.window.showQuickPick(r,{placeHolder:"Copilot API controls"});if(n){if(n.label.includes("Start")){await e.update("server.enabled",!0,$.ConfigurationTarget.Global),await e.update("server.enableHttp",!0,$.ConfigurationTarget.Global),await e.update("server.enableWebSocket",!0,$.ConfigurationTarget.Global);return}if(n.label.includes("Stop")){await e.update("server.enabled",!1,$.ConfigurationTarget.Global);return}if(n.label.includes("Toggle HTTP")){await e.update("server.enableHttp",!this.config.enableHttp,$.ConfigurationTarget.Global),await e.update("server.enabled",!0,$.ConfigurationTarget.Global);return}if(n.label.includes("Toggle WebSocket")){await e.update("server.enableWebSocket",!this.config.enableWebSocket,$.ConfigurationTarget.Global),await e.update("server.enabled",!0,$.ConfigurationTarget.Global);return}if(n.label.includes("localhost")){await e.update("server.host","127.0.0.1",$.ConfigurationTarget.Global),await e.update("server.enabled",!0,$.ConfigurationTarget.Global);return}if(n.label.includes("all interfaces")){await e.update("server.host","0.0.0.0",$.ConfigurationTarget.Global),await e.update("server.enabled",!0,$.ConfigurationTarget.Global);return}if(n.label.includes("Change port")){let o=await $.window.showInputBox({title:"Set API server port",value:String(this.config.port),validateInput:i=>{let s=Number(i);return!Number.isFinite(s)||s<=0||s>65535?"Enter a valid port between 1 and 65535":null}});o&&(await e.update("server.port",Number(o),$.ConfigurationTarget.Global),await e.update("server.enabled",!0,$.ConfigurationTarget.Global));return}n.label.includes("settings")&&await $.commands.executeCommand("workbench.action.openSettings","githubCopilotApi.server")}}logInfo(e){this.output.appendLine(`[${new Date().toISOString()}] INFO ${e}`)}logError(e,r){this.output.appendLine(`[${new Date().toISOString()}] ERROR ${e}: ${Po(r)}`)}};async function Fd(){let t=$.extensions.getExtension(eV);if(!t)return await $.window.showWarningMessage("GitHub Copilot Chat extension is required. Install it from the Marketplace to continue.","Open Marketplace","Cancel")==="Open Marketplace"&&await $.commands.executeCommand("workbench.extensions.search",tV),!1;if(!t.isActive)try{await t.activate()}catch(e){return $.window.showErrorMessage(`Failed to activate GitHub Copilot Chat: ${Po(e)}`),!1}return!0}function gb(t){if(typeof t=="string")return t.trim()||void 0;if(Array.isArray(t))return t.map(e=>typeof e=="string"?e:"").join(" ").trim()||void 0}function Kz(){let t=$.workspace.getConfiguration("githubCopilotApi"),e=t.get("server.enabled",!1),r=t.get("server.enableHttp",!0),n=t.get("server.enableWebSocket",!0),o=t.get("server.host","127.0.0.1").trim()||"127.0.0.1",i=t.get("server.port",3030),s=Number.isFinite(i)?Math.max(1,Math.floor(i)):3030,a=t.get("server.maxConcurrentRequests",4),c=Number.isFinite(a)?Math.max(1,Math.floor(a)):4,u=(t.get("server.defaultModel","gpt-4o-copilot")??"gpt-4o-copilot").trim()||"gpt-4o-copilot",l=t.get("server.apiKey","").trim(),d=t.get("server.enableLogging",!1),p=t.get("server.rateLimitPerMinute",60),f=Number.isFinite(p)?Math.max(0,Math.floor(p)):60,h=t.get("server.defaultSystemPrompt","").trim(),g=t.get("server.redactionPatterns",[]).map((se,Y)=>typeof se=="string"?{id:`migrated-${Y}`,name:`Custom Pattern ${Y+1}`,pattern:se,enabled:!0,isBuiltin:!1}:se),v=[];for(let se of rV){let Y=g.find(be=>be.id===se.id);Y?v.push({...se,enabled:Y.enabled}):v.push(se)}for(let se of g)se.isBuiltin||v.push(se);let x=t.get("server.ipAllowlist",[]),w=t.get("server.requestTimeoutSeconds",180),I=t.get("server.maxPayloadSizeMb",1),k=t.get("server.maxConnectionsPerIp",10),ie=$.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0);return{enabled:e,enableHttp:r,enableWebSocket:n,host:o,port:s,maxConcurrentRequests:c,defaultModel:u,apiKey:l,enableLogging:d,rateLimitPerMinute:f,defaultSystemPrompt:h,redactionPatterns:v,ipAllowlist:x,requestTimeoutSeconds:w,maxPayloadSizeMb:I,maxConnectionsPerIp:k,mcpEnabled:ie}}function Po(t){return t instanceof Error&&t.message?t.message:String(t)}var Ke=Le(require("vscode")),Bi=class t{constructor(e,r){this._extensionUri=e;this._gateway=r;this._gateway.onDidChangeStatus(async()=>{this._view&&(this._view.webview.html=await this._getSidebarHtml(this._view.webview)),t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,this._gateway))}),this._gateway.onDidLogRequest(n=>{this._view&&this._view.webview.postMessage({type:"liveLog",value:n}),t.currentPanel&&t.currentPanel.webview.postMessage({type:"liveLog",value:n})})}static viewType="copilotApiControls";_view;static currentPanel;static panelDisposables=[];static async createOrShow(e,r,n){let o=Ke.window.activeTextEditor?.viewColumn??Ke.ViewColumn.One;if(t.currentPanel){t.currentPanel.reveal(o),t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r),n&&t.currentPanel.webview.postMessage({type:"scrollTo",target:n});return}let i=Ke.window.createWebviewPanel("copilotApiDashboard","Copilot API Dashboard",o,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});t.currentPanel=i,i.webview.html=await t.getPanelHtml(i.webview,r),n&&setTimeout(()=>{i.webview.postMessage({type:"scrollTo",target:n})},300),i.webview.onDidReceiveMessage(s=>{t.handleMessage(s,r)},void 0,t.panelDisposables),i.onDidDispose(()=>{t.currentPanel=void 0;for(let s of t.panelDisposables)s.dispose();t.panelDisposables=[]},null,t.panelDisposables)}static handleMessage(e,r){switch(e.type){case"openChat":Ke.commands.executeCommand("github-copilot-api-vscode.openCopilotChat");break;case"askCopilot":Ke.commands.executeCommand("github-copilot-api-vscode.askCopilot");break;case"showControls":Ke.commands.executeCommand("github-copilot-api-vscode.showServerControls");break;case"startServer":r.startServer();break;case"stopServer":r.stopServer();break;case"toggleHttp":r.toggleHttp();break;case"toggleWs":r.toggleWebSocket();break;case"toggleLogging":r.toggleLogging();break;case"setApiKey":typeof e.value=="string"&&r.setApiKey(e.value);break;case"setRateLimit":typeof e.value=="number"&&r.setRateLimit(e.value);break;case"hostLocal":r.setHost("127.0.0.1");break;case"hostLan":r.setHost("0.0.0.0");break;case"setHost":typeof e.value=="string"&&r.setHost(e.value);break;case"setPort":typeof e.value=="number"&&r.setPort(e.value);break;case"setModel":typeof e.value=="string"&&r.setDefaultModel(e.value);break;case"clearHistory":r.clearHistory();break;case"toggleMcp":typeof e.value=="boolean"&&r.toggleMcp(e.value);break;case"addRedactionPattern":if(e.value&&typeof e.value=="object"){let{name:o,pattern:i}=e.value;r.addRedactionPattern(o,i).then(async s=>{s?t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r)):Ke.window.showErrorMessage("Invalid regex pattern")})}break;case"removeRedactionPattern":typeof e.value=="string"&&r.removeRedactionPattern(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"toggleRedactionPattern":if(e.value&&typeof e.value=="object"){let{id:o,enabled:i}=e.value;r.toggleRedactionPattern(o,i)}break;case"addIpAllowlistEntry":typeof e.value=="string"&&r.addIpAllowlistEntry(e.value).then(async o=>{o?t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r)):Ke.window.showErrorMessage("Invalid IP address or CIDR range")});break;case"removeIpAllowlistEntry":typeof e.value=="string"&&r.removeIpAllowlistEntry(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setRequestTimeout":typeof e.value=="number"&&r.setRequestTimeout(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxPayloadSize":typeof e.value=="number"&&r.setMaxPayloadSize(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxConnectionsPerIp":typeof e.value=="number"&&r.setMaxConnectionsPerIp(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxConcurrency":typeof e.value=="number"&&r.setMaxConcurrency(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"getHistory":if(t.currentPanel){let o=r.getHistory(50);t.currentPanel.webview.postMessage({type:"historyData",data:o})}break;case"getStats":t.currentPanel&&t.currentPanel.webview.postMessage({type:"statsData",data:r.getStats()});break;case"getAuditStats":t.currentPanel&&r.getDailyStats(30).then(o=>{t.currentPanel?.webview.postMessage({type:"auditStatsData",data:o})});break;case"getAuditLogs":if(console.log("[CopilotPanel] Received getAuditLogs request"),t.currentPanel){let o=e.value||{},i=o.page||1,s=o.pageSize||10;r.getAuditLogs(i,s).then(a=>{console.log("[CopilotPanel] Got audit logs:",a.total,"total,",a.entries.length,"entries"),t.currentPanel?.webview.postMessage({type:"auditLogData",data:a.entries,page:i,total:a.total,pageSize:s})}).catch(a=>{console.error("[CopilotPanel] Error getting audit logs:",a),t.currentPanel?.webview.postMessage({type:"auditLogData",data:[],page:i,total:0,pageSize:s})})}else console.warn("[CopilotPanel] No currentPanel available for getAuditLogs response");break;case"openLogFolder":let n=r.getLogFolderPath();n?Ke.commands.executeCommand("revealFileInOS",Ke.Uri.file(n)):Ke.window.showErrorMessage("Log folder not found");break;case"generatePrompt":case"enhancePrompt":if(e.data&&typeof e.data=="object"){let o=e.data,s=e.type==="enhancePrompt"?`You are an expert prompt engineer. Enhance and improve the following prompt to make it more detailed, specific, and effective:

${o.existingPrompt||o.context}

Make it more comprehensive with clear objectives, constraints, and expected deliverables.`:`You are an expert prompt engineer. Create a comprehensive, high-quality prompt for an AI coding assistant based on these specifications:

${o.projectType?`**Project Type:** ${o.projectType}`:""}
${o.techStack?`**Tech Stack:** ${o.techStack}`:""}
${o.goal?`**Goal:** ${o.goal}`:""}
${o.complexity?`**Complexity Level:** ${o.complexity}`:""}
${o.context?`**User Description:** ${o.context}`:""}

Generate a detailed, actionable prompt that includes:
1. Clear project objective and scope
2. Specific technical requirements
3. Step-by-step implementation plan
4. Best practices and considerations
5. Expected deliverables and success criteria

Format the output as a ready-to-use prompt that the user can copy and paste into an AI assistant.`;r.invokeCopilot(s).then(a=>{t.currentPanel&&t.currentPanel.webview.postMessage({type:"promptResult",data:a})}).catch(a=>{t.currentPanel&&t.currentPanel.webview.postMessage({type:"promptError",error:a.message})})}break}}async _getSidebarHtml(e){let r=Yz(),n=await this._gateway.getStatus(),o=n.running,i=o?"var(--vscode-testing-iconPassed)":"var(--vscode-testing-iconFailed)",s=o?"Running":"Stopped",a=`http://${n.config.host}:${n.config.port}`;return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${r}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 12px; font-family: var(--vscode-font-family); color: var(--vscode-foreground); background: var(--vscode-sideBar-background); }
        .status { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: ${i}; box-shadow: 0 0 6px ${i}; }
        .url { font-family: var(--vscode-editor-font-family); font-size: 11px; opacity: 0.8; word-break: break-all; margin-bottom: 12px; }
        button { width: 100%; padding: 8px 12px; margin-bottom: 8px; background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; border-radius: 4px; cursor: pointer; font-family: var(--vscode-font-family); font-weight: 500; }
        button:hover { background: var(--vscode-button-hoverBackground); }
        button.secondary { background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }
        button.secondary:hover { background: var(--vscode-button-secondaryHoverBackground); }
        .hint { font-size: 11px; opacity: 0.7; text-align: center; margin-top: 8px; }
        .btn-group { display: flex; gap: 6px; margin-bottom: 8px; }
        .btn-group button { width: auto; flex: 1; padding: 6px 10px; font-size: 11px; }
    </style>
</head>
<body>
    <div class="status">
        <div class="dot"></div>
        <strong>${s}</strong>
    </div>
    <div style="font-size: 11px; opacity: 0.8; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
        <div style="width: 7px; height: 7px; border-radius: 50%; background: ${n.copilot.ready?"var(--vscode-testing-iconPassed)":"var(--vscode-editorWarning-foreground)"};"></div>
        <span>Copilot: ${n.copilot.ready?"Ready":n.copilot.signedIn?"Extension Check":"Sign-in Needed"}</span>
    </div>
    <div class="url">${a}</div>
    <button id="btn-dashboard">Open Dashboard</button>
    <button id="btn-toggle" class="secondary">${o?"Stop Server":"Start Server"}</button>
    <button id="btn-swagger" class="secondary">\u{1F4DD} Swagger</button>
    <button id="btn-wiki" class="secondary">\u{1F4DA} Wiki</button>
    <button id="btn-prompt" class="secondary">\u2728 Prompt Generator</button>
    <div class="hint">Use the dashboard for full controls</div>
    <script nonce="${r}">
        const vscode = acquireVsCodeApi();
        document.getElementById('btn-dashboard').addEventListener('click', () => {
            vscode.postMessage({ type: 'openDashboard' });
        });
        document.getElementById('btn-toggle').addEventListener('click', () => {
            vscode.postMessage({ type: '${o?"stopServer":"startServer"}' });
        });
        document.getElementById('btn-swagger').addEventListener('click', () => {
            vscode.postMessage({ type: 'openSwagger' });
        });
        document.getElementById('btn-wiki').addEventListener('click', () => {
            vscode.postMessage({ type: 'openWiki' });
        });
        document.getElementById('btn-prompt').addEventListener('click', () => {
            vscode.postMessage({ type: 'openPromptGenerator' });
        });
    </script>
</body>
</html>`}static async getPanelHtml(e,r){let n=Yz(),o=await r.getStatus(),i=o.config,s=o.running,a=s?"var(--vscode-testing-iconPassed)":"var(--vscode-testing-iconFailed)",c=s?"Running":"Stopped",u=`http://${i.host}:${i.port}`,l=o.networkInfo;return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}' https://cdn.jsdelivr.net; connect-src http: https:;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot API Dashboard</title>
    <title>Copilot API Dashboard</title>
    <!-- Removed Chart.js for reliability -->
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        body {
            margin: 0; padding: 0; min-height: 100vh;
            background: radial-gradient(120% 120% at 20% 20%, rgba(56,189,248,0.05), transparent),
                        radial-gradient(120% 120% at 80% 0%, rgba(147,197,253,0.05), transparent),
                        var(--vscode-editor-background);
            font-family: var(--vscode-font-family); color: var(--vscode-foreground);
        }
        .page { max-width: 1400px; margin: 0 auto; padding: 32px 32px 64px; display: flex; flex-direction: column; gap: 24px; }
        .hero { display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; padding-bottom: 8px; }
        .hero h1 { margin: 0; font-size: 26px; letter-spacing: -0.4px; font-weight: 700; }
        .hero p { margin: 6px 0 0 0; opacity: 0.7; font-size: 14px; max-width: 600px; line-height: 1.5; }
        .badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px; background: var(--vscode-badge-background); color: var(--vscode-badge-foreground); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .card { background-color: var(--vscode-editorWidget-background); border: 1px solid var(--vscode-widget-border); border-radius: 12px; padding: 24px; box-shadow: 0 4px 24px rgba(0,0,0,0.06); transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.12); border-color: var(--vscode-focusBorder); }
        .card.full-width { grid-column: 1 / -1; }
        h3 { margin-top: 0; margin-bottom: 10px; font-size: 12px; text-transform: uppercase; letter-spacing: 0.4px; opacity: 0.8; }
        .status-row { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background-color: ${a}; box-shadow: 0 0 10px ${a}; }
        .info-grid { display: grid; grid-template-columns: 120px 1fr; gap: 6px 12px; font-size: 12px; align-items: center; }
        .label { opacity: 0.7; text-transform: uppercase; letter-spacing: 0.3px; font-size: 11px; }
        .value { font-family: var(--vscode-editor-font-family); word-break: break-all; }
        .actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; }
        button { display: inline-flex; justify-content: center; align-items: center; gap: 6px; width: 100%; padding: 10px 12px; background-color: var(--vscode-button-background); color: var(--vscode-button-foreground); border: 1px solid color-mix(in srgb, var(--vscode-button-background) 50%, transparent); border-radius: 6px; cursor: pointer; font-family: var(--vscode-font-family); font-weight: 600; transition: transform 120ms ease, background-color 120ms ease; }
        button:hover { background-color: var(--vscode-button-hoverBackground); transform: translateY(-1px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        button.secondary { background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }
        button.secondary:hover { background-color: var(--vscode-button-secondaryHoverBackground); }
        button.success { background-color: var(--vscode-testing-iconPassed); }
        button.danger { background-color: var(--vscode-testing-iconFailed); }
        .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--vscode-widget-border); }
        .toggle-row:last-child { border-bottom: none; }
        .switch { position: relative; width: 36px; height: 20px; }
        .switch input { display: none; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--vscode-input-background); border: 1px solid var(--vscode-widget-border); transition: .2s; border-radius: 999px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 2px; bottom: 2px; background-color: var(--vscode-foreground); transition: .2s; border-radius: 50%; }
        input:checked + .slider { background: var(--vscode-testing-iconPassed); border-color: var(--vscode-testing-iconPassed); }
        input:checked + .slider:before { transform: translateX(16px); background: var(--vscode-editor-background); }
        .muted { opacity: 0.75; font-size: 12px; }
        .inline-form { display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center; }
        .stacked { display: flex; flex-direction: column; gap: 12px; }
        input, select, textarea { width: 100%; padding: 8px 10px; font-size: 13px; border-radius: 6px; border: 1px solid var(--vscode-input-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-family: var(--vscode-font-family); box-sizing: border-box; }
        textarea { font-family: var(--vscode-editor-font-family); font-size: 12px; resize: vertical; min-height: 120px; }
        select { cursor: pointer; }
        .pill-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-editor-background); cursor: pointer; }
        .pill:hover { border-color: var(--vscode-testing-iconPassed); color: var(--vscode-testing-iconPassed); }
        .docs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px; }
        .doc-card { border: 1px dashed var(--vscode-widget-border); border-radius: 8px; padding: 10px; background: color-mix(in srgb, var(--vscode-editor-background) 90%, transparent); cursor: pointer; transition: border-color 0.15s, background 0.15s; }
        .doc-card:hover { border-color: var(--vscode-focusBorder); background: color-mix(in srgb, var(--vscode-editor-background) 70%, transparent); }
        .doc-card h4 { margin: 0 0 6px 0; font-size: 13px; display: flex; gap: 8px; align-items: center; }
        .doc-card code { display: inline-block; padding: 3px 6px; border-radius: 6px; background: var(--vscode-textBlockQuote-background); font-family: var(--vscode-editor-font-family); }
        .doc-card p { margin: 6px 0 0 0; opacity: 0.85; font-size: 12px; }
        pre { background: var(--vscode-textBlockQuote-background); border-radius: 8px; padding: 10px; font-size: 12px; overflow-x: auto; margin: 0; white-space: pre-wrap; word-break: break-word; }
        a { color: var(--vscode-textLink-foreground); }
        
        .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid currentColor; border-radius: 50%; border-top-color: transparent; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Live Log Tail Styles */
        .log-container {
            background: var(--vscode-textBlockQuote-background);
            color: var(--vscode-editor-foreground);
            font-family: var(--vscode-editor-font-family);
            font-size: 11px;
            padding: 12px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 2px;
            border: 1px solid var(--vscode-widget-border);
            margin-top: 8px;
        }
        .log-line {
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-all;
            display: flex;
            gap: 8px;
        }
        .log-time { color: var(--vscode-descriptionForeground); min-width: 75px; flex-shrink: 0; }
        .log-method { font-weight: 600; color: var(--vscode-terminal-ansiBlue); min-width: 50px; flex-shrink: 0; }
        .log-path { color: var(--vscode-terminal-ansiMagenta); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .log-status { font-weight: 600; min-width: 35px; flex-shrink: 0; }
        .log-status.success { color: var(--vscode-testing-iconPassed); }
        .log-status.error { color: var(--vscode-testing-iconFailed); }
        .log-latency { color: var(--vscode-descriptionForeground); min-width: 60px; text-align: right; flex-shrink: 0; }
        
        #log-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.3s ease;
        }
        #log-status-indicator.active { background-color: var(--vscode-testing-iconPassed); box-shadow: 0 0 8px var(--vscode-testing-iconPassed); }
        #log-status-indicator.inactive { background-color: var(--vscode-disabledForeground); }

    </style>
</head>
<body>
    <div class="page">
        <div class="hero">
            <div>
                <h1>Copilot API Dashboard</h1>
                <p>Monitor and control your local Copilot API Gateway.</p>
                <div style="margin-top: 8px; font-size: 13px; opacity: 0.9; font-family: var(--vscode-editor-font-family);">
                    <span style="opacity: 0.6;">Running on:</span> 
                    <strong>http://${i.host}:${i.port}</strong>
                </div>
            </div>
            <div style="display: flex; gap: 8px;">
                <button id="btn-toggle-server" class="${o.running?"danger":"success"}" data-running="${o.running}" style="min-width: 140px;">
                    ${o.running?"Stop Server":"Start Server"}
                </button>
                <button class="secondary" id="btn-open-chat" title="Open Copilot Chat" style="min-width: 90px;">\u{1F4AC} Chat</button>
                <button class="secondary" id="btn-ask-copilot" title="Ask Copilot" style="min-width: 90px;">\u2753 Ask</button>
                <button class="secondary" id="btn-settings" title="Settings">\u2699\uFE0F</button>
            </div>
        </div>

        <!-- Copilot Health Banner -->
        ${o.copilot.ready?"":`
        <div style="background: var(--vscode-statusBarItem-warningBackground); color: var(--vscode-statusBarItem-warningForeground); padding: 12px 16px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: center; gap: 12px; font-weight: 500; border: 1px solid rgba(0,0,0,0.1);">
            <span style="font-size: 20px;">\u26A0\uFE0F</span>
            <div style="flex: 1;">
                <div style="font-size: 14px;">GitHub Copilot is not fully ready</div>
                <div style="font-size: 12px; opacity: 0.9; font-weight: 400;">
                    ${o.copilot.installed?"":"\u2022 GitHub Copilot extension is missing. "}
                    ${o.copilot.chatInstalled?"":"\u2022 GitHub Copilot Chat extension is missing. "}
                    ${o.copilot.signedIn?"":"\u2022 You are not signed in to GitHub Copilot. "}
                </div>
            </div>
            <button class="secondary" onclick="vscode.postMessage({ type: 'askCopilot' })" style="width: auto; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: inherit;">Resolve</button>
        </div>
        `}

        <!-- Server Status Card -->
        <div class="card full-width">
            <div class="status-row" style="justify-content: space-between; margin-bottom: 24px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="status-dot" class="status-dot"></div>
                    <span id="server-status-text" style="font-size: 16px;">${c}</span>
                </div>
                <div class="muted">
                    v${r.getVersion()}
                </div>
            </div>

            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <div class="card" style="padding: 16px;">
                    <div class="label">Requests</div>
                    <div class="value" style="font-size: 20px;" id="stat-requests">${o.stats?.totalRequests??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Req/Min</div>
                    <div class="value" style="font-size: 20px;" id="stat-rpm">0</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Latency</div>
                    <div class="value" style="font-size: 20px;" id="stat-latency">0ms</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Error Rate</div>
                    <div class="value" style="font-size: 20px;" id="stat-errors">0%</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Tokens In</div>
                    <div class="value" style="font-size: 20px;" id="stat-tokens-in">${o.stats?.totalTokensIn??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Tokens Out</div>
                    <div class="value" style="font-size: 20px;" id="stat-tokens-out">${o.stats?.totalTokensOut??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Uptime</div>
                    <div class="value" style="font-size: 20px;" id="stat-uptime">0m</div>
                </div>
            </div>

            <div class="info-grid">
                <div class="label">Connection</div>
                <div class="value">
                    ${i.enableHttp?"HTTP ":""}
                    ${i.enableWebSocket?"WebSocket ":""}
                </div>
                <div class="label">Auth Mode</div>
                <div class="value">${i.apiKey?"API Key (Protected)":"Open (No Auth)"}</div>
                <div class="label">Default Model</div>
                <div class="value">${i.defaultModel}</div>
                <div class="label">Copilot Health</div>
                <div class="value" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <span class="badge" style="background: ${o.copilot.chatInstalled?"var(--vscode-charts-green)":o.copilot.signedIn?"var(--vscode-charts-yellow)":"var(--vscode-charts-red)"}; color: ${o.copilot.chatInstalled||o.copilot.signedIn?"var(--vscode-editor-background)":"white"}; padding: 1px 6px; border-radius: 4px; font-size: 10px;">Chat: ${o.copilot.chatInstalled?"Installed":o.copilot.signedIn?"Not Detected":"Missing"}</span>
                    <span class="badge" style="background: ${o.copilot.signedIn?"var(--vscode-charts-green)":"var(--vscode-charts-red)"}; color: ${o.copilot.signedIn?"var(--vscode-editor-background)":"white"}; padding: 1px 6px; border-radius: 4px; font-size: 10px;">Auth: ${o.copilot.signedIn?"Signed In":"Signed Out"}</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Configuration Card -->
            <div class="card">
                <h3>\u2699\uFE0F Server Configuration</h3>
                <div class="stacked">
                    <div class="toggle-row">
                        <span>Enable HTTP Server</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-http" ${i.enableHttp?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <span>Enable WebSocket</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-ws" ${i.enableWebSocket?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <span>Detailed Logging</span>
                            <span title="Enables verbose output to the VS Code Output channel. Useful for debugging." style="cursor: help; opacity: 0.6; font-size: 14px;">\u2139\uFE0F</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-logging" ${i.enableLogging?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 16px;">
                        <div style="display: flex; gap: 16px; margin-bottom: 12px;">
                            <div style="flex: 1;">
                                <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px;">HOST</span>
                                <input type="text" id="custom-host" value="${i.host}" placeholder="127.0.0.1" style="width: 100% !important;">
                            </div>
                            <div style="width: 100px;">
                                <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px;">PORT</span>
                                <input type="number" id="custom-port" value="${i.port}" style="width: 100% !important;">
                            </div>
                            <div style="display: flex; align-items: flex-end;">
                                <button class="secondary" id="btn-set-host" style="height: 36px; padding: 0 16px;">Apply</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="secondary" id="btn-host-local" style="flex: 1;">Bind Localhost</button>
                            <button class="secondary" id="btn-host-lan" style="flex: 1;">Bind LAN (0.0.0.0)</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Card -->
            <div class="card">
                <h3>\u{1F512} Security</h3>
                <div class="stacked">
                    <div class="toggle-row">
                        <span>Enable Authentication</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-auth" ${i.apiKey?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 12px;">
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <input type="password" id="api-key-input" value="${i.apiKey||""}" placeholder="sk-..." style="flex: 1;">
                            <button class="secondary" id="btn-show-key" style="width: 40px;" title="Show/Hide Key">\u{1F441}</button>
                            <button class="secondary" id="btn-copy-key" style="width: 40px;" title="Copy Key">\u{1F4CB}</button>
                        </div>
                        <div class="actions">
                            <button class="secondary" id="btn-generate-key">Generate New Key</button>
                            <button class="secondary" id="btn-set-apikey">Set Manual Key</button>
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 8px;">RATE LIMIT</span>
                        <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                            <input type="number" id="rate-limit-input" value="${i.rateLimitPerMinute||0}" placeholder="0 = unlimited" style="width: 100px !important;">
                            <span class="muted">req/min</span>
                            <button class="secondary" id="btn-set-ratelimit" style="width: auto; padding: 6px 16px;">Set</button>
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <div class="inline-form" style="margin-bottom: 8px;">
                            <span style="font-size: 12px; font-weight: 600;">ALLOW IP / DOMAIN</span>
                            <div style="display: flex; gap: 8px;">
                                <input type="text" id="ip-allowlist-input" placeholder="e.g. 192.168.1.5, 10.0.0.0/24, or example.com">
                                <button class="secondary" id="btn-add-ip" style="width: auto;">Add</button>
                            </div>
                        </div>
                        <div class="pill-row" id="ip-list">
                            ${(i.ipAllowlist||[]).map(d=>`<span class="pill" style="font-size: 11px; display: flex; align-items: center; gap: 4px;">${d} <span class="btn-remove-ip" data-value="${d}" style="cursor: pointer; opacity: 0.6;">\xD7</span></span>`).join("")}
                            ${!i.ipAllowlist||i.ipAllowlist.length===0?'<span class="muted">No access restrictions (all IPs allowed)</span>':""}
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 8px;">HARDENING & LIMITS</span>
                        
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Request Timeout</span>
                                <input type="number" id="timeout-input" value="${i.requestTimeoutSeconds||60}" style="width: 80px !important;">
                                <span class="muted">sec</span>
                                <button class="secondary" id="btn-set-timeout" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Max Payload</span>
                                <input type="number" id="payload-input" value="${i.maxPayloadSizeMb||1}" style="width: 80px !important;">
                                <span class="muted">MB</span>
                                <button class="secondary" id="btn-set-payload" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Max Connections/IP</span>
                                <input type="number" id="connections-input" value="${i.maxConnectionsPerIp||10}" style="width: 80px !important;">
                                <span class="muted">conn</span>
                                <button class="secondary" id="btn-set-connections" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Total Concurrency</span>
                                <input type="number" id="concurrency-input" value="${i.maxConcurrentRequests||4}" style="width: 80px !important;">
                                <span class="muted">req</span>
                                <button class="secondary" id="btn-set-concurrency" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>
                            <div class="muted" style="font-size: 10px; margin-top: 2px; opacity: 0.9; line-height: 1.4;">
                                <div style="display: flex; gap: 4px; margin-bottom: 2px;">
                                    <span style="font-weight: 600; color: var(--vscode-charts-blue); min-width: 105px;">Connections/IP:</span>
                                    <span>Limits simultaneous requests from a <b>single</b> user/client.</span>
                                </div>
                                <div style="display: flex; gap: 4px;">
                                    <span style="font-weight: 600; color: var(--vscode-charts-orange); min-width: 105px;">Total Concurrency:</span>
                                    <span>Global limit across <b>all</b> users to protect the Copilot backend.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MCP Status -->
        <div class="card full-width" id="mcp-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">\u{1F50C} MCP Status <span id="mcp-status-badge" class="badge">Checking...</span></h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; opacity: 0.8;">
                        <input type="checkbox" id="mcp-enabled-toggle" style="width: 14px; height: 14px; margin: 0;"> Enabled
                    </label>
                </div>
            </div>
            
            <div id="mcp-content-area">
                <div class="muted" style="text-align: center; padding: 20px;">Loading tools...</div>
            </div>
        </div>

        <!-- Live Log Tail -->
        <div class="card full-width">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">\u{1F4DF} Live Log Tail <div id="log-status-indicator" class="active"></div></h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; opacity: 0.8;">
                        <input type="checkbox" id="log-autoscroll" checked style="width: 14px; height: 14px; margin: 0;"> Auto-scroll
                    </label>
                    <button class="secondary" id="btn-clear-logs" style="width: auto; padding: 4px 12px; font-size: 11px; font-weight: 500;">\u{1F9F9} Clear</button>
                </div>
            </div>
            <div id="live-log-container" class="log-container">
                <div class="muted" style="text-align: center; padding-top: 120px; opacity: 0.5;">Waiting for API requests...</div>
            </div>
        </div>

        <!-- Audit & Analytics -->
        <div class="card full-width">
            
            <!-- Charts removed per user request -->
            <div style="margin-bottom: 24px;"></div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h4 style="margin: 0; font-size: 13px; opacity: 0.9;">Recent Activity</h4>
                <span id="refresh-timer" class="muted" style="font-weight: normal; font-size: 11px; opacity: 0.6;"></span>
                <div style="display: flex; gap: 8px;">
                    <button class="secondary" id="btn-refresh-audit" style="padding: 4px 10px; font-size: 11px;">\u{1F504} Refresh</button>
                    <button class="secondary" id="btn-open-logs" style="padding: 4px 10px; font-size: 11px;">\u{1F4C2} Open Log Folder</button>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table id="audit-table" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 1px solid var(--vscode-widget-border);">
                            <th style="padding: 8px 12px; opacity: 0.7;">Time</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Method</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Path</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Status</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Latency</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Tokens</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="audit-table-body">
                        <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                            <td style="padding: 8px 12px; opacity: 0.6; font-style: italic;" colspan="7">Loading audit logs...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--vscode-widget-border);">
                <div class="muted" style="font-size: 11px;" id="page-info">Showing 0-0 of 0</div>
                <div style="display: flex; gap: 8px;">
                    <button class="secondary" id="btn-prev-page" disabled>Previous</button>
                    <button class="secondary" id="btn-next-page" disabled>Next</button>
                </div>
            </div>
        </div>
        
        <div class="card full-width">
            <h3>\u{1F6E1}\uFE0F Data Redaction</h3>
            <p class="muted" style="margin-bottom: 16px;">
                Toggle patterns to automatically redact sensitive data from logs. All patterns are applied in real-time.
            </p>
            
            <!-- Built-in Patterns -->
            <div style="margin-bottom: 20px;">
                <h4 style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">Built-in Patterns</h4>
                <div id="builtin-patterns-list" style="display: flex; flex-direction: column; gap: 8px;">
                    ${(i.redactionPatterns||[]).filter(d=>d.isBuiltin).map(d=>`
                        <div class="toggle-row" style="padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 6px; border: 1px solid var(--vscode-widget-border);">
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <span style="font-weight: 600; font-size: 12px;">${d.name}</span>
                                <code style="font-size: 10px; opacity: 0.6; word-break: break-all;">${d.pattern.length>40?d.pattern.substring(0,40)+"...":d.pattern}</code>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="toggle-redaction" data-id="${d.id}" ${d.enabled?"checked":""}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    `).join("")}
                </div>
            </div>
            
            <!-- Custom Patterns -->
            <div style="border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                <h4 style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">Custom Patterns</h4>
                
                <div id="custom-patterns-list" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
                    ${(i.redactionPatterns||[]).filter(d=>!d.isBuiltin).map(d=>`
                        <div class="toggle-row" style="padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 6px; border: 1px solid var(--vscode-widget-border);">
                            <div style="display: flex; flex-direction: column; gap: 2px; flex: 1;">
                                <span style="font-weight: 600; font-size: 12px;">${d.name}</span>
                                <code style="font-size: 10px; opacity: 0.6; word-break: break-all;">${d.pattern}</code>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label class="switch">
                                    <input type="checkbox" class="toggle-redaction" data-id="${d.id}" ${d.enabled?"checked":""}>
                                    <span class="slider"></span>
                                </label>
                                <button class="secondary btn-remove-redaction" data-id="${d.id}" style="width: 28px; height: 28px; padding: 0; font-size: 14px;" title="Remove">\xD7</button>
                            </div>
                        </div>
                    `).join("")}
                    ${(i.redactionPatterns||[]).filter(d=>!d.isBuiltin).length===0?'<span class="muted" style="text-align: center; padding: 12px;">No custom patterns added yet</span>':""}
                </div>
                
                <!-- Add Custom Pattern Form -->
                <div style="display: flex; flex-direction: column; gap: 8px; padding: 12px; background: var(--vscode-textBlockQuote-background); border-radius: 8px;">
                    <span style="font-size: 11px; font-weight: 600; opacity: 0.8;">ADD CUSTOM PATTERN</span>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <input type="text" id="redaction-name-input" placeholder="Pattern name (e.g. 'Bank Account')" style="flex: 1; min-width: 150px;">
                        <input type="text" id="redaction-pattern-input" placeholder="Regex pattern" style="flex: 2; min-width: 200px;">
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button class="secondary" id="btn-test-redaction" style="width: auto;">\u{1F9EA} Test</button>
                        <button class="secondary" id="btn-add-redaction" style="width: auto;">\u2795 Add Pattern</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card full-width">
            <h3>\u{1F4DA} API Documentation</h3>
            <p class="muted" style="margin-bottom: 16px;">
                The gateway supports multiple API formats. Use the endpoints below with your favorite SDKs.
            </p>
            <div class="docs-grid">
                <div class="doc-card">
                    <h4><span>\u{1F916}</span> OpenAI <code>/v1</code></h4>
                    <p>Compatible with OpenAI SDKs. Supports <code>chat/completions</code>, <code>completions</code>, and <code>models</code>.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F9EA}</span> Anthropic <code>/v1</code></h4>
                    <p>Compatible with Claude SDKs. Supports <code>/v1/messages</code> with full streaming (SSE).</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F31F}</span> Google <code>/v1beta</code></h4>
                    <p>Compatible with Gemini SDKs. Supports <code>generateContent</code> and <code>streamGenerateContent</code>.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F50C}</span> MCP Tools</h4>
                    <p>MCP tools are automatically prefixed with <code>mcp_{server}_{tool}</code>. The gateway handles execution automatically in non-streaming mode.</p>
                </div>
            </div>
            <div class="actions" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-top: 16px;">
                <a href="http://${i.host}:${i.port}/docs" target="_blank" class="secondary" style="display: inline-flex; justify-content: center; align-items: center; gap: 6px; padding: 10px 12px; background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: 1px solid color-mix(in srgb, var(--vscode-button-secondaryBackground) 50%, transparent); border-radius: 6px; text-decoration: none; font-weight: 600;">\u{1F4DD} Swagger UI</a>
                <a href="http://${i.host}:${i.port}/openapi.json" target="_blank" class="secondary" style="display: inline-flex; justify-content: center; align-items: center; gap: 6px; padding: 10px 12px; background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: 1px solid color-mix(in srgb, var(--vscode-button-secondaryBackground) 50%, transparent); border-radius: 6px; text-decoration: none; font-weight: 600;">\u{1F4C4} OpenAPI JSON</a>
            </div>
        </div>

        <div class="card full-width" style="background: linear-gradient(135deg, color-mix(in srgb, var(--vscode-editor-background) 90%, #3b82f6 10%), color-mix(in srgb, var(--vscode-editor-background) 95%, #8b5cf6 5%));">
            <h3>\u{1F468}\u200D\u{1F4BB} About</h3>
            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Suhaib Bin Younis</div>
                    <div class="muted" style="margin-bottom: 8px;">Developer & Creator</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <a href="https://suhaibbinyounis.com" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F310} Website</a>
                        <a href="https://suhaib.in" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F517} suhaib.in</a>
                        <a href="mailto:vscode@suhaib.in" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F4E7} Email</a>
                        <a href="https://github.com/pmbyt/github-copilot-api-vscode" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u2B50 Star on GitHub</a>
                    </div>
                </div>
                <div class="muted" style="font-size: 11px; text-align: right;">
                    GitHub Copilot API Gateway v${r.getVersion()}<br>
                    Made with \u2764\uFE0F and \u2615
                </div>
            </div>
        </div>

        <!-- Prompt Generator Section -->
        <div id="prompt-generator-section" class="card full-width" style="background: linear-gradient(135deg, color-mix(in srgb, var(--vscode-editor-background) 95%, #8b5cf6 5%), color-mix(in srgb, var(--vscode-editor-background) 98%, #7c3aed 2%));">
            <h3>\u2728 Prompt Generator</h3>
            <p class="muted" style="margin-bottom: 16px;">Create high-quality, detailed prompts for AI assistants. Select options or describe what you need. <span style="opacity: 0.7; font-size: 10px;">\u{1F4A1} Uses Copilot directly - server not required</span></p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">
                <!-- Project Type -->
                <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F3AF} Project Type</label>
                    <select id="prompt-project-type" style="width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px;">
                        <option value="">Select type...</option>
                        <option value="web-app">Web Application</option>
                        <option value="mobile-app">Mobile App</option>
                        <option value="api">REST API / Backend</option>
                        <option value="cli">CLI Tool</option>
                        <option value="library">Library / Package</option>
                        <option value="automation">Automation Script</option>
                        <option value="data">Data Processing</option>
                        <option value="ml">Machine Learning</option>
                        <option value="devops">DevOps / Infrastructure</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <!-- Tech Stack -->
                <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F6E0}\uFE0F Tech Stack</label>
                    <select id="prompt-tech-stack" style="width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px;">
                        <option value="">Select stack...</option>
                        <option value="typescript-node">TypeScript + Node.js</option>
                        <option value="python">Python</option>
                        <option value="react">React + TypeScript</option>
                        <option value="nextjs">Next.js</option>
                        <option value="vue">Vue.js</option>
                        <option value="rust">Rust</option>
                        <option value="go">Go</option>
                        <option value="java">Java / Spring</option>
                        <option value="csharp">.NET / C#</option>
                        <option value="swift">Swift / iOS</option>
                        <option value="kotlin">Kotlin / Android</option>
                        <option value="flutter">Flutter / Dart</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <!-- Goal -->
                <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F3AA} Goal</label>
                    <select id="prompt-goal" style="width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px;">
                        <option value="">Select goal...</option>
                        <option value="build-new">Build from scratch</option>
                        <option value="add-feature">Add new feature</option>
                        <option value="refactor">Refactor / Improve</option>
                        <option value="debug">Debug / Fix issues</option>
                        <option value="optimize">Optimize performance</option>
                        <option value="test">Write tests</option>
                        <option value="document">Write documentation</option>
                        <option value="review">Code review</option>
                        <option value="migrate">Migrate / Upgrade</option>
                        <option value="learn">Learn / Explain</option>
                    </select>
                </div>
                
                <!-- Complexity -->
                <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F4CA} Complexity</label>
                    <select id="prompt-complexity" style="width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px;">
                        <option value="">Select level...</option>
                        <option value="simple">Simple / Quick task</option>
                        <option value="medium">Medium complexity</option>
                        <option value="complex">Complex / Multi-step</option>
                        <option value="enterprise">Enterprise-grade</option>
                    </select>
                </div>
            </div>
            
            <!-- Custom Context -->
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">\u{1F4DD} Describe what you want to build</label>
                <textarea id="prompt-context" placeholder="E.g., 'A user authentication system with OAuth, password reset, and role-based access control...'" style="width: 100%; min-height: 80px; padding: 10px; border-radius: 6px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-size: 12px; resize: vertical; font-family: inherit; box-sizing: border-box;"></textarea>
            </div>
            
            <!-- Generate Button -->
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button id="btn-generate-prompt" style="flex: 1; padding: 10px 16px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                    \u2728 Generate Prompt
                </button>
                <button id="btn-enhance-prompt" class="secondary" style="padding: 10px 16px; background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: none; border-radius: 6px; cursor: pointer; font-size: 12px;" title="Enhance with AI suggestions">
                    \u{1F680} Enhance
                </button>
            </div>
            
            <!-- Output Area -->
            <div id="prompt-output-container" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="font-size: 11px; font-weight: 600; opacity: 0.8;">\u{1F4CB} Generated Prompt</label>
                    <div style="display: flex; gap: 4px;">
                        <button id="btn-copy-prompt" class="secondary" style="padding: 4px 10px; font-size: 10px; border-radius: 4px; cursor: pointer; border: none; background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground);">\u{1F4CB} Copy</button>
                        <button id="btn-export-prompt" class="secondary" style="padding: 4px 10px; font-size: 10px; border-radius: 4px; cursor: pointer; border: none; background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground);">\u{1F4BE} Export</button>
                    </div>
                </div>
                <div id="prompt-output" style="background: var(--vscode-editor-background); border: 1px solid var(--vscode-widget-border); border-radius: 8px; padding: 16px; font-size: 12px; line-height: 1.6; white-space: pre-wrap; max-height: 400px; overflow-y: auto; font-family: var(--vscode-editor-font-family);"></div>
            </div>
            
            <!-- Loading State -->
            <div id="prompt-loading" style="display: none; text-align: center; padding: 20px;">
                <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 24px;">\u2699\uFE0F</div>
                <div class="muted" style="margin-top: 8px;">Generating your prompt with AI...</div>
            </div>
        </div>

        <!-- Mini Wiki Section -->
        <div id="wiki-section" class="card full-width" style="background: linear-gradient(135deg, color-mix(in srgb, var(--vscode-editor-background) 92%, #10b981 8%), color-mix(in srgb, var(--vscode-editor-background) 96%, #059669 4%));">
            <h3>\u{1F4DA} API Usage Guide</h3>
            <p class="muted" style="margin-bottom: 16px;">Complete reference for connecting to the Copilot API Gateway from various languages, with installation instructions and real-world examples.</p>
            
            <!-- Tab Navigation -->
            <div id="wiki-tabs" style="display: flex; gap: 4px; margin-bottom: 16px; flex-wrap: wrap;">
                <button class="wiki-tab active" data-tab="python" style="padding: 8px 16px; border: none; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; font-weight: 600;">\u{1F40D} Python</button>
                <button class="wiki-tab" data-tab="javascript" style="padding: 8px 16px; border: none; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; font-weight: 600;">\u{1F4DC} JavaScript</button>
                <button class="wiki-tab" data-tab="curl" style="padding: 8px 16px; border: none; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; font-weight: 600;">\u{1F527} cURL</button>
                <button class="wiki-tab" data-tab="mcp" style="padding: 8px 16px; border: none; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; font-weight: 600;">\u{1F50C} MCP Tools</button>
            </div>

            <!-- Tab Content -->
            <div id="wiki-content" style="background: var(--vscode-editor-background); border-radius: 0 8px 8px 8px; padding: 16px; max-height: 600px; overflow-y: auto;">
                
                <!-- Python Tab -->
                <div class="wiki-panel" data-panel="python">
                    <h4 style="margin-top: 0; color: var(--vscode-textLink-foreground);">\u{1F4E6} Installation</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;"># Install the OpenAI Python library
pip install openai

# Or with Anthropic support
pip install anthropic</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F680} Quick Start - OpenAI SDK</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">from openai import OpenAI

# Point to your local Copilot API Gateway
client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"  # API key not required unless configured
)

# Simple chat completion
response = client.chat.completions.create(
    model="gpt-4o",  # or "claude-3.5-sonnet", "o1-mini", etc.
    messages=[
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": "Explain quantum computing in simple terms"}
    ],
    temperature=0.7,
    max_tokens=500
)

print(response.choices[0].message.content)</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F4E1} Streaming Responses</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">from openai import OpenAI

client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"
)

# Stream the response in real-time
stream = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": "Write a haiku about coding"}],
    stream=True
)

for chunk in stream:
    if chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="", flush=True)
print()  # Newline at end</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F527} Function Calling (Tool Use)</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">from openai import OpenAI
import json

client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"
)

# Define tools/functions
tools = [
    {
        "type": "function",
        "function": {
            "name": "get_weather",
            "description": "Get current weather for a location",
            "parameters": {
                "type": "object",
                "properties": {
                    "location": {"type": "string", "description": "City name"},
                    "unit": {"type": "string", "enum": ["celsius", "fahrenheit"]}
                },
                "required": ["location"]
            }
        }
    }
]

response = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": "What's the weather in Tokyo?"}],
    tools=tools,
    tool_choice="auto"
)

# Check if model wants to call a function
if response.choices[0].message.tool_calls:
    tool_call = response.choices[0].message.tool_calls[0]
    print(f"Function: {tool_call.function.name}")
    print(f"Arguments: {tool_call.function.arguments}")</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F3AD} Using with Anthropic SDK</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">import anthropic

client = anthropic.Anthropic(
    base_url="http://${i.host}:${i.port}",
    api_key="not-needed"
)

message = client.messages.create(
    model="claude-3.5-sonnet",
    max_tokens=1024,
    system="You are a helpful coding assistant.",
    messages=[
        {"role": "user", "content": "Write a Python function to calculate fibonacci"}
    ]
)

print(message.content[0].text)</pre>
                </div>

                <!-- JavaScript Tab -->
                <div class="wiki-panel" data-panel="javascript" style="display: none;">
                    <h4 style="margin-top: 0; color: var(--vscode-textLink-foreground);">\u{1F4E6} Installation</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;"># Node.js - Install OpenAI SDK
npm install openai

# Or with yarn
yarn add openai</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F680} Quick Start - Node.js</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">import OpenAI from 'openai';

const openai = new OpenAI({
  baseURL: 'http://${i.host}:${i.port}/v1',
  apiKey: 'not-needed'
});

async function chat() {
  const completion = await openai.chat.completions.create({
    model: 'gpt-4o',
    messages: [
      { role: 'system', content: 'You are a helpful assistant.' },
      { role: 'user', content: 'Hello!' }
    ]
  });

  console.log(completion.choices[0].message.content);
}

chat();</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F4E1} Streaming Responses</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">import OpenAI from 'openai';

const openai = new OpenAI({
  baseURL: 'http://${i.host}:${i.port}/v1',
  apiKey: 'not-needed'
});

async function streamChat() {
  const stream = await openai.chat.completions.create({
    model: 'gpt-4o',
    messages: [{ role: 'user', content: 'Tell me a story' }],
    stream: true
  });

  for await (const chunk of stream) {
    const content = chunk.choices[0]?.delta?.content || '';
    process.stdout.write(content);
  }
}

streamChat();</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F310} Browser - Fetch API</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">async function chat(message) {
  const response = await fetch('http://${i.host}:${i.port}/v1/chat/completions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: 'gpt-4o',
      messages: [{ role: 'user', content: message }]
    })
  });

  const data = await response.json();
  return data.choices[0].message.content;
}

// Usage
const answer = await chat('What is the capital of France?');
console.log(answer);</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F527} Function Calling</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">import OpenAI from 'openai';

const openai = new OpenAI({
  baseURL: 'http://${i.host}:${i.port}/v1',
  apiKey: 'not-needed'
});

const tools = [{
  type: 'function',
  function: {
    name: 'search_database',
    description: 'Search for records in database',
    parameters: {
      type: 'object',
      properties: {
        query: { type: 'string', description: 'Search query' },
        limit: { type: 'number', description: 'Max results' }
      },
      required: ['query']
    }
  }
}];

const response = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [{ role: 'user', content: 'Find all users named John' }],
  tools: tools
});

console.log(response.choices[0].message.tool_calls);</pre>
                </div>

                <!-- cURL Tab -->
                <div class="wiki-panel" data-panel="curl" style="display: none;">
                    <h4 style="margin-top: 0; color: var(--vscode-textLink-foreground);">\u{1F680} Basic Chat Completion</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [
      {"role": "system", "content": "You are a helpful assistant."},
      {"role": "user", "content": "Hello!"}
    ]
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F4E1} Streaming Response</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -N \\
  -d '{
    "model": "gpt-4o",
    "stream": true,
    "messages": [{"role": "user", "content": "Write a poem about AI"}]
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F510} With API Key Authentication</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer your-secret-api-key" \\
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F4CB} List Available Models</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/models</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F3AD} Anthropic Endpoint (Claude)</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/messages \\
  -H "Content-Type: application/json" \\
  -H "x-api-key: not-needed" \\
  -H "anthropic-version: 2023-06-01" \\
  -d '{
    "model": "claude-3.5-sonnet",
    "max_tokens": 1024,
    "messages": [{"role": "user", "content": "Hello Claude!"}]
  }'</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F527} Function Calling</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "What time is it in London?"}],
    "tools": [{
      "type": "function",
      "function": {
        "name": "get_time",
        "description": "Get current time for a timezone",
        "parameters": {
          "type": "object",
          "properties": {
            "timezone": {"type": "string"}
          }
        }
      }
    }]
  }'</pre>
                </div>

                <!-- MCP Tools Tab -->
                <div class="wiki-panel" data-panel="mcp" style="display: none;">
                    <h4 style="margin-top: 0; color: var(--vscode-textLink-foreground);">\u2699\uFE0F Configure MCP Servers (settings.json)</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">// Add to your VS Code settings.json
"githubCopilotApi.mcp.servers": {
  // Filesystem access
  "filesystem": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/folder"]
  },
  // Git operations
  "git": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-git"]
  },
  // Remote MCP server via SSE
  "remote-tools": {
    "url": "http://your-server:8000/sse"
  }
}</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F5A5}\uFE0F Built-in VS Code Tools</h4>
                    <p class="muted" style="font-size: 11px; margin-bottom: 12px;">These tools are automatically available without any configuration:</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #10b981;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_read_file</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">Read the contents of any file in the workspace</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ "uri": "file:///path/to/file.ts" }</pre>
                        </div>
                        
                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #3b82f6;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_list_files</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">List files in a directory with optional glob pattern</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ "folder": "/src", "pattern": "**/*.ts" }</pre>
                        </div>
                        
                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #f59e0b;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_open_file</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">Open a file in VS Code editor, optionally at specific lines</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ "uri": "file:///path/to/file.ts", "startLine": 10, "endLine": 20 }</pre>
                        </div>
                        
                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #ef4444;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_get_diagnostics</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">Get current errors and warnings from the Problems panel</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ "maxResults": 50 }</pre>
                        </div>
                        
                        <div style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; border-left: 3px solid #8b5cf6;">
                            <code style="font-size: 12px; color: var(--vscode-textPreformat-foreground); font-weight: 600;">vscode_get_active_editor</code>
                            <div class="muted" style="font-size: 11px; margin-top: 4px;">Get content and cursor position of currently open file</div>
                            <pre style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 10px; margin-top: 8px;">{ } // No parameters needed</pre>
                        </div>
                    </div>

                    <h4 style="color: var(--vscode-textLink-foreground); margin-top: 20px;">\u{1F40D} Using VS Code Tools with Python</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">from openai import OpenAI

client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"
)

# Define the VS Code tools
vscode_tools = [
    {
        "type": "function",
        "function": {
            "name": "vscode_read_file",
            "description": "Read the contents of a file",
            "parameters": {
                "type": "object",
                "properties": {
                    "uri": {"type": "string", "description": "File URI (file:///path/to/file)"}
                },
                "required": ["uri"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "vscode_get_diagnostics",
            "description": "Get current errors and warnings",
            "parameters": {
                "type": "object",
                "properties": {
                    "maxResults": {"type": "number", "description": "Max results to return"}
                }
            }
        }
    }
]

response = client.chat.completions.create(
    model="gpt-4o",
    messages=[
        {"role": "user", "content": "Read package.json and tell me the version"}
    ],
    tools=vscode_tools,
    tool_choice="auto"
)

# The gateway will automatically execute the tool and return results
if response.choices[0].message.tool_calls:
    for tool_call in response.choices[0].message.tool_calls:
        print(f"Tool: {tool_call.function.name}")
        print(f"Args: {tool_call.function.arguments}")</pre>

                    <h4 style="color: var(--vscode-textLink-foreground);">\u{1F527} cURL Example with MCP Tools</h4>
                    <pre style="background: var(--vscode-textBlockQuote-background); padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 11px;">curl http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [
      {"role": "user", "content": "List all TypeScript files in /src and check for errors"}
    ],
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "vscode_list_files",
          "description": "List files matching pattern",
          "parameters": {
            "type": "object",
            "properties": {
              "folder": {"type": "string"},
              "pattern": {"type": "string"}
            }
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "vscode_get_diagnostics",
          "description": "Get errors and warnings",
          "parameters": {
            "type": "object",
            "properties": {
              "maxResults": {"type": "number"}
            }
          }
        }
      }
    ]
  }'</pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--vscode-sideBar-background); padding: 24px; border-radius: 12px; width: 80%; max-width: 800px; max-height: 80vh; display: flex; flex-direction: column; overflow: hidden; border: 1px solid var(--vscode-widget-border); box-shadow: 0 4px 24px rgba(0,0,0,0.25);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0;">Request Details</h3>
                <button class="secondary" id="btn-close-modal" style="width: auto; padding: 6px 12px;">Close</button>
            </div>
            <div style="overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 16px; padding-right: 8px;">
                <div style="position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; opacity: 0.8;">Request</h4>
                        <button class="secondary btn-copy-modal" data-target="modal-request" style="width: auto; padding: 2px 8px; font-size: 10px;">\u{1F4CB} Copy</button>
                    </div>
                    <pre id="modal-request" style="font-size: 11px; max-height: 300px; overflow: auto; margin: 0;"></pre>
                </div>
                <div style="position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; opacity: 0.8;">Response</h4>
                        <button class="secondary btn-copy-modal" data-target="modal-response" style="width: auto; padding: 2px 8px; font-size: 10px;">\u{1F4CB} Copy</button>
                    </div>
                    <pre id="modal-response" style="font-size: 11px; max-height: 300px; overflow: auto; margin: 0;"></pre>
                </div>
            </div>
        </div>
    </div>

    <script nonce="${n}">
        var vscode = acquireVsCodeApi();
        
        // Pagination state - declare at top to avoid hoisting issues
        var currentPage = 1;
        var pageSize = 10;
        var totalLogs = 0;
        var lastLogs = [];

        document.getElementById('btn-toggle-server').onclick = function() {
            var running = this.getAttribute('data-running') === 'true';
            vscode.postMessage({ type: running ? 'stopServer' : 'startServer' });
        };

        document.getElementById('btn-open-chat').onclick = function() {
            vscode.postMessage({ type: 'openChat' });
        };

        document.getElementById('btn-ask-copilot').onclick = function() {
            vscode.postMessage({ type: 'askCopilot' });
        };

        document.getElementById('btn-settings').onclick = function() {
            vscode.postMessage({ type: 'showControls' });
        };

        document.getElementById('toggle-http').onchange = function() {
            vscode.postMessage({ type: 'toggleHttp' });
        };

        document.getElementById('toggle-ws').onchange = function() {
            vscode.postMessage({ type: 'toggleWs' });
        };

        document.getElementById('toggle-logging').onchange = function() {
            vscode.postMessage({ type: 'toggleLogging' });
        };

        // Store the current API key for copy functionality
        var currentApiKey = '${i.apiKey||""}';

        document.getElementById('toggle-auth').onchange = function() {
            if (!this.checked) {
                // Disable auth by clearing API key
                currentApiKey = '';
                vscode.postMessage({ type: 'setApiKey', value: '' });
            } else {
                // Generate a random key when enabling
                var key = 'sk-' + Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
                document.getElementById('api-key-input').value = key;
                document.getElementById('api-key-input').type = 'text';
                currentApiKey = key;
                vscode.postMessage({ type: 'setApiKey', value: key });
            }
        };

        document.getElementById('btn-set-apikey').onclick = function() {
            var v = document.getElementById('api-key-input').value.trim();
            currentApiKey = v;
            vscode.postMessage({ type: 'setApiKey', value: v });
            if (v) {
                document.getElementById('toggle-auth').checked = true;
            }
        };

        document.getElementById('btn-generate-key').onclick = function() {
            var key = 'sk-' + Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
            document.getElementById('api-key-input').value = key;
            document.getElementById('api-key-input').type = 'text';
            currentApiKey = key;
            vscode.postMessage({ type: 'setApiKey', value: key });
            document.getElementById('toggle-auth').checked = true;
        };

        document.getElementById('btn-copy-key').onclick = function() {
            var input = document.getElementById('api-key-input');
            var keyToCopy = input.value.trim() || currentApiKey;
            if (keyToCopy) {
                navigator.clipboard.writeText(keyToCopy).then(function() {
                    var btn = document.getElementById('btn-copy-key');
                    btn.textContent = '\u2713';
                    setTimeout(function() { btn.textContent = '\u{1F4CB}'; }, 1500);
                });
            }
        };

        document.getElementById('btn-show-key').onclick = function() {
            var input = document.getElementById('api-key-input');
            var btn = document.getElementById('btn-show-key');
            if (input.type === 'password') {
                input.type = 'text';
                if (!input.value && currentApiKey) {
                    input.value = currentApiKey;
                }
                btn.textContent = '\u{1F648}';
            } else {
                input.type = 'password';
                btn.textContent = '\u{1F441}';
            }
        };

        document.getElementById('btn-set-ratelimit').onclick = function() {
            var v = document.getElementById('rate-limit-input').value;
            vscode.postMessage({ type: 'setRateLimit', value: Number(v) || 0 });
        };

        // Initialize on load
        // try { initCharts(); } catch (e) { console.error('Failed to init charts', e); }
        
        // Request initial data
        setTimeout(() => vscode.postMessage({ type: 'getAuditStats' }), 500);

        document.getElementById('btn-refresh-audit').onclick = function() {
            startCountdown(); // Reset timer
            vscode.postMessage({ type: 'getAuditStats' });
            vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
            this.textContent = '\u{1F504} Loading...';
            setTimeout(() => { this.textContent = '\u{1F504} Refresh'; }, 1000);
        };

        document.getElementById('btn-open-logs').onclick = function() {
            vscode.postMessage({ type: 'openLogFolder' });
        };

        // Modal Logic
        // Modal Logic
        const modal = document.getElementById('detail-modal');
        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scrolling
        }

        document.getElementById('btn-close-modal').onclick = closeModal;
        
        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        // Global function for View button
        window.showDetails = function(index) {
            if (!lastLogs || !lastLogs[index]) return;
            const log = lastLogs[index];
            
            const reqContent = {
                headers: log.requestHeaders,
                body: log.requestBody
            };
            const resContent = {
                headers: log.responseHeaders,
                body: log.responseBody,
                error: log.error
            };

            document.getElementById('modal-request').textContent = JSON.stringify(reqContent, null, 2);
            document.getElementById('modal-response').textContent = JSON.stringify(resContent, null, 2);
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Lock scrolling
        };

        // Copy content from modal
        document.querySelectorAll('.btn-copy-modal').forEach(btn => {
            btn.onclick = function() {
                const targetId = this.getAttribute('data-target');
                const content = document.getElementById(targetId).textContent;
                if (content) {
                    navigator.clipboard.writeText(content).then(() => {
                        const originalText = this.textContent;
                        this.textContent = '\u2713 Copied';
                        setTimeout(() => { this.textContent = originalText; }, 1500);
                    });
                }
            };
        });

        // Wiki tab switching
        document.querySelectorAll('.wiki-tab').forEach(function(tab) {
            tab.onclick = function() {
                var targetPanel = this.getAttribute('data-tab');
                // Update active tab styling
                document.querySelectorAll('.wiki-tab').forEach(function(t) {
                    t.classList.remove('active');
                    t.style.background = 'var(--vscode-button-secondaryBackground)';
                    t.style.color = 'var(--vscode-button-secondaryForeground)';
                });
                this.classList.add('active');
                this.style.background = 'var(--vscode-editor-background)';
                this.style.color = 'var(--vscode-foreground)';
                // Show corresponding panel
                document.querySelectorAll('.wiki-panel').forEach(function(p) {
                    p.style.display = 'none';
                });
                var panel = document.querySelector('.wiki-panel[data-panel="' + targetPanel + '"]');
                if (panel) panel.style.display = 'block';
            };
            // Initialize styling
            if (tab.classList.contains('active')) {
                tab.style.background = 'var(--vscode-editor-background)';
                tab.style.color = 'var(--vscode-foreground)';
            } else {
                tab.style.background = 'var(--vscode-button-secondaryBackground)';
                tab.style.color = 'var(--vscode-button-secondaryForeground)';
            }
        });

        // Prompt Generator handlers
        document.getElementById('btn-generate-prompt').onclick = function() {
            var projectType = document.getElementById('prompt-project-type').value;
            var techStack = document.getElementById('prompt-tech-stack').value;
            var goal = document.getElementById('prompt-goal').value;
            var complexity = document.getElementById('prompt-complexity').value;
            var context = document.getElementById('prompt-context').value;
            
            if (!context && !projectType && !techStack && !goal) {
                alert('Please select at least one option or describe what you want to build.');
                return;
            }
            
            document.getElementById('prompt-output-container').style.display = 'none';
            document.getElementById('prompt-loading').style.display = 'block';
            
            vscode.postMessage({
                type: 'generatePrompt',
                data: { projectType: projectType, techStack: techStack, goal: goal, complexity: complexity, context: context }
            });
        };
        
        document.getElementById('btn-enhance-prompt').onclick = function() {
            var context = document.getElementById('prompt-context').value;
            var currentOutput = document.getElementById('prompt-output').textContent;
            
            if (!context && !currentOutput) {
                alert('Please enter a description or generate a prompt first.');
                return;
            }
            
            document.getElementById('prompt-loading').style.display = 'block';
            
            vscode.postMessage({
                type: 'enhancePrompt',
                data: { context: context, existingPrompt: currentOutput }
            });
        };
        
        document.getElementById('btn-copy-prompt').onclick = function() {
            var content = document.getElementById('prompt-output').textContent;
            navigator.clipboard.writeText(content).then(function() {
                var btn = document.getElementById('btn-copy-prompt');
                btn.textContent = '\u2713 Copied';
                setTimeout(function() { btn.textContent = '\u{1F4CB} Copy'; }, 1500);
            });
        };
        
        document.getElementById('btn-export-prompt').onclick = function() {
            var content = document.getElementById('prompt-output').textContent;
            var blob = new Blob([content], { type: 'text/plain' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'generated-prompt.txt';
            a.click();
            URL.revokeObjectURL(url);
        };

        // Auto-refresh Countdown Logic
        let refreshTimer = 10;
        let refreshIntervalVal = null;
        const refreshSpan = document.getElementById('refresh-timer');
        
        function startCountdown() {
            if (refreshIntervalVal) clearInterval(refreshIntervalVal);
            
            refreshTimer = 10;
            updateTimerDisplay();
            
            refreshIntervalVal = setInterval(() => {
                refreshTimer--;
                updateTimerDisplay();
                
                if (refreshTimer <= 0) {
                    refreshTimer = 10;
                    vscode.postMessage({ type: 'getAuditStats' });
                    // Also refresh current page of logs
                    vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            if (refreshSpan) {
                refreshSpan.textContent = \`Refreshing in \${refreshTimer}s...\`;
            }
        }

        startCountdown();

        // IP Allowlist handlers
        document.getElementById('btn-add-ip').onclick = function() {
            var ip = document.getElementById('ip-allowlist-input').value.trim();
            if (ip) {
                vscode.postMessage({ type: 'addIpAllowlistEntry', value: ip });
                document.getElementById('ip-allowlist-input').value = '';
            }
        };

        document.querySelectorAll('.btn-remove-ip').forEach(function(btn) {
            btn.onclick = function() {
                var ip = btn.getAttribute('data-value');
                if (ip) {
                    vscode.postMessage({ type: 'removeIpAllowlistEntry', value: ip });
                }
            };
        });

        document.getElementById('btn-host-local').onclick = function() {
            vscode.postMessage({ type: 'hostLocal' });
        };

        document.getElementById('btn-host-lan').onclick = function() {
            vscode.postMessage({ type: 'hostLan' });
        };

        // Copy URL buttons for shareable LAN URLs
        document.querySelectorAll('.btn-copy-url').forEach(function(btn) {
            btn.onclick = function() {
                var url = btn.getAttribute('data-url');
                if (url) {
                    navigator.clipboard.writeText(url).then(function() {
                        var originalText = btn.textContent;
                        btn.textContent = '\u2713 Copied!';
                        setTimeout(function() { btn.textContent = originalText; }, 1500);
                    });
                }
            };
        });

        // MCP Toggle
        var mcpToggle = document.getElementById('mcp-enabled-toggle');
        if (mcpToggle) {
            mcpToggle.onchange = function() {
                vscode.postMessage({ type: 'toggleMcp', value: mcpToggle.checked });
            };
        }

        document.getElementById('btn-set-host').onclick = function() {
            var host = document.getElementById('custom-host').value;
            var port = document.getElementById('custom-port').value;
            if (host) vscode.postMessage({ type: 'setHost', value: host });
            if (port) vscode.postMessage({ type: 'setPort', value: Number(port) });
        };

        // btn-set-port removed - consolidated with btn-set-host Apply button

        document.getElementById('btn-set-timeout').onclick = function() {
            var val = document.getElementById('timeout-input').value;
            vscode.postMessage({ type: 'setRequestTimeout', value: Number(val) });
        };

        document.getElementById('btn-set-payload').onclick = function() {
            var val = document.getElementById('payload-input').value;
            vscode.postMessage({ type: 'setMaxPayloadSize', value: Number(val) });
        };

        document.getElementById('btn-set-connections').onclick = function() {
            var val = document.getElementById('connections-input').value;
            vscode.postMessage({ type: 'setMaxConnectionsPerIp', value: Number(val) });
        };

        document.getElementById('btn-set-concurrency').onclick = function() {
            var val = document.getElementById('concurrency-input').value;
            vscode.postMessage({ type: 'setMaxConcurrency', value: Number(val) });
        };

        // btn-set-model removed - element doesn't exist in current UI

        // Redaction pattern handlers
        document.getElementById('btn-add-redaction').onclick = function() {
            var name = document.getElementById('redaction-name-input').value.trim();
            var pattern = document.getElementById('redaction-pattern-input').value.trim();
            if (!name) {
                alert('Please enter a pattern name');
                return;
            }
            if (!pattern) {
                alert('Please enter a regex pattern');
                return;
            }
            try {
                new RegExp(pattern); // Validate
                vscode.postMessage({ type: 'addRedactionPattern', value: { name: name, pattern: pattern } });
                document.getElementById('redaction-name-input').value = '';
                document.getElementById('redaction-pattern-input').value = '';
            } catch (e) {
                alert('Invalid regex pattern: ' + e.message);
            }
        };

        document.getElementById('btn-test-redaction').onclick = function() {
            var pattern = document.getElementById('redaction-pattern-input').value.trim();
            if (!pattern) {
                alert('Enter a pattern first');
                return;
            }
            try {
                var regex = new RegExp(pattern, 'gi');
                var testStr = prompt('Enter test string to check redaction:', 'my-api-key-12345 or test@email.com');
                if (testStr) {
                    var result = testStr.replace(regex, '[REDACTED]');
                    alert('Result: ' + result);
                }
            } catch (e) {
                alert('Invalid regex pattern: ' + e.message);
            }
        };

        // Toggle redaction pattern on/off
        document.querySelectorAll('.toggle-redaction').forEach(function(toggle) {
            toggle.onchange = function() {
                var id = toggle.getAttribute('data-id');
                var enabled = toggle.checked;
                vscode.postMessage({ type: 'toggleRedactionPattern', value: { id: id, enabled: enabled } });
            };
        });

        // Remove redaction pattern buttons
        document.querySelectorAll('.btn-remove-redaction').forEach(function(btn) {
            btn.onclick = function() {
                var id = btn.getAttribute('data-id');
                if (id && confirm('Remove this pattern?')) {
                    vscode.postMessage({ type: 'removeRedactionPattern', value: id });
                }
            };
        });

        // Handle messages from extension
        window.addEventListener('message', function(event) {
            var message = event.data;
            console.log('[Dashboard] Received message:', message.type, message);
            if (message.type === 'historyData') {
                // Legacy support if needed
            } else if (message.type === 'statsData') {
                updateStats(message.data);
            } else if (message.type === 'auditStatsData') {
                updateCharts(message.data);
            } else if (message.type === 'auditLogData') {
                console.log('[Dashboard] Updating log table with', message.data?.length || 0, 'entries');
                updateLogTable(message.data, message.page, message.total, message.pageSize);
            } else if (message.type === 'liveLog') {
                appendLog(message.value);
            } else if (message.type === 'scrollTo') {
                // Scroll to a specific section
                var target = message.target;
                if (target === 'wiki') {
                    var wikiSection = document.getElementById('wiki-section');
                    if (wikiSection) {
                        wikiSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                } else if (target === 'prompt-generator') {
                    var promptSection = document.getElementById('prompt-generator-section');
                    if (promptSection) {
                        promptSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            } else if (message.type === 'promptResult') {
                document.getElementById('prompt-loading').style.display = 'none';
                document.getElementById('prompt-output-container').style.display = 'block';
                document.getElementById('prompt-output').textContent = message.data;
            } else if (message.type === 'promptError') {
                document.getElementById('prompt-loading').style.display = 'none';
                alert('Error generating prompt: ' + message.error);
            }
        });

        // Pagination state variables moved to top of script

        document.getElementById('btn-prev-page').onclick = function() {
            if (currentPage > 1) {
                currentPage--;
                vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                document.getElementById('audit-table-body').innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; opacity: 0.7;">Loading...</td></tr>';
            }
        };

        document.getElementById('btn-next-page').onclick = function() {
            if (currentPage * pageSize < totalLogs) {
                currentPage++;
                vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                document.getElementById('audit-table-body').innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; opacity: 0.7;">Loading...</td></tr>';
            }
        };

        function updateCharts(stats) {
            // Charts removed per user request
        }

        // lastLogs declared at top of script

        function formatNumber(num) {
            if (num === undefined || num === null) return '0';
            if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toString();
        }

// Live Log Tail Logic
        const logContainer = document.getElementById('live-log-container');
        const autoScroll = document.getElementById('log-autoscroll');
        const logStatus = document.getElementById('log-status-indicator');
        let linesCount = 0;

        function appendLog(log) {
            if (!logContainer) return;
            if (linesCount === 0) logContainer.innerHTML = '';
            
            const line = document.createElement('div');
            line.className = 'log-line';
            
            const isError = log.status >= 400;
            const statusClass = isError ? 'error' : 'success';
            
            const time = new Date(log.timestamp).toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            line.innerHTML = '<span class="log-time">[' + time + ']</span>' +
                             '<span class="log-method">' + (log.method || 'UNK') + '</span>' +
                             '<span class="log-path">' + (log.path || '/') + '</span>' +
                             '<span class="log-status ' + statusClass + '">' + (log.status || 0) + '</span>' +
                             '<span class="log-latency">' + (log.durationMs || 0) + 'ms</span>';

            
            logContainer.appendChild(line);
            linesCount++;
            
            // Pulse status indicator
            if (logStatus) {
                logStatus.classList.remove('active');
                void logStatus.offsetWidth; // Trigger reflow
                logStatus.classList.add('active');
            }
            
            // Limit shown lines to 100 for performance
            if (linesCount > 100) {
                logContainer.removeChild(logContainer.firstChild);
                linesCount--;
            }
            
            if (autoScroll && autoScroll.checked) {
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        document.getElementById('btn-clear-logs').onclick = function() {
            if (logContainer) {
                logContainer.innerHTML = '<div class="muted" style="text-align: center; padding-top: 120px; opacity: 0.5;">Waiting for API requests...</div>';
                linesCount = 0;
            }
        };

        function updateLogTable(logs, page, total, pSize) {
            lastLogs = logs;
            currentPage = page;
            totalLogs = total;
            pageSize = pSize || 10;

            const tbody = document.getElementById('audit-table-body');
            const pageInfo = document.getElementById('page-info');
            const btnPrev = document.getElementById('btn-prev-page');
            const btnNext = document.getElementById('btn-next-page');

            if (pageInfo) {
                const start = (page - 1) * pageSize + 1;
                const end = Math.min(page * pageSize, total);
                pageInfo.textContent = \`Showing \${total === 0 ? 0 : start}-\${end} of \${total}\`;
            }
            if (btnPrev) btnPrev.disabled = page <= 1;
            if (btnNext) btnNext.disabled = page * pageSize >= total;

            if (!tbody) return;
            
            // Clear checks to force refresh
            tbody.innerHTML = '';
            
            if (!logs || logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="padding: 24px; text-align: center; opacity: 0.6; font-style: italic;">No audit logs found.<br><span style="font-size: 11px; opacity: 0.8; margin-top: 4px; display: block;">Make a request to generate logs.</span></td></tr>';
                return;
            }

            tbody.innerHTML = logs.map((log, index) => {
                const date = new Date(log.timestamp);
                const time = date.toLocaleTimeString();
                const statusColor = log.status >= 400 ? 'var(--vscode-testing-iconFailed)' : (log.status >= 300 ? 'var(--vscode-charts-yellow)' : 'var(--vscode-testing-iconPassed)');
                
                return \`
                <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                    <td style="padding: 8px 12px; white-space: nowrap; opacity: 0.8;">\${time}</td>
                    <td style="padding: 8px 12px; white-space: nowrap;"><span style="padding: 2px 6px; border-radius: 4px; background: var(--vscode-textCodeBlock-background); font-size: 11px; font-family: var(--vscode-editor-font-family);">\${log.method || 'UNK'}</span></td>
                    <td style="padding: 8px 12px; word-break: break-all; font-family: var(--vscode-editor-font-family);">\${log.path || '/'}</td>
                    <td style="padding: 8px 12px; color: \${statusColor}; font-weight: 600;">\${log.status || 0}</td>
                    <td style="padding: 8px 12px;">\${log.durationMs || 0}ms</td>
                    <td style="padding: 8px 12px;" title="\${(log.tokensIn || 0) + (log.tokensOut || 0)} tokens">\${formatNumber ? formatNumber((log.tokensIn || 0) + (log.tokensOut || 0)) : 0}</td>
                    <td style="padding: 8px 12px;">
                        <button class="secondary btn-view-details" data-index="\${index}" style="padding: 2px 8px; font-size: 10px; width: auto;">\u{1F50D}</button>
                    </td>
                </tr>\`;
    }).join('');

    // Add event listeners for view buttons (CSP safe)
    document.querySelectorAll('.btn-view-details').forEach(btn => {
        btn.addEventListener('click', () => {
             const index = parseInt(btn.getAttribute('data-index') || '0');
             showDetails(index);
        });
    });
}

function updateStats(stats) {
    if (stats.totalRequests !== undefined) {
        document.getElementById('stat-requests').textContent = formatNumber(stats.totalRequests);
        document.getElementById('stat-requests').title = stats.totalRequests + ' requests';
    }
    if (stats.requestsPerMinute !== undefined) document.getElementById('stat-rpm').textContent = stats.requestsPerMinute;
    if (stats.avgLatencyMs !== undefined) document.getElementById('stat-latency').innerHTML = stats.avgLatencyMs + '<span style="font-size: 12px;">ms</span>';
    if (stats.totalTokensIn !== undefined) {
        document.getElementById('stat-tokens-in').textContent = formatNumber(stats.totalTokensIn);
        document.getElementById('stat-tokens-in').title = stats.totalTokensIn;
    }
    if (stats.totalTokensOut !== undefined) {
        document.getElementById('stat-tokens-out').textContent = formatNumber(stats.totalTokensOut);
        document.getElementById('stat-tokens-out').title = stats.totalTokensOut;
    }
    if (stats.errorRate !== undefined) document.getElementById('stat-errors').innerHTML = stats.errorRate + '<span style="font-size: 12px;">%</span>';
    if (stats.uptimeMs !== undefined) {
        var minutes = Math.floor(stats.uptimeMs / 60000);
        var hours = Math.floor(minutes / 60);
        var display = hours > 0 ? hours + 'h ' + (minutes % 60) + 'm' : minutes + 'm';
        document.getElementById('stat-uptime').textContent = display;
    }
    
    // Update MCP Status
    if (stats.mcp) {
        var mcpEnabled = stats.mcp.enabled;
        var statusBadge = document.getElementById('mcp-status-badge');
        if (statusBadge) {
            statusBadge.textContent = mcpEnabled ? (stats.mcp.servers.length > 0 ? 'Connected' : 'Ready') : 'Disabled';
            statusBadge.style.background = mcpEnabled ? (stats.mcp.servers.length > 0 ? 'var(--vscode-charts-green)' : 'var(--vscode-charts-blue)') : 'var(--vscode-charts-red)';
            statusBadge.style.color = 'white';
            statusBadge.style.padding = '2px 8px';
            statusBadge.style.borderRadius = '10px';
            statusBadge.style.fontSize = '10px';
        }

        var toggle = document.getElementById('mcp-enabled-toggle');
        if (toggle) toggle.checked = mcpEnabled;

        // Render Tools Grouped by Server
        var contentArea = document.getElementById('mcp-content-area');
        if (contentArea && stats.mcp.tools) {
            if (!mcpEnabled) {
                contentArea.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">MCP is disabled. Enable it in settings or toggle above.</div>';
                return;
            }

            if (stats.mcp.tools.length === 0) {
                 contentArea.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">No tools available. Connect a server or enable built-in tools.</div>';
                 return;
            }

            // Group tools
            var groups = {};
            stats.mcp.tools.forEach(function(tool) {
                if (!groups[tool.serverName]) { groups[tool.serverName] = []; }
                groups[tool.serverName].push(tool);
            });

            var html = '<div style="display: flex; flex-direction: column; gap: 24px;">';
            
            Object.keys(groups).sort().forEach(function(serverName) {
                var serverTools = groups[serverName];
                html += '<div>';
                html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">';
                html += '<span class="badge" style="background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); font-size: 10px;">' + serverName + '</span>';
                html += '<div style="height: 1px; flex: 1; background: var(--vscode-widget-border); opacity: 0.5;"></div>';
                html += '</div>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px;">';
                serverTools.forEach(function(t) {
                    html += '<div style="padding: 12px; border: 1px solid var(--vscode-widget-border); border-radius: 8px; background: rgba(0,0,0,0.02);">';
                    html += '<div style="font-family: var(--vscode-editor-font-family); font-weight: 600; font-size: 12px; margin-bottom: 4px; color: var(--vscode-textPreformat-foreground);">' + t.name + '</div>';
                    html += '<div style="font-size: 11px; opacity: 0.7; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;" title="' + (t.description || '') + '">' + (t.description || 'No description') + '</div>';
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            });

html += '</div>';

// Only update if changed to avoid flicker (hashing would be better but simple string comparison works for now)
// Actually, innerHTML rewrite is fine for this dashboard frequency
contentArea.innerHTML = html;
}
    }
}

// Auto-refresh stats every 5 seconds
setInterval(function () {
    vscode.postMessage({ type: 'getStats' });
}, 5000);

// Load audit data on page load
// Load audit data on page load
vscode.postMessage({ type: 'getAuditStats' });
vscode.postMessage({ type: 'getAuditLogs', value: { page: 1, pageSize: 10 } });
</script>
    </body>
    </html>`}async resolveWebviewView(e,r,n){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=await this._getSidebarHtml(e.webview),e.webview.onDidReceiveMessage(async o=>{switch(o.type){case"openDashboard":await t.createOrShow(this._extensionUri,this._gateway);break;case"startServer":this._gateway.startServer();break;case"stopServer":this._gateway.stopServer();break;case"openSwagger":{let i=await this._gateway.getStatus(),s=`http://${i.config.host}:${i.config.port}/docs`;Ke.env.openExternal(Ke.Uri.parse(s));break}case"openWiki":await t.createOrShow(this._extensionUri,this._gateway,"wiki");break;case"openPromptGenerator":await t.createOrShow(this._extensionUri,this._gateway,"prompt-generator");break}})}};function Yz(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function oV(t){let e=Se.window.createOutputChannel("GitHub Copilot API Server");t.subscriptions.push(e);let r=Se.window.createStatusBarItem(Se.StatusBarAlignment.Left,100);r.command="github-copilot-api-vscode.showServerControls",t.subscriptions.push(r);let n=new Ld(e,r,t);t.subscriptions.push(n);let o=new Bi(t.extensionUri,n);t.subscriptions.push(Se.window.registerWebviewViewProvider(Bi.viewType,o));let i=async()=>{let m=await n.getStatus();m.running?(m.activeRequests>0?(r.text=`$(sync~spin) Copilot API: ${m.activeRequests}`,r.tooltip=`Processing ${m.activeRequests} active request(s)`,r.backgroundColor=new Se.ThemeColor("statusBarItem.warningBackground")):(r.text="$(broadcast) Copilot API: ON",r.tooltip=`Listening on ${m.config.host}:${m.config.port}`,r.backgroundColor=void 0),r.show()):(r.text="$(circle-slash) Copilot API: OFF",r.tooltip="Copilot API server is stopped. Click to manage.",r.show())},s=!1;t.subscriptions.push(n.onDidChangeStatus(async()=>{await i();let m=await n.getStatus();m.running&&!s&&Se.workspace.getConfiguration("githubCopilotApi.server").get("showNotifications",!0)&&await Se.window.showInformationMessage(`GitHub Copilot API Server started at http://${m.config.host}:${m.config.port}`,"Open Dashboard")==="Open Dashboard"&&Se.commands.executeCommand("github-copilot-api-vscode.openDashboard"),s=m.running})),i();let a=Se.workspace.getConfiguration("githubCopilotApi.server"),c=a.get("enabled",!1),u=a.get("autoStart",!1);e.appendLine(`[DEBUG] Activation. Enabled: ${c}, AutoStart: ${u}`),(c||u)&&n.start().catch(m=>{e.appendLine(`[${new Date().toISOString()}] ERROR Failed to start API server: ${Po(m)}`),Se.window.showErrorMessage(`Failed to start Copilot API server: ${Po(m)}`)});let l=Se.commands.registerCommand("github-copilot-api-vscode.openCopilotChat",async()=>{await Fd()&&await Se.commands.executeCommand("workbench.action.chat.open")}),d=Se.commands.registerCommand("github-copilot-api-vscode.askCopilot",async m=>{if(!await Fd())return;let g=gb(m)??await Se.window.showInputBox({title:"Ask GitHub Copilot Chat",prompt:"What do you want to ask Copilot?",ignoreFocusOut:!0});g&&await Se.commands.executeCommand("workbench.action.chat.open",{query:g,isPartialQuery:!1})}),p=Se.commands.registerTextEditorCommand("github-copilot-api-vscode.askSelectionWithCopilot",async(m,g,v)=>{if(!await Fd())return;let x=m.selection;if(x.isEmpty){Se.window.showWarningMessage("Select some code before asking Copilot about it.");return}let w=gb(v)??await Se.window.showInputBox({title:"Ask Copilot About Selection",prompt:"Describe what you want to know about the selected code.",value:"Explain this code.",ignoreFocusOut:!0});w&&await Se.commands.executeCommand("workbench.action.chat.open",{query:w,isPartialQuery:!1,attachFiles:[{uri:m.document.uri,range:new Se.Range(x.start,x.end)}],blockOnResponse:!1})}),f=Se.commands.registerCommand("github-copilot-api-vscode.showServerControls",async()=>{await n.showControlPalette()}),h=Se.commands.registerCommand("github-copilot-api-vscode.openDashboard",()=>{Bi.createOrShow(t.extensionUri,n)});t.subscriptions.push(l,d,p,f,h)}function iV(){}0&&(module.exports={activate,deactivate});
