"use strict";var Xz=Object.create;var Cc=Object.defineProperty;var Yz=Object.getOwnPropertyDescriptor;var Qz=Object.getOwnPropertyNames;var eT=Object.getPrototypeOf,tT=Object.prototype.hasOwnProperty;var b=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),An=(t,e)=>{for(var r in e)Cc(t,r,{get:e[r],enumerable:!0})},hb=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Qz(e))!tT.call(t,o)&&o!==r&&Cc(t,o,{get:()=>e[o],enumerable:!(n=Yz(e,o))||n.enumerable});return t};var qe=(t,e,r)=>(r=t!=null?Xz(eT(t)):{},hb(e||!t||!t.__esModule?Cc(r,"default",{value:t,enumerable:!0}):r,t)),rT=t=>hb(Cc({},"__esModule",{value:!0}),t);var sa=b(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.regexpCode=he.getEsmExportName=he.getProperty=he.safeStringify=he.stringify=he.strConcat=he.addCodeArg=he.str=he._=he.nil=he._Code=he.Name=he.IDENTIFIER=he._CodeOrName=void 0;var oa=class{};he._CodeOrName=oa;he.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Gn=class extends oa{constructor(e){if(super(),!he.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};he.Name=Gn;var Gt=class extends oa{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof Gn&&(r[n.str]=(r[n.str]||0)+1),r),{})}};he._Code=Gt;he.nil=new Gt("");function Cx(t,...e){let r=[t[0]],n=0;for(;n<e.length;)Jh(r,e[n]),r.push(t[++n]);return new Gt(r)}he._=Cx;var Gh=new Gt("+");function jx(t,...e){let r=[ia(t[0])],n=0;for(;n<e.length;)r.push(Gh),Jh(r,e[n]),r.push(Gh,ia(t[++n]));return qj(r),new Gt(r)}he.str=jx;function Jh(t,e){e instanceof Gt?t.push(...e._items):e instanceof Gn?t.push(e):t.push(Vj(e))}he.addCodeArg=Jh;function qj(t){let e=1;for(;e<t.length-1;){if(t[e]===Gh){let r=Lj(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function Lj(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof Gn||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof Gn))return`"${t}${e.slice(1)}`}function Zj(t,e){return e.emptyStr()?t:t.emptyStr()?e:jx`${t}${e}`}he.strConcat=Zj;function Vj(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:ia(Array.isArray(t)?t.join(","):t)}function Fj(t){return new Gt(ia(t))}he.stringify=Fj;function ia(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}he.safeStringify=ia;function Bj(t){return typeof t=="string"&&he.IDENTIFIER.test(t)?new Gt(`.${t}`):Cx`[${t}]`}he.getProperty=Bj;function Hj(t){if(typeof t=="string"&&he.IDENTIFIER.test(t))return new Gt(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}he.getEsmExportName=Hj;function Wj(t){return new Gt(t.toString())}he.regexpCode=Wj});var Yh=b(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.ValueScope=Pt.ValueScopeName=Pt.Scope=Pt.varKinds=Pt.UsedValueState=void 0;var St=sa(),Kh=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Yu;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Yu||(Pt.UsedValueState=Yu={}));Pt.varKinds={const:new St.Name("const"),let:new St.Name("let"),var:new St.Name("var")};var Qu=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof St.Name?e:this.name(e)}name(e){return new St.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};Pt.Scope=Qu;var el=class extends St.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,St._)`.${new St.Name(r)}[${n}]`}};Pt.ValueScopeName=el;var Gj=(0,St._)`\n`,Xh=class extends Qu{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?Gj:St.nil}}get(){return this._scope}name(e){return new el(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:i}=o,s=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let l=a.get(s);if(l)return l}else a=this._values[i]=new Map;a.set(s,o);let c=this._scope[i]||(this._scope[i]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:i,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,St._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let i=St.nil;for(let s in e){let a=e[s];if(!a)continue;let c=n[s]=n[s]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,Yu.Started);let l=r(u);if(l){let d=this.opts.es5?Pt.varKinds.var:Pt.varKinds.const;i=(0,St._)`${i}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))i=(0,St._)`${i}${l}${this.opts._n}`;else throw new Kh(u);c.set(u,Yu.Completed)})}return i}};Pt.ValueScope=Xh});var re=b(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.or=ee.and=ee.not=ee.CodeGen=ee.operators=ee.varKinds=ee.ValueScopeName=ee.ValueScope=ee.Scope=ee.Name=ee.regexpCode=ee.stringify=ee.getProperty=ee.nil=ee.strConcat=ee.str=ee._=void 0;var le=sa(),ur=Yh(),gn=sa();Object.defineProperty(ee,"_",{enumerable:!0,get:function(){return gn._}});Object.defineProperty(ee,"str",{enumerable:!0,get:function(){return gn.str}});Object.defineProperty(ee,"strConcat",{enumerable:!0,get:function(){return gn.strConcat}});Object.defineProperty(ee,"nil",{enumerable:!0,get:function(){return gn.nil}});Object.defineProperty(ee,"getProperty",{enumerable:!0,get:function(){return gn.getProperty}});Object.defineProperty(ee,"stringify",{enumerable:!0,get:function(){return gn.stringify}});Object.defineProperty(ee,"regexpCode",{enumerable:!0,get:function(){return gn.regexpCode}});Object.defineProperty(ee,"Name",{enumerable:!0,get:function(){return gn.Name}});var ol=Yh();Object.defineProperty(ee,"Scope",{enumerable:!0,get:function(){return ol.Scope}});Object.defineProperty(ee,"ValueScope",{enumerable:!0,get:function(){return ol.ValueScope}});Object.defineProperty(ee,"ValueScopeName",{enumerable:!0,get:function(){return ol.ValueScopeName}});Object.defineProperty(ee,"varKinds",{enumerable:!0,get:function(){return ol.varKinds}});ee.operators={GT:new le._Code(">"),GTE:new le._Code(">="),LT:new le._Code("<"),LTE:new le._Code("<="),EQ:new le._Code("==="),NEQ:new le._Code("!=="),NOT:new le._Code("!"),OR:new le._Code("||"),AND:new le._Code("&&"),ADD:new le._Code("+")};var Zr=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},Qh=class extends Zr{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?ur.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=ti(this.rhs,e,r)),this}get names(){return this.rhs instanceof le._CodeOrName?this.rhs.names:{}}},tl=class extends Zr{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof le.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=ti(this.rhs,e,r),this}get names(){let e=this.lhs instanceof le.Name?{}:{...this.lhs.names};return nl(e,this.rhs)}},eg=class extends tl{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},tg=class extends Zr{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},rg=class extends Zr{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},ng=class extends Zr{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},og=class extends Zr{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=ti(this.code,e,r),this}get names(){return this.code instanceof le._CodeOrName?this.code.names:{}}},aa=class extends Zr{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let i=n[o];i.optimizeNames(e,r)||(Jj(e,i.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>Xn(e,r.names),{})}},Vr=class extends aa{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},ig=class extends aa{},ei=class extends Vr{};ei.kind="else";var Jn=class t extends Vr{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new ei(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(Nx(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=ti(this.condition,e,r),this}get names(){let e=super.names;return nl(e,this.condition),this.else&&Xn(e,this.else.names),e}};Jn.kind="if";var Kn=class extends Vr{};Kn.kind="for";var sg=class extends Kn{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=ti(this.iteration,e,r),this}get names(){return Xn(super.names,this.iteration.names)}},ag=class extends Kn{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?ur.varKinds.var:this.varKind,{name:n,from:o,to:i}=this;return`for(${r} ${n}=${o}; ${n}<${i}; ${n}++)`+super.render(e)}get names(){let e=nl(super.names,this.from);return nl(e,this.to)}},rl=class extends Kn{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=ti(this.iterable,e,r),this}get names(){return Xn(super.names,this.iterable.names)}},ca=class extends Vr{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};ca.kind="func";var ua=class extends aa{render(e){return"return "+super.render(e)}};ua.kind="return";var cg=class extends Vr{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&Xn(e,this.catch.names),this.finally&&Xn(e,this.finally.names),e}},la=class extends Vr{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};la.kind="catch";var da=class extends Vr{render(e){return"finally"+super.render(e)}};da.kind="finally";var ug=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new ur.Scope({parent:e}),this._nodes=[new ig]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let i=this._scope.toName(r);return n!==void 0&&o&&(this._constants[i.str]=n),this._leafNode(new Qh(e,i,n)),i}const(e,r,n){return this._def(ur.varKinds.const,e,r,n)}let(e,r,n){return this._def(ur.varKinds.let,e,r,n)}var(e,r,n){return this._def(ur.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new tl(e,r,n))}add(e,r){return this._leafNode(new eg(e,ee.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==le.nil&&this._leafNode(new og(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,le.addCodeArg)(r,o));return r.push("}"),new le._Code(r)}if(e,r,n){if(this._blockNode(new Jn(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new Jn(e))}else(){return this._elseNode(new ei)}endIf(){return this._endBlockNode(Jn,ei)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new sg(e),r)}forRange(e,r,n,o,i=this.opts.es5?ur.varKinds.var:ur.varKinds.let){let s=this._scope.toName(e);return this._for(new ag(i,s,r,n),()=>o(s))}forOf(e,r,n,o=ur.varKinds.const){let i=this._scope.toName(e);if(this.opts.es5){let s=r instanceof le.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,le._)`${s}.length`,a=>{this.var(i,(0,le._)`${s}[${a}]`),n(i)})}return this._for(new rl("of",o,i,r),()=>n(i))}forIn(e,r,n,o=this.opts.es5?ur.varKinds.var:ur.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,le._)`Object.keys(${r})`,n);let i=this._scope.toName(e);return this._for(new rl("in",o,i,r),()=>n(i))}endFor(){return this._endBlockNode(Kn)}label(e){return this._leafNode(new tg(e))}break(e){return this._leafNode(new rg(e))}return(e){let r=new ua;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(ua)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new cg;if(this._blockNode(o),this.code(e),r){let i=this.name("e");this._currNode=o.catch=new la(i),r(i)}return n&&(this._currNode=o.finally=new da,this.code(n)),this._endBlockNode(la,da)}throw(e){return this._leafNode(new ng(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=le.nil,n,o){return this._blockNode(new ca(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(ca)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof Jn))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};ee.CodeGen=ug;function Xn(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function nl(t,e){return e instanceof le._CodeOrName?Xn(t,e.names):t}function ti(t,e,r){if(t instanceof le.Name)return n(t);if(!o(t))return t;return new le._Code(t._items.reduce((i,s)=>(s instanceof le.Name&&(s=n(s)),s instanceof le._Code?i.push(...s._items):i.push(s),i),[]));function n(i){let s=r[i.str];return s===void 0||e[i.str]!==1?i:(delete e[i.str],s)}function o(i){return i instanceof le._Code&&i._items.some(s=>s instanceof le.Name&&e[s.str]===1&&r[s.str]!==void 0)}}function Jj(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function Nx(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,le._)`!${lg(t)}`}ee.not=Nx;var Kj=Rx(ee.operators.AND);function Xj(...t){return t.reduce(Kj)}ee.and=Xj;var Yj=Rx(ee.operators.OR);function Qj(...t){return t.reduce(Yj)}ee.or=Qj;function Rx(t){return(e,r)=>e===le.nil?r:r===le.nil?e:(0,le._)`${lg(e)} ${t} ${lg(r)}`}function lg(t){return t instanceof le.Name?t:(0,le._)`(${t})`}});var ge=b(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.checkStrictMode=ne.getErrorPath=ne.Type=ne.useFunc=ne.setEvaluated=ne.evaluatedPropsToName=ne.mergeEvaluated=ne.eachItem=ne.unescapeJsonPointer=ne.escapeJsonPointer=ne.escapeFragment=ne.unescapeFragment=ne.schemaRefOrVal=ne.schemaHasRulesButRef=ne.schemaHasRules=ne.checkUnknownRules=ne.alwaysValidSchema=ne.toHash=void 0;var Ee=re(),eN=sa();function tN(t){let e={};for(let r of t)e[r]=!0;return e}ne.toHash=tN;function rN(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(Dx(t,e),!Ux(e,t.self.RULES.all))}ne.alwaysValidSchema=rN;function Dx(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let i in e)o[i]||Zx(t,`unknown keyword: "${i}"`)}ne.checkUnknownRules=Dx;function Ux(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}ne.schemaHasRules=Ux;function nN(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}ne.schemaHasRulesButRef=nN;function oN({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,Ee._)`${r}`}return(0,Ee._)`${t}${e}${(0,Ee.getProperty)(n)}`}ne.schemaRefOrVal=oN;function iN(t){return qx(decodeURIComponent(t))}ne.unescapeFragment=iN;function sN(t){return encodeURIComponent(pg(t))}ne.escapeFragment=sN;function pg(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}ne.escapeJsonPointer=pg;function qx(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}ne.unescapeJsonPointer=qx;function aN(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}ne.eachItem=aN;function Ax({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,i,s,a)=>{let c=s===void 0?i:s instanceof Ee.Name?(i instanceof Ee.Name?t(o,i,s):e(o,i,s),s):i instanceof Ee.Name?(e(o,s,i),i):r(i,s);return a===Ee.Name&&!(c instanceof Ee.Name)?n(o,c):c}}ne.mergeEvaluated={props:Ax({mergeNames:(t,e,r)=>t.if((0,Ee._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,Ee._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,Ee._)`${r} || {}`).code((0,Ee._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,Ee._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,Ee._)`${r} || {}`),fg(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:Lx}),items:Ax({mergeNames:(t,e,r)=>t.if((0,Ee._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,Ee._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,Ee._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,Ee._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function Lx(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,Ee._)`{}`);return e!==void 0&&fg(t,r,e),r}ne.evaluatedPropsToName=Lx;function fg(t,e,r){Object.keys(r).forEach(n=>t.assign((0,Ee._)`${e}${(0,Ee.getProperty)(n)}`,!0))}ne.setEvaluated=fg;var Mx={};function cN(t,e){return t.scopeValue("func",{ref:e,code:Mx[e.code]||(Mx[e.code]=new eN._Code(e.code))})}ne.useFunc=cN;var dg;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(dg||(ne.Type=dg={}));function uN(t,e,r){if(t instanceof Ee.Name){let n=e===dg.Num;return r?n?(0,Ee._)`"[" + ${t} + "]"`:(0,Ee._)`"['" + ${t} + "']"`:n?(0,Ee._)`"/" + ${t}`:(0,Ee._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,Ee.getProperty)(t).toString():"/"+pg(t)}ne.getErrorPath=uN;function Zx(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}ne.checkStrictMode=Zx});var Fr=b(mg=>{"use strict";Object.defineProperty(mg,"__esModule",{value:!0});var st=re(),lN={data:new st.Name("data"),valCxt:new st.Name("valCxt"),instancePath:new st.Name("instancePath"),parentData:new st.Name("parentData"),parentDataProperty:new st.Name("parentDataProperty"),rootData:new st.Name("rootData"),dynamicAnchors:new st.Name("dynamicAnchors"),vErrors:new st.Name("vErrors"),errors:new st.Name("errors"),this:new st.Name("this"),self:new st.Name("self"),scope:new st.Name("scope"),json:new st.Name("json"),jsonPos:new st.Name("jsonPos"),jsonLen:new st.Name("jsonLen"),jsonPart:new st.Name("jsonPart")};mg.default=lN});var pa=b(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.extendErrors=at.resetErrorsCount=at.reportExtraError=at.reportError=at.keyword$DataError=at.keywordError=void 0;var fe=re(),il=ge(),vt=Fr();at.keywordError={message:({keyword:t})=>(0,fe.str)`must pass "${t}" keyword validation`};at.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,fe.str)`"${t}" keyword must be ${e} ($data)`:(0,fe.str)`"${t}" keyword is invalid ($data)`};function dN(t,e=at.keywordError,r,n){let{it:o}=t,{gen:i,compositeRule:s,allErrors:a}=o,c=Bx(t,e,r);n??(s||a)?Vx(i,c):Fx(o,(0,fe._)`[${c}]`)}at.reportError=dN;function pN(t,e=at.keywordError,r){let{it:n}=t,{gen:o,compositeRule:i,allErrors:s}=n,a=Bx(t,e,r);Vx(o,a),i||s||Fx(n,vt.default.vErrors)}at.reportExtraError=pN;function fN(t,e){t.assign(vt.default.errors,e),t.if((0,fe._)`${vt.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,fe._)`${vt.default.vErrors}.length`,e),()=>t.assign(vt.default.vErrors,null)))}at.resetErrorsCount=fN;function mN({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:i}){if(o===void 0)throw new Error("ajv implementation error");let s=t.name("err");t.forRange("i",o,vt.default.errors,a=>{t.const(s,(0,fe._)`${vt.default.vErrors}[${a}]`),t.if((0,fe._)`${s}.instancePath === undefined`,()=>t.assign((0,fe._)`${s}.instancePath`,(0,fe.strConcat)(vt.default.instancePath,i.errorPath))),t.assign((0,fe._)`${s}.schemaPath`,(0,fe.str)`${i.errSchemaPath}/${e}`),i.opts.verbose&&(t.assign((0,fe._)`${s}.schema`,r),t.assign((0,fe._)`${s}.data`,n))})}at.extendErrors=mN;function Vx(t,e){let r=t.const("err",e);t.if((0,fe._)`${vt.default.vErrors} === null`,()=>t.assign(vt.default.vErrors,(0,fe._)`[${r}]`),(0,fe._)`${vt.default.vErrors}.push(${r})`),t.code((0,fe._)`${vt.default.errors}++`)}function Fx(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,fe._)`new ${t.ValidationError}(${e})`):(r.assign((0,fe._)`${n}.errors`,e),r.return(!1))}var Yn={keyword:new fe.Name("keyword"),schemaPath:new fe.Name("schemaPath"),params:new fe.Name("params"),propertyName:new fe.Name("propertyName"),message:new fe.Name("message"),schema:new fe.Name("schema"),parentSchema:new fe.Name("parentSchema")};function Bx(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,fe._)`{}`:hN(t,e,r)}function hN(t,e,r={}){let{gen:n,it:o}=t,i=[gN(o,r),vN(t,r)];return yN(t,e,i),n.object(...i)}function gN({errorPath:t},{instancePath:e}){let r=e?(0,fe.str)`${t}${(0,il.getErrorPath)(e,il.Type.Str)}`:t;return[vt.default.instancePath,(0,fe.strConcat)(vt.default.instancePath,r)]}function vN({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,fe.str)`${e}/${t}`;return r&&(o=(0,fe.str)`${o}${(0,il.getErrorPath)(r,il.Type.Str)}`),[Yn.schemaPath,o]}function yN(t,{params:e,message:r},n){let{keyword:o,data:i,schemaValue:s,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([Yn.keyword,o],[Yn.params,typeof e=="function"?e(t):e||(0,fe._)`{}`]),c.messages&&n.push([Yn.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([Yn.schema,s],[Yn.parentSchema,(0,fe._)`${l}${d}`],[vt.default.data,i]),u&&n.push([Yn.propertyName,u])}});var Wx=b(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.boolOrEmptySchema=ri.topBoolOrEmptySchema=void 0;var _N=pa(),bN=re(),$N=Fr(),wN={message:"boolean schema is false"};function xN(t){let{gen:e,schema:r,validateName:n}=t;r===!1?Hx(t,!1):typeof r=="object"&&r.$async===!0?e.return($N.default.data):(e.assign((0,bN._)`${n}.errors`,null),e.return(!0))}ri.topBoolOrEmptySchema=xN;function kN(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),Hx(t)):r.var(e,!0)}ri.boolOrEmptySchema=kN;function Hx(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,_N.reportError)(o,wN,void 0,e)}});var hg=b(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.getRules=ni.isJSONType=void 0;var SN=["string","number","integer","boolean","null","object","array"],PN=new Set(SN);function IN(t){return typeof t=="string"&&PN.has(t)}ni.isJSONType=IN;function EN(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}ni.getRules=EN});var gg=b(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.shouldUseRule=vn.shouldUseGroup=vn.schemaHasRulesForType=void 0;function zN({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&Gx(t,n)}vn.schemaHasRulesForType=zN;function Gx(t,e){return e.rules.some(r=>Jx(t,r))}vn.shouldUseGroup=Gx;function Jx(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}vn.shouldUseRule=Jx});var fa=b(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.reportTypeError=ct.checkDataTypes=ct.checkDataType=ct.coerceAndCheckDataType=ct.getJSONTypes=ct.getSchemaTypes=ct.DataType=void 0;var TN=hg(),ON=gg(),CN=pa(),G=re(),Kx=ge(),oi;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(oi||(ct.DataType=oi={}));function jN(t){let e=Xx(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}ct.getSchemaTypes=jN;function Xx(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(TN.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}ct.getJSONTypes=Xx;function NN(t,e){let{gen:r,data:n,opts:o}=t,i=RN(e,o.coerceTypes),s=e.length>0&&!(i.length===0&&e.length===1&&(0,ON.schemaHasRulesForType)(t,e[0]));if(s){let a=yg(e,n,o.strictNumbers,oi.Wrong);r.if(a,()=>{i.length?AN(t,e,i):_g(t)})}return s}ct.coerceAndCheckDataType=NN;var Yx=new Set(["string","number","integer","boolean","null"]);function RN(t,e){return e?t.filter(r=>Yx.has(r)||e==="array"&&r==="array"):[]}function AN(t,e,r){let{gen:n,data:o,opts:i}=t,s=n.let("dataType",(0,G._)`typeof ${o}`),a=n.let("coerced",(0,G._)`undefined`);i.coerceTypes==="array"&&n.if((0,G._)`${s} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,G._)`${o}[0]`).assign(s,(0,G._)`typeof ${o}`).if(yg(e,o,i.strictNumbers),()=>n.assign(a,o))),n.if((0,G._)`${a} !== undefined`);for(let u of r)(Yx.has(u)||u==="array"&&i.coerceTypes==="array")&&c(u);n.else(),_g(t),n.endIf(),n.if((0,G._)`${a} !== undefined`,()=>{n.assign(o,a),MN(t,a)});function c(u){switch(u){case"string":n.elseIf((0,G._)`${s} == "number" || ${s} == "boolean"`).assign(a,(0,G._)`"" + ${o}`).elseIf((0,G._)`${o} === null`).assign(a,(0,G._)`""`);return;case"number":n.elseIf((0,G._)`${s} == "boolean" || ${o} === null
              || (${s} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,G._)`+${o}`);return;case"integer":n.elseIf((0,G._)`${s} === "boolean" || ${o} === null
              || (${s} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,G._)`+${o}`);return;case"boolean":n.elseIf((0,G._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,G._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,G._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,G._)`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${o} === null`).assign(a,(0,G._)`[${o}]`)}}}function MN({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,G._)`${e} !== undefined`,()=>t.assign((0,G._)`${e}[${r}]`,n))}function vg(t,e,r,n=oi.Correct){let o=n===oi.Correct?G.operators.EQ:G.operators.NEQ,i;switch(t){case"null":return(0,G._)`${e} ${o} null`;case"array":i=(0,G._)`Array.isArray(${e})`;break;case"object":i=(0,G._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":i=s((0,G._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":i=s();break;default:return(0,G._)`typeof ${e} ${o} ${t}`}return n===oi.Correct?i:(0,G.not)(i);function s(a=G.nil){return(0,G.and)((0,G._)`typeof ${e} == "number"`,a,r?(0,G._)`isFinite(${e})`:G.nil)}}ct.checkDataType=vg;function yg(t,e,r,n){if(t.length===1)return vg(t[0],e,r,n);let o,i=(0,Kx.toHash)(t);if(i.array&&i.object){let s=(0,G._)`typeof ${e} != "object"`;o=i.null?s:(0,G._)`!${e} || ${s}`,delete i.null,delete i.array,delete i.object}else o=G.nil;i.number&&delete i.integer;for(let s in i)o=(0,G.and)(o,vg(s,e,r,n));return o}ct.checkDataTypes=yg;var DN={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,G._)`{type: ${t}}`:(0,G._)`{type: ${e}}`};function _g(t){let e=UN(t);(0,CN.reportError)(e,DN)}ct.reportTypeError=_g;function UN(t){let{gen:e,data:r,schema:n}=t,o=(0,Kx.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var e0=b(sl=>{"use strict";Object.defineProperty(sl,"__esModule",{value:!0});sl.assignDefaults=void 0;var ii=re(),qN=ge();function LN(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)Qx(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,i)=>Qx(t,i,o.default))}sl.assignDefaults=LN;function Qx(t,e,r){let{gen:n,compositeRule:o,data:i,opts:s}=t;if(r===void 0)return;let a=(0,ii._)`${i}${(0,ii.getProperty)(e)}`;if(o){(0,qN.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,ii._)`${a} === undefined`;s.useDefaults==="empty"&&(c=(0,ii._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,ii._)`${a} = ${(0,ii.stringify)(r)}`)}});var Jt=b(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.validateUnion=xe.validateArray=xe.usePattern=xe.callValidateCode=xe.schemaProperties=xe.allSchemaProperties=xe.noPropertyInData=xe.propertyInData=xe.isOwnProperty=xe.hasPropFunc=xe.reportMissingProp=xe.checkMissingProp=xe.checkReportMissingProp=void 0;var je=re(),bg=ge(),yn=Fr(),ZN=ge();function VN(t,e){let{gen:r,data:n,it:o}=t;r.if(wg(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,je._)`${e}`},!0),t.error()})}xe.checkReportMissingProp=VN;function FN({gen:t,data:e,it:{opts:r}},n,o){return(0,je.or)(...n.map(i=>(0,je.and)(wg(t,e,i,r.ownProperties),(0,je._)`${o} = ${i}`)))}xe.checkMissingProp=FN;function BN(t,e){t.setParams({missingProperty:e},!0),t.error()}xe.reportMissingProp=BN;function t0(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,je._)`Object.prototype.hasOwnProperty`})}xe.hasPropFunc=t0;function $g(t,e,r){return(0,je._)`${t0(t)}.call(${e}, ${r})`}xe.isOwnProperty=$g;function HN(t,e,r,n){let o=(0,je._)`${e}${(0,je.getProperty)(r)} !== undefined`;return n?(0,je._)`${o} && ${$g(t,e,r)}`:o}xe.propertyInData=HN;function wg(t,e,r,n){let o=(0,je._)`${e}${(0,je.getProperty)(r)} === undefined`;return n?(0,je.or)(o,(0,je.not)($g(t,e,r))):o}xe.noPropertyInData=wg;function r0(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}xe.allSchemaProperties=r0;function WN(t,e){return r0(e).filter(r=>!(0,bg.alwaysValidSchema)(t,e[r]))}xe.schemaProperties=WN;function GN({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:i},it:s},a,c,u){let l=u?(0,je._)`${t}, ${e}, ${n}${o}`:e,d=[[yn.default.instancePath,(0,je.strConcat)(yn.default.instancePath,i)],[yn.default.parentData,s.parentData],[yn.default.parentDataProperty,s.parentDataProperty],[yn.default.rootData,yn.default.rootData]];s.opts.dynamicRef&&d.push([yn.default.dynamicAnchors,yn.default.dynamicAnchors]);let p=(0,je._)`${l}, ${r.object(...d)}`;return c!==je.nil?(0,je._)`${a}.call(${c}, ${p})`:(0,je._)`${a}(${p})`}xe.callValidateCode=GN;var JN=(0,je._)`new RegExp`;function KN({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,i=o(r,n);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,je._)`${o.code==="new RegExp"?JN:(0,ZN.useFunc)(t,o)}(${r}, ${n})`})}xe.usePattern=KN;function XN(t){let{gen:e,data:r,keyword:n,it:o}=t,i=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(i,!0),s(()=>e.break()),i;function s(a){let c=e.const("len",(0,je._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:bg.Type.Num},i),e.if((0,je.not)(i),a)})}}xe.validateArray=XN;function YN(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,bg.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let s=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(s,(0,je._)`${s} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,je.not)(s))})),t.result(s,()=>t.reset(),()=>t.error(!0))}xe.validateUnion=YN});var i0=b(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.validateKeywordUsage=kr.validSchemaType=kr.funcKeywordCode=kr.macroKeywordCode=void 0;var yt=re(),Qn=Fr(),QN=Jt(),eR=pa();function tR(t,e){let{gen:r,keyword:n,schema:o,parentSchema:i,it:s}=t,a=e.macro.call(s.self,o,i,s),c=o0(r,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:yt.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}kr.macroKeywordCode=tR;function rR(t,e){var r;let{gen:n,keyword:o,schema:i,parentSchema:s,$data:a,it:c}=t;oR(c,e);let u=!a&&e.compile?e.compile.call(c.self,i,s,c):e.validate,l=o0(n,o,u),d=n.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)m(),e.modifying&&n0(t),g(()=>t.error());else{let v=e.async?f():h();e.modifying&&n0(t),g(()=>nR(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>m((0,yt._)`await `),$=>n.assign(d,!1).if((0,yt._)`${$} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,yt._)`${$}.errors`),()=>n.throw($))),v}function h(){let v=(0,yt._)`${l}.errors`;return n.assign(v,null),m(yt.nil),v}function m(v=e.async?(0,yt._)`await `:yt.nil){let $=c.opts.passContext?Qn.default.this:Qn.default.self,x=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,yt._)`${v}${(0,QN.callValidateCode)(t,l,$,x)}`,e.modifying)}function g(v){var $;n.if((0,yt.not)(($=e.valid)!==null&&$!==void 0?$:d),v)}}kr.funcKeywordCode=rR;function n0(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,yt._)`${n.parentData}[${n.parentDataProperty}]`))}function nR(t,e){let{gen:r}=t;r.if((0,yt._)`Array.isArray(${e})`,()=>{r.assign(Qn.default.vErrors,(0,yt._)`${Qn.default.vErrors} === null ? ${e} : ${Qn.default.vErrors}.concat(${e})`).assign(Qn.default.errors,(0,yt._)`${Qn.default.vErrors}.length`),(0,eR.extendErrors)(t)},()=>t.error())}function oR({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function o0(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,yt.stringify)(r)})}function iR(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}kr.validSchemaType=iR;function sR({schema:t,opts:e,self:r,errSchemaPath:n},o,i){if(Array.isArray(o.keyword)?!o.keyword.includes(i):o.keyword!==i)throw new Error("ajv implementation error");let s=o.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${i}: ${s.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[i])){let c=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}kr.validateKeywordUsage=sR});var a0=b(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.extendSubschemaMode=_n.extendSubschemaData=_n.getSubschema=void 0;var Sr=re(),s0=ge();function aR(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:i,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,Sr._)`${t.schemaPath}${(0,Sr.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,Sr._)`${t.schemaPath}${(0,Sr.getProperty)(e)}${(0,Sr.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,s0.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||i===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:s,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}_n.getSubschema=aR;function cR(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:i,propertyName:s}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,p=a.let("data",(0,Sr._)`${e.data}${(0,Sr.getProperty)(r)}`,!0);c(p),t.errorPath=(0,Sr.str)`${u}${(0,s0.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,Sr._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof Sr.Name?o:a.let("data",o,!0);c(u),s!==void 0&&(t.propertyName=s)}i&&(t.dataTypes=i);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}_n.extendSubschemaData=cR;function uR(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:i}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),i!==void 0&&(t.allErrors=i),t.jtdDiscriminator=e,t.jtdMetadata=r}_n.extendSubschemaMode=uR});var ma=b((CK,c0)=>{"use strict";c0.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,i;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,i[o]))return!1;for(o=n;o--!==0;){var s=i[o];if(!t(e[s],r[s]))return!1}return!0}return e!==e&&r!==r}});var l0=b((jK,u0)=>{"use strict";var bn=u0.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};al(e,n,o,t,"",t)};bn.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};bn.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};bn.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};bn.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function al(t,e,r,n,o,i,s,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,i,s,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in bn.arrayKeywords)for(var p=0;p<d.length;p++)al(t,e,r,d[p],o+"/"+l+"/"+p,i,o,l,n,p)}else if(l in bn.propsKeywords){if(d&&typeof d=="object")for(var f in d)al(t,e,r,d[f],o+"/"+l+"/"+lR(f),i,o,l,n,f)}else(l in bn.keywords||t.allKeys&&!(l in bn.skipKeywords))&&al(t,e,r,d,o+"/"+l,i,o,l,n)}r(n,o,i,s,a,c,u)}}function lR(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var ha=b(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.getSchemaRefs=It.resolveUrl=It.normalizeId=It._getFullPath=It.getFullPath=It.inlineRef=void 0;var dR=ge(),pR=ma(),fR=l0(),mR=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function hR(t,e=!0){return typeof t=="boolean"?!0:e===!0?!xg(t):e?d0(t)<=e:!1}It.inlineRef=hR;var gR=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function xg(t){for(let e in t){if(gR.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(xg)||typeof r=="object"&&xg(r))return!0}return!1}function d0(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!mR.has(r)&&(typeof t[r]=="object"&&(0,dR.eachItem)(t[r],n=>e+=d0(n)),e===1/0))return 1/0}return e}function p0(t,e="",r){r!==!1&&(e=si(e));let n=t.parse(e);return f0(t,n)}It.getFullPath=p0;function f0(t,e){return t.serialize(e).split("#")[0]+"#"}It._getFullPath=f0;var vR=/#\/?$/;function si(t){return t?t.replace(vR,""):""}It.normalizeId=si;function yR(t,e,r){return r=si(r),t.resolve(e,r)}It.resolveUrl=yR;var _R=/^[a-z_][-a-z0-9._]*$/i;function bR(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=si(t[r]||e),i={"":o},s=p0(n,o,!1),a={},c=new Set;return fR(t,{allKeys:!0},(d,p,f,h)=>{if(h===void 0)return;let m=s+p,g=i[h];typeof d[r]=="string"&&(g=v.call(this,d[r])),$.call(this,d.$anchor),$.call(this,d.$dynamicAnchor),i[p]=g;function v(x){let I=this.opts.uriResolver.resolve;if(x=si(g?I(g,x):x),c.has(x))throw l(x);c.add(x);let k=this.refs[x];return typeof k=="string"&&(k=this.refs[k]),typeof k=="object"?u(d,k.schema,x):x!==si(m)&&(x[0]==="#"?(u(d,a[x],x),a[x]=d):this.refs[x]=m),x}function $(x){if(typeof x=="string"){if(!_R.test(x))throw new Error(`invalid anchor "${x}"`);v.call(this,`#${x}`)}}}),a;function u(d,p,f){if(p!==void 0&&!pR(d,p))throw l(f)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}It.getSchemaRefs=bR});var ya=b($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.getData=$n.KeywordCxt=$n.validateFunctionCode=void 0;var y0=Wx(),m0=fa(),Sg=gg(),cl=fa(),$R=e0(),va=i0(),kg=a0(),R=re(),F=Fr(),wR=ha(),Br=ge(),ga=pa();function xR(t){if($0(t)&&(w0(t),b0(t))){PR(t);return}_0(t,()=>(0,y0.topBoolOrEmptySchema)(t))}$n.validateFunctionCode=xR;function _0({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},i){o.code.es5?t.func(e,(0,R._)`${F.default.data}, ${F.default.valCxt}`,n.$async,()=>{t.code((0,R._)`"use strict"; ${h0(r,o)}`),SR(t,o),t.code(i)}):t.func(e,(0,R._)`${F.default.data}, ${kR(o)}`,n.$async,()=>t.code(h0(r,o)).code(i))}function kR(t){return(0,R._)`{${F.default.instancePath}="", ${F.default.parentData}, ${F.default.parentDataProperty}, ${F.default.rootData}=${F.default.data}${t.dynamicRef?(0,R._)`, ${F.default.dynamicAnchors}={}`:R.nil}}={}`}function SR(t,e){t.if(F.default.valCxt,()=>{t.var(F.default.instancePath,(0,R._)`${F.default.valCxt}.${F.default.instancePath}`),t.var(F.default.parentData,(0,R._)`${F.default.valCxt}.${F.default.parentData}`),t.var(F.default.parentDataProperty,(0,R._)`${F.default.valCxt}.${F.default.parentDataProperty}`),t.var(F.default.rootData,(0,R._)`${F.default.valCxt}.${F.default.rootData}`),e.dynamicRef&&t.var(F.default.dynamicAnchors,(0,R._)`${F.default.valCxt}.${F.default.dynamicAnchors}`)},()=>{t.var(F.default.instancePath,(0,R._)`""`),t.var(F.default.parentData,(0,R._)`undefined`),t.var(F.default.parentDataProperty,(0,R._)`undefined`),t.var(F.default.rootData,F.default.data),e.dynamicRef&&t.var(F.default.dynamicAnchors,(0,R._)`{}`)})}function PR(t){let{schema:e,opts:r,gen:n}=t;_0(t,()=>{r.$comment&&e.$comment&&k0(t),OR(t),n.let(F.default.vErrors,null),n.let(F.default.errors,0),r.unevaluated&&IR(t),x0(t),NR(t)})}function IR(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,R._)`${r}.evaluated`),e.if((0,R._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,R._)`${t.evaluated}.props`,(0,R._)`undefined`)),e.if((0,R._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,R._)`${t.evaluated}.items`,(0,R._)`undefined`))}function h0(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,R._)`/*# sourceURL=${r} */`:R.nil}function ER(t,e){if($0(t)&&(w0(t),b0(t))){zR(t,e);return}(0,y0.boolOrEmptySchema)(t,e)}function b0({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function $0(t){return typeof t.schema!="boolean"}function zR(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&k0(t),CR(t),jR(t);let i=n.const("_errs",F.default.errors);x0(t,i),n.var(e,(0,R._)`${i} === ${F.default.errors}`)}function w0(t){(0,Br.checkUnknownRules)(t),TR(t)}function x0(t,e){if(t.opts.jtd)return g0(t,[],!1,e);let r=(0,m0.getSchemaTypes)(t.schema),n=(0,m0.coerceAndCheckDataType)(t,r);g0(t,r,!n,e)}function TR(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Br.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function OR(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Br.checkStrictMode)(t,"default is ignored in the schema root")}function CR(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,wR.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function jR(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function k0({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let i=r.$comment;if(o.$comment===!0)t.code((0,R._)`${F.default.self}.logger.log(${i})`);else if(typeof o.$comment=="function"){let s=(0,R.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,R._)`${F.default.self}.opts.$comment(${i}, ${s}, ${a}.schema)`)}}function NR(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:i}=t;r.$async?e.if((0,R._)`${F.default.errors} === 0`,()=>e.return(F.default.data),()=>e.throw((0,R._)`new ${o}(${F.default.vErrors})`)):(e.assign((0,R._)`${n}.errors`,F.default.vErrors),i.unevaluated&&RR(t),e.return((0,R._)`${F.default.errors} === 0`))}function RR({gen:t,evaluated:e,props:r,items:n}){r instanceof R.Name&&t.assign((0,R._)`${e}.props`,r),n instanceof R.Name&&t.assign((0,R._)`${e}.items`,n)}function g0(t,e,r,n){let{gen:o,schema:i,data:s,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(i.$ref&&(c.ignoreKeywordsWithRef||!(0,Br.schemaHasRulesButRef)(i,l))){o.block(()=>P0(t,"$ref",l.all.$ref.definition));return}c.jtd||AR(t,e),o.block(()=>{for(let p of l.rules)d(p);d(l.post)});function d(p){(0,Sg.shouldUseGroup)(i,p)&&(p.type?(o.if((0,cl.checkDataType)(p.type,s,c.strictNumbers)),v0(t,p),e.length===1&&e[0]===p.type&&r&&(o.else(),(0,cl.reportTypeError)(t)),o.endIf()):v0(t,p),a||o.if((0,R._)`${F.default.errors} === ${n||0}`))}}function v0(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,$R.assignDefaults)(t,e.type),r.block(()=>{for(let i of e.rules)(0,Sg.shouldUseRule)(n,i)&&P0(t,i.keyword,i.definition,e.type)})}function AR(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(MR(t,e),t.opts.allowUnionTypes||DR(t,e),UR(t,t.dataTypes))}function MR(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{S0(t.dataTypes,r)||Pg(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),LR(t,e)}}function DR(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&Pg(t,"use allowUnionTypes to allow union type keyword")}function UR(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,Sg.shouldUseRule)(t.schema,o)){let{type:i}=o.definition;i.length&&!i.some(s=>qR(e,s))&&Pg(t,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function qR(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function S0(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function LR(t,e){let r=[];for(let n of t.dataTypes)S0(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function Pg(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Br.checkStrictMode)(t,e,t.opts.strictTypes)}var ul=class{constructor(e,r,n){if((0,va.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Br.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",I0(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,va.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",F.default.errors))}result(e,r,n){this.failResult((0,R.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,R.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,R._)`${r} !== undefined && (${(0,R.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?ga.reportExtraError:ga.reportError)(this,this.def.error,r)}$dataError(){(0,ga.reportError)(this,this.def.$dataError||ga.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,ga.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=R.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=R.nil,r=R.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:i,def:s}=this;n.if((0,R.or)((0,R._)`${o} === undefined`,r)),e!==R.nil&&n.assign(e,!0),(i.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==R.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:i}=this;return(0,R.or)(s(),a());function s(){if(n.length){if(!(r instanceof R.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,R._)`${(0,cl.checkDataTypes)(c,r,i.opts.strictNumbers,cl.DataType.Wrong)}`}return R.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,R._)`!${c}(${r})`}return R.nil}}subschema(e,r){let n=(0,kg.getSubschema)(this.it,e);(0,kg.extendSubschemaData)(n,this.it,e),(0,kg.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return ER(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Br.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Br.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,R.Name)),!0}};$n.KeywordCxt=ul;function P0(t,e,r,n){let o=new ul(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,va.funcKeywordCode)(o,r):"macro"in r?(0,va.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,va.funcKeywordCode)(o,r)}var ZR=/^\/(?:[^~]|~0|~1)*$/,VR=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function I0(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,i;if(t==="")return F.default.rootData;if(t[0]==="/"){if(!ZR.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,i=F.default.rootData}else{let u=VR.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(i=r[e-l],!o)return i}let s=i,a=o.split("/");for(let u of a)u&&(i=(0,R._)`${i}${(0,R.getProperty)((0,Br.unescapeJsonPointer)(u))}`,s=(0,R._)`${s} && ${i}`);return s;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}$n.getData=I0});var ll=b(Eg=>{"use strict";Object.defineProperty(Eg,"__esModule",{value:!0});var Ig=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};Eg.default=Ig});var _a=b(Og=>{"use strict";Object.defineProperty(Og,"__esModule",{value:!0});var zg=ha(),Tg=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,zg.resolveUrl)(e,r,n),this.missingSchema=(0,zg.normalizeId)((0,zg.getFullPath)(e,this.missingRef))}};Og.default=Tg});var pl=b(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.resolveSchema=Kt.getCompilingSchema=Kt.resolveRef=Kt.compileSchema=Kt.SchemaEnv=void 0;var lr=re(),FR=ll(),eo=Fr(),dr=ha(),E0=ge(),BR=ya(),ai=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,dr.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};Kt.SchemaEnv=ai;function jg(t){let e=z0.call(this,t);if(e)return e;let r=(0,dr.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:i}=this.opts,s=new lr.CodeGen(this.scope,{es5:n,lines:o,ownProperties:i}),a;t.$async&&(a=s.scopeValue("Error",{ref:FR.default,code:(0,lr._)`require("ajv/dist/runtime/validation_error").default`}));let c=s.scopeName("validate");t.validateName=c;let u={gen:s,allErrors:this.opts.allErrors,data:eo.default.data,parentData:eo.default.parentData,parentDataProperty:eo.default.parentDataProperty,dataNames:[eo.default.data],dataPathArr:[lr.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,lr.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:lr.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,lr._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,BR.validateFunctionCode)(u),s.optimize(this.opts.code.optimize);let d=s.toString();l=`${s.scopeRefs(eo.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let f=new Function(`${eo.default.self}`,`${eo.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:s._values}),this.opts.unevaluated){let{props:h,items:m}=u;f.evaluated={props:h instanceof lr.Name?void 0:h,items:m instanceof lr.Name?void 0:m,dynamicProps:h instanceof lr.Name,dynamicItems:m instanceof lr.Name},f.source&&(f.source.evaluated=(0,lr.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}Kt.compileSchema=jg;function HR(t,e,r){var n;r=(0,dr.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let i=JR.call(this,t,r);if(i===void 0){let s=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;s&&(i=new ai({schema:s,schemaId:a,root:t,baseId:e}))}if(i!==void 0)return t.refs[r]=WR.call(this,i)}Kt.resolveRef=HR;function WR(t){return(0,dr.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:jg.call(this,t)}function z0(t){for(let e of this._compilations)if(GR(e,t))return e}Kt.getCompilingSchema=z0;function GR(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function JR(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||dl.call(this,t,e)}function dl(t,e){let r=this.opts.uriResolver.parse(e),n=(0,dr._getFullPath)(this.opts.uriResolver,r),o=(0,dr.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return Cg.call(this,r,t);let i=(0,dr.normalizeId)(n),s=this.refs[i]||this.schemas[i];if(typeof s=="string"){let a=dl.call(this,t,s);return typeof a?.schema!="object"?void 0:Cg.call(this,r,a)}if(typeof s?.schema=="object"){if(s.validate||jg.call(this,s),i===(0,dr.normalizeId)(e)){let{schema:a}=s,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,dr.resolveUrl)(this.opts.uriResolver,o,u)),new ai({schema:a,schemaId:c,root:t,baseId:o})}return Cg.call(this,r,s)}}Kt.resolveSchema=dl;var KR=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Cg(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,E0.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!KR.has(a)&&u&&(e=(0,dr.resolveUrl)(this.opts.uriResolver,e,u))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,E0.schemaHasRulesButRef)(r,this.RULES)){let a=(0,dr.resolveUrl)(this.opts.uriResolver,e,r.$ref);i=dl.call(this,n,a)}let{schemaId:s}=this.opts;if(i=i||new ai({schema:r,schemaId:s,root:n,baseId:e}),i.schema!==i.root.schema)return i}});var T0=b((UK,XR)=>{XR.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var Rg=b((qK,N0)=>{"use strict";var YR=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),C0=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function Ng(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var QR=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function O0(t){return t.length=0,!0}function eA(t,e,r){if(t.length){let n=Ng(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function tA(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],i=!1,s=!1,a=eA;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(i===!0&&(s=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(i=!0),n.push(":");continue}else if(u==="%"){if(!a(o,n,r))break;a=O0}else{o.push(u);continue}}return o.length&&(a===O0?r.zone=o.join(""):s?n.push(o.join("")):n.push(Ng(o))),r.address=n.join(""),r}function j0(t){if(rA(t,":")<2)return{host:t,isIPV6:!1};let e=tA(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function rA(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function nA(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function oA(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function iA(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!C0(r)){let n=j0(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}N0.exports={nonSimpleDomain:QR,recomposeAuthority:iA,normalizeComponentEncoding:oA,removeDotSegments:nA,isIPv4:C0,isUUID:YR,normalizeIPv6:j0,stringArrayToHexStripped:Ng}});var U0=b((LK,D0)=>{"use strict";var{isUUID:sA}=Rg(),aA=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,cA=["http","https","ws","wss","urn","urn:uuid"];function uA(t){return cA.indexOf(t)!==-1}function Ag(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function R0(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function A0(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function lA(t){return t.secure=Ag(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function dA(t){if((t.port===(Ag(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function pA(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(aA);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,i=Mg(o);t.path=void 0,i&&(t=i.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function fA(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,i=Mg(o);i&&(t=i.serialize(t,e));let s=t,a=t.nss;return s.path=`${n||e.nid}:${a}`,e.skipEscape=!0,s}function mA(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!sA(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function hA(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var M0={scheme:"http",domainHost:!0,parse:R0,serialize:A0},gA={scheme:"https",domainHost:M0.domainHost,parse:R0,serialize:A0},fl={scheme:"ws",domainHost:!0,parse:lA,serialize:dA},vA={scheme:"wss",domainHost:fl.domainHost,parse:fl.parse,serialize:fl.serialize},yA={scheme:"urn",parse:pA,serialize:fA,skipNormalize:!0},_A={scheme:"urn:uuid",parse:mA,serialize:hA,skipNormalize:!0},ml={http:M0,https:gA,ws:fl,wss:vA,urn:yA,"urn:uuid":_A};Object.setPrototypeOf(ml,null);function Mg(t){return t&&(ml[t]||ml[t.toLowerCase()])||void 0}D0.exports={wsIsSecure:Ag,SCHEMES:ml,isValidSchemeName:uA,getSchemeHandler:Mg}});var Ug=b((ZK,gl)=>{"use strict";var{normalizeIPv6:bA,removeDotSegments:ba,recomposeAuthority:$A,normalizeComponentEncoding:hl,isIPv4:wA,nonSimpleDomain:xA}=Rg(),{SCHEMES:kA,getSchemeHandler:q0}=U0();function SA(t,e){return typeof t=="string"?t=Pr(Hr(t,e),e):typeof t=="object"&&(t=Hr(Pr(t,e),e)),t}function PA(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=L0(Hr(t,n),Hr(e,n),n,!0);return n.skipEscape=!0,Pr(o,n)}function L0(t,e,r,n){let o={};return n||(t=Hr(Pr(t,r),r),e=Hr(Pr(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=ba(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=ba(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=ba(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=ba(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function IA(t,e,r){return typeof t=="string"?(t=unescape(t),t=Pr(hl(Hr(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=Pr(hl(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=Pr(hl(Hr(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=Pr(hl(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function Pr(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],i=q0(n.scheme||r.scheme);i&&i.serialize&&i.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let s=$A(r);if(s!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(s),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!i||!i.absolutePath)&&(a=ba(a)),s===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var EA=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Hr(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let i=t.match(EA);if(i){if(n.scheme=i[1],n.userinfo=i[3],n.host=i[4],n.port=parseInt(i[5],10),n.path=i[6]||"",n.query=i[7],n.fragment=i[8],isNaN(n.port)&&(n.port=i[5]),n.host)if(wA(n.host)===!1){let c=bA(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let s=q0(r.scheme||n.scheme);if(!r.unicodeSupport&&(!s||!s.unicodeSupport)&&n.host&&(r.domainHost||s&&s.domainHost)&&o===!1&&xA(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!s||s&&!s.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),s&&s.parse&&s.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var Dg={SCHEMES:kA,normalize:SA,resolve:PA,resolveComponent:L0,equal:IA,serialize:Pr,parse:Hr};gl.exports=Dg;gl.exports.default=Dg;gl.exports.fastUri=Dg});var V0=b(qg=>{"use strict";Object.defineProperty(qg,"__esModule",{value:!0});var Z0=Ug();Z0.code='require("ajv/dist/runtime/uri").default';qg.default=Z0});var X0=b(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.CodeGen=Qe.Name=Qe.nil=Qe.stringify=Qe.str=Qe._=Qe.KeywordCxt=void 0;var zA=ya();Object.defineProperty(Qe,"KeywordCxt",{enumerable:!0,get:function(){return zA.KeywordCxt}});var ci=re();Object.defineProperty(Qe,"_",{enumerable:!0,get:function(){return ci._}});Object.defineProperty(Qe,"str",{enumerable:!0,get:function(){return ci.str}});Object.defineProperty(Qe,"stringify",{enumerable:!0,get:function(){return ci.stringify}});Object.defineProperty(Qe,"nil",{enumerable:!0,get:function(){return ci.nil}});Object.defineProperty(Qe,"Name",{enumerable:!0,get:function(){return ci.Name}});Object.defineProperty(Qe,"CodeGen",{enumerable:!0,get:function(){return ci.CodeGen}});var TA=ll(),G0=_a(),OA=hg(),$a=pl(),CA=re(),wa=ha(),vl=fa(),Zg=ge(),F0=T0(),jA=V0(),J0=(t,e)=>new RegExp(t,e);J0.code="new RegExp";var NA=["removeAdditional","useDefaults","coerceTypes"],RA=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),AA={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},MA={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},B0=200;function DA(t){var e,r,n,o,i,s,a,c,u,l,d,p,f,h,m,g,v,$,x,I,k,ie,se,Y,be;let We=t.strict,or=(e=t.code)===null||e===void 0?void 0:e.optimize,br=or===!0||or===void 0?1:or||0,Bi=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:J0,Zd=(o=t.uriResolver)!==null&&o!==void 0?o:jA.default;return{strictSchema:(s=(i=t.strictSchema)!==null&&i!==void 0?i:We)!==null&&s!==void 0?s:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:We)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:We)!==null&&l!==void 0?l:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:We)!==null&&p!==void 0?p:"log",strictRequired:(h=(f=t.strictRequired)!==null&&f!==void 0?f:We)!==null&&h!==void 0?h:!1,code:t.code?{...t.code,optimize:br,regExp:Bi}:{optimize:br,regExp:Bi},loopRequired:(m=t.loopRequired)!==null&&m!==void 0?m:B0,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:B0,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:($=t.messages)!==null&&$!==void 0?$:!0,inlineRefs:(x=t.inlineRefs)!==null&&x!==void 0?x:!0,schemaId:(I=t.schemaId)!==null&&I!==void 0?I:"$id",addUsedSchema:(k=t.addUsedSchema)!==null&&k!==void 0?k:!0,validateSchema:(ie=t.validateSchema)!==null&&ie!==void 0?ie:!0,validateFormats:(se=t.validateFormats)!==null&&se!==void 0?se:!0,unicodeRegExp:(Y=t.unicodeRegExp)!==null&&Y!==void 0?Y:!0,int32range:(be=t.int32range)!==null&&be!==void 0?be:!0,uriResolver:Zd}}var xa=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...DA(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new CA.ValueScope({scope:{},prefixes:RA,es5:r,lines:n}),this.logger=FA(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,OA.getRules)(),H0.call(this,AA,e,"NOT SUPPORTED"),H0.call(this,MA,e,"DEPRECATED","warn"),this._metaOpts=ZA.call(this),e.formats&&qA.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&LA.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),UA.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=F0;n==="id"&&(o={...F0},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await i.call(this,l.$schema);let p=this._addSchema(l,d);return p.validate||s.call(this,p)}async function i(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function s(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof G0.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),s.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await i.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let s of e)this.addSchema(s,void 0,n,o);return this}let i;if(typeof e=="object"){let{schemaId:s}=this.opts;if(i=e[s],i!==void 0&&typeof i!="string")throw new Error(`schema ${s} must be string`)}return r=(0,wa.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return o}getSchema(e){let r;for(;typeof(r=W0.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new $a.SchemaEnv({schema:{},schemaId:n});if(r=$a.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=W0.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,wa.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(HA.call(this,n,r),!r)return(0,Zg.eachItem)(n,i=>Lg.call(this,i)),this;GA.call(this,r);let o={...r,type:(0,vl.getJSONTypes)(r.type),schemaType:(0,vl.getJSONTypes)(r.schemaType)};return(0,Zg.eachItem)(n,o.type.length===0?i=>Lg.call(this,i,o):i=>o.type.forEach(s=>Lg.call(this,i,o,s))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(i=>i.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,i)=>o+r+i)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let i=o.split("/").slice(1),s=e;for(let a of i)s=s[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=s[a];u&&l&&(s[a]=K0(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,i=this.opts.addUsedSchema){let s,{schemaId:a}=this.opts;if(typeof e=="object")s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,wa.normalizeId)(s||n);let u=wa.getSchemaRefs.call(this,e,n);return c=new $a.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):$a.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{$a.compileSchema.call(this,e)}finally{this.opts=r}}};xa.ValidationError=TA.default;xa.MissingRefError=G0.default;Qe.default=xa;function H0(t,e,r,n="error"){for(let o in t){let i=o;i in e&&this.logger[n](`${r}: option ${o}. ${t[i]}`)}}function W0(t){return t=(0,wa.normalizeId)(t),this.schemas[t]||this.refs[t]}function UA(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function qA(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function LA(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function ZA(){let t={...this.opts};for(let e of NA)delete t[e];return t}var VA={log(){},warn(){},error(){}};function FA(t){if(t===!1)return VA;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var BA=/^[a-z_$][a-z0-9_$:-]*$/i;function HA(t,e){let{RULES:r}=this;if((0,Zg.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!BA.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function Lg(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,s=o?i.post:i.rules.find(({type:c})=>c===r);if(s||(s={type:r,rules:[]},i.rules.push(s)),i.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,vl.getJSONTypes)(e.type),schemaType:(0,vl.getJSONTypes)(e.schemaType)}};e.before?WA.call(this,s,a,e.before):s.rules.push(a),i.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function WA(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function GA(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=K0(e)),t.validateSchema=this.compile(e,!0))}var JA={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function K0(t){return{anyOf:[t,JA]}}});var Y0=b(Vg=>{"use strict";Object.defineProperty(Vg,"__esModule",{value:!0});var KA={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Vg.default=KA});var rk=b(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.callRef=to.getValidate=void 0;var XA=_a(),Q0=Jt(),Et=re(),ui=Fr(),ek=pl(),yl=ge(),YA={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:i,validateName:s,opts:a,self:c}=n,{root:u}=i;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=ek.resolveRef.call(c,u,o,r);if(l===void 0)throw new XA.default(n.opts.uriResolver,o,r);if(l instanceof ek.SchemaEnv)return p(l);return f(l);function d(){if(i===u)return _l(t,s,i,i.$async);let h=e.scopeValue("root",{ref:u});return _l(t,(0,Et._)`${h}.validate`,u,u.$async)}function p(h){let m=tk(t,h);_l(t,m,h,h.$async)}function f(h){let m=e.scopeValue("schema",a.code.source===!0?{ref:h,code:(0,Et.stringify)(h)}:{ref:h}),g=e.name("valid"),v=t.subschema({schema:h,dataTypes:[],schemaPath:Et.nil,topSchemaRef:m,errSchemaPath:r},g);t.mergeEvaluated(v),t.ok(g)}}};function tk(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Et._)`${r.scopeValue("wrapper",{ref:e})}.validate`}to.getValidate=tk;function _l(t,e,r,n){let{gen:o,it:i}=t,{allErrors:s,schemaEnv:a,opts:c}=i,u=c.passContext?ui.default.this:Et.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let h=o.let("valid");o.try(()=>{o.code((0,Et._)`await ${(0,Q0.callValidateCode)(t,e,u)}`),f(e),s||o.assign(h,!0)},m=>{o.if((0,Et._)`!(${m} instanceof ${i.ValidationError})`,()=>o.throw(m)),p(m),s||o.assign(h,!1)}),t.ok(h)}function d(){t.result((0,Q0.callValidateCode)(t,e,u),()=>f(e),()=>p(e))}function p(h){let m=(0,Et._)`${h}.errors`;o.assign(ui.default.vErrors,(0,Et._)`${ui.default.vErrors} === null ? ${m} : ${ui.default.vErrors}.concat(${m})`),o.assign(ui.default.errors,(0,Et._)`${ui.default.vErrors}.length`)}function f(h){var m;if(!i.opts.unevaluated)return;let g=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(i.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(i.props=yl.mergeEvaluated.props(o,g.props,i.props));else{let v=o.var("props",(0,Et._)`${h}.evaluated.props`);i.props=yl.mergeEvaluated.props(o,v,i.props,Et.Name)}if(i.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(i.items=yl.mergeEvaluated.items(o,g.items,i.items));else{let v=o.var("items",(0,Et._)`${h}.evaluated.items`);i.items=yl.mergeEvaluated.items(o,v,i.items,Et.Name)}}}to.callRef=_l;to.default=YA});var nk=b(Fg=>{"use strict";Object.defineProperty(Fg,"__esModule",{value:!0});var QA=Y0(),eM=rk(),tM=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",QA.default,eM.default];Fg.default=tM});var ok=b(Bg=>{"use strict";Object.defineProperty(Bg,"__esModule",{value:!0});var bl=re(),wn=bl.operators,$l={maximum:{okStr:"<=",ok:wn.LTE,fail:wn.GT},minimum:{okStr:">=",ok:wn.GTE,fail:wn.LT},exclusiveMaximum:{okStr:"<",ok:wn.LT,fail:wn.GTE},exclusiveMinimum:{okStr:">",ok:wn.GT,fail:wn.LTE}},rM={message:({keyword:t,schemaCode:e})=>(0,bl.str)`must be ${$l[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,bl._)`{comparison: ${$l[t].okStr}, limit: ${e}}`},nM={keyword:Object.keys($l),type:"number",schemaType:"number",$data:!0,error:rM,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,bl._)`${r} ${$l[e].fail} ${n} || isNaN(${r})`)}};Bg.default=nM});var ik=b(Hg=>{"use strict";Object.defineProperty(Hg,"__esModule",{value:!0});var ka=re(),oM={message:({schemaCode:t})=>(0,ka.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,ka._)`{multipleOf: ${t}}`},iM={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:oM,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,i=o.opts.multipleOfPrecision,s=e.let("res"),a=i?(0,ka._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${i}`:(0,ka._)`${s} !== parseInt(${s})`;t.fail$data((0,ka._)`(${n} === 0 || (${s} = ${r}/${n}, ${a}))`)}};Hg.default=iM});var ak=b(Wg=>{"use strict";Object.defineProperty(Wg,"__esModule",{value:!0});function sk(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}Wg.default=sk;sk.code='require("ajv/dist/runtime/ucs2length").default'});var ck=b(Gg=>{"use strict";Object.defineProperty(Gg,"__esModule",{value:!0});var ro=re(),sM=ge(),aM=ak(),cM={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,ro.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,ro._)`{limit: ${t}}`},uM={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:cM,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,i=e==="maxLength"?ro.operators.GT:ro.operators.LT,s=o.opts.unicode===!1?(0,ro._)`${r}.length`:(0,ro._)`${(0,sM.useFunc)(t.gen,aM.default)}(${r})`;t.fail$data((0,ro._)`${s} ${i} ${n}`)}};Gg.default=uM});var uk=b(Jg=>{"use strict";Object.defineProperty(Jg,"__esModule",{value:!0});var lM=Jt(),wl=re(),dM={message:({schemaCode:t})=>(0,wl.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,wl._)`{pattern: ${t}}`},pM={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:dM,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:i}=t,s=i.opts.unicodeRegExp?"u":"",a=r?(0,wl._)`(new RegExp(${o}, ${s}))`:(0,lM.usePattern)(t,n);t.fail$data((0,wl._)`!${a}.test(${e})`)}};Jg.default=pM});var lk=b(Kg=>{"use strict";Object.defineProperty(Kg,"__esModule",{value:!0});var Sa=re(),fM={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,Sa.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Sa._)`{limit: ${t}}`},mM={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:fM,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?Sa.operators.GT:Sa.operators.LT;t.fail$data((0,Sa._)`Object.keys(${r}).length ${o} ${n}`)}};Kg.default=mM});var dk=b(Xg=>{"use strict";Object.defineProperty(Xg,"__esModule",{value:!0});var Pa=Jt(),Ia=re(),hM=ge(),gM={message:({params:{missingProperty:t}})=>(0,Ia.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,Ia._)`{missingProperty: ${t}}`},vM={keyword:"required",type:"object",schemaType:"array",$data:!0,error:gM,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:i,it:s}=t,{opts:a}=s;if(!i&&r.length===0)return;let c=r.length>=a.loopRequired;if(s.allErrors?u():l(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:h}=t.it;for(let m of r)if(f?.[m]===void 0&&!h.has(m)){let g=s.schemaEnv.baseId+s.errSchemaPath,v=`required property "${m}" is not defined at "${g}" (strictRequired)`;(0,hM.checkStrictMode)(s,v,s.opts.strictRequired)}}function u(){if(c||i)t.block$data(Ia.nil,d);else for(let f of r)(0,Pa.checkReportMissingProp)(t,f)}function l(){let f=e.let("missing");if(c||i){let h=e.let("valid",!0);t.block$data(h,()=>p(f,h)),t.ok(h)}else e.if((0,Pa.checkMissingProp)(t,r,f)),(0,Pa.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,Pa.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function p(f,h){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(h,(0,Pa.propertyInData)(e,o,f,a.ownProperties)),e.if((0,Ia.not)(h),()=>{t.error(),e.break()})},Ia.nil)}}};Xg.default=vM});var pk=b(Yg=>{"use strict";Object.defineProperty(Yg,"__esModule",{value:!0});var Ea=re(),yM={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,Ea.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,Ea._)`{limit: ${t}}`},_M={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:yM,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?Ea.operators.GT:Ea.operators.LT;t.fail$data((0,Ea._)`${r}.length ${o} ${n}`)}};Yg.default=_M});var xl=b(Qg=>{"use strict";Object.defineProperty(Qg,"__esModule",{value:!0});var fk=ma();fk.code='require("ajv/dist/runtime/equal").default';Qg.default=fk});var mk=b(tv=>{"use strict";Object.defineProperty(tv,"__esModule",{value:!0});var ev=fa(),et=re(),bM=ge(),$M=xl(),wM={message:({params:{i:t,j:e}})=>(0,et.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,et._)`{i: ${t}, j: ${e}}`},xM={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:wM,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:i,schemaCode:s,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=i.items?(0,ev.getSchemaTypes)(i.items):[];t.block$data(c,l,(0,et._)`${s} === false`),t.ok(c);function l(){let h=e.let("i",(0,et._)`${r}.length`),m=e.let("j");t.setParams({i:h,j:m}),e.assign(c,!0),e.if((0,et._)`${h} > 1`,()=>(d()?p:f)(h,m))}function d(){return u.length>0&&!u.some(h=>h==="object"||h==="array")}function p(h,m){let g=e.name("item"),v=(0,ev.checkDataTypes)(u,g,a.opts.strictNumbers,ev.DataType.Wrong),$=e.const("indices",(0,et._)`{}`);e.for((0,et._)`;${h}--;`,()=>{e.let(g,(0,et._)`${r}[${h}]`),e.if(v,(0,et._)`continue`),u.length>1&&e.if((0,et._)`typeof ${g} == "string"`,(0,et._)`${g} += "_"`),e.if((0,et._)`typeof ${$}[${g}] == "number"`,()=>{e.assign(m,(0,et._)`${$}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,et._)`${$}[${g}] = ${h}`)})}function f(h,m){let g=(0,bM.useFunc)(e,$M.default),v=e.name("outer");e.label(v).for((0,et._)`;${h}--;`,()=>e.for((0,et._)`${m} = ${h}; ${m}--;`,()=>e.if((0,et._)`${g}(${r}[${h}], ${r}[${m}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};tv.default=xM});var hk=b(nv=>{"use strict";Object.defineProperty(nv,"__esModule",{value:!0});var rv=re(),kM=ge(),SM=xl(),PM={message:"must be equal to constant",params:({schemaCode:t})=>(0,rv._)`{allowedValue: ${t}}`},IM={keyword:"const",$data:!0,error:PM,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:i}=t;n||i&&typeof i=="object"?t.fail$data((0,rv._)`!${(0,kM.useFunc)(e,SM.default)}(${r}, ${o})`):t.fail((0,rv._)`${i} !== ${r}`)}};nv.default=IM});var gk=b(ov=>{"use strict";Object.defineProperty(ov,"__esModule",{value:!0});var za=re(),EM=ge(),zM=xl(),TM={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,za._)`{allowedValues: ${t}}`},OM={keyword:"enum",schemaType:"array",$data:!0,error:TM,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:i,it:s}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=s.opts.loopEnum,c,u=()=>c??(c=(0,EM.useFunc)(e,zM.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",i);l=(0,za.or)(...o.map((h,m)=>p(f,m)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",i,f=>e.if((0,za._)`${u()}(${r}, ${f})`,()=>e.assign(l,!0).break()))}function p(f,h){let m=o[h];return typeof m=="object"&&m!==null?(0,za._)`${u()}(${r}, ${f}[${h}])`:(0,za._)`${r} === ${m}`}}};ov.default=OM});var vk=b(iv=>{"use strict";Object.defineProperty(iv,"__esModule",{value:!0});var CM=ok(),jM=ik(),NM=ck(),RM=uk(),AM=lk(),MM=dk(),DM=pk(),UM=mk(),qM=hk(),LM=gk(),ZM=[CM.default,jM.default,NM.default,RM.default,AM.default,MM.default,DM.default,UM.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},qM.default,LM.default];iv.default=ZM});var av=b(Ta=>{"use strict";Object.defineProperty(Ta,"__esModule",{value:!0});Ta.validateAdditionalItems=void 0;var no=re(),sv=ge(),VM={message:({params:{len:t}})=>(0,no.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,no._)`{limit: ${t}}`},FM={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:VM,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,sv.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}yk(t,n)}};function yk(t,e){let{gen:r,schema:n,data:o,keyword:i,it:s}=t;s.items=!0;let a=r.const("len",(0,no._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,no._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,sv.alwaysValidSchema)(s,n)){let u=r.var("valid",(0,no._)`${a} <= ${e.length}`);r.if((0,no.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:i,dataProp:l,dataPropType:sv.Type.Num},u),s.allErrors||r.if((0,no.not)(u),()=>r.break())})}}Ta.validateAdditionalItems=yk;Ta.default=FM});var cv=b(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.validateTuple=void 0;var _k=re(),kl=ge(),BM=Jt(),HM={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return bk(t,"additionalItems",e);r.items=!0,!(0,kl.alwaysValidSchema)(r,e)&&t.ok((0,BM.validateArray)(t))}};function bk(t,e,r=t.schema){let{gen:n,parentSchema:o,data:i,keyword:s,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=kl.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,_k._)`${i}.length`);r.forEach((d,p)=>{(0,kl.alwaysValidSchema)(a,d)||(n.if((0,_k._)`${u} > ${p}`,()=>t.subschema({keyword:s,schemaProp:p,dataProp:p},c)),t.ok(c))});function l(d){let{opts:p,errSchemaPath:f}=a,h=r.length,m=h===d.minItems&&(h===d.maxItems||d[e]===!1);if(p.strictTuples&&!m){let g=`"${s}" is ${h}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,kl.checkStrictMode)(a,g,p.strictTuples)}}}Oa.validateTuple=bk;Oa.default=HM});var $k=b(uv=>{"use strict";Object.defineProperty(uv,"__esModule",{value:!0});var WM=cv(),GM={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,WM.validateTuple)(t,"items")};uv.default=GM});var xk=b(lv=>{"use strict";Object.defineProperty(lv,"__esModule",{value:!0});var wk=re(),JM=ge(),KM=Jt(),XM=av(),YM={message:({params:{len:t}})=>(0,wk.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,wk._)`{limit: ${t}}`},QM={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:YM,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,JM.alwaysValidSchema)(n,e)&&(o?(0,XM.validateAdditionalItems)(t,o):t.ok((0,KM.validateArray)(t)))}};lv.default=QM});var kk=b(dv=>{"use strict";Object.defineProperty(dv,"__esModule",{value:!0});var Xt=re(),Sl=ge(),e4={message:({params:{min:t,max:e}})=>e===void 0?(0,Xt.str)`must contain at least ${t} valid item(s)`:(0,Xt.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,Xt._)`{minContains: ${t}}`:(0,Xt._)`{minContains: ${t}, maxContains: ${e}}`},t4={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:e4,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t,s,a,{minContains:c,maxContains:u}=n;i.opts.next?(s=c===void 0?1:c,a=u):s=1;let l=e.const("len",(0,Xt._)`${o}.length`);if(t.setParams({min:s,max:a}),a===void 0&&s===0){(0,Sl.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,Sl.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,Sl.alwaysValidSchema)(i,r)){let m=(0,Xt._)`${l} >= ${s}`;a!==void 0&&(m=(0,Xt._)`${m} && ${l} <= ${a}`),t.pass(m);return}i.items=!0;let d=e.name("valid");a===void 0&&s===1?f(d,()=>e.if(d,()=>e.break())):s===0?(e.let(d,!0),a!==void 0&&e.if((0,Xt._)`${o}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let m=e.name("_valid"),g=e.let("count",0);f(m,()=>e.if(m,()=>h(g)))}function f(m,g){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:Sl.Type.Num,compositeRule:!0},m),g()})}function h(m){e.code((0,Xt._)`${m}++`),a===void 0?e.if((0,Xt._)`${m} >= ${s}`,()=>e.assign(d,!0).break()):(e.if((0,Xt._)`${m} > ${a}`,()=>e.assign(d,!1).break()),s===1?e.assign(d,!0):e.if((0,Xt._)`${m} >= ${s}`,()=>e.assign(d,!0)))}}};dv.default=t4});var Ik=b(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.validateSchemaDeps=Ir.validatePropertyDeps=Ir.error=void 0;var pv=re(),r4=ge(),Ca=Jt();Ir.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,pv.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,pv._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var n4={keyword:"dependencies",type:"object",schemaType:"object",error:Ir.error,code(t){let[e,r]=o4(t);Sk(t,e),Pk(t,r)}};function o4({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function Sk(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let i=r.let("missing");for(let s in e){let a=e[s];if(a.length===0)continue;let c=(0,Ca.propertyInData)(r,n,s,o.opts.ownProperties);t.setParams({property:s,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,Ca.checkReportMissingProp)(t,u)}):(r.if((0,pv._)`${c} && (${(0,Ca.checkMissingProp)(t,a,i)})`),(0,Ca.reportMissingProp)(t,i),r.else())}}Ir.validatePropertyDeps=Sk;function Pk(t,e=t.schema){let{gen:r,data:n,keyword:o,it:i}=t,s=r.name("valid");for(let a in e)(0,r4.alwaysValidSchema)(i,e[a])||(r.if((0,Ca.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},s);t.mergeValidEvaluated(c,s)},()=>r.var(s,!0)),t.ok(s))}Ir.validateSchemaDeps=Pk;Ir.default=n4});var zk=b(fv=>{"use strict";Object.defineProperty(fv,"__esModule",{value:!0});var Ek=re(),i4=ge(),s4={message:"property name must be valid",params:({params:t})=>(0,Ek._)`{propertyName: ${t.propertyName}}`},a4={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:s4,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,i4.alwaysValidSchema)(o,r))return;let i=e.name("valid");e.forIn("key",n,s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},i),e.if((0,Ek.not)(i),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(i)}};fv.default=a4});var hv=b(mv=>{"use strict";Object.defineProperty(mv,"__esModule",{value:!0});var Pl=Jt(),pr=re(),c4=Fr(),Il=ge(),u4={message:"must NOT have additional properties",params:({params:t})=>(0,pr._)`{additionalProperty: ${t.additionalProperty}}`},l4={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:u4,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:i,it:s}=t;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=s;if(s.props=!0,c.removeAdditional!=="all"&&(0,Il.alwaysValidSchema)(s,r))return;let u=(0,Pl.allSchemaProperties)(n.properties),l=(0,Pl.allSchemaProperties)(n.patternProperties);d(),t.ok((0,pr._)`${i} === ${c4.default.errors}`);function d(){e.forIn("key",o,g=>{!u.length&&!l.length?h(g):e.if(p(g),()=>h(g))})}function p(g){let v;if(u.length>8){let $=(0,Il.schemaRefOrVal)(s,n.properties,"properties");v=(0,Pl.isOwnProperty)(e,$,g)}else u.length?v=(0,pr.or)(...u.map($=>(0,pr._)`${g} === ${$}`)):v=pr.nil;return l.length&&(v=(0,pr.or)(v,...l.map($=>(0,pr._)`${(0,Pl.usePattern)(t,$)}.test(${g})`))),(0,pr.not)(v)}function f(g){e.code((0,pr._)`delete ${o}[${g}]`)}function h(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,Il.alwaysValidSchema)(s,r)){let v=e.name("valid");c.removeAdditional==="failing"?(m(g,v,!1),e.if((0,pr.not)(v),()=>{t.reset(),f(g)})):(m(g,v),a||e.if((0,pr.not)(v),()=>e.break()))}}function m(g,v,$){let x={keyword:"additionalProperties",dataProp:g,dataPropType:Il.Type.Str};$===!1&&Object.assign(x,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(x,v)}}};mv.default=l4});var Ck=b(vv=>{"use strict";Object.defineProperty(vv,"__esModule",{value:!0});var d4=ya(),Tk=Jt(),gv=ge(),Ok=hv(),p4={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&Ok.default.code(new d4.KeywordCxt(i,Ok.default,"additionalProperties"));let s=(0,Tk.allSchemaProperties)(r);for(let d of s)i.definedProperties.add(d);i.opts.unevaluated&&s.length&&i.props!==!0&&(i.props=gv.mergeEvaluated.props(e,(0,gv.toHash)(s),i.props));let a=s.filter(d=>!(0,gv.alwaysValidSchema)(i,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,Tk.propertyInData)(e,o,d,i.opts.ownProperties)),l(d),i.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return i.opts.useDefaults&&!i.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};vv.default=p4});var Ak=b(yv=>{"use strict";Object.defineProperty(yv,"__esModule",{value:!0});var jk=Jt(),El=re(),Nk=ge(),Rk=ge(),f4={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:i}=t,{opts:s}=i,a=(0,jk.allSchemaProperties)(r),c=a.filter(m=>(0,Nk.alwaysValidSchema)(i,r[m]));if(a.length===0||c.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let u=s.strictSchema&&!s.allowMatchingProperties&&o.properties,l=e.name("valid");i.props!==!0&&!(i.props instanceof El.Name)&&(i.props=(0,Rk.evaluatedPropsToName)(e,i.props));let{props:d}=i;p();function p(){for(let m of a)u&&f(m),i.allErrors?h(m):(e.var(l,!0),h(m),e.if(l))}function f(m){for(let g in u)new RegExp(m).test(g)&&(0,Nk.checkStrictMode)(i,`property ${g} matches pattern ${m} (use allowMatchingProperties)`)}function h(m){e.forIn("key",n,g=>{e.if((0,El._)`${(0,jk.usePattern)(t,m)}.test(${g})`,()=>{let v=c.includes(m);v||t.subschema({keyword:"patternProperties",schemaProp:m,dataProp:g,dataPropType:Rk.Type.Str},l),i.opts.unevaluated&&d!==!0?e.assign((0,El._)`${d}[${g}]`,!0):!v&&!i.allErrors&&e.if((0,El.not)(l),()=>e.break())})})}}};yv.default=f4});var Mk=b(_v=>{"use strict";Object.defineProperty(_v,"__esModule",{value:!0});var m4=ge(),h4={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,m4.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};_v.default=h4});var Dk=b(bv=>{"use strict";Object.defineProperty(bv,"__esModule",{value:!0});var g4=Jt(),v4={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:g4.validateUnion,error:{message:"must match a schema in anyOf"}};bv.default=v4});var Uk=b($v=>{"use strict";Object.defineProperty($v,"__esModule",{value:!0});var zl=re(),y4=ge(),_4={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,zl._)`{passingSchemas: ${t.passing}}`},b4={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:_4,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let i=r,s=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(s,()=>t.reset(),()=>t.error(!0));function u(){i.forEach((l,d)=>{let p;(0,y4.alwaysValidSchema)(o,l)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,zl._)`${c} && ${s}`).assign(s,!1).assign(a,(0,zl._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(s,!0),e.assign(a,d),p&&t.mergeEvaluated(p,zl.Name)})})}}};$v.default=b4});var qk=b(wv=>{"use strict";Object.defineProperty(wv,"__esModule",{value:!0});var $4=ge(),w4={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((i,s)=>{if((0,$4.alwaysValidSchema)(n,i))return;let a=t.subschema({keyword:"allOf",schemaProp:s},o);t.ok(o),t.mergeEvaluated(a)})}};wv.default=w4});var Vk=b(xv=>{"use strict";Object.defineProperty(xv,"__esModule",{value:!0});var Tl=re(),Zk=ge(),x4={message:({params:t})=>(0,Tl.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,Tl._)`{failingKeyword: ${t.ifClause}}`},k4={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:x4,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,Zk.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=Lk(n,"then"),i=Lk(n,"else");if(!o&&!i)return;let s=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&i){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,Tl.not)(a),u("else"));t.pass(s,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let p=t.subschema({keyword:l},a);e.assign(s,a),t.mergeValidEvaluated(p,s),d?e.assign(d,(0,Tl._)`${l}`):t.setParams({ifClause:l})}}}};function Lk(t,e){let r=t.schema[e];return r!==void 0&&!(0,Zk.alwaysValidSchema)(t,r)}xv.default=k4});var Fk=b(kv=>{"use strict";Object.defineProperty(kv,"__esModule",{value:!0});var S4=ge(),P4={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,S4.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};kv.default=P4});var Bk=b(Sv=>{"use strict";Object.defineProperty(Sv,"__esModule",{value:!0});var I4=av(),E4=$k(),z4=cv(),T4=xk(),O4=kk(),C4=Ik(),j4=zk(),N4=hv(),R4=Ck(),A4=Ak(),M4=Mk(),D4=Dk(),U4=Uk(),q4=qk(),L4=Vk(),Z4=Fk();function V4(t=!1){let e=[M4.default,D4.default,U4.default,q4.default,L4.default,Z4.default,j4.default,N4.default,C4.default,R4.default,A4.default];return t?e.push(E4.default,T4.default):e.push(I4.default,z4.default),e.push(O4.default),e}Sv.default=V4});var Hk=b(Pv=>{"use strict";Object.defineProperty(Pv,"__esModule",{value:!0});var Le=re(),F4={message:({schemaCode:t})=>(0,Le.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,Le._)`{format: ${t}}`},B4={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:F4,code(t,e){let{gen:r,data:n,$data:o,schema:i,schemaCode:s,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?p():f();function p(){let h=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),m=r.const("fDef",(0,Le._)`${h}[${s}]`),g=r.let("fType"),v=r.let("format");r.if((0,Le._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(g,(0,Le._)`${m}.type || "string"`).assign(v,(0,Le._)`${m}.validate`),()=>r.assign(g,(0,Le._)`"string"`).assign(v,m)),t.fail$data((0,Le.or)($(),x()));function $(){return c.strictSchema===!1?Le.nil:(0,Le._)`${s} && !${v}`}function x(){let I=l.$async?(0,Le._)`(${m}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,Le._)`${v}(${n})`,k=(0,Le._)`(typeof ${v} == "function" ? ${I} : ${v}.test(${n}))`;return(0,Le._)`${v} && ${v} !== true && ${g} === ${e} && !${k}`}}function f(){let h=d.formats[i];if(!h){$();return}if(h===!0)return;let[m,g,v]=x(h);m===e&&t.pass(I());function $(){if(c.strictSchema===!1){d.logger.warn(k());return}throw new Error(k());function k(){return`unknown format "${i}" ignored in schema at path "${u}"`}}function x(k){let ie=k instanceof RegExp?(0,Le.regexpCode)(k):c.code.formats?(0,Le._)`${c.code.formats}${(0,Le.getProperty)(i)}`:void 0,se=r.scopeValue("formats",{key:i,ref:k,code:ie});return typeof k=="object"&&!(k instanceof RegExp)?[k.type||"string",k.validate,(0,Le._)`${se}.validate`]:["string",k,se]}function I(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!l.$async)throw new Error("async format in sync schema");return(0,Le._)`await ${v}(${n})`}return typeof g=="function"?(0,Le._)`${v}(${n})`:(0,Le._)`${v}.test(${n})`}}}};Pv.default=B4});var Wk=b(Iv=>{"use strict";Object.defineProperty(Iv,"__esModule",{value:!0});var H4=Hk(),W4=[H4.default];Iv.default=W4});var Gk=b(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.contentVocabulary=li.metadataVocabulary=void 0;li.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];li.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var Kk=b(Ev=>{"use strict";Object.defineProperty(Ev,"__esModule",{value:!0});var G4=nk(),J4=vk(),K4=Bk(),X4=Wk(),Jk=Gk(),Y4=[G4.default,J4.default,(0,K4.default)(),X4.default,Jk.metadataVocabulary,Jk.contentVocabulary];Ev.default=Y4});var Yk=b(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});Ol.DiscrError=void 0;var Xk;(function(t){t.Tag="tag",t.Mapping="mapping"})(Xk||(Ol.DiscrError=Xk={}))});var eS=b(Tv=>{"use strict";Object.defineProperty(Tv,"__esModule",{value:!0});var di=re(),zv=Yk(),Qk=pl(),Q4=_a(),eD=ge(),tD={message:({params:{discrError:t,tagName:e}})=>t===zv.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,di._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},rD={keyword:"discriminator",type:"object",schemaType:"object",error:tD,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:i}=t,{oneOf:s}=o;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,di._)`${r}${(0,di.getProperty)(a)}`);e.if((0,di._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:zv.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let f=p();e.if(!1);for(let h in f)e.elseIf((0,di._)`${u} === ${h}`),e.assign(c,d(f[h]));e.else(),t.error(!1,{discrError:zv.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(f){let h=e.name("valid"),m=t.subschema({keyword:"oneOf",schemaProp:f},h);return t.mergeEvaluated(m,di.Name),h}function p(){var f;let h={},m=v(o),g=!0;for(let I=0;I<s.length;I++){let k=s[I];if(k?.$ref&&!(0,eD.schemaHasRulesButRef)(k,i.self.RULES)){let se=k.$ref;if(k=Qk.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,se),k instanceof Qk.SchemaEnv&&(k=k.schema),k===void 0)throw new Q4.default(i.opts.uriResolver,i.baseId,se)}let ie=(f=k?.properties)===null||f===void 0?void 0:f[a];if(typeof ie!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(m||v(k)),$(ie,I)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return h;function v({required:I}){return Array.isArray(I)&&I.includes(a)}function $(I,k){if(I.const)x(I.const,k);else if(I.enum)for(let ie of I.enum)x(ie,k);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function x(I,k){if(typeof I!="string"||I in h)throw new Error(`discriminator: "${a}" values must be unique strings`);h[I]=k}}}};Tv.default=rD});var tS=b((T8,nD)=>{nD.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var nS=b((Ne,Ov)=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.MissingRefError=Ne.ValidationError=Ne.CodeGen=Ne.Name=Ne.nil=Ne.stringify=Ne.str=Ne._=Ne.KeywordCxt=Ne.Ajv=void 0;var oD=X0(),iD=Kk(),sD=eS(),rS=tS(),aD=["/properties"],Cl="http://json-schema.org/draft-07/schema",pi=class extends oD.default{_addVocabularies(){super._addVocabularies(),iD.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(sD.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(rS,aD):rS;this.addMetaSchema(e,Cl,!1),this.refs["http://json-schema.org/schema"]=Cl}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(Cl)?Cl:void 0)}};Ne.Ajv=pi;Ov.exports=Ne=pi;Ov.exports.Ajv=pi;Object.defineProperty(Ne,"__esModule",{value:!0});Ne.default=pi;var cD=ya();Object.defineProperty(Ne,"KeywordCxt",{enumerable:!0,get:function(){return cD.KeywordCxt}});var fi=re();Object.defineProperty(Ne,"_",{enumerable:!0,get:function(){return fi._}});Object.defineProperty(Ne,"str",{enumerable:!0,get:function(){return fi.str}});Object.defineProperty(Ne,"stringify",{enumerable:!0,get:function(){return fi.stringify}});Object.defineProperty(Ne,"nil",{enumerable:!0,get:function(){return fi.nil}});Object.defineProperty(Ne,"Name",{enumerable:!0,get:function(){return fi.Name}});Object.defineProperty(Ne,"CodeGen",{enumerable:!0,get:function(){return fi.CodeGen}});var uD=ll();Object.defineProperty(Ne,"ValidationError",{enumerable:!0,get:function(){return uD.default}});var lD=_a();Object.defineProperty(Ne,"MissingRefError",{enumerable:!0,get:function(){return lD.default}})});var dS=b(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.formatNames=zr.fastFormats=zr.fullFormats=void 0;function Er(t,e){return{validate:t,compare:e}}zr.fullFormats={date:Er(aS,Rv),time:Er(jv(!0),Av),"date-time":Er(oS(!0),uS),"iso-time":Er(jv(),cS),"iso-date-time":Er(oS(),lS),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:gD,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:xD,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:vD,int32:{type:"number",validate:bD},int64:{type:"number",validate:$D},float:{type:"number",validate:sS},double:{type:"number",validate:sS},password:!0,binary:!0};zr.fastFormats={...zr.fullFormats,date:Er(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Rv),time:Er(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Av),"date-time":Er(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uS),"iso-time":Er(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,cS),"iso-date-time":Er(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,lS),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};zr.formatNames=Object.keys(zr.fullFormats);function dD(t){return t%4===0&&(t%100!==0||t%400===0)}var pD=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,fD=[0,31,28,31,30,31,30,31,31,30,31,30,31];function aS(t){let e=pD.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&dD(r)?29:fD[n])}function Rv(t,e){if(t&&e)return t>e?1:t<e?-1:0}var Cv=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function jv(t){return function(r){let n=Cv.exec(r);if(!n)return!1;let o=+n[1],i=+n[2],s=+n[3],a=n[4],c=n[5]==="-"?-1:1,u=+(n[6]||0),l=+(n[7]||0);if(u>23||l>59||t&&!a)return!1;if(o<=23&&i<=59&&s<60)return!0;let d=i-l*c,p=o-u*c-(d<0?1:0);return(p===23||p===-1)&&(d===59||d===-1)&&s<61}}function Av(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function cS(t,e){if(!(t&&e))return;let r=Cv.exec(t),n=Cv.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var Nv=/t|\s/i;function oS(t){let e=jv(t);return function(n){let o=n.split(Nv);return o.length===2&&aS(o[0])&&e(o[1])}}function uS(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function lS(t,e){if(!(t&&e))return;let[r,n]=t.split(Nv),[o,i]=e.split(Nv),s=Rv(r,o);if(s!==void 0)return s||Av(n,i)}var mD=/\/|:/,hD=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function gD(t){return mD.test(t)&&hD.test(t)}var iS=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function vD(t){return iS.lastIndex=0,iS.test(t)}var yD=-(2**31),_D=2**31-1;function bD(t){return Number.isInteger(t)&&t<=_D&&t>=yD}function $D(t){return Number.isInteger(t)}function sS(){return!0}var wD=/[^\\]\\Z/;function xD(t){if(wD.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var Ra=b(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.regexpCode=ve.getEsmExportName=ve.getProperty=ve.safeStringify=ve.stringify=ve.strConcat=ve.addCodeArg=ve.str=ve._=ve.nil=ve._Code=ve.Name=ve.IDENTIFIER=ve._CodeOrName=void 0;var ja=class{};ve._CodeOrName=ja;ve.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var oo=class extends ja{constructor(e){if(super(),!ve.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};ve.Name=oo;var Yt=class extends ja{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof oo&&(r[n.str]=(r[n.str]||0)+1),r),{})}};ve._Code=Yt;ve.nil=new Yt("");function pS(t,...e){let r=[t[0]],n=0;for(;n<e.length;)Dv(r,e[n]),r.push(t[++n]);return new Yt(r)}ve._=pS;var Mv=new Yt("+");function fS(t,...e){let r=[Na(t[0])],n=0;for(;n<e.length;)r.push(Mv),Dv(r,e[n]),r.push(Mv,Na(t[++n]));return kD(r),new Yt(r)}ve.str=fS;function Dv(t,e){e instanceof Yt?t.push(...e._items):e instanceof oo?t.push(e):t.push(ID(e))}ve.addCodeArg=Dv;function kD(t){let e=1;for(;e<t.length-1;){if(t[e]===Mv){let r=SD(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function SD(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof oo||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof oo))return`"${t}${e.slice(1)}`}function PD(t,e){return e.emptyStr()?t:t.emptyStr()?e:fS`${t}${e}`}ve.strConcat=PD;function ID(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:Na(Array.isArray(t)?t.join(","):t)}function ED(t){return new Yt(Na(t))}ve.stringify=ED;function Na(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}ve.safeStringify=Na;function zD(t){return typeof t=="string"&&ve.IDENTIFIER.test(t)?new Yt(`.${t}`):pS`[${t}]`}ve.getProperty=zD;function TD(t){if(typeof t=="string"&&ve.IDENTIFIER.test(t))return new Yt(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}ve.getEsmExportName=TD;function OD(t){return new Yt(t.toString())}ve.regexpCode=OD});var Lv=b(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.ValueScope=Tt.ValueScopeName=Tt.Scope=Tt.varKinds=Tt.UsedValueState=void 0;var zt=Ra(),Uv=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},jl;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(jl||(Tt.UsedValueState=jl={}));Tt.varKinds={const:new zt.Name("const"),let:new zt.Name("let"),var:new zt.Name("var")};var Nl=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof zt.Name?e:this.name(e)}name(e){return new zt.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};Tt.Scope=Nl;var Rl=class extends zt.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,zt._)`.${new zt.Name(r)}[${n}]`}};Tt.ValueScopeName=Rl;var CD=(0,zt._)`\n`,qv=class extends Nl{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?CD:zt.nil}}get(){return this._scope}name(e){return new Rl(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:i}=o,s=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let l=a.get(s);if(l)return l}else a=this._values[i]=new Map;a.set(s,o);let c=this._scope[i]||(this._scope[i]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:i,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,zt._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let i=zt.nil;for(let s in e){let a=e[s];if(!a)continue;let c=n[s]=n[s]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,jl.Started);let l=r(u);if(l){let d=this.opts.es5?Tt.varKinds.var:Tt.varKinds.const;i=(0,zt._)`${i}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))i=(0,zt._)`${i}${l}${this.opts._n}`;else throw new Uv(u);c.set(u,jl.Completed)})}return i}};Tt.ValueScope=qv});var X=b(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.or=te.and=te.not=te.CodeGen=te.operators=te.varKinds=te.ValueScopeName=te.ValueScope=te.Scope=te.Name=te.regexpCode=te.stringify=te.getProperty=te.nil=te.strConcat=te.str=te._=void 0;var de=Ra(),fr=Lv(),xn=Ra();Object.defineProperty(te,"_",{enumerable:!0,get:function(){return xn._}});Object.defineProperty(te,"str",{enumerable:!0,get:function(){return xn.str}});Object.defineProperty(te,"strConcat",{enumerable:!0,get:function(){return xn.strConcat}});Object.defineProperty(te,"nil",{enumerable:!0,get:function(){return xn.nil}});Object.defineProperty(te,"getProperty",{enumerable:!0,get:function(){return xn.getProperty}});Object.defineProperty(te,"stringify",{enumerable:!0,get:function(){return xn.stringify}});Object.defineProperty(te,"regexpCode",{enumerable:!0,get:function(){return xn.regexpCode}});Object.defineProperty(te,"Name",{enumerable:!0,get:function(){return xn.Name}});var Ul=Lv();Object.defineProperty(te,"Scope",{enumerable:!0,get:function(){return Ul.Scope}});Object.defineProperty(te,"ValueScope",{enumerable:!0,get:function(){return Ul.ValueScope}});Object.defineProperty(te,"ValueScopeName",{enumerable:!0,get:function(){return Ul.ValueScopeName}});Object.defineProperty(te,"varKinds",{enumerable:!0,get:function(){return Ul.varKinds}});te.operators={GT:new de._Code(">"),GTE:new de._Code(">="),LT:new de._Code("<"),LTE:new de._Code("<="),EQ:new de._Code("==="),NEQ:new de._Code("!=="),NOT:new de._Code("!"),OR:new de._Code("||"),AND:new de._Code("&&"),ADD:new de._Code("+")};var Wr=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},Zv=class extends Wr{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?fr.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=hi(this.rhs,e,r)),this}get names(){return this.rhs instanceof de._CodeOrName?this.rhs.names:{}}},Al=class extends Wr{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof de.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=hi(this.rhs,e,r),this}get names(){let e=this.lhs instanceof de.Name?{}:{...this.lhs.names};return Dl(e,this.rhs)}},Vv=class extends Al{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},Fv=class extends Wr{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},Bv=class extends Wr{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},Hv=class extends Wr{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},Wv=class extends Wr{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=hi(this.code,e,r),this}get names(){return this.code instanceof de._CodeOrName?this.code.names:{}}},Aa=class extends Wr{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let i=n[o];i.optimizeNames(e,r)||(jD(e,i.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>ao(e,r.names),{})}},Gr=class extends Aa{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},Gv=class extends Aa{},mi=class extends Gr{};mi.kind="else";var io=class t extends Gr{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new mi(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(mS(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=hi(this.condition,e,r),this}get names(){let e=super.names;return Dl(e,this.condition),this.else&&ao(e,this.else.names),e}};io.kind="if";var so=class extends Gr{};so.kind="for";var Jv=class extends so{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=hi(this.iteration,e,r),this}get names(){return ao(super.names,this.iteration.names)}},Kv=class extends so{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?fr.varKinds.var:this.varKind,{name:n,from:o,to:i}=this;return`for(${r} ${n}=${o}; ${n}<${i}; ${n}++)`+super.render(e)}get names(){let e=Dl(super.names,this.from);return Dl(e,this.to)}},Ml=class extends so{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=hi(this.iterable,e,r),this}get names(){return ao(super.names,this.iterable.names)}},Ma=class extends Gr{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};Ma.kind="func";var Da=class extends Aa{render(e){return"return "+super.render(e)}};Da.kind="return";var Xv=class extends Gr{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&ao(e,this.catch.names),this.finally&&ao(e,this.finally.names),e}},Ua=class extends Gr{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};Ua.kind="catch";var qa=class extends Gr{render(e){return"finally"+super.render(e)}};qa.kind="finally";var Yv=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new fr.Scope({parent:e}),this._nodes=[new Gv]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let i=this._scope.toName(r);return n!==void 0&&o&&(this._constants[i.str]=n),this._leafNode(new Zv(e,i,n)),i}const(e,r,n){return this._def(fr.varKinds.const,e,r,n)}let(e,r,n){return this._def(fr.varKinds.let,e,r,n)}var(e,r,n){return this._def(fr.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Al(e,r,n))}add(e,r){return this._leafNode(new Vv(e,te.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==de.nil&&this._leafNode(new Wv(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,de.addCodeArg)(r,o));return r.push("}"),new de._Code(r)}if(e,r,n){if(this._blockNode(new io(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new io(e))}else(){return this._elseNode(new mi)}endIf(){return this._endBlockNode(io,mi)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new Jv(e),r)}forRange(e,r,n,o,i=this.opts.es5?fr.varKinds.var:fr.varKinds.let){let s=this._scope.toName(e);return this._for(new Kv(i,s,r,n),()=>o(s))}forOf(e,r,n,o=fr.varKinds.const){let i=this._scope.toName(e);if(this.opts.es5){let s=r instanceof de.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,de._)`${s}.length`,a=>{this.var(i,(0,de._)`${s}[${a}]`),n(i)})}return this._for(new Ml("of",o,i,r),()=>n(i))}forIn(e,r,n,o=this.opts.es5?fr.varKinds.var:fr.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,de._)`Object.keys(${r})`,n);let i=this._scope.toName(e);return this._for(new Ml("in",o,i,r),()=>n(i))}endFor(){return this._endBlockNode(so)}label(e){return this._leafNode(new Fv(e))}break(e){return this._leafNode(new Bv(e))}return(e){let r=new Da;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(Da)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new Xv;if(this._blockNode(o),this.code(e),r){let i=this.name("e");this._currNode=o.catch=new Ua(i),r(i)}return n&&(this._currNode=o.finally=new qa,this.code(n)),this._endBlockNode(Ua,qa)}throw(e){return this._leafNode(new Hv(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=de.nil,n,o){return this._blockNode(new Ma(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(Ma)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof io))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};te.CodeGen=Yv;function ao(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function Dl(t,e){return e instanceof de._CodeOrName?ao(t,e.names):t}function hi(t,e,r){if(t instanceof de.Name)return n(t);if(!o(t))return t;return new de._Code(t._items.reduce((i,s)=>(s instanceof de.Name&&(s=n(s)),s instanceof de._Code?i.push(...s._items):i.push(s),i),[]));function n(i){let s=r[i.str];return s===void 0||e[i.str]!==1?i:(delete e[i.str],s)}function o(i){return i instanceof de._Code&&i._items.some(s=>s instanceof de.Name&&e[s.str]===1&&r[s.str]!==void 0)}}function jD(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function mS(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,de._)`!${Qv(t)}`}te.not=mS;var ND=hS(te.operators.AND);function RD(...t){return t.reduce(ND)}te.and=RD;var AD=hS(te.operators.OR);function MD(...t){return t.reduce(AD)}te.or=MD;function hS(t){return(e,r)=>e===de.nil?r:r===de.nil?e:(0,de._)`${Qv(e)} ${t} ${Qv(r)}`}function Qv(t){return t instanceof de.Name?t:(0,de._)`(${t})`}});var ye=b(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.checkStrictMode=oe.getErrorPath=oe.Type=oe.useFunc=oe.setEvaluated=oe.evaluatedPropsToName=oe.mergeEvaluated=oe.eachItem=oe.unescapeJsonPointer=oe.escapeJsonPointer=oe.escapeFragment=oe.unescapeFragment=oe.schemaRefOrVal=oe.schemaHasRulesButRef=oe.schemaHasRules=oe.checkUnknownRules=oe.alwaysValidSchema=oe.toHash=void 0;var ze=X(),DD=Ra();function UD(t){let e={};for(let r of t)e[r]=!0;return e}oe.toHash=UD;function qD(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(yS(t,e),!_S(e,t.self.RULES.all))}oe.alwaysValidSchema=qD;function yS(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let i in e)o[i]||wS(t,`unknown keyword: "${i}"`)}oe.checkUnknownRules=yS;function _S(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}oe.schemaHasRules=_S;function LD(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}oe.schemaHasRulesButRef=LD;function ZD({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,ze._)`${r}`}return(0,ze._)`${t}${e}${(0,ze.getProperty)(n)}`}oe.schemaRefOrVal=ZD;function VD(t){return bS(decodeURIComponent(t))}oe.unescapeFragment=VD;function FD(t){return encodeURIComponent(ty(t))}oe.escapeFragment=FD;function ty(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}oe.escapeJsonPointer=ty;function bS(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}oe.unescapeJsonPointer=bS;function BD(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}oe.eachItem=BD;function gS({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,i,s,a)=>{let c=s===void 0?i:s instanceof ze.Name?(i instanceof ze.Name?t(o,i,s):e(o,i,s),s):i instanceof ze.Name?(e(o,s,i),i):r(i,s);return a===ze.Name&&!(c instanceof ze.Name)?n(o,c):c}}oe.mergeEvaluated={props:gS({mergeNames:(t,e,r)=>t.if((0,ze._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,ze._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,ze._)`${r} || {}`).code((0,ze._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,ze._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,ze._)`${r} || {}`),ry(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:$S}),items:gS({mergeNames:(t,e,r)=>t.if((0,ze._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,ze._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,ze._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,ze._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function $S(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,ze._)`{}`);return e!==void 0&&ry(t,r,e),r}oe.evaluatedPropsToName=$S;function ry(t,e,r){Object.keys(r).forEach(n=>t.assign((0,ze._)`${e}${(0,ze.getProperty)(n)}`,!0))}oe.setEvaluated=ry;var vS={};function HD(t,e){return t.scopeValue("func",{ref:e,code:vS[e.code]||(vS[e.code]=new DD._Code(e.code))})}oe.useFunc=HD;var ey;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(ey||(oe.Type=ey={}));function WD(t,e,r){if(t instanceof ze.Name){let n=e===ey.Num;return r?n?(0,ze._)`"[" + ${t} + "]"`:(0,ze._)`"['" + ${t} + "']"`:n?(0,ze._)`"/" + ${t}`:(0,ze._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,ze.getProperty)(t).toString():"/"+ty(t)}oe.getErrorPath=WD;function wS(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}oe.checkStrictMode=wS});var Jr=b(ny=>{"use strict";Object.defineProperty(ny,"__esModule",{value:!0});var ut=X(),GD={data:new ut.Name("data"),valCxt:new ut.Name("valCxt"),instancePath:new ut.Name("instancePath"),parentData:new ut.Name("parentData"),parentDataProperty:new ut.Name("parentDataProperty"),rootData:new ut.Name("rootData"),dynamicAnchors:new ut.Name("dynamicAnchors"),vErrors:new ut.Name("vErrors"),errors:new ut.Name("errors"),this:new ut.Name("this"),self:new ut.Name("self"),scope:new ut.Name("scope"),json:new ut.Name("json"),jsonPos:new ut.Name("jsonPos"),jsonLen:new ut.Name("jsonLen"),jsonPart:new ut.Name("jsonPart")};ny.default=GD});var La=b(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.extendErrors=lt.resetErrorsCount=lt.reportExtraError=lt.reportError=lt.keyword$DataError=lt.keywordError=void 0;var me=X(),ql=ye(),_t=Jr();lt.keywordError={message:({keyword:t})=>(0,me.str)`must pass "${t}" keyword validation`};lt.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,me.str)`"${t}" keyword must be ${e} ($data)`:(0,me.str)`"${t}" keyword is invalid ($data)`};function JD(t,e=lt.keywordError,r,n){let{it:o}=t,{gen:i,compositeRule:s,allErrors:a}=o,c=SS(t,e,r);n??(s||a)?xS(i,c):kS(o,(0,me._)`[${c}]`)}lt.reportError=JD;function KD(t,e=lt.keywordError,r){let{it:n}=t,{gen:o,compositeRule:i,allErrors:s}=n,a=SS(t,e,r);xS(o,a),i||s||kS(n,_t.default.vErrors)}lt.reportExtraError=KD;function XD(t,e){t.assign(_t.default.errors,e),t.if((0,me._)`${_t.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,me._)`${_t.default.vErrors}.length`,e),()=>t.assign(_t.default.vErrors,null)))}lt.resetErrorsCount=XD;function YD({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:i}){if(o===void 0)throw new Error("ajv implementation error");let s=t.name("err");t.forRange("i",o,_t.default.errors,a=>{t.const(s,(0,me._)`${_t.default.vErrors}[${a}]`),t.if((0,me._)`${s}.instancePath === undefined`,()=>t.assign((0,me._)`${s}.instancePath`,(0,me.strConcat)(_t.default.instancePath,i.errorPath))),t.assign((0,me._)`${s}.schemaPath`,(0,me.str)`${i.errSchemaPath}/${e}`),i.opts.verbose&&(t.assign((0,me._)`${s}.schema`,r),t.assign((0,me._)`${s}.data`,n))})}lt.extendErrors=YD;function xS(t,e){let r=t.const("err",e);t.if((0,me._)`${_t.default.vErrors} === null`,()=>t.assign(_t.default.vErrors,(0,me._)`[${r}]`),(0,me._)`${_t.default.vErrors}.push(${r})`),t.code((0,me._)`${_t.default.errors}++`)}function kS(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,me._)`new ${t.ValidationError}(${e})`):(r.assign((0,me._)`${n}.errors`,e),r.return(!1))}var co={keyword:new me.Name("keyword"),schemaPath:new me.Name("schemaPath"),params:new me.Name("params"),propertyName:new me.Name("propertyName"),message:new me.Name("message"),schema:new me.Name("schema"),parentSchema:new me.Name("parentSchema")};function SS(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,me._)`{}`:QD(t,e,r)}function QD(t,e,r={}){let{gen:n,it:o}=t,i=[eU(o,r),tU(t,r)];return rU(t,e,i),n.object(...i)}function eU({errorPath:t},{instancePath:e}){let r=e?(0,me.str)`${t}${(0,ql.getErrorPath)(e,ql.Type.Str)}`:t;return[_t.default.instancePath,(0,me.strConcat)(_t.default.instancePath,r)]}function tU({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,me.str)`${e}/${t}`;return r&&(o=(0,me.str)`${o}${(0,ql.getErrorPath)(r,ql.Type.Str)}`),[co.schemaPath,o]}function rU(t,{params:e,message:r},n){let{keyword:o,data:i,schemaValue:s,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([co.keyword,o],[co.params,typeof e=="function"?e(t):e||(0,me._)`{}`]),c.messages&&n.push([co.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([co.schema,s],[co.parentSchema,(0,me._)`${l}${d}`],[_t.default.data,i]),u&&n.push([co.propertyName,u])}});var IS=b(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.boolOrEmptySchema=gi.topBoolOrEmptySchema=void 0;var nU=La(),oU=X(),iU=Jr(),sU={message:"boolean schema is false"};function aU(t){let{gen:e,schema:r,validateName:n}=t;r===!1?PS(t,!1):typeof r=="object"&&r.$async===!0?e.return(iU.default.data):(e.assign((0,oU._)`${n}.errors`,null),e.return(!0))}gi.topBoolOrEmptySchema=aU;function cU(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),PS(t)):r.var(e,!0)}gi.boolOrEmptySchema=cU;function PS(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,nU.reportError)(o,sU,void 0,e)}});var oy=b(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.getRules=vi.isJSONType=void 0;var uU=["string","number","integer","boolean","null","object","array"],lU=new Set(uU);function dU(t){return typeof t=="string"&&lU.has(t)}vi.isJSONType=dU;function pU(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}vi.getRules=pU});var iy=b(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.shouldUseRule=kn.shouldUseGroup=kn.schemaHasRulesForType=void 0;function fU({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&ES(t,n)}kn.schemaHasRulesForType=fU;function ES(t,e){return e.rules.some(r=>zS(t,r))}kn.shouldUseGroup=ES;function zS(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}kn.shouldUseRule=zS});var Za=b(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.reportTypeError=dt.checkDataTypes=dt.checkDataType=dt.coerceAndCheckDataType=dt.getJSONTypes=dt.getSchemaTypes=dt.DataType=void 0;var mU=oy(),hU=iy(),gU=La(),J=X(),TS=ye(),yi;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(yi||(dt.DataType=yi={}));function vU(t){let e=OS(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}dt.getSchemaTypes=vU;function OS(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(mU.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}dt.getJSONTypes=OS;function yU(t,e){let{gen:r,data:n,opts:o}=t,i=_U(e,o.coerceTypes),s=e.length>0&&!(i.length===0&&e.length===1&&(0,hU.schemaHasRulesForType)(t,e[0]));if(s){let a=ay(e,n,o.strictNumbers,yi.Wrong);r.if(a,()=>{i.length?bU(t,e,i):cy(t)})}return s}dt.coerceAndCheckDataType=yU;var CS=new Set(["string","number","integer","boolean","null"]);function _U(t,e){return e?t.filter(r=>CS.has(r)||e==="array"&&r==="array"):[]}function bU(t,e,r){let{gen:n,data:o,opts:i}=t,s=n.let("dataType",(0,J._)`typeof ${o}`),a=n.let("coerced",(0,J._)`undefined`);i.coerceTypes==="array"&&n.if((0,J._)`${s} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,J._)`${o}[0]`).assign(s,(0,J._)`typeof ${o}`).if(ay(e,o,i.strictNumbers),()=>n.assign(a,o))),n.if((0,J._)`${a} !== undefined`);for(let u of r)(CS.has(u)||u==="array"&&i.coerceTypes==="array")&&c(u);n.else(),cy(t),n.endIf(),n.if((0,J._)`${a} !== undefined`,()=>{n.assign(o,a),$U(t,a)});function c(u){switch(u){case"string":n.elseIf((0,J._)`${s} == "number" || ${s} == "boolean"`).assign(a,(0,J._)`"" + ${o}`).elseIf((0,J._)`${o} === null`).assign(a,(0,J._)`""`);return;case"number":n.elseIf((0,J._)`${s} == "boolean" || ${o} === null
              || (${s} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,J._)`+${o}`);return;case"integer":n.elseIf((0,J._)`${s} === "boolean" || ${o} === null
              || (${s} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,J._)`+${o}`);return;case"boolean":n.elseIf((0,J._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,J._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,J._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,J._)`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${o} === null`).assign(a,(0,J._)`[${o}]`)}}}function $U({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,J._)`${e} !== undefined`,()=>t.assign((0,J._)`${e}[${r}]`,n))}function sy(t,e,r,n=yi.Correct){let o=n===yi.Correct?J.operators.EQ:J.operators.NEQ,i;switch(t){case"null":return(0,J._)`${e} ${o} null`;case"array":i=(0,J._)`Array.isArray(${e})`;break;case"object":i=(0,J._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":i=s((0,J._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":i=s();break;default:return(0,J._)`typeof ${e} ${o} ${t}`}return n===yi.Correct?i:(0,J.not)(i);function s(a=J.nil){return(0,J.and)((0,J._)`typeof ${e} == "number"`,a,r?(0,J._)`isFinite(${e})`:J.nil)}}dt.checkDataType=sy;function ay(t,e,r,n){if(t.length===1)return sy(t[0],e,r,n);let o,i=(0,TS.toHash)(t);if(i.array&&i.object){let s=(0,J._)`typeof ${e} != "object"`;o=i.null?s:(0,J._)`!${e} || ${s}`,delete i.null,delete i.array,delete i.object}else o=J.nil;i.number&&delete i.integer;for(let s in i)o=(0,J.and)(o,sy(s,e,r,n));return o}dt.checkDataTypes=ay;var wU={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,J._)`{type: ${t}}`:(0,J._)`{type: ${e}}`};function cy(t){let e=xU(t);(0,gU.reportError)(e,wU)}dt.reportTypeError=cy;function xU(t){let{gen:e,data:r,schema:n}=t,o=(0,TS.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var NS=b(Ll=>{"use strict";Object.defineProperty(Ll,"__esModule",{value:!0});Ll.assignDefaults=void 0;var _i=X(),kU=ye();function SU(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)jS(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,i)=>jS(t,i,o.default))}Ll.assignDefaults=SU;function jS(t,e,r){let{gen:n,compositeRule:o,data:i,opts:s}=t;if(r===void 0)return;let a=(0,_i._)`${i}${(0,_i.getProperty)(e)}`;if(o){(0,kU.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,_i._)`${a} === undefined`;s.useDefaults==="empty"&&(c=(0,_i._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,_i._)`${a} = ${(0,_i.stringify)(r)}`)}});var Qt=b(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.validateUnion=ke.validateArray=ke.usePattern=ke.callValidateCode=ke.schemaProperties=ke.allSchemaProperties=ke.noPropertyInData=ke.propertyInData=ke.isOwnProperty=ke.hasPropFunc=ke.reportMissingProp=ke.checkMissingProp=ke.checkReportMissingProp=void 0;var Re=X(),uy=ye(),Sn=Jr(),PU=ye();function IU(t,e){let{gen:r,data:n,it:o}=t;r.if(dy(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,Re._)`${e}`},!0),t.error()})}ke.checkReportMissingProp=IU;function EU({gen:t,data:e,it:{opts:r}},n,o){return(0,Re.or)(...n.map(i=>(0,Re.and)(dy(t,e,i,r.ownProperties),(0,Re._)`${o} = ${i}`)))}ke.checkMissingProp=EU;function zU(t,e){t.setParams({missingProperty:e},!0),t.error()}ke.reportMissingProp=zU;function RS(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,Re._)`Object.prototype.hasOwnProperty`})}ke.hasPropFunc=RS;function ly(t,e,r){return(0,Re._)`${RS(t)}.call(${e}, ${r})`}ke.isOwnProperty=ly;function TU(t,e,r,n){let o=(0,Re._)`${e}${(0,Re.getProperty)(r)} !== undefined`;return n?(0,Re._)`${o} && ${ly(t,e,r)}`:o}ke.propertyInData=TU;function dy(t,e,r,n){let o=(0,Re._)`${e}${(0,Re.getProperty)(r)} === undefined`;return n?(0,Re.or)(o,(0,Re.not)(ly(t,e,r))):o}ke.noPropertyInData=dy;function AS(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}ke.allSchemaProperties=AS;function OU(t,e){return AS(e).filter(r=>!(0,uy.alwaysValidSchema)(t,e[r]))}ke.schemaProperties=OU;function CU({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:i},it:s},a,c,u){let l=u?(0,Re._)`${t}, ${e}, ${n}${o}`:e,d=[[Sn.default.instancePath,(0,Re.strConcat)(Sn.default.instancePath,i)],[Sn.default.parentData,s.parentData],[Sn.default.parentDataProperty,s.parentDataProperty],[Sn.default.rootData,Sn.default.rootData]];s.opts.dynamicRef&&d.push([Sn.default.dynamicAnchors,Sn.default.dynamicAnchors]);let p=(0,Re._)`${l}, ${r.object(...d)}`;return c!==Re.nil?(0,Re._)`${a}.call(${c}, ${p})`:(0,Re._)`${a}(${p})`}ke.callValidateCode=CU;var jU=(0,Re._)`new RegExp`;function NU({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,i=o(r,n);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,Re._)`${o.code==="new RegExp"?jU:(0,PU.useFunc)(t,o)}(${r}, ${n})`})}ke.usePattern=NU;function RU(t){let{gen:e,data:r,keyword:n,it:o}=t,i=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(i,!0),s(()=>e.break()),i;function s(a){let c=e.const("len",(0,Re._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:uy.Type.Num},i),e.if((0,Re.not)(i),a)})}}ke.validateArray=RU;function AU(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,uy.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let s=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(s,(0,Re._)`${s} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,Re.not)(s))})),t.result(s,()=>t.reset(),()=>t.error(!0))}ke.validateUnion=AU});var US=b(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.validateKeywordUsage=Tr.validSchemaType=Tr.funcKeywordCode=Tr.macroKeywordCode=void 0;var bt=X(),uo=Jr(),MU=Qt(),DU=La();function UU(t,e){let{gen:r,keyword:n,schema:o,parentSchema:i,it:s}=t,a=e.macro.call(s.self,o,i,s),c=DS(r,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:bt.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}Tr.macroKeywordCode=UU;function qU(t,e){var r;let{gen:n,keyword:o,schema:i,parentSchema:s,$data:a,it:c}=t;ZU(c,e);let u=!a&&e.compile?e.compile.call(c.self,i,s,c):e.validate,l=DS(n,o,u),d=n.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)m(),e.modifying&&MS(t),g(()=>t.error());else{let v=e.async?f():h();e.modifying&&MS(t),g(()=>LU(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>m((0,bt._)`await `),$=>n.assign(d,!1).if((0,bt._)`${$} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,bt._)`${$}.errors`),()=>n.throw($))),v}function h(){let v=(0,bt._)`${l}.errors`;return n.assign(v,null),m(bt.nil),v}function m(v=e.async?(0,bt._)`await `:bt.nil){let $=c.opts.passContext?uo.default.this:uo.default.self,x=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,bt._)`${v}${(0,MU.callValidateCode)(t,l,$,x)}`,e.modifying)}function g(v){var $;n.if((0,bt.not)(($=e.valid)!==null&&$!==void 0?$:d),v)}}Tr.funcKeywordCode=qU;function MS(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,bt._)`${n.parentData}[${n.parentDataProperty}]`))}function LU(t,e){let{gen:r}=t;r.if((0,bt._)`Array.isArray(${e})`,()=>{r.assign(uo.default.vErrors,(0,bt._)`${uo.default.vErrors} === null ? ${e} : ${uo.default.vErrors}.concat(${e})`).assign(uo.default.errors,(0,bt._)`${uo.default.vErrors}.length`),(0,DU.extendErrors)(t)},()=>t.error())}function ZU({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function DS(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,bt.stringify)(r)})}function VU(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}Tr.validSchemaType=VU;function FU({schema:t,opts:e,self:r,errSchemaPath:n},o,i){if(Array.isArray(o.keyword)?!o.keyword.includes(i):o.keyword!==i)throw new Error("ajv implementation error");let s=o.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${i}: ${s.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[i])){let c=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}Tr.validateKeywordUsage=FU});var LS=b(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.extendSubschemaMode=Pn.extendSubschemaData=Pn.getSubschema=void 0;var Or=X(),qS=ye();function BU(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:i,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,Or._)`${t.schemaPath}${(0,Or.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,Or._)`${t.schemaPath}${(0,Or.getProperty)(e)}${(0,Or.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,qS.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||i===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:s,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}Pn.getSubschema=BU;function HU(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:i,propertyName:s}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,p=a.let("data",(0,Or._)`${e.data}${(0,Or.getProperty)(r)}`,!0);c(p),t.errorPath=(0,Or.str)`${u}${(0,qS.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,Or._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof Or.Name?o:a.let("data",o,!0);c(u),s!==void 0&&(t.propertyName=s)}i&&(t.dataTypes=i);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}Pn.extendSubschemaData=HU;function WU(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:i}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),i!==void 0&&(t.allErrors=i),t.jtdDiscriminator=e,t.jtdMetadata=r}Pn.extendSubschemaMode=WU});var VS=b((H8,ZS)=>{"use strict";var In=ZS.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};Zl(e,n,o,t,"",t)};In.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};In.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};In.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};In.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Zl(t,e,r,n,o,i,s,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,i,s,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in In.arrayKeywords)for(var p=0;p<d.length;p++)Zl(t,e,r,d[p],o+"/"+l+"/"+p,i,o,l,n,p)}else if(l in In.propsKeywords){if(d&&typeof d=="object")for(var f in d)Zl(t,e,r,d[f],o+"/"+l+"/"+GU(f),i,o,l,n,f)}else(l in In.keywords||t.allKeys&&!(l in In.skipKeywords))&&Zl(t,e,r,d,o+"/"+l,i,o,l,n)}r(n,o,i,s,a,c,u)}}function GU(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var Va=b(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.getSchemaRefs=Ot.resolveUrl=Ot.normalizeId=Ot._getFullPath=Ot.getFullPath=Ot.inlineRef=void 0;var JU=ye(),KU=ma(),XU=VS(),YU=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function QU(t,e=!0){return typeof t=="boolean"?!0:e===!0?!py(t):e?FS(t)<=e:!1}Ot.inlineRef=QU;var eq=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function py(t){for(let e in t){if(eq.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(py)||typeof r=="object"&&py(r))return!0}return!1}function FS(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!YU.has(r)&&(typeof t[r]=="object"&&(0,JU.eachItem)(t[r],n=>e+=FS(n)),e===1/0))return 1/0}return e}function BS(t,e="",r){r!==!1&&(e=bi(e));let n=t.parse(e);return HS(t,n)}Ot.getFullPath=BS;function HS(t,e){return t.serialize(e).split("#")[0]+"#"}Ot._getFullPath=HS;var tq=/#\/?$/;function bi(t){return t?t.replace(tq,""):""}Ot.normalizeId=bi;function rq(t,e,r){return r=bi(r),t.resolve(e,r)}Ot.resolveUrl=rq;var nq=/^[a-z_][-a-z0-9._]*$/i;function oq(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=bi(t[r]||e),i={"":o},s=BS(n,o,!1),a={},c=new Set;return XU(t,{allKeys:!0},(d,p,f,h)=>{if(h===void 0)return;let m=s+p,g=i[h];typeof d[r]=="string"&&(g=v.call(this,d[r])),$.call(this,d.$anchor),$.call(this,d.$dynamicAnchor),i[p]=g;function v(x){let I=this.opts.uriResolver.resolve;if(x=bi(g?I(g,x):x),c.has(x))throw l(x);c.add(x);let k=this.refs[x];return typeof k=="string"&&(k=this.refs[k]),typeof k=="object"?u(d,k.schema,x):x!==bi(m)&&(x[0]==="#"?(u(d,a[x],x),a[x]=d):this.refs[x]=m),x}function $(x){if(typeof x=="string"){if(!nq.test(x))throw new Error(`invalid anchor "${x}"`);v.call(this,`#${x}`)}}}),a;function u(d,p,f){if(p!==void 0&&!KU(d,p))throw l(f)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}Ot.getSchemaRefs=oq});var Ha=b(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.getData=En.KeywordCxt=En.validateFunctionCode=void 0;var XS=IS(),WS=Za(),my=iy(),Vl=Za(),iq=NS(),Ba=US(),fy=LS(),A=X(),B=Jr(),sq=Va(),Kr=ye(),Fa=La();function aq(t){if(eP(t)&&(tP(t),QS(t))){lq(t);return}YS(t,()=>(0,XS.topBoolOrEmptySchema)(t))}En.validateFunctionCode=aq;function YS({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},i){o.code.es5?t.func(e,(0,A._)`${B.default.data}, ${B.default.valCxt}`,n.$async,()=>{t.code((0,A._)`"use strict"; ${GS(r,o)}`),uq(t,o),t.code(i)}):t.func(e,(0,A._)`${B.default.data}, ${cq(o)}`,n.$async,()=>t.code(GS(r,o)).code(i))}function cq(t){return(0,A._)`{${B.default.instancePath}="", ${B.default.parentData}, ${B.default.parentDataProperty}, ${B.default.rootData}=${B.default.data}${t.dynamicRef?(0,A._)`, ${B.default.dynamicAnchors}={}`:A.nil}}={}`}function uq(t,e){t.if(B.default.valCxt,()=>{t.var(B.default.instancePath,(0,A._)`${B.default.valCxt}.${B.default.instancePath}`),t.var(B.default.parentData,(0,A._)`${B.default.valCxt}.${B.default.parentData}`),t.var(B.default.parentDataProperty,(0,A._)`${B.default.valCxt}.${B.default.parentDataProperty}`),t.var(B.default.rootData,(0,A._)`${B.default.valCxt}.${B.default.rootData}`),e.dynamicRef&&t.var(B.default.dynamicAnchors,(0,A._)`${B.default.valCxt}.${B.default.dynamicAnchors}`)},()=>{t.var(B.default.instancePath,(0,A._)`""`),t.var(B.default.parentData,(0,A._)`undefined`),t.var(B.default.parentDataProperty,(0,A._)`undefined`),t.var(B.default.rootData,B.default.data),e.dynamicRef&&t.var(B.default.dynamicAnchors,(0,A._)`{}`)})}function lq(t){let{schema:e,opts:r,gen:n}=t;YS(t,()=>{r.$comment&&e.$comment&&nP(t),hq(t),n.let(B.default.vErrors,null),n.let(B.default.errors,0),r.unevaluated&&dq(t),rP(t),yq(t)})}function dq(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,A._)`${r}.evaluated`),e.if((0,A._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,A._)`${t.evaluated}.props`,(0,A._)`undefined`)),e.if((0,A._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,A._)`${t.evaluated}.items`,(0,A._)`undefined`))}function GS(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,A._)`/*# sourceURL=${r} */`:A.nil}function pq(t,e){if(eP(t)&&(tP(t),QS(t))){fq(t,e);return}(0,XS.boolOrEmptySchema)(t,e)}function QS({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function eP(t){return typeof t.schema!="boolean"}function fq(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&nP(t),gq(t),vq(t);let i=n.const("_errs",B.default.errors);rP(t,i),n.var(e,(0,A._)`${i} === ${B.default.errors}`)}function tP(t){(0,Kr.checkUnknownRules)(t),mq(t)}function rP(t,e){if(t.opts.jtd)return JS(t,[],!1,e);let r=(0,WS.getSchemaTypes)(t.schema),n=(0,WS.coerceAndCheckDataType)(t,r);JS(t,r,!n,e)}function mq(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Kr.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function hq(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Kr.checkStrictMode)(t,"default is ignored in the schema root")}function gq(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,sq.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function vq(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function nP({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let i=r.$comment;if(o.$comment===!0)t.code((0,A._)`${B.default.self}.logger.log(${i})`);else if(typeof o.$comment=="function"){let s=(0,A.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,A._)`${B.default.self}.opts.$comment(${i}, ${s}, ${a}.schema)`)}}function yq(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:i}=t;r.$async?e.if((0,A._)`${B.default.errors} === 0`,()=>e.return(B.default.data),()=>e.throw((0,A._)`new ${o}(${B.default.vErrors})`)):(e.assign((0,A._)`${n}.errors`,B.default.vErrors),i.unevaluated&&_q(t),e.return((0,A._)`${B.default.errors} === 0`))}function _q({gen:t,evaluated:e,props:r,items:n}){r instanceof A.Name&&t.assign((0,A._)`${e}.props`,r),n instanceof A.Name&&t.assign((0,A._)`${e}.items`,n)}function JS(t,e,r,n){let{gen:o,schema:i,data:s,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(i.$ref&&(c.ignoreKeywordsWithRef||!(0,Kr.schemaHasRulesButRef)(i,l))){o.block(()=>iP(t,"$ref",l.all.$ref.definition));return}c.jtd||bq(t,e),o.block(()=>{for(let p of l.rules)d(p);d(l.post)});function d(p){(0,my.shouldUseGroup)(i,p)&&(p.type?(o.if((0,Vl.checkDataType)(p.type,s,c.strictNumbers)),KS(t,p),e.length===1&&e[0]===p.type&&r&&(o.else(),(0,Vl.reportTypeError)(t)),o.endIf()):KS(t,p),a||o.if((0,A._)`${B.default.errors} === ${n||0}`))}}function KS(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,iq.assignDefaults)(t,e.type),r.block(()=>{for(let i of e.rules)(0,my.shouldUseRule)(n,i)&&iP(t,i.keyword,i.definition,e.type)})}function bq(t,e){t.schemaEnv.meta||!t.opts.strictTypes||($q(t,e),t.opts.allowUnionTypes||wq(t,e),xq(t,t.dataTypes))}function $q(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{oP(t.dataTypes,r)||hy(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),Sq(t,e)}}function wq(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&hy(t,"use allowUnionTypes to allow union type keyword")}function xq(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,my.shouldUseRule)(t.schema,o)){let{type:i}=o.definition;i.length&&!i.some(s=>kq(e,s))&&hy(t,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function kq(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function oP(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function Sq(t,e){let r=[];for(let n of t.dataTypes)oP(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function hy(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Kr.checkStrictMode)(t,e,t.opts.strictTypes)}var Fl=class{constructor(e,r,n){if((0,Ba.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Kr.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",sP(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,Ba.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",B.default.errors))}result(e,r,n){this.failResult((0,A.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,A.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,A._)`${r} !== undefined && (${(0,A.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?Fa.reportExtraError:Fa.reportError)(this,this.def.error,r)}$dataError(){(0,Fa.reportError)(this,this.def.$dataError||Fa.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Fa.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=A.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=A.nil,r=A.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:i,def:s}=this;n.if((0,A.or)((0,A._)`${o} === undefined`,r)),e!==A.nil&&n.assign(e,!0),(i.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==A.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:i}=this;return(0,A.or)(s(),a());function s(){if(n.length){if(!(r instanceof A.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,A._)`${(0,Vl.checkDataTypes)(c,r,i.opts.strictNumbers,Vl.DataType.Wrong)}`}return A.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,A._)`!${c}(${r})`}return A.nil}}subschema(e,r){let n=(0,fy.getSubschema)(this.it,e);(0,fy.extendSubschemaData)(n,this.it,e),(0,fy.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return pq(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Kr.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Kr.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,A.Name)),!0}};En.KeywordCxt=Fl;function iP(t,e,r,n){let o=new Fl(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,Ba.funcKeywordCode)(o,r):"macro"in r?(0,Ba.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,Ba.funcKeywordCode)(o,r)}var Pq=/^\/(?:[^~]|~0|~1)*$/,Iq=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function sP(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,i;if(t==="")return B.default.rootData;if(t[0]==="/"){if(!Pq.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,i=B.default.rootData}else{let u=Iq.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(i=r[e-l],!o)return i}let s=i,a=o.split("/");for(let u of a)u&&(i=(0,A._)`${i}${(0,A.getProperty)((0,Kr.unescapeJsonPointer)(u))}`,s=(0,A._)`${s} && ${i}`);return s;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}En.getData=sP});var Bl=b(vy=>{"use strict";Object.defineProperty(vy,"__esModule",{value:!0});var gy=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};vy.default=gy});var Wa=b(by=>{"use strict";Object.defineProperty(by,"__esModule",{value:!0});var yy=Va(),_y=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,yy.resolveUrl)(e,r,n),this.missingSchema=(0,yy.normalizeId)((0,yy.getFullPath)(e,this.missingRef))}};by.default=_y});var Wl=b(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.resolveSchema=er.getCompilingSchema=er.resolveRef=er.compileSchema=er.SchemaEnv=void 0;var mr=X(),Eq=Bl(),lo=Jr(),hr=Va(),aP=ye(),zq=Ha(),$i=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,hr.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};er.SchemaEnv=$i;function wy(t){let e=cP.call(this,t);if(e)return e;let r=(0,hr.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:i}=this.opts,s=new mr.CodeGen(this.scope,{es5:n,lines:o,ownProperties:i}),a;t.$async&&(a=s.scopeValue("Error",{ref:Eq.default,code:(0,mr._)`require("ajv/dist/runtime/validation_error").default`}));let c=s.scopeName("validate");t.validateName=c;let u={gen:s,allErrors:this.opts.allErrors,data:lo.default.data,parentData:lo.default.parentData,parentDataProperty:lo.default.parentDataProperty,dataNames:[lo.default.data],dataPathArr:[mr.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,mr.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:mr.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,mr._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,zq.validateFunctionCode)(u),s.optimize(this.opts.code.optimize);let d=s.toString();l=`${s.scopeRefs(lo.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let f=new Function(`${lo.default.self}`,`${lo.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:s._values}),this.opts.unevaluated){let{props:h,items:m}=u;f.evaluated={props:h instanceof mr.Name?void 0:h,items:m instanceof mr.Name?void 0:m,dynamicProps:h instanceof mr.Name,dynamicItems:m instanceof mr.Name},f.source&&(f.source.evaluated=(0,mr.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}er.compileSchema=wy;function Tq(t,e,r){var n;r=(0,hr.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let i=jq.call(this,t,r);if(i===void 0){let s=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;s&&(i=new $i({schema:s,schemaId:a,root:t,baseId:e}))}if(i!==void 0)return t.refs[r]=Oq.call(this,i)}er.resolveRef=Tq;function Oq(t){return(0,hr.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:wy.call(this,t)}function cP(t){for(let e of this._compilations)if(Cq(e,t))return e}er.getCompilingSchema=cP;function Cq(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function jq(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||Hl.call(this,t,e)}function Hl(t,e){let r=this.opts.uriResolver.parse(e),n=(0,hr._getFullPath)(this.opts.uriResolver,r),o=(0,hr.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return $y.call(this,r,t);let i=(0,hr.normalizeId)(n),s=this.refs[i]||this.schemas[i];if(typeof s=="string"){let a=Hl.call(this,t,s);return typeof a?.schema!="object"?void 0:$y.call(this,r,a)}if(typeof s?.schema=="object"){if(s.validate||wy.call(this,s),i===(0,hr.normalizeId)(e)){let{schema:a}=s,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,hr.resolveUrl)(this.opts.uriResolver,o,u)),new $i({schema:a,schemaId:c,root:t,baseId:o})}return $y.call(this,r,s)}}er.resolveSchema=Hl;var Nq=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function $y(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,aP.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!Nq.has(a)&&u&&(e=(0,hr.resolveUrl)(this.opts.uriResolver,e,u))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,aP.schemaHasRulesButRef)(r,this.RULES)){let a=(0,hr.resolveUrl)(this.opts.uriResolver,e,r.$ref);i=Hl.call(this,n,a)}let{schemaId:s}=this.opts;if(i=i||new $i({schema:r,schemaId:s,root:n,baseId:e}),i.schema!==i.root.schema)return i}});var uP=b((Y8,Rq)=>{Rq.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var dP=b(xy=>{"use strict";Object.defineProperty(xy,"__esModule",{value:!0});var lP=Ug();lP.code='require("ajv/dist/runtime/uri").default';xy.default=lP});var _P=b(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.CodeGen=tt.Name=tt.nil=tt.stringify=tt.str=tt._=tt.KeywordCxt=void 0;var Aq=Ha();Object.defineProperty(tt,"KeywordCxt",{enumerable:!0,get:function(){return Aq.KeywordCxt}});var wi=X();Object.defineProperty(tt,"_",{enumerable:!0,get:function(){return wi._}});Object.defineProperty(tt,"str",{enumerable:!0,get:function(){return wi.str}});Object.defineProperty(tt,"stringify",{enumerable:!0,get:function(){return wi.stringify}});Object.defineProperty(tt,"nil",{enumerable:!0,get:function(){return wi.nil}});Object.defineProperty(tt,"Name",{enumerable:!0,get:function(){return wi.Name}});Object.defineProperty(tt,"CodeGen",{enumerable:!0,get:function(){return wi.CodeGen}});var Mq=Bl(),gP=Wa(),Dq=oy(),Ga=Wl(),Uq=X(),Ja=Va(),Gl=Za(),Sy=ye(),pP=uP(),qq=dP(),vP=(t,e)=>new RegExp(t,e);vP.code="new RegExp";var Lq=["removeAdditional","useDefaults","coerceTypes"],Zq=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),Vq={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Fq={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},fP=200;function Bq(t){var e,r,n,o,i,s,a,c,u,l,d,p,f,h,m,g,v,$,x,I,k,ie,se,Y,be;let We=t.strict,or=(e=t.code)===null||e===void 0?void 0:e.optimize,br=or===!0||or===void 0?1:or||0,Bi=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:vP,Zd=(o=t.uriResolver)!==null&&o!==void 0?o:qq.default;return{strictSchema:(s=(i=t.strictSchema)!==null&&i!==void 0?i:We)!==null&&s!==void 0?s:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:We)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:We)!==null&&l!==void 0?l:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:We)!==null&&p!==void 0?p:"log",strictRequired:(h=(f=t.strictRequired)!==null&&f!==void 0?f:We)!==null&&h!==void 0?h:!1,code:t.code?{...t.code,optimize:br,regExp:Bi}:{optimize:br,regExp:Bi},loopRequired:(m=t.loopRequired)!==null&&m!==void 0?m:fP,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:fP,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:($=t.messages)!==null&&$!==void 0?$:!0,inlineRefs:(x=t.inlineRefs)!==null&&x!==void 0?x:!0,schemaId:(I=t.schemaId)!==null&&I!==void 0?I:"$id",addUsedSchema:(k=t.addUsedSchema)!==null&&k!==void 0?k:!0,validateSchema:(ie=t.validateSchema)!==null&&ie!==void 0?ie:!0,validateFormats:(se=t.validateFormats)!==null&&se!==void 0?se:!0,unicodeRegExp:(Y=t.unicodeRegExp)!==null&&Y!==void 0?Y:!0,int32range:(be=t.int32range)!==null&&be!==void 0?be:!0,uriResolver:Zd}}var Ka=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...Bq(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new Uq.ValueScope({scope:{},prefixes:Zq,es5:r,lines:n}),this.logger=Xq(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,Dq.getRules)(),mP.call(this,Vq,e,"NOT SUPPORTED"),mP.call(this,Fq,e,"DEPRECATED","warn"),this._metaOpts=Jq.call(this),e.formats&&Wq.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&Gq.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),Hq.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=pP;n==="id"&&(o={...pP},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await i.call(this,l.$schema);let p=this._addSchema(l,d);return p.validate||s.call(this,p)}async function i(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function s(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof gP.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),s.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await i.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let s of e)this.addSchema(s,void 0,n,o);return this}let i;if(typeof e=="object"){let{schemaId:s}=this.opts;if(i=e[s],i!==void 0&&typeof i!="string")throw new Error(`schema ${s} must be string`)}return r=(0,Ja.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return o}getSchema(e){let r;for(;typeof(r=hP.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new Ga.SchemaEnv({schema:{},schemaId:n});if(r=Ga.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=hP.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,Ja.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Qq.call(this,n,r),!r)return(0,Sy.eachItem)(n,i=>ky.call(this,i)),this;tL.call(this,r);let o={...r,type:(0,Gl.getJSONTypes)(r.type),schemaType:(0,Gl.getJSONTypes)(r.schemaType)};return(0,Sy.eachItem)(n,o.type.length===0?i=>ky.call(this,i,o):i=>o.type.forEach(s=>ky.call(this,i,o,s))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(i=>i.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,i)=>o+r+i)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let i=o.split("/").slice(1),s=e;for(let a of i)s=s[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=s[a];u&&l&&(s[a]=yP(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,i=this.opts.addUsedSchema){let s,{schemaId:a}=this.opts;if(typeof e=="object")s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,Ja.normalizeId)(s||n);let u=Ja.getSchemaRefs.call(this,e,n);return c=new Ga.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):Ga.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{Ga.compileSchema.call(this,e)}finally{this.opts=r}}};Ka.ValidationError=Mq.default;Ka.MissingRefError=gP.default;tt.default=Ka;function mP(t,e,r,n="error"){for(let o in t){let i=o;i in e&&this.logger[n](`${r}: option ${o}. ${t[i]}`)}}function hP(t){return t=(0,Ja.normalizeId)(t),this.schemas[t]||this.refs[t]}function Hq(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function Wq(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function Gq(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function Jq(){let t={...this.opts};for(let e of Lq)delete t[e];return t}var Kq={log(){},warn(){},error(){}};function Xq(t){if(t===!1)return Kq;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var Yq=/^[a-z_$][a-z0-9_$:-]*$/i;function Qq(t,e){let{RULES:r}=this;if((0,Sy.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!Yq.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function ky(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,s=o?i.post:i.rules.find(({type:c})=>c===r);if(s||(s={type:r,rules:[]},i.rules.push(s)),i.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,Gl.getJSONTypes)(e.type),schemaType:(0,Gl.getJSONTypes)(e.schemaType)}};e.before?eL.call(this,s,a,e.before):s.rules.push(a),i.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function eL(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function tL(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=yP(e)),t.validateSchema=this.compile(e,!0))}var rL={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function yP(t){return{anyOf:[t,rL]}}});var bP=b(Py=>{"use strict";Object.defineProperty(Py,"__esModule",{value:!0});var nL={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Py.default=nL});var kP=b(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.callRef=po.getValidate=void 0;var oL=Wa(),$P=Qt(),Ct=X(),xi=Jr(),wP=Wl(),Jl=ye(),iL={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:i,validateName:s,opts:a,self:c}=n,{root:u}=i;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=wP.resolveRef.call(c,u,o,r);if(l===void 0)throw new oL.default(n.opts.uriResolver,o,r);if(l instanceof wP.SchemaEnv)return p(l);return f(l);function d(){if(i===u)return Kl(t,s,i,i.$async);let h=e.scopeValue("root",{ref:u});return Kl(t,(0,Ct._)`${h}.validate`,u,u.$async)}function p(h){let m=xP(t,h);Kl(t,m,h,h.$async)}function f(h){let m=e.scopeValue("schema",a.code.source===!0?{ref:h,code:(0,Ct.stringify)(h)}:{ref:h}),g=e.name("valid"),v=t.subschema({schema:h,dataTypes:[],schemaPath:Ct.nil,topSchemaRef:m,errSchemaPath:r},g);t.mergeEvaluated(v),t.ok(g)}}};function xP(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Ct._)`${r.scopeValue("wrapper",{ref:e})}.validate`}po.getValidate=xP;function Kl(t,e,r,n){let{gen:o,it:i}=t,{allErrors:s,schemaEnv:a,opts:c}=i,u=c.passContext?xi.default.this:Ct.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let h=o.let("valid");o.try(()=>{o.code((0,Ct._)`await ${(0,$P.callValidateCode)(t,e,u)}`),f(e),s||o.assign(h,!0)},m=>{o.if((0,Ct._)`!(${m} instanceof ${i.ValidationError})`,()=>o.throw(m)),p(m),s||o.assign(h,!1)}),t.ok(h)}function d(){t.result((0,$P.callValidateCode)(t,e,u),()=>f(e),()=>p(e))}function p(h){let m=(0,Ct._)`${h}.errors`;o.assign(xi.default.vErrors,(0,Ct._)`${xi.default.vErrors} === null ? ${m} : ${xi.default.vErrors}.concat(${m})`),o.assign(xi.default.errors,(0,Ct._)`${xi.default.vErrors}.length`)}function f(h){var m;if(!i.opts.unevaluated)return;let g=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(i.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(i.props=Jl.mergeEvaluated.props(o,g.props,i.props));else{let v=o.var("props",(0,Ct._)`${h}.evaluated.props`);i.props=Jl.mergeEvaluated.props(o,v,i.props,Ct.Name)}if(i.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(i.items=Jl.mergeEvaluated.items(o,g.items,i.items));else{let v=o.var("items",(0,Ct._)`${h}.evaluated.items`);i.items=Jl.mergeEvaluated.items(o,v,i.items,Ct.Name)}}}po.callRef=Kl;po.default=iL});var SP=b(Iy=>{"use strict";Object.defineProperty(Iy,"__esModule",{value:!0});var sL=bP(),aL=kP(),cL=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",sL.default,aL.default];Iy.default=cL});var PP=b(Ey=>{"use strict";Object.defineProperty(Ey,"__esModule",{value:!0});var Xl=X(),zn=Xl.operators,Yl={maximum:{okStr:"<=",ok:zn.LTE,fail:zn.GT},minimum:{okStr:">=",ok:zn.GTE,fail:zn.LT},exclusiveMaximum:{okStr:"<",ok:zn.LT,fail:zn.GTE},exclusiveMinimum:{okStr:">",ok:zn.GT,fail:zn.LTE}},uL={message:({keyword:t,schemaCode:e})=>(0,Xl.str)`must be ${Yl[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Xl._)`{comparison: ${Yl[t].okStr}, limit: ${e}}`},lL={keyword:Object.keys(Yl),type:"number",schemaType:"number",$data:!0,error:uL,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,Xl._)`${r} ${Yl[e].fail} ${n} || isNaN(${r})`)}};Ey.default=lL});var IP=b(zy=>{"use strict";Object.defineProperty(zy,"__esModule",{value:!0});var Xa=X(),dL={message:({schemaCode:t})=>(0,Xa.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,Xa._)`{multipleOf: ${t}}`},pL={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:dL,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,i=o.opts.multipleOfPrecision,s=e.let("res"),a=i?(0,Xa._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${i}`:(0,Xa._)`${s} !== parseInt(${s})`;t.fail$data((0,Xa._)`(${n} === 0 || (${s} = ${r}/${n}, ${a}))`)}};zy.default=pL});var zP=b(Ty=>{"use strict";Object.defineProperty(Ty,"__esModule",{value:!0});function EP(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}Ty.default=EP;EP.code='require("ajv/dist/runtime/ucs2length").default'});var TP=b(Oy=>{"use strict";Object.defineProperty(Oy,"__esModule",{value:!0});var fo=X(),fL=ye(),mL=zP(),hL={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,fo.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,fo._)`{limit: ${t}}`},gL={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:hL,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,i=e==="maxLength"?fo.operators.GT:fo.operators.LT,s=o.opts.unicode===!1?(0,fo._)`${r}.length`:(0,fo._)`${(0,fL.useFunc)(t.gen,mL.default)}(${r})`;t.fail$data((0,fo._)`${s} ${i} ${n}`)}};Oy.default=gL});var OP=b(Cy=>{"use strict";Object.defineProperty(Cy,"__esModule",{value:!0});var vL=Qt(),Ql=X(),yL={message:({schemaCode:t})=>(0,Ql.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,Ql._)`{pattern: ${t}}`},_L={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:yL,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:i}=t,s=i.opts.unicodeRegExp?"u":"",a=r?(0,Ql._)`(new RegExp(${o}, ${s}))`:(0,vL.usePattern)(t,n);t.fail$data((0,Ql._)`!${a}.test(${e})`)}};Cy.default=_L});var CP=b(jy=>{"use strict";Object.defineProperty(jy,"__esModule",{value:!0});var Ya=X(),bL={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,Ya.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Ya._)`{limit: ${t}}`},$L={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:bL,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?Ya.operators.GT:Ya.operators.LT;t.fail$data((0,Ya._)`Object.keys(${r}).length ${o} ${n}`)}};jy.default=$L});var jP=b(Ny=>{"use strict";Object.defineProperty(Ny,"__esModule",{value:!0});var Qa=Qt(),ec=X(),wL=ye(),xL={message:({params:{missingProperty:t}})=>(0,ec.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,ec._)`{missingProperty: ${t}}`},kL={keyword:"required",type:"object",schemaType:"array",$data:!0,error:xL,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:i,it:s}=t,{opts:a}=s;if(!i&&r.length===0)return;let c=r.length>=a.loopRequired;if(s.allErrors?u():l(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:h}=t.it;for(let m of r)if(f?.[m]===void 0&&!h.has(m)){let g=s.schemaEnv.baseId+s.errSchemaPath,v=`required property "${m}" is not defined at "${g}" (strictRequired)`;(0,wL.checkStrictMode)(s,v,s.opts.strictRequired)}}function u(){if(c||i)t.block$data(ec.nil,d);else for(let f of r)(0,Qa.checkReportMissingProp)(t,f)}function l(){let f=e.let("missing");if(c||i){let h=e.let("valid",!0);t.block$data(h,()=>p(f,h)),t.ok(h)}else e.if((0,Qa.checkMissingProp)(t,r,f)),(0,Qa.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,Qa.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function p(f,h){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(h,(0,Qa.propertyInData)(e,o,f,a.ownProperties)),e.if((0,ec.not)(h),()=>{t.error(),e.break()})},ec.nil)}}};Ny.default=kL});var NP=b(Ry=>{"use strict";Object.defineProperty(Ry,"__esModule",{value:!0});var tc=X(),SL={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,tc.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,tc._)`{limit: ${t}}`},PL={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:SL,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?tc.operators.GT:tc.operators.LT;t.fail$data((0,tc._)`${r}.length ${o} ${n}`)}};Ry.default=PL});var ed=b(Ay=>{"use strict";Object.defineProperty(Ay,"__esModule",{value:!0});var RP=ma();RP.code='require("ajv/dist/runtime/equal").default';Ay.default=RP});var AP=b(Dy=>{"use strict";Object.defineProperty(Dy,"__esModule",{value:!0});var My=Za(),rt=X(),IL=ye(),EL=ed(),zL={message:({params:{i:t,j:e}})=>(0,rt.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,rt._)`{i: ${t}, j: ${e}}`},TL={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:zL,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:i,schemaCode:s,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=i.items?(0,My.getSchemaTypes)(i.items):[];t.block$data(c,l,(0,rt._)`${s} === false`),t.ok(c);function l(){let h=e.let("i",(0,rt._)`${r}.length`),m=e.let("j");t.setParams({i:h,j:m}),e.assign(c,!0),e.if((0,rt._)`${h} > 1`,()=>(d()?p:f)(h,m))}function d(){return u.length>0&&!u.some(h=>h==="object"||h==="array")}function p(h,m){let g=e.name("item"),v=(0,My.checkDataTypes)(u,g,a.opts.strictNumbers,My.DataType.Wrong),$=e.const("indices",(0,rt._)`{}`);e.for((0,rt._)`;${h}--;`,()=>{e.let(g,(0,rt._)`${r}[${h}]`),e.if(v,(0,rt._)`continue`),u.length>1&&e.if((0,rt._)`typeof ${g} == "string"`,(0,rt._)`${g} += "_"`),e.if((0,rt._)`typeof ${$}[${g}] == "number"`,()=>{e.assign(m,(0,rt._)`${$}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,rt._)`${$}[${g}] = ${h}`)})}function f(h,m){let g=(0,IL.useFunc)(e,EL.default),v=e.name("outer");e.label(v).for((0,rt._)`;${h}--;`,()=>e.for((0,rt._)`${m} = ${h}; ${m}--;`,()=>e.if((0,rt._)`${g}(${r}[${h}], ${r}[${m}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};Dy.default=TL});var MP=b(qy=>{"use strict";Object.defineProperty(qy,"__esModule",{value:!0});var Uy=X(),OL=ye(),CL=ed(),jL={message:"must be equal to constant",params:({schemaCode:t})=>(0,Uy._)`{allowedValue: ${t}}`},NL={keyword:"const",$data:!0,error:jL,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:i}=t;n||i&&typeof i=="object"?t.fail$data((0,Uy._)`!${(0,OL.useFunc)(e,CL.default)}(${r}, ${o})`):t.fail((0,Uy._)`${i} !== ${r}`)}};qy.default=NL});var DP=b(Ly=>{"use strict";Object.defineProperty(Ly,"__esModule",{value:!0});var rc=X(),RL=ye(),AL=ed(),ML={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,rc._)`{allowedValues: ${t}}`},DL={keyword:"enum",schemaType:"array",$data:!0,error:ML,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:i,it:s}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=s.opts.loopEnum,c,u=()=>c??(c=(0,RL.useFunc)(e,AL.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",i);l=(0,rc.or)(...o.map((h,m)=>p(f,m)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",i,f=>e.if((0,rc._)`${u()}(${r}, ${f})`,()=>e.assign(l,!0).break()))}function p(f,h){let m=o[h];return typeof m=="object"&&m!==null?(0,rc._)`${u()}(${r}, ${f}[${h}])`:(0,rc._)`${r} === ${m}`}}};Ly.default=DL});var UP=b(Zy=>{"use strict";Object.defineProperty(Zy,"__esModule",{value:!0});var UL=PP(),qL=IP(),LL=TP(),ZL=OP(),VL=CP(),FL=jP(),BL=NP(),HL=AP(),WL=MP(),GL=DP(),JL=[UL.default,qL.default,LL.default,ZL.default,VL.default,FL.default,BL.default,HL.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},WL.default,GL.default];Zy.default=JL});var Fy=b(nc=>{"use strict";Object.defineProperty(nc,"__esModule",{value:!0});nc.validateAdditionalItems=void 0;var mo=X(),Vy=ye(),KL={message:({params:{len:t}})=>(0,mo.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,mo._)`{limit: ${t}}`},XL={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:KL,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,Vy.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}qP(t,n)}};function qP(t,e){let{gen:r,schema:n,data:o,keyword:i,it:s}=t;s.items=!0;let a=r.const("len",(0,mo._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,mo._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,Vy.alwaysValidSchema)(s,n)){let u=r.var("valid",(0,mo._)`${a} <= ${e.length}`);r.if((0,mo.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:i,dataProp:l,dataPropType:Vy.Type.Num},u),s.allErrors||r.if((0,mo.not)(u),()=>r.break())})}}nc.validateAdditionalItems=qP;nc.default=XL});var By=b(oc=>{"use strict";Object.defineProperty(oc,"__esModule",{value:!0});oc.validateTuple=void 0;var LP=X(),td=ye(),YL=Qt(),QL={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return ZP(t,"additionalItems",e);r.items=!0,!(0,td.alwaysValidSchema)(r,e)&&t.ok((0,YL.validateArray)(t))}};function ZP(t,e,r=t.schema){let{gen:n,parentSchema:o,data:i,keyword:s,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=td.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,LP._)`${i}.length`);r.forEach((d,p)=>{(0,td.alwaysValidSchema)(a,d)||(n.if((0,LP._)`${u} > ${p}`,()=>t.subschema({keyword:s,schemaProp:p,dataProp:p},c)),t.ok(c))});function l(d){let{opts:p,errSchemaPath:f}=a,h=r.length,m=h===d.minItems&&(h===d.maxItems||d[e]===!1);if(p.strictTuples&&!m){let g=`"${s}" is ${h}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,td.checkStrictMode)(a,g,p.strictTuples)}}}oc.validateTuple=ZP;oc.default=QL});var VP=b(Hy=>{"use strict";Object.defineProperty(Hy,"__esModule",{value:!0});var e6=By(),t6={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,e6.validateTuple)(t,"items")};Hy.default=t6});var BP=b(Wy=>{"use strict";Object.defineProperty(Wy,"__esModule",{value:!0});var FP=X(),r6=ye(),n6=Qt(),o6=Fy(),i6={message:({params:{len:t}})=>(0,FP.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,FP._)`{limit: ${t}}`},s6={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:i6,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,r6.alwaysValidSchema)(n,e)&&(o?(0,o6.validateAdditionalItems)(t,o):t.ok((0,n6.validateArray)(t)))}};Wy.default=s6});var HP=b(Gy=>{"use strict";Object.defineProperty(Gy,"__esModule",{value:!0});var tr=X(),rd=ye(),a6={message:({params:{min:t,max:e}})=>e===void 0?(0,tr.str)`must contain at least ${t} valid item(s)`:(0,tr.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,tr._)`{minContains: ${t}}`:(0,tr._)`{minContains: ${t}, maxContains: ${e}}`},c6={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:a6,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t,s,a,{minContains:c,maxContains:u}=n;i.opts.next?(s=c===void 0?1:c,a=u):s=1;let l=e.const("len",(0,tr._)`${o}.length`);if(t.setParams({min:s,max:a}),a===void 0&&s===0){(0,rd.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,rd.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,rd.alwaysValidSchema)(i,r)){let m=(0,tr._)`${l} >= ${s}`;a!==void 0&&(m=(0,tr._)`${m} && ${l} <= ${a}`),t.pass(m);return}i.items=!0;let d=e.name("valid");a===void 0&&s===1?f(d,()=>e.if(d,()=>e.break())):s===0?(e.let(d,!0),a!==void 0&&e.if((0,tr._)`${o}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let m=e.name("_valid"),g=e.let("count",0);f(m,()=>e.if(m,()=>h(g)))}function f(m,g){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:rd.Type.Num,compositeRule:!0},m),g()})}function h(m){e.code((0,tr._)`${m}++`),a===void 0?e.if((0,tr._)`${m} >= ${s}`,()=>e.assign(d,!0).break()):(e.if((0,tr._)`${m} > ${a}`,()=>e.assign(d,!1).break()),s===1?e.assign(d,!0):e.if((0,tr._)`${m} >= ${s}`,()=>e.assign(d,!0)))}}};Gy.default=c6});var JP=b(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.validateSchemaDeps=Cr.validatePropertyDeps=Cr.error=void 0;var Jy=X(),u6=ye(),ic=Qt();Cr.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,Jy.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,Jy._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var l6={keyword:"dependencies",type:"object",schemaType:"object",error:Cr.error,code(t){let[e,r]=d6(t);WP(t,e),GP(t,r)}};function d6({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function WP(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let i=r.let("missing");for(let s in e){let a=e[s];if(a.length===0)continue;let c=(0,ic.propertyInData)(r,n,s,o.opts.ownProperties);t.setParams({property:s,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,ic.checkReportMissingProp)(t,u)}):(r.if((0,Jy._)`${c} && (${(0,ic.checkMissingProp)(t,a,i)})`),(0,ic.reportMissingProp)(t,i),r.else())}}Cr.validatePropertyDeps=WP;function GP(t,e=t.schema){let{gen:r,data:n,keyword:o,it:i}=t,s=r.name("valid");for(let a in e)(0,u6.alwaysValidSchema)(i,e[a])||(r.if((0,ic.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},s);t.mergeValidEvaluated(c,s)},()=>r.var(s,!0)),t.ok(s))}Cr.validateSchemaDeps=GP;Cr.default=l6});var XP=b(Ky=>{"use strict";Object.defineProperty(Ky,"__esModule",{value:!0});var KP=X(),p6=ye(),f6={message:"property name must be valid",params:({params:t})=>(0,KP._)`{propertyName: ${t.propertyName}}`},m6={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:f6,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,p6.alwaysValidSchema)(o,r))return;let i=e.name("valid");e.forIn("key",n,s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},i),e.if((0,KP.not)(i),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(i)}};Ky.default=m6});var Yy=b(Xy=>{"use strict";Object.defineProperty(Xy,"__esModule",{value:!0});var nd=Qt(),gr=X(),h6=Jr(),od=ye(),g6={message:"must NOT have additional properties",params:({params:t})=>(0,gr._)`{additionalProperty: ${t.additionalProperty}}`},v6={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:g6,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:i,it:s}=t;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=s;if(s.props=!0,c.removeAdditional!=="all"&&(0,od.alwaysValidSchema)(s,r))return;let u=(0,nd.allSchemaProperties)(n.properties),l=(0,nd.allSchemaProperties)(n.patternProperties);d(),t.ok((0,gr._)`${i} === ${h6.default.errors}`);function d(){e.forIn("key",o,g=>{!u.length&&!l.length?h(g):e.if(p(g),()=>h(g))})}function p(g){let v;if(u.length>8){let $=(0,od.schemaRefOrVal)(s,n.properties,"properties");v=(0,nd.isOwnProperty)(e,$,g)}else u.length?v=(0,gr.or)(...u.map($=>(0,gr._)`${g} === ${$}`)):v=gr.nil;return l.length&&(v=(0,gr.or)(v,...l.map($=>(0,gr._)`${(0,nd.usePattern)(t,$)}.test(${g})`))),(0,gr.not)(v)}function f(g){e.code((0,gr._)`delete ${o}[${g}]`)}function h(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,od.alwaysValidSchema)(s,r)){let v=e.name("valid");c.removeAdditional==="failing"?(m(g,v,!1),e.if((0,gr.not)(v),()=>{t.reset(),f(g)})):(m(g,v),a||e.if((0,gr.not)(v),()=>e.break()))}}function m(g,v,$){let x={keyword:"additionalProperties",dataProp:g,dataPropType:od.Type.Str};$===!1&&Object.assign(x,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(x,v)}}};Xy.default=v6});var eI=b(e_=>{"use strict";Object.defineProperty(e_,"__esModule",{value:!0});var y6=Ha(),YP=Qt(),Qy=ye(),QP=Yy(),_6={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&QP.default.code(new y6.KeywordCxt(i,QP.default,"additionalProperties"));let s=(0,YP.allSchemaProperties)(r);for(let d of s)i.definedProperties.add(d);i.opts.unevaluated&&s.length&&i.props!==!0&&(i.props=Qy.mergeEvaluated.props(e,(0,Qy.toHash)(s),i.props));let a=s.filter(d=>!(0,Qy.alwaysValidSchema)(i,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,YP.propertyInData)(e,o,d,i.opts.ownProperties)),l(d),i.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return i.opts.useDefaults&&!i.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};e_.default=_6});var oI=b(t_=>{"use strict";Object.defineProperty(t_,"__esModule",{value:!0});var tI=Qt(),id=X(),rI=ye(),nI=ye(),b6={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:i}=t,{opts:s}=i,a=(0,tI.allSchemaProperties)(r),c=a.filter(m=>(0,rI.alwaysValidSchema)(i,r[m]));if(a.length===0||c.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let u=s.strictSchema&&!s.allowMatchingProperties&&o.properties,l=e.name("valid");i.props!==!0&&!(i.props instanceof id.Name)&&(i.props=(0,nI.evaluatedPropsToName)(e,i.props));let{props:d}=i;p();function p(){for(let m of a)u&&f(m),i.allErrors?h(m):(e.var(l,!0),h(m),e.if(l))}function f(m){for(let g in u)new RegExp(m).test(g)&&(0,rI.checkStrictMode)(i,`property ${g} matches pattern ${m} (use allowMatchingProperties)`)}function h(m){e.forIn("key",n,g=>{e.if((0,id._)`${(0,tI.usePattern)(t,m)}.test(${g})`,()=>{let v=c.includes(m);v||t.subschema({keyword:"patternProperties",schemaProp:m,dataProp:g,dataPropType:nI.Type.Str},l),i.opts.unevaluated&&d!==!0?e.assign((0,id._)`${d}[${g}]`,!0):!v&&!i.allErrors&&e.if((0,id.not)(l),()=>e.break())})})}}};t_.default=b6});var iI=b(r_=>{"use strict";Object.defineProperty(r_,"__esModule",{value:!0});var $6=ye(),w6={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,$6.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};r_.default=w6});var sI=b(n_=>{"use strict";Object.defineProperty(n_,"__esModule",{value:!0});var x6=Qt(),k6={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:x6.validateUnion,error:{message:"must match a schema in anyOf"}};n_.default=k6});var aI=b(o_=>{"use strict";Object.defineProperty(o_,"__esModule",{value:!0});var sd=X(),S6=ye(),P6={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,sd._)`{passingSchemas: ${t.passing}}`},I6={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:P6,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let i=r,s=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(s,()=>t.reset(),()=>t.error(!0));function u(){i.forEach((l,d)=>{let p;(0,S6.alwaysValidSchema)(o,l)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,sd._)`${c} && ${s}`).assign(s,!1).assign(a,(0,sd._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(s,!0),e.assign(a,d),p&&t.mergeEvaluated(p,sd.Name)})})}}};o_.default=I6});var cI=b(i_=>{"use strict";Object.defineProperty(i_,"__esModule",{value:!0});var E6=ye(),z6={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((i,s)=>{if((0,E6.alwaysValidSchema)(n,i))return;let a=t.subschema({keyword:"allOf",schemaProp:s},o);t.ok(o),t.mergeEvaluated(a)})}};i_.default=z6});var dI=b(s_=>{"use strict";Object.defineProperty(s_,"__esModule",{value:!0});var ad=X(),lI=ye(),T6={message:({params:t})=>(0,ad.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,ad._)`{failingKeyword: ${t.ifClause}}`},O6={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:T6,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,lI.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=uI(n,"then"),i=uI(n,"else");if(!o&&!i)return;let s=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&i){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,ad.not)(a),u("else"));t.pass(s,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let p=t.subschema({keyword:l},a);e.assign(s,a),t.mergeValidEvaluated(p,s),d?e.assign(d,(0,ad._)`${l}`):t.setParams({ifClause:l})}}}};function uI(t,e){let r=t.schema[e];return r!==void 0&&!(0,lI.alwaysValidSchema)(t,r)}s_.default=O6});var pI=b(a_=>{"use strict";Object.defineProperty(a_,"__esModule",{value:!0});var C6=ye(),j6={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,C6.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};a_.default=j6});var fI=b(c_=>{"use strict";Object.defineProperty(c_,"__esModule",{value:!0});var N6=Fy(),R6=VP(),A6=By(),M6=BP(),D6=HP(),U6=JP(),q6=XP(),L6=Yy(),Z6=eI(),V6=oI(),F6=iI(),B6=sI(),H6=aI(),W6=cI(),G6=dI(),J6=pI();function K6(t=!1){let e=[F6.default,B6.default,H6.default,W6.default,G6.default,J6.default,q6.default,L6.default,U6.default,Z6.default,V6.default];return t?e.push(R6.default,M6.default):e.push(N6.default,A6.default),e.push(D6.default),e}c_.default=K6});var mI=b(u_=>{"use strict";Object.defineProperty(u_,"__esModule",{value:!0});var Ze=X(),X6={message:({schemaCode:t})=>(0,Ze.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,Ze._)`{format: ${t}}`},Y6={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:X6,code(t,e){let{gen:r,data:n,$data:o,schema:i,schemaCode:s,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?p():f();function p(){let h=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),m=r.const("fDef",(0,Ze._)`${h}[${s}]`),g=r.let("fType"),v=r.let("format");r.if((0,Ze._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(g,(0,Ze._)`${m}.type || "string"`).assign(v,(0,Ze._)`${m}.validate`),()=>r.assign(g,(0,Ze._)`"string"`).assign(v,m)),t.fail$data((0,Ze.or)($(),x()));function $(){return c.strictSchema===!1?Ze.nil:(0,Ze._)`${s} && !${v}`}function x(){let I=l.$async?(0,Ze._)`(${m}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,Ze._)`${v}(${n})`,k=(0,Ze._)`(typeof ${v} == "function" ? ${I} : ${v}.test(${n}))`;return(0,Ze._)`${v} && ${v} !== true && ${g} === ${e} && !${k}`}}function f(){let h=d.formats[i];if(!h){$();return}if(h===!0)return;let[m,g,v]=x(h);m===e&&t.pass(I());function $(){if(c.strictSchema===!1){d.logger.warn(k());return}throw new Error(k());function k(){return`unknown format "${i}" ignored in schema at path "${u}"`}}function x(k){let ie=k instanceof RegExp?(0,Ze.regexpCode)(k):c.code.formats?(0,Ze._)`${c.code.formats}${(0,Ze.getProperty)(i)}`:void 0,se=r.scopeValue("formats",{key:i,ref:k,code:ie});return typeof k=="object"&&!(k instanceof RegExp)?[k.type||"string",k.validate,(0,Ze._)`${se}.validate`]:["string",k,se]}function I(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!l.$async)throw new Error("async format in sync schema");return(0,Ze._)`await ${v}(${n})`}return typeof g=="function"?(0,Ze._)`${v}(${n})`:(0,Ze._)`${v}.test(${n})`}}}};u_.default=Y6});var hI=b(l_=>{"use strict";Object.defineProperty(l_,"__esModule",{value:!0});var Q6=mI(),e2=[Q6.default];l_.default=e2});var gI=b(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.contentVocabulary=ki.metadataVocabulary=void 0;ki.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];ki.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var yI=b(d_=>{"use strict";Object.defineProperty(d_,"__esModule",{value:!0});var t2=SP(),r2=UP(),n2=fI(),o2=hI(),vI=gI(),i2=[t2.default,r2.default,(0,n2.default)(),o2.default,vI.metadataVocabulary,vI.contentVocabulary];d_.default=i2});var bI=b(cd=>{"use strict";Object.defineProperty(cd,"__esModule",{value:!0});cd.DiscrError=void 0;var _I;(function(t){t.Tag="tag",t.Mapping="mapping"})(_I||(cd.DiscrError=_I={}))});var wI=b(f_=>{"use strict";Object.defineProperty(f_,"__esModule",{value:!0});var Si=X(),p_=bI(),$I=Wl(),s2=Wa(),a2=ye(),c2={message:({params:{discrError:t,tagName:e}})=>t===p_.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,Si._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},u2={keyword:"discriminator",type:"object",schemaType:"object",error:c2,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:i}=t,{oneOf:s}=o;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,Si._)`${r}${(0,Si.getProperty)(a)}`);e.if((0,Si._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:p_.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let f=p();e.if(!1);for(let h in f)e.elseIf((0,Si._)`${u} === ${h}`),e.assign(c,d(f[h]));e.else(),t.error(!1,{discrError:p_.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(f){let h=e.name("valid"),m=t.subschema({keyword:"oneOf",schemaProp:f},h);return t.mergeEvaluated(m,Si.Name),h}function p(){var f;let h={},m=v(o),g=!0;for(let I=0;I<s.length;I++){let k=s[I];if(k?.$ref&&!(0,a2.schemaHasRulesButRef)(k,i.self.RULES)){let se=k.$ref;if(k=$I.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,se),k instanceof $I.SchemaEnv&&(k=k.schema),k===void 0)throw new s2.default(i.opts.uriResolver,i.baseId,se)}let ie=(f=k?.properties)===null||f===void 0?void 0:f[a];if(typeof ie!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(m||v(k)),$(ie,I)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return h;function v({required:I}){return Array.isArray(I)&&I.includes(a)}function $(I,k){if(I.const)x(I.const,k);else if(I.enum)for(let ie of I.enum)x(ie,k);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function x(I,k){if(typeof I!="string"||I in h)throw new Error(`discriminator: "${a}" values must be unique strings`);h[I]=k}}}};f_.default=u2});var xI=b((q7,l2)=>{l2.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var SI=b((Ae,m_)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.MissingRefError=Ae.ValidationError=Ae.CodeGen=Ae.Name=Ae.nil=Ae.stringify=Ae.str=Ae._=Ae.KeywordCxt=Ae.Ajv=void 0;var d2=_P(),p2=yI(),f2=wI(),kI=xI(),m2=["/properties"],ud="http://json-schema.org/draft-07/schema",Pi=class extends d2.default{_addVocabularies(){super._addVocabularies(),p2.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(f2.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(kI,m2):kI;this.addMetaSchema(e,ud,!1),this.refs["http://json-schema.org/schema"]=ud}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(ud)?ud:void 0)}};Ae.Ajv=Pi;m_.exports=Ae=Pi;m_.exports.Ajv=Pi;Object.defineProperty(Ae,"__esModule",{value:!0});Ae.default=Pi;var h2=Ha();Object.defineProperty(Ae,"KeywordCxt",{enumerable:!0,get:function(){return h2.KeywordCxt}});var Ii=X();Object.defineProperty(Ae,"_",{enumerable:!0,get:function(){return Ii._}});Object.defineProperty(Ae,"str",{enumerable:!0,get:function(){return Ii.str}});Object.defineProperty(Ae,"stringify",{enumerable:!0,get:function(){return Ii.stringify}});Object.defineProperty(Ae,"nil",{enumerable:!0,get:function(){return Ii.nil}});Object.defineProperty(Ae,"Name",{enumerable:!0,get:function(){return Ii.Name}});Object.defineProperty(Ae,"CodeGen",{enumerable:!0,get:function(){return Ii.CodeGen}});var g2=Bl();Object.defineProperty(Ae,"ValidationError",{enumerable:!0,get:function(){return g2.default}});var v2=Wa();Object.defineProperty(Ae,"MissingRefError",{enumerable:!0,get:function(){return v2.default}})});var PI=b(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.formatLimitDefinition=void 0;var y2=SI(),vr=X(),Tn=vr.operators,ld={formatMaximum:{okStr:"<=",ok:Tn.LTE,fail:Tn.GT},formatMinimum:{okStr:">=",ok:Tn.GTE,fail:Tn.LT},formatExclusiveMaximum:{okStr:"<",ok:Tn.LT,fail:Tn.GTE},formatExclusiveMinimum:{okStr:">",ok:Tn.GT,fail:Tn.LTE}},_2={message:({keyword:t,schemaCode:e})=>(0,vr.str)`should be ${ld[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,vr._)`{comparison: ${ld[t].okStr}, limit: ${e}}`};Ei.formatLimitDefinition={keyword:Object.keys(ld),type:"string",schemaType:"string",$data:!0,error:_2,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:i}=t,{opts:s,self:a}=i;if(!s.validateFormats)return;let c=new y2.KeywordCxt(i,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let p=e.scopeValue("formats",{ref:a.formats,code:s.code.formats}),f=e.const("fmt",(0,vr._)`${p}[${c.schemaCode}]`);t.fail$data((0,vr.or)((0,vr._)`typeof ${f} != "object"`,(0,vr._)`${f} instanceof RegExp`,(0,vr._)`typeof ${f}.compare != "function"`,d(f)))}function l(){let p=c.schema,f=a.formats[p];if(!f||f===!0)return;if(typeof f!="object"||f instanceof RegExp||typeof f.compare!="function")throw new Error(`"${o}": format "${p}" does not define "compare" function`);let h=e.scopeValue("formats",{key:p,ref:f,code:s.code.formats?(0,vr._)`${s.code.formats}${(0,vr.getProperty)(p)}`:void 0});t.fail$data(d(h))}function d(p){return(0,vr._)`${p}.compare(${r}, ${n}) ${ld[o].fail} 0`}},dependencies:["format"]};var b2=t=>(t.addKeyword(Ei.formatLimitDefinition),t);Ei.default=b2});var TI=b((sc,zI)=>{"use strict";Object.defineProperty(sc,"__esModule",{value:!0});var zi=dS(),$2=PI(),h_=X(),II=new h_.Name("fullFormats"),w2=new h_.Name("fastFormats"),g_=(t,e={keywords:!0})=>{if(Array.isArray(e))return EI(t,e,zi.fullFormats,II),t;let[r,n]=e.mode==="fast"?[zi.fastFormats,w2]:[zi.fullFormats,II],o=e.formats||zi.formatNames;return EI(t,o,r,n),e.keywords&&(0,$2.default)(t),t};g_.get=(t,e="full")=>{let n=(e==="fast"?zi.fastFormats:zi.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function EI(t,e,r,n){var o,i;(o=(i=t.opts.code).formats)!==null&&o!==void 0||(i.formats=(0,h_._)`require("ajv-formats/dist/formats").${n}`);for(let s of e)t.addFormat(s,r[s])}zI.exports=sc=g_;Object.defineProperty(sc,"__esModule",{value:!0});sc.default=g_});var UI=b((Q7,DI)=>{DI.exports=MI;MI.sync=P2;var RI=require("fs");function S2(t,e){var r=e.pathExt!==void 0?e.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var n=0;n<r.length;n++){var o=r[n].toLowerCase();if(o&&t.substr(-o.length).toLowerCase()===o)return!0}return!1}function AI(t,e,r){return!t.isSymbolicLink()&&!t.isFile()?!1:S2(e,r)}function MI(t,e,r){RI.stat(t,function(n,o){r(n,n?!1:AI(o,t,e))})}function P2(t,e){return AI(RI.statSync(t),t,e)}});var FI=b((eX,VI)=>{VI.exports=LI;LI.sync=I2;var qI=require("fs");function LI(t,e,r){qI.stat(t,function(n,o){r(n,n?!1:ZI(o,e))})}function I2(t,e){return ZI(qI.statSync(t),e)}function ZI(t,e){return t.isFile()&&E2(t,e)}function E2(t,e){var r=t.mode,n=t.uid,o=t.gid,i=e.uid!==void 0?e.uid:process.getuid&&process.getuid(),s=e.gid!==void 0?e.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),u=parseInt("001",8),l=a|c,d=r&u||r&c&&o===s||r&a&&n===i||r&l&&i===0;return d}});var HI=b((rX,BI)=>{var tX=require("fs"),hd;process.platform==="win32"||global.TESTING_WINDOWS?hd=UI():hd=FI();BI.exports=v_;v_.sync=z2;function v_(t,e,r){if(typeof e=="function"&&(r=e,e={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(n,o){v_(t,e||{},function(i,s){i?o(i):n(s)})})}hd(t,e||{},function(n,o){n&&(n.code==="EACCES"||e&&e.ignoreErrors)&&(n=null,o=!1),r(n,o)})}function z2(t,e){try{return hd.sync(t,e||{})}catch(r){if(e&&e.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var QI=b((nX,YI)=>{var Ti=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",WI=require("path"),T2=Ti?";":":",GI=HI(),JI=t=>Object.assign(new Error(`not found: ${t}`),{code:"ENOENT"}),KI=(t,e)=>{let r=e.colon||T2,n=t.match(/\//)||Ti&&t.match(/\\/)?[""]:[...Ti?[process.cwd()]:[],...(e.path||process.env.PATH||"").split(r)],o=Ti?e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",i=Ti?o.split(r):[""];return Ti&&t.indexOf(".")!==-1&&i[0]!==""&&i.unshift(""),{pathEnv:n,pathExt:i,pathExtExe:o}},XI=(t,e,r)=>{typeof e=="function"&&(r=e,e={}),e||(e={});let{pathEnv:n,pathExt:o,pathExtExe:i}=KI(t,e),s=[],a=u=>new Promise((l,d)=>{if(u===n.length)return e.all&&s.length?l(s):d(JI(t));let p=n[u],f=/^".*"$/.test(p)?p.slice(1,-1):p,h=WI.join(f,t),m=!f&&/^\.[\\\/]/.test(t)?t.slice(0,2)+h:h;l(c(m,u,0))}),c=(u,l,d)=>new Promise((p,f)=>{if(d===o.length)return p(a(l+1));let h=o[d];GI(u+h,{pathExt:i},(m,g)=>{if(!m&&g)if(e.all)s.push(u+h);else return p(u+h);return p(c(u,l,d+1))})});return r?a(0).then(u=>r(null,u),r):a(0)},O2=(t,e)=>{e=e||{};let{pathEnv:r,pathExt:n,pathExtExe:o}=KI(t,e),i=[];for(let s=0;s<r.length;s++){let a=r[s],c=/^".*"$/.test(a)?a.slice(1,-1):a,u=WI.join(c,t),l=!c&&/^\.[\\\/]/.test(t)?t.slice(0,2)+u:u;for(let d=0;d<n.length;d++){let p=l+n[d];try{if(GI.sync(p,{pathExt:o}))if(e.all)i.push(p);else return p}catch{}}}if(e.all&&i.length)return i;if(e.nothrow)return null;throw JI(t)};YI.exports=XI;XI.sync=O2});var tE=b((oX,y_)=>{"use strict";var eE=(t={})=>{let e=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(e).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};y_.exports=eE;y_.exports.default=eE});var iE=b((iX,oE)=>{"use strict";var rE=require("path"),C2=QI(),j2=tE();function nE(t,e){let r=t.options.env||process.env,n=process.cwd(),o=t.options.cwd!=null,i=o&&process.chdir!==void 0&&!process.chdir.disabled;if(i)try{process.chdir(t.options.cwd)}catch{}let s;try{s=C2.sync(t.command,{path:r[j2({env:r})],pathExt:e?rE.delimiter:void 0})}catch{}finally{i&&process.chdir(n)}return s&&(s=rE.resolve(o?t.options.cwd:"",s)),s}function N2(t){return nE(t)||nE(t,!0)}oE.exports=N2});var sE=b((sX,b_)=>{"use strict";var __=/([()\][%!^"`<>&|;, *?])/g;function R2(t){return t=t.replace(__,"^$1"),t}function A2(t,e){return t=`${t}`,t=t.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),t=t.replace(/(?=(\\+?)?)\1$/,"$1$1"),t=`"${t}"`,t=t.replace(__,"^$1"),e&&(t=t.replace(__,"^$1")),t}b_.exports.command=R2;b_.exports.argument=A2});var cE=b((aX,aE)=>{"use strict";aE.exports=/^#!(.*)/});var lE=b((cX,uE)=>{"use strict";var M2=cE();uE.exports=(t="")=>{let e=t.match(M2);if(!e)return null;let[r,n]=e[0].replace(/#! ?/,"").split(" "),o=r.split("/").pop();return o==="env"?n:n?`${o} ${n}`:o}});var pE=b((uX,dE)=>{"use strict";var $_=require("fs"),D2=lE();function U2(t){let r=Buffer.alloc(150),n;try{n=$_.openSync(t,"r"),$_.readSync(n,r,0,150,0),$_.closeSync(n)}catch{}return D2(r.toString())}dE.exports=U2});var gE=b((lX,hE)=>{"use strict";var q2=require("path"),fE=iE(),mE=sE(),L2=pE(),Z2=process.platform==="win32",V2=/\.(?:com|exe)$/i,F2=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function B2(t){t.file=fE(t);let e=t.file&&L2(t.file);return e?(t.args.unshift(t.file),t.command=e,fE(t)):t.file}function H2(t){if(!Z2)return t;let e=B2(t),r=!V2.test(e);if(t.options.forceShell||r){let n=F2.test(e);t.command=q2.normalize(t.command),t.command=mE.command(t.command),t.args=t.args.map(i=>mE.argument(i,n));let o=[t.command].concat(t.args).join(" ");t.args=["/d","/s","/c",`"${o}"`],t.command=process.env.comspec||"cmd.exe",t.options.windowsVerbatimArguments=!0}return t}function W2(t,e,r){e&&!Array.isArray(e)&&(r=e,e=null),e=e?e.slice(0):[],r=Object.assign({},r);let n={command:t,args:e,options:r,file:void 0,original:{command:t,args:e}};return r.shell?n:H2(n)}hE.exports=W2});var _E=b((dX,yE)=>{"use strict";var w_=process.platform==="win32";function x_(t,e){return Object.assign(new Error(`${e} ${t.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${e} ${t.command}`,path:t.command,spawnargs:t.args})}function G2(t,e){if(!w_)return;let r=t.emit;t.emit=function(n,o){if(n==="exit"){let i=vE(o,e);if(i)return r.call(t,"error",i)}return r.apply(t,arguments)}}function vE(t,e){return w_&&t===1&&!e.file?x_(e.original,"spawn"):null}function J2(t,e){return w_&&t===1&&!e.file?x_(e.original,"spawnSync"):null}yE.exports={hookChildProcess:G2,verifyENOENT:vE,verifyENOENTSync:J2,notFoundError:x_}});var wE=b((pX,Oi)=>{"use strict";var bE=require("child_process"),k_=gE(),S_=_E();function $E(t,e,r){let n=k_(t,e,r),o=bE.spawn(n.command,n.args,n.options);return S_.hookChildProcess(o,n),o}function K2(t,e,r){let n=k_(t,e,r),o=bE.spawnSync(n.command,n.args,n.options);return o.error=o.error||S_.verifyENOENTSync(o.status,n),o}Oi.exports=$E;Oi.exports.spawn=$E;Oi.exports.sync=K2;Oi.exports._parse=k_;Oi.exports._enoent=S_});var Qr=b((BX,HE)=>{"use strict";var FE=["nodebuffer","arraybuffer","fragments"],BE=typeof Blob<"u";BE&&FE.push("blob");HE.exports={BINARY_TYPES:FE,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:BE,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var kc=b((HX,Pd)=>{"use strict";var{EMPTY_BUFFER:TZ}=Qr(),H_=Buffer[Symbol.species];function OZ(t,e){if(t.length===0)return TZ;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let o=0;o<t.length;o++){let i=t[o];r.set(i,n),n+=i.length}return n<e?new H_(r.buffer,r.byteOffset,n):r}function WE(t,e,r,n,o){for(let i=0;i<o;i++)r[n+i]=t[i]^e[i&3]}function GE(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function CZ(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function W_(t){if(W_.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new H_(t):ArrayBuffer.isView(t)?e=new H_(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),W_.readOnly=!1),e}Pd.exports={concat:OZ,mask:WE,toArrayBuffer:CZ,toBuffer:W_,unmask:GE};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");Pd.exports.mask=function(e,r,n,o,i){i<48?WE(e,r,n,o,i):t.mask(e,r,n,o,i)},Pd.exports.unmask=function(e,r){e.length<32?GE(e,r):t.unmask(e,r)}}catch{}});var XE=b((WX,KE)=>{"use strict";var JE=Symbol("kDone"),G_=Symbol("kRun"),J_=class{constructor(e){this[JE]=()=>{this.pending--,this[G_]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[G_]()}[G_](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[JE])}}};KE.exports=J_});var Pc=b((GX,tz)=>{"use strict";var Sc=require("zlib"),YE=kc(),jZ=XE(),{kStatusCode:QE}=Qr(),NZ=Buffer[Symbol.species],RZ=Buffer.from([0,0,255,255]),Ed=Symbol("permessage-deflate"),en=Symbol("total-length"),Mi=Symbol("callback"),jn=Symbol("buffers"),Di=Symbol("error"),Id,K_=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Id){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Id=new jZ(o)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Mi];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(o=>!(r.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>o.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let o=r[n];if(o.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(o=o[0],n==="client_max_window_bits"){if(o!==!0){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else if(n==="server_max_window_bits"){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=i}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=o})}),e}decompress(e,r,n){Id.add(o=>{this._decompress(e,r,(i,s)=>{o(),n(i,s)})})}compress(e,r,n){Id.add(o=>{this._compress(e,r,(i,s)=>{o(),n(i,s)})})}_decompress(e,r,n){let o=this._isServer?"client":"server";if(!this._inflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?Sc.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=Sc.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[Ed]=this,this._inflate[en]=0,this._inflate[jn]=[],this._inflate.on("error",MZ),this._inflate.on("data",ez)}this._inflate[Mi]=n,this._inflate.write(e),r&&this._inflate.write(RZ),this._inflate.flush(()=>{let i=this._inflate[Di];if(i){this._inflate.close(),this._inflate=null,n(i);return}let s=YE.concat(this._inflate[jn],this._inflate[en]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[en]=0,this._inflate[jn]=[],r&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),n(null,s)})}_compress(e,r,n){let o=this._isServer?"server":"client";if(!this._deflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?Sc.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=Sc.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[en]=0,this._deflate[jn]=[],this._deflate.on("data",AZ)}this._deflate[Mi]=n,this._deflate.write(e),this._deflate.flush(Sc.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=YE.concat(this._deflate[jn],this._deflate[en]);r&&(i=new NZ(i.buffer,i.byteOffset,i.length-4)),this._deflate[Mi]=null,this._deflate[en]=0,this._deflate[jn]=[],r&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),n(null,i)})}};tz.exports=K_;function AZ(t){this[jn].push(t),this[en]+=t.length}function ez(t){if(this[en]+=t.length,this[Ed]._maxPayload<1||this[en]<=this[Ed]._maxPayload){this[jn].push(t);return}this[Di]=new RangeError("Max payload size exceeded"),this[Di].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Di][QE]=1009,this.removeListener("data",ez),this.reset()}function MZ(t){if(this[Ed]._inflate=null,this[Di]){this[Mi](this[Di]);return}t[QE]=1007,this[Mi](t)}});var Ui=b((JX,zd)=>{"use strict";var{isUtf8:rz}=require("buffer"),{hasBlob:DZ}=Qr(),UZ=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function qZ(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function X_(t){let e=t.length,r=0;for(;r<e;)if((t[r]&128)===0)r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function LZ(t){return DZ&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}zd.exports={isBlob:LZ,isValidStatusCode:qZ,isValidUTF8:X_,tokenChars:UZ};if(rz)zd.exports.isValidUTF8=function(t){return t.length<24?X_(t):rz(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");zd.exports.isValidUTF8=function(e){return e.length<32?X_(e):t(e)}}catch{}});var rb=b((KX,uz)=>{"use strict";var{Writable:ZZ}=require("stream"),nz=Pc(),{BINARY_TYPES:VZ,EMPTY_BUFFER:oz,kStatusCode:FZ,kWebSocket:BZ}=Qr(),{concat:Y_,toArrayBuffer:HZ,unmask:WZ}=kc(),{isValidStatusCode:GZ,isValidUTF8:iz}=Ui(),Td=Buffer[Symbol.species],rr=0,sz=1,az=2,cz=3,Q_=4,eb=5,Od=6,tb=class extends ZZ{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||VZ[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[BZ]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=rr}_write(e,r,n){if(this._opcode===8&&this._state==rr)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Td(n.buffer,n.byteOffset+e,n.length-e),new Td(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],o=r.length-e;e>=n.length?r.set(this._buffers.shift(),o):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),o),this._buffers[0]=new Td(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case rr:this.getInfo(e);break;case sz:this.getPayloadLength16(e);break;case az:this.getPayloadLength64(e);break;case cz:this.getMask();break;case Q_:this.getData(e);break;case eb:case Od:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if((r[0]&48)!==0){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(o);return}let n=(r[0]&64)===64;if(n&&!this._extensions[nz.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(o);return}if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(o);return}this._payloadLength===126?this._state=sz:this._payloadLength===127?this._state=az:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(o);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=cz:this._state=Q_}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Q_}getData(e){let r=oz;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&WZ(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=eb,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[nz.extensionName].decompress(e,this._fin,(o,i)=>{if(o)return r(o);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(s);return}this._fragments.push(i)}this.dataMessage(r),this._state===rr&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=rr;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=Y_(n,r):this._binaryType==="arraybuffer"?o=HZ(Y_(n,r)):this._binaryType==="blob"?o=new Blob(n):o=n,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=rr):(this._state=Od,setImmediate(()=>{this.emit("message",o,!0),this._state=rr,this.startLoop(e)}))}else{let o=Y_(n,r);if(!this._skipUTF8Validation&&!iz(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===eb||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=rr):(this._state=Od,setImmediate(()=>{this.emit("message",o,!1),this._state=rr,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,oz),this.end();else{let n=e.readUInt16BE(0);if(!GZ(n)){let i=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(i);return}let o=new Td(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!iz(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(i);return}this._loop=!1,this.emit("conclude",n,o),this.end()}this._state=rr;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=rr):(this._state=Od,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=rr,this.startLoop(r)}))}createError(e,r,n,o,i){this._loop=!1,this._errored=!0;let s=new e(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(s,this.createError),s.code=i,s[FZ]=o,s}};uz.exports=tb});var ib=b((YX,pz)=>{"use strict";var{Duplex:XX}=require("stream"),{randomFillSync:JZ}=require("crypto"),lz=Pc(),{EMPTY_BUFFER:KZ,kWebSocket:XZ,NOOP:YZ}=Qr(),{isBlob:qi,isValidStatusCode:QZ}=Ui(),{mask:dz,toBuffer:$o}=kc(),nr=Symbol("kByteLength"),eV=Buffer.alloc(4),Cd=8*1024,wo,Li=Cd,_r=0,tV=1,rV=2,nb=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=_r,this.onerror=YZ,this[XZ]=void 0}static frame(e,r){let n,o=!1,i=2,s=!1;r.mask&&(n=r.maskBuffer||eV,r.generateMask?r.generateMask(n):(Li===Cd&&(wo===void 0&&(wo=Buffer.alloc(Cd)),JZ(wo,0,Cd),Li=0),n[0]=wo[Li++],n[1]=wo[Li++],n[2]=wo[Li++],n[3]=wo[Li++]),s=(n[0]|n[1]|n[2]|n[3])===0,i=6);let a;typeof e=="string"?(!r.mask||s)&&r[nr]!==void 0?a=r[nr]:(e=Buffer.from(e),a=e.length):(a=e.length,o=r.mask&&r.readOnly&&!s);let c=a;a>=65536?(i+=8,c=127):a>125&&(i+=2,c=126);let u=Buffer.allocUnsafe(o?a+i:i);return u[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(u[0]|=64),u[1]=c,c===126?u.writeUInt16BE(a,2):c===127&&(u[2]=u[3]=0,u.writeUIntBE(a,4,6)),r.mask?(u[1]|=128,u[i-4]=n[0],u[i-3]=n[1],u[i-2]=n[2],u[i-1]=n[3],s?[u,e]:o?(dz(e,n,u,i,a),[u]):(dz(e,n,e,0,a),[u,e])):[u,e]}close(e,r,n,o){let i;if(e===void 0)i=KZ;else{if(typeof e!="number"||!QZ(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof r=="string"?i.write(r,2):i.set(r,2)}}let s={[nr]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==_r?this.enqueue([this.dispatch,i,!1,s,o]):this.sendFrame(t.frame(i,s),o)}ping(e,r,n){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):qi(e)?(o=e.size,i=!1):(e=$o(e),o=e.length,i=$o.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[nr]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};qi(e)?this._state!==_r?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):this._state!==_r?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}pong(e,r,n){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):qi(e)?(o=e.size,i=!1):(e=$o(e),o=e.length,i=$o.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[nr]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};qi(e)?this._state!==_r?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):this._state!==_r?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}send(e,r,n){let o=this._extensions[lz.extensionName],i=r.binary?2:1,s=r.compress,a,c;typeof e=="string"?(a=Buffer.byteLength(e),c=!1):qi(e)?(a=e.size,c=!1):(e=$o(e),a=e.length,c=$o.readOnly),this._firstFragment?(this._firstFragment=!1,s&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=a>=o._threshold),this._compress=s):(s=!1,i=0),r.fin&&(this._firstFragment=!0);let u={[nr]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:s};qi(e)?this._state!==_r?this.enqueue([this.getBlobData,e,this._compress,u,n]):this.getBlobData(e,this._compress,u,n):this._state!==_r?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}getBlobData(e,r,n,o){this._bufferedBytes+=n[nr],this._state=rV,e.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(ob,this,a,o);return}this._bufferedBytes-=n[nr];let s=$o(i);r?this.dispatch(s,r,n,o):(this._state=_r,this.sendFrame(t.frame(s,n),o),this.dequeue())}).catch(i=>{process.nextTick(nV,this,i,o)})}dispatch(e,r,n,o){if(!r){this.sendFrame(t.frame(e,n),o);return}let i=this._extensions[lz.extensionName];this._bufferedBytes+=n[nr],this._state=tV,i.compress(e,n.fin,(s,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");ob(this,c,o);return}this._bufferedBytes-=n[nr],this._state=_r,n.readOnly=!1,this.sendFrame(t.frame(a,n),o),this.dequeue()})}dequeue(){for(;this._state===_r&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][nr],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][nr],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};pz.exports=nb;function ob(t,e,r){typeof r=="function"&&r(e);for(let n=0;n<t._queue.length;n++){let o=t._queue[n],i=o[o.length-1];typeof i=="function"&&i(e)}}function nV(t,e,r){ob(t,e,r),t.onerror(e)}});var $z=b((QX,bz)=>{"use strict";var{kForOnEventAttribute:Ic,kListener:sb}=Qr(),fz=Symbol("kCode"),mz=Symbol("kData"),hz=Symbol("kError"),gz=Symbol("kMessage"),vz=Symbol("kReason"),Zi=Symbol("kTarget"),yz=Symbol("kType"),_z=Symbol("kWasClean"),tn=class{constructor(e){this[Zi]=null,this[yz]=e}get target(){return this[Zi]}get type(){return this[yz]}};Object.defineProperty(tn.prototype,"target",{enumerable:!0});Object.defineProperty(tn.prototype,"type",{enumerable:!0});var xo=class extends tn{constructor(e,r={}){super(e),this[fz]=r.code===void 0?0:r.code,this[vz]=r.reason===void 0?"":r.reason,this[_z]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[fz]}get reason(){return this[vz]}get wasClean(){return this[_z]}};Object.defineProperty(xo.prototype,"code",{enumerable:!0});Object.defineProperty(xo.prototype,"reason",{enumerable:!0});Object.defineProperty(xo.prototype,"wasClean",{enumerable:!0});var Vi=class extends tn{constructor(e,r={}){super(e),this[hz]=r.error===void 0?null:r.error,this[gz]=r.message===void 0?"":r.message}get error(){return this[hz]}get message(){return this[gz]}};Object.defineProperty(Vi.prototype,"error",{enumerable:!0});Object.defineProperty(Vi.prototype,"message",{enumerable:!0});var Ec=class extends tn{constructor(e,r={}){super(e),this[mz]=r.data===void 0?null:r.data}get data(){return this[mz]}};Object.defineProperty(Ec.prototype,"data",{enumerable:!0});var oV={addEventListener(t,e,r={}){for(let o of this.listeners(t))if(!r[Ic]&&o[sb]===e&&!o[Ic])return;let n;if(t==="message")n=function(i,s){let a=new Ec("message",{data:s?i:i.toString()});a[Zi]=this,jd(e,this,a)};else if(t==="close")n=function(i,s){let a=new xo("close",{code:i,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Zi]=this,jd(e,this,a)};else if(t==="error")n=function(i){let s=new Vi("error",{error:i,message:i.message});s[Zi]=this,jd(e,this,s)};else if(t==="open")n=function(){let i=new tn("open");i[Zi]=this,jd(e,this,i)};else return;n[Ic]=!!r[Ic],n[sb]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[sb]===e&&!r[Ic]){this.removeListener(t,r);break}}};bz.exports={CloseEvent:xo,ErrorEvent:Vi,Event:tn,EventTarget:oV,MessageEvent:Ec};function jd(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var ab=b((eY,wz)=>{"use strict";var{tokenChars:zc}=Ui();function jr(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function iV(t){let e=Object.create(null),r=Object.create(null),n=!1,o=!1,i=!1,s,a,c=-1,u=-1,l=-1,d=0;for(;d<t.length;d++)if(u=t.charCodeAt(d),s===void 0)if(l===-1&&zc[u]===1)c===-1&&(c=d);else if(d!==0&&(u===32||u===9))l===-1&&c!==-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d);let f=t.slice(c,l);u===44?(jr(e,f,r),r=Object.create(null)):s=f,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);else if(a===void 0)if(l===-1&&zc[u]===1)c===-1&&(c=d);else if(u===32||u===9)l===-1&&c!==-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d),jr(r,t.slice(c,l),!0),u===44&&(jr(e,s,r),r=Object.create(null),s=void 0),c=l=-1}else if(u===61&&c!==-1&&l===-1)a=t.slice(c,d),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(o){if(zc[u]!==1)throw new SyntaxError(`Unexpected character at index ${d}`);c===-1?c=d:n||(n=!0),o=!1}else if(i)if(zc[u]===1)c===-1&&(c=d);else if(u===34&&c!==-1)i=!1,l=d;else if(u===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(u===34&&t.charCodeAt(d-1)===61)i=!0;else if(l===-1&&zc[u]===1)c===-1&&(c=d);else if(c!==-1&&(u===32||u===9))l===-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d);let f=t.slice(c,l);n&&(f=f.replace(/\\/g,""),n=!1),jr(r,a,f),u===44&&(jr(e,s,r),r=Object.create(null),s=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);if(c===-1||i||u===32||u===9)throw new SyntaxError("Unexpected end of input");l===-1&&(l=d);let p=t.slice(c,l);return s===void 0?jr(e,p,r):(a===void 0?jr(r,p,!0):n?jr(r,a,p.replace(/\\/g,"")):jr(r,a,p),jr(e,s,r)),e}function sV(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(o=>{let i=n[o];return Array.isArray(i)||(i=[i]),i.map(s=>s===!0?o:`${o}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}wz.exports={format:sV,parse:iV}});var Md=b((nY,Nz)=>{"use strict";var aV=require("events"),cV=require("https"),uV=require("http"),Sz=require("net"),lV=require("tls"),{randomBytes:dV,createHash:pV}=require("crypto"),{Duplex:tY,Readable:rY}=require("stream"),{URL:cb}=require("url"),Nn=Pc(),fV=rb(),mV=ib(),{isBlob:hV}=Ui(),{BINARY_TYPES:xz,EMPTY_BUFFER:Nd,GUID:gV,kForOnEventAttribute:ub,kListener:vV,kStatusCode:yV,kWebSocket:Ge,NOOP:Pz}=Qr(),{EventTarget:{addEventListener:_V,removeEventListener:bV}}=$z(),{format:$V,parse:wV}=ab(),{toBuffer:xV}=kc(),kV=30*1e3,Iz=Symbol("kAborted"),lb=[8,13],rn=["CONNECTING","OPEN","CLOSING","CLOSED"],SV=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,De=class t extends aV{constructor(e,r,n){super(),this._binaryType=xz[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Nd,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),Ez(this,e,r,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){xz.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let o=new fV({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new mV(e,this._extensions,n.generateMask);this._receiver=o,this._sender=i,this._socket=e,o[Ge]=this,i[Ge]=this,e[Ge]=this,o.on("conclude",EV),o.on("drain",zV),o.on("error",TV),o.on("message",OV),o.on("ping",CV),o.on("pong",jV),i.onerror=NV,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",Oz),e.on("data",Ad),e.on("end",Cz),e.on("error",jz),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Nn.extensionName]&&this._extensions[Nn.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Zt(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Tz(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){db(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Nd,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){db(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Nd,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){db(this,e,n);return}let o={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[Nn.extensionName]||(o.compress=!1),this._sender.send(e||Nd,o,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Zt(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(De,"CONNECTING",{enumerable:!0,value:rn.indexOf("CONNECTING")});Object.defineProperty(De.prototype,"CONNECTING",{enumerable:!0,value:rn.indexOf("CONNECTING")});Object.defineProperty(De,"OPEN",{enumerable:!0,value:rn.indexOf("OPEN")});Object.defineProperty(De.prototype,"OPEN",{enumerable:!0,value:rn.indexOf("OPEN")});Object.defineProperty(De,"CLOSING",{enumerable:!0,value:rn.indexOf("CLOSING")});Object.defineProperty(De.prototype,"CLOSING",{enumerable:!0,value:rn.indexOf("CLOSING")});Object.defineProperty(De,"CLOSED",{enumerable:!0,value:rn.indexOf("CLOSED")});Object.defineProperty(De.prototype,"CLOSED",{enumerable:!0,value:rn.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(De.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(De.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[ub])return e[vV];return null},set(e){for(let r of this.listeners(t))if(r[ub]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[ub]:!0})}})});De.prototype.addEventListener=_V;De.prototype.removeEventListener=bV;Nz.exports=De;function Ez(t,e,r,n){let o={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:lb[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=o.autoPong,!lb.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${lb.join(", ")})`);let i;if(e instanceof cb)i=e;else try{i=new cb(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),t._url=i.href;let s=i.protocol==="wss:",a=i.protocol==="ws+unix:",c;if(i.protocol!=="ws:"&&!s&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"),c){let m=new SyntaxError(c);if(t._redirects===0)throw m;Rd(t,m);return}let u=s?443:80,l=dV(16).toString("base64"),d=s?cV.request:uV.request,p=new Set,f;if(o.createConnection=o.createConnection||(s?IV:PV),o.defaultPort=o.defaultPort||u,o.port=i.port||u,o.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},o.path=i.pathname+i.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(f=new Nn(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=$V({[Nn.extensionName]:f.offer()})),r.length){for(let m of r){if(typeof m!="string"||!SV.test(m)||p.has(m))throw new SyntaxError("An invalid or duplicated subprotocol was specified");p.add(m)}o.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(i.username||i.password)&&(o.auth=`${i.username}:${i.password}`),a){let m=o.path.split(":");o.socketPath=m[0],o.path=m[1]}let h;if(o.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=s,t._originalHostOrSocketPath=a?o.socketPath:i.host;let m=n&&n.headers;if(n={...n,headers:{}},m)for(let[g,v]of Object.entries(m))n.headers[g.toLowerCase()]=v}else if(t.listenerCount("redirect")===0){let m=a?t._originalIpc?o.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:i.host===t._originalHostOrSocketPath;(!m||t._originalSecure&&!s)&&(delete o.headers.authorization,delete o.headers.cookie,m||delete o.headers.host,o.auth=void 0)}o.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),h=t._req=d(o),t._redirects&&t.emit("redirect",t.url,h)}else h=t._req=d(o);o.timeout&&h.on("timeout",()=>{Zt(t,h,"Opening handshake has timed out")}),h.on("error",m=>{h===null||h[Iz]||(h=t._req=null,Rd(t,m))}),h.on("response",m=>{let g=m.headers.location,v=m.statusCode;if(g&&o.followRedirects&&v>=300&&v<400){if(++t._redirects>o.maxRedirects){Zt(t,h,"Maximum redirects exceeded");return}h.abort();let $;try{$=new cb(g,e)}catch{let I=new SyntaxError(`Invalid URL: ${g}`);Rd(t,I);return}Ez(t,$,r,n)}else t.emit("unexpected-response",h,m)||Zt(t,h,`Unexpected server response: ${m.statusCode}`)}),h.on("upgrade",(m,g,v)=>{if(t.emit("upgrade",m),t.readyState!==De.CONNECTING)return;h=t._req=null;let $=m.headers.upgrade;if($===void 0||$.toLowerCase()!=="websocket"){Zt(t,g,"Invalid Upgrade header");return}let x=pV("sha1").update(l+gV).digest("base64");if(m.headers["sec-websocket-accept"]!==x){Zt(t,g,"Invalid Sec-WebSocket-Accept header");return}let I=m.headers["sec-websocket-protocol"],k;if(I!==void 0?p.size?p.has(I)||(k="Server sent an invalid subprotocol"):k="Server sent a subprotocol but none was requested":p.size&&(k="Server sent no subprotocol"),k){Zt(t,g,k);return}I&&(t._protocol=I);let ie=m.headers["sec-websocket-extensions"];if(ie!==void 0){if(!f){Zt(t,g,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let se;try{se=wV(ie)}catch{Zt(t,g,"Invalid Sec-WebSocket-Extensions header");return}let Y=Object.keys(se);if(Y.length!==1||Y[0]!==Nn.extensionName){Zt(t,g,"Server indicated an extension that was not requested");return}try{f.accept(se[Nn.extensionName])}catch{Zt(t,g,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[Nn.extensionName]=f}t.setSocket(g,v,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(h,t):h.end()}function Rd(t,e){t._readyState=De.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function PV(t){return t.path=t.socketPath,Sz.connect(t)}function IV(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=Sz.isIP(t.host)?"":t.host),lV.connect(t)}function Zt(t,e,r){t._readyState=De.CLOSING;let n=new Error(r);Error.captureStackTrace(n,Zt),e.setHeader?(e[Iz]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Rd,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function db(t,e,r){if(e){let n=hV(e)?e.size:xV(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${rn[t.readyState]})`);process.nextTick(r,n)}}function EV(t,e){let r=this[Ge];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[Ge]!==void 0&&(r._socket.removeListener("data",Ad),process.nextTick(zz,r._socket),t===1005?r.close():r.close(t,e))}function zV(){let t=this[Ge];t.isPaused||t._socket.resume()}function TV(t){let e=this[Ge];e._socket[Ge]!==void 0&&(e._socket.removeListener("data",Ad),process.nextTick(zz,e._socket),e.close(t[yV])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function kz(){this[Ge].emitClose()}function OV(t,e){this[Ge].emit("message",t,e)}function CV(t){let e=this[Ge];e._autoPong&&e.pong(t,!this._isServer,Pz),e.emit("ping",t)}function jV(t){this[Ge].emit("pong",t)}function zz(t){t.resume()}function NV(t){let e=this[Ge];e.readyState!==De.CLOSED&&(e.readyState===De.OPEN&&(e._readyState=De.CLOSING,Tz(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function Tz(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),kV)}function Oz(){let t=this[Ge];this.removeListener("close",Oz),this.removeListener("data",Ad),this.removeListener("end",Cz),t._readyState=De.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[Ge]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",kz),t._receiver.on("finish",kz))}function Ad(t){this[Ge]._receiver.write(t)||this.pause()}function Cz(){let t=this[Ge];t._readyState=De.CLOSING,t._receiver.end(),this.end()}function jz(){let t=this[Ge];this.removeListener("error",jz),this.on("error",Pz),t&&(t._readyState=De.CLOSING,this.destroy())}});var Dz=b((iY,Mz)=>{"use strict";var oY=Md(),{Duplex:RV}=require("stream");function Rz(t){t.emit("close")}function AV(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Az(t){this.removeListener("error",Az),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function MV(t,e){let r=!0,n=new RV({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(i,s){let a=!s&&n._readableState.objectMode?i.toString():i;n.push(a)||t.pause()}),t.once("error",function(i){n.destroyed||(r=!1,n.destroy(i))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(o,i){if(t.readyState===t.CLOSED){i(o),process.nextTick(Rz,n);return}let s=!1;t.once("error",function(c){s=!0,i(c)}),t.once("close",function(){s||i(o),process.nextTick(Rz,n)}),r&&t.terminate()},n._final=function(o){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(o)});return}t._socket!==null&&(t._socket._writableState.finished?(o(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){o()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(o,i,s){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(o,i,s)});return}t.send(o,s)},n.on("end",AV),n.on("error",Az),n}Mz.exports=MV});var qz=b((sY,Uz)=>{"use strict";var{tokenChars:DV}=Ui();function UV(t){let e=new Set,r=-1,n=-1,o=0;for(o;o<t.length;o++){let s=t.charCodeAt(o);if(n===-1&&DV[s]===1)r===-1&&(r=o);else if(o!==0&&(s===32||s===9))n===-1&&r!==-1&&(n=o);else if(s===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${o}`);n===-1&&(n=o);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let i=t.slice(r,o);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}Uz.exports={parse:UV}});var Wz=b((cY,Hz)=>{"use strict";var qV=require("events"),Dd=require("http"),{Duplex:aY}=require("stream"),{createHash:LV}=require("crypto"),Lz=ab(),ko=Pc(),ZV=qz(),VV=Md(),{GUID:FV,kWebSocket:BV}=Qr(),HV=/^[+/0-9A-Za-z]{22}==$/,Zz=0,Vz=1,Bz=2,pb=class extends qV{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:VV,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Dd.createServer((n,o)=>{let i=Dd.STATUS_CODES[426];o.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),o.end(i)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=WV(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,i,s)=>{this.handleUpgrade(o,i,s,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Zz}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Bz){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Tc,this);return}if(e&&this.once("close",e),this._state!==Vz)if(this._state=Vz,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Tc,this):process.nextTick(Tc,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Tc(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,o){r.on("error",Fz);let i=e.headers["sec-websocket-key"],s=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){So(this,e,r,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){So(this,e,r,400,"Invalid Upgrade header");return}if(i===void 0||!HV.test(i)){So(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){So(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){Oc(r,400);return}let c=e.headers["sec-websocket-protocol"],u=new Set;if(c!==void 0)try{u=ZV.parse(c)}catch{So(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let l=e.headers["sec-websocket-extensions"],d={};if(this.options.perMessageDeflate&&l!==void 0){let p=new ko(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let f=Lz.parse(l);f[ko.extensionName]&&(p.accept(f[ko.extensionName]),d[ko.extensionName]=p)}catch{So(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let p={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(p,(f,h,m,g)=>{if(!f)return Oc(r,h||401,m,g);this.completeUpgrade(d,i,u,e,r,n,o)});return}if(!this.options.verifyClient(p))return Oc(r,401)}this.completeUpgrade(d,i,u,e,r,n,o)}completeUpgrade(e,r,n,o,i,s,a){if(!i.readable||!i.writable)return i.destroy();if(i[BV])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Zz)return Oc(i,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${LV("sha1").update(r+FV).digest("base64")}`],l=new this.options.WebSocket(null,void 0,this.options);if(n.size){let d=this.options.handleProtocols?this.options.handleProtocols(n,o):n.values().next().value;d&&(u.push(`Sec-WebSocket-Protocol: ${d}`),l._protocol=d)}if(e[ko.extensionName]){let d=e[ko.extensionName].params,p=Lz.format({[ko.extensionName]:[d]});u.push(`Sec-WebSocket-Extensions: ${p}`),l._extensions=e}this.emit("headers",u,o),i.write(u.concat(`\r
`).join(`\r
`)),i.removeListener("error",Fz),l.setSocket(i,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(l),l.on("close",()=>{this.clients.delete(l),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Tc,this)})),a(l,o)}};Hz.exports=pb;function WV(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function Tc(t){t._state=Bz,t.emit("close")}function Fz(){this.destroy()}function Oc(t,e,r,n){r=r||Dd.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${Dd.STATUS_CODES[e]}\r
`+Object.keys(n).map(o=>`${o}: ${n[o]}`).join(`\r
`)+`\r
\r
`+r)}function So(t,e,r,n,o,i){if(t.listenerCount("wsClientError")){let s=new Error(o);Error.captureStackTrace(s,So),t.emit("wsClientError",s,r,e)}else Oc(r,n,o,i)}});var o9={};An(o9,{activate:()=>r9,deactivate:()=>n9});module.exports=rT(o9);var Ue=qe(require("vscode"));var pt=require("crypto"),Jz=require("http"),qd=qe(require("os")),w=qe(require("vscode")),Nt=qe(require("fs")),$t=qe(require("path"));var Rt=qe(require("fs")),Po=qe(require("path")),gb=qe(require("vscode")),jc=class{storageDir;writeQueue=[];flushInterval;FLUSH_MS=2e3;constructor(e){this.storageDir=Po.join(e.globalStorageUri.fsPath,"audit_logs"),this.ensureStorageDir(),this.startPeriodicFlush(),this.cleanupOldLogs().catch(r=>console.error("Failed to cleanup old logs:",r))}async cleanupOldLogs(){let r=gb.workspace.getConfiguration("githubCopilotApi.audit").get("retentionDays",30);if(!(r<=0))try{let n=await Rt.promises.readdir(this.storageDir),o=Date.now(),i=r*24*60*60*1e3;for(let s of n){if(!s.startsWith("audit-")||!s.endsWith(".jsonl"))continue;let a=s.slice(6,-6),c=new Date(a).getTime();if(!isNaN(c)&&o-c>i){let u=Po.join(this.storageDir,s);await Rt.promises.unlink(u)}}}catch(n){console.error("Error cleaning up old audit logs:",n)}}ensureStorageDir(){Rt.existsSync(this.storageDir)||Rt.mkdirSync(this.storageDir,{recursive:!0})}async logRequest(e){this.writeQueue.push(e)}startPeriodicFlush(){this.flushInterval&&clearInterval(this.flushInterval),this.flushInterval=setInterval(()=>this.flush(),this.FLUSH_MS)}async flush(){if(this.writeQueue.length===0)return;let e=[...this.writeQueue];this.writeQueue=[];let r=new Map;for(let n of e){let o=n.timestamp.split("T")[0];r.has(o)||r.set(o,[]),r.get(o).push(n)}for(let[n,o]of r){let i=Po.join(this.storageDir,`audit-${n}.jsonl`),s=o.map(a=>JSON.stringify(a)).join(`
`)+`
`;try{await Rt.promises.appendFile(i,s,"utf8")}catch(a){console.error(`Failed to write audit logs for ${n}:`,a)}}}async getDailyStats(e=30){let r=[],n=new Date;for(let o=0;o<e;o++){let i=new Date(n);i.setDate(i.getDate()-o);let s=i.toISOString().split("T")[0],a=Po.join(this.storageDir,`audit-${s}.jsonl`);if(Rt.existsSync(a))try{let u=(await Rt.promises.readFile(a,"utf8")).trim().split(`
`),l=0,d=0,p=0,f=0,h=0,m=new Set;for(let g of u)if(g)try{let v=JSON.parse(g);l++,d+=v.durationMs,v.tokensIn&&(p+=v.tokensIn),v.tokensOut&&(f+=v.tokensOut),v.status>=400&&h++,v.ip&&m.add(v.ip)}catch{}r.push({date:s,totalRequests:l,avgLatency:l>0?Math.round(d/l):0,tokensIn:p,tokensOut:f,totalTokens:p+f,errorCount:h,uniqueIps:m.size})}catch(c){console.error(`Error reading log ${a}`,c)}else r.push({date:s,totalRequests:0,avgLatency:0,tokensIn:0,tokensOut:0,totalTokens:0,errorCount:0,uniqueIps:0})}return r.sort((o,i)=>o.date.localeCompare(i.date))}async getLogEntries(e=1,r=10){try{if(!Rt.existsSync(this.storageDir))return{total:0,entries:[]};let o=(await Rt.promises.readdir(this.storageDir)).filter(u=>u.startsWith("audit-")&&u.endsWith(".jsonl")).sort().reverse(),i=[];for(let u of o.slice(0,14))try{let l=await Rt.promises.readFile(Po.join(this.storageDir,u),"utf8"),d=[];l.split(`
`).forEach(p=>{if(p.trim())try{let f=JSON.parse(p);f&&f.timestamp&&d.push(f)}catch{}}),i=i.concat(d.reverse())}catch(l){console.error(`[AuditService] Error reading ${u}`,l)}i.sort((u,l)=>new Date(l.timestamp).getTime()-new Date(u.timestamp).getTime());let s=i.length,a=(e-1)*r,c=a+r;return{total:s,entries:i.slice(a,c)}}catch(n){return console.error("[AuditService] Failed to get logs:",n),{total:0,entries:[]}}}getLogFolderPath(){return this.storageDir}async getLifetimeStats(){return(await this.getDailyStats(365)).reduce((r,n)=>({totalRequests:r.totalRequests+n.totalRequests,totalTokensIn:r.totalTokensIn+n.tokensIn,totalTokensOut:r.totalTokensOut+n.tokensOut}),{totalRequests:0,totalTokensIn:0,totalTokensOut:0})}dispose(){this.flushInterval&&(clearInterval(this.flushInterval),this.flush())}};var VE=qe(require("vscode"));var ue;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let i={};for(let s of o)i[s]=s;return i},t.getValidEnumValues=o=>{let i=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),s={};for(let a of i)s[a]=o[a];return t.objectValues(s)},t.objectValues=o=>t.objectKeys(o).map(function(i){return o[i]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let i=[];for(let s in o)Object.prototype.hasOwnProperty.call(o,s)&&i.push(s);return i},t.find=(o,i)=>{for(let s of o)if(i(s))return s},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,i=" | "){return o.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}t.joinValues=n,t.jsonStringifyReplacer=(o,i)=>typeof i=="bigint"?i.toString():i})(ue||(ue={}));var vb;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(vb||(vb={}));var C=ue.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Nr=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return Number.isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}};var S=ue.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var At=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(i){return i.message},n={_errors:[]},o=i=>{for(let s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(o);else if(s.code==="invalid_return_type")o(s.returnTypeError);else if(s.code==="invalid_arguments")o(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let a=n,c=0;for(;c<s.path.length;){let u=s.path[c];c===s.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(s))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ue.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r=Object.create(null),n=[];for(let o of this.issues)if(o.path.length>0){let i=o.path[0];r[i]=r[i]||[],r[i].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};At.create=t=>new At(t);var nT=(t,e)=>{let r;switch(t.code){case S.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ue.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:r=`Unrecognized key(s) in object: ${ue.joinValues(t.keys,", ")}`;break;case S.invalid_union:r="Invalid input";break;case S.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ue.joinValues(t.options)}`;break;case S.invalid_enum_value:r=`Invalid enum value. Expected ${ue.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:r="Invalid function arguments";break;case S.invalid_return_type:r="Invalid function return type";break;case S.invalid_date:r="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ue.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case S.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case S.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case S.custom:r="Invalid input";break;case S.invalid_intersection_types:r="Intersection results could not be merged";break;case S.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:r="Number must be finite";break;default:r=e.defaultError,ue.assertNever(t)}return{message:r}},nn=nT;var oT=nn;function Hi(){return oT}var Nc=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,i=[...r,...o.path||[]],s={...o,path:i};if(o.message!==void 0)return{...o,path:i,message:o.message};let a="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)a=u(s,{data:e,defaultError:a}).message;return{...o,path:i,message:a}};function O(t,e){let r=Hi(),n=Nc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===nn?void 0:nn].filter(o=>!!o)});t.common.issues.push(n)}var ot=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return q;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let i=await o.key,s=await o.value;n.push({key:i,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:i,value:s}=o;if(i.status==="aborted"||s.status==="aborted")return q;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||o.alwaysSet)&&(n[i.value]=s.value)}return{status:e.value,value:n}}},q=Object.freeze({status:"aborted"}),Io=t=>({status:"dirty",value:t}),ft=t=>({status:"valid",value:t}),Vd=t=>t.status==="aborted",Fd=t=>t.status==="dirty",Mn=t=>t.status==="valid",Wi=t=>typeof Promise<"u"&&t instanceof Promise;var j;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(j||(j={}));var Vt=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},yb=(t,e)=>{if(Mn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new At(t.common.issues);return this._error=r,this._error}}};function W(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(s,a)=>{let{message:c}=t;return s.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:s.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var Q=class{get description(){return this._def.description}_getType(e){return Nr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Nr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ot,ctx:{common:e.parent.common,data:e.data,parsedType:Nr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(Wi(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nr(e)},o=this._parseSync({data:e,path:n.path,parent:n});return yb(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nr(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Mn(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Mn(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nr(e)},o=this._parse({data:e,path:n.path,parent:n}),i=await(Wi(o)?o:Promise.resolve(o));return yb(n,i)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,i)=>{let s=e(o),a=()=>i.addIssue({code:S.custom,...n(o)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(a(),!1)):s?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new sr({schema:this,typeName:D.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ir.create(this,this._def)}nullable(){return Mr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return sn.create(this)}promise(){return Dn.create(this,this._def)}or(e){return Co.create([this,e],this._def)}and(e){return jo.create(this,e,this._def)}transform(e){return new sr({...W(this._def),schema:this,typeName:D.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Do({...W(this._def),innerType:this,defaultValue:r,typeName:D.ZodDefault})}brand(){return new Rc({typeName:D.ZodBranded,type:this,...W(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Uo({...W(this._def),innerType:this,catchValue:r,typeName:D.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ac.create(this,e)}readonly(){return qo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},iT=/^c[^\s-]{8,}$/i,sT=/^[0-9a-z]+$/,aT=/^[0-9A-HJKMNP-TV-Z]{26}$/i,cT=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,uT=/^[a-z0-9_-]{21}$/i,lT=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,dT=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,pT=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,fT="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Bd,mT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,hT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,gT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,vT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,yT=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,_T=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,_b="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bT=new RegExp(`^${_b}$`);function bb(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function $T(t){return new RegExp(`^${bb(t)}$`)}function wT(t){let e=`${_b}T${bb(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function xT(t,e){return!!((e==="v4"||!e)&&mT.test(t)||(e==="v6"||!e)&&gT.test(t))}function kT(t,e){if(!lT.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function ST(t,e){return!!((e==="v4"||!e)&&hT.test(t)||(e==="v6"||!e)&&vT.test(t))}var zo=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.string,received:i.parsedType}),q}let n=new ot,o;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(o=this._getOrReturnCtx(e,o),O(o,{code:S.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(o=this._getOrReturnCtx(e,o),O(o,{code:S.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let s=e.data.length>i.value,a=e.data.length<i.value;(s||a)&&(o=this._getOrReturnCtx(e,o),s?O(o,{code:S.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&O(o,{code:S.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")pT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"email",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Bd||(Bd=new RegExp(fT,"u")),Bd.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"emoji",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")cT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"uuid",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")uT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"nanoid",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")iT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"cuid",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")sT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"cuid2",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")aT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"ulid",code:S.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),O(o,{validation:"url",code:S.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"regex",code:S.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(o=this._getOrReturnCtx(e,o),O(o,{code:S.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(o=this._getOrReturnCtx(e,o),O(o,{code:S.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(o=this._getOrReturnCtx(e,o),O(o,{code:S.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?wT(i).test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{code:S.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?bT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{code:S.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?$T(i).test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{code:S.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?dT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"duration",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?xT(e.data,i.version)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"ip",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?kT(e.data,i.alg)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"jwt",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?ST(e.data,i.version)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"cidr",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?yT.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"base64",code:S.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?_T.test(e.data)||(o=this._getOrReturnCtx(e,o),O(o,{validation:"base64url",code:S.invalid_string,message:i.message}),n.dirty()):ue.assertNever(i);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:S.invalid_string,...j.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...j.errToObj(e)})}url(e){return this._addCheck({kind:"url",...j.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...j.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...j.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...j.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...j.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...j.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...j.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...j.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...j.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...j.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...j.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...j.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...j.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...j.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...j.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...j.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...j.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...j.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...j.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...j.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...j.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...j.errToObj(r)})}nonempty(e){return this.min(1,j.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};zo.create=t=>new zo({checks:[],typeName:D.ZodString,coerce:t?.coerce??!1,...W(t)});function PT(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,i=Number.parseInt(t.toFixed(o).replace(".","")),s=Number.parseInt(e.toFixed(o).replace(".",""));return i%s/10**o}var Gi=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.number,received:i.parsedType}),q}let n,o=new ot;for(let i of this._def.checks)i.kind==="int"?ue.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:S.invalid_type,expected:"integer",received:"float",message:i.message}),o.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:S.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:S.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="multipleOf"?PT(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),O(n,{code:S.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:S.not_finite,message:i.message}),o.dirty()):ue.assertNever(i);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,j.toString(r))}gt(e,r){return this.setLimit("min",e,!1,j.toString(r))}lte(e,r){return this.setLimit("max",e,!0,j.toString(r))}lt(e,r){return this.setLimit("max",e,!1,j.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:j.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:j.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:j.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:j.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:j.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:j.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ue.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Gi.create=t=>new Gi({checks:[],typeName:D.ZodNumber,coerce:t?.coerce||!1,...W(t)});var Ji=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,o=new ot;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:S.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:S.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),O(n,{code:S.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):ue.assertNever(i);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return O(r,{code:S.invalid_type,expected:C.bigint,received:r.parsedType}),q}gte(e,r){return this.setLimit("min",e,!0,j.toString(r))}gt(e,r){return this.setLimit("min",e,!1,j.toString(r))}lte(e,r){return this.setLimit("max",e,!0,j.toString(r))}lt(e,r){return this.setLimit("max",e,!1,j.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:j.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:j.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Ji.create=t=>new Ji({checks:[],typeName:D.ZodBigInt,coerce:t?.coerce??!1,...W(t)});var Ki=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let n=this._getOrReturnCtx(e);return O(n,{code:S.invalid_type,expected:C.boolean,received:n.parsedType}),q}return ft(e.data)}};Ki.create=t=>new Ki({typeName:D.ZodBoolean,coerce:t?.coerce||!1,...W(t)});var Xi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.date,received:i.parsedType}),q}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_date}),q}let n=new ot,o;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(o=this._getOrReturnCtx(e,o),O(o,{code:S.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(o=this._getOrReturnCtx(e,o),O(o,{code:S.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):ue.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:j.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:j.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Xi.create=t=>new Xi({checks:[],coerce:t?.coerce||!1,typeName:D.ZodDate,...W(t)});var Yi=class extends Q{_parse(e){if(this._getType(e)!==C.symbol){let n=this._getOrReturnCtx(e);return O(n,{code:S.invalid_type,expected:C.symbol,received:n.parsedType}),q}return ft(e.data)}};Yi.create=t=>new Yi({typeName:D.ZodSymbol,...W(t)});var To=class extends Q{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return O(n,{code:S.invalid_type,expected:C.undefined,received:n.parsedType}),q}return ft(e.data)}};To.create=t=>new To({typeName:D.ZodUndefined,...W(t)});var Oo=class extends Q{_parse(e){if(this._getType(e)!==C.null){let n=this._getOrReturnCtx(e);return O(n,{code:S.invalid_type,expected:C.null,received:n.parsedType}),q}return ft(e.data)}};Oo.create=t=>new Oo({typeName:D.ZodNull,...W(t)});var Qi=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ft(e.data)}};Qi.create=t=>new Qi({typeName:D.ZodAny,...W(t)});var on=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ft(e.data)}};on.create=t=>new on({typeName:D.ZodUnknown,...W(t)});var $r=class extends Q{_parse(e){let r=this._getOrReturnCtx(e);return O(r,{code:S.invalid_type,expected:C.never,received:r.parsedType}),q}};$r.create=t=>new $r({typeName:D.ZodNever,...W(t)});var es=class extends Q{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return O(n,{code:S.invalid_type,expected:C.void,received:n.parsedType}),q}return ft(e.data)}};es.create=t=>new es({typeName:D.ZodVoid,...W(t)});var sn=class t extends Q{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==C.array)return O(r,{code:S.invalid_type,expected:C.array,received:r.parsedType}),q;if(o.exactLength!==null){let s=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(s||a)&&(O(r,{code:s?S.too_big:S.too_small,minimum:a?o.exactLength.value:void 0,maximum:s?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(O(r,{code:S.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(O(r,{code:S.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,a)=>o.type._parseAsync(new Vt(r,s,r.path,a)))).then(s=>ot.mergeArray(n,s));let i=[...r.data].map((s,a)=>o.type._parseSync(new Vt(r,s,r.path,a)));return ot.mergeArray(n,i)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:j.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:j.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:j.toString(r)}})}nonempty(e){return this.min(1,e)}};sn.create=(t,e)=>new sn({type:t,minLength:null,maxLength:null,exactLength:null,typeName:D.ZodArray,...W(e)});function Eo(t){if(t instanceof Mt){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=ir.create(Eo(n))}return new Mt({...t._def,shape:()=>e})}else return t instanceof sn?new sn({...t._def,type:Eo(t.element)}):t instanceof ir?ir.create(Eo(t.unwrap())):t instanceof Mr?Mr.create(Eo(t.unwrap())):t instanceof Ar?Ar.create(t.items.map(e=>Eo(e))):t}var Mt=class t extends Q{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=ue.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==C.object){let u=this._getOrReturnCtx(e);return O(u,{code:S.invalid_type,expected:C.object,received:u.parsedType}),q}let{status:n,ctx:o}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof $r&&this._def.unknownKeys==="strip"))for(let u in o.data)s.includes(u)||a.push(u);let c=[];for(let u of s){let l=i[u],d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Vt(o,d,o.path,u)),alwaysSet:u in o.data})}if(this._def.catchall instanceof $r){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:o.data[l]}});else if(u==="strict")a.length>0&&(O(o,{code:S.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Vt(o,d,o.path,l)),alwaysSet:l in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,p=await l.value;u.push({key:d,value:p,alwaysSet:l.alwaysSet})}return u}).then(u=>ot.mergeObjectSync(n,u)):ot.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return j.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:j.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:D.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of ue.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of ue.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return Eo(this)}partial(e){let r={};for(let n of ue.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of ue.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof ir;)i=i._def.innerType;r[n]=i}return new t({...this._def,shape:()=>r})}keyof(){return $b(ue.objectKeys(this.shape))}};Mt.create=(t,e)=>new Mt({shape:()=>t,unknownKeys:"strip",catchall:$r.create(),typeName:D.ZodObject,...W(e)});Mt.strictCreate=(t,e)=>new Mt({shape:()=>t,unknownKeys:"strict",catchall:$r.create(),typeName:D.ZodObject,...W(e)});Mt.lazycreate=(t,e)=>new Mt({shape:t,unknownKeys:"strip",catchall:$r.create(),typeName:D.ZodObject,...W(e)});var Co=class extends Q{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let s=i.map(a=>new At(a.ctx.common.issues));return O(r,{code:S.invalid_union,unionErrors:s}),q}if(r.common.async)return Promise.all(n.map(async i=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(o);{let i,s=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:u}),u.common.issues.length&&s.push(u.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;let a=s.map(c=>new At(c));return O(r,{code:S.invalid_union,unionErrors:a}),q}}get options(){return this._def.options}};Co.create=(t,e)=>new Co({options:t,typeName:D.ZodUnion,...W(e)});var Rr=t=>t instanceof No?Rr(t.schema):t instanceof sr?Rr(t.innerType()):t instanceof Ro?[t.value]:t instanceof Ao?t.options:t instanceof Mo?ue.objectValues(t.enum):t instanceof Do?Rr(t._def.innerType):t instanceof To?[void 0]:t instanceof Oo?[null]:t instanceof ir?[void 0,...Rr(t.unwrap())]:t instanceof Mr?[null,...Rr(t.unwrap())]:t instanceof Rc||t instanceof qo?Rr(t.unwrap()):t instanceof Uo?Rr(t._def.innerType):[],Hd=class t extends Q{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return O(r,{code:S.invalid_type,expected:C.object,received:r.parsedType}),q;let n=this.discriminator,o=r.data[n],i=this.optionsMap.get(o);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(O(r,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let i of r){let s=Rr(i.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of s){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,i)}}return new t({typeName:D.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...W(n)})}};function Wd(t,e){let r=Nr(t),n=Nr(e);if(t===e)return{valid:!0,data:t};if(r===C.object&&n===C.object){let o=ue.objectKeys(e),i=ue.objectKeys(t).filter(a=>o.indexOf(a)!==-1),s={...t,...e};for(let a of i){let c=Wd(t[a],e[a]);if(!c.valid)return{valid:!1};s[a]=c.data}return{valid:!0,data:s}}else if(r===C.array&&n===C.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let i=0;i<t.length;i++){let s=t[i],a=e[i],c=Wd(s,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===C.date&&n===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var jo=class extends Q{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(i,s)=>{if(Vd(i)||Vd(s))return q;let a=Wd(i.value,s.value);return a.valid?((Fd(i)||Fd(s))&&r.dirty(),{status:r.value,value:a.data}):(O(n,{code:S.invalid_intersection_types}),q)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,s])=>o(i,s)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};jo.create=(t,e,r)=>new jo({left:t,right:e,typeName:D.ZodIntersection,...W(r)});var Ar=class t extends Q{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.array)return O(n,{code:S.invalid_type,expected:C.array,received:n.parsedType}),q;if(n.data.length<this._def.items.length)return O(n,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),q;!this._def.rest&&n.data.length>this._def.items.length&&(O(n,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let i=[...n.data].map((s,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Vt(n,s,n.path,a)):null}).filter(s=>!!s);return n.common.async?Promise.all(i).then(s=>ot.mergeArray(r,s)):ot.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Ar.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ar({items:t,typeName:D.ZodTuple,rest:null,...W(e)})};var Gd=class t extends Q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return O(n,{code:S.invalid_type,expected:C.object,received:n.parsedType}),q;let o=[],i=this._def.keyType,s=this._def.valueType;for(let a in n.data)o.push({key:i._parse(new Vt(n,a,n.path,a)),value:s._parse(new Vt(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?ot.mergeObjectAsync(r,o):ot.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof Q?new t({keyType:e,valueType:r,typeName:D.ZodRecord,...W(n)}):new t({keyType:zo.create(),valueType:e,typeName:D.ZodRecord,...W(r)})}},ts=class extends Q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.map)return O(n,{code:S.invalid_type,expected:C.map,received:n.parsedType}),q;let o=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map(([a,c],u)=>({key:o._parse(new Vt(n,a,n.path,[u,"key"])),value:i._parse(new Vt(n,c,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of s){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return q;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of s){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return q;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};ts.create=(t,e,r)=>new ts({valueType:e,keyType:t,typeName:D.ZodMap,...W(r)});var rs=class t extends Q{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.set)return O(n,{code:S.invalid_type,expected:C.set,received:n.parsedType}),q;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(O(n,{code:S.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(O(n,{code:S.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let i=this._def.valueType;function s(c){let u=new Set;for(let l of c){if(l.status==="aborted")return q;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((c,u)=>i._parse(new Vt(n,c,n.path,u)));return n.common.async?Promise.all(a).then(c=>s(c)):s(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:j.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:j.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};rs.create=(t,e)=>new rs({valueType:t,minSize:null,maxSize:null,typeName:D.ZodSet,...W(e)});var Jd=class t extends Q{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.function)return O(r,{code:S.invalid_type,expected:C.function,received:r.parsedType}),q;function n(a,c){return Nc({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Hi(),nn].filter(u=>!!u),issueData:{code:S.invalid_arguments,argumentsError:c}})}function o(a,c){return Nc({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Hi(),nn].filter(u=>!!u),issueData:{code:S.invalid_return_type,returnTypeError:c}})}let i={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof Dn){let a=this;return ft(async function(...c){let u=new At([]),l=await a._def.args.parseAsync(c,i).catch(f=>{throw u.addIssue(n(c,f)),u}),d=await Reflect.apply(s,this,l);return await a._def.returns._def.type.parseAsync(d,i).catch(f=>{throw u.addIssue(o(d,f)),u})})}else{let a=this;return ft(function(...c){let u=a._def.args.safeParse(c,i);if(!u.success)throw new At([n(c,u.error)]);let l=Reflect.apply(s,this,u.data),d=a._def.returns.safeParse(l,i);if(!d.success)throw new At([o(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Ar.create(e).rest(on.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Ar.create([]).rest(on.create()),returns:r||on.create(),typeName:D.ZodFunction,...W(n)})}},No=class extends Q{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};No.create=(t,e)=>new No({getter:t,typeName:D.ZodLazy,...W(e)});var Ro=class extends Q{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return O(r,{received:r.data,code:S.invalid_literal,expected:this._def.value}),q}return{status:"valid",value:e.data}}get value(){return this._def.value}};Ro.create=(t,e)=>new Ro({value:t,typeName:D.ZodLiteral,...W(e)});function $b(t,e){return new Ao({values:t,typeName:D.ZodEnum,...W(e)})}var Ao=class t extends Q{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return O(r,{expected:ue.joinValues(n),received:r.parsedType,code:S.invalid_type}),q}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return O(r,{received:r.data,code:S.invalid_enum_value,options:n}),q}return ft(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};Ao.create=$b;var Mo=class extends Q{_parse(e){let r=ue.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==C.string&&n.parsedType!==C.number){let o=ue.objectValues(r);return O(n,{expected:ue.joinValues(o),received:n.parsedType,code:S.invalid_type}),q}if(this._cache||(this._cache=new Set(ue.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=ue.objectValues(r);return O(n,{received:n.data,code:S.invalid_enum_value,options:o}),q}return ft(e.data)}get enum(){return this._def.values}};Mo.create=(t,e)=>new Mo({values:t,typeName:D.ZodNativeEnum,...W(e)});var Dn=class extends Q{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.promise&&r.common.async===!1)return O(r,{code:S.invalid_type,expected:C.promise,received:r.parsedType}),q;let n=r.parsedType===C.promise?r.data:Promise.resolve(r.data);return ft(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Dn.create=(t,e)=>new Dn({type:t,typeName:D.ZodPromise,...W(e)});var sr=class extends Q{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===D.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,i={addIssue:s=>{O(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),o.type==="preprocess"){let s=o.transform(n.data,i);if(n.common.async)return Promise.resolve(s).then(async a=>{if(r.value==="aborted")return q;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?q:c.status==="dirty"?Io(c.value):r.value==="dirty"?Io(c.value):c});{if(r.value==="aborted")return q;let a=this._def.schema._parseSync({data:s,path:n.path,parent:n});return a.status==="aborted"?q:a.status==="dirty"?Io(a.value):r.value==="dirty"?Io(a.value):a}}if(o.type==="refinement"){let s=a=>{let c=o.refinement(a,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?q:(a.status==="dirty"&&r.dirty(),s(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?q:(a.status==="dirty"&&r.dirty(),s(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Mn(s))return q;let a=o.transform(s.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>Mn(s)?Promise.resolve(o.transform(s.value,i)).then(a=>({status:r.value,value:a})):q);ue.assertNever(o)}};sr.create=(t,e,r)=>new sr({schema:t,typeName:D.ZodEffects,effect:e,...W(r)});sr.createWithPreprocess=(t,e,r)=>new sr({schema:e,effect:{type:"preprocess",transform:t},typeName:D.ZodEffects,...W(r)});var ir=class extends Q{_parse(e){return this._getType(e)===C.undefined?ft(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ir.create=(t,e)=>new ir({innerType:t,typeName:D.ZodOptional,...W(e)});var Mr=class extends Q{_parse(e){return this._getType(e)===C.null?ft(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Mr.create=(t,e)=>new Mr({innerType:t,typeName:D.ZodNullable,...W(e)});var Do=class extends Q{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Do.create=(t,e)=>new Do({innerType:t,typeName:D.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...W(e)});var Uo=class extends Q{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Wi(o)?o.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new At(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new At(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Uo.create=(t,e)=>new Uo({innerType:t,typeName:D.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...W(e)});var ns=class extends Q{_parse(e){if(this._getType(e)!==C.nan){let n=this._getOrReturnCtx(e);return O(n,{code:S.invalid_type,expected:C.nan,received:n.parsedType}),q}return{status:"valid",value:e.data}}};ns.create=t=>new ns({typeName:D.ZodNaN,...W(t)});var Rc=class extends Q{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Ac=class t extends Q{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?q:i.status==="dirty"?(r.dirty(),Io(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?q:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:D.ZodPipeline})}},qo=class extends Q{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Mn(o)&&(o.value=Object.freeze(o.value)),o);return Wi(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};qo.create=(t,e)=>new qo({innerType:t,typeName:D.ZodReadonly,...W(e)});var k9={object:Mt.lazycreate},D;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(D||(D={}));var S9=zo.create,P9=Gi.create,I9=ns.create,E9=Ji.create,z9=Ki.create,T9=Xi.create,O9=Yi.create,C9=To.create,j9=Oo.create,N9=Qi.create,R9=on.create,A9=$r.create,M9=es.create,D9=sn.create,IT=Mt.create,U9=Mt.strictCreate,q9=Co.create,L9=Hd.create,Z9=jo.create,V9=Ar.create,F9=Gd.create,B9=ts.create,H9=rs.create,W9=Jd.create,G9=No.create,J9=Ro.create,K9=Ao.create,X9=Mo.create,Y9=Dn.create,Q9=sr.create,eF=ir.create,tF=Mr.create,rF=sr.createWithPreprocess,nF=Ac.create;var Dc=Object.freeze({status:"aborted"});function _(t,e,r){function n(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(t))return;a._zod.traits.add(t),e(a,c);let u=s.prototype,l=Object.keys(u);for(let d=0;d<l.length;d++){let p=l[d];p in a||(a[p]=u[p].bind(a))}}let o=r?.Parent??Object;class i extends o{}Object.defineProperty(i,"name",{value:t});function s(a){var c;let u=r?.Parent?new i:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(s,"name",{value:t}),s}var wr=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Un=class extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}},Mc={};function Be(t){return t&&Object.assign(Mc,t),Mc}var P={};An(P,{BIGINT_FORMAT_RANGES:()=>op,Class:()=>Xd,NUMBER_FORMAT_RANGES:()=>np,aborted:()=>dn,allowsEval:()=>ep,assert:()=>NT,assertEqual:()=>TT,assertIs:()=>CT,assertNever:()=>jT,assertNotEqual:()=>OT,assignProp:()=>cn,base64ToUint8Array:()=>kb,base64urlToUint8Array:()=>XT,cached:()=>Zo,captureStackTrace:()=>qc,cleanEnum:()=>KT,cleanRegex:()=>ss,clone:()=>mt,cloneDef:()=>AT,createTransparentProxy:()=>ZT,defineLazy:()=>ae,esc:()=>Uc,escapeRegex:()=>Ft,extend:()=>BT,finalizeIssue:()=>xt,floatSafeRemainder:()=>Yd,getElementAtPath:()=>MT,getEnumValues:()=>is,getLengthableOrigin:()=>us,getParsedType:()=>LT,getSizableOrigin:()=>cs,hexToUint8Array:()=>QT,isObject:()=>qn,isPlainObject:()=>ln,issue:()=>Vo,joinValues:()=>L,jsonStringifyReplacer:()=>Lo,merge:()=>WT,mergeDefs:()=>un,normalizeParams:()=>z,nullish:()=>an,numKeys:()=>qT,objectClone:()=>RT,omit:()=>FT,optionalKeys:()=>rp,partial:()=>GT,pick:()=>VT,prefixIssues:()=>Dt,primitiveTypes:()=>tp,promiseAllObject:()=>DT,propertyKeyTypes:()=>as,randomString:()=>UT,required:()=>JT,safeExtend:()=>HT,shallowClone:()=>xb,slugify:()=>Qd,stringifyPrimitive:()=>Z,uint8ArrayToBase64:()=>Sb,uint8ArrayToBase64url:()=>YT,uint8ArrayToHex:()=>e1,unwrapMessage:()=>os});function TT(t){return t}function OT(t){return t}function CT(t){}function jT(t){throw new Error("Unexpected value in exhaustive check")}function NT(t){}function is(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function L(t,e="|"){return t.map(r=>Z(r)).join(e)}function Lo(t,e){return typeof e=="bigint"?e.toString():e}function Zo(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function an(t){return t==null}function ss(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function Yd(t,e){let r=(t.toString().split(".")[1]||"").length,n=e.toString(),o=(n.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(n)){let c=n.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}let i=r>o?r:o,s=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}var wb=Symbol("evaluating");function ae(t,e,r){let n;Object.defineProperty(t,e,{get(){if(n!==wb)return n===void 0&&(n=wb,n=r()),n},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function RT(t){return Object.create(Object.getPrototypeOf(t),Object.getOwnPropertyDescriptors(t))}function cn(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function un(...t){let e={};for(let r of t){let n=Object.getOwnPropertyDescriptors(r);Object.assign(e,n)}return Object.defineProperties({},e)}function AT(t){return un(t._zod.def)}function MT(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function DT(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let i=0;i<e.length;i++)o[e[i]]=n[i];return o})}function UT(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function Uc(t){return JSON.stringify(t)}function Qd(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}var qc="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function qn(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var ep=Zo(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function ln(t){if(qn(t)===!1)return!1;let e=t.constructor;if(e===void 0||typeof e!="function")return!0;let r=e.prototype;return!(qn(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function xb(t){return ln(t)?{...t}:Array.isArray(t)?[...t]:t}function qT(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var LT=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},as=new Set(["string","number","symbol"]),tp=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Ft(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function mt(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function z(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function ZT(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,i){return e??(e=t()),Reflect.set(e,n,o,i)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function Z(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function rp(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var np={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},op={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function VT(t,e){let r=t._zod.def,n=un(t._zod.def,{get shape(){let o={};for(let i in e){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&(o[i]=r.shape[i])}return cn(this,"shape",o),o},checks:[]});return mt(t,n)}function FT(t,e){let r=t._zod.def,n=un(t._zod.def,{get shape(){let o={...t._zod.def.shape};for(let i in e){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&delete o[i]}return cn(this,"shape",o),o},checks:[]});return mt(t,n)}function BT(t,e){if(!ln(e))throw new Error("Invalid input to extend: expected a plain object");let r=t._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let o=un(t._zod.def,{get shape(){let i={...t._zod.def.shape,...e};return cn(this,"shape",i),i},checks:[]});return mt(t,o)}function HT(t,e){if(!ln(e))throw new Error("Invalid input to safeExtend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return cn(this,"shape",n),n},checks:t._zod.def.checks};return mt(t,r)}function WT(t,e){let r=un(t._zod.def,{get shape(){let n={...t._zod.def.shape,...e._zod.def.shape};return cn(this,"shape",n),n},get catchall(){return e._zod.def.catchall},checks:[]});return mt(t,r)}function GT(t,e,r){let n=un(e._zod.def,{get shape(){let o=e._zod.def.shape,i={...o};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(i[s]=t?new t({type:"optional",innerType:o[s]}):o[s])}else for(let s in o)i[s]=t?new t({type:"optional",innerType:o[s]}):o[s];return cn(this,"shape",i),i},checks:[]});return mt(e,n)}function JT(t,e,r){let n=un(e._zod.def,{get shape(){let o=e._zod.def.shape,i={...o};if(r)for(let s in r){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(i[s]=new t({type:"nonoptional",innerType:o[s]}))}else for(let s in o)i[s]=new t({type:"nonoptional",innerType:o[s]});return cn(this,"shape",i),i},checks:[]});return mt(e,n)}function dn(t,e=0){if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function Dt(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function os(t){return typeof t=="string"?t:t?.message}function xt(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=os(t.inst?._zod.def?.error?.(t))??os(e?.error?.(t))??os(r.customError?.(t))??os(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function cs(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function us(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Vo(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function KT(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function kb(t){let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function Sb(t){let e="";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function XT(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-e.length%4)%4);return kb(e+r)}function YT(t){return Sb(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function QT(t){let e=t.replace(/^0x/,"");if(e.length%2!==0)throw new Error("Invalid hex string length");let r=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)r[n/2]=Number.parseInt(e.slice(n,n+2),16);return r}function e1(t){return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}var Xd=class{constructor(...e){}};var Pb=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,Lo,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Lc=_("$ZodError",Pb),ls=_("$ZodError",Pb,{Parent:Error});function Zc(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function Vc(t,e=r=>r.message){let r={_errors:[]},n=o=>{for(let i of o.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(s=>n({issues:s}));else if(i.code==="invalid_key")n({issues:i.issues});else if(i.code==="invalid_element")n({issues:i.issues});else if(i.path.length===0)r._errors.push(e(i));else{let s=r,a=0;for(;a<i.path.length;){let c=i.path[a];a===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(e(i))):s[c]=s[c]||{_errors:[]},s=s[c],a++}}};return n(t),r}var ds=t=>(e,r,n,o)=>{let i=n?Object.assign(n,{async:!1}):{async:!1},s=e._zod.run({value:r,issues:[]},i);if(s instanceof Promise)throw new wr;if(s.issues.length){let a=new(o?.Err??t)(s.issues.map(c=>xt(c,i,Be())));throw qc(a,o?.callee),a}return s.value},ps=ds(ls),fs=t=>async(e,r,n,o)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){let a=new(o?.Err??t)(s.issues.map(c=>xt(c,i,Be())));throw qc(a,o?.callee),a}return s.value},ms=fs(ls),hs=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new wr;return i.issues.length?{success:!1,error:new(t??Lc)(i.issues.map(s=>xt(s,o,Be())))}:{success:!0,data:i.value}},Fo=hs(ls),gs=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new t(i.issues.map(s=>xt(s,o,Be())))}:{success:!0,data:i.value}},vs=gs(ls),Ib=t=>(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return ds(t)(e,r,o)};var Eb=t=>(e,r,n)=>ds(t)(e,r,n);var zb=t=>async(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return fs(t)(e,r,o)};var Tb=t=>async(e,r,n)=>fs(t)(e,r,n);var Ob=t=>(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return hs(t)(e,r,o)};var Cb=t=>(e,r,n)=>hs(t)(e,r,n);var jb=t=>async(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return gs(t)(e,r,o)};var Nb=t=>async(e,r,n)=>gs(t)(e,r,n);var Bt={};An(Bt,{base64:()=>bp,base64url:()=>Fc,bigint:()=>Pp,boolean:()=>zp,browserEmail:()=>u1,cidrv4:()=>yp,cidrv6:()=>_p,cuid:()=>ip,cuid2:()=>sp,date:()=>wp,datetime:()=>kp,domain:()=>p1,duration:()=>dp,e164:()=>$p,email:()=>fp,emoji:()=>mp,extendedDuration:()=>r1,guid:()=>pp,hex:()=>f1,hostname:()=>d1,html5Email:()=>s1,idnEmail:()=>c1,integer:()=>Ip,ipv4:()=>hp,ipv6:()=>gp,ksuid:()=>up,lowercase:()=>Cp,mac:()=>vp,md5_base64:()=>h1,md5_base64url:()=>g1,md5_hex:()=>m1,nanoid:()=>lp,null:()=>Tp,number:()=>Ep,rfc5322Email:()=>a1,sha1_base64:()=>y1,sha1_base64url:()=>_1,sha1_hex:()=>v1,sha256_base64:()=>$1,sha256_base64url:()=>w1,sha256_hex:()=>b1,sha384_base64:()=>k1,sha384_base64url:()=>S1,sha384_hex:()=>x1,sha512_base64:()=>I1,sha512_base64url:()=>E1,sha512_hex:()=>P1,string:()=>Sp,time:()=>xp,ulid:()=>ap,undefined:()=>Op,unicodeEmail:()=>Rb,uppercase:()=>jp,uuid:()=>Ln,uuid4:()=>n1,uuid6:()=>o1,uuid7:()=>i1,xid:()=>cp});var ip=/^[cC][^\s-]{8,}$/,sp=/^[0-9a-z]+$/,ap=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,cp=/^[0-9a-vA-V]{20}$/,up=/^[A-Za-z0-9]{27}$/,lp=/^[a-zA-Z0-9_-]{21}$/,dp=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,r1=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,pp=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Ln=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,n1=Ln(4),o1=Ln(6),i1=Ln(7),fp=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,s1=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,a1=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Rb=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,c1=Rb,u1=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,l1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function mp(){return new RegExp(l1,"u")}var hp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,gp=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,vp=t=>{let e=Ft(t??":");return new RegExp(`^(?:[0-9A-F]{2}${e}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${e}){5}[0-9a-f]{2}$`)},yp=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,_p=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,bp=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Fc=/^[A-Za-z0-9_-]*$/,d1=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,p1=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,$p=/^\+(?:[0-9]){6,14}[0-9]$/,Ab="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",wp=new RegExp(`^${Ab}$`);function Mb(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function xp(t){return new RegExp(`^${Mb(t)}$`)}function kp(t){let e=Mb({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${Ab}T(?:${n})$`)}var Sp=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},Pp=/^-?\d+n?$/,Ip=/^-?\d+$/,Ep=/^-?\d+(?:\.\d+)?/,zp=/^(?:true|false)$/i,Tp=/^null$/i;var Op=/^undefined$/i;var Cp=/^[^A-Z]*$/,jp=/^[^a-z]*$/,f1=/^[0-9a-fA-F]*$/;function ys(t,e){return new RegExp(`^[A-Za-z0-9+/]{${t}}${e}$`)}function _s(t){return new RegExp(`^[A-Za-z0-9_-]{${t}}$`)}var m1=/^[0-9a-fA-F]{32}$/,h1=ys(22,"=="),g1=_s(22),v1=/^[0-9a-fA-F]{40}$/,y1=ys(27,"="),_1=_s(27),b1=/^[0-9a-fA-F]{64}$/,$1=ys(43,"="),w1=_s(43),x1=/^[0-9a-fA-F]{96}$/,k1=ys(64,""),S1=_s(64),P1=/^[0-9a-fA-F]{128}$/,I1=ys(86,"=="),E1=_s(86);var Se=_("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),Ub={number:"number",bigint:"bigint",object:"date"},Np=_("$ZodCheckLessThan",(t,e)=>{Se.init(t,e);let r=Ub[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,i=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<i&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Rp=_("$ZodCheckGreaterThan",(t,e)=>{Se.init(t,e);let r=Ub[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,i=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>i&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),qb=_("$ZodCheckMultipleOf",(t,e)=>{Se.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):Yd(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),Lb=_("$ZodCheckNumberFormat",(t,e)=>{Se.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,i]=np[e.format];t._zod.onattach.push(s=>{let a=s._zod.bag;a.format=e.format,a.minimum=o,a.maximum=i,r&&(a.pattern=Ip)}),t._zod.check=s=>{let a=s.value;if(r){if(!Number.isInteger(a)){s.issues.push({expected:n,format:e.format,code:"invalid_type",continue:!1,input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?s.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):s.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&s.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>i&&s.issues.push({origin:"number",input:a,code:"too_big",maximum:i,inst:t})}}),Zb=_("$ZodCheckBigIntFormat",(t,e)=>{Se.init(t,e);let[r,n]=op[e.format];t._zod.onattach.push(o=>{let i=o._zod.bag;i.format=e.format,i.minimum=r,i.maximum=n}),t._zod.check=o=>{let i=o.value;i<r&&o.issues.push({origin:"bigint",input:i,code:"too_small",minimum:r,inclusive:!0,inst:t,continue:!e.abort}),i>n&&o.issues.push({origin:"bigint",input:i,code:"too_big",maximum:n,inst:t})}}),Vb=_("$ZodCheckMaxSize",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!an(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;o.size<=e.maximum||n.issues.push({origin:cs(o),code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Fb=_("$ZodCheckMinSize",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!an(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;o.size>=e.minimum||n.issues.push({origin:cs(o),code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Bb=_("$ZodCheckSizeEquals",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!an(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.size,o.maximum=e.size,o.size=e.size}),t._zod.check=n=>{let o=n.value,i=o.size;if(i===e.size)return;let s=i>e.size;n.issues.push({origin:cs(o),...s?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Hb=_("$ZodCheckMaxLength",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!an(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let s=us(o);n.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Wb=_("$ZodCheckMinLength",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!an(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let s=us(o);n.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Gb=_("$ZodCheckLengthEquals",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!an(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,i=o.length;if(i===e.length)return;let s=us(o),a=i>e.length;n.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),bs=_("$ZodCheckStringFormat",(t,e)=>{var r,n;Se.init(t,e),t._zod.onattach.push(o=>{let i=o._zod.bag;i.format=e.format,e.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),Jb=_("$ZodCheckRegex",(t,e)=>{bs.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),Kb=_("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=Cp),bs.init(t,e)}),Xb=_("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=jp),bs.init(t,e)}),Yb=_("$ZodCheckIncludes",(t,e)=>{Se.init(t,e);let r=Ft(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),Qb=_("$ZodCheckStartsWith",(t,e)=>{Se.init(t,e);let r=new RegExp(`^${Ft(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),e$=_("$ZodCheckEndsWith",(t,e)=>{Se.init(t,e);let r=new RegExp(`.*${Ft(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});function Db(t,e,r){t.issues.length&&e.issues.push(...Dt(r,t.issues))}var t$=_("$ZodCheckProperty",(t,e)=>{Se.init(t,e),t._zod.check=r=>{let n=e.schema._zod.run({value:r.value[e.property],issues:[]},{});if(n instanceof Promise)return n.then(o=>Db(o,r,e.property));Db(n,r,e.property)}}),r$=_("$ZodCheckMimeType",(t,e)=>{Se.init(t,e);let r=new Set(e.mime);t._zod.onattach.push(n=>{n._zod.bag.mime=e.mime}),t._zod.check=n=>{r.has(n.value.type)||n.issues.push({code:"invalid_value",values:e.mime,input:n.value.type,inst:t,continue:!e.abort})}}),n$=_("$ZodCheckOverwrite",(t,e)=>{Se.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var Bc=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(s=>s),o=Math.min(...n.map(s=>s.length-s.trimStart().length)),i=n.map(s=>s.slice(o)).map(s=>" ".repeat(this.indent*2)+s);for(let s of i)this.content.push(s)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(i=>`  ${i}`)];return new e(...r,o.join(`
`))}};var i$={major:4,minor:2,patch:1};var H=_("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=i$;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let i of o._zod.onattach)i(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,a,c)=>{let u=dn(s),l;for(let d of a){if(d._zod.def.when){if(!d._zod.def.when(s))continue}else if(u)continue;let p=s.issues.length,f=d._zod.check(s);if(f instanceof Promise&&c?.async===!1)throw new wr;if(l||f instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await f,s.issues.length!==p&&(u||(u=dn(s,p)))});else{if(s.issues.length===p)continue;u||(u=dn(s,p))}}return l?l.then(()=>s):s},i=(s,a,c)=>{if(dn(s))return s.aborted=!0,s;let u=o(a,n,c);if(u instanceof Promise){if(c.async===!1)throw new wr;return u.then(l=>t._zod.parse(l,c))}return t._zod.parse(u,c)};t._zod.run=(s,a)=>{if(a.skipChecks)return t._zod.parse(s,a);if(a.direction==="backward"){let u=t._zod.parse({value:s.value,issues:[]},{...a,skipChecks:!0});return u instanceof Promise?u.then(l=>i(l,s,a)):i(u,s,a)}let c=t._zod.parse(s,a);if(c instanceof Promise){if(a.async===!1)throw new wr;return c.then(u=>o(u,n,a))}return o(c,n,a)}}t["~standard"]={validate:o=>{try{let i=Fo(t,o);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return vs(t,o).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}}),Zn=_("$ZodString",(t,e)=>{H.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??Sp(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),$e=_("$ZodStringFormat",(t,e)=>{bs.init(t,e),Zn.init(t,e)}),Mp=_("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=pp),$e.init(t,e)}),Dp=_("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Ln(n))}else e.pattern??(e.pattern=Ln());$e.init(t,e)}),Up=_("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=fp),$e.init(t,e)}),qp=_("$ZodURL",(t,e)=>{$e.init(t,e),t._zod.check=r=>{try{let n=r.value.trim(),o=new URL(n);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),e.normalize?r.value=o.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),Lp=_("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=mp()),$e.init(t,e)}),Zp=_("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=lp),$e.init(t,e)}),Vp=_("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=ip),$e.init(t,e)}),Fp=_("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=sp),$e.init(t,e)}),Bp=_("$ZodULID",(t,e)=>{e.pattern??(e.pattern=ap),$e.init(t,e)}),Hp=_("$ZodXID",(t,e)=>{e.pattern??(e.pattern=cp),$e.init(t,e)}),Wp=_("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=up),$e.init(t,e)}),Gp=_("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=kp(e)),$e.init(t,e)}),Jp=_("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=wp),$e.init(t,e)}),Kp=_("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=xp(e)),$e.init(t,e)}),Xp=_("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=dp),$e.init(t,e)}),Yp=_("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=hp),$e.init(t,e),t._zod.bag.format="ipv4"}),Qp=_("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=gp),$e.init(t,e),t._zod.bag.format="ipv6",t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),ef=_("$ZodMAC",(t,e)=>{e.pattern??(e.pattern=vp(e.delimiter)),$e.init(t,e),t._zod.bag.format="mac"}),tf=_("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=yp),$e.init(t,e)}),rf=_("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=_p),$e.init(t,e),t._zod.check=r=>{let n=r.value.split("/");try{if(n.length!==2)throw new Error;let[o,i]=n;if(!i)throw new Error;let s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${o}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function v$(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var nf=_("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=bp),$e.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=r=>{v$(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function z1(t){if(!Fc.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return v$(r)}var of=_("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=Fc),$e.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=r=>{z1(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),sf=_("$ZodE164",(t,e)=>{e.pattern??(e.pattern=$p),$e.init(t,e)});function T1(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}var af=_("$ZodJWT",(t,e)=>{$e.init(t,e),t._zod.check=r=>{T1(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}}),cf=_("$ZodCustomStringFormat",(t,e)=>{$e.init(t,e),t._zod.check=r=>{e.fn(r.value)||r.issues.push({code:"invalid_format",format:e.format,input:r.value,inst:t,continue:!e.abort})}}),Xc=_("$ZodNumber",(t,e)=>{H.init(t,e),t._zod.pattern=t._zod.bag.pattern??Ep,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...i?{received:i}:{}}),r}}),uf=_("$ZodNumberFormat",(t,e)=>{Lb.init(t,e),Xc.init(t,e)}),$s=_("$ZodBoolean",(t,e)=>{H.init(t,e),t._zod.pattern=zp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}}),Yc=_("$ZodBigInt",(t,e)=>{H.init(t,e),t._zod.pattern=Pp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=BigInt(r.value)}catch{}return typeof r.value=="bigint"||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:t}),r}}),lf=_("$ZodBigIntFormat",(t,e)=>{Zb.init(t,e),Yc.init(t,e)}),df=_("$ZodSymbol",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return typeof o=="symbol"||r.issues.push({expected:"symbol",code:"invalid_type",input:o,inst:t}),r}}),pf=_("$ZodUndefined",(t,e)=>{H.init(t,e),t._zod.pattern=Op,t._zod.values=new Set([void 0]),t._zod.optin="optional",t._zod.optout="optional",t._zod.parse=(r,n)=>{let o=r.value;return typeof o>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:o,inst:t}),r}}),ff=_("$ZodNull",(t,e)=>{H.init(t,e),t._zod.pattern=Tp,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}}),mf=_("$ZodAny",(t,e)=>{H.init(t,e),t._zod.parse=r=>r}),hf=_("$ZodUnknown",(t,e)=>{H.init(t,e),t._zod.parse=r=>r}),gf=_("$ZodNever",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)}),vf=_("$ZodVoid",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return typeof o>"u"||r.issues.push({expected:"void",code:"invalid_type",input:o,inst:t}),r}}),yf=_("$ZodDate",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=new Date(r.value)}catch{}let o=r.value,i=o instanceof Date;return i&&!Number.isNaN(o.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:o,...i?{received:"Invalid Date"}:{},inst:t}),r}});function s$(t,e,r){t.issues.length&&e.issues.push(...Dt(r,t.issues)),e.value[r]=t.value}var _f=_("$ZodArray",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let i=[];for(let s=0;s<o.length;s++){let a=o[s],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?i.push(c.then(u=>s$(u,r,s))):s$(c,r,s)}return i.length?Promise.all(i).then(()=>r):r}});function Kc(t,e,r,n){t.issues.length&&e.issues.push(...Dt(r,t.issues)),t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}function y$(t){let e=Object.keys(t.shape);for(let n of e)if(!t.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);let r=rp(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}}function _$(t,e,r,n,o,i){let s=[],a=o.keySet,c=o.catchall._zod,u=c.def.type;for(let l in e){if(a.has(l))continue;if(u==="never"){s.push(l);continue}let d=c.run({value:e[l],issues:[]},n);d instanceof Promise?t.push(d.then(p=>Kc(p,r,l,e))):Kc(d,r,l,e)}return s.length&&r.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:i}),t.length?Promise.all(t).then(()=>r):r}var b$=_("$ZodObject",(t,e)=>{if(H.init(t,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){let a=e.shape;Object.defineProperty(e,"shape",{get:()=>{let c={...a};return Object.defineProperty(e,"shape",{value:c}),c}})}let n=Zo(()=>y$(e));ae(t._zod,"propValues",()=>{let a=e.shape,c={};for(let u in a){let l=a[u]._zod;if(l.values){c[u]??(c[u]=new Set);for(let d of l.values)c[u].add(d)}}return c});let o=qn,i=e.catchall,s;t._zod.parse=(a,c)=>{s??(s=n.value);let u=a.value;if(!o(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:t}),a;a.value={};let l=[],d=s.shape;for(let p of s.keys){let h=d[p]._zod.run({value:u[p],issues:[]},c);h instanceof Promise?l.push(h.then(m=>Kc(m,a,p,u))):Kc(h,a,p,u)}return i?_$(l,u,a,c,n.value,t):l.length?Promise.all(l).then(()=>a):a}}),$$=_("$ZodObjectJIT",(t,e)=>{b$.init(t,e);let r=t._zod.parse,n=Zo(()=>y$(e)),o=p=>{let f=new Bc(["shape","payload","ctx"]),h=n.value,m=x=>{let I=Uc(x);return`shape[${I}]._zod.run({ value: input[${I}], issues: [] }, ctx)`};f.write("const input = payload.value;");let g=Object.create(null),v=0;for(let x of h.keys)g[x]=`key_${v++}`;f.write("const newResult = {};");for(let x of h.keys){let I=g[x],k=Uc(x);f.write(`const ${I} = ${m(x)};`),f.write(`
        if (${I}.issues.length) {
          payload.issues = payload.issues.concat(${I}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${k}, ...iss.path] : [${k}]
          })));
        }
        
        
        if (${I}.value === undefined) {
          if (${k} in input) {
            newResult[${k}] = undefined;
          }
        } else {
          newResult[${k}] = ${I}.value;
        }
        
      `)}f.write("payload.value = newResult;"),f.write("return payload;");let $=f.compile();return(x,I)=>$(p,x,I)},i,s=qn,a=!Mc.jitless,u=a&&ep.value,l=e.catchall,d;t._zod.parse=(p,f)=>{d??(d=n.value);let h=p.value;return s(h)?a&&u&&f?.async===!1&&f.jitless!==!0?(i||(i=o(e.shape)),p=i(p,f),l?_$([],h,p,f,d,t):p):r(p,f):(p.issues.push({expected:"object",code:"invalid_type",input:h,inst:t}),p)}});function a$(t,e,r,n){for(let i of t)if(i.issues.length===0)return e.value=i.value,e;let o=t.filter(i=>!dn(i));return o.length===1?(e.value=o[0].value,o[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(i=>i.issues.map(s=>xt(s,n,Be())))}),e)}var ws=_("$ZodUnion",(t,e)=>{H.init(t,e),ae(t._zod,"optin",()=>e.options.some(o=>o._zod.optin==="optional")?"optional":void 0),ae(t._zod,"optout",()=>e.options.some(o=>o._zod.optout==="optional")?"optional":void 0),ae(t._zod,"values",()=>{if(e.options.every(o=>o._zod.values))return new Set(e.options.flatMap(o=>Array.from(o._zod.values)))}),ae(t._zod,"pattern",()=>{if(e.options.every(o=>o._zod.pattern)){let o=e.options.map(i=>i._zod.pattern);return new RegExp(`^(${o.map(i=>ss(i.source)).join("|")})$`)}});let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let c of e.options){let u=c._zod.run({value:o.value,issues:[]},i);if(u instanceof Promise)a.push(u),s=!0;else{if(u.issues.length===0)return u;a.push(u)}}return s?Promise.all(a).then(c=>a$(c,o,t,i)):a$(a,o,t,i)}});function c$(t,e,r,n){let o=t.filter(i=>i.issues.length===0);return o.length===1?(e.value=o[0].value,e):(o.length===0?e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(i=>i.issues.map(s=>xt(s,n,Be())))}):e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:[],inclusive:!1}),e)}var bf=_("$ZodXor",(t,e)=>{ws.init(t,e),e.inclusive=!1;let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let c of e.options){let u=c._zod.run({value:o.value,issues:[]},i);u instanceof Promise?(a.push(u),s=!0):a.push(u)}return s?Promise.all(a).then(c=>c$(c,o,t,i)):c$(a,o,t,i)}}),$f=_("$ZodDiscriminatedUnion",(t,e)=>{e.inclusive=!1,ws.init(t,e);let r=t._zod.parse;ae(t._zod,"propValues",()=>{let o={};for(let i of e.options){let s=i._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let[a,c]of Object.entries(s)){o[a]||(o[a]=new Set);for(let u of c)o[a].add(u)}}return o});let n=Zo(()=>{let o=e.options,i=new Map;for(let s of o){let a=s._zod.propValues?.[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let c of a){if(i.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);i.set(c,s)}}return i});t._zod.parse=(o,i)=>{let s=o.value;if(!qn(s))return o.issues.push({code:"invalid_type",expected:"object",input:s,inst:t}),o;let a=n.value.get(s?.[e.discriminator]);return a?a._zod.run(o,i):e.unionFallback?r(o,i):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:s,path:[e.discriminator],inst:t}),o)}}),wf=_("$ZodIntersection",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,i=e.left._zod.run({value:o,issues:[]},n),s=e.right._zod.run({value:o,issues:[]},n);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([c,u])=>u$(r,c,u)):u$(r,i,s)}});function Ap(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(ln(t)&&ln(e)){let r=Object.keys(e),n=Object.keys(t).filter(i=>r.indexOf(i)!==-1),o={...t,...e};for(let i of n){let s=Ap(t[i],e[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};o[i]=s.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],i=e[n],s=Ap(o,i);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function u$(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),dn(t))return t;let n=Ap(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}var Qc=_("$ZodTuple",(t,e)=>{H.init(t,e);let r=e.items;t._zod.parse=(n,o)=>{let i=n.value;if(!Array.isArray(i))return n.issues.push({input:i,inst:t,expected:"tuple",code:"invalid_type"}),n;n.value=[];let s=[],a=[...r].reverse().findIndex(l=>l._zod.optin!=="optional"),c=a===-1?0:r.length-a;if(!e.rest){let l=i.length>r.length,d=i.length<c-1;if(l||d)return n.issues.push({...l?{code:"too_big",maximum:r.length}:{code:"too_small",minimum:r.length},input:i,inst:t,origin:"array"}),n}let u=-1;for(let l of r){if(u++,u>=i.length&&u>=c)continue;let d=l._zod.run({value:i[u],issues:[]},o);d instanceof Promise?s.push(d.then(p=>Hc(p,n,u))):Hc(d,n,u)}if(e.rest){let l=i.slice(r.length);for(let d of l){u++;let p=e.rest._zod.run({value:d,issues:[]},o);p instanceof Promise?s.push(p.then(f=>Hc(f,n,u))):Hc(p,n,u)}}return s.length?Promise.all(s).then(()=>n):n}});function Hc(t,e,r){t.issues.length&&e.issues.push(...Dt(r,t.issues)),e.value[r]=t.value}var xf=_("$ZodRecord",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!ln(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let i=[],s=e.keyType._zod.values;if(s){r.value={};let a=new Set;for(let u of s)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){a.add(typeof u=="number"?u.toString():u);let l=e.valueType._zod.run({value:o[u],issues:[]},n);l instanceof Promise?i.push(l.then(d=>{d.issues.length&&r.issues.push(...Dt(u,d.issues)),r.value[u]=d.value})):(l.issues.length&&r.issues.push(...Dt(u,l.issues)),r.value[u]=l.value)}let c;for(let u in o)a.has(u)||(c=c??[],c.push(u));c&&c.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:c})}else{r.value={};for(let a of Reflect.ownKeys(o)){if(a==="__proto__")continue;let c=e.keyType._zod.run({value:a,issues:[]},n);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(c.issues.length){e.mode==="loose"?r.value[a]=o[a]:r.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(l=>xt(l,n,Be())),input:a,path:[a],inst:t});continue}let u=e.valueType._zod.run({value:o[a],issues:[]},n);u instanceof Promise?i.push(u.then(l=>{l.issues.length&&r.issues.push(...Dt(a,l.issues)),r.value[c.value]=l.value})):(u.issues.length&&r.issues.push(...Dt(a,u.issues)),r.value[c.value]=u.value)}}return i.length?Promise.all(i).then(()=>r):r}}),kf=_("$ZodMap",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!(o instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:o,inst:t}),r;let i=[];r.value=new Map;for(let[s,a]of o){let c=e.keyType._zod.run({value:s,issues:[]},n),u=e.valueType._zod.run({value:a,issues:[]},n);c instanceof Promise||u instanceof Promise?i.push(Promise.all([c,u]).then(([l,d])=>{l$(l,d,r,s,o,t,n)})):l$(c,u,r,s,o,t,n)}return i.length?Promise.all(i).then(()=>r):r}});function l$(t,e,r,n,o,i,s){t.issues.length&&(as.has(typeof n)?r.issues.push(...Dt(n,t.issues)):r.issues.push({code:"invalid_key",origin:"map",input:o,inst:i,issues:t.issues.map(a=>xt(a,s,Be()))})),e.issues.length&&(as.has(typeof n)?r.issues.push(...Dt(n,e.issues)):r.issues.push({origin:"map",code:"invalid_element",input:o,inst:i,key:n,issues:e.issues.map(a=>xt(a,s,Be()))})),r.value.set(t.value,e.value)}var Sf=_("$ZodSet",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!(o instanceof Set))return r.issues.push({input:o,inst:t,expected:"set",code:"invalid_type"}),r;let i=[];r.value=new Set;for(let s of o){let a=e.valueType._zod.run({value:s,issues:[]},n);a instanceof Promise?i.push(a.then(c=>d$(c,r))):d$(a,r)}return i.length?Promise.all(i).then(()=>r):r}});function d$(t,e){t.issues.length&&e.issues.push(...t.issues),e.value.add(t.value)}var Pf=_("$ZodEnum",(t,e)=>{H.init(t,e);let r=is(e.entries),n=new Set(r);t._zod.values=n,t._zod.pattern=new RegExp(`^(${r.filter(o=>as.has(typeof o)).map(o=>typeof o=="string"?Ft(o):o.toString()).join("|")})$`),t._zod.parse=(o,i)=>{let s=o.value;return n.has(s)||o.issues.push({code:"invalid_value",values:r,input:s,inst:t}),o}}),If=_("$ZodLiteral",(t,e)=>{if(H.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");let r=new Set(e.values);t._zod.values=r,t._zod.pattern=new RegExp(`^(${e.values.map(n=>typeof n=="string"?Ft(n):n?Ft(n.toString()):String(n)).join("|")})$`),t._zod.parse=(n,o)=>{let i=n.value;return r.has(i)||n.issues.push({code:"invalid_value",values:e.values,input:i,inst:t}),n}}),Ef=_("$ZodFile",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return o instanceof File||r.issues.push({expected:"file",code:"invalid_type",input:o,inst:t}),r}}),zf=_("$ZodTransform",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Un(t.constructor.name);let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(s=>(r.value=s,r));if(o instanceof Promise)throw new wr;return r.value=o,r}});function p$(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}var Tf=_("$ZodOptional",(t,e)=>{H.init(t,e),t._zod.optin="optional",t._zod.optout="optional",ae(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ae(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${ss(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>{if(e.innerType._zod.optin==="optional"){let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>p$(i,r.value)):p$(o,r.value)}return r.value===void 0?r:e.innerType._zod.run(r,n)}}),Of=_("$ZodNullable",(t,e)=>{H.init(t,e),ae(t._zod,"optin",()=>e.innerType._zod.optin),ae(t._zod,"optout",()=>e.innerType._zod.optout),ae(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${ss(r.source)}|null)$`):void 0}),ae(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),Cf=_("$ZodDefault",(t,e)=>{H.init(t,e),t._zod.optin="optional",ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>f$(i,e)):f$(o,e)}});function f$(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var jf=_("$ZodPrefault",(t,e)=>{H.init(t,e),t._zod.optin="optional",ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),Nf=_("$ZodNonOptional",(t,e)=>{H.init(t,e),ae(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>m$(i,t)):m$(o,t)}});function m$(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var Rf=_("$ZodSuccess",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Un("ZodSuccess");let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>(r.value=i.issues.length===0,r)):(r.value=o.issues.length===0,r)}}),Af=_("$ZodCatch",(t,e)=>{H.init(t,e),ae(t._zod,"optin",()=>e.innerType._zod.optin),ae(t._zod,"optout",()=>e.innerType._zod.optout),ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>(r.value=i.value,i.issues.length&&(r.value=e.catchValue({...r,error:{issues:i.issues.map(s=>xt(s,n,Be()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(i=>xt(i,n,Be()))},input:r.value}),r.issues=[]),r)}}),Mf=_("$ZodNaN",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>((typeof r.value!="number"||!Number.isNaN(r.value))&&r.issues.push({input:r.value,inst:t,expected:"nan",code:"invalid_type"}),r)}),Df=_("$ZodPipe",(t,e)=>{H.init(t,e),ae(t._zod,"values",()=>e.in._zod.values),ae(t._zod,"optin",()=>e.in._zod.optin),ae(t._zod,"optout",()=>e.out._zod.optout),ae(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if(n.direction==="backward"){let i=e.out._zod.run(r,n);return i instanceof Promise?i.then(s=>Wc(s,e.in,n)):Wc(i,e.in,n)}let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(i=>Wc(i,e.out,n)):Wc(o,e.out,n)}});function Wc(t,e,r){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},r)}var xs=_("$ZodCodec",(t,e)=>{H.init(t,e),ae(t._zod,"values",()=>e.in._zod.values),ae(t._zod,"optin",()=>e.in._zod.optin),ae(t._zod,"optout",()=>e.out._zod.optout),ae(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if((n.direction||"forward")==="forward"){let i=e.in._zod.run(r,n);return i instanceof Promise?i.then(s=>Gc(s,e,n)):Gc(i,e,n)}else{let i=e.out._zod.run(r,n);return i instanceof Promise?i.then(s=>Gc(s,e,n)):Gc(i,e,n)}}});function Gc(t,e,r){if(t.issues.length)return t.aborted=!0,t;if((r.direction||"forward")==="forward"){let o=e.transform(t.value,t);return o instanceof Promise?o.then(i=>Jc(t,i,e.out,r)):Jc(t,o,e.out,r)}else{let o=e.reverseTransform(t.value,t);return o instanceof Promise?o.then(i=>Jc(t,i,e.in,r)):Jc(t,o,e.in,r)}}function Jc(t,e,r,n){return t.issues.length?(t.aborted=!0,t):r._zod.run({value:e,issues:t.issues},n)}var Uf=_("$ZodReadonly",(t,e)=>{H.init(t,e),ae(t._zod,"propValues",()=>e.innerType._zod.propValues),ae(t._zod,"values",()=>e.innerType._zod.values),ae(t._zod,"optin",()=>e.innerType?._zod?.optin),ae(t._zod,"optout",()=>e.innerType?._zod?.optout),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(h$):h$(o)}});function h$(t){return t.value=Object.freeze(t.value),t}var qf=_("$ZodTemplateLiteral",(t,e)=>{H.init(t,e);let r=[];for(let n of e.parts)if(typeof n=="object"&&n!==null){if(!n._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...n._zod.traits].shift()}`);let o=n._zod.pattern instanceof RegExp?n._zod.pattern.source:n._zod.pattern;if(!o)throw new Error(`Invalid template literal part: ${n._zod.traits}`);let i=o.startsWith("^")?1:0,s=o.endsWith("$")?o.length-1:o.length;r.push(o.slice(i,s))}else if(n===null||tp.has(typeof n))r.push(Ft(`${n}`));else throw new Error(`Invalid template literal part: ${n}`);t._zod.pattern=new RegExp(`^${r.join("")}$`),t._zod.parse=(n,o)=>typeof n.value!="string"?(n.issues.push({input:n.value,inst:t,expected:"template_literal",code:"invalid_type"}),n):(t._zod.pattern.lastIndex=0,t._zod.pattern.test(n.value)||n.issues.push({input:n.value,inst:t,code:"invalid_format",format:e.format??"template_literal",pattern:t._zod.pattern.source}),n)}),Lf=_("$ZodFunction",(t,e)=>(H.init(t,e),t._def=e,t._zod.def=e,t.implement=r=>{if(typeof r!="function")throw new Error("implement() must be called with a function");return function(...n){let o=t._def.input?ps(t._def.input,n):n,i=Reflect.apply(r,this,o);return t._def.output?ps(t._def.output,i):i}},t.implementAsync=r=>{if(typeof r!="function")throw new Error("implementAsync() must be called with a function");return async function(...n){let o=t._def.input?await ms(t._def.input,n):n,i=await Reflect.apply(r,this,o);return t._def.output?await ms(t._def.output,i):i}},t._zod.parse=(r,n)=>typeof r.value!="function"?(r.issues.push({code:"invalid_type",expected:"function",input:r.value,inst:t}),r):(t._def.output&&t._def.output._zod.def.type==="promise"?r.value=t.implementAsync(r.value):r.value=t.implement(r.value),r),t.input=(...r)=>{let n=t.constructor;return Array.isArray(r[0])?new n({type:"function",input:new Qc({type:"tuple",items:r[0],rest:r[1]}),output:t._def.output}):new n({type:"function",input:r[0],output:t._def.output})},t.output=r=>{let n=t.constructor;return new n({type:"function",input:t._def.input,output:r})},t)),Zf=_("$ZodPromise",(t,e)=>{H.init(t,e),t._zod.parse=(r,n)=>Promise.resolve(r.value).then(o=>e.innerType._zod.run({value:o,issues:[]},n))}),Vf=_("$ZodLazy",(t,e)=>{H.init(t,e),ae(t._zod,"innerType",()=>e.getter()),ae(t._zod,"pattern",()=>t._zod.innerType?._zod?.pattern),ae(t._zod,"propValues",()=>t._zod.innerType?._zod?.propValues),ae(t._zod,"optin",()=>t._zod.innerType?._zod?.optin??void 0),ae(t._zod,"optout",()=>t._zod.innerType?._zod?.optout??void 0),t._zod.parse=(r,n)=>t._zod.innerType._zod.run(r,n)}),Ff=_("$ZodCustom",(t,e)=>{Se.init(t,e),H.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(i=>g$(i,r,n,t));g$(o,r,n,t)}});function g$(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(Vo(o))}}var C1=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},j1=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${C1(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${Z(n.values[0])}`:`Invalid option: expected one of ${L(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",i=e(n.origin);return i?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${i.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",i=e(n.origin);return i?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${i.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${L(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}};function Bf(){return{localeError:j1()}}var w$;var Wf=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};delete n.id;let o={...n,...this._map.get(e)};return Object.keys(o).length?o:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};function Gf(){return new Wf}(w$=globalThis).__zod_globalRegistry??(w$.__zod_globalRegistry=Gf());var kt=globalThis.__zod_globalRegistry;function Jf(t,e){return new t({type:"string",...z(e)})}function Kf(t,e){return new t({type:"string",coerce:!0,...z(e)})}function eu(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...z(e)})}function ks(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...z(e)})}function tu(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...z(e)})}function ru(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...z(e)})}function nu(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...z(e)})}function ou(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...z(e)})}function Ss(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...z(e)})}function iu(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...z(e)})}function su(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...z(e)})}function au(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...z(e)})}function cu(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...z(e)})}function uu(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...z(e)})}function lu(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...z(e)})}function du(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...z(e)})}function pu(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...z(e)})}function fu(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...z(e)})}function Xf(t,e){return new t({type:"string",format:"mac",check:"string_format",abort:!1,...z(e)})}function mu(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...z(e)})}function hu(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...z(e)})}function gu(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...z(e)})}function vu(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...z(e)})}function yu(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...z(e)})}function _u(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...z(e)})}function Yf(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...z(e)})}function Qf(t,e){return new t({type:"string",format:"date",check:"string_format",...z(e)})}function em(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...z(e)})}function tm(t,e){return new t({type:"string",format:"duration",check:"string_format",...z(e)})}function rm(t,e){return new t({type:"number",checks:[],...z(e)})}function nm(t,e){return new t({type:"number",coerce:!0,checks:[],...z(e)})}function om(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...z(e)})}function im(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float32",...z(e)})}function sm(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float64",...z(e)})}function am(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"int32",...z(e)})}function cm(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"uint32",...z(e)})}function um(t,e){return new t({type:"boolean",...z(e)})}function lm(t,e){return new t({type:"boolean",coerce:!0,...z(e)})}function dm(t,e){return new t({type:"bigint",...z(e)})}function pm(t,e){return new t({type:"bigint",coerce:!0,...z(e)})}function fm(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...z(e)})}function mm(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...z(e)})}function hm(t,e){return new t({type:"symbol",...z(e)})}function gm(t,e){return new t({type:"undefined",...z(e)})}function vm(t,e){return new t({type:"null",...z(e)})}function ym(t){return new t({type:"any"})}function _m(t){return new t({type:"unknown"})}function bm(t,e){return new t({type:"never",...z(e)})}function $m(t,e){return new t({type:"void",...z(e)})}function wm(t,e){return new t({type:"date",...z(e)})}function xm(t,e){return new t({type:"date",coerce:!0,...z(e)})}function km(t,e){return new t({type:"nan",...z(e)})}function Dr(t,e){return new Np({check:"less_than",...z(e),value:t,inclusive:!1})}function Ut(t,e){return new Np({check:"less_than",...z(e),value:t,inclusive:!0})}function Ur(t,e){return new Rp({check:"greater_than",...z(e),value:t,inclusive:!1})}function ht(t,e){return new Rp({check:"greater_than",...z(e),value:t,inclusive:!0})}function Sm(t){return Ur(0,t)}function Pm(t){return Dr(0,t)}function Im(t){return Ut(0,t)}function Em(t){return ht(0,t)}function Vn(t,e){return new qb({check:"multiple_of",...z(e),value:t})}function Bo(t,e){return new Vb({check:"max_size",...z(e),maximum:t})}function Fn(t,e){return new Fb({check:"min_size",...z(e),minimum:t})}function Ps(t,e){return new Bb({check:"size_equals",...z(e),size:t})}function Ho(t,e){return new Hb({check:"max_length",...z(e),maximum:t})}function pn(t,e){return new Wb({check:"min_length",...z(e),minimum:t})}function Wo(t,e){return new Gb({check:"length_equals",...z(e),length:t})}function Is(t,e){return new Jb({check:"string_format",format:"regex",...z(e),pattern:t})}function Es(t){return new Kb({check:"string_format",format:"lowercase",...z(t)})}function zs(t){return new Xb({check:"string_format",format:"uppercase",...z(t)})}function Ts(t,e){return new Yb({check:"string_format",format:"includes",...z(e),includes:t})}function Os(t,e){return new Qb({check:"string_format",format:"starts_with",...z(e),prefix:t})}function Cs(t,e){return new e$({check:"string_format",format:"ends_with",...z(e),suffix:t})}function zm(t,e,r){return new t$({check:"property",property:t,schema:e,...z(r)})}function js(t,e){return new r$({check:"mime_type",mime:t,...z(e)})}function xr(t){return new n$({check:"overwrite",tx:t})}function Ns(t){return xr(e=>e.normalize(t))}function Rs(){return xr(t=>t.trim())}function As(){return xr(t=>t.toLowerCase())}function Ms(){return xr(t=>t.toUpperCase())}function bu(){return xr(t=>Qd(t))}function x$(t,e,r){return new t({type:"array",element:e,...z(r)})}function Tm(t,e){return new t({type:"file",...z(e)})}function Om(t,e,r){let n=z(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function Cm(t,e,r){return new t({type:"custom",check:"custom",fn:e,...z(r)})}function jm(t){let e=M1(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(Vo(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(Vo(o))}},t(r.value,r)));return e}function M1(t,e){let r=new Se({check:"custom",...z(e)});return r._zod.check=t,r}function Nm(t){let e=new Se({check:"describe"});return e._zod.onattach=[r=>{let n=kt.get(r)??{};kt.add(r,{...n,description:t})}],e._zod.check=()=>{},e}function Rm(t){let e=new Se({check:"meta"});return e._zod.onattach=[r=>{let n=kt.get(r)??{};kt.add(r,{...n,...t})}],e._zod.check=()=>{},e}function Am(t,e){let r=z(e),n=r.truthy??["true","1","yes","on","y","enabled"],o=r.falsy??["false","0","no","off","n","disabled"];r.case!=="sensitive"&&(n=n.map(f=>typeof f=="string"?f.toLowerCase():f),o=o.map(f=>typeof f=="string"?f.toLowerCase():f));let i=new Set(n),s=new Set(o),a=t.Codec??xs,c=t.Boolean??$s,u=t.String??Zn,l=new u({type:"string",error:r.error}),d=new c({type:"boolean",error:r.error}),p=new a({type:"pipe",in:l,out:d,transform:((f,h)=>{let m=f;return r.case!=="sensitive"&&(m=m.toLowerCase()),i.has(m)?!0:s.has(m)?!1:(h.issues.push({code:"invalid_value",expected:"stringbool",values:[...i,...s],input:h.value,inst:p,continue:!1}),{})}),reverseTransform:((f,h)=>f===!0?n[0]||"true":o[0]||"false"),error:r.error});return p}function Go(t,e,r,n={}){let o=z(n),i={...z(n),check:"string_format",type:"string",format:e,fn:typeof r=="function"?r:a=>r.test(a),...o};return r instanceof RegExp&&(i.pattern=r),new t(i)}function $u(t){let e=t?.target??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:t?.metadata??kt,target:e,unrepresentable:t?.unrepresentable??"throw",override:t?.override??(()=>{}),io:t?.io??"output",counter:0,seen:new Map,cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0}}function Oe(t,e,r={path:[],schemaPath:[]}){var n;let o=t._zod.def,i=e.seen.get(t);if(i)return i.count++,r.schemaPath.includes(t)&&(i.cycle=r.path),i.schema;let s={schema:{},count:1,cycle:void 0,path:r.path};e.seen.set(t,s);let a=t._zod.toJSONSchema?.();if(a)s.schema=a;else{let l={...r,schemaPath:[...r.schemaPath,t],path:r.path},d=t._zod.parent;if(d)s.ref=d,Oe(d,e,l),e.seen.get(d).isParent=!0;else if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,s.schema,l);else{let p=s.schema,f=e.processors[o.type];if(!f)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${o.type}`);f(t,e,p,l)}}let c=e.metadataRegistry.get(t);return c&&Object.assign(s.schema,c),e.io==="input"&&gt(t)&&(delete s.schema.examples,delete s.schema.default),e.io==="input"&&s.schema._prefault&&((n=s.schema).default??(n.default=s.schema._prefault)),delete s.schema._prefault,e.seen.get(t).schema}function wu(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=i=>{let s=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){let l=t.external.registry.get(i[0])?.id,d=t.external.uri??(f=>f);if(l)return{ref:d(l)};let p=i[1].defId??i[1].schema.id??`schema${t.counter++}`;return i[1].defId=p,{defId:p,ref:`${d("__shared")}#/${s}/${p}`}}if(i[1]===r)return{ref:"#"};let c=`#/${s}/`,u=i[1].schema.id??`__schema${t.counter++}`;return{defId:u,ref:c+u}},o=i=>{if(i[1].schema.$ref)return;let s=i[1],{ref:a,defId:c}=n(i);s.def={...s.schema},c&&(s.defId=c);let u=s.schema;for(let l in u)delete u[l];u.$ref=a};if(t.cycles==="throw")for(let i of t.seen.entries()){let s=i[1];if(s.cycle)throw new Error(`Cycle detected: #/${s.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let i of t.seen.entries()){let s=i[1];if(e===i[0]){o(i);continue}if(t.external){let c=t.external.registry.get(i[0])?.id;if(e!==i[0]&&c){o(i);continue}}if(t.metadataRegistry.get(i[0])?.id){o(i);continue}if(s.cycle){o(i);continue}if(s.count>1&&t.reused==="ref"){o(i);continue}}}function xu(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=s=>{let a=t.seen.get(s),c=a.def??a.schema,u={...c};if(a.ref===null)return;let l=a.ref;if(a.ref=null,l){n(l);let d=t.seen.get(l).schema;d.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(d)):(Object.assign(c,d),Object.assign(c,u))}a.isParent||t.override({zodSchema:s,jsonSchema:c,path:a.path??[]})};for(let s of[...t.seen.entries()].reverse())n(s[0]);let o={};if(t.target==="draft-2020-12"?o.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?o.$schema="http://json-schema.org/draft-04/schema#":t.target,t.external?.uri){let s=t.external.registry.get(e)?.id;if(!s)throw new Error("Schema is missing an `id` property");o.$id=t.external.uri(s)}Object.assign(o,r.def??r.schema);let i=t.external?.defs??{};for(let s of t.seen.entries()){let a=s[1];a.def&&a.defId&&(i[a.defId]=a.def)}t.external||Object.keys(i).length>0&&(t.target==="draft-2020-12"?o.$defs=i:o.definitions=i);try{let s=JSON.parse(JSON.stringify(o));return Object.defineProperty(s,"~standard",{value:{...e["~standard"],jsonSchema:{input:Ds(e,"input"),output:Ds(e,"output")}},enumerable:!1,writable:!1}),s}catch{throw new Error("Error converting schema to JSON.")}}function gt(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let n=t._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return gt(n.element,r);if(n.type==="set")return gt(n.valueType,r);if(n.type==="lazy")return gt(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return gt(n.innerType,r);if(n.type==="intersection")return gt(n.left,r)||gt(n.right,r);if(n.type==="record"||n.type==="map")return gt(n.keyType,r)||gt(n.valueType,r);if(n.type==="pipe")return gt(n.in,r)||gt(n.out,r);if(n.type==="object"){for(let o in n.shape)if(gt(n.shape[o],r))return!0;return!1}if(n.type==="union"){for(let o of n.options)if(gt(o,r))return!0;return!1}if(n.type==="tuple"){for(let o of n.items)if(gt(o,r))return!0;return!!(n.rest&&gt(n.rest,r))}return!1}var k$=(t,e={})=>r=>{let n=$u({...r,processors:e});return Oe(t,n),wu(n,t),xu(n,t)},Ds=(t,e)=>r=>{let{libraryOptions:n,target:o}=r??{},i=$u({...n??{},target:o,io:e,processors:{}});return Oe(t,i),wu(i,t),xu(i,t)};var D1={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},S$=(t,e,r,n)=>{let o=r;o.type="string";let{minimum:i,maximum:s,format:a,patterns:c,contentEncoding:u}=t._zod.bag;if(typeof i=="number"&&(o.minLength=i),typeof s=="number"&&(o.maxLength=s),a&&(o.format=D1[a]??a,o.format===""&&delete o.format),u&&(o.contentEncoding=u),c&&c.size>0){let l=[...c];l.length===1?o.pattern=l[0].source:l.length>1&&(o.allOf=[...l.map(d=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:d.source}))])}},P$=(t,e,r,n)=>{let o=r,{minimum:i,maximum:s,format:a,multipleOf:c,exclusiveMaximum:u,exclusiveMinimum:l}=t._zod.bag;typeof a=="string"&&a.includes("int")?o.type="integer":o.type="number",typeof l=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.minimum=l,o.exclusiveMinimum=!0):o.exclusiveMinimum=l),typeof i=="number"&&(o.minimum=i,typeof l=="number"&&e.target!=="draft-04"&&(l>=i?delete o.minimum:delete o.exclusiveMinimum)),typeof u=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.maximum=u,o.exclusiveMaximum=!0):o.exclusiveMaximum=u),typeof s=="number"&&(o.maximum=s,typeof u=="number"&&e.target!=="draft-04"&&(u<=s?delete o.maximum:delete o.exclusiveMaximum)),typeof c=="number"&&(o.multipleOf=c)},I$=(t,e,r,n)=>{r.type="boolean"},E$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},z$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},T$=(t,e,r,n)=>{e.target==="openapi-3.0"?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"},O$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},C$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},j$=(t,e,r,n)=>{r.not={}},N$=(t,e,r,n)=>{},R$=(t,e,r,n)=>{},A$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},M$=(t,e,r,n)=>{let o=t._zod.def,i=is(o.entries);i.every(s=>typeof s=="number")&&(r.type="number"),i.every(s=>typeof s=="string")&&(r.type="string"),r.enum=i},D$=(t,e,r,n)=>{let o=t._zod.def,i=[];for(let s of o.values)if(s===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof s=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");i.push(Number(s))}else i.push(s);if(i.length!==0)if(i.length===1){let s=i[0];r.type=s===null?"null":typeof s,e.target==="draft-04"||e.target==="openapi-3.0"?r.enum=[s]:r.const=s}else i.every(s=>typeof s=="number")&&(r.type="number"),i.every(s=>typeof s=="string")&&(r.type="string"),i.every(s=>typeof s=="boolean")&&(r.type="boolean"),i.every(s=>s===null)&&(r.type="null"),r.enum=i},U$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},q$=(t,e,r,n)=>{let o=r,i=t._zod.pattern;if(!i)throw new Error("Pattern not found in template literal");o.type="string",o.pattern=i.source},L$=(t,e,r,n)=>{let o=r,i={type:"string",format:"binary",contentEncoding:"binary"},{minimum:s,maximum:a,mime:c}=t._zod.bag;s!==void 0&&(i.minLength=s),a!==void 0&&(i.maxLength=a),c?c.length===1?(i.contentMediaType=c[0],Object.assign(o,i)):o.anyOf=c.map(u=>({...i,contentMediaType:u})):Object.assign(o,i)},Z$=(t,e,r,n)=>{r.type="boolean"},V$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},F$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},B$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},H$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},W$=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},G$=(t,e,r,n)=>{let o=r,i=t._zod.def,{minimum:s,maximum:a}=t._zod.bag;typeof s=="number"&&(o.minItems=s),typeof a=="number"&&(o.maxItems=a),o.type="array",o.items=Oe(i.element,e,{...n,path:[...n.path,"items"]})},J$=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="object",o.properties={};let s=i.shape;for(let u in s)o.properties[u]=Oe(s[u],e,{...n,path:[...n.path,"properties",u]});let a=new Set(Object.keys(s)),c=new Set([...a].filter(u=>{let l=i.shape[u]._zod;return e.io==="input"?l.optin===void 0:l.optout===void 0}));c.size>0&&(o.required=Array.from(c)),i.catchall?._zod.def.type==="never"?o.additionalProperties=!1:i.catchall?i.catchall&&(o.additionalProperties=Oe(i.catchall,e,{...n,path:[...n.path,"additionalProperties"]})):e.io==="output"&&(o.additionalProperties=!1)},Mm=(t,e,r,n)=>{let o=t._zod.def,i=o.inclusive===!1,s=o.options.map((a,c)=>Oe(a,e,{...n,path:[...n.path,i?"oneOf":"anyOf",c]}));i?r.oneOf=s:r.anyOf=s},K$=(t,e,r,n)=>{let o=t._zod.def,i=Oe(o.left,e,{...n,path:[...n.path,"allOf",0]}),s=Oe(o.right,e,{...n,path:[...n.path,"allOf",1]}),a=u=>"allOf"in u&&Object.keys(u).length===1,c=[...a(i)?i.allOf:[i],...a(s)?s.allOf:[s]];r.allOf=c},X$=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="array";let s=e.target==="draft-2020-12"?"prefixItems":"items",a=e.target==="draft-2020-12"||e.target==="openapi-3.0"?"items":"additionalItems",c=i.items.map((p,f)=>Oe(p,e,{...n,path:[...n.path,s,f]})),u=i.rest?Oe(i.rest,e,{...n,path:[...n.path,a,...e.target==="openapi-3.0"?[i.items.length]:[]]}):null;e.target==="draft-2020-12"?(o.prefixItems=c,u&&(o.items=u)):e.target==="openapi-3.0"?(o.items={anyOf:c},u&&o.items.anyOf.push(u),o.minItems=c.length,u||(o.maxItems=c.length)):(o.items=c,u&&(o.additionalItems=u));let{minimum:l,maximum:d}=t._zod.bag;typeof l=="number"&&(o.minItems=l),typeof d=="number"&&(o.maxItems=d)},Y$=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="object",(e.target==="draft-07"||e.target==="draft-2020-12")&&(o.propertyNames=Oe(i.keyType,e,{...n,path:[...n.path,"propertyNames"]})),o.additionalProperties=Oe(i.valueType,e,{...n,path:[...n.path,"additionalProperties"]})},Q$=(t,e,r,n)=>{let o=t._zod.def,i=Oe(o.innerType,e,n),s=e.seen.get(t);e.target==="openapi-3.0"?(s.ref=o.innerType,r.nullable=!0):r.anyOf=[i,{type:"null"}]},ew=(t,e,r,n)=>{let o=t._zod.def;Oe(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},tw=(t,e,r,n)=>{let o=t._zod.def;Oe(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,r.default=JSON.parse(JSON.stringify(o.defaultValue))},rw=(t,e,r,n)=>{let o=t._zod.def;Oe(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,e.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(o.defaultValue)))},nw=(t,e,r,n)=>{let o=t._zod.def;Oe(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType;let s;try{s=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=s},ow=(t,e,r,n)=>{let o=t._zod.def,i=e.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;Oe(i,e,n);let s=e.seen.get(t);s.ref=i},iw=(t,e,r,n)=>{let o=t._zod.def;Oe(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,r.readOnly=!0},sw=(t,e,r,n)=>{let o=t._zod.def;Oe(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},aw=(t,e,r,n)=>{let o=t._zod.def;Oe(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},cw=(t,e,r,n)=>{let o=t._zod.innerType;Oe(o,e,n);let i=e.seen.get(t);i.ref=o};function Jo(t){return!!t._zod}function cr(t,e){return Jo(t)?Fo(t,e):t.safeParse(e)}function ku(t){if(!t)return;let e;if(Jo(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function pw(t){if(Jo(t)){let i=t._zod?.def;if(i){if(i.value!==void 0)return i.value;if(Array.isArray(i.values)&&i.values.length>0)return i.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var Us={};An(Us,{ZodAny:()=>Tw,ZodArray:()=>Nw,ZodBase64:()=>ch,ZodBase64URL:()=>uh,ZodBigInt:()=>Bs,ZodBigIntFormat:()=>ph,ZodBoolean:()=>Fs,ZodCIDRv4:()=>sh,ZodCIDRv6:()=>ah,ZodCUID:()=>Qm,ZodCUID2:()=>eh,ZodCatch:()=>Yw,ZodCodec:()=>_h,ZodCustom:()=>Ru,ZodCustomStringFormat:()=>Zs,ZodDate:()=>Tu,ZodDefault:()=>Hw,ZodDiscriminatedUnion:()=>Aw,ZodE164:()=>lh,ZodEmail:()=>Jm,ZodEmoji:()=>Xm,ZodEnum:()=>qs,ZodFile:()=>Vw,ZodFunction:()=>ax,ZodGUID:()=>Pu,ZodIPv4:()=>oh,ZodIPv6:()=>ih,ZodIntersection:()=>Mw,ZodJWT:()=>dh,ZodKSUID:()=>nh,ZodLazy:()=>ox,ZodLiteral:()=>Zw,ZodMAC:()=>Pw,ZodMap:()=>qw,ZodNaN:()=>ex,ZodNanoID:()=>Ym,ZodNever:()=>Cw,ZodNonOptional:()=>vh,ZodNull:()=>zw,ZodNullable:()=>Bw,ZodNumber:()=>Vs,ZodNumberFormat:()=>Ko,ZodObject:()=>Ou,ZodOptional:()=>gh,ZodPipe:()=>yh,ZodPrefault:()=>Gw,ZodPromise:()=>sx,ZodReadonly:()=>tx,ZodRecord:()=>Nu,ZodSet:()=>Lw,ZodString:()=>Ls,ZodStringFormat:()=>Pe,ZodSuccess:()=>Xw,ZodSymbol:()=>Iw,ZodTemplateLiteral:()=>nx,ZodTransform:()=>Fw,ZodTuple:()=>Dw,ZodType:()=>K,ZodULID:()=>th,ZodURL:()=>zu,ZodUUID:()=>qr,ZodUndefined:()=>Ew,ZodUnion:()=>Cu,ZodUnknown:()=>Ow,ZodVoid:()=>jw,ZodXID:()=>rh,ZodXor:()=>Rw,_ZodString:()=>Gm,_default:()=>Ww,_function:()=>JO,any:()=>fh,array:()=>E,base64:()=>hO,base64url:()=>gO,bigint:()=>IO,boolean:()=>_e,catch:()=>Qw,check:()=>KO,cidrv4:()=>fO,cidrv6:()=>mO,codec:()=>HO,cuid:()=>iO,cuid2:()=>sO,custom:()=>bh,date:()=>jO,describe:()=>XO,discriminatedUnion:()=>ju,e164:()=>vO,email:()=>K1,emoji:()=>nO,enum:()=>it,file:()=>ZO,float32:()=>xO,float64:()=>kO,function:()=>JO,guid:()=>X1,hash:()=>wO,hex:()=>$O,hostname:()=>bO,httpUrl:()=>rO,instanceof:()=>QO,int:()=>Wm,int32:()=>SO,int64:()=>EO,intersection:()=>Ws,ipv4:()=>lO,ipv6:()=>pO,json:()=>tC,jwt:()=>yO,keyof:()=>NO,ksuid:()=>uO,lazy:()=>ix,literal:()=>N,looseObject:()=>Fe,looseRecord:()=>DO,mac:()=>dO,map:()=>UO,meta:()=>YO,nan:()=>BO,nanoid:()=>oO,nativeEnum:()=>LO,never:()=>mh,nonoptional:()=>Kw,null:()=>Hs,nullable:()=>Iu,nullish:()=>VO,number:()=>pe,object:()=>T,optional:()=>Ce,partialRecord:()=>MO,pipe:()=>Eu,prefault:()=>Jw,preprocess:()=>Au,promise:()=>GO,readonly:()=>rx,record:()=>Te,refine:()=>cx,set:()=>qO,strictObject:()=>RO,string:()=>y,stringFormat:()=>_O,stringbool:()=>eC,success:()=>FO,superRefine:()=>ux,symbol:()=>TO,templateLiteral:()=>WO,transform:()=>hh,tuple:()=>Uw,uint32:()=>PO,uint64:()=>zO,ulid:()=>aO,undefined:()=>OO,union:()=>we,unknown:()=>Ie,url:()=>Km,uuid:()=>Y1,uuidv4:()=>Q1,uuidv6:()=>eO,uuidv7:()=>tO,void:()=>CO,xid:()=>cO,xor:()=>AO});var Su={};An(Su,{endsWith:()=>Cs,gt:()=>Ur,gte:()=>ht,includes:()=>Ts,length:()=>Wo,lowercase:()=>Es,lt:()=>Dr,lte:()=>Ut,maxLength:()=>Ho,maxSize:()=>Bo,mime:()=>js,minLength:()=>pn,minSize:()=>Fn,multipleOf:()=>Vn,negative:()=>Pm,nonnegative:()=>Em,nonpositive:()=>Im,normalize:()=>Ns,overwrite:()=>xr,positive:()=>Sm,property:()=>zm,regex:()=>Is,size:()=>Ps,slugify:()=>bu,startsWith:()=>Os,toLowerCase:()=>As,toUpperCase:()=>Ms,trim:()=>Rs,uppercase:()=>zs});var Bn={};An(Bn,{ZodISODate:()=>Lm,ZodISODateTime:()=>Um,ZodISODuration:()=>Bm,ZodISOTime:()=>Vm,date:()=>Zm,datetime:()=>qm,duration:()=>Hm,time:()=>Fm});var Um=_("ZodISODateTime",(t,e)=>{Gp.init(t,e),Pe.init(t,e)});function qm(t){return Yf(Um,t)}var Lm=_("ZodISODate",(t,e)=>{Jp.init(t,e),Pe.init(t,e)});function Zm(t){return Qf(Lm,t)}var Vm=_("ZodISOTime",(t,e)=>{Kp.init(t,e),Pe.init(t,e)});function Fm(t){return em(Vm,t)}var Bm=_("ZodISODuration",(t,e)=>{Xp.init(t,e),Pe.init(t,e)});function Hm(t){return tm(Bm,t)}var fw=(t,e)=>{Lc.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>Vc(t,r)},flatten:{value:r=>Zc(t,r)},addIssue:{value:r=>{t.issues.push(r),t.message=JSON.stringify(t.issues,Lo,2)}},addIssues:{value:r=>{t.issues.push(...r),t.message=JSON.stringify(t.issues,Lo,2)}},isEmpty:{get(){return t.issues.length===0}}})},rG=_("ZodError",fw),qt=_("ZodError",fw,{Parent:Error});var mw=ds(qt),hw=fs(qt),gw=hs(qt),vw=gs(qt),yw=Ib(qt),_w=Eb(qt),bw=zb(qt),$w=Tb(qt),ww=Ob(qt),xw=Cb(qt),kw=jb(qt),Sw=Nb(qt);var K=_("ZodType",(t,e)=>(H.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:Ds(t,"input"),output:Ds(t,"output")}}),t.toJSONSchema=k$(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone(P.mergeDefs(e,{checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),t.clone=(r,n)=>mt(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t)),t.parse=(r,n)=>mw(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>gw(t,r,n),t.parseAsync=async(r,n)=>hw(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>vw(t,r,n),t.spa=t.safeParseAsync,t.encode=(r,n)=>yw(t,r,n),t.decode=(r,n)=>_w(t,r,n),t.encodeAsync=async(r,n)=>bw(t,r,n),t.decodeAsync=async(r,n)=>$w(t,r,n),t.safeEncode=(r,n)=>ww(t,r,n),t.safeDecode=(r,n)=>xw(t,r,n),t.safeEncodeAsync=async(r,n)=>kw(t,r,n),t.safeDecodeAsync=async(r,n)=>Sw(t,r,n),t.refine=(r,n)=>t.check(cx(r,n)),t.superRefine=r=>t.check(ux(r)),t.overwrite=r=>t.check(xr(r)),t.optional=()=>Ce(t),t.nullable=()=>Iu(t),t.nullish=()=>Ce(Iu(t)),t.nonoptional=r=>Kw(t,r),t.array=()=>E(t),t.or=r=>we([t,r]),t.and=r=>Ws(t,r),t.transform=r=>Eu(t,hh(r)),t.default=r=>Ww(t,r),t.prefault=r=>Jw(t,r),t.catch=r=>Qw(t,r),t.pipe=r=>Eu(t,r),t.readonly=()=>rx(t),t.describe=r=>{let n=t.clone();return kt.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return kt.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return kt.get(t);let n=t.clone();return kt.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),Gm=_("_ZodString",(t,e)=>{Zn.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>S$(t,n,o,i);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(Is(...n)),t.includes=(...n)=>t.check(Ts(...n)),t.startsWith=(...n)=>t.check(Os(...n)),t.endsWith=(...n)=>t.check(Cs(...n)),t.min=(...n)=>t.check(pn(...n)),t.max=(...n)=>t.check(Ho(...n)),t.length=(...n)=>t.check(Wo(...n)),t.nonempty=(...n)=>t.check(pn(1,...n)),t.lowercase=n=>t.check(Es(n)),t.uppercase=n=>t.check(zs(n)),t.trim=()=>t.check(Rs()),t.normalize=(...n)=>t.check(Ns(...n)),t.toLowerCase=()=>t.check(As()),t.toUpperCase=()=>t.check(Ms()),t.slugify=()=>t.check(bu())}),Ls=_("ZodString",(t,e)=>{Zn.init(t,e),Gm.init(t,e),t.email=r=>t.check(eu(Jm,r)),t.url=r=>t.check(Ss(zu,r)),t.jwt=r=>t.check(_u(dh,r)),t.emoji=r=>t.check(iu(Xm,r)),t.guid=r=>t.check(ks(Pu,r)),t.uuid=r=>t.check(tu(qr,r)),t.uuidv4=r=>t.check(ru(qr,r)),t.uuidv6=r=>t.check(nu(qr,r)),t.uuidv7=r=>t.check(ou(qr,r)),t.nanoid=r=>t.check(su(Ym,r)),t.guid=r=>t.check(ks(Pu,r)),t.cuid=r=>t.check(au(Qm,r)),t.cuid2=r=>t.check(cu(eh,r)),t.ulid=r=>t.check(uu(th,r)),t.base64=r=>t.check(gu(ch,r)),t.base64url=r=>t.check(vu(uh,r)),t.xid=r=>t.check(lu(rh,r)),t.ksuid=r=>t.check(du(nh,r)),t.ipv4=r=>t.check(pu(oh,r)),t.ipv6=r=>t.check(fu(ih,r)),t.cidrv4=r=>t.check(mu(sh,r)),t.cidrv6=r=>t.check(hu(ah,r)),t.e164=r=>t.check(yu(lh,r)),t.datetime=r=>t.check(qm(r)),t.date=r=>t.check(Zm(r)),t.time=r=>t.check(Fm(r)),t.duration=r=>t.check(Hm(r))});function y(t){return Jf(Ls,t)}var Pe=_("ZodStringFormat",(t,e)=>{$e.init(t,e),Gm.init(t,e)}),Jm=_("ZodEmail",(t,e)=>{Up.init(t,e),Pe.init(t,e)});function K1(t){return eu(Jm,t)}var Pu=_("ZodGUID",(t,e)=>{Mp.init(t,e),Pe.init(t,e)});function X1(t){return ks(Pu,t)}var qr=_("ZodUUID",(t,e)=>{Dp.init(t,e),Pe.init(t,e)});function Y1(t){return tu(qr,t)}function Q1(t){return ru(qr,t)}function eO(t){return nu(qr,t)}function tO(t){return ou(qr,t)}var zu=_("ZodURL",(t,e)=>{qp.init(t,e),Pe.init(t,e)});function Km(t){return Ss(zu,t)}function rO(t){return Ss(zu,{protocol:/^https?$/,hostname:Bt.domain,...P.normalizeParams(t)})}var Xm=_("ZodEmoji",(t,e)=>{Lp.init(t,e),Pe.init(t,e)});function nO(t){return iu(Xm,t)}var Ym=_("ZodNanoID",(t,e)=>{Zp.init(t,e),Pe.init(t,e)});function oO(t){return su(Ym,t)}var Qm=_("ZodCUID",(t,e)=>{Vp.init(t,e),Pe.init(t,e)});function iO(t){return au(Qm,t)}var eh=_("ZodCUID2",(t,e)=>{Fp.init(t,e),Pe.init(t,e)});function sO(t){return cu(eh,t)}var th=_("ZodULID",(t,e)=>{Bp.init(t,e),Pe.init(t,e)});function aO(t){return uu(th,t)}var rh=_("ZodXID",(t,e)=>{Hp.init(t,e),Pe.init(t,e)});function cO(t){return lu(rh,t)}var nh=_("ZodKSUID",(t,e)=>{Wp.init(t,e),Pe.init(t,e)});function uO(t){return du(nh,t)}var oh=_("ZodIPv4",(t,e)=>{Yp.init(t,e),Pe.init(t,e)});function lO(t){return pu(oh,t)}var Pw=_("ZodMAC",(t,e)=>{ef.init(t,e),Pe.init(t,e)});function dO(t){return Xf(Pw,t)}var ih=_("ZodIPv6",(t,e)=>{Qp.init(t,e),Pe.init(t,e)});function pO(t){return fu(ih,t)}var sh=_("ZodCIDRv4",(t,e)=>{tf.init(t,e),Pe.init(t,e)});function fO(t){return mu(sh,t)}var ah=_("ZodCIDRv6",(t,e)=>{rf.init(t,e),Pe.init(t,e)});function mO(t){return hu(ah,t)}var ch=_("ZodBase64",(t,e)=>{nf.init(t,e),Pe.init(t,e)});function hO(t){return gu(ch,t)}var uh=_("ZodBase64URL",(t,e)=>{of.init(t,e),Pe.init(t,e)});function gO(t){return vu(uh,t)}var lh=_("ZodE164",(t,e)=>{sf.init(t,e),Pe.init(t,e)});function vO(t){return yu(lh,t)}var dh=_("ZodJWT",(t,e)=>{af.init(t,e),Pe.init(t,e)});function yO(t){return _u(dh,t)}var Zs=_("ZodCustomStringFormat",(t,e)=>{cf.init(t,e),Pe.init(t,e)});function _O(t,e,r={}){return Go(Zs,t,e,r)}function bO(t){return Go(Zs,"hostname",Bt.hostname,t)}function $O(t){return Go(Zs,"hex",Bt.hex,t)}function wO(t,e){let r=e?.enc??"hex",n=`${t}_${r}`,o=Bt[n];if(!o)throw new Error(`Unrecognized hash format: ${n}`);return Go(Zs,n,o,e)}var Vs=_("ZodNumber",(t,e)=>{Xc.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>P$(t,n,o,i),t.gt=(n,o)=>t.check(Ur(n,o)),t.gte=(n,o)=>t.check(ht(n,o)),t.min=(n,o)=>t.check(ht(n,o)),t.lt=(n,o)=>t.check(Dr(n,o)),t.lte=(n,o)=>t.check(Ut(n,o)),t.max=(n,o)=>t.check(Ut(n,o)),t.int=n=>t.check(Wm(n)),t.safe=n=>t.check(Wm(n)),t.positive=n=>t.check(Ur(0,n)),t.nonnegative=n=>t.check(ht(0,n)),t.negative=n=>t.check(Dr(0,n)),t.nonpositive=n=>t.check(Ut(0,n)),t.multipleOf=(n,o)=>t.check(Vn(n,o)),t.step=(n,o)=>t.check(Vn(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function pe(t){return rm(Vs,t)}var Ko=_("ZodNumberFormat",(t,e)=>{uf.init(t,e),Vs.init(t,e)});function Wm(t){return om(Ko,t)}function xO(t){return im(Ko,t)}function kO(t){return sm(Ko,t)}function SO(t){return am(Ko,t)}function PO(t){return cm(Ko,t)}var Fs=_("ZodBoolean",(t,e)=>{$s.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>I$(t,r,n,o)});function _e(t){return um(Fs,t)}var Bs=_("ZodBigInt",(t,e)=>{Yc.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>E$(t,n,o,i),t.gte=(n,o)=>t.check(ht(n,o)),t.min=(n,o)=>t.check(ht(n,o)),t.gt=(n,o)=>t.check(Ur(n,o)),t.gte=(n,o)=>t.check(ht(n,o)),t.min=(n,o)=>t.check(ht(n,o)),t.lt=(n,o)=>t.check(Dr(n,o)),t.lte=(n,o)=>t.check(Ut(n,o)),t.max=(n,o)=>t.check(Ut(n,o)),t.positive=n=>t.check(Ur(BigInt(0),n)),t.negative=n=>t.check(Dr(BigInt(0),n)),t.nonpositive=n=>t.check(Ut(BigInt(0),n)),t.nonnegative=n=>t.check(ht(BigInt(0),n)),t.multipleOf=(n,o)=>t.check(Vn(n,o));let r=t._zod.bag;t.minValue=r.minimum??null,t.maxValue=r.maximum??null,t.format=r.format??null});function IO(t){return dm(Bs,t)}var ph=_("ZodBigIntFormat",(t,e)=>{lf.init(t,e),Bs.init(t,e)});function EO(t){return fm(ph,t)}function zO(t){return mm(ph,t)}var Iw=_("ZodSymbol",(t,e)=>{df.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>z$(t,r,n,o)});function TO(t){return hm(Iw,t)}var Ew=_("ZodUndefined",(t,e)=>{pf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>O$(t,r,n,o)});function OO(t){return gm(Ew,t)}var zw=_("ZodNull",(t,e)=>{ff.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>T$(t,r,n,o)});function Hs(t){return vm(zw,t)}var Tw=_("ZodAny",(t,e)=>{mf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>N$(t,r,n,o)});function fh(){return ym(Tw)}var Ow=_("ZodUnknown",(t,e)=>{hf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>R$(t,r,n,o)});function Ie(){return _m(Ow)}var Cw=_("ZodNever",(t,e)=>{gf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>j$(t,r,n,o)});function mh(t){return bm(Cw,t)}var jw=_("ZodVoid",(t,e)=>{vf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>C$(t,r,n,o)});function CO(t){return $m(jw,t)}var Tu=_("ZodDate",(t,e)=>{yf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>A$(t,n,o,i),t.min=(n,o)=>t.check(ht(n,o)),t.max=(n,o)=>t.check(Ut(n,o));let r=t._zod.bag;t.minDate=r.minimum?new Date(r.minimum):null,t.maxDate=r.maximum?new Date(r.maximum):null});function jO(t){return wm(Tu,t)}var Nw=_("ZodArray",(t,e)=>{_f.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>G$(t,r,n,o),t.element=e.element,t.min=(r,n)=>t.check(pn(r,n)),t.nonempty=r=>t.check(pn(1,r)),t.max=(r,n)=>t.check(Ho(r,n)),t.length=(r,n)=>t.check(Wo(r,n)),t.unwrap=()=>t.element});function E(t,e){return x$(Nw,t,e)}function NO(t){let e=t._zod.def.shape;return it(Object.keys(e))}var Ou=_("ZodObject",(t,e)=>{$$.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>J$(t,r,n,o),P.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>it(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Ie()}),t.loose=()=>t.clone({...t._zod.def,catchall:Ie()}),t.strict=()=>t.clone({...t._zod.def,catchall:mh()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>P.extend(t,r),t.safeExtend=r=>P.safeExtend(t,r),t.merge=r=>P.merge(t,r),t.pick=r=>P.pick(t,r),t.omit=r=>P.omit(t,r),t.partial=(...r)=>P.partial(gh,t,r[0]),t.required=(...r)=>P.required(vh,t,r[0])});function T(t,e){let r={type:"object",shape:t??{},...P.normalizeParams(e)};return new Ou(r)}function RO(t,e){return new Ou({type:"object",shape:t,catchall:mh(),...P.normalizeParams(e)})}function Fe(t,e){return new Ou({type:"object",shape:t,catchall:Ie(),...P.normalizeParams(e)})}var Cu=_("ZodUnion",(t,e)=>{ws.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Mm(t,r,n,o),t.options=e.options});function we(t,e){return new Cu({type:"union",options:t,...P.normalizeParams(e)})}var Rw=_("ZodXor",(t,e)=>{Cu.init(t,e),bf.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Mm(t,r,n,o),t.options=e.options});function AO(t,e){return new Rw({type:"union",options:t,inclusive:!1,...P.normalizeParams(e)})}var Aw=_("ZodDiscriminatedUnion",(t,e)=>{Cu.init(t,e),$f.init(t,e)});function ju(t,e,r){return new Aw({type:"union",options:e,discriminator:t,...P.normalizeParams(r)})}var Mw=_("ZodIntersection",(t,e)=>{wf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>K$(t,r,n,o)});function Ws(t,e){return new Mw({type:"intersection",left:t,right:e})}var Dw=_("ZodTuple",(t,e)=>{Qc.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>X$(t,r,n,o),t.rest=r=>t.clone({...t._zod.def,rest:r})});function Uw(t,e,r){let n=e instanceof H,o=n?r:e,i=n?e:null;return new Dw({type:"tuple",items:t,rest:i,...P.normalizeParams(o)})}var Nu=_("ZodRecord",(t,e)=>{xf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Y$(t,r,n,o),t.keyType=e.keyType,t.valueType=e.valueType});function Te(t,e,r){return new Nu({type:"record",keyType:t,valueType:e,...P.normalizeParams(r)})}function MO(t,e,r){let n=mt(t);return n._zod.values=void 0,new Nu({type:"record",keyType:n,valueType:e,...P.normalizeParams(r)})}function DO(t,e,r){return new Nu({type:"record",keyType:t,valueType:e,mode:"loose",...P.normalizeParams(r)})}var qw=_("ZodMap",(t,e)=>{kf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>H$(t,r,n,o),t.keyType=e.keyType,t.valueType=e.valueType});function UO(t,e,r){return new qw({type:"map",keyType:t,valueType:e,...P.normalizeParams(r)})}var Lw=_("ZodSet",(t,e)=>{Sf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>W$(t,r,n,o),t.min=(...r)=>t.check(Fn(...r)),t.nonempty=r=>t.check(Fn(1,r)),t.max=(...r)=>t.check(Bo(...r)),t.size=(...r)=>t.check(Ps(...r))});function qO(t,e){return new Lw({type:"set",valueType:t,...P.normalizeParams(e)})}var qs=_("ZodEnum",(t,e)=>{Pf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(n,o,i)=>M$(t,n,o,i),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let i={};for(let s of n)if(r.has(s))i[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new qs({...e,checks:[],...P.normalizeParams(o),entries:i})},t.exclude=(n,o)=>{let i={...e.entries};for(let s of n)if(r.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new qs({...e,checks:[],...P.normalizeParams(o),entries:i})}});function it(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new qs({type:"enum",entries:r,...P.normalizeParams(e)})}function LO(t,e){return new qs({type:"enum",entries:t,...P.normalizeParams(e)})}var Zw=_("ZodLiteral",(t,e)=>{If.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>D$(t,r,n,o),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function N(t,e){return new Zw({type:"literal",values:Array.isArray(t)?t:[t],...P.normalizeParams(e)})}var Vw=_("ZodFile",(t,e)=>{Ef.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>L$(t,r,n,o),t.min=(r,n)=>t.check(Fn(r,n)),t.max=(r,n)=>t.check(Bo(r,n)),t.mime=(r,n)=>t.check(js(Array.isArray(r)?r:[r],n))});function ZO(t){return Tm(Vw,t)}var Fw=_("ZodTransform",(t,e)=>{zf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>B$(t,r,n,o),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Un(t.constructor.name);r.addIssue=i=>{if(typeof i=="string")r.issues.push(P.issue(i,r.value,e));else{let s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),r.issues.push(P.issue(s))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(i=>(r.value=i,r)):(r.value=o,r)}});function hh(t){return new Fw({type:"transform",transform:t})}var gh=_("ZodOptional",(t,e)=>{Tf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>aw(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function Ce(t){return new gh({type:"optional",innerType:t})}var Bw=_("ZodNullable",(t,e)=>{Of.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Q$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function Iu(t){return new Bw({type:"nullable",innerType:t})}function VO(t){return Ce(Iu(t))}var Hw=_("ZodDefault",(t,e)=>{Cf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>tw(t,r,n,o),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Ww(t,e){return new Hw({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():P.shallowClone(e)}})}var Gw=_("ZodPrefault",(t,e)=>{jf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>rw(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function Jw(t,e){return new Gw({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():P.shallowClone(e)}})}var vh=_("ZodNonOptional",(t,e)=>{Nf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>ew(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function Kw(t,e){return new vh({type:"nonoptional",innerType:t,...P.normalizeParams(e)})}var Xw=_("ZodSuccess",(t,e)=>{Rf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Z$(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function FO(t){return new Xw({type:"success",innerType:t})}var Yw=_("ZodCatch",(t,e)=>{Af.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>nw(t,r,n,o),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function Qw(t,e){return new Yw({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var ex=_("ZodNaN",(t,e)=>{Mf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>U$(t,r,n,o)});function BO(t){return km(ex,t)}var yh=_("ZodPipe",(t,e)=>{Df.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>ow(t,r,n,o),t.in=e.in,t.out=e.out});function Eu(t,e){return new yh({type:"pipe",in:t,out:e})}var _h=_("ZodCodec",(t,e)=>{yh.init(t,e),xs.init(t,e)});function HO(t,e,r){return new _h({type:"pipe",in:t,out:e,transform:r.decode,reverseTransform:r.encode})}var tx=_("ZodReadonly",(t,e)=>{Uf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>iw(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function rx(t){return new tx({type:"readonly",innerType:t})}var nx=_("ZodTemplateLiteral",(t,e)=>{qf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>q$(t,r,n,o)});function WO(t,e){return new nx({type:"template_literal",parts:t,...P.normalizeParams(e)})}var ox=_("ZodLazy",(t,e)=>{Vf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>cw(t,r,n,o),t.unwrap=()=>t._zod.def.getter()});function ix(t){return new ox({type:"lazy",getter:t})}var sx=_("ZodPromise",(t,e)=>{Zf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>sw(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});function GO(t){return new sx({type:"promise",innerType:t})}var ax=_("ZodFunction",(t,e)=>{Lf.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>F$(t,r,n,o)});function JO(t){return new ax({type:"function",input:Array.isArray(t?.input)?Uw(t?.input):t?.input??E(Ie()),output:t?.output??Ie()})}var Ru=_("ZodCustom",(t,e)=>{Ff.init(t,e),K.init(t,e),t._zod.processJSONSchema=(r,n,o)=>V$(t,r,n,o)});function KO(t){let e=new Se({check:"custom"});return e._zod.check=t,e}function bh(t,e){return Om(Ru,t??(()=>!0),e)}function cx(t,e={}){return Cm(Ru,t,e)}function ux(t){return jm(t)}var XO=Nm,YO=Rm;function QO(t,e={error:`Input not instance of ${t.name}`}){let r=new Ru({type:"custom",check:"custom",fn:n=>n instanceof t,abort:!0,...P.normalizeParams(e)});return r._zod.bag.Class=t,r}var eC=(...t)=>Am({Codec:_h,Boolean:Fs,String:Ls},...t);function tC(t){let e=ix(()=>we([y(t),pe(),_e(),Hs(),E(e),Te(y(),e)]));return e}function Au(t,e){return Eu(hh(t),e)}var dx={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};var lx;lx||(lx={});var uG={...Us,...Su,iso:Bn};var Mu={};An(Mu,{bigint:()=>iC,boolean:()=>oC,date:()=>sC,number:()=>nC,string:()=>rC});function rC(t){return Kf(Ls,t)}function nC(t){return nm(Vs,t)}function oC(t){return lm(Fs,t)}function iC(t){return pm(Bs,t)}function sC(t){return xm(Tu,t)}Be(Bf());var Yo="2025-11-25";var fx=[Yo,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],fn="io.modelcontextprotocol/related-task",Uu="2.0",Je=bh(t=>t!==null&&(typeof t=="object"||typeof t=="function")),mx=we([y(),pe().int()]),hx=y(),EG=Fe({ttl:we([pe(),Hs()]).optional(),pollInterval:pe().optional()}),cC=T({ttl:pe().optional()}),uC=T({taskId:y()}),wh=Fe({progressToken:mx.optional(),[fn]:uC.optional()}),Lt=T({_meta:wh.optional()}),Gs=Lt.extend({task:cC.optional()}),gx=t=>Gs.safeParse(t).success,Ke=T({method:y(),params:Lt.loose().optional()}),Ht=T({_meta:wh.optional()}),Wt=T({method:y(),params:Ht.loose().optional()}),Xe=Fe({_meta:wh.optional()}),qu=we([y(),pe().int()]),vx=T({jsonrpc:N(Uu),id:qu,...Ke.shape}).strict(),xh=t=>vx.safeParse(t).success,yx=T({jsonrpc:N(Uu),...Wt.shape}).strict(),_x=t=>yx.safeParse(t).success,kh=T({jsonrpc:N(Uu),id:qu,result:Xe}).strict(),Js=t=>kh.safeParse(t).success;var V;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(V||(V={}));var Sh=T({jsonrpc:N(Uu),id:qu.optional(),error:T({code:pe().int(),message:y(),data:Ie().optional()})}).strict();var bx=t=>Sh.safeParse(t).success;var Lu=we([vx,yx,kh,Sh]),zG=we([kh,Sh]),Hn=Xe.strict(),lC=Ht.extend({requestId:qu.optional(),reason:y().optional()}),Zu=Wt.extend({method:N("notifications/cancelled"),params:lC}),dC=T({src:y(),mimeType:y().optional(),sizes:E(y()).optional(),theme:it(["light","dark"]).optional()}),Ks=T({icons:E(dC).optional()}),Xo=T({name:y(),title:y().optional()}),$x=Xo.extend({...Xo.shape,...Ks.shape,version:y(),websiteUrl:y().optional(),description:y().optional()}),pC=Ws(T({applyDefaults:_e().optional()}),Te(y(),Ie())),fC=Au(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,Ws(T({form:pC.optional(),url:Je.optional()}),Te(y(),Ie()).optional())),mC=Fe({list:Je.optional(),cancel:Je.optional(),requests:Fe({sampling:Fe({createMessage:Je.optional()}).optional(),elicitation:Fe({create:Je.optional()}).optional()}).optional()}),hC=Fe({list:Je.optional(),cancel:Je.optional(),requests:Fe({tools:Fe({call:Je.optional()}).optional()}).optional()}),gC=T({experimental:Te(y(),Je).optional(),sampling:T({context:Je.optional(),tools:Je.optional()}).optional(),elicitation:fC.optional(),roots:T({listChanged:_e().optional()}).optional(),tasks:mC.optional()}),vC=Lt.extend({protocolVersion:y(),capabilities:gC,clientInfo:$x}),yC=Ke.extend({method:N("initialize"),params:vC});var _C=T({experimental:Te(y(),Je).optional(),logging:Je.optional(),completions:Je.optional(),prompts:T({listChanged:_e().optional()}).optional(),resources:T({subscribe:_e().optional(),listChanged:_e().optional()}).optional(),tools:T({listChanged:_e().optional()}).optional(),tasks:hC.optional()}),Ph=Xe.extend({protocolVersion:y(),capabilities:_C,serverInfo:$x,instructions:y().optional()}),bC=Wt.extend({method:N("notifications/initialized"),params:Ht.optional()});var Vu=Ke.extend({method:N("ping"),params:Lt.optional()}),$C=T({progress:pe(),total:Ce(pe()),message:Ce(y())}),wC=T({...Ht.shape,...$C.shape,progressToken:mx}),Fu=Wt.extend({method:N("notifications/progress"),params:wC}),xC=Lt.extend({cursor:hx.optional()}),Xs=Ke.extend({params:xC.optional()}),Ys=Xe.extend({nextCursor:hx.optional()}),kC=it(["working","input_required","completed","failed","cancelled"]),Qs=T({taskId:y(),status:kC,ttl:we([pe(),Hs()]),createdAt:y(),lastUpdatedAt:y(),pollInterval:Ce(pe()),statusMessage:Ce(y())}),Wn=Xe.extend({task:Qs}),SC=Ht.merge(Qs),ea=Wt.extend({method:N("notifications/tasks/status"),params:SC}),Bu=Ke.extend({method:N("tasks/get"),params:Lt.extend({taskId:y()})}),Hu=Xe.merge(Qs),Wu=Ke.extend({method:N("tasks/result"),params:Lt.extend({taskId:y()})}),TG=Xe.loose(),Gu=Xs.extend({method:N("tasks/list")}),Ju=Ys.extend({tasks:E(Qs)}),Ku=Ke.extend({method:N("tasks/cancel"),params:Lt.extend({taskId:y()})}),wx=Xe.merge(Qs),xx=T({uri:y(),mimeType:Ce(y()),_meta:Te(y(),Ie()).optional()}),kx=xx.extend({text:y()}),Ih=y().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),Sx=xx.extend({blob:Ih}),ta=it(["user","assistant"]),Qo=T({audience:E(ta).optional(),priority:pe().min(0).max(1).optional(),lastModified:Bn.datetime({offset:!0}).optional()}),Px=T({...Xo.shape,...Ks.shape,uri:y(),description:Ce(y()),mimeType:Ce(y()),annotations:Qo.optional(),_meta:Ce(Fe({}))}),PC=T({...Xo.shape,...Ks.shape,uriTemplate:y(),description:Ce(y()),mimeType:Ce(y()),annotations:Qo.optional(),_meta:Ce(Fe({}))}),IC=Xs.extend({method:N("resources/list")}),Eh=Ys.extend({resources:E(Px)}),EC=Xs.extend({method:N("resources/templates/list")}),zh=Ys.extend({resourceTemplates:E(PC)}),Th=Lt.extend({uri:y()}),zC=Th,TC=Ke.extend({method:N("resources/read"),params:zC}),Oh=Xe.extend({contents:E(we([kx,Sx]))}),Ch=Wt.extend({method:N("notifications/resources/list_changed"),params:Ht.optional()}),OC=Th,CC=Ke.extend({method:N("resources/subscribe"),params:OC}),jC=Th,NC=Ke.extend({method:N("resources/unsubscribe"),params:jC}),RC=Ht.extend({uri:y()}),AC=Wt.extend({method:N("notifications/resources/updated"),params:RC}),MC=T({name:y(),description:Ce(y()),required:Ce(_e())}),DC=T({...Xo.shape,...Ks.shape,description:Ce(y()),arguments:Ce(E(MC)),_meta:Ce(Fe({}))}),UC=Xs.extend({method:N("prompts/list")}),jh=Ys.extend({prompts:E(DC)}),qC=Lt.extend({name:y(),arguments:Te(y(),y()).optional()}),LC=Ke.extend({method:N("prompts/get"),params:qC}),Nh=T({type:N("text"),text:y(),annotations:Qo.optional(),_meta:Te(y(),Ie()).optional()}),Rh=T({type:N("image"),data:Ih,mimeType:y(),annotations:Qo.optional(),_meta:Te(y(),Ie()).optional()}),Ah=T({type:N("audio"),data:Ih,mimeType:y(),annotations:Qo.optional(),_meta:Te(y(),Ie()).optional()}),ZC=T({type:N("tool_use"),name:y(),id:y(),input:Te(y(),Ie()),_meta:Te(y(),Ie()).optional()}),VC=T({type:N("resource"),resource:we([kx,Sx]),annotations:Qo.optional(),_meta:Te(y(),Ie()).optional()}),FC=Px.extend({type:N("resource_link")}),Mh=we([Nh,Rh,Ah,FC,VC]),BC=T({role:ta,content:Mh}),Dh=Xe.extend({description:y().optional(),messages:E(BC)}),Uh=Wt.extend({method:N("notifications/prompts/list_changed"),params:Ht.optional()}),HC=T({title:y().optional(),readOnlyHint:_e().optional(),destructiveHint:_e().optional(),idempotentHint:_e().optional(),openWorldHint:_e().optional()}),WC=T({taskSupport:it(["required","optional","forbidden"]).optional()}),Ix=T({...Xo.shape,...Ks.shape,description:y().optional(),inputSchema:T({type:N("object"),properties:Te(y(),Je).optional(),required:E(y()).optional()}).catchall(Ie()),outputSchema:T({type:N("object"),properties:Te(y(),Je).optional(),required:E(y()).optional()}).catchall(Ie()).optional(),annotations:HC.optional(),execution:WC.optional(),_meta:Te(y(),Ie()).optional()}),GC=Xs.extend({method:N("tools/list")}),ra=Ys.extend({tools:E(Ix)}),mn=Xe.extend({content:E(Mh).default([]),structuredContent:Te(y(),Ie()).optional(),isError:_e().optional()}),OG=mn.or(Xe.extend({toolResult:Ie()})),JC=Gs.extend({name:y(),arguments:Te(y(),Ie()).optional()}),KC=Ke.extend({method:N("tools/call"),params:JC}),qh=Wt.extend({method:N("notifications/tools/list_changed"),params:Ht.optional()}),Ex=T({autoRefresh:_e().default(!0),debounceMs:pe().int().nonnegative().default(300)}),zx=it(["debug","info","notice","warning","error","critical","alert","emergency"]),XC=Lt.extend({level:zx}),YC=Ke.extend({method:N("logging/setLevel"),params:XC}),QC=Ht.extend({level:zx,logger:y().optional(),data:Ie()}),ej=Wt.extend({method:N("notifications/message"),params:QC}),tj=T({name:y().optional()}),rj=T({hints:E(tj).optional(),costPriority:pe().min(0).max(1).optional(),speedPriority:pe().min(0).max(1).optional(),intelligencePriority:pe().min(0).max(1).optional()}),nj=T({mode:it(["auto","required","none"]).optional()}),oj=T({type:N("tool_result"),toolUseId:y().describe("The unique identifier for the corresponding tool call."),content:E(Mh).default([]),structuredContent:T({}).loose().optional(),isError:_e().optional(),_meta:Te(y(),Ie()).optional()}),ij=ju("type",[Nh,Rh,Ah]),Du=ju("type",[Nh,Rh,Ah,ZC,oj]),sj=T({role:ta,content:we([Du,E(Du)]),_meta:Te(y(),Ie()).optional()}),aj=Gs.extend({messages:E(sj),modelPreferences:rj.optional(),systemPrompt:y().optional(),includeContext:it(["none","thisServer","allServers"]).optional(),temperature:pe().optional(),maxTokens:pe().int(),stopSequences:E(y()).optional(),metadata:Je.optional(),tools:E(Ix).optional(),toolChoice:nj.optional()}),Lh=Ke.extend({method:N("sampling/createMessage"),params:aj}),Zh=Xe.extend({model:y(),stopReason:Ce(it(["endTurn","stopSequence","maxTokens"]).or(y())),role:ta,content:ij}),cj=Xe.extend({model:y(),stopReason:Ce(it(["endTurn","stopSequence","maxTokens","toolUse"]).or(y())),role:ta,content:we([Du,E(Du)])}),uj=T({type:N("boolean"),title:y().optional(),description:y().optional(),default:_e().optional()}),lj=T({type:N("string"),title:y().optional(),description:y().optional(),minLength:pe().optional(),maxLength:pe().optional(),format:it(["email","uri","date","date-time"]).optional(),default:y().optional()}),dj=T({type:it(["number","integer"]),title:y().optional(),description:y().optional(),minimum:pe().optional(),maximum:pe().optional(),default:pe().optional()}),pj=T({type:N("string"),title:y().optional(),description:y().optional(),enum:E(y()),default:y().optional()}),fj=T({type:N("string"),title:y().optional(),description:y().optional(),oneOf:E(T({const:y(),title:y()})),default:y().optional()}),mj=T({type:N("string"),title:y().optional(),description:y().optional(),enum:E(y()),enumNames:E(y()).optional(),default:y().optional()}),hj=we([pj,fj]),gj=T({type:N("array"),title:y().optional(),description:y().optional(),minItems:pe().optional(),maxItems:pe().optional(),items:T({type:N("string"),enum:E(y())}),default:E(y()).optional()}),vj=T({type:N("array"),title:y().optional(),description:y().optional(),minItems:pe().optional(),maxItems:pe().optional(),items:T({anyOf:E(T({const:y(),title:y()}))}),default:E(y()).optional()}),yj=we([gj,vj]),_j=we([mj,hj,yj]),bj=we([_j,uj,lj,dj]),$j=Gs.extend({mode:N("form").optional(),message:y(),requestedSchema:T({type:N("object"),properties:Te(y(),bj),required:E(y()).optional()})}),wj=Gs.extend({mode:N("url"),message:y(),elicitationId:y(),url:y().url()}),xj=we([$j,wj]),Vh=Ke.extend({method:N("elicitation/create"),params:xj}),kj=Ht.extend({elicitationId:y()}),Sj=Wt.extend({method:N("notifications/elicitation/complete"),params:kj}),Fh=Xe.extend({action:it(["accept","decline","cancel"]),content:Au(t=>t===null?void 0:t,Te(y(),we([y(),pe(),_e(),E(y())])).optional())}),Pj=T({type:N("ref/resource"),uri:y()});var Ij=T({type:N("ref/prompt"),name:y()}),Ej=Lt.extend({ref:we([Ij,Pj]),argument:T({name:y(),value:y()}),context:T({arguments:Te(y(),y()).optional()}).optional()}),zj=Ke.extend({method:N("completion/complete"),params:Ej});var Bh=Xe.extend({completion:Fe({values:E(y()).max(100),total:Ce(pe().int()),hasMore:Ce(_e())})}),Tj=T({uri:y().startsWith("file://"),name:y().optional(),_meta:Te(y(),Ie()).optional()}),Oj=Ke.extend({method:N("roots/list"),params:Lt.optional()}),Cj=Xe.extend({roots:E(Tj)}),jj=Wt.extend({method:N("notifications/roots/list_changed"),params:Ht.optional()}),CG=we([Vu,yC,zj,YC,LC,UC,IC,EC,TC,CC,NC,KC,GC,Bu,Wu,Gu,Ku]),jG=we([Zu,Fu,bC,jj,ea]),NG=we([Hn,Zh,cj,Fh,Cj,Hu,Ju,Wn]),RG=we([Vu,Lh,Vh,Oj,Bu,Wu,Gu,Ku]),AG=we([Zu,Fu,ej,AC,Ch,qh,Uh,ea,Sj]),MG=we([Hn,Ph,Bh,Dh,jh,Eh,zh,Oh,mn,ra,Hu,Ju,Wn]),M=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===V.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new $h(o.elicitations,r)}return new t(e,r,n)}},$h=class extends M{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(V.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}};function hn(t){return t==="completed"||t==="failed"||t==="cancelled"}var v3=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Hh(t){let r=ku(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=pw(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function Wh(t,e){let r=cr(t,e);if(!r.success)throw r.error;return r.data}var Uj=6e4,Xu=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(Zu,r=>{this._oncancel(r)}),this.setNotificationHandler(Fu,r=>{this._onprogress(r)}),this.setRequestHandler(Vu,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(Bu,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new M(V.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(Wu,async(r,n)=>{let o=async()=>{let i=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(i,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{let d=c,p=new M(d.error.code,d.error.message,d.error.data);l(p)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let s=await this._taskStore.getTask(i,n.sessionId);if(!s)throw new M(V.InvalidParams,`Task not found: ${i}`);if(!hn(s.status))return await this._waitForTaskUpdate(i,n.signal),await o();if(hn(s.status)){let a=await this._taskStore.getTaskResult(i,n.sessionId);return this._clearTaskQueue(i),{...a,_meta:{...a._meta,[fn]:{taskId:i}}}}return await o()};return await o()}),this.setRequestHandler(Gu,async(r,n)=>{try{let{tasks:o,nextCursor:i}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:i,_meta:{}}}catch(o){throw new M(V.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(Ku,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new M(V.InvalidParams,`Task not found: ${r.params.taskId}`);if(hn(o.status))throw new M(V.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let i=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!i)throw new M(V.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...i}}catch(o){throw o instanceof M?o:new M(V.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,i=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:i,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),M.fromError(V.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=i=>{n?.(i),this._onerror(i)};let o=this._transport?.onmessage;this._transport.onmessage=(i,s)=>{o?.(i,s),Js(i)||bx(i)?this._onresponse(i):xh(i)?this._onrequest(i,s):_x(i)?this._onnotification(i):this._onerror(new Error(`Unknown message type: ${JSON.stringify(i)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let r=M.fromError(V.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,i=e.params?._meta?.[fn]?.taskId;if(n===void 0){let l={jsonrpc:"2.0",id:e.id,error:{code:V.MethodNotFound,message:"Method not found"}};i&&this._taskMessageQueue?this._enqueueTaskMessage(i,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(l).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let s=new AbortController;this._requestHandlerAbortControllers.set(e.id,s);let a=gx(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,u={signal:s.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async l=>{let d={relatedRequestId:e.id};i&&(d.relatedTask={taskId:i}),await this.notification(l,d)},sendRequest:async(l,d,p)=>{let f={...p,relatedRequestId:e.id};i&&!f.relatedTask&&(f.relatedTask={taskId:i});let h=f.relatedTask?.taskId??i;return h&&c&&await c.updateTaskStatus(h,"input_required"),await this.request(l,d,f)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:i,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,u)).then(async l=>{if(s.signal.aborted)return;let d={result:l,jsonrpc:"2.0",id:e.id};i&&this._taskMessageQueue?await this._enqueueTaskMessage(i,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async l=>{if(s.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:V.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};i&&this._taskMessageQueue?await this._enqueueTaskMessage(i,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),i=this._progressHandlers.get(o);if(!i){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let s=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&s&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),s(c);return}i(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),Js(e))n(e);else{let s=new M(e.error.code,e.error.message,e.error.data);n(s)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let i=!1;if(Js(e)&&e.result&&typeof e.result=="object"){let s=e.result;if(s.task&&typeof s.task=="object"){let a=s.task;typeof a.taskId=="string"&&(i=!0,this._taskProgressTokens.set(a.taskId,r))}}if(i||this._progressHandlers.delete(r),Js(e))o(e);else{let s=M.fromError(e.error.code,e.error.message,e.error.data);o(s)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(s){yield{type:"error",error:s instanceof M?s:new M(V.InternalError,String(s))}}return}let i;try{let s=await this.request(e,Wn,n);if(s.task)i=s.task.taskId,yield{type:"taskCreated",task:s.task};else throw new M(V.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:i},n);if(yield{type:"taskStatus",task:a},hn(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:i},r,n)}:a.status==="failed"?yield{type:"error",error:new M(V.InternalError,`Task ${i} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new M(V.InternalError,`Task ${i} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:i},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(s){yield{type:"error",error:s instanceof M?s:new M(V.InternalError,String(s))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{let d=$=>{l($)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch($){d($);return}n?.signal?.throwIfAborted();let p=this._requestMessageId++,f={...e,jsonrpc:"2.0",id:p};n?.onprogress&&(this._progressHandlers.set(p,n.onprogress),f.params={...e.params,_meta:{...e.params?._meta||{},progressToken:p}}),a&&(f.params={...f.params,task:a}),c&&(f.params={...f.params,_meta:{...f.params?._meta||{},[fn]:c}});let h=$=>{this._responseHandlers.delete(p),this._progressHandlers.delete(p),this._cleanupTimeout(p),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:p,reason:String($)}},{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s}).catch(I=>this._onerror(new Error(`Failed to send cancellation: ${I}`)));let x=$ instanceof M?$:new M(V.RequestTimeout,String($));l(x)};this._responseHandlers.set(p,$=>{if(!n?.signal?.aborted){if($ instanceof Error)return l($);try{let x=cr(r,$.result);x.success?u(x.data):l(x.error)}catch(x){l(x)}}}),n?.signal?.addEventListener("abort",()=>{h(n?.signal?.reason)});let m=n?.timeout??Uj,g=()=>h(M.fromError(V.RequestTimeout,"Request timed out",{timeout:m}));this._setupTimeout(p,m,n?.maxTotalTimeout,g,n?.resetTimeoutOnProgress??!1);let v=c?.taskId;if(v){let $=x=>{let I=this._responseHandlers.get(p);I?I(x):this._onerror(new Error(`Response handler missing for side-channeled request ${p}`))};this._requestResolvers.set(p,$),this._enqueueTaskMessage(v,{type:"request",message:f,timestamp:Date.now()}).catch(x=>{this._cleanupTimeout(p),l(x)})}else this._transport.send(f,{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s}).catch($=>{this._cleanupTimeout(p),l($)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},Hu,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},Ju,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},wx,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[fn]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[fn]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let s={...e,jsonrpc:"2.0"};r?.relatedTask&&(s={...s,params:{...s.params,_meta:{...s.params?._meta||{},[fn]:r.relatedTask}}}),await this._transport.send(s,r)}setRequestHandler(e,r){let n=Hh(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,i)=>{let s=Wh(e,o);return Promise.resolve(r(s,i))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=Hh(e);this._notificationHandlers.set(n,o=>{let i=Wh(e,o);return Promise.resolve(r(i))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&xh(o.message)){let i=o.message.id,s=this._requestResolvers.get(i);s?(s(new M(V.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(i)):this._onerror(new Error(`Resolver missing for request ${i} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,i)=>{if(r.aborted){i(new M(V.InvalidRequest,"Request cancelled"));return}let s=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(s),i(new M(V.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let i=await n.getTask(o,r);if(!i)throw new M(V.InvalidParams,"Failed to retrieve task: Task not found");return i},storeTaskResult:async(o,i,s)=>{await n.storeTaskResult(o,i,s,r);let a=await n.getTask(o,r);if(a){let c=ea.parse({method:"notifications/tasks/status",params:a});await this.notification(c),hn(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,i,s)=>{let a=await n.getTask(o,r);if(!a)throw new M(V.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(hn(a.status))throw new M(V.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${i}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,i,s,r);let c=await n.getTask(o,r);if(c){let u=ea.parse({method:"notifications/tasks/status",params:c});await this.notification(u),hn(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}};function Tx(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Ox(t,e){let r={...t};for(let n in e){let o=n,i=e[o];if(i===void 0)continue;let s=r[o];Tx(s)&&Tx(i)?r[o]={...s,...i}:r[o]=i}return r}var OI=qe(nS(),1),CI=qe(TI(),1);function x2(){let t=new OI.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,CI.default)(t),t}var dd=class{constructor(e){this._ajv=e??x2()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}};var pd=class{constructor(e){this._client=e}async*callToolStream(e,r=mn,n){let o=this._client,i={...n,task:n?.task??(o.isToolTask(e.name)?{}:void 0)},s=o.requestStream({method:"tools/call",params:e},r,i),a=o.getToolOutputValidator(e.name);for await(let c of s){if(c.type==="result"&&a){let u=c.result;if(!u.structuredContent&&!u.isError){yield{type:"error",error:new M(V.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`)};return}if(u.structuredContent)try{let l=a(u.structuredContent);if(!l.valid){yield{type:"error",error:new M(V.InvalidParams,`Structured content does not match the tool's output schema: ${l.errorMessage}`)};return}}catch(l){if(l instanceof M){yield{type:"error",error:l};return}yield{type:"error",error:new M(V.InvalidParams,`Failed to validate structured content: ${l instanceof Error?l.message:String(l)}`)};return}}yield c}}async getTask(e,r){return this._client.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._client.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._client.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._client.cancelTask({taskId:e},r)}requestStream(e,r,n){return this._client.requestStream(e,r,n)}};function jI(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function NI(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}function fd(t,e){if(!(!t||e===null||typeof e!="object")){if(t.type==="object"&&t.properties&&typeof t.properties=="object"){let r=e,n=t.properties;for(let o of Object.keys(n)){let i=n[o];r[o]===void 0&&Object.prototype.hasOwnProperty.call(i,"default")&&(r[o]=i.default),r[o]!==void 0&&fd(i,r[o])}}if(Array.isArray(t.anyOf))for(let r of t.anyOf)typeof r!="boolean"&&fd(r,e);if(Array.isArray(t.oneOf))for(let r of t.oneOf)typeof r!="boolean"&&fd(r,e)}}function k2(t){if(!t)return{supportsFormMode:!1,supportsUrlMode:!1};let e=t.form!==void 0,r=t.url!==void 0;return{supportsFormMode:e||!e&&!r,supportsUrlMode:r}}var md=class extends Xu{constructor(e,r){super(r),this._clientInfo=e,this._cachedToolOutputValidators=new Map,this._cachedKnownTaskTools=new Set,this._cachedRequiredTaskTools=new Set,this._listChangedDebounceTimers=new Map,this._capabilities=r?.capabilities??{},this._jsonSchemaValidator=r?.jsonSchemaValidator??new dd,r?.listChanged&&(this._pendingListChangedConfig=r.listChanged)}_setupListChangedHandlers(e){e.tools&&this._serverCapabilities?.tools?.listChanged&&this._setupListChangedHandler("tools",qh,e.tools,async()=>(await this.listTools()).tools),e.prompts&&this._serverCapabilities?.prompts?.listChanged&&this._setupListChangedHandler("prompts",Uh,e.prompts,async()=>(await this.listPrompts()).prompts),e.resources&&this._serverCapabilities?.resources?.listChanged&&this._setupListChangedHandler("resources",Ch,e.resources,async()=>(await this.listResources()).resources)}get experimental(){return this._experimental||(this._experimental={tasks:new pd(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=Ox(this._capabilities,e)}setRequestHandler(e,r){let o=ku(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let i;if(Jo(o)){let a=o;i=a._zod?.def?.value??a.value}else{let a=o;i=a._def?.value??a.value}if(typeof i!="string")throw new Error("Schema method literal must be a string");let s=i;if(s==="elicitation/create"){let a=async(c,u)=>{let l=cr(Vh,c);if(!l.success){let $=l.error instanceof Error?l.error.message:String(l.error);throw new M(V.InvalidParams,`Invalid elicitation request: ${$}`)}let{params:d}=l.data;d.mode=d.mode??"form";let{supportsFormMode:p,supportsUrlMode:f}=k2(this._capabilities.elicitation);if(d.mode==="form"&&!p)throw new M(V.InvalidParams,"Client does not support form-mode elicitation requests");if(d.mode==="url"&&!f)throw new M(V.InvalidParams,"Client does not support URL-mode elicitation requests");let h=await Promise.resolve(r(c,u));if(d.task){let $=cr(Wn,h);if(!$.success){let x=$.error instanceof Error?$.error.message:String($.error);throw new M(V.InvalidParams,`Invalid task creation result: ${x}`)}return $.data}let m=cr(Fh,h);if(!m.success){let $=m.error instanceof Error?m.error.message:String(m.error);throw new M(V.InvalidParams,`Invalid elicitation result: ${$}`)}let g=m.data,v=d.mode==="form"?d.requestedSchema:void 0;if(d.mode==="form"&&g.action==="accept"&&g.content&&v&&this._capabilities.elicitation?.form?.applyDefaults)try{fd(v,g.content)}catch{}return g};return super.setRequestHandler(e,a)}if(s==="sampling/createMessage"){let a=async(c,u)=>{let l=cr(Lh,c);if(!l.success){let h=l.error instanceof Error?l.error.message:String(l.error);throw new M(V.InvalidParams,`Invalid sampling request: ${h}`)}let{params:d}=l.data,p=await Promise.resolve(r(c,u));if(d.task){let h=cr(Wn,p);if(!h.success){let m=h.error instanceof Error?h.error.message:String(h.error);throw new M(V.InvalidParams,`Invalid task creation result: ${m}`)}return h.data}let f=cr(Zh,p);if(!f.success){let h=f.error instanceof Error?f.error.message:String(f.error);throw new M(V.InvalidParams,`Invalid sampling result: ${h}`)}return f.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapability(e,r){if(!this._serverCapabilities?.[e])throw new Error(`Server does not support ${e} (required for ${r})`)}async connect(e,r){if(await super.connect(e),e.sessionId===void 0)try{let n=await this.request({method:"initialize",params:{protocolVersion:Yo,capabilities:this._capabilities,clientInfo:this._clientInfo}},Ph,r);if(n===void 0)throw new Error(`Server sent invalid initialize result: ${n}`);if(!fx.includes(n.protocolVersion))throw new Error(`Server's protocol version is not supported: ${n.protocolVersion}`);this._serverCapabilities=n.capabilities,this._serverVersion=n.serverInfo,e.setProtocolVersion&&e.setProtocolVersion(n.protocolVersion),this._instructions=n.instructions,await this.notification({method:"notifications/initialized"}),this._pendingListChangedConfig&&(this._setupListChangedHandlers(this._pendingListChangedConfig),this._pendingListChangedConfig=void 0)}catch(n){throw this.close(),n}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){switch(e){case"logging/setLevel":if(!this._serverCapabilities?.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._serverCapabilities?.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!this._serverCapabilities?.resources)throw new Error(`Server does not support resources (required for ${e})`);if(e==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._serverCapabilities?.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!this._serverCapabilities?.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"initialize":break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/roots/list_changed":if(!this._capabilities.roots?.listChanged)throw new Error(`Client does not support roots list changed notifications (required for ${e})`);break;case"notifications/initialized":break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Client does not support tasks capability (required for ${e})`);break;case"ping":break}}assertTaskCapability(e){jI(this._serverCapabilities?.tasks?.requests,e,"Server")}assertTaskHandlerCapability(e){this._capabilities&&NI(this._capabilities.tasks?.requests,e,"Client")}async ping(e){return this.request({method:"ping"},Hn,e)}async complete(e,r){return this.request({method:"completion/complete",params:e},Bh,r)}async setLoggingLevel(e,r){return this.request({method:"logging/setLevel",params:{level:e}},Hn,r)}async getPrompt(e,r){return this.request({method:"prompts/get",params:e},Dh,r)}async listPrompts(e,r){return this.request({method:"prompts/list",params:e},jh,r)}async listResources(e,r){return this.request({method:"resources/list",params:e},Eh,r)}async listResourceTemplates(e,r){return this.request({method:"resources/templates/list",params:e},zh,r)}async readResource(e,r){return this.request({method:"resources/read",params:e},Oh,r)}async subscribeResource(e,r){return this.request({method:"resources/subscribe",params:e},Hn,r)}async unsubscribeResource(e,r){return this.request({method:"resources/unsubscribe",params:e},Hn,r)}async callTool(e,r=mn,n){if(this.isToolTaskRequired(e.name))throw new M(V.InvalidRequest,`Tool "${e.name}" requires task-based execution. Use client.experimental.tasks.callToolStream() instead.`);let o=await this.request({method:"tools/call",params:e},r,n),i=this.getToolOutputValidator(e.name);if(i){if(!o.structuredContent&&!o.isError)throw new M(V.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`);if(o.structuredContent)try{let s=i(o.structuredContent);if(!s.valid)throw new M(V.InvalidParams,`Structured content does not match the tool's output schema: ${s.errorMessage}`)}catch(s){throw s instanceof M?s:new M(V.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return o}isToolTask(e){return this._serverCapabilities?.tasks?.requests?.tools?.call?this._cachedKnownTaskTools.has(e):!1}isToolTaskRequired(e){return this._cachedRequiredTaskTools.has(e)}cacheToolMetadata(e){this._cachedToolOutputValidators.clear(),this._cachedKnownTaskTools.clear(),this._cachedRequiredTaskTools.clear();for(let r of e){if(r.outputSchema){let o=this._jsonSchemaValidator.getValidator(r.outputSchema);this._cachedToolOutputValidators.set(r.name,o)}let n=r.execution?.taskSupport;(n==="required"||n==="optional")&&this._cachedKnownTaskTools.add(r.name),n==="required"&&this._cachedRequiredTaskTools.add(r.name)}}getToolOutputValidator(e){return this._cachedToolOutputValidators.get(e)}async listTools(e,r){let n=await this.request({method:"tools/list",params:e},ra,r);return this.cacheToolMetadata(n.tools),n}_setupListChangedHandler(e,r,n,o){let i=Ex.safeParse(n);if(!i.success)throw new Error(`Invalid ${e} listChanged options: ${i.error.message}`);if(typeof n.onChanged!="function")throw new Error(`Invalid ${e} listChanged options: onChanged must be a function`);let{autoRefresh:s,debounceMs:a}=i.data,{onChanged:c}=n,u=async()=>{if(!s){c(null,null);return}try{let d=await o();c(null,d)}catch(d){let p=d instanceof Error?d:new Error(String(d));c(p,null)}},l=()=>{if(a){let d=this._listChangedDebounceTimers.get(e);d&&clearTimeout(d);let p=setTimeout(u,a);this._listChangedDebounceTimers.set(e,p)}else u()};this.setNotificationHandler(r,l)}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}};var kE=qe(wE(),1),ac=qe(require("node:process"),1),SE=require("node:stream");var gd=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),X2(r)}clear(){this._buffer=void 0}};function X2(t){return Lu.parse(JSON.parse(t))}function xE(t){return JSON.stringify(t)+`
`}var Y2=ac.default.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function Q2(){let t={};for(let e of Y2){let r=ac.default.env[e];r!==void 0&&(r.startsWith("()")||(t[e]=r))}return t}var vd=class{constructor(e){this._readBuffer=new gd,this._stderrStream=null,this._serverParams=e,(e.stderr==="pipe"||e.stderr==="overlapped")&&(this._stderrStream=new SE.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,r)=>{this._process=(0,kE.default)(this._serverParams.command,this._serverParams.args??[],{env:{...Q2(),...this._serverParams.env},stdio:["pipe","pipe",this._serverParams.stderr??"inherit"],shell:!1,windowsHide:ac.default.platform==="win32"&&eZ(),cwd:this._serverParams.cwd}),this._process.on("error",n=>{r(n),this.onerror?.(n)}),this._process.on("spawn",()=>{e()}),this._process.on("close",n=>{this._process=void 0,this.onclose?.()}),this._process.stdin?.on("error",n=>{this.onerror?.(n)}),this._process.stdout?.on("data",n=>{this._readBuffer.append(n),this.processReadBuffer()}),this._process.stdout?.on("error",n=>{this.onerror?.(n)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){return this._stderrStream?this._stderrStream:this._process?.stderr??null}get pid(){return this._process?.pid??null}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){if(this._process){let e=this._process;this._process=void 0;let r=new Promise(n=>{e.once("close",()=>{n()})});try{e.stdin?.end()}catch{}if(await Promise.race([r,new Promise(n=>setTimeout(n,2e3).unref())]),e.exitCode===null){try{e.kill("SIGTERM")}catch{}await Promise.race([r,new Promise(n=>setTimeout(n,2e3).unref())])}if(e.exitCode===null)try{e.kill("SIGKILL")}catch{}}this._readBuffer.clear()}send(e){return new Promise(r=>{if(!this._process?.stdin)throw new Error("Not connected");let n=xE(e);this._process.stdin.write(n)?r():this._process.stdin.once("drain",r)})}};function eZ(){return"type"in ac.default}var yd=class extends Error{constructor(e,r){super(e),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}};function P_(t){}function PE(t){if(typeof t=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=P_,onError:r=P_,onRetry:n=P_,onComment:o}=t,i="",s=!0,a,c="",u="";function l(m){let g=s?m.replace(/^\xEF\xBB\xBF/,""):m,[v,$]=tZ(`${i}${g}`);for(let x of v)d(x);i=$,s=!1}function d(m){if(m===""){f();return}if(m.startsWith(":")){o&&o(m.slice(m.startsWith(": ")?2:1));return}let g=m.indexOf(":");if(g!==-1){let v=m.slice(0,g),$=m[g+1]===" "?2:1,x=m.slice(g+$);p(v,x,m);return}p(m,"",m)}function p(m,g,v){switch(m){case"event":u=g;break;case"data":c=`${c}${g}
`;break;case"id":a=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?n(parseInt(g,10)):r(new yd(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:v}));break;default:r(new yd(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:g,line:v}));break}}function f(){c.length>0&&e({id:a,event:u||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),a=void 0,c="",u=""}function h(m={}){i&&m.consume&&d(i),s=!0,a=void 0,c="",u="",i=""}return{feed:l,reset:h}}function tZ(t){let e=[],r="",n=0;for(;n<t.length;){let o=t.indexOf("\r",n),i=t.indexOf(`
`,n),s=-1;if(o!==-1&&i!==-1?s=Math.min(o,i):o!==-1?o===t.length-1?s=-1:s=o:i!==-1&&(s=i),s===-1){r=t.slice(n);break}else{let a=t.slice(n,s);e.push(a),n=s+1,t[n-1]==="\r"&&t[n]===`
`&&n++}}return[e,r]}var bd=class extends Event{constructor(e,r){var n,o;super(e),this.code=(n=r?.code)!=null?n:void 0,this.message=(o=r?.message)!=null?o:void 0}[Symbol.for("nodejs.util.inspect.custom")](e,r,n){return n(IE(this),r)}[Symbol.for("Deno.customInspect")](e,r){return e(IE(this),r)}};function rZ(t){let e=globalThis.DOMException;return typeof e=="function"?new e(t,"SyntaxError"):new SyntaxError(t)}function I_(t){return t instanceof Error?"errors"in t&&Array.isArray(t.errors)?t.errors.map(I_).join(", "):"cause"in t&&t.cause instanceof Error?`${t}: ${I_(t.cause)}`:t.message:`${t}`}function IE(t){return{type:t.type,message:t.message,code:t.code,defaultPrevented:t.defaultPrevented,cancelable:t.cancelable,timeStamp:t.timeStamp}}var zE=t=>{throw TypeError(t)},R_=(t,e,r)=>e.has(t)||zE("Cannot "+r),ce=(t,e,r)=>(R_(t,e,"read from private field"),r?r.call(t):e.get(t)),He=(t,e,r)=>e.has(t)?zE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Me=(t,e,r,n)=>(R_(t,e,"write to private field"),e.set(t,r),r),Xr=(t,e,r)=>(R_(t,e,"access private method"),r),jt,ho,Ci,_d,$d,lc,Ri,dc,On,ji,Ai,Ni,cc,yr,E_,z_,T_,EE,O_,C_,uc,j_,N_,go=class extends EventTarget{constructor(e,r){var n,o;super(),He(this,yr),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,He(this,jt),He(this,ho),He(this,Ci),He(this,_d),He(this,$d),He(this,lc),He(this,Ri),He(this,dc,null),He(this,On),He(this,ji),He(this,Ai,null),He(this,Ni,null),He(this,cc,null),He(this,z_,async i=>{var s;ce(this,ji).reset();let{body:a,redirected:c,status:u,headers:l}=i;if(u===204){Xr(this,yr,uc).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(c?Me(this,Ci,new URL(i.url)):Me(this,Ci,void 0),u!==200){Xr(this,yr,uc).call(this,`Non-200 status code (${u})`,u);return}if(!(l.get("content-type")||"").startsWith("text/event-stream")){Xr(this,yr,uc).call(this,'Invalid content type, expected "text/event-stream"',u);return}if(ce(this,jt)===this.CLOSED)return;Me(this,jt,this.OPEN);let d=new Event("open");if((s=ce(this,cc))==null||s.call(this,d),this.dispatchEvent(d),typeof a!="object"||!a||!("getReader"in a)){Xr(this,yr,uc).call(this,"Invalid response body, expected a web ReadableStream",u),this.close();return}let p=new TextDecoder,f=a.getReader(),h=!0;do{let{done:m,value:g}=await f.read();g&&ce(this,ji).feed(p.decode(g,{stream:!m})),m&&(h=!1,ce(this,ji).reset(),Xr(this,yr,j_).call(this))}while(h)}),He(this,T_,i=>{Me(this,On,void 0),!(i.name==="AbortError"||i.type==="aborted")&&Xr(this,yr,j_).call(this,I_(i))}),He(this,O_,i=>{typeof i.id=="string"&&Me(this,dc,i.id);let s=new MessageEvent(i.event||"message",{data:i.data,origin:ce(this,Ci)?ce(this,Ci).origin:ce(this,ho).origin,lastEventId:i.id||""});ce(this,Ni)&&(!i.event||i.event==="message")&&ce(this,Ni).call(this,s),this.dispatchEvent(s)}),He(this,C_,i=>{Me(this,lc,i)}),He(this,N_,()=>{Me(this,Ri,void 0),ce(this,jt)===this.CONNECTING&&Xr(this,yr,E_).call(this)});try{if(e instanceof URL)Me(this,ho,e);else if(typeof e=="string")Me(this,ho,new URL(e,nZ()));else throw new Error("Invalid URL")}catch{throw rZ("An invalid or illegal string was specified")}Me(this,ji,PE({onEvent:ce(this,O_),onRetry:ce(this,C_)})),Me(this,jt,this.CONNECTING),Me(this,lc,3e3),Me(this,$d,(n=r?.fetch)!=null?n:globalThis.fetch),Me(this,_d,(o=r?.withCredentials)!=null?o:!1),Xr(this,yr,E_).call(this)}get readyState(){return ce(this,jt)}get url(){return ce(this,ho).href}get withCredentials(){return ce(this,_d)}get onerror(){return ce(this,Ai)}set onerror(e){Me(this,Ai,e)}get onmessage(){return ce(this,Ni)}set onmessage(e){Me(this,Ni,e)}get onopen(){return ce(this,cc)}set onopen(e){Me(this,cc,e)}addEventListener(e,r,n){let o=r;super.addEventListener(e,o,n)}removeEventListener(e,r,n){let o=r;super.removeEventListener(e,o,n)}close(){ce(this,Ri)&&clearTimeout(ce(this,Ri)),ce(this,jt)!==this.CLOSED&&(ce(this,On)&&ce(this,On).abort(),Me(this,jt,this.CLOSED),Me(this,On,void 0))}};jt=new WeakMap,ho=new WeakMap,Ci=new WeakMap,_d=new WeakMap,$d=new WeakMap,lc=new WeakMap,Ri=new WeakMap,dc=new WeakMap,On=new WeakMap,ji=new WeakMap,Ai=new WeakMap,Ni=new WeakMap,cc=new WeakMap,yr=new WeakSet,E_=function(){Me(this,jt,this.CONNECTING),Me(this,On,new AbortController),ce(this,$d)(ce(this,ho),Xr(this,yr,EE).call(this)).then(ce(this,z_)).catch(ce(this,T_))},z_=new WeakMap,T_=new WeakMap,EE=function(){var t;let e={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...ce(this,dc)?{"Last-Event-ID":ce(this,dc)}:void 0},cache:"no-store",signal:(t=ce(this,On))==null?void 0:t.signal};return"window"in globalThis&&(e.credentials=this.withCredentials?"include":"same-origin"),e},O_=new WeakMap,C_=new WeakMap,uc=function(t,e){var r;ce(this,jt)!==this.CLOSED&&Me(this,jt,this.CLOSED);let n=new bd("error",{code:e,message:t});(r=ce(this,Ai))==null||r.call(this,n),this.dispatchEvent(n)},j_=function(t,e){var r;if(ce(this,jt)===this.CLOSED)return;Me(this,jt,this.CONNECTING);let n=new bd("error",{code:e,message:t});(r=ce(this,Ai))==null||r.call(this,n),this.dispatchEvent(n),Me(this,Ri,setTimeout(ce(this,N_),ce(this,lc)))},N_=new WeakMap,go.CONNECTING=0,go.OPEN=1,go.CLOSED=2;function nZ(){let t="document"in globalThis?globalThis.document:void 0;return t&&typeof t=="object"&&"baseURI"in t&&typeof t.baseURI=="string"?t.baseURI:void 0}function wd(t){return t?t instanceof Headers?Object.fromEntries(t.entries()):Array.isArray(t)?Object.fromEntries(t):{...t}:{}}function TE(t=fetch,e){return e?async(r,n)=>{let o={...e,...n,headers:n?.headers?{...wd(e.headers),...wd(n.headers)}:e.headers};return t(r,o)}:t}var A_;A_=globalThis.crypto?.webcrypto??globalThis.crypto??import("node:crypto").then(t=>t.webcrypto);async function oZ(t){return(await A_).getRandomValues(new Uint8Array(t))}async function iZ(t){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~",r=Math.pow(2,8)-Math.pow(2,8)%e.length,n="";for(;n.length<t;){let o=await oZ(t-n.length);for(let i of o)i<r&&(n+=e[i%e.length])}return n}async function sZ(t){return await iZ(t)}async function aZ(t){let e=await(await A_).subtle.digest("SHA-256",new TextEncoder().encode(t));return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function M_(t){if(t||(t=43),t<43||t>128)throw`Expected a length between 43 and 128. Received ${t}.`;let e=await sZ(t),r=await aZ(e);return{code_verifier:e,code_challenge:r}}var nt=Km().superRefine((t,e)=>{if(!URL.canParse(t))return e.addIssue({code:dx.custom,message:"URL must be parseable",fatal:!0}),Dc}).refine(t=>{let e=new URL(t);return e.protocol!=="javascript:"&&e.protocol!=="data:"&&e.protocol!=="vbscript:"},{message:"URL cannot use javascript:, data:, or vbscript: scheme"}),CE=Fe({resource:y().url(),authorization_servers:E(nt).optional(),jwks_uri:y().url().optional(),scopes_supported:E(y()).optional(),bearer_methods_supported:E(y()).optional(),resource_signing_alg_values_supported:E(y()).optional(),resource_name:y().optional(),resource_documentation:y().optional(),resource_policy_uri:y().url().optional(),resource_tos_uri:y().url().optional(),tls_client_certificate_bound_access_tokens:_e().optional(),authorization_details_types_supported:E(y()).optional(),dpop_signing_alg_values_supported:E(y()).optional(),dpop_bound_access_tokens_required:_e().optional()}),D_=Fe({issuer:y(),authorization_endpoint:nt,token_endpoint:nt,registration_endpoint:nt.optional(),scopes_supported:E(y()).optional(),response_types_supported:E(y()),response_modes_supported:E(y()).optional(),grant_types_supported:E(y()).optional(),token_endpoint_auth_methods_supported:E(y()).optional(),token_endpoint_auth_signing_alg_values_supported:E(y()).optional(),service_documentation:nt.optional(),revocation_endpoint:nt.optional(),revocation_endpoint_auth_methods_supported:E(y()).optional(),revocation_endpoint_auth_signing_alg_values_supported:E(y()).optional(),introspection_endpoint:y().optional(),introspection_endpoint_auth_methods_supported:E(y()).optional(),introspection_endpoint_auth_signing_alg_values_supported:E(y()).optional(),code_challenge_methods_supported:E(y()).optional(),client_id_metadata_document_supported:_e().optional()}),cZ=Fe({issuer:y(),authorization_endpoint:nt,token_endpoint:nt,userinfo_endpoint:nt.optional(),jwks_uri:nt,registration_endpoint:nt.optional(),scopes_supported:E(y()).optional(),response_types_supported:E(y()),response_modes_supported:E(y()).optional(),grant_types_supported:E(y()).optional(),acr_values_supported:E(y()).optional(),subject_types_supported:E(y()),id_token_signing_alg_values_supported:E(y()),id_token_encryption_alg_values_supported:E(y()).optional(),id_token_encryption_enc_values_supported:E(y()).optional(),userinfo_signing_alg_values_supported:E(y()).optional(),userinfo_encryption_alg_values_supported:E(y()).optional(),userinfo_encryption_enc_values_supported:E(y()).optional(),request_object_signing_alg_values_supported:E(y()).optional(),request_object_encryption_alg_values_supported:E(y()).optional(),request_object_encryption_enc_values_supported:E(y()).optional(),token_endpoint_auth_methods_supported:E(y()).optional(),token_endpoint_auth_signing_alg_values_supported:E(y()).optional(),display_values_supported:E(y()).optional(),claim_types_supported:E(y()).optional(),claims_supported:E(y()).optional(),service_documentation:y().optional(),claims_locales_supported:E(y()).optional(),ui_locales_supported:E(y()).optional(),claims_parameter_supported:_e().optional(),request_parameter_supported:_e().optional(),request_uri_parameter_supported:_e().optional(),require_request_uri_registration:_e().optional(),op_policy_uri:nt.optional(),op_tos_uri:nt.optional(),client_id_metadata_document_supported:_e().optional()}),jE=T({...cZ.shape,...D_.pick({code_challenge_methods_supported:!0}).shape}),NE=T({access_token:y(),id_token:y().optional(),token_type:y(),expires_in:Mu.number().optional(),scope:y().optional(),refresh_token:y().optional()}).strip(),RE=T({error:y(),error_description:y().optional(),error_uri:y().optional()}),OE=nt.optional().or(N("").transform(()=>{})),uZ=T({redirect_uris:E(nt),token_endpoint_auth_method:y().optional(),grant_types:E(y()).optional(),response_types:E(y()).optional(),client_name:y().optional(),client_uri:nt.optional(),logo_uri:OE,scope:y().optional(),contacts:E(y()).optional(),tos_uri:OE,policy_uri:y().optional(),jwks_uri:nt.optional(),jwks:fh().optional(),software_id:y().optional(),software_version:y().optional(),software_statement:y().optional()}).strip(),lZ=T({client_id:y(),client_secret:y().optional(),client_id_issued_at:pe().optional(),client_secret_expires_at:pe().optional()}).strip(),AE=uZ.merge(lZ),wX=T({error:y(),error_description:y().optional()}).strip(),xX=T({token:y(),token_type_hint:y().optional()}).strip();function ME(t){let e=typeof t=="string"?new URL(t):new URL(t.href);return e.hash="",e}function DE({requestedResource:t,configuredResource:e}){let r=typeof t=="string"?new URL(t):new URL(t.href),n=typeof e=="string"?new URL(e):new URL(e.href);if(r.origin!==n.origin||r.pathname.length<n.pathname.length)return!1;let o=r.pathname.endsWith("/")?r.pathname:r.pathname+"/",i=n.pathname.endsWith("/")?n.pathname:n.pathname+"/";return o.startsWith(i)}var Ve=class extends Error{constructor(e,r){super(e),this.errorUri=r,this.name=this.constructor.name}toResponseObject(){let e={error:this.errorCode,error_description:this.message};return this.errorUri&&(e.error_uri=this.errorUri),e}get errorCode(){return this.constructor.errorCode}},pc=class extends Ve{};pc.errorCode="invalid_request";var vo=class extends Ve{};vo.errorCode="invalid_client";var yo=class extends Ve{};yo.errorCode="invalid_grant";var _o=class extends Ve{};_o.errorCode="unauthorized_client";var fc=class extends Ve{};fc.errorCode="unsupported_grant_type";var mc=class extends Ve{};mc.errorCode="invalid_scope";var hc=class extends Ve{};hc.errorCode="access_denied";var Yr=class extends Ve{};Yr.errorCode="server_error";var gc=class extends Ve{};gc.errorCode="temporarily_unavailable";var vc=class extends Ve{};vc.errorCode="unsupported_response_type";var yc=class extends Ve{};yc.errorCode="unsupported_token_type";var _c=class extends Ve{};_c.errorCode="invalid_token";var bc=class extends Ve{};bc.errorCode="method_not_allowed";var $c=class extends Ve{};$c.errorCode="too_many_requests";var bo=class extends Ve{};bo.errorCode="invalid_client_metadata";var wc=class extends Ve{};wc.errorCode="insufficient_scope";var xc=class extends Ve{};xc.errorCode="invalid_target";var UE={[pc.errorCode]:pc,[vo.errorCode]:vo,[yo.errorCode]:yo,[_o.errorCode]:_o,[fc.errorCode]:fc,[mc.errorCode]:mc,[hc.errorCode]:hc,[Yr.errorCode]:Yr,[gc.errorCode]:gc,[vc.errorCode]:vc,[yc.errorCode]:yc,[_c.errorCode]:_c,[bc.errorCode]:bc,[$c.errorCode]:$c,[bo.errorCode]:bo,[wc.errorCode]:wc,[xc.errorCode]:xc};var Cn=class extends Error{constructor(e){super(e??"Unauthorized")}};function dZ(t){return["client_secret_basic","client_secret_post","none"].includes(t)}var U_="code",q_="S256";function pZ(t,e){let r=t.client_secret!==void 0;return e.length===0?r?"client_secret_post":"none":"token_endpoint_auth_method"in t&&t.token_endpoint_auth_method&&dZ(t.token_endpoint_auth_method)&&e.includes(t.token_endpoint_auth_method)?t.token_endpoint_auth_method:r&&e.includes("client_secret_basic")?"client_secret_basic":r&&e.includes("client_secret_post")?"client_secret_post":e.includes("none")?"none":r?"client_secret_post":"none"}function fZ(t,e,r,n){let{client_id:o,client_secret:i}=e;switch(t){case"client_secret_basic":mZ(o,i,r);return;case"client_secret_post":hZ(o,i,n);return;case"none":gZ(o,n);return;default:throw new Error(`Unsupported client authentication method: ${t}`)}}function mZ(t,e,r){if(!e)throw new Error("client_secret_basic authentication requires a client_secret");let n=btoa(`${t}:${e}`);r.set("Authorization",`Basic ${n}`)}function hZ(t,e,r){r.set("client_id",t),e&&r.set("client_secret",e)}function gZ(t,e){e.set("client_id",t)}async function LE(t){let e=t instanceof Response?t.status:void 0,r=t instanceof Response?await t.text():t;try{let n=RE.parse(JSON.parse(r)),{error:o,error_description:i,error_uri:s}=n,a=UE[o]||Yr;return new a(i||"",s)}catch(n){let o=`${e?`HTTP ${e}: `:""}Invalid OAuth error response: ${n}. Raw body: ${r}`;return new Yr(o)}}async function xd(t,e){try{return await L_(t,e)}catch(r){if(r instanceof vo||r instanceof _o)return await t.invalidateCredentials?.("all"),await L_(t,e);if(r instanceof yo)return await t.invalidateCredentials?.("tokens"),await L_(t,e);throw r}}async function L_(t,{serverUrl:e,authorizationCode:r,scope:n,resourceMetadataUrl:o,fetchFn:i}){let s,a;try{s=await _Z(e,{resourceMetadataUrl:o},i),s.authorization_servers&&s.authorization_servers.length>0&&(a=s.authorization_servers[0])}catch{}a||(a=new URL("/",e));let c=await yZ(e,t,s),u=await kZ(a,{fetchFn:i}),l=await Promise.resolve(t.clientInformation());if(!l){if(r!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");let g=u?.client_id_metadata_document_supported===!0,v=t.clientMetadataUrl;if(v&&!vZ(v))throw new bo(`clientMetadataUrl must be a valid HTTPS URL with a non-root pathname, got: ${v}`);if(g&&v)l={client_id:v},await t.saveClientInformation?.(l);else{if(!t.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");let x=await zZ(a,{metadata:u,clientMetadata:t.clientMetadata,fetchFn:i});await t.saveClientInformation(x),l=x}}let d=!t.redirectUrl;if(r!==void 0||d){let g=await EZ(t,a,{metadata:u,resource:c,authorizationCode:r,fetchFn:i});return await t.saveTokens(g),"AUTHORIZED"}let p=await t.tokens();if(p?.refresh_token)try{let g=await IZ(a,{metadata:u,clientInformation:l,refreshToken:p.refresh_token,resource:c,addClientAuthentication:t.addClientAuthentication,fetchFn:i});return await t.saveTokens(g),"AUTHORIZED"}catch(g){if(!(!(g instanceof Ve)||g instanceof Yr))throw g}let f=t.state?await t.state():void 0,{authorizationUrl:h,codeVerifier:m}=await SZ(a,{metadata:u,clientInformation:l,state:f,redirectUrl:t.redirectUrl,scope:n||s?.scopes_supported?.join(" ")||t.clientMetadata.scope,resource:c});return await t.saveCodeVerifier(m),await t.redirectToAuthorization(h),"REDIRECT"}function vZ(t){if(!t)return!1;try{let e=new URL(t);return e.protocol==="https:"&&e.pathname!=="/"}catch{return!1}}async function yZ(t,e,r){let n=ME(t);if(e.validateResourceURL)return await e.validateResourceURL(n,r?.resource);if(r){if(!DE({requestedResource:n,configuredResource:r.resource}))throw new Error(`Protected resource ${r.resource} does not match expected ${n} (or origin)`);return new URL(r.resource)}}function V_(t){let e=t.headers.get("WWW-Authenticate");if(!e)return{};let[r,n]=e.split(" ");if(r.toLowerCase()!=="bearer"||!n)return{};let o=Z_(t,"resource_metadata")||void 0,i;if(o)try{i=new URL(o)}catch{}let s=Z_(t,"scope")||void 0,a=Z_(t,"error")||void 0;return{resourceMetadataUrl:i,scope:s,error:a}}function Z_(t,e){let r=t.headers.get("WWW-Authenticate");if(!r)return null;let n=new RegExp(`${e}=(?:"([^"]+)"|([^\\s,]+))`),o=r.match(n);return o?o[1]||o[2]:null}async function _Z(t,e,r=fetch){let n=await wZ(t,"oauth-protected-resource",r,{protocolVersion:e?.protocolVersion,metadataUrl:e?.resourceMetadataUrl});if(!n||n.status===404)throw await n?.body?.cancel(),new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!n.ok)throw await n.body?.cancel(),new Error(`HTTP ${n.status} trying to load well-known OAuth protected resource metadata.`);return CE.parse(await n.json())}async function F_(t,e,r=fetch){try{return await r(t,{headers:e})}catch(n){if(n instanceof TypeError)return e?F_(t,void 0,r):void 0;throw n}}function bZ(t,e="",r={}){return e.endsWith("/")&&(e=e.slice(0,-1)),r.prependPathname?`${e}/.well-known/${t}`:`/.well-known/${t}${e}`}async function qE(t,e,r=fetch){return await F_(t,{"MCP-Protocol-Version":e},r)}function $Z(t,e){return!t||t.status>=400&&t.status<500&&e!=="/"}async function wZ(t,e,r,n){let o=new URL(t),i=n?.protocolVersion??Yo,s;if(n?.metadataUrl)s=new URL(n.metadataUrl);else{let c=bZ(e,o.pathname);s=new URL(c,n?.metadataServerUrl??o),s.search=o.search}let a=await qE(s,i,r);if(!n?.metadataUrl&&$Z(a,o.pathname)){let c=new URL(`/.well-known/${e}`,o);a=await qE(c,i,r)}return a}function xZ(t){let e=typeof t=="string"?new URL(t):t,r=e.pathname!=="/",n=[];if(!r)return n.push({url:new URL("/.well-known/oauth-authorization-server",e.origin),type:"oauth"}),n.push({url:new URL("/.well-known/openid-configuration",e.origin),type:"oidc"}),n;let o=e.pathname;return o.endsWith("/")&&(o=o.slice(0,-1)),n.push({url:new URL(`/.well-known/oauth-authorization-server${o}`,e.origin),type:"oauth"}),n.push({url:new URL(`/.well-known/openid-configuration${o}`,e.origin),type:"oidc"}),n.push({url:new URL(`${o}/.well-known/openid-configuration`,e.origin),type:"oidc"}),n}async function kZ(t,{fetchFn:e=fetch,protocolVersion:r=Yo}={}){let n={"MCP-Protocol-Version":r,Accept:"application/json"},o=xZ(t);for(let{url:i,type:s}of o){let a=await F_(i,n,e);if(a){if(!a.ok){if(await a.body?.cancel(),a.status>=400&&a.status<500)continue;throw new Error(`HTTP ${a.status} trying to load ${s==="oauth"?"OAuth":"OpenID provider"} metadata from ${i}`)}return s==="oauth"?D_.parse(await a.json()):jE.parse(await a.json())}}}async function SZ(t,{metadata:e,clientInformation:r,redirectUrl:n,scope:o,state:i,resource:s}){let a;if(e){if(a=new URL(e.authorization_endpoint),!e.response_types_supported.includes(U_))throw new Error(`Incompatible auth server: does not support response type ${U_}`);if(e.code_challenge_methods_supported&&!e.code_challenge_methods_supported.includes(q_))throw new Error(`Incompatible auth server: does not support code challenge method ${q_}`)}else a=new URL("/authorize",t);let c=await M_(),u=c.code_verifier,l=c.code_challenge;return a.searchParams.set("response_type",U_),a.searchParams.set("client_id",r.client_id),a.searchParams.set("code_challenge",l),a.searchParams.set("code_challenge_method",q_),a.searchParams.set("redirect_uri",String(n)),i&&a.searchParams.set("state",i),o&&a.searchParams.set("scope",o),o?.includes("offline_access")&&a.searchParams.append("prompt","consent"),s&&a.searchParams.set("resource",s.href),{authorizationUrl:a,codeVerifier:u}}function PZ(t,e,r){return new URLSearchParams({grant_type:"authorization_code",code:t,code_verifier:e,redirect_uri:String(r)})}async function ZE(t,{metadata:e,tokenRequestParams:r,clientInformation:n,addClientAuthentication:o,resource:i,fetchFn:s}){let a=e?.token_endpoint?new URL(e.token_endpoint):new URL("/token",t),c=new Headers({"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"});if(i&&r.set("resource",i.href),o)await o(c,r,a,e);else if(n){let l=e?.token_endpoint_auth_methods_supported??[],d=pZ(n,l);fZ(d,n,c,r)}let u=await(s??fetch)(a,{method:"POST",headers:c,body:r});if(!u.ok)throw await LE(u);return NE.parse(await u.json())}async function IZ(t,{metadata:e,clientInformation:r,refreshToken:n,resource:o,addClientAuthentication:i,fetchFn:s}){let a=new URLSearchParams({grant_type:"refresh_token",refresh_token:n}),c=await ZE(t,{metadata:e,tokenRequestParams:a,clientInformation:r,addClientAuthentication:i,resource:o,fetchFn:s});return{refresh_token:n,...c}}async function EZ(t,e,{metadata:r,resource:n,authorizationCode:o,fetchFn:i}={}){let s=t.clientMetadata.scope,a;if(t.prepareTokenRequest&&(a=await t.prepareTokenRequest(s)),!a){if(!o)throw new Error("Either provider.prepareTokenRequest() or authorizationCode is required");if(!t.redirectUrl)throw new Error("redirectUrl is required for authorization_code flow");let u=await t.codeVerifier();a=PZ(o,u,t.redirectUrl)}let c=await t.clientInformation();return ZE(e,{metadata:r,tokenRequestParams:a,clientInformation:c??void 0,addClientAuthentication:t.addClientAuthentication,resource:n,fetchFn:i})}async function zZ(t,{metadata:e,clientMetadata:r,fetchFn:n}){let o;if(e){if(!e.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");o=new URL(e.registration_endpoint)}else o=new URL("/register",t);let i=await(n??fetch)(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok)throw await LE(i);return AE.parse(await i.json())}var B_=class extends Error{constructor(e,r,n){super(`SSE error: ${r}`),this.code=e,this.event=n}},kd=class{constructor(e,r){this._url=e,this._resourceMetadataUrl=void 0,this._scope=void 0,this._eventSourceInit=r?.eventSourceInit,this._requestInit=r?.requestInit,this._authProvider=r?.authProvider,this._fetch=r?.fetch,this._fetchWithInit=TE(r?.fetch,r?.requestInit)}async _authThenStart(){if(!this._authProvider)throw new Cn("No auth provider");let e;try{e=await xd(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})}catch(r){throw this.onerror?.(r),r}if(e!=="AUTHORIZED")throw new Cn;return await this._startOrAuth()}async _commonHeaders(){let e={};if(this._authProvider){let n=await this._authProvider.tokens();n&&(e.Authorization=`Bearer ${n.access_token}`)}this._protocolVersion&&(e["mcp-protocol-version"]=this._protocolVersion);let r=wd(this._requestInit?.headers);return new Headers({...e,...r})}_startOrAuth(){let e=this?._eventSourceInit?.fetch??this._fetch??fetch;return new Promise((r,n)=>{this._eventSource=new go(this._url.href,{...this._eventSourceInit,fetch:async(o,i)=>{let s=await this._commonHeaders();s.set("Accept","text/event-stream");let a=await e(o,{...i,headers:s});if(a.status===401&&a.headers.has("www-authenticate")){let{resourceMetadataUrl:c,scope:u}=V_(a);this._resourceMetadataUrl=c,this._scope=u}return a}}),this._abortController=new AbortController,this._eventSource.onerror=o=>{if(o.code===401&&this._authProvider){this._authThenStart().then(r,n);return}let i=new B_(o.code,o.message,o);n(i),this.onerror?.(i)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",o=>{let i=o;try{if(this._endpoint=new URL(i.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(s){n(s),this.onerror?.(s),this.close();return}r()}),this._eventSource.onmessage=o=>{let i=o,s;try{s=Lu.parse(JSON.parse(i.data))}catch(a){this.onerror?.(a);return}this.onmessage?.(s)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(e){if(!this._authProvider)throw new Cn("No auth provider");if(await xd(this._authProvider,{serverUrl:this._url,authorizationCode:e,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new Cn("Failed to authorize")}async close(){this._abortController?.abort(),this._eventSource?.close(),this.onclose?.()}async send(e){if(!this._endpoint)throw new Error("Not connected");try{let r=await this._commonHeaders();r.set("content-type","application/json");let n={...this._requestInit,method:"POST",headers:r,body:JSON.stringify(e),signal:this._abortController?.signal},o=await(this._fetch??fetch)(this._endpoint,n);if(!o.ok){let i=await o.text().catch(()=>null);if(o.status===401&&this._authProvider){let{resourceMetadataUrl:s,scope:a}=V_(o);if(this._resourceMetadataUrl=s,this._scope=a,await xd(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new Cn;return this.send(e)}throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${i}`)}await o.body?.cancel()}catch(r){throw this.onerror?.(r),r}}setProtocolVersion(e){this._protocolVersion=e}};var Sd=class{constructor(e){this.output=e}clients=new Map;cachedTools=[];disposables=[];async initialize(){await this.refreshServers()}async refreshServers(){for(let o of this.clients.values())await o.close();this.clients.clear();let e=VE.workspace.getConfiguration("githubCopilotApi.mcp");if(!e.get("enabled",!0)){this.output.appendLine("[MCP] Disabled in configuration.");return}let n=e.get("servers",{});for(let[o,i]of Object.entries(n))try{await this.connectToServer(o,i)}catch(s){this.output.appendLine(`[MCP] Failed to connect to server "${o}": ${s}`)}this.cachedTools=await this.getAllTools()}getTools(){return this.cachedTools}getConnectedServers(){return Array.from(this.clients.keys())}async connectToServer(e,r){let n;if(r.url)n=new kd(new URL(r.url));else if(r.command)n=new vd({command:r.command,args:r.args||[],env:this.getCleanEnv(r.env)});else throw new Error(`Invalid configuration for MCP server "${e}"`);let o=new md({name:"github-copilot-api-gateway",version:"0.0.1"},{capabilities:{}});await o.connect(n),this.clients.set(e,o),this.output.appendLine(`[MCP] Connected to server "${e}"`)}async getAllTools(){let e=[];for(let[r,n]of this.clients.entries())try{let i=(await n.request({method:"tools/list"},ra)).tools.map(s=>({serverName:r,name:s.name,description:s.description,inputSchema:s.inputSchema}));e.push(...i)}catch(o){this.output.appendLine(`[MCP] Failed to list tools for server "${r}": ${o}`)}return e}async callTool(e,r,n){let o=this.clients.get(e);if(!o)throw new Error(`MCP server "${e}" not found or not connected`);return await o.request({method:"tools/call",params:{name:r,arguments:n}},mn)}getCleanEnv(e){let r={};for(let[n,o]of Object.entries(process.env))o!==void 0&&(r[n]=o);if(e)for(let[n,o]of Object.entries(e))o!==void 0&&(r[n]=o);return r}dispose(){for(let e of this.clients.values())e.close().catch(r=>console.error(`[MCP] Error closing client: ${r}`));this.clients.clear();for(let e of this.disposables)e.dispose()}};var GV=qe(Dz(),1),JV=qe(rb(),1),KV=qe(ib(),1),XV=qe(Md(),1),fb=qe(Wz(),1);var YV="GitHub.copilot-chat",QV="@id:GitHub.copilot-chat",U=class extends Error{constructor(r,n,o,i,s){super(n);this.status=r;this.type=o;this.code=i;this.details=s;this.name="ApiError"}},e9=[{id:"ssn",name:"US Social Security",pattern:"\\b\\d{3}-\\d{2}-\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"credit-card",name:"Credit/Debit Card",pattern:"\\b(?:\\d{4}[- ]?){3}\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"aadhaar",name:"Aadhaar Number",pattern:"\\b\\d{4}\\s?\\d{4}\\s?\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"passport-in",name:"Indian Passport",pattern:"\\b[A-Z]\\d{7}\\b",enabled:!0,isBuiltin:!0},{id:"passport-us",name:"US Passport",pattern:"\\b\\d{9}\\b",enabled:!0,isBuiltin:!0},{id:"email",name:"Email Address",pattern:"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}",enabled:!0,isBuiltin:!0},{id:"url",name:"URLs",pattern:"https?://[^\\s]+",enabled:!0,isBuiltin:!0},{id:"phone-us",name:"US Phone Number",pattern:"\\b\\d{3}[-.]?\\d{3}[-.]?\\d{4}\\b",enabled:!0,isBuiltin:!0},{id:"phone-in",name:"Indian Phone",pattern:"\\b[6-9]\\d{9}\\b",enabled:!0,isBuiltin:!0},{id:"api-key",name:"API Keys",pattern:"(sk-[a-zA-Z0-9]{20,})|(api[_-]?key[=:]\\s*[\\w-]+)",enabled:!0,isBuiltin:!0},{id:"password-json",name:"Passwords in JSON",pattern:'"password"\\s*:\\s*"[^"]*"',enabled:!0,isBuiltin:!0},{id:"bearer-token",name:"Bearer Tokens",pattern:"Bearer\\s+[A-Za-z0-9\\-._~+/]+=*",enabled:!0,isBuiltin:!0}],t9={"gpt-4":"gpt-4o-copilot","gpt-4-turbo":"gpt-4o-copilot","gpt-4-turbo-preview":"gpt-4o-copilot","gpt-4o":"gpt-4o-copilot","gpt-4o-mini":"gpt-4o-mini-copilot","gpt-3.5-turbo":"gpt-4o-mini-copilot","gpt-3.5-turbo-16k":"gpt-4o-mini-copilot","claude-3-opus":"claude-3.5-sonnet-copilot","claude-3-sonnet":"claude-3.5-sonnet-copilot","claude-3-haiku":"claude-3.5-sonnet-copilot","claude-3.5-sonnet":"claude-3.5-sonnet-copilot",o1:"o1-copilot","o1-mini":"o1-mini-copilot","gemini-1.5-pro":"gpt-4o-copilot","gemini-1.5-flash":"gpt-4o-mini-copilot","o1-preview":"o1-copilot","o3-mini":"o3-mini-copilot"},Ud=class{constructor(e,r,n){this.output=e;this.statusItem=r;this.context=n,this.auditService=new jc(n),this.mcpService=new Sd(e),this.mcpService.initialize().catch(i=>console.error("Failed to initialize MCP:",i)),this.loadHistory(),this.startStatsUpdater(),this.startDomainCacheRefresh();let o=w.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("githubCopilotApi.server")){if(this.suppressRestart)return;this.restart().catch(s=>{this.logError("Failed to restart API server after configuration change",s)})}});this.disposables.push(o),this.initializeStats().catch(i=>console.error("Failed to initialize stats:",i))}httpServer;wsServer;disposables=[];config=Gz();disposed=!1;activeRequests=0;suppressRestart=!1;_onDidChangeStatus=new w.EventEmitter;onDidChangeStatus=this._onDidChangeStatus.event;_onDidLogRequest=new w.EventEmitter;onDidLogRequest=this._onDidLogRequest.event;domainCache=new Map;domainRefreshInterval;usageStats={totalRequests:0,totalTokensIn:0,totalTokensOut:0,requestsByEndpoint:{},startTime:Date.now()};realtimeStats={requestsPerMinute:0,avgLatencyMs:0,latencyHistory:[],tokensPerMinute:0,errorRate:0,lastMinuteRequests:[],lastMinuteErrors:0};requestHistory=[];connections=new Set;isShuttingDown=!1;MAX_HISTORY_SIZE=100;context;rateLimitBucket=[];requestCache=new Map;CACHE_TTL_MS=5e3;statsInterval;activeConnectionsPerIp=new Map;auditService;mcpService;async initializeStats(){try{let e=await this.auditService.getLifetimeStats();this.usageStats.totalRequests=e.totalRequests,this.usageStats.totalTokensIn=e.totalTokensIn,this.usageStats.totalTokensOut=e.totalTokensOut}catch(e){console.error("Failed to load lifetime stats:",e)}}async getStatus(){return{running:!!this.httpServer,config:this.config,activeRequests:this.activeRequests,networkInfo:this.getNetworkInfo(),stats:this.getStats(),realtimeStats:this.realtimeStats,historyCount:this.requestHistory.length,mcp:this.getMcpStatus(),copilot:await this.getCopilotHealth()}}async getCopilotHealth(){let e=w.extensions.all,r=e.find(s=>s.id.toLowerCase()==="github.copilot"||s.id.toLowerCase()==="github.copilot-nightly"||s.packageJSON?.publisher==="GitHub"&&s.packageJSON?.name==="copilot"),n=e.find(s=>s.id.toLowerCase()==="github.copilot-chat"||s.packageJSON?.publisher==="GitHub"&&s.packageJSON?.name==="copilot-chat"),o=!1;try{let s=await w.lm.selectChatModels({vendor:"copilot"});o=s&&s.length>0}catch{o=!1}return{installed:!!r||o,chatInstalled:!!n||o,signedIn:o,ready:o||!!r&&!!n&&o}}getMcpStatus(){return{enabled:w.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0),servers:this.mcpService.getConnectedServers(),tools:this.mcpService.getTools()}}getStats(){return{...this.usageStats,uptimeMs:Date.now()-this.usageStats.startTime,avgLatencyMs:this.realtimeStats.avgLatencyMs,requestsPerMinute:this.realtimeStats.requestsPerMinute,errorRate:this.realtimeStats.errorRate}}getHistory(e){let r=[...this.requestHistory].reverse();return e?r.slice(0,e):r}async getDailyStats(e){return this.auditService.getDailyStats(e)}async getAuditLogs(e,r){return this.auditService.getLogEntries(e,r)}getLogFolderPath(){return this.auditService.getLogFolderPath()}clearHistory(){this.requestHistory=[],this.saveHistory(),this._onDidChangeStatus.fire()}loadHistory(){if(!this.context)return;let e=this.context.globalState.get("requestHistory",[]);this.requestHistory=e.slice(-this.MAX_HISTORY_SIZE)}saveHistory(){this.context&&this.context.globalState.update("requestHistory",this.requestHistory.slice(-this.MAX_HISTORY_SIZE))}addHistoryEntry(e){let r=this.redactSensitiveData(e);this.requestHistory.push(r),this.requestHistory.length>this.MAX_HISTORY_SIZE&&(this.requestHistory=this.requestHistory.slice(-this.MAX_HISTORY_SIZE)),this.requestHistory.length%10===0&&this.saveHistory(),this._onDidChangeStatus.fire()}redactSensitiveData(e){let r=this.config.redactionPatterns.filter(i=>i.enabled);if(console.log(`[Redaction] ${this.config.redactionPatterns.length} total patterns, ${r.length} enabled`),!r.length)return e;let n=i=>{let s=i;for(let a of r)try{let c=new RegExp(a.pattern,"gi");s=s.replace(c,"[REDACTED]")}catch{}return s},o=i=>{if(typeof i=="string")return n(i);if(Array.isArray(i))return i.map(o);if(i&&typeof i=="object"){let s={};for(let[a,c]of Object.entries(i))s[a]=o(c);return s}return i};return o(e)}redactMessagesContent(e){let r=this.config.redactionPatterns.filter(o=>o.enabled);if(!r.length)return e;let n=o=>{let i=o;for(let s of r)try{let a=new RegExp(s.pattern,"gi");i=i.replace(a,"[REDACTED]")}catch{}return i};return e.map(o=>{let i=o.content;return typeof i=="string"?i=n(i):Array.isArray(i)&&(i=i.map(s=>typeof s=="string"?n(s):s&&typeof s=="object"&&typeof s.text=="string"?{...s,text:n(s.text)}:s)),{...o,content:i}})}redactPromptString(e){let r=this.config.redactionPatterns.filter(o=>o.enabled);if(!r.length)return e;let n=e;for(let o of r)try{let i=new RegExp(o.pattern,"gi");n=n.replace(i,"[REDACTED]")}catch{}return n}startStatsUpdater(){this.statsInterval=setInterval(()=>{this.updateRealtimeStats()},5e3)}startDomainCacheRefresh(){this.refreshDomainCache(),this.domainRefreshInterval=setInterval(()=>{this.refreshDomainCache()},300*1e3)}updateRealtimeStats(){let r=Date.now()-6e4;if(this.realtimeStats.latencyHistory=this.realtimeStats.latencyHistory.filter(n=>n.timestamp>r),this.realtimeStats.lastMinuteRequests=this.realtimeStats.lastMinuteRequests.filter(n=>n>r),this.realtimeStats.requestsPerMinute=this.realtimeStats.lastMinuteRequests.length,this.realtimeStats.latencyHistory.length>0){let n=this.realtimeStats.latencyHistory.reduce((o,i)=>o+i.latency,0);this.realtimeStats.avgLatencyMs=Math.round(n/this.realtimeStats.latencyHistory.length)}else this.realtimeStats.avgLatencyMs=0;this.realtimeStats.lastMinuteRequests.length>0?this.realtimeStats.errorRate=Math.round(this.realtimeStats.lastMinuteErrors/this.realtimeStats.lastMinuteRequests.length*100):this.realtimeStats.errorRate=0,this.realtimeStats.lastMinuteRequests.length===0&&(this.realtimeStats.lastMinuteErrors=0)}recordRequestStats(e,r,n,o){let i=Date.now();this.usageStats.totalRequests++,this.usageStats.totalTokensIn+=r,this.usageStats.totalTokensOut+=n,this.realtimeStats.lastMinuteRequests.push(i),this.realtimeStats.latencyHistory.push({timestamp:i,latency:e}),o&&this.realtimeStats.lastMinuteErrors++,this.realtimeStats.tokensPerMinute=Math.round((this.usageStats.totalTokensIn+this.usageStats.totalTokensOut)/Math.max(1,(i-this.usageStats.startTime)/6e4))}async addRedactionPattern(e,r){try{new RegExp(r);let n=this.config.redactionPatterns,i={id:`custom-${Date.now()}`,name:e,pattern:r,enabled:!0,isBuiltin:!1};return await this.updateServerConfig({redactionPatterns:[...n,i]}),!0}catch{return!1}}async removeRedactionPattern(e){let r=this.config.redactionPatterns.filter(n=>n.id!==e);await this.updateServerConfig({redactionPatterns:r})}async toggleRedactionPattern(e,r){let n=this.config.redactionPatterns.map(o=>o.id===e?{...o,enabled:r}:o);await this.updateServerConfig({redactionPatterns:n})}getRedactionPatterns(){return[...this.config.redactionPatterns]}async addIpAllowlistEntry(e){let r=e.trim();if(!r)return!1;let n=/^[\d\.\/]+$|^[\da-fA-F:\/]+$/.test(r),o=/^[a-zA-Z0-9]([a-zA-Z0-9\-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]*[a-zA-Z0-9])?)+$/.test(r);if(!n&&!o)return!1;let i=[...this.config.ipAllowlist,r];return await w.workspace.getConfiguration("githubCopilotApi").update("server.ipAllowlist",i,w.ConfigurationTarget.Global),!0}async removeIpAllowlistEntry(e){let r=this.config.ipAllowlist.filter(n=>n!==e);await this.updateServerConfig({ipAllowlist:r})}getNetworkInfo(){if(this.config.host!=="0.0.0.0")return null;let e=qd.hostname(),r=[],n=qd.networkInterfaces();for(let o of Object.keys(n)){let i=n[o];if(i)for(let s of i)!s.internal&&s.family==="IPv4"&&r.push(s.address)}return{hostname:e,localIPs:r}}async startServer(){await this.updateServerConfig({enabled:!0})}async stopServer(){await this.updateServerConfig({enabled:!1})}async toggleHttp(){await this.updateServerConfig({enableHttp:!this.config.enableHttp,enabled:!0})}async toggleWebSocket(){await this.updateServerConfig({enableWebSocket:!this.config.enableWebSocket,enabled:!0})}async toggleLogging(){await this.updateServerConfig({enableLogging:!this.config.enableLogging})}async setApiKey(e){let r=(e??"").trim();await this.updateServerConfig({apiKey:r})}async setRateLimit(e){let r=Number.isFinite(e)?Math.max(0,Math.floor(e)):60;await this.updateServerConfig({rateLimitPerMinute:r})}getVersion(){return this.context?.extension.packageJSON.version||"0.0.1"}async setHost(e){let r=(e??"").trim();r&&await this.updateServerConfig({host:r,enabled:!0})}async setPort(e){let r=Number.isFinite(e)?Math.max(1,Math.min(65535,Math.floor(e))):this.config.port;await this.updateServerConfig({port:r,enabled:!0})}async toggleMcp(e){this.suppressRestart=!0,await w.workspace.getConfiguration("githubCopilotApi.mcp").update("enabled",e,w.ConfigurationTarget.Global),await this.mcpService.refreshServers(),this.config.mcpEnabled=e,this.suppressRestart=!1}async setDefaultModel(e){let r=(e??"").trim();r&&await this.updateServerConfig({defaultModel:r,enabled:!0})}async setRequestTimeout(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):180;await this.updateServerConfig({requestTimeoutSeconds:r})}async setMaxPayloadSize(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):1;await this.updateServerConfig({maxPayloadSizeMb:r})}async setMaxConnectionsPerIp(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):10;await this.updateServerConfig({maxConnectionsPerIp:r})}async setMaxConcurrency(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):4;await this.updateServerConfig({maxConcurrentRequests:r})}async start(){if(this.disposed)return;if(await this.stop(),this.config=Gz(),!this.config.enabled){this.updateStatusBar("stopped","Server disabled in settings"),this._onDidChangeStatus.fire();return}this.updateStatusBar("starting"),this._onDidChangeStatus.fire(),this.httpServer=(0,Jz.createServer)((r,n)=>{this.connections.add(n),n.on("close",()=>this.connections.delete(n));let o=Date.now(),i=(0,pt.randomUUID)().slice(0,8);this.handleHttpRequest(r,n,i,o).catch(s=>{let a=Date.now()-o;s instanceof U?(this.logRequest(i,r.method||"UNKNOWN",r.url||"/",s.status,a,{error:s.message,requestHeaders:r.headers}),this.sendError(n,s)):(this.logRequest(i,r.method||"UNKNOWN",r.url||"/",500,a,{error:s instanceof Error?s.message:String(s),requestHeaders:r.headers}),this.logError("Unhandled error in HTTP request handler",s),this.sendError(n,new U(500,"An unexpected error occurred.","server_error")))})}),this.httpServer.on("error",r=>{this.logError("HTTP server error",r)}),this.wsServer=new fb.default({noServer:!0}),this.wsServer.on("connection",r=>this.handleWebSocketConnection(r)),this.wsServer.on("error",r=>{this.logError("WebSocket server error",r)}),this.httpServer.on("upgrade",(r,n,o)=>{if(!r.url){n.destroy();return}this.buildUrl(r.url).pathname==="/v1/realtime"&&this.config.enableWebSocket?this.wsServer?.handleUpgrade(r,n,o,s=>{this.wsServer?.emit("connection",s,r)}):n.destroy()}),await new Promise((r,n)=>{let o=i=>{this.httpServer?.off("error",o),n(i)};this.httpServer?.once("error",o),this.httpServer?.listen(this.config.port,this.config.host,()=>{this.httpServer?.off("error",o),r()})});let e=this.httpServer.address();if(e){let r=`http://${e.address}:${e.port}`;this.logInfo(`HTTP server listening on ${r}`),this.updateStatusBar("running",`HTTP${this.config.enableWebSocket?"+WS":""} on ${r}`),this._onDidChangeStatus.fire()}}async restart(){this.disposed||(this.logInfo("Restarting API server to apply configuration changes..."),await this.start())}async stop(){this.wsServer&&await new Promise(e=>{for(let r of this.wsServer?.clients??[])r.close(1001,"Server shutting down");this.wsServer?.close(()=>e())}),this.httpServer&&await new Promise((e,r)=>{this.httpServer?.close(n=>{n?r(n):e()})}),this.httpServer=void 0,this.wsServer=void 0,this.activeRequests=0,this.updateStatusBar("stopped"),this._onDidChangeStatus.fire()}async dispose(){if(this.disposed=!0,this.isShuttingDown=!0,this.logInfo("Shutting down API Gateway..."),this.statsInterval&&(clearInterval(this.statsInterval),this.statsInterval=void 0),this.domainRefreshInterval&&(clearInterval(this.domainRefreshInterval),this.domainRefreshInterval=void 0),this.saveHistory(),this.activeRequests>0){this.logInfo(`Waiting for ${this.activeRequests} active requests to complete...`);let e=0;for(;this.activeRequests>0&&e<3e3;)await new Promise(r=>setTimeout(r,100)),e+=100;this.activeRequests>0&&this.logInfo(`Forcing close of ${this.activeRequests} remaining requests.`)}for(let e of this.connections)e.writableEnded||(e.writeHead(503,{"Content-Type":"application/json"}),e.end(JSON.stringify({error:{message:"Server is shutting down",type:"service_unavailable"}})));this.connections.clear(),await this.stop().catch(e=>{this.logError("Failed to stop API server during dispose",e)});for(let e of this.disposables.splice(0))e.dispose();await this.mcpService.dispose(),this._onDidChangeStatus.dispose(),this.logInfo("API Gateway shut down successfully.")}async handleHttpRequest(e,r,n,o){if(this.isShuttingDown){r.writeHead(503,{"Content-Type":"application/json"}),r.end(JSON.stringify({error:{message:"Server is shutting down",type:"service_unavailable"}}));return}if(this.setCorsHeaders(r),r.setHeader("X-Request-ID",n),e.method==="OPTIONS"){r.writeHead(204),r.end();return}if(!this.config.enableHttp)throw new U(503,"HTTP API is disabled. Enable it from the Copilot API controls.","service_unavailable","http_disabled");let i=this.buildUrl(e.url),s=this.getClientIp(e),a=this.activeConnectionsPerIp.get(s)||0;if(a>=this.config.maxConnectionsPerIp)throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,429,Date.now()-o,{requestHeaders:e.headers}),new U(429,`Too many connections from your IP. Maximum ${this.config.maxConnectionsPerIp} concurrent connections allowed.`,"rate_limit_error","too_many_connections");if(this.activeConnectionsPerIp.set(s,a+1),r.on("close",()=>{let d=this.activeConnectionsPerIp.get(s)||1;d<=1?this.activeConnectionsPerIp.delete(s):this.activeConnectionsPerIp.set(s,d-1)}),this.config.apiKey&&i.pathname!=="/health"){let d=e.headers.authorization;if((d?.startsWith("Bearer ")?d.slice(7):null)!==this.config.apiKey)throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,401,Date.now()-o,{requestHeaders:e.headers}),new U(401,"Invalid or missing API key. Provide a valid Bearer token.","authentication_error","invalid_api_key")}if(!this.checkRateLimit())throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,429,Date.now()-o,{requestHeaders:e.headers}),new U(429,"Rate limit exceeded. Please try again later.","rate_limit_error","rate_limit_exceeded");if(!this.checkIpAllowlist(e))throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,403,Date.now()-o,{requestHeaders:e.headers}),new U(403,"Access denied. Your IP address is not allowed.","access_denied","ip_not_allowed");if(this.usageStats.totalRequests++,this.usageStats.requestsByEndpoint[i.pathname]=(this.usageStats.requestsByEndpoint[i.pathname]||0)+1,e.method==="GET"&&i.pathname==="/health"){try{let d=await w.lm.selectChatModels({vendor:"copilot"});d&&d.length>0?this.sendJson(r,200,{status:"ok",service:"github-copilot-api-vscode",copilot:"available",models:d.length}):this.sendJson(r,200,{status:"degraded",service:"github-copilot-api-vscode",copilot:"unavailable",message:"No Copilot models found. Check if GitHub Copilot is installed and signed in."})}catch{this.sendJson(r,200,{status:"degraded",service:"github-copilot-api-vscode",copilot:"error",message:"Failed to check Copilot availability."})}return}if(e.method==="GET"&&i.pathname==="/openapi.json"){this.sendJson(r,200,this.getOpenApiSpec());return}if(e.method==="GET"&&i.pathname==="/debug-paths"){this.sendDebugPaths(r);return}if(e.method==="GET"&&i.pathname==="/docs"){this.sendSwaggerUi(r);return}if(e.method==="GET"&&i.pathname.startsWith("/swagger-ui/")){this.serveStaticFile(e,r,i.pathname);return}if(e.method==="GET"&&i.pathname==="/v1/usage"){let d=Math.floor((Date.now()-this.usageStats.startTime)/1e3);this.sendJson(r,200,{object:"usage",total_requests:this.usageStats.totalRequests,total_tokens:{input:this.usageStats.totalTokensIn,output:this.usageStats.totalTokensOut,total:this.usageStats.totalTokensIn+this.usageStats.totalTokensOut},requests_by_endpoint:this.usageStats.requestsByEndpoint,uptime_seconds:d,active_requests:this.activeRequests});return}if(e.method==="GET"&&i.pathname==="/v1/models"){let d=await this.getAvailableModels();this.sendJson(r,200,{object:"list",data:d});return}let c=i.pathname.match(/^\/v1\/models\/(.+)$/);if(e.method==="GET"&&c){let d=decodeURIComponent(c[1]),f=(await this.getAvailableModels()).find(h=>h.id===d);if(!f)throw new U(404,`Model '${d}' not found`,"not_found","model_not_found");this.sendJson(r,200,f);return}if(e.method==="POST"&&i.pathname==="/v1/chat/completions"){let d=await this.readJsonBody(e);if(d?.stream===!0)await this.processStreamingChatCompletion(d,e,r,n,o);else{let p=await this.processChatCompletion(d,{source:"http",endpoint:"/v1/chat/completions"});this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,tokensIn:p?.usage?.prompt_tokens,tokensOut:p?.usage?.completion_tokens,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p)}return}if(e.method==="POST"&&i.pathname==="/v1/messages"){let d=await this.readJsonBody(e);if(d?.model&&!this.resolveModel(d.model))throw new U(400,`Model '${d.model}' is not supported.`,"invalid_request_error","model_not_found");if(d?.stream===!0)await this.processStreamingAnthropicMessages(d,e,r,n,o);else try{let p=await this.processAnthropicMessages(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,tokensIn:p?.usage?.input_tokens,tokensOut:p?.usage?.output_tokens,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p)}catch(p){let f=p instanceof U?p:new U(500,p.message||"Internal Server Error","api_error");this.sendJson(r,f.status,{type:"error",error:{type:f.code||"api_error",message:f.message}})}return}if(e.method==="POST"&&i.pathname==="/v1/completions"){let d=await this.readJsonBody(e),p=await this.processCompletion(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,tokensIn:p?.usage?.prompt_tokens,tokensOut:p?.usage?.completion_tokens,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p);return}if(e.method==="POST"&&i.pathname==="/v1/tokenize"){let d=await this.readJsonBody(e),p=await this.processTokenize(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p);return}if(e.method==="POST"&&i.pathname==="/v1/count_tokens"){let d=await this.readJsonBody(e),p=await this.processTokenize(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p);return}if(e.method==="POST"&&i.pathname==="/v1/responses"){let d=await this.readJsonBody(e),p=await this.processResponsesApi(d);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:d,responsePayload:p,tokensIn:p?.usage?.input_tokens,tokensOut:p?.usage?.output_tokens,model:d?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,p);return}let u=i.pathname.match(/^\/v1beta\/models\/(.+):generateContent$/),l=i.pathname.match(/^\/v1beta\/models\/(.+):streamGenerateContent$/);if(e.method==="POST"&&(u||l)){let d=decodeURIComponent((u||l)[1]),p=await this.readJsonBody(e);if(d&&!this.resolveModel(d))throw new U(400,`Model '${d}' is not supported.`,"invalid_request_error","model_not_found");if(l)await this.processStreamingGoogleGenerateContent(d,p,e,r,n,o);else try{let f=await this.processGoogleGenerateContent(d,p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usageMetadata?.promptTokenCount,tokensOut:f?.usageMetadata?.candidatesTokenCount,model:d,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}catch(f){let h=f instanceof U?f:new U(500,f.message||"Internal Server Error","server_error");this.sendJson(r,h.status,{error:{code:h.status,message:h.message,status:h.code||"INTERNAL"}})}return}throw e.method==="POST"&&i.pathname==="/v1/embeddings"?new U(501,"Embeddings are not supported by Copilot.","not_implemented","embeddings_not_supported"):i.pathname.startsWith("/v1/images")?new U(501,"Image generation is not supported by Copilot.","not_implemented","images_not_supported"):i.pathname.startsWith("/v1/audio")?new U(501,"Audio processing is not supported by Copilot.","not_implemented","audio_not_supported"):new U(404,`No route for ${e.method??"UNKNOWN"} ${i.pathname}`,"not_found")}async processStreamingGoogleGenerateContent(e,r,n,o,i,s){let a=[];if(r.systemInstruction){let p=r.systemInstruction.parts.map(f=>f.text).join(" ");a.push(w.LanguageModelChatMessage.User(this.redactPromptString(p)))}for(let p of r.contents){let f=p.role==="model"?w.LanguageModelChatMessageRole.Assistant:w.LanguageModelChatMessageRole.User,h=p.parts.map(g=>g.text).join(" "),m=this.redactPromptString(h);f===w.LanguageModelChatMessageRole.User?a.push(w.LanguageModelChatMessage.User(m)):a.push(w.LanguageModelChatMessage.Assistant(m))}let c=this.resolveModel(e),u=a.map(p=>typeof p.content=="string"?p.content:p.content.map(f=>"text"in f?f.text:"").join(" ")).join(`
`);o.writeHead(200,{"Content-Type":"application/json","X-HTTP-Content-Type-Options":"nosniff","Transfer-Encoding":"chunked"});let l="",d=new w.CancellationTokenSource;n.on("close",()=>{d.cancel(),console.log(`[Google] Client disconnected, cancelling request ${i||""}`)});try{let p=await w.lm.selectChatModels({vendor:"copilot"});if(!p||p.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let f=p[0],h=await f.sendRequest(a,{},d.token);o.write(`[
`);let m=!0;for await(let $ of h.stream){if(d.token.isCancellationRequested)break;if($ instanceof w.LanguageModelTextPart){l+=$.value,m||o.write(`,
`);let x={candidates:[{content:{role:"model",parts:[{text:$.value}]},finishReason:"STOP",index:0}],usageMetadata:{promptTokenCount:0,candidatesTokenCount:0,totalTokenCount:0}};o.write(JSON.stringify(x)),m=!1}}d.token.isCancellationRequested||(o.write(`
]
`),o.end());let g=0,v=0;try{g=await f.countTokens(u,d.token),v=await f.countTokens(l,d.token)}catch{}i&&this.logRequest(i,"POST",`/v1beta/models/${e}:streamGenerateContent`,200,Date.now()-(s||0),{requestPayload:r,responsePayload:{candidates:[{content:{parts:[{text:l}]}}]},tokensIn:g,tokensOut:v,model:c})}catch(p){if(d.token.isCancellationRequested)return;console.error("Google streaming error:",p);let f=p instanceof U?p:new U(500,p.message||"Internal Server Error","server_error");o.write(JSON.stringify({error:{code:f.status,message:f.message,status:f.code}})),o.end()}finally{d.dispose()}}async processStreamingAnthropicMessages(e,r,n,o,i){let s=[];e.system&&s.push(w.LanguageModelChatMessage.User(this.redactPromptString(e.system)));for(let f of e.messages){let h=f.role==="user"?w.LanguageModelChatMessageRole.User:w.LanguageModelChatMessageRole.Assistant,m=typeof f.content=="string"?f.content:f.content.map(v=>v.text).join(" "),g=this.redactPromptString(m);h===w.LanguageModelChatMessageRole.User?s.push(w.LanguageModelChatMessage.User(g)):s.push(w.LanguageModelChatMessage.Assistant(g))}let a=this.resolveModel(e.model),c=s.map(f=>typeof f.content=="string"?f.content:f.content.map(h=>"text"in h?h.text:"").join(" ")).join(`
`);n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});let u="ant-"+(0,pt.randomUUID)(),l="",d=new w.CancellationTokenSource;r.on("close",()=>{d.cancel(),console.log(`[Anthropic] Client disconnected, cancelling request ${o||""}`)});let p=setInterval(()=>{n.writableEnded||n.write(`: ping

`)},15e3);try{let f=await w.lm.selectChatModels({vendor:"copilot"});if(!f||f.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let h=f[0],m=await h.sendRequest(s,{},d.token);n.write(`event: message_start
data: ${JSON.stringify({type:"message_start",message:{id:u,type:"message",role:"assistant",content:[],model:a,stop_reason:null,stop_sequence:null,usage:{input_tokens:0,output_tokens:0}}})}

`),n.write(`event: content_block_start
data: ${JSON.stringify({type:"content_block_start",index:0,content_block:{type:"text",text:""}})}

`);for await(let $ of m.stream){if(d.token.isCancellationRequested)break;$ instanceof w.LanguageModelTextPart&&(l+=$.value,n.write(`event: content_block_delta
data: ${JSON.stringify({type:"content_block_delta",index:0,delta:{type:"text_delta",text:$.value}})}

`))}d.token.isCancellationRequested||(n.write(`event: content_block_stop
data: ${JSON.stringify({type:"content_block_stop",index:0})}

`),n.write(`event: message_delta
data: ${JSON.stringify({type:"message_delta",delta:{stop_reason:"end_turn",stop_sequence:null},usage:{output_tokens:0}})}

`),n.write(`event: message_stop
data: ${JSON.stringify({type:"message_stop"})}

`),n.end());let g=0,v=0;try{g=await h.countTokens(c,d.token),v=await h.countTokens(l,d.token)}catch{}o&&this.logRequest(o,"POST","/v1/messages",200,Date.now()-(i||0),{requestPayload:e,responsePayload:{id:u,type:"message",content:[{type:"text",text:l}]},tokensIn:g,tokensOut:v,model:a})}catch(f){if(d.token.isCancellationRequested)return;console.error("Anthropic streaming error:",f);let h=f instanceof U?f:new U(500,f.message||"Internal Server Error","server_error");n.write(`event: error
data: ${JSON.stringify({type:"error",error:{type:h.code||"api_error",message:h.message}})}

`),n.end()}finally{clearInterval(p),d.dispose()}}async getAvailableModels(){let e=Math.floor(Date.now()/1e3);return(await w.lm.selectChatModels({vendor:"copilot"})).map(o=>({id:o.id,object:"model",created:e,owned_by:o.vendor||"github-copilot",name:o.name,family:o.family,version:o.version,max_input_tokens:o.maxInputTokens,capabilities:{chat_completion:!0,text_completion:!0,streaming:!0,token_counting:!0}}))}async processStreamingChatCompletion(e,r,n,o,i){let s=this.normalizeChatMessages(e);s=this.redactMessagesContent(s);let a=this.resolveModel(e?.model),c=this.normalizeTools(e?.tools||e?.functions),u=e?.tool_choice||e?.function_call,l=`chatcmpl-${(0,pt.randomUUID)()}`,d=Math.floor(Date.now()/1e3),p="";n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});try{let f=await w.lm.selectChatModels({vendor:"copilot"});if(!f||f.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let h=f[0],m=[];for(let Y of s){let be=typeof Y.content=="string"?Y.content:JSON.stringify(Y.content);switch(Y.role){case"system":m.push(w.LanguageModelChatMessage.User(`[System]: ${be}`));break;case"user":m.push(w.LanguageModelChatMessage.User(be));break;case"assistant":if(Y.tool_calls&&Y.tool_calls.length>0){let or=Y.tool_calls.map(br=>`[Called function: ${br.function?.name||br.name}(${br.function?.arguments||JSON.stringify(br.arguments)})]`).join(`
`);m.push(w.LanguageModelChatMessage.Assistant(or))}else m.push(w.LanguageModelChatMessage.Assistant(be));break;case"tool":let We=`[Tool result for ${Y.tool_call_id||"unknown"}]: ${be}`;m.push(w.LanguageModelChatMessage.User(We));break;default:m.push(w.LanguageModelChatMessage.User(be))}}let g={};c&&c.length>0&&(g.tools=c,u==="required"||u==="any"?g.toolMode=w.LanguageModelChatToolMode.Required:g.toolMode=w.LanguageModelChatToolMode.Auto);let v=await h.sendRequest(m,g,new w.CancellationTokenSource().token),$=[],x=0;for await(let Y of v.stream)if(Y instanceof w.LanguageModelTextPart){p+=Y.value;let be={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{content:Y.value},finish_reason:null}]};n.write(`data: ${JSON.stringify(be)}

`)}else if(Y instanceof w.LanguageModelToolCallPart){let be=`call_${(0,pt.randomUUID)().slice(0,24)}`,We=typeof Y.input=="string"?Y.input:JSON.stringify(Y.input);$.push({id:be,name:Y.name,arguments:We});let or={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{tool_calls:[{index:x,id:be,type:"function",function:{name:Y.name,arguments:We}}]},finish_reason:null}]};n.write(`data: ${JSON.stringify(or)}

`),x++}let I=$.length>0?"tool_calls":"stop",k={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{},finish_reason:I}]};n.write(`data: ${JSON.stringify(k)}

`),n.write(`data: [DONE]

`),n.end();let ie=0,se=0;try{let Y=m.map(be=>typeof be.content=="string"?be.content:JSON.stringify(be.content)).join(`
`);ie=await h.countTokens(Y,new w.CancellationTokenSource().token),se=await h.countTokens(p,new w.CancellationTokenSource().token)}catch(Y){console.error("Failed to count tokens:",Y)}o&&i&&this.logRequest(o,"POST","/v1/chat/completions",200,Date.now()-i,{requestPayload:e,responsePayload:{streamed:!0,content_preview:p.slice(0,500),tool_calls:$},model:e?.model,requestHeaders:r.headers,responseHeaders:n.getHeaders(),tokensIn:ie,tokensOut:se})}catch(f){let h={error:{message:f instanceof Error?f.message:"Unknown error",type:"server_error"}};n.write(`data: ${JSON.stringify(h)}

`),n.end(),o&&i&&this.logRequest(o,"POST","/v1/chat/completions",500,Date.now()-i,{requestPayload:e,error:f instanceof Error?f.message:String(f),model:e?.model,requestHeaders:r.headers})}}async processTokenize(e){let r=e?.text||e?.input||"",n=this.resolveModel(e?.model),o=await w.lm.selectChatModels({vendor:"copilot"});if(!o||o.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let s=await o[0].countTokens(r);return{object:"token_count",model:n,token_count:s,text_length:r.length}}async processResponsesApi(e){let r=e?.input,n=[];typeof r=="string"?n=[{role:"user",content:r}]:Array.isArray(r)&&(n=r.map(u=>typeof u=="string"?{role:"user",content:u}:{role:u.role||"user",content:typeof u.content=="string"?u.content:JSON.stringify(u.content)}));let o=this.composePrompt(n);o=this.redactPromptString(o);let i=this.resolveModel(e?.model),s=await this.runWithConcurrency(()=>this.invokeCopilot(o)),a=0,c=0;try{let u=await w.lm.selectChatModels({vendor:"copilot"});if(u&&u.length>0){let l=u[0];a=await l.countTokens(o),c=await l.countTokens(s||"")}}catch(u){console.error("Token counting failed:",u)}return{id:`resp-${(0,pt.randomUUID)()}`,object:"response",created_at:Math.floor(Date.now()/1e3),model:i,output:[{type:"message",id:`msg-${(0,pt.randomUUID)()}`,role:"assistant",content:[{type:"output_text",text:s}]}],usage:{prompt_tokens:a,completion_tokens:c,total_tokens:a+c}}}async processAnthropicMessages(e){let r=[];e.system&&r.push(w.LanguageModelChatMessage.User(this.redactPromptString(e.system)));for(let c of e.messages){let u=c.role==="user"?w.LanguageModelChatMessageRole.User:w.LanguageModelChatMessageRole.Assistant,l=typeof c.content=="string"?c.content:c.content.map(p=>p.text).join(" "),d=this.redactPromptString(l);u===w.LanguageModelChatMessageRole.User?r.push(w.LanguageModelChatMessage.User(d)):r.push(w.LanguageModelChatMessage.Assistant(d))}let n=this.resolveModel(e.model),o=r.map(c=>typeof c.content=="string"?c.content:c.content.map(u=>"text"in u?u.text:"").join(" ")).join(`
`),i=await this.runWithConcurrency(()=>this.invokeCopilot(o)),s=0,a=0;try{let c=r.map(l=>l.content).join(" "),u=await w.lm.selectChatModels({vendor:"copilot"});if(u&&u.length>0){let l=u[0];s=await l.countTokens(c),a=await l.countTokens(i||"")}}catch(c){console.error("Anthropic token counting failed:",c)}return{id:"ant-"+(0,pt.randomUUID)(),type:"message",role:"assistant",content:[{type:"text",text:i||""}],model:n,stop_reason:"end_turn",stop_sequence:null,usage:{input_tokens:s,output_tokens:a}}}async processGoogleGenerateContent(e,r){let n=[];if(r.systemInstruction){let u=r.systemInstruction.parts.map(l=>l.text).join(" ");n.push(w.LanguageModelChatMessage.User(this.redactPromptString(u)))}for(let u of r.contents){let l=u.role==="model"?w.LanguageModelChatMessageRole.Assistant:w.LanguageModelChatMessageRole.User,d=u.parts.map(f=>f.text).join(" "),p=this.redactPromptString(d);l===w.LanguageModelChatMessageRole.User?n.push(w.LanguageModelChatMessage.User(p)):n.push(w.LanguageModelChatMessage.Assistant(p))}let o=this.resolveModel(e),i=n.map(u=>typeof u.content=="string"?u.content:u.content.map(l=>"text"in l?l.text:"").join(" ")).join(`
`),s=await this.runWithConcurrency(()=>this.invokeCopilot(i)),a=0,c=0;try{let u=n.map(d=>d.content).join(" "),l=await w.lm.selectChatModels({vendor:"copilot"});if(l&&l.length>0){let d=l[0];a=await d.countTokens(u),c=await d.countTokens(s||"")}}catch(u){console.error("Google token counting failed:",u)}return{candidates:[{content:{role:"model",parts:[{text:s||""}]},finishReason:"STOP",index:0}],usageMetadata:{promptTokenCount:a,candidatesTokenCount:c,totalTokenCount:a+c}}}async processChatCompletion(e,r){let n=this.normalizeChatMessages(e);n=this.injectSystemPrompt(n),n=this.redactMessagesContent(n);let o=this.resolveModel(e?.model),i=this.normalizeTools(e?.tools||e?.functions)||[],a=(await this.mcpService.getAllTools()).map(v=>({name:`mcp_${v.serverName}_${v.name}`,description:v.description||`Tool from MCP server ${v.serverName}`,inputSchema:v.inputSchema})),c=[...i,...a],u=e?.tool_choice||e?.function_call;if(e?.response_format?.type==="json_object"){let v=n.map($=>$.role).lastIndexOf("user");if(v>=0){let $=n[v].content;n[v]={...n[v],content:`${$}

IMPORTANT: You MUST respond with valid JSON only.No markdown, no explanation, just pure JSON.`}}}let d=0,p=5,f;for(;d<p;){if(f=await this.runWithConcurrency(()=>this.invokeCopilotWithTools(n,c,u)),f.toolCalls&&f.toolCalls.length>0){let v=f.toolCalls.filter($=>$.name.startsWith("mcp_"));if(v.length>0){n.push({role:"assistant",content:f.content||null,tool_calls:f.toolCalls.map($=>({id:`call_${(0,pt.randomUUID)().slice(0,24)}`,type:"function",function:{name:$.name,arguments:typeof $.arguments=="string"?$.arguments:JSON.stringify($.arguments)}}))});for(let $ of v){let x=$.name.split("_"),I=x[1],k=x.slice(2).join("_");try{let ie=await this.mcpService.callTool(I,k,$.arguments);n.push({role:"tool",tool_call_id:`call_${(0,pt.randomUUID)().slice(0,24)}`,content:JSON.stringify(ie)})}catch(ie){n.push({role:"tool",tool_call_id:`call_${(0,pt.randomUUID)().slice(0,24)}`,content:`Error executing MCP tool: ${ie.message}`})}}d++;continue}}break}let h=Math.floor(Date.now()/1e3),m=0,g=0;try{let v=await w.lm.selectChatModels({vendor:"copilot"});if(v&&v.length>0){let $=v[0],x=n.map(ie=>typeof ie.content=="string"?ie.content:JSON.stringify(ie.content)).join(`
`);m=await $.countTokens(x);let I=f.content||"",k=f.toolCalls?JSON.stringify(f.toolCalls):"";g=await $.countTokens(I+k)}}catch(v){console.error("Token counting failed:",v)}return f.toolCalls&&f.toolCalls.length>0?{id:`chatcmpl- ${(0,pt.randomUUID)()}`,object:"chat.completion",created:h,model:o,choices:[{index:0,message:{role:"assistant",content:f.content||null,tool_calls:f.toolCalls.map((v,$)=>({id:`call_${(0,pt.randomUUID)().slice(0,24)}`,type:"function",function:{name:v.name,arguments:typeof v.arguments=="string"?v.arguments:JSON.stringify(v.arguments)}}))},finish_reason:"tool_calls"}],usage:{prompt_tokens:m,completion_tokens:g,total_tokens:m+g},system_fingerprint:null}:{id:`chatcmpl - ${(0,pt.randomUUID)()}`,object:"chat.completion",created:h,model:o,choices:[{index:0,message:{role:"assistant",content:f.content},finish_reason:"stop"}],usage:{prompt_tokens:m,completion_tokens:g,total_tokens:m+g},system_fingerprint:null}}normalizeTools(e){if(!(!e||!Array.isArray(e)||e.length===0))return e.map(r=>{let n=r.type==="function"?r.function:r;return{name:n.name,description:n.description||"",inputSchema:n.parameters||n.inputSchema||void 0}})}async invokeCopilotWithTools(e,r,n){let o=await this.getCopilotHealth();if(!o.installed)throw new U(503,"GitHub Copilot extension is not installed.","service_unavailable","copilot_not_installed");if(!o.chatInstalled)throw new U(503,"GitHub Copilot Chat extension is not installed.","service_unavailable","copilot_chat_not_installed");if(!o.signedIn)throw new U(401,"Not signed in to GitHub Copilot. Please sign in in VS Code.","unauthorized","copilot_not_signed_in");let i=await w.lm.selectChatModels({vendor:"copilot"});if(!i||i.length===0)throw new U(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let s=i[0],a=[];for(let d of e){let p=typeof d.content=="string"?d.content:JSON.stringify(d.content);switch(d.role){case"system":a.push(w.LanguageModelChatMessage.User(`[System]: ${p}`));break;case"user":a.push(w.LanguageModelChatMessage.User(p));break;case"assistant":if(d.tool_calls&&d.tool_calls.length>0){let h=d.tool_calls.map(m=>`[Called function: $ { tc.function?.name || tc.name }(${m.function?.arguments||JSON.stringify(m.arguments)})]`).join(`
`);a.push(w.LanguageModelChatMessage.Assistant(h))}else a.push(w.LanguageModelChatMessage.Assistant(p));break;case"tool":let f=`[Tool result for ${d.tool_call_id||"unknown"}]: ${p} `;a.push(w.LanguageModelChatMessage.User(f));break;default:a.push(w.LanguageModelChatMessage.User(p))}}let c={};r&&r.length>0&&(c.tools=r,n==="required"||n==="any"?c.toolMode=w.LanguageModelChatToolMode.Required:c.toolMode=w.LanguageModelChatToolMode.Auto);let u=new w.CancellationTokenSource,l=setTimeout(()=>u.cancel(),(this.config.requestTimeoutSeconds||180)*1e3);try{let d=await s.sendRequest(a,c,u.token),p="",f=[];for await(let h of d.stream){if(u.token.isCancellationRequested)throw new U(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout");h instanceof w.LanguageModelTextPart?p+=h.value:h instanceof w.LanguageModelToolCallPart&&f.push({name:h.name,arguments:h.input})}return{content:p.trim(),toolCalls:f.length>0?f:void 0}}catch(d){throw d instanceof U?d:u.token.isCancellationRequested?new U(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout"):new U(502,`Failed to retrieve Copilot response: ${Rn(d)} `,"bad_gateway","command_failed",{cause:d})}finally{clearTimeout(l),u.dispose()}}async processCompletion(e){let r=this.normalizePromptInput(e?.prompt);if(!r)throw new U(400,"prompt is required","invalid_request_error","missing_prompt");r=this.redactPromptString(r);let n=this.resolveModel(e?.model),o=await this.runWithConcurrency(()=>this.invokeCopilot(r)),i=Math.floor(Date.now()/1e3),s=0,a=0;try{let c=await w.lm.selectChatModels({vendor:"copilot"});if(c&&c.length>0){let u=c[0],l=r;s=await u.countTokens(l);let d=o||"";a=await u.countTokens(d)}}catch(c){console.error("Token counting failed:",c)}return{id:`cmpl - ${(0,pt.randomUUID)()} `,object:"text_completion",created:i,model:n,choices:[{index:0,text:o,finish_reason:"stop",logprobs:null}],usage:{prompt_tokens:s,completion_tokens:a,total_tokens:s+a}}}async handleWebSocketMessage(e,r){let n=typeof r=="string"?r:r.toString("utf8"),o;try{o=JSON.parse(n)}catch{throw new U(400,"WebSocket payload must be valid JSON.","invalid_request_error","invalid_json")}let i=o?.type??o?.event??o?.action;if(i==="ping"){e.send(JSON.stringify({type:"pong",timestamp:Date.now()}));return}if(!i||i==="chat.completions.create"){let s=o?.data??o?.request??o,a=await this.processChatCompletion(s,{source:"websocket",endpoint:"/v1/chat/completions"});e.send(JSON.stringify({type:"chat.completion.result",data:a}));return}if(i==="completions.create"){let s=o?.data??o?.request??o,a=await this.processCompletion(s);e.send(JSON.stringify({type:"completion.result",data:a}));return}throw new U(400,`Unsupported message type: ${i} `,"invalid_request_error","unsupported_ws_message")}handleWebSocketConnection(e){e.send(JSON.stringify({type:"session.created",session:{id:(0,pt.randomUUID)(),model:this.config.defaultModel,created:Math.floor(Date.now()/1e3)}})),e.on("message",r=>{this.handleWebSocketMessage(e,r).catch(n=>{n instanceof U?this.sendWsError(e,n):(this.logError("Unhandled WebSocket error",n),this.sendWsError(e,new U(500,"An unexpected error occurred.","server_error")))})}),e.on("error",r=>{this.logError("WebSocket client error",r)})}async runWithConcurrency(e){if(this.activeRequests>=this.config.maxConcurrentRequests)throw new U(429,"Too many concurrent requests. Try again shortly.","rate_limit_exceeded","concurrency_limit");this.activeRequests+=1;try{return await e()}finally{this.activeRequests-=1}}async invokeCopilot(e){let r=await w.lm.selectChatModels({vendor:"copilot"});if(!r||r.length===0)throw new U(503,"No Copilot language model available. Make sure GitHub Copilot is installed and signed in.","service_unavailable","copilot_unavailable");let n=r[0],o=[w.LanguageModelChatMessage.User(e)],i=new w.CancellationTokenSource,s=setTimeout(()=>i.cancel(),(this.config.requestTimeoutSeconds||180)*1e3);try{let a=await n.sendRequest(o,{},i.token),c="";for await(let u of a.text){if(i.token.isCancellationRequested)throw new U(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout");c+=u}if(!c.trim())throw new U(502,"Copilot did not return any content.","bad_gateway","empty_response");return c.trim()}catch(a){throw a instanceof U?a:i.token.isCancellationRequested?new U(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout"):new U(502,`Failed to retrieve Copilot response: ${Rn(a)} `,"bad_gateway","command_failed",{cause:a})}finally{clearTimeout(s),i.dispose()}}extractTextFromChatResult(e){if(e){if(typeof e=="string")return e.trim()||void 0;if(Array.isArray(e))return e.map(r=>typeof r=="string"?r:"").join(" ").trim()||void 0;if(typeof e=="object"){let r=e,n=r.response??r.result??r.body;if(typeof n=="string")return n.trim()||void 0;if(n&&typeof n=="object"){let o=n.text??n.message;if(typeof o=="string"&&o.trim())return o.trim();let i=n.responseContent;if(Array.isArray(i)){let s=i.map(a=>typeof a=="string"?a:a&&typeof a=="object"&&typeof a.text=="string"?String(a.text):"").join("").trim();if(s)return s}}if(Array.isArray(r.choices)&&r.choices.length>0){let o=r.choices[0];if(typeof o?.text=="string"&&o.text.trim())return o.text.trim();let i=o?.message;if(i&&typeof i.content=="string"&&i.content.trim())return i.content.trim()}}}}normalizeChatMessages(e){let r=e?.messages;if(Array.isArray(r)&&r.length>0)return r.map((o,i)=>({role:typeof o?.role=="string"?o.role:i===r.length-1?"user":"system",content:o?.content,tool_calls:o?.tool_calls,tool_call_id:o?.tool_call_id}));let n=this.normalizePromptInput(e?.prompt??e?.input);if(n)return[{role:"user",content:n}];throw new U(400,"messages must be a non-empty array or prompt must be provided.","invalid_request_error","missing_messages")}normalizePromptInput(e){if(typeof e=="string")return e.trim()||void 0;if(Array.isArray(e))return e.map(n=>typeof n=="string"?n:"").join(`
`).trim()||void 0}composePrompt(e){return e.map(({role:r,content:n})=>{let o=r||"user",i=this.flattenMessageContent(n);return`[${o}]
${i} `}).join(`

`)}flattenMessageContent(e){return typeof e=="string"?e:e==null?"":Array.isArray(e)?e.map(r=>typeof r=="string"?r:r&&typeof r=="object"&&typeof r.text=="string"?String(r.text):"").join(`
`):String(e)}resolveModel(e){if(typeof e=="string"&&e.trim()){let r=e.trim().toLowerCase(),n=t9[r];return n||e.trim()}return this.config.defaultModel}injectSystemPrompt(e){return!this.config.defaultSystemPrompt||e.some(n=>n.role==="system")?e:[{role:"system",content:this.config.defaultSystemPrompt},...e]}async readJsonBody(e){let r=[],n=0;if(await new Promise((i,s)=>{e.on("data",a=>{let c=typeof a=="string"?Buffer.from(a):a;n+=c.length;let u=(this.config.maxPayloadSizeMb||1)*1024*1024;if(n>u){e.destroy(),s(new U(413,`Request body too large.Maximum size is ${Math.round(u/1024)} KB.`,"invalid_request_error","payload_too_large"));return}r.push(c)}),e.on("end",()=>i()),e.on("error",a=>s(a))}),r.length===0)return{};let o=Buffer.concat(r).toString("utf8");if(!o.trim())return{};try{return JSON.parse(o)}catch(i){throw new U(400,"Request body must be valid JSON.","invalid_request_error","invalid_json",{cause:i})}}sendJson(e,r,n){e.headersSent||(e.statusCode=r,e.setHeader("Content-Type","application/json")),e.end(JSON.stringify(n))}sendSwaggerUi(e){let r=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot API - Swagger UI</title>
    <link rel="stylesheet" href="/swagger-ui/swagger-ui.css">
    <style>
        body { margin: 0; background: #fafafa; }
        .swagger-ui .topbar { display: none; }
        .swagger-ui .info { margin: 30px 0; }
        .swagger-ui .info .title { font-size: 2em; }
    </style>
</head>
<body>
    <div id="swagger-ui"></div>
    <script src="/swagger-ui/swagger-ui-bundle.js"></script>
    <script src="/swagger-ui/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function() {
            SwaggerUIBundle({
                url: '/openapi.json',
                dom_id: '#swagger-ui',
                presets: [SwaggerUIBundle.presets.apis, SwaggerUIBundle.SwaggerUIStandalonePreset],
                layout: 'BaseLayout',
                deepLinking: true,
                showExtensions: true,
                showCommonExtensions: true
            });
        };
    </script>
</body>
</html>`;e.statusCode=200,e.setHeader("Content-Type","text/html"),e.end(r)}serveStaticFile(e,r,n){let o=$t.basename(n),i=[];if(this.context)try{i.push(this.context.asAbsolutePath($t.join("dist","swagger-ui",o)))}catch{}i.push($t.join(__dirname,"swagger-ui",o),$t.join(__dirname,"..","swagger-ui",o),$t.join(__dirname,"dist","swagger-ui",o));let s="";for(let a of i)if(Nt.existsSync(a)){s=a;break}if(s){let a=Nt.statSync(s),c=$t.extname(s),u="text/plain";c===".css"?u="text/css":c===".js"&&(u="application/javascript"),r.writeHead(200,{"Content-Type":u,"Content-Length":a.size}),Nt.createReadStream(s).pipe(r)}else{let a=`[Static] File not found: ${o}. Checked: ${JSON.stringify(i)}`;if(console.error(a),this.output.appendLine(`[${new Date().toISOString()}] ERROR ${a}`),this.context)try{let c=this.context.asAbsolutePath($t.join("dist","swagger-ui"));Nt.existsSync(c)?this.output.appendLine(`Contents of ${c}: ${Nt.readdirSync(c).join(", ")}`):this.output.appendLine(`Directory not found: ${c}`)}catch(c){this.output.appendLine(`Error listing directory: ${c}`)}r.statusCode=404,r.end("Not found")}}sendDebugPaths(e){let r={dirname:__dirname,cwd:process.cwd(),contextExtensionUri:this.context?.extensionUri.fsPath??"undefined",candidates_css:[],dist_swagger_contents:"N/A"},n="swagger-ui.css",o=[];if(this.context)try{let i=this.context.asAbsolutePath($t.join("dist","swagger-ui",n)),s=$t.dirname(i),a="N/A";Nt.existsSync(s)&&(a=Nt.readdirSync(s).join(", ")),o.push({type:"context.asAbsolutePath",path:i,exists:Nt.existsSync(i),dir_exists:Nt.existsSync(s),dir_contents:a}),r.dist_swagger_contents=a}catch(i){o.push({error:String(i)})}o.push({type:"fallback_dirname",path:$t.join(__dirname,"swagger-ui",n),exists:Nt.existsSync($t.join(__dirname,"swagger-ui",n))}),r.candidates_css=o,e.statusCode=200,e.setHeader("Content-Type","application/json"),e.end(JSON.stringify(r,null,2))}getOpenApiSpec(){let e=`http://${this.config.host}:${this.config.port}`;return{openapi:"3.1.0",info:{title:"Copilot API Gateway",description:"Local OpenAI-compatible API server powered by GitHub Copilot. Provides REST and WebSocket endpoints for chat completions, text completions, tokenization, and more.",version:"1.0.0",contact:{name:"GitHub Copilot API VS Code Extension"},license:{name:"MIT"}},servers:[{url:e,description:"Local Copilot API Server"}],tags:[{name:"Chat",description:"Chat completion endpoints"},{name:"Completions",description:"Text completion endpoints"},{name:"Anthropic",description:"Anthropic Messages API compatible endpoints"},{name:"Google",description:"Google Generative AI API compatible endpoints"},{name:"Models",description:"Model information"},{name:"Utilities",description:"Utility endpoints"}],paths:{"/v1/chat/completions":{post:{tags:["Chat"],summary:"Create chat completion",description:"Creates a chat completion for the given messages. Supports streaming, function calling (tools), JSON mode, and more.",operationId:"createChatCompletion",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ChatCompletionRequest"},examples:{basic:{summary:"Basic chat",value:{model:this.config.defaultModel,messages:[{role:"user",content:"Hello!"}]}},streaming:{summary:"Streaming response",value:{model:this.config.defaultModel,messages:[{role:"user",content:"Tell me a story"}],stream:!0}},tools:{summary:"With tools/functions",value:{model:this.config.defaultModel,messages:[{role:"user",content:"What is the weather?"}],tools:[{type:"function",function:{name:"get_weather",description:"Get weather for a location",parameters:{type:"object",properties:{location:{type:"string"}},required:["location"]}}}]}}}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/ChatCompletionResponse"}},"text/event-stream":{description:"Server-sent events for streaming responses"}}},400:{description:"Bad request",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},401:{description:"Unauthorized",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},429:{description:"Rate limited",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/completions":{post:{tags:["Completions"],summary:"Create text completion",description:"Creates a text completion for the given prompt.",operationId:"createCompletion",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/CompletionRequest"},example:{model:this.config.defaultModel,prompt:"Once upon a time",max_tokens:100}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/CompletionResponse"}}}},400:{description:"Bad request"},401:{description:"Unauthorized"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/responses":{post:{tags:["Chat"],summary:"Create response (simplified API)",description:"Simplified OpenAI Responses API format for easier integration.",operationId:"createResponse",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ResponsesRequest"},example:{model:this.config.defaultModel,input:"What is 2+2?"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/ResponsesResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/models":{get:{tags:["Models"],summary:"List models",description:"Lists all available models from GitHub Copilot.",operationId:"listModels",responses:{200:{description:"List of models",content:{"application/json":{schema:{$ref:"#/components/schemas/ModelList"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/models/{model_id}":{get:{tags:["Models"],summary:"Get model",description:"Retrieves details about a specific model.",operationId:"getModel",parameters:[{name:"model_id",in:"path",required:!0,schema:{type:"string"},description:"The ID of the model"}],responses:{200:{description:"Model details",content:{"application/json":{schema:{$ref:"#/components/schemas/Model"}}}},404:{description:"Model not found"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/tokenize":{post:{tags:["Utilities"],summary:"Count tokens",description:"Counts the number of tokens in the given text.",operationId:"tokenize",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/TokenizeRequest"},example:{model:this.config.defaultModel,text:"Hello, world!"}}}},responses:{200:{description:"Token count",content:{"application/json":{schema:{$ref:"#/components/schemas/TokenizeResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/usage":{get:{tags:["Utilities"],summary:"Get usage statistics",description:"Returns usage statistics including request counts, token usage, and uptime.",operationId:"getUsage",responses:{200:{description:"Usage statistics",content:{"application/json":{schema:{$ref:"#/components/schemas/UsageResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/messages":{post:{tags:["Anthropic"],summary:"Anthropic Messages API",description:"Create a message using the Anthropic-compatible API format.",operationId:"anthropicMessages",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/AnthropicMessageRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/AnthropicMessageResponse"}},"text/event-stream":{description:"Anthropic-style event stream"}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1beta/models/{model}:generateContent":{post:{tags:["Google"],summary:"Google Generative AI generateContent",description:"Generate content using the Google-compatible API format.",operationId:"googleGenerateContent",parameters:[{name:"model",in:"path",required:!0,schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1beta/models/{model}:streamGenerateContent":{post:{tags:["Google"],summary:"Google Generative AI streamGenerateContent",description:"Stream content generation using the Google-compatible API format.",operationId:"googleStreamGenerateContent",parameters:[{name:"model",in:"path",required:!0,schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/GoogleGenerateContentResponse"}}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/health":{get:{tags:["Utilities"],summary:"Health check",description:"Simple health check endpoint for monitoring.",operationId:"healthCheck",responses:{200:{description:"Service is healthy",content:{"application/json":{schema:{type:"object",properties:{status:{type:"string",example:"ok"},service:{type:"string",example:"github-copilot-api-vscode"}}}}}}}}}},components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer",description:"API key authentication (optional, configure in extension settings)"}},schemas:{ChatCompletionRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string",description:"Model ID to use",example:this.config.defaultModel},messages:{type:"array",items:{$ref:"#/components/schemas/Message"},description:"List of messages in the conversation"},stream:{type:"boolean",default:!1,description:"Enable streaming responses"},temperature:{type:"number",minimum:0,maximum:2,description:"Sampling temperature"},max_tokens:{type:"integer",description:"Maximum tokens to generate"},tools:{type:"array",items:{$ref:"#/components/schemas/Tool"},description:"List of tools/functions available"},tool_choice:{type:"string",description:"How to select tools: auto, none, or specific"},response_format:{type:"object",properties:{type:{type:"string",enum:["text","json_object"]}},description:"Response format (json_object for JSON mode)"}}},Message:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["system","user","assistant","tool"],description:"Role of the message sender"},content:{type:"string",description:"Message content"},name:{type:"string",description:"Name of the sender (optional)"},tool_calls:{type:"array",items:{$ref:"#/components/schemas/ToolCall"}},tool_call_id:{type:"string",description:"ID of tool call this message responds to"}}},Tool:{type:"object",required:["type","function"],properties:{type:{type:"string",enum:["function"]},function:{type:"object",required:["name"],properties:{name:{type:"string"},description:{type:"string"},parameters:{type:"object",description:"JSON Schema for function parameters"}}}}},ToolCall:{type:"object",properties:{id:{type:"string"},type:{type:"string",enum:["function"]},function:{type:"object",properties:{name:{type:"string"},arguments:{type:"string"}}}}},ChatCompletionResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"chat.completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{index:{type:"integer"},message:{$ref:"#/components/schemas/Message"},finish_reason:{type:"string",enum:["stop","length","tool_calls"]}}}},usage:{$ref:"#/components/schemas/Usage"}}},CompletionRequest:{type:"object",required:["model","prompt"],properties:{model:{type:"string"},prompt:{type:"string",description:"Text prompt to complete"},max_tokens:{type:"integer",default:100},temperature:{type:"number"}}},CompletionResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"text_completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{text:{type:"string"},index:{type:"integer"},finish_reason:{type:"string"}}}},usage:{$ref:"#/components/schemas/Usage"}}},ResponsesRequest:{type:"object",required:["input"],properties:{model:{type:"string"},input:{type:"string",description:"User input/question"},instructions:{type:"string",description:"System instructions"}}},ResponsesResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string"},created_at:{type:"integer"},output:{type:"array",items:{type:"object",properties:{type:{type:"string"},content:{type:"array",items:{type:"object",properties:{type:{type:"string"},text:{type:"string"}}}}}}},usage:{$ref:"#/components/schemas/Usage"}}},TokenizeRequest:{type:"object",required:["text"],properties:{model:{type:"string"},text:{type:"string",description:"Text to tokenize"}}},TokenizeResponse:{type:"object",properties:{model:{type:"string"},token_count:{type:"integer"}}},ModelList:{type:"object",properties:{object:{type:"string",example:"list"},data:{type:"array",items:{$ref:"#/components/schemas/Model"}}}},Model:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"model"},created:{type:"integer"},owned_by:{type:"string"}}},UsageResponse:{type:"object",properties:{object:{type:"string",example:"usage"},total_requests:{type:"integer"},total_tokens:{type:"object",properties:{input:{type:"integer"},output:{type:"integer"},total:{type:"integer"}}},uptime_seconds:{type:"integer"},active_requests:{type:"integer"}}},Usage:{type:"object",properties:{prompt_tokens:{type:"integer"},completion_tokens:{type:"integer"},total_tokens:{type:"integer"}}},Error:{type:"object",properties:{error:{type:"object",properties:{message:{type:"string"},type:{type:"string"},code:{type:"string"}}}}},AnthropicMessageRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string"},messages:{type:"array",items:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["user","assistant"]},content:{type:"string"}}}},system:{type:"string"},max_tokens:{type:"integer"},stream:{type:"boolean"}}},AnthropicMessageResponse:{type:"object",properties:{id:{type:"string"},type:{type:"string",example:"message"},role:{type:"string",example:"assistant"},content:{type:"array",items:{type:"object",properties:{type:{type:"string",example:"text"},text:{type:"string"}}}},model:{type:"string"},stop_reason:{type:"string"},usage:{type:"object",properties:{input_tokens:{type:"integer"},output_tokens:{type:"integer"}}}}},GoogleGenerateContentRequest:{type:"object",required:["contents"],properties:{contents:{type:"array",items:{type:"object",required:["parts"],properties:{role:{type:"string",enum:["user","model"]},parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}}},systemInstruction:{type:"object",properties:{parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}},generationConfig:{type:"object"}}},GoogleGenerateContentResponse:{type:"object",properties:{candidates:{type:"array",items:{type:"object",properties:{content:{type:"object",properties:{role:{type:"string"},parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}},finishReason:{type:"string"}}}},usageMetadata:{type:"object",properties:{promptTokenCount:{type:"integer"},candidatesTokenCount:{type:"integer"},totalTokenCount:{type:"integer"}}}}}}}}}sendError(e,r){let n=r.status??500,o={error:{message:r.message,type:r.type,code:r.code??null,param:null}};this.sendJson(e,n,o)}sendWsError(e,r){e.send(JSON.stringify({type:"error",error:{message:r.message,type:r.type,code:r.code??null}}))}setCorsHeaders(e){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Headers","authorization, content-type, x-requested-with"),e.setHeader("Access-Control-Allow-Methods","GET,POST,OPTIONS")}checkRateLimit(){if(this.config.rateLimitPerMinute<=0)return!0;let e=Date.now(),r=e-6e4;return this.rateLimitBucket=this.rateLimitBucket.filter(n=>n>r),this.rateLimitBucket.length>=this.config.rateLimitPerMinute?!1:(this.rateLimitBucket.push(e),!0)}getClientIp(e){let r=e.headers["x-forwarded-for"];if(r){let i=(typeof r=="string"?r:r[0])?.split(",")[0]?.trim();if(i)return i}let n=e.socket.remoteAddress||"unknown";return n.startsWith("::ffff:")?n.substring(7):n}checkIpAllowlist(e){let r=this.config.ipAllowlist;if(!r||r.length===0)return!0;let n=e.socket.remoteAddress;if(!n)return!1;let o=n.startsWith("::ffff:")?n.substring(7):n;for(let i of r)if(i.includes("/")){if(this.isIpInCidr(o,i))return!0}else if(/^[\d\.]+$|^[\da-fA-F:]+$/.test(i)){if(i===o)return!0}else{let s=this.domainCache.get(i);if(s&&s.includes(o))return!0}return!1}async refreshDomainCache(){let e=await import("dns").then(r=>r.promises);for(let r of this.config.ipAllowlist)if(/[a-zA-Z]/.test(r)&&!r.includes("/"))try{let n=await e.resolve4(r).catch(()=>[]),o=await e.resolve6(r).catch(()=>[]),i=[...n,...o];i.length>0&&this.domainCache.set(r,i)}catch{}}isIpInCidr(e,r){try{let[n,o]=r.split("/"),i=~(2**(32-parseInt(o,10))-1),s=e.split(".").map(Number),a=n.split(".").map(Number),c=s[0]<<24|s[1]<<16|s[2]<<8|s[3],u=a[0]<<24|a[1]<<16|a[2]<<8|a[3];return(c&i)===(u&i)}catch{return!1}}logRequest(e,r,n,o,i,s){let a=o>=400,c=s?.tokensIn??0,u=s?.tokensOut??0;this.recordRequestStats(i,c,u,a);let l={timestamp:new Date().toISOString(),requestId:e,method:r,path:n,status:o,durationMs:i,tokensIn:s?.tokensIn,tokensOut:s?.tokensOut,error:s?.error,model:s?.model,requestBody:s?.requestPayload,responseBody:s?.responsePayload,requestHeaders:s?.requestHeaders,responseHeaders:s?.responseHeaders},d=this.redactSensitiveData(l);if(this.auditService.logRequest(d),this._onDidLogRequest.fire(d),this.wsServer){let p=JSON.stringify({type:"log",data:d});this.wsServer.clients.forEach(f=>{f.readyState===1&&f.send(p)})}if(this.config.enableLogging){let p=a?"\u274C":o>=300?"\u26A0\uFE0F":"\u2705";this.output.appendLine(`[${new Date().toLocaleTimeString()}] ${p} ${r} ${n} ${o} (${i}ms)`),s?.error&&this.output.appendLine(`  Error: ${s.error}`)}}getCacheKey(e){return JSON.stringify({model:e?.model,messages:e?.messages,prompt:e?.prompt,tools:e?.tools,stream:e?.stream})}getFromCache(e){let r=this.requestCache.get(e);if(r&&Date.now()-r.timestamp<this.CACHE_TTL_MS)return r.response;this.requestCache.delete(e)}setCache(e,r){if(this.requestCache.size>100){let n=Date.now();for(let[o,i]of this.requestCache.entries())n-i.timestamp>this.CACHE_TTL_MS&&this.requestCache.delete(o)}this.requestCache.set(e,{response:r,timestamp:Date.now()})}buildUrl(e){let r=`http://${this.config.host}:${this.config.port}`;return new URL(e??"/",r)}async updateServerConfig(e){this.config={...this.config,...e},this._onDidChangeStatus.fire();let r=w.workspace.getConfiguration("githubCopilotApi"),n=[];e.enabled!==void 0&&n.push(Promise.resolve(r.update("server.enabled",e.enabled,w.ConfigurationTarget.Global))),e.enableHttp!==void 0&&n.push(Promise.resolve(r.update("server.enableHttp",e.enableHttp,w.ConfigurationTarget.Global))),e.enableWebSocket!==void 0&&n.push(Promise.resolve(r.update("server.enableWebSocket",e.enableWebSocket,w.ConfigurationTarget.Global))),e.host!==void 0&&n.push(Promise.resolve(r.update("server.host",e.host,w.ConfigurationTarget.Global))),e.port!==void 0&&n.push(Promise.resolve(r.update("server.port",e.port,w.ConfigurationTarget.Global))),e.maxConcurrentRequests!==void 0&&n.push(Promise.resolve(r.update("server.maxConcurrentRequests",e.maxConcurrentRequests,w.ConfigurationTarget.Global))),e.defaultModel!==void 0&&n.push(Promise.resolve(r.update("server.defaultModel",e.defaultModel,w.ConfigurationTarget.Global))),e.enableLogging!==void 0&&n.push(Promise.resolve(r.update("server.enableLogging",e.enableLogging,w.ConfigurationTarget.Global))),e.apiKey!==void 0&&n.push(Promise.resolve(r.update("server.apiKey",e.apiKey,w.ConfigurationTarget.Global))),e.rateLimitPerMinute!==void 0&&n.push(Promise.resolve(r.update("server.rateLimitPerMinute",e.rateLimitPerMinute,w.ConfigurationTarget.Global))),e.requestTimeoutSeconds!==void 0&&n.push(Promise.resolve(r.update("server.requestTimeoutSeconds",e.requestTimeoutSeconds,w.ConfigurationTarget.Global))),e.maxPayloadSizeMb!==void 0&&n.push(Promise.resolve(r.update("server.maxPayloadSizeMb",e.maxPayloadSizeMb,w.ConfigurationTarget.Global))),e.maxConnectionsPerIp!==void 0&&n.push(Promise.resolve(r.update("server.maxConnectionsPerIp",e.maxConnectionsPerIp,w.ConfigurationTarget.Global))),e.redactionPatterns!==void 0&&n.push(Promise.resolve(r.update("server.redactionPatterns",e.redactionPatterns,w.ConfigurationTarget.Global))),e.ipAllowlist!==void 0&&n.push(Promise.resolve(r.update("server.ipAllowlist",e.ipAllowlist,w.ConfigurationTarget.Global))),this.suppressRestart=!0;try{await Promise.all(n)}finally{this.suppressRestart=!1}await this.restart()}updateStatusBar(e,r){let n=`${this.config.enableHttp?"HTTP":""}${this.config.enableHttp&&this.config.enableWebSocket?"+":""}${this.config.enableWebSocket?"WS":""}`||"disabled";if(e==="starting"){this.statusItem.text="$(broadcast) Copilot API: Starting\u2026",this.statusItem.tooltip="Starting Copilot API gateway",this.statusItem.show();return}if(e==="running"){this.statusItem.text=`$(broadcast) Copilot API: On (${n})`;let o=`${this.config.host}:${this.config.port}`;this.statusItem.tooltip=r||`Copilot API is running on ${o}`,this.statusItem.show();return}this.statusItem.text="$(broadcast) Copilot API: Off",this.statusItem.tooltip=r??"Copilot API gateway is stopped",this.statusItem.hide()}async showControlPalette(){let e=w.workspace.getConfiguration("githubCopilotApi"),r=[{label:"$(check) Start HTTP + WebSocket",description:"Enable and start all endpoints"},{label:"$(primitive-square) Stop Server",description:"Disable all endpoints"},{label:`${this.config.enableHttp?"$(circle-slash)":"$(play)"} Toggle HTTP`,description:this.config.enableHttp?"Disable HTTP REST endpoints":"Enable HTTP REST endpoints"},{label:`${this.config.enableWebSocket?"$(circle-slash)":"$(play)"} Toggle WebSocket`,description:this.config.enableWebSocket?"Disable WebSocket realtime endpoint":"Enable WebSocket realtime endpoint"},{label:"$(globe) Listen on localhost",description:"Bind to 127.0.0.1"},{label:"$(rss) Listen on all interfaces",description:"Bind to 0.0.0.0 for LAN access"},{label:"$(plug) Change port",description:`Current: ${this.config.port}`},{label:"$(settings) Open settings",description:"Open Copilot API settings"}],n=await w.window.showQuickPick(r,{placeHolder:"Copilot API controls"});if(n){if(n.label.includes("Start")){await e.update("server.enabled",!0,w.ConfigurationTarget.Global),await e.update("server.enableHttp",!0,w.ConfigurationTarget.Global),await e.update("server.enableWebSocket",!0,w.ConfigurationTarget.Global);return}if(n.label.includes("Stop")){await e.update("server.enabled",!1,w.ConfigurationTarget.Global);return}if(n.label.includes("Toggle HTTP")){await e.update("server.enableHttp",!this.config.enableHttp,w.ConfigurationTarget.Global),await e.update("server.enabled",!0,w.ConfigurationTarget.Global);return}if(n.label.includes("Toggle WebSocket")){await e.update("server.enableWebSocket",!this.config.enableWebSocket,w.ConfigurationTarget.Global),await e.update("server.enabled",!0,w.ConfigurationTarget.Global);return}if(n.label.includes("localhost")){await e.update("server.host","127.0.0.1",w.ConfigurationTarget.Global),await e.update("server.enabled",!0,w.ConfigurationTarget.Global);return}if(n.label.includes("all interfaces")){await e.update("server.host","0.0.0.0",w.ConfigurationTarget.Global),await e.update("server.enabled",!0,w.ConfigurationTarget.Global);return}if(n.label.includes("Change port")){let o=await w.window.showInputBox({title:"Set API server port",value:String(this.config.port),validateInput:i=>{let s=Number(i);return!Number.isFinite(s)||s<=0||s>65535?"Enter a valid port between 1 and 65535":null}});o&&(await e.update("server.port",Number(o),w.ConfigurationTarget.Global),await e.update("server.enabled",!0,w.ConfigurationTarget.Global));return}n.label.includes("settings")&&await w.commands.executeCommand("workbench.action.openSettings","githubCopilotApi.server")}}logInfo(e){this.output.appendLine(`[${new Date().toISOString()}] INFO ${e}`)}logError(e,r){this.output.appendLine(`[${new Date().toISOString()}] ERROR ${e}: ${Rn(r)}`)}};async function Ld(){let t=w.extensions.getExtension(YV);if(!t)return await w.window.showWarningMessage("GitHub Copilot Chat extension is required. Install it from the Marketplace to continue.","Open Marketplace","Cancel")==="Open Marketplace"&&await w.commands.executeCommand("workbench.extensions.search",QV),!1;if(!t.isActive)try{await t.activate()}catch(e){return w.window.showErrorMessage(`Failed to activate GitHub Copilot Chat: ${Rn(e)}`),!1}return!0}function mb(t){if(typeof t=="string")return t.trim()||void 0;if(Array.isArray(t))return t.map(e=>typeof e=="string"?e:"").join(" ").trim()||void 0}function Gz(){let t=w.workspace.getConfiguration("githubCopilotApi"),e=t.get("server.enabled",!1),r=t.get("server.enableHttp",!0),n=t.get("server.enableWebSocket",!0),o=t.get("server.host","127.0.0.1").trim()||"127.0.0.1",i=t.get("server.port",3030),s=Number.isFinite(i)?Math.max(1,Math.floor(i)):3030,a=t.get("server.maxConcurrentRequests",4),c=Number.isFinite(a)?Math.max(1,Math.floor(a)):4,u=(t.get("server.defaultModel","gpt-4o-copilot")??"gpt-4o-copilot").trim()||"gpt-4o-copilot",l=t.get("server.apiKey","").trim(),d=t.get("server.enableLogging",!1),p=t.get("server.rateLimitPerMinute",60),f=Number.isFinite(p)?Math.max(0,Math.floor(p)):60,h=t.get("server.defaultSystemPrompt","").trim(),g=t.get("server.redactionPatterns",[]).map((se,Y)=>typeof se=="string"?{id:`migrated-${Y}`,name:`Custom Pattern ${Y+1}`,pattern:se,enabled:!0,isBuiltin:!1}:se),v=[];for(let se of e9){let Y=g.find(be=>be.id===se.id);Y?v.push({...se,enabled:Y.enabled}):v.push(se)}for(let se of g)se.isBuiltin||v.push(se);let $=t.get("server.ipAllowlist",[]),x=t.get("server.requestTimeoutSeconds",180),I=t.get("server.maxPayloadSizeMb",1),k=t.get("server.maxConnectionsPerIp",10),ie=w.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0);return{enabled:e,enableHttp:r,enableWebSocket:n,host:o,port:s,maxConcurrentRequests:c,defaultModel:u,apiKey:l,enableLogging:d,rateLimitPerMinute:f,defaultSystemPrompt:h,redactionPatterns:v,ipAllowlist:$,requestTimeoutSeconds:x,maxPayloadSizeMb:I,maxConnectionsPerIp:k,mcpEnabled:ie}}function Rn(t){return t instanceof Error&&t.message?t.message:String(t)}var wt=qe(require("vscode")),Fi=class t{constructor(e,r){this._extensionUri=e;this._gateway=r;this._gateway.onDidChangeStatus(async()=>{this._view&&(this._view.webview.html=await this._getSidebarHtml(this._view.webview)),t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,this._gateway))}),this._gateway.onDidLogRequest(n=>{this._view&&this._view.webview.postMessage({type:"liveLog",value:n}),t.currentPanel&&t.currentPanel.webview.postMessage({type:"liveLog",value:n})})}static viewType="copilotApiControls";_view;static currentPanel;static panelDisposables=[];static async createOrShow(e,r){let n=wt.window.activeTextEditor?.viewColumn??wt.ViewColumn.One;if(t.currentPanel){t.currentPanel.reveal(n),t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r);return}let o=wt.window.createWebviewPanel("copilotApiDashboard","Copilot API Dashboard",n,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});t.currentPanel=o,o.webview.html=await t.getPanelHtml(o.webview,r),o.webview.onDidReceiveMessage(i=>{t.handleMessage(i,r)},void 0,t.panelDisposables),o.onDidDispose(()=>{t.currentPanel=void 0;for(let i of t.panelDisposables)i.dispose();t.panelDisposables=[]},null,t.panelDisposables)}static handleMessage(e,r){switch(e.type){case"openChat":wt.commands.executeCommand("github-copilot-api-vscode.openCopilotChat");break;case"askCopilot":wt.commands.executeCommand("github-copilot-api-vscode.askCopilot");break;case"showControls":wt.commands.executeCommand("github-copilot-api-vscode.showServerControls");break;case"startServer":r.startServer();break;case"stopServer":r.stopServer();break;case"toggleHttp":r.toggleHttp();break;case"toggleWs":r.toggleWebSocket();break;case"toggleLogging":r.toggleLogging();break;case"setApiKey":typeof e.value=="string"&&r.setApiKey(e.value);break;case"setRateLimit":typeof e.value=="number"&&r.setRateLimit(e.value);break;case"hostLocal":r.setHost("127.0.0.1");break;case"hostLan":r.setHost("0.0.0.0");break;case"setHost":typeof e.value=="string"&&r.setHost(e.value);break;case"setPort":typeof e.value=="number"&&r.setPort(e.value);break;case"setModel":typeof e.value=="string"&&r.setDefaultModel(e.value);break;case"clearHistory":r.clearHistory();break;case"toggleMcp":typeof e.value=="boolean"&&r.toggleMcp(e.value);break;case"addRedactionPattern":if(e.value&&typeof e.value=="object"){let{name:o,pattern:i}=e.value;r.addRedactionPattern(o,i).then(async s=>{s?t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r)):wt.window.showErrorMessage("Invalid regex pattern")})}break;case"removeRedactionPattern":typeof e.value=="string"&&r.removeRedactionPattern(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"toggleRedactionPattern":if(e.value&&typeof e.value=="object"){let{id:o,enabled:i}=e.value;r.toggleRedactionPattern(o,i)}break;case"addIpAllowlistEntry":typeof e.value=="string"&&r.addIpAllowlistEntry(e.value).then(async o=>{o?t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r)):wt.window.showErrorMessage("Invalid IP address or CIDR range")});break;case"removeIpAllowlistEntry":typeof e.value=="string"&&r.removeIpAllowlistEntry(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setRequestTimeout":typeof e.value=="number"&&r.setRequestTimeout(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxPayloadSize":typeof e.value=="number"&&r.setMaxPayloadSize(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxConnectionsPerIp":typeof e.value=="number"&&r.setMaxConnectionsPerIp(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxConcurrency":typeof e.value=="number"&&r.setMaxConcurrency(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"getHistory":if(t.currentPanel){let o=r.getHistory(50);t.currentPanel.webview.postMessage({type:"historyData",data:o})}break;case"getStats":t.currentPanel&&t.currentPanel.webview.postMessage({type:"statsData",data:r.getStats()});break;case"getAuditStats":t.currentPanel&&r.getDailyStats(30).then(o=>{t.currentPanel?.webview.postMessage({type:"auditStatsData",data:o})});break;case"getAuditLogs":if(console.log("[CopilotPanel] Received getAuditLogs request"),t.currentPanel){let o=e.value||{},i=o.page||1,s=o.pageSize||10;r.getAuditLogs(i,s).then(a=>{console.log("[CopilotPanel] Got audit logs:",a.total,"total,",a.entries.length,"entries"),t.currentPanel?.webview.postMessage({type:"auditLogData",data:a.entries,page:i,total:a.total,pageSize:s})}).catch(a=>{console.error("[CopilotPanel] Error getting audit logs:",a),t.currentPanel?.webview.postMessage({type:"auditLogData",data:[],page:i,total:0,pageSize:s})})}else console.warn("[CopilotPanel] No currentPanel available for getAuditLogs response");break;case"openLogFolder":let n=r.getLogFolderPath();n?wt.commands.executeCommand("revealFileInOS",wt.Uri.file(n)):wt.window.showErrorMessage("Log folder not found");break}}async _getSidebarHtml(e){let r=Kz(),n=await this._gateway.getStatus(),o=n.running,i=o?"#4ade80":"#f87171",s=o?"Running":"Stopped",a=`http://${n.config.host}:${n.config.port}`;return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${r}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 12px; font-family: var(--vscode-font-family); color: var(--vscode-foreground); background: var(--vscode-sideBar-background); }
        .status { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: ${i}; box-shadow: 0 0 6px ${i}; }
        .url { font-family: var(--vscode-editor-font-family); font-size: 11px; opacity: 0.8; word-break: break-all; margin-bottom: 12px; }
        button { width: 100%; padding: 8px 12px; margin-bottom: 8px; background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; border-radius: 4px; cursor: pointer; font-family: var(--vscode-font-family); font-weight: 500; }
        button:hover { background: var(--vscode-button-hoverBackground); }
        button.secondary { background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }
        button.secondary:hover { background: var(--vscode-button-secondaryHoverBackground); }
        .hint { font-size: 11px; opacity: 0.7; text-align: center; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="status">
        <div class="dot"></div>
        <strong>${s}</strong>
    </div>
    <div style="font-size: 11px; opacity: 0.8; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
        <div style="width: 7px; height: 7px; border-radius: 50%; background: ${n.copilot.ready?"#4ade80":"#fbbf24"};"></div>
        <span>Copilot: ${n.copilot.ready?"Ready":n.copilot.signedIn?"Extension Check":"Sign-in Needed"}</span>
    </div>
    <div class="url">${a}</div>
    <button id="btn-dashboard">Open Dashboard</button>
    <button id="btn-toggle" class="secondary">${o?"Stop Server":"Start Server"}</button>
    <div class="hint">Use the dashboard for full controls</div>
    <script nonce="${r}">
        const vscode = acquireVsCodeApi();
        document.getElementById('btn-dashboard').addEventListener('click', () => {
            vscode.postMessage({ type: 'openDashboard' });
        });
        document.getElementById('btn-toggle').addEventListener('click', () => {
            vscode.postMessage({ type: '${o?"stopServer":"startServer"}' });
        });
    </script>
</body>
</html>`}static async getPanelHtml(e,r){let n=Kz(),o=await r.getStatus(),i=o.config,s=o.running,a=s?"var(--vscode-testing-iconPassed)":"var(--vscode-testing-iconFailed)",c=s?"Running":"Stopped",u=`http://${i.host}:${i.port}`,l=o.networkInfo;return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}' https://cdn.jsdelivr.net; connect-src http: https:;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot API Dashboard</title>
    <title>Copilot API Dashboard</title>
    <!-- Removed Chart.js for reliability -->
    <style>
        :root { color-scheme: var(--vscode-color-scheme); }
        body {
            margin: 0; padding: 0; min-height: 100vh;
            background: radial-gradient(120% 120% at 20% 20%, rgba(56,189,248,0.05), transparent),
                        radial-gradient(120% 120% at 80% 0%, rgba(147,197,253,0.05), transparent),
                        var(--vscode-editor-background);
            font-family: var(--vscode-font-family); color: var(--vscode-foreground);
        }
        .page { max-width: 1400px; margin: 0 auto; padding: 32px 32px 64px; display: flex; flex-direction: column; gap: 24px; }
        .hero { display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; padding-bottom: 8px; }
        .hero h1 { margin: 0; font-size: 26px; letter-spacing: -0.4px; font-weight: 700; }
        .hero p { margin: 6px 0 0 0; opacity: 0.7; font-size: 14px; max-width: 600px; line-height: 1.5; }
        .badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px; background: var(--vscode-badge-background); color: var(--vscode-badge-foreground); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .card { background-color: color-mix(in srgb, var(--vscode-sideBar-background) 80%, transparent); border: 1px solid var(--vscode-widget-border); border-radius: 12px; padding: 24px; box-shadow: 0 4px 24px rgba(0,0,0,0.06); transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.12); border-color: var(--vscode-focusBorder); }
        .card.full-width { grid-column: 1 / -1; }
        h3 { margin-top: 0; margin-bottom: 10px; font-size: 12px; text-transform: uppercase; letter-spacing: 0.4px; opacity: 0.8; }
        .status-row { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background-color: ${a}; box-shadow: 0 0 10px ${a}; }
        .info-grid { display: grid; grid-template-columns: 120px 1fr; gap: 6px 12px; font-size: 12px; align-items: center; }
        .label { opacity: 0.7; text-transform: uppercase; letter-spacing: 0.3px; font-size: 11px; }
        .value { font-family: var(--vscode-editor-font-family); word-break: break-all; }
        .actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; }
        button { display: inline-flex; justify-content: center; align-items: center; gap: 6px; width: 100%; padding: 10px 12px; background-color: var(--vscode-button-background); color: var(--vscode-button-foreground); border: 1px solid color-mix(in srgb, var(--vscode-button-background) 50%, transparent); border-radius: 6px; cursor: pointer; font-family: var(--vscode-font-family); font-weight: 600; transition: transform 120ms ease, background-color 120ms ease; }
        button:hover { background-color: var(--vscode-button-hoverBackground); transform: translateY(-1px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        button.secondary { background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }
        button.secondary:hover { background-color: var(--vscode-button-secondaryHoverBackground); }
        button.success { background-color: var(--vscode-testing-iconPassed); }
        button.danger { background-color: var(--vscode-testing-iconFailed); }
        .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--vscode-widget-border); }
        .toggle-row:last-child { border-bottom: none; }
        .switch { position: relative; width: 36px; height: 20px; }
        .switch input { display: none; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--vscode-input-background); border: 1px solid var(--vscode-widget-border); transition: .2s; border-radius: 999px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 2px; bottom: 2px; background-color: var(--vscode-foreground); transition: .2s; border-radius: 50%; }
        input:checked + .slider { background: var(--vscode-testing-iconPassed); border-color: var(--vscode-testing-iconPassed); }
        input:checked + .slider:before { transform: translateX(16px); background: var(--vscode-editor-background); }
        .muted { opacity: 0.75; font-size: 12px; }
        .inline-form { display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center; }
        .stacked { display: flex; flex-direction: column; gap: 12px; }
        input, select, textarea { width: 100%; padding: 8px 10px; font-size: 13px; border-radius: 6px; border: 1px solid var(--vscode-input-border); background: var(--vscode-input-background); color: var(--vscode-input-foreground); font-family: var(--vscode-font-family); box-sizing: border-box; }
        textarea { font-family: var(--vscode-editor-font-family); font-size: 12px; resize: vertical; min-height: 120px; }
        select { cursor: pointer; }
        .pill-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--vscode-widget-border); background: var(--vscode-editor-background); cursor: pointer; }
        .pill:hover { border-color: var(--vscode-testing-iconPassed); color: var(--vscode-testing-iconPassed); }
        .docs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px; }
        .doc-card { border: 1px dashed var(--vscode-widget-border); border-radius: 8px; padding: 10px; background: color-mix(in srgb, var(--vscode-editor-background) 90%, transparent); cursor: pointer; transition: border-color 0.15s, background 0.15s; }
        .doc-card:hover { border-color: var(--vscode-focusBorder); background: color-mix(in srgb, var(--vscode-editor-background) 70%, transparent); }
        .doc-card h4 { margin: 0 0 6px 0; font-size: 13px; display: flex; gap: 8px; align-items: center; }
        .doc-card code { display: inline-block; padding: 3px 6px; border-radius: 6px; background: var(--vscode-textBlockQuote-background); font-family: var(--vscode-editor-font-family); }
        .doc-card p { margin: 6px 0 0 0; opacity: 0.85; font-size: 12px; }
        pre { background: var(--vscode-textBlockQuote-background); border-radius: 8px; padding: 10px; font-size: 12px; overflow-x: auto; margin: 0; white-space: pre-wrap; word-break: break-word; }
        a { color: var(--vscode-textLink-foreground); }
        
        .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid currentColor; border-radius: 50%; border-top-color: transparent; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Live Log Tail Styles */
        .log-container {
            background: #0d1117;
            color: #e6edf3;
            font-family: var(--vscode-editor-font-family);
            font-size: 11px;
            padding: 12px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 2px;
            border: 1px solid var(--vscode-widget-border);
            margin-top: 8px;
        }
        .log-line {
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-all;
            display: flex;
            gap: 8px;
        }
        .log-time { color: #8b949e; min-width: 75px; flex-shrink: 0; }
        .log-method { font-weight: 600; color: #58a6ff; min-width: 50px; flex-shrink: 0; }
        .log-path { color: #d2a8ff; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .log-status { font-weight: 600; min-width: 35px; flex-shrink: 0; }
        .log-status.success { color: #3fb950; }
        .log-status.error { color: #f85149; }
        .log-latency { color: #d0d7de; min-width: 60px; text-align: right; flex-shrink: 0; }
        
        #log-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.3s ease;
        }
        #log-status-indicator.active { background-color: #3fb950; box-shadow: 0 0 8px #3fb950; }
        #log-status-indicator.inactive { background-color: #8b949e; }

    </style>
</head>
<body>
    <div class="page">
        <div class="hero">
            <div>
                <h1>Copilot API Dashboard</h1>
                <p>Monitor and control your local Copilot API Gateway.</p>
                <div style="margin-top: 8px; font-size: 13px; opacity: 0.9; font-family: var(--vscode-editor-font-family);">
                    <span style="opacity: 0.6;">Running on:</span> 
                    <strong>http://${i.host}:${i.port}</strong>
                </div>
            </div>
            <div style="display: flex; gap: 8px;">
                <button id="btn-toggle-server" class="${o.running?"danger":"success"}" data-running="${o.running}" style="min-width: 140px;">
                    ${o.running?"Stop Server":"Start Server"}
                </button>
                <button class="secondary" id="btn-open-chat" title="Open Copilot Chat" style="min-width: 90px;">\u{1F4AC} Chat</button>
                <button class="secondary" id="btn-ask-copilot" title="Ask Copilot" style="min-width: 90px;">\u2753 Ask</button>
                <button class="secondary" id="btn-settings" title="Settings">\u2699\uFE0F</button>
            </div>
        </div>

        <!-- Copilot Health Banner -->
        ${o.copilot.ready?"":`
        <div style="background: var(--vscode-statusBarItem-warningBackground); color: var(--vscode-statusBarItem-warningForeground); padding: 12px 16px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: center; gap: 12px; font-weight: 500; border: 1px solid rgba(0,0,0,0.1);">
            <span style="font-size: 20px;">\u26A0\uFE0F</span>
            <div style="flex: 1;">
                <div style="font-size: 14px;">GitHub Copilot is not fully ready</div>
                <div style="font-size: 12px; opacity: 0.9; font-weight: 400;">
                    ${o.copilot.installed?"":"\u2022 GitHub Copilot extension is missing. "}
                    ${o.copilot.chatInstalled?"":"\u2022 GitHub Copilot Chat extension is missing. "}
                    ${o.copilot.signedIn?"":"\u2022 You are not signed in to GitHub Copilot. "}
                </div>
            </div>
            <button class="secondary" onclick="vscode.postMessage({ type: 'askCopilot' })" style="width: auto; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: inherit;">Resolve</button>
        </div>
        `}

        <!-- Server Status Card -->
        <div class="card full-width">
            <div class="status-row" style="justify-content: space-between; margin-bottom: 24px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="status-dot" class="status-dot"></div>
                    <span id="server-status-text" style="font-size: 16px;">${c}</span>
                </div>
                <div class="muted">
                    v${r.getVersion()}
                </div>
            </div>

            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <div class="card" style="padding: 16px;">
                    <div class="label">Requests</div>
                    <div class="value" style="font-size: 20px;" id="stat-requests">${o.stats?.totalRequests??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Req/Min</div>
                    <div class="value" style="font-size: 20px;" id="stat-rpm">0</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Latency</div>
                    <div class="value" style="font-size: 20px;" id="stat-latency">0ms</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Error Rate</div>
                    <div class="value" style="font-size: 20px;" id="stat-errors">0%</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Tokens In</div>
                    <div class="value" style="font-size: 20px;" id="stat-tokens-in">${o.stats?.totalTokensIn??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Tokens Out</div>
                    <div class="value" style="font-size: 20px;" id="stat-tokens-out">${o.stats?.totalTokensOut??0}</div>
                </div>
                <div class="card" style="padding: 16px;">
                    <div class="label">Uptime</div>
                    <div class="value" style="font-size: 20px;" id="stat-uptime">0m</div>
                </div>
            </div>

            <div class="info-grid">
                <div class="label">Connection</div>
                <div class="value">
                    ${i.enableHttp?"HTTP ":""}
                    ${i.enableWebSocket?"WebSocket ":""}
                </div>
                <div class="label">Auth Mode</div>
                <div class="value">${i.apiKey?"API Key (Protected)":"Open (No Auth)"}</div>
                <div class="label">Default Model</div>
                <div class="value">${i.defaultModel}</div>
                <div class="label">Copilot Health</div>
                <div class="value" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <span class="badge" style="background: ${o.copilot.chatInstalled?"var(--vscode-charts-green)":o.copilot.signedIn?"var(--vscode-charts-yellow)":"var(--vscode-charts-red)"}; color: ${o.copilot.chatInstalled||o.copilot.signedIn?"var(--vscode-editor-background)":"white"}; padding: 1px 6px; border-radius: 4px; font-size: 10px;">Chat: ${o.copilot.chatInstalled?"Installed":o.copilot.signedIn?"Not Detected":"Missing"}</span>
                    <span class="badge" style="background: ${o.copilot.signedIn?"var(--vscode-charts-green)":"var(--vscode-charts-red)"}; color: ${o.copilot.signedIn?"var(--vscode-editor-background)":"white"}; padding: 1px 6px; border-radius: 4px; font-size: 10px;">Auth: ${o.copilot.signedIn?"Signed In":"Signed Out"}</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Configuration Card -->
            <div class="card">
                <h3>\u2699\uFE0F Server Configuration</h3>
                <div class="stacked">
                    <div class="toggle-row">
                        <span>Enable HTTP Server</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-http" ${i.enableHttp?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <span>Enable WebSocket</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-ws" ${i.enableWebSocket?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <span>Detailed Logging</span>
                            <span title="Enables verbose output to the VS Code Output channel. Useful for debugging." style="cursor: help; opacity: 0.6; font-size: 14px;">\u2139\uFE0F</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-logging" ${i.enableLogging?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 16px;">
                        <div style="display: flex; gap: 16px; margin-bottom: 12px;">
                            <div style="flex: 1;">
                                <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px;">HOST</span>
                                <input type="text" id="custom-host" value="${i.host}" placeholder="127.0.0.1" style="width: 100% !important;">
                            </div>
                            <div style="width: 100px;">
                                <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px;">PORT</span>
                                <input type="number" id="custom-port" value="${i.port}" style="width: 100% !important;">
                            </div>
                            <div style="display: flex; align-items: flex-end;">
                                <button class="secondary" id="btn-set-host" style="height: 36px; padding: 0 16px;">Apply</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="secondary" id="btn-host-local" style="flex: 1;">Bind Localhost</button>
                            <button class="secondary" id="btn-host-lan" style="flex: 1;">Bind LAN (0.0.0.0)</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Card -->
            <div class="card">
                <h3>\u{1F512} Security</h3>
                <div class="stacked">
                    <div class="toggle-row">
                        <span>Enable Authentication</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-auth" ${i.apiKey?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 12px;">
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <input type="password" id="api-key-input" value="${i.apiKey||""}" placeholder="sk-..." style="flex: 1;">
                            <button class="secondary" id="btn-show-key" style="width: 40px;" title="Show/Hide Key">\u{1F441}</button>
                            <button class="secondary" id="btn-copy-key" style="width: 40px;" title="Copy Key">\u{1F4CB}</button>
                        </div>
                        <div class="actions">
                            <button class="secondary" id="btn-generate-key">Generate New Key</button>
                            <button class="secondary" id="btn-set-apikey">Set Manual Key</button>
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 8px;">RATE LIMIT</span>
                        <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                            <input type="number" id="rate-limit-input" value="${i.rateLimitPerMinute||0}" placeholder="0 = unlimited" style="width: 100px !important;">
                            <span class="muted">req/min</span>
                            <button class="secondary" id="btn-set-ratelimit" style="width: auto; padding: 6px 16px;">Set</button>
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <div class="inline-form" style="margin-bottom: 8px;">
                            <span style="font-size: 12px; font-weight: 600;">ALLOW IP / DOMAIN</span>
                            <div style="display: flex; gap: 8px;">
                                <input type="text" id="ip-allowlist-input" placeholder="e.g. 192.168.1.5, 10.0.0.0/24, or example.com">
                                <button class="secondary" id="btn-add-ip" style="width: auto;">Add</button>
                            </div>
                        </div>
                        <div class="pill-row" id="ip-list">
                            ${(i.ipAllowlist||[]).map(d=>`<span class="pill" style="font-size: 11px; display: flex; align-items: center; gap: 4px;">${d} <span class="btn-remove-ip" data-value="${d}" style="cursor: pointer; opacity: 0.6;">\xD7</span></span>`).join("")}
                            ${!i.ipAllowlist||i.ipAllowlist.length===0?'<span class="muted">No access restrictions (all IPs allowed)</span>':""}
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 8px;">HARDENING & LIMITS</span>
                        
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Request Timeout</span>
                                <input type="number" id="timeout-input" value="${i.requestTimeoutSeconds||60}" style="width: 80px !important;">
                                <span class="muted">sec</span>
                                <button class="secondary" id="btn-set-timeout" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Max Payload</span>
                                <input type="number" id="payload-input" value="${i.maxPayloadSizeMb||1}" style="width: 80px !important;">
                                <span class="muted">MB</span>
                                <button class="secondary" id="btn-set-payload" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Max Connections/IP</span>
                                <input type="number" id="connections-input" value="${i.maxConnectionsPerIp||10}" style="width: 80px !important;">
                                <span class="muted">conn</span>
                                <button class="secondary" id="btn-set-connections" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Total Concurrency</span>
                                <input type="number" id="concurrency-input" value="${i.maxConcurrentRequests||4}" style="width: 80px !important;">
                                <span class="muted">req</span>
                                <button class="secondary" id="btn-set-concurrency" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>
                            <div class="muted" style="font-size: 10px; margin-top: 2px; opacity: 0.9; line-height: 1.4;">
                                <div style="display: flex; gap: 4px; margin-bottom: 2px;">
                                    <span style="font-weight: 600; color: var(--vscode-charts-blue); min-width: 105px;">Connections/IP:</span>
                                    <span>Limits simultaneous requests from a <b>single</b> user/client.</span>
                                </div>
                                <div style="display: flex; gap: 4px;">
                                    <span style="font-weight: 600; color: var(--vscode-charts-orange); min-width: 105px;">Total Concurrency:</span>
                                    <span>Global limit across <b>all</b> users to protect the Copilot backend.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MCP Status -->
        <div class="card full-width" id="mcp-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">\u{1F50C} MCP Status <span id="mcp-status-badge" class="badge">Checking...</span></h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; opacity: 0.8;">
                        <input type="checkbox" id="mcp-enabled-toggle" style="width: 14px; height: 14px; margin: 0;"> Enabled
                    </label>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <div style="padding: 12px; border: 1px solid var(--vscode-widget-border); border-radius: 6px; background: rgba(0,0,0,0.1);">
                    <div class="muted" style="font-size: 11px; margin-bottom: 4px;">Connected Servers</div>
                    <div id="mcp-servers-count" style="font-size: 18px; font-weight: 600;">0</div>
                    <div id="mcp-servers-list" class="muted" style="font-size: 10px; margin-top: 4px;">None</div>
                </div>
                <div style="padding: 12px; border: 1px solid var(--vscode-widget-border); border-radius: 6px; background: rgba(0,0,0,0.1);">
                    <div class="muted" style="font-size: 11px; margin-bottom: 4px;">Available Tools</div>
                    <div id="mcp-tools-count" style="font-size: 18px; font-weight: 600;">0</div>
                    <div id="mcp-tools-list" class="muted" style="font-size: 10px; margin-top: 4px; max-height: 60px; overflow-y: auto;">None</div>
                </div>
            </div>
        </div>

        <!-- Live Log Tail -->
        <div class="card full-width">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">\u{1F4DF} Live Log Tail <div id="log-status-indicator" class="active"></div></h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; opacity: 0.8;">
                        <input type="checkbox" id="log-autoscroll" checked style="width: 14px; height: 14px; margin: 0;"> Auto-scroll
                    </label>
                    <button class="secondary" id="btn-clear-logs" style="width: auto; padding: 4px 12px; font-size: 11px; font-weight: 500;">\u{1F9F9} Clear</button>
                </div>
            </div>
            <div id="live-log-container" class="log-container">
                <div class="muted" style="text-align: center; padding-top: 120px; opacity: 0.5;">Waiting for API requests...</div>
            </div>
        </div>

        <!-- Audit & Analytics -->
        <div class="card full-width">
            
            <!-- Charts removed per user request -->
            <div style="margin-bottom: 24px;"></div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h4 style="margin: 0; font-size: 13px; opacity: 0.9;">Recent Activity</h4>
                <span id="refresh-timer" class="muted" style="font-weight: normal; font-size: 11px; opacity: 0.6;"></span>
                <div style="display: flex; gap: 8px;">
                    <button class="secondary" id="btn-refresh-audit" style="padding: 4px 10px; font-size: 11px;">\u{1F504} Refresh</button>
                    <button class="secondary" id="btn-open-logs" style="padding: 4px 10px; font-size: 11px;">\u{1F4C2} Open Log Folder</button>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table id="audit-table" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 1px solid var(--vscode-widget-border);">
                            <th style="padding: 8px 12px; opacity: 0.7;">Time</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Method</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Path</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Status</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Latency</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Tokens</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="audit-table-body">
                        <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                            <td style="padding: 8px 12px; opacity: 0.6; font-style: italic;" colspan="7">Loading audit logs...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--vscode-widget-border);">
                <div class="muted" style="font-size: 11px;" id="page-info">Showing 0-0 of 0</div>
                <div style="display: flex; gap: 8px;">
                    <button class="secondary" id="btn-prev-page" disabled>Previous</button>
                    <button class="secondary" id="btn-next-page" disabled>Next</button>
                </div>
            </div>
        </div>
        
        <div class="card full-width">
            <h3>\u{1F6E1}\uFE0F Data Redaction</h3>
            <p class="muted" style="margin-bottom: 16px;">
                Toggle patterns to automatically redact sensitive data from logs. All patterns are applied in real-time.
            </p>
            
            <!-- Built-in Patterns -->
            <div style="margin-bottom: 20px;">
                <h4 style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">Built-in Patterns</h4>
                <div id="builtin-patterns-list" style="display: flex; flex-direction: column; gap: 8px;">
                    ${(i.redactionPatterns||[]).filter(d=>d.isBuiltin).map(d=>`
                        <div class="toggle-row" style="padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 6px; border: 1px solid var(--vscode-widget-border);">
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <span style="font-weight: 600; font-size: 12px;">${d.name}</span>
                                <code style="font-size: 10px; opacity: 0.6; word-break: break-all;">${d.pattern.length>40?d.pattern.substring(0,40)+"...":d.pattern}</code>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="toggle-redaction" data-id="${d.id}" ${d.enabled?"checked":""}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    `).join("")}
                </div>
            </div>
            
            <!-- Custom Patterns -->
            <div style="border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                <h4 style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">Custom Patterns</h4>
                
                <div id="custom-patterns-list" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
                    ${(i.redactionPatterns||[]).filter(d=>!d.isBuiltin).map(d=>`
                        <div class="toggle-row" style="padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 6px; border: 1px solid var(--vscode-widget-border);">
                            <div style="display: flex; flex-direction: column; gap: 2px; flex: 1;">
                                <span style="font-weight: 600; font-size: 12px;">${d.name}</span>
                                <code style="font-size: 10px; opacity: 0.6; word-break: break-all;">${d.pattern}</code>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label class="switch">
                                    <input type="checkbox" class="toggle-redaction" data-id="${d.id}" ${d.enabled?"checked":""}>
                                    <span class="slider"></span>
                                </label>
                                <button class="secondary btn-remove-redaction" data-id="${d.id}" style="width: 28px; height: 28px; padding: 0; font-size: 14px;" title="Remove">\xD7</button>
                            </div>
                        </div>
                    `).join("")}
                    ${(i.redactionPatterns||[]).filter(d=>!d.isBuiltin).length===0?'<span class="muted" style="text-align: center; padding: 12px;">No custom patterns added yet</span>':""}
                </div>
                
                <!-- Add Custom Pattern Form -->
                <div style="display: flex; flex-direction: column; gap: 8px; padding: 12px; background: var(--vscode-textBlockQuote-background); border-radius: 8px;">
                    <span style="font-size: 11px; font-weight: 600; opacity: 0.8;">ADD CUSTOM PATTERN</span>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <input type="text" id="redaction-name-input" placeholder="Pattern name (e.g. 'Bank Account')" style="flex: 1; min-width: 150px;">
                        <input type="text" id="redaction-pattern-input" placeholder="Regex pattern" style="flex: 2; min-width: 200px;">
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button class="secondary" id="btn-test-redaction" style="width: auto;">\u{1F9EA} Test</button>
                        <button class="secondary" id="btn-add-redaction" style="width: auto;">\u2795 Add Pattern</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card full-width">
            <h3>\u{1F4DA} API Documentation</h3>
            <p class="muted" style="margin-bottom: 16px;">
                The gateway supports multiple API formats. Use the endpoints below with your favorite SDKs.
            </p>
            <div class="docs-grid">
                <div class="doc-card">
                    <h4><span>\u{1F916}</span> OpenAI <code>/v1</code></h4>
                    <p>Compatible with OpenAI SDKs. Supports <code>chat/completions</code>, <code>completions</code>, and <code>models</code>.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F9EA}</span> Anthropic <code>/v1</code></h4>
                    <p>Compatible with Claude SDKs. Supports <code>/v1/messages</code> with full streaming (SSE).</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F31F}</span> Google <code>/v1beta</code></h4>
                    <p>Compatible with Gemini SDKs. Supports <code>generateContent</code> and <code>streamGenerateContent</code>.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F50C}</span> MCP Tools</h4>
                    <p>MCP tools are automatically prefixed with <code>mcp_{server}_{tool}</code>. The gateway handles execution automatically in non-streaming mode.</p>
                </div>
            </div>
            <div class="actions" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-top: 16px;">
                <a href="http://${i.host}:${i.port}/docs" target="_blank" class="secondary" style="display: inline-flex; justify-content: center; align-items: center; gap: 6px; padding: 10px 12px; background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: 1px solid color-mix(in srgb, var(--vscode-button-secondaryBackground) 50%, transparent); border-radius: 6px; text-decoration: none; font-weight: 600;">\u{1F4DD} Swagger UI</a>
                <a href="http://${i.host}:${i.port}/openapi.json" target="_blank" class="secondary" style="display: inline-flex; justify-content: center; align-items: center; gap: 6px; padding: 10px 12px; background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: 1px solid color-mix(in srgb, var(--vscode-button-secondaryBackground) 50%, transparent); border-radius: 6px; text-decoration: none; font-weight: 600;">\u{1F4C4} OpenAPI JSON</a>
            </div>
        </div>

        <div class="card full-width" style="background: linear-gradient(135deg, color-mix(in srgb, var(--vscode-sideBar-background) 90%, #3b82f6 10%), color-mix(in srgb, var(--vscode-sideBar-background) 95%, #8b5cf6 5%));">
            <h3>\u{1F468}\u200D\u{1F4BB} About</h3>
            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Suhaib Bin Younis</div>
                    <div class="muted" style="margin-bottom: 8px;">Developer & Creator</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <a href="https://suhaibbinyounis.com" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F310} Website</a>
                        <a href="https://suhaib.in" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F517} suhaib.in</a>
                        <a href="mailto:vscode@suhaib.in" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F4E7} Email</a>
                        <a href="https://github.com/pmbyt/github-copilot-api-vscode" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u2B50 Star on GitHub</a>
                    </div>
                </div>
                <div class="muted" style="font-size: 11px; text-align: right;">
                    GitHub Copilot API Gateway v${r.getVersion()}<br>
                    Made with \u2764\uFE0F and \u2615
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--vscode-sideBar-background); padding: 24px; border-radius: 12px; width: 80%; max-width: 800px; max-height: 80vh; display: flex; flex-direction: column; overflow: hidden; border: 1px solid var(--vscode-widget-border); box-shadow: 0 4px 24px rgba(0,0,0,0.25);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0;">Request Details</h3>
                <button class="secondary" id="btn-close-modal" style="width: auto; padding: 6px 12px;">Close</button>
            </div>
            <div style="overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 16px; padding-right: 8px;">
                <div style="position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; opacity: 0.8;">Request</h4>
                        <button class="secondary btn-copy-modal" data-target="modal-request" style="width: auto; padding: 2px 8px; font-size: 10px;">\u{1F4CB} Copy</button>
                    </div>
                    <pre id="modal-request" style="font-size: 11px; max-height: 300px; overflow: auto; margin: 0;"></pre>
                </div>
                <div style="position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; opacity: 0.8;">Response</h4>
                        <button class="secondary btn-copy-modal" data-target="modal-response" style="width: auto; padding: 2px 8px; font-size: 10px;">\u{1F4CB} Copy</button>
                    </div>
                    <pre id="modal-response" style="font-size: 11px; max-height: 300px; overflow: auto; margin: 0;"></pre>
                </div>
            </div>
        </div>
    </div>

    <script nonce="${n}">
        var vscode = acquireVsCodeApi();
        
        // Pagination state - declare at top to avoid hoisting issues
        var currentPage = 1;
        var pageSize = 10;
        var totalLogs = 0;
        var lastLogs = [];

        document.getElementById('btn-toggle-server').onclick = function() {
            var running = this.getAttribute('data-running') === 'true';
            vscode.postMessage({ type: running ? 'stopServer' : 'startServer' });
        };

        document.getElementById('btn-open-chat').onclick = function() {
            vscode.postMessage({ type: 'openChat' });
        };

        document.getElementById('btn-ask-copilot').onclick = function() {
            vscode.postMessage({ type: 'askCopilot' });
        };

        document.getElementById('btn-settings').onclick = function() {
            vscode.postMessage({ type: 'showControls' });
        };

        document.getElementById('toggle-http').onchange = function() {
            vscode.postMessage({ type: 'toggleHttp' });
        };

        document.getElementById('toggle-ws').onchange = function() {
            vscode.postMessage({ type: 'toggleWs' });
        };

        document.getElementById('toggle-logging').onchange = function() {
            vscode.postMessage({ type: 'toggleLogging' });
        };

        // Store the current API key for copy functionality
        var currentApiKey = '${i.apiKey||""}';

        document.getElementById('toggle-auth').onchange = function() {
            if (!this.checked) {
                // Disable auth by clearing API key
                currentApiKey = '';
                vscode.postMessage({ type: 'setApiKey', value: '' });
            } else {
                // Generate a random key when enabling
                var key = 'sk-' + Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
                document.getElementById('api-key-input').value = key;
                document.getElementById('api-key-input').type = 'text';
                currentApiKey = key;
                vscode.postMessage({ type: 'setApiKey', value: key });
            }
        };

        document.getElementById('btn-set-apikey').onclick = function() {
            var v = document.getElementById('api-key-input').value.trim();
            currentApiKey = v;
            vscode.postMessage({ type: 'setApiKey', value: v });
            if (v) {
                document.getElementById('toggle-auth').checked = true;
            }
        };

        document.getElementById('btn-generate-key').onclick = function() {
            var key = 'sk-' + Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
            document.getElementById('api-key-input').value = key;
            document.getElementById('api-key-input').type = 'text';
            currentApiKey = key;
            vscode.postMessage({ type: 'setApiKey', value: key });
            document.getElementById('toggle-auth').checked = true;
        };

        document.getElementById('btn-copy-key').onclick = function() {
            var input = document.getElementById('api-key-input');
            var keyToCopy = input.value.trim() || currentApiKey;
            if (keyToCopy) {
                navigator.clipboard.writeText(keyToCopy).then(function() {
                    var btn = document.getElementById('btn-copy-key');
                    btn.textContent = '\u2713';
                    setTimeout(function() { btn.textContent = '\u{1F4CB}'; }, 1500);
                });
            }
        };

        document.getElementById('btn-show-key').onclick = function() {
            var input = document.getElementById('api-key-input');
            var btn = document.getElementById('btn-show-key');
            if (input.type === 'password') {
                input.type = 'text';
                if (!input.value && currentApiKey) {
                    input.value = currentApiKey;
                }
                btn.textContent = '\u{1F648}';
            } else {
                input.type = 'password';
                btn.textContent = '\u{1F441}';
            }
        };

        document.getElementById('btn-set-ratelimit').onclick = function() {
            var v = document.getElementById('rate-limit-input').value;
            vscode.postMessage({ type: 'setRateLimit', value: Number(v) || 0 });
        };

        // Initialize on load
        // try { initCharts(); } catch (e) { console.error('Failed to init charts', e); }
        
        // Request initial data
        setTimeout(() => vscode.postMessage({ type: 'getAuditStats' }), 500);

        document.getElementById('btn-refresh-audit').onclick = function() {
            startCountdown(); // Reset timer
            vscode.postMessage({ type: 'getAuditStats' });
            vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
            this.textContent = '\u{1F504} Loading...';
            setTimeout(() => { this.textContent = '\u{1F504} Refresh'; }, 1000);
        };

        document.getElementById('btn-open-logs').onclick = function() {
            vscode.postMessage({ type: 'openLogFolder' });
        };

        // Modal Logic
        // Modal Logic
        const modal = document.getElementById('detail-modal');
        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scrolling
        }

        document.getElementById('btn-close-modal').onclick = closeModal;
        
        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        // Global function for View button
        window.showDetails = function(index) {
            if (!lastLogs || !lastLogs[index]) return;
            const log = lastLogs[index];
            
            const reqContent = {
                headers: log.requestHeaders,
                body: log.requestBody
            };
            const resContent = {
                headers: log.responseHeaders,
                body: log.responseBody,
                error: log.error
            };

            document.getElementById('modal-request').textContent = JSON.stringify(reqContent, null, 2);
            document.getElementById('modal-response').textContent = JSON.stringify(resContent, null, 2);
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Lock scrolling
        };

        // Copy content from modal
        document.querySelectorAll('.btn-copy-modal').forEach(btn => {
            btn.onclick = function() {
                const targetId = this.getAttribute('data-target');
                const content = document.getElementById(targetId).textContent;
                if (content) {
                    navigator.clipboard.writeText(content).then(() => {
                        const originalText = this.textContent;
                        this.textContent = '\u2713 Copied';
                        setTimeout(() => { this.textContent = originalText; }, 1500);
                    });
                }
            };
        });

        // Auto-refresh Countdown Logic
        let refreshTimer = 10;
        let refreshIntervalVal = null;
        const refreshSpan = document.getElementById('refresh-timer');
        
        function startCountdown() {
            if (refreshIntervalVal) clearInterval(refreshIntervalVal);
            
            refreshTimer = 10;
            updateTimerDisplay();
            
            refreshIntervalVal = setInterval(() => {
                refreshTimer--;
                updateTimerDisplay();
                
                if (refreshTimer <= 0) {
                    refreshTimer = 10;
                    vscode.postMessage({ type: 'getAuditStats' });
                    // Also refresh current page of logs
                    vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            if (refreshSpan) {
                refreshSpan.textContent = \`Refreshing in \${refreshTimer}s...\`;
            }
        }

        startCountdown();

        // IP Allowlist handlers
        document.getElementById('btn-add-ip').onclick = function() {
            var ip = document.getElementById('ip-allowlist-input').value.trim();
            if (ip) {
                vscode.postMessage({ type: 'addIpAllowlistEntry', value: ip });
                document.getElementById('ip-allowlist-input').value = '';
            }
        };

        document.querySelectorAll('.btn-remove-ip').forEach(function(btn) {
            btn.onclick = function() {
                var ip = btn.getAttribute('data-value');
                if (ip) {
                    vscode.postMessage({ type: 'removeIpAllowlistEntry', value: ip });
                }
            };
        });

        document.getElementById('btn-host-local').onclick = function() {
            vscode.postMessage({ type: 'hostLocal' });
        };

        document.getElementById('btn-host-lan').onclick = function() {
            vscode.postMessage({ type: 'hostLan' });
        };

        // Copy URL buttons for shareable LAN URLs
        document.querySelectorAll('.btn-copy-url').forEach(function(btn) {
            btn.onclick = function() {
                var url = btn.getAttribute('data-url');
                if (url) {
                    navigator.clipboard.writeText(url).then(function() {
                        var originalText = btn.textContent;
                        btn.textContent = '\u2713 Copied!';
                        setTimeout(function() { btn.textContent = originalText; }, 1500);
                    });
                }
            };
        });

        // MCP Toggle
        var mcpToggle = document.getElementById('mcp-enabled-toggle');
        if (mcpToggle) {
            mcpToggle.onchange = function() {
                vscode.postMessage({ type: 'toggleMcp', value: mcpToggle.checked });
            };
        }

        document.getElementById('btn-set-host').onclick = function() {
            var host = document.getElementById('custom-host').value;
            var port = document.getElementById('custom-port').value;
            if (host) vscode.postMessage({ type: 'setHost', value: host });
            if (port) vscode.postMessage({ type: 'setPort', value: Number(port) });
        };

        // btn-set-port removed - consolidated with btn-set-host Apply button

        document.getElementById('btn-set-timeout').onclick = function() {
            var val = document.getElementById('timeout-input').value;
            vscode.postMessage({ type: 'setRequestTimeout', value: Number(val) });
        };

        document.getElementById('btn-set-payload').onclick = function() {
            var val = document.getElementById('payload-input').value;
            vscode.postMessage({ type: 'setMaxPayloadSize', value: Number(val) });
        };

        document.getElementById('btn-set-connections').onclick = function() {
            var val = document.getElementById('connections-input').value;
            vscode.postMessage({ type: 'setMaxConnectionsPerIp', value: Number(val) });
        };

        document.getElementById('btn-set-concurrency').onclick = function() {
            var val = document.getElementById('concurrency-input').value;
            vscode.postMessage({ type: 'setMaxConcurrency', value: Number(val) });
        };

        // btn-set-model removed - element doesn't exist in current UI

        // Redaction pattern handlers
        document.getElementById('btn-add-redaction').onclick = function() {
            var name = document.getElementById('redaction-name-input').value.trim();
            var pattern = document.getElementById('redaction-pattern-input').value.trim();
            if (!name) {
                alert('Please enter a pattern name');
                return;
            }
            if (!pattern) {
                alert('Please enter a regex pattern');
                return;
            }
            try {
                new RegExp(pattern); // Validate
                vscode.postMessage({ type: 'addRedactionPattern', value: { name: name, pattern: pattern } });
                document.getElementById('redaction-name-input').value = '';
                document.getElementById('redaction-pattern-input').value = '';
            } catch (e) {
                alert('Invalid regex pattern: ' + e.message);
            }
        };

        document.getElementById('btn-test-redaction').onclick = function() {
            var pattern = document.getElementById('redaction-pattern-input').value.trim();
            if (!pattern) {
                alert('Enter a pattern first');
                return;
            }
            try {
                var regex = new RegExp(pattern, 'gi');
                var testStr = prompt('Enter test string to check redaction:', 'my-api-key-12345 or test@email.com');
                if (testStr) {
                    var result = testStr.replace(regex, '[REDACTED]');
                    alert('Result: ' + result);
                }
            } catch (e) {
                alert('Invalid regex pattern: ' + e.message);
            }
        };

        // Toggle redaction pattern on/off
        document.querySelectorAll('.toggle-redaction').forEach(function(toggle) {
            toggle.onchange = function() {
                var id = toggle.getAttribute('data-id');
                var enabled = toggle.checked;
                vscode.postMessage({ type: 'toggleRedactionPattern', value: { id: id, enabled: enabled } });
            };
        });

        // Remove redaction pattern buttons
        document.querySelectorAll('.btn-remove-redaction').forEach(function(btn) {
            btn.onclick = function() {
                var id = btn.getAttribute('data-id');
                if (id && confirm('Remove this pattern?')) {
                    vscode.postMessage({ type: 'removeRedactionPattern', value: id });
                }
            };
        });

        // Handle messages from extension
        window.addEventListener('message', function(event) {
            var message = event.data;
            console.log('[Dashboard] Received message:', message.type, message);
            if (message.type === 'historyData') {
                // Legacy support if needed
            } else if (message.type === 'statsData') {
                updateStats(message.data);
            } else if (message.type === 'auditStatsData') {
                updateCharts(message.data);
            } else if (message.type === 'auditLogData') {
                console.log('[Dashboard] Updating log table with', message.data?.length || 0, 'entries');
                updateLogTable(message.data, message.page, message.total, message.pageSize);
            } else if (message.type === 'liveLog') {
                appendLog(message.value);
            }
        });

        // Pagination state variables moved to top of script

        document.getElementById('btn-prev-page').onclick = function() {
            if (currentPage > 1) {
                currentPage--;
                vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                document.getElementById('audit-table-body').innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; opacity: 0.7;">Loading...</td></tr>';
            }
        };

        document.getElementById('btn-next-page').onclick = function() {
            if (currentPage * pageSize < totalLogs) {
                currentPage++;
                vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                document.getElementById('audit-table-body').innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; opacity: 0.7;">Loading...</td></tr>';
            }
        };

        function updateCharts(stats) {
            // Charts removed per user request
        }

        // lastLogs declared at top of script

        function formatNumber(num) {
            if (num === undefined || num === null) return '0';
            if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toString();
        }

// Live Log Tail Logic
        const logContainer = document.getElementById('live-log-container');
        const autoScroll = document.getElementById('log-autoscroll');
        const logStatus = document.getElementById('log-status-indicator');
        let linesCount = 0;

        function appendLog(log) {
            if (!logContainer) return;
            if (linesCount === 0) logContainer.innerHTML = '';
            
            const line = document.createElement('div');
            line.className = 'log-line';
            
            const isError = log.status >= 400;
            const statusClass = isError ? 'error' : 'success';
            
            const time = new Date(log.timestamp).toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            line.innerHTML = '<span class="log-time">[' + time + ']</span>' +
                             '<span class="log-method">' + (log.method || 'UNK') + '</span>' +
                             '<span class="log-path">' + (log.path || '/') + '</span>' +
                             '<span class="log-status ' + statusClass + '">' + (log.status || 0) + '</span>' +
                             '<span class="log-latency">' + (log.durationMs || 0) + 'ms</span>';

            
            logContainer.appendChild(line);
            linesCount++;
            
            // Pulse status indicator
            if (logStatus) {
                logStatus.classList.remove('active');
                void logStatus.offsetWidth; // Trigger reflow
                logStatus.classList.add('active');
            }
            
            // Limit shown lines to 100 for performance
            if (linesCount > 100) {
                logContainer.removeChild(logContainer.firstChild);
                linesCount--;
            }
            
            if (autoScroll && autoScroll.checked) {
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        document.getElementById('btn-clear-logs').onclick = function() {
            if (logContainer) {
                logContainer.innerHTML = '<div class="muted" style="text-align: center; padding-top: 120px; opacity: 0.5;">Waiting for API requests...</div>';
                linesCount = 0;
            }
        };

        function updateLogTable(logs, page, total, pSize) {
            lastLogs = logs;
            currentPage = page;
            totalLogs = total;
            pageSize = pSize || 10;

            const tbody = document.getElementById('audit-table-body');
            const pageInfo = document.getElementById('page-info');
            const btnPrev = document.getElementById('btn-prev-page');
            const btnNext = document.getElementById('btn-next-page');

            if (pageInfo) {
                const start = (page - 1) * pageSize + 1;
                const end = Math.min(page * pageSize, total);
                pageInfo.textContent = \`Showing \${total === 0 ? 0 : start}-\${end} of \${total}\`;
            }
            if (btnPrev) btnPrev.disabled = page <= 1;
            if (btnNext) btnNext.disabled = page * pageSize >= total;

            if (!tbody) return;
            
            // Clear checks to force refresh
            tbody.innerHTML = '';
            
            if (!logs || logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="padding: 24px; text-align: center; opacity: 0.6; font-style: italic;">No audit logs found.<br><span style="font-size: 11px; opacity: 0.8; margin-top: 4px; display: block;">Make a request to generate logs.</span></td></tr>';
                return;
            }

            tbody.innerHTML = logs.map((log, index) => {
                const date = new Date(log.timestamp);
                const time = date.toLocaleTimeString();
                const statusColor = log.status >= 400 ? 'var(--vscode-testing-iconFailed)' : (log.status >= 300 ? 'var(--vscode-charts-yellow)' : 'var(--vscode-testing-iconPassed)');
                
                return \`
                <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                    <td style="padding: 8px 12px; white-space: nowrap; opacity: 0.8;">\${time}</td>
                    <td style="padding: 8px 12px; white-space: nowrap;"><span style="padding: 2px 6px; border-radius: 4px; background: var(--vscode-textCodeBlock-background); font-size: 11px; font-family: var(--vscode-editor-font-family);">\${log.method || 'UNK'}</span></td>
                    <td style="padding: 8px 12px; word-break: break-all; font-family: var(--vscode-editor-font-family);">\${log.path || '/'}</td>
                    <td style="padding: 8px 12px; color: \${statusColor}; font-weight: 600;">\${log.status || 0}</td>
                    <td style="padding: 8px 12px;">\${log.durationMs || 0}ms</td>
                    <td style="padding: 8px 12px;" title="\${(log.tokensIn || 0) + (log.tokensOut || 0)} tokens">\${formatNumber ? formatNumber((log.tokensIn || 0) + (log.tokensOut || 0)) : 0}</td>
                    <td style="padding: 8px 12px;">
                        <button class="secondary btn-view-details" data-index="\${index}" style="padding: 2px 8px; font-size: 10px; width: auto;">\u{1F50D}</button>
                    </td>
                </tr>\`;
    }).join('');

    // Add event listeners for view buttons (CSP safe)
    document.querySelectorAll('.btn-view-details').forEach(btn => {
        btn.addEventListener('click', () => {
             const index = parseInt(btn.getAttribute('data-index') || '0');
             showDetails(index);
        });
    });
}

function updateStats(stats) {
    if (stats.totalRequests !== undefined) {
        document.getElementById('stat-requests').textContent = formatNumber(stats.totalRequests);
        document.getElementById('stat-requests').title = stats.totalRequests + ' requests';
    }
    if (stats.requestsPerMinute !== undefined) document.getElementById('stat-rpm').textContent = stats.requestsPerMinute;
    if (stats.avgLatencyMs !== undefined) document.getElementById('stat-latency').innerHTML = stats.avgLatencyMs + '<span style="font-size: 12px;">ms</span>';
    if (stats.totalTokensIn !== undefined) {
        document.getElementById('stat-tokens-in').textContent = formatNumber(stats.totalTokensIn);
        document.getElementById('stat-tokens-in').title = stats.totalTokensIn;
    }
    if (stats.totalTokensOut !== undefined) {
        document.getElementById('stat-tokens-out').textContent = formatNumber(stats.totalTokensOut);
        document.getElementById('stat-tokens-out').title = stats.totalTokensOut;
    }
    if (stats.errorRate !== undefined) document.getElementById('stat-errors').innerHTML = stats.errorRate + '<span style="font-size: 12px;">%</span>';
    if (stats.uptimeMs !== undefined) {
        var minutes = Math.floor(stats.uptimeMs / 60000);
        var hours = Math.floor(minutes / 60);
        var display = hours > 0 ? hours + 'h ' + (minutes % 60) + 'm' : minutes + 'm';
        document.getElementById('stat-uptime').textContent = display;
    }
    
    // Update MCP Status
    if (stats.mcp) {
        var mcpEnabled = stats.mcp.enabled;
        var statusBadge = document.getElementById('mcp-status-badge');
        if (statusBadge) {
            statusBadge.textContent = mcpEnabled ? (stats.mcp.servers.length > 0 ? 'Connected' : 'Ready') : 'Disabled';
            statusBadge.style.background = mcpEnabled ? (stats.mcp.servers.length > 0 ? 'var(--vscode-charts-green)' : 'var(--vscode-charts-blue)') : 'var(--vscode-charts-red)';
            statusBadge.style.color = 'white';
            statusBadge.style.padding = '2px 8px';
            statusBadge.style.borderRadius = '10px';
            statusBadge.style.fontSize = '10px';
        }

        document.getElementById('mcp-servers-count').textContent = stats.mcp.servers.length;
        document.getElementById('mcp-servers-list').textContent = stats.mcp.servers.length > 0 ? stats.mcp.servers.join(', ') : 'None';
        
        document.getElementById('mcp-tools-count').textContent = stats.mcp.tools.length;
        var toolsList = stats.mcp.tools.map(function(t) { return t.name; }).join(', ');
        document.getElementById('mcp-tools-list').textContent = toolsList || 'None';
        
        var toggle = document.getElementById('mcp-enabled-toggle');
        if (toggle) toggle.checked = mcpEnabled;
    }
}

// Auto-refresh stats every 5 seconds
setInterval(function () {
    vscode.postMessage({ type: 'getStats' });
}, 5000);

// Load audit data on page load
// Load audit data on page load
vscode.postMessage({ type: 'getAuditStats' });
vscode.postMessage({ type: 'getAuditLogs', value: { page: 1, pageSize: 10 } });
</script>
    </body>
    </html>`}async resolveWebviewView(e,r,n){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=await this._getSidebarHtml(e.webview),e.webview.onDidReceiveMessage(async o=>{switch(o.type){case"openDashboard":await t.createOrShow(this._extensionUri,this._gateway);break;case"startServer":this._gateway.startServer();break;case"stopServer":this._gateway.stopServer();break}})}};function Kz(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function r9(t){let e=Ue.window.createOutputChannel("GitHub Copilot API Server");t.subscriptions.push(e);let r=Ue.window.createStatusBarItem(Ue.StatusBarAlignment.Left,100);r.command="github-copilot-api-vscode.showServerControls",t.subscriptions.push(r);let n=new Ud(e,r,t);t.subscriptions.push(n);let o=new Fi(t.extensionUri,n);t.subscriptions.push(Ue.window.registerWebviewViewProvider(Fi.viewType,o));let s=Ue.workspace.getConfiguration("githubCopilotApi.server").get("enabled",!1);e.appendLine(`[DEBUG] Extension activation. Config 'enabled': ${s}`),s?(r.text="$(broadcast) Copilot API: Starting\u2026",r.tooltip="Manage the Copilot API gateway",r.show(),n.start().catch(p=>{e.appendLine(`[${new Date().toISOString()}] ERROR Failed to start API server: ${Rn(p)}`),r.text="$(alert) Copilot API: Failed",r.tooltip=`Copilot API server failed to start: ${Rn(p)}`,Ue.window.showErrorMessage(`Failed to start Copilot API server: ${Rn(p)}`)})):(r.text="$(circle-slash) Copilot API: Stopped",r.tooltip="Copilot API server is disabled (default)",r.hide());let a=Ue.commands.registerCommand("github-copilot-api-vscode.openCopilotChat",async()=>{await Ld()&&await Ue.commands.executeCommand("workbench.action.chat.open")}),c=Ue.commands.registerCommand("github-copilot-api-vscode.askCopilot",async p=>{if(!await Ld())return;let f=mb(p)??await Ue.window.showInputBox({title:"Ask GitHub Copilot Chat",prompt:"What do you want to ask Copilot?",ignoreFocusOut:!0});f&&await Ue.commands.executeCommand("workbench.action.chat.open",{query:f,isPartialQuery:!1})}),u=Ue.commands.registerTextEditorCommand("github-copilot-api-vscode.askSelectionWithCopilot",async(p,f,h)=>{if(!await Ld())return;let m=p.selection;if(m.isEmpty){Ue.window.showWarningMessage("Select some code before asking Copilot about it.");return}let g=mb(h)??await Ue.window.showInputBox({title:"Ask Copilot About Selection",prompt:"Describe what you want to know about the selected code.",value:"Explain this code.",ignoreFocusOut:!0});g&&await Ue.commands.executeCommand("workbench.action.chat.open",{query:g,isPartialQuery:!1,attachFiles:[{uri:p.document.uri,range:new Ue.Range(m.start,m.end)}],blockOnResponse:!1})}),l=Ue.commands.registerCommand("github-copilot-api-vscode.showServerControls",async()=>{await n.showControlPalette()}),d=Ue.commands.registerCommand("github-copilot-api-vscode.openDashboard",()=>{Fi.createOrShow(t.extensionUri,n)});t.subscriptions.push(a,c,u,l,d)}function n9(){}0&&(module.exports={activate,deactivate});
